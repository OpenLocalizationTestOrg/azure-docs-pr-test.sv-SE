---
title: "CENC med Multi-DRM och Access Control: en referens Design och Implementeringslösning på Azure och Azure Media Services | Microsoft Docs"
description: "Läs mer om hur toolicensing hello Microsoft® Smooth Streaming klienten portera Kit."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 033fb618650c4fbe9069d467159a8734da759bba
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="7c02d-103">CENC med Multi-DRM och åtkomstkontroll: En referensdesign och implementering i Azure och Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="7c02d-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="7c02d-104">Introduktion</span><span class="sxs-lookup"><span data-stu-id="7c02d-104">Introduction</span></span>
<span data-ttu-id="7c02d-105">Det är känt att den är en komplicerad uppgift toodesign och skapa ett DRM-undersystem för en OTT eller online strömning lösning.</span><span class="sxs-lookup"><span data-stu-id="7c02d-105">It is well known that it is a complex task toodesign and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="7c02d-106">Och det är en vanlig rutin för ansvariga för online video providers toooutsource denna del toospecialized DRM-leverantörer.</span><span class="sxs-lookup"><span data-stu-id="7c02d-106">And it is a common practice for operators/online video providers toooutsource this part toospecialized DRM service providers.</span></span> <span data-ttu-id="7c02d-107">hello syftet med det här dokumentet är toopresent en referens för design och implementering av DRM-undersystemet för slutpunkt till slutpunkt i OTT eller strömmande onlinelösning.</span><span class="sxs-lookup"><span data-stu-id="7c02d-107">hello goal of this document is toopresent a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="7c02d-108">hello riktade läsare av det här dokumentet är tekniker som arbetar i DRM-undersystemet OTT strömning/flera-screen lösningar online eller alla läsare som är intresserade av DRM-undersystemet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-108">hello targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="7c02d-109">hello antas att läsaren känner till minst en av hello DRM tekniker på hello marknad, till exempel PlayReady, Widevine, FairPlay eller Adobe åtkomst.</span><span class="sxs-lookup"><span data-stu-id="7c02d-109">hello assumption is that readers are familiar with at least one of hello DRM technologies on hello market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="7c02d-110">Av DRM inkludera vi också CENC (Common Encryption) med multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="7c02d-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="7c02d-111">En större trend i online-strömning och OTT branschen är toouse CENC med flera-native-DRM på olika klientplattformar som är en övergång från hello tidigare trend med en enda DRM och dess klient-SDK för olika klientplattformar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-111">A major trend in online streaming and OTT industry is toouse CENC with multi-native-DRM on various client platforms, which is a shift from hello previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="7c02d-112">När du använder CENC med flera native DRM både PlayReady och Widevine krypteras enligt hello [Common Encryption (ISO/IEC 23001 7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specifikation.</span><span class="sxs-lookup"><span data-stu-id="7c02d-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="7c02d-113">hello fördelarna med CENC med multi-DRM är följande:</span><span class="sxs-lookup"><span data-stu-id="7c02d-113">hello benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="7c02d-114">Minskar kryptering kostnad eftersom en enda kryptering bearbetning används inriktning på olika plattformar med dess ursprungliga DRMs;</span><span class="sxs-lookup"><span data-stu-id="7c02d-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="7c02d-115">Minskar hello kostnaden för att hantera krypterade tillgångar eftersom bara en enda kopia av krypterade tillgångar krävs;</span><span class="sxs-lookup"><span data-stu-id="7c02d-115">Reduces hello cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="7c02d-116">Eliminerar DRM klientlicensiering kostnaden eftersom hello-DRM-klienten är vanligtvis ledigt på dess ursprungliga plattform.</span><span class="sxs-lookup"><span data-stu-id="7c02d-116">Eliminates DRM client licensing cost since hello native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="7c02d-117">Microsoft har en aktiv förslagsställare DASH och CENC tillsammans med vissa viktiga branschen spelare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="7c02d-118">Microsoft Azure Media Services tillhandahåller i stöd för DASH och CENC.</span><span class="sxs-lookup"><span data-stu-id="7c02d-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="7c02d-119">Senaste meddelanden finns Mingfeis bloggar: [meddelar Google Widevines licensleveranstjänster i Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), och [Azure Media Services lägger till Google Widevine-paketering för att leverera Multi-DRM dataströmmen](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="7c02d-120">Översikt över den här artikeln</span><span class="sxs-lookup"><span data-stu-id="7c02d-120">Overview of this article</span></span>
<span data-ttu-id="7c02d-121">hello syftet med den här artikeln innehåller hello följande:</span><span class="sxs-lookup"><span data-stu-id="7c02d-121">hello goal of this article includes hello following:</span></span>

1. <span data-ttu-id="7c02d-122">Innehåller en referens design av DRM-undersystemet med CENC med multi-DRM;</span><span class="sxs-lookup"><span data-stu-id="7c02d-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="7c02d-123">Innehåller en referensimplementering för Microsoft Azure-/ Azure Media Services-plattform.</span><span class="sxs-lookup"><span data-stu-id="7c02d-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="7c02d-124">Beskriver vissa design och implementeringslösning avsnitt.</span><span class="sxs-lookup"><span data-stu-id="7c02d-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="7c02d-125">I hello artikeln täcker ”multi-DRM” hello följande:</span><span class="sxs-lookup"><span data-stu-id="7c02d-125">In hello article, “multi-DRM” covers hello following:</span></span>

1. <span data-ttu-id="7c02d-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="7c02d-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="7c02d-127">Google Widevines</span><span class="sxs-lookup"><span data-stu-id="7c02d-127">Google Widevine</span></span>
3. <span data-ttu-id="7c02d-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="7c02d-128">Apple FairPlay</span></span> 

<span data-ttu-id="7c02d-129">hello följande tabell sammanfattas hello interna plattform/egen app och webbläsare som stöds av varje DRM.</span><span class="sxs-lookup"><span data-stu-id="7c02d-129">hello following table summarizes hello native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="7c02d-130">**Klientplattform**</span><span class="sxs-lookup"><span data-stu-id="7c02d-130">**Client Platform**</span></span> | <span data-ttu-id="7c02d-131">**Intern DRM-Support**</span><span class="sxs-lookup"><span data-stu-id="7c02d-131">**Native DRM Support**</span></span> | <span data-ttu-id="7c02d-132">**Browser-appen**</span><span class="sxs-lookup"><span data-stu-id="7c02d-132">**Browser/App**</span></span> | <span data-ttu-id="7c02d-133">**Strömningsformat**</span><span class="sxs-lookup"><span data-stu-id="7c02d-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="7c02d-134">**TV-apparater, operatorn digitalboxar, OTT digitalboxar för smartkort**</span><span class="sxs-lookup"><span data-stu-id="7c02d-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="7c02d-135">PlayReady främst och/eller Widevine och/eller andra</span><span class="sxs-lookup"><span data-stu-id="7c02d-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="7c02d-136">Linux, Opera, WebKit, andra</span><span class="sxs-lookup"><span data-stu-id="7c02d-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="7c02d-137">Olika format</span><span class="sxs-lookup"><span data-stu-id="7c02d-137">Various formats</span></span> |
| <span data-ttu-id="7c02d-138">**Windows 10-enheter (Windows-dator, Windows-surfplattor, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="7c02d-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="7c02d-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="7c02d-139">PlayReady</span></span> |<span data-ttu-id="7c02d-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="7c02d-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="7c02d-141">UWP</span><span class="sxs-lookup"><span data-stu-id="7c02d-141">UWP</span></span> |<span data-ttu-id="7c02d-142">STRECK (för HLS, PlayReady stöds inte)</span><span class="sxs-lookup"><span data-stu-id="7c02d-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="7c02d-143">DASH, Smooth Streaming (HLS för, PlayReady stöds inte)</span><span class="sxs-lookup"><span data-stu-id="7c02d-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="7c02d-144">**Android-enheter (telefon, surfplatta, TV)**</span><span class="sxs-lookup"><span data-stu-id="7c02d-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="7c02d-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="7c02d-145">Widevine</span></span> |<span data-ttu-id="7c02d-146">Chrome/EME</span><span class="sxs-lookup"><span data-stu-id="7c02d-146">Chrome/EME</span></span> |<span data-ttu-id="7c02d-147">DASH, HLS</span><span class="sxs-lookup"><span data-stu-id="7c02d-147">DASH,HLS</span></span> |
| <span data-ttu-id="7c02d-148">**iOS (iPhone, iPad), OS X-klienter och Apple TV**</span><span class="sxs-lookup"><span data-stu-id="7c02d-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="7c02d-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="7c02d-149">FairPlay</span></span> |<span data-ttu-id="7c02d-150">Safari 8 +/ EME</span><span class="sxs-lookup"><span data-stu-id="7c02d-150">Safari 8+/EME</span></span> |<span data-ttu-id="7c02d-151">HLS</span><span class="sxs-lookup"><span data-stu-id="7c02d-151">HLS</span></span> |


<span data-ttu-id="7c02d-152">Med tanke på hello aktuell status för distributionen för varje DRM, en tjänst vill förmodligen tooimplement 2 eller 3 DRMs toomake att du lösa alla hello typer av slutpunkter i hello bästa sätt.</span><span class="sxs-lookup"><span data-stu-id="7c02d-152">Considering hello current state of deployment for each DRM, a service will typically want tooimplement 2 or 3 DRMs toomake sure you address all hello types of endpoints in hello best way.</span></span>

<span data-ttu-id="7c02d-153">Det finns en kompromiss mellan hello komplexitet hello service logik och hello komplexitet för hello klienten sida tooreach en viss användare har inloggningen på hello olika klienter.</span><span class="sxs-lookup"><span data-stu-id="7c02d-153">There is a tradeoff between hello complexity of hello service logic and hello complexity on hello client side tooreach a certain level of user experience on hello various clients.</span></span>

<span data-ttu-id="7c02d-154">toomake valet Kom något dessa uppgifter:</span><span class="sxs-lookup"><span data-stu-id="7c02d-154">toomake your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="7c02d-155">PlayReady är internt implementerad i alla Windows-enhet på en Android-enheter och tillgänglig via programvara SDK: er på nästan alla plattformar</span><span class="sxs-lookup"><span data-stu-id="7c02d-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="7c02d-156">Widevine implementeras internt i alla Android-enhet, Chrome och vissa andra enheter</span><span class="sxs-lookup"><span data-stu-id="7c02d-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="7c02d-157">FairPlay finns bara på iOS och Mac OS x-klienter eller via iTunes.</span><span class="sxs-lookup"><span data-stu-id="7c02d-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="7c02d-158">Detta är en typisk multi-DRM:</span><span class="sxs-lookup"><span data-stu-id="7c02d-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="7c02d-159">Alternativ 1: PlayReady och Widevine</span><span class="sxs-lookup"><span data-stu-id="7c02d-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="7c02d-160">Alternativ 2: PlayReady, Widevine och FairPlay</span><span class="sxs-lookup"><span data-stu-id="7c02d-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="7c02d-161">En referens-design</span><span class="sxs-lookup"><span data-stu-id="7c02d-161">A reference design</span></span>
<span data-ttu-id="7c02d-162">I det här avsnittet presenterar vi en referens-design som är oberoende tootechnologies används tooimplement den.</span><span class="sxs-lookup"><span data-stu-id="7c02d-162">In this section, we will present a reference design which is agnostic tootechnologies used tooimplement it.</span></span>

<span data-ttu-id="7c02d-163">DRM-undersystemet kan innehålla hello följande komponenter:</span><span class="sxs-lookup"><span data-stu-id="7c02d-163">A DRM subsystem may contain hello following components:</span></span>

1. <span data-ttu-id="7c02d-164">Hantering av nycklar</span><span class="sxs-lookup"><span data-stu-id="7c02d-164">Key management</span></span>
2. <span data-ttu-id="7c02d-165">DRM-paketering</span><span class="sxs-lookup"><span data-stu-id="7c02d-165">DRM packaging</span></span>
3. <span data-ttu-id="7c02d-166">DRM-licensleverans</span><span class="sxs-lookup"><span data-stu-id="7c02d-166">DRM license delivery</span></span>
4. <span data-ttu-id="7c02d-167">Rätt kontroll</span><span class="sxs-lookup"><span data-stu-id="7c02d-167">Entitlement check</span></span>
5. <span data-ttu-id="7c02d-168">Autentisering/auktorisering</span><span class="sxs-lookup"><span data-stu-id="7c02d-168">Authentication/authorization</span></span>
6. <span data-ttu-id="7c02d-169">Player</span><span class="sxs-lookup"><span data-stu-id="7c02d-169">Player</span></span>
7. <span data-ttu-id="7c02d-170">Ursprung/CDN</span><span class="sxs-lookup"><span data-stu-id="7c02d-170">Origin/CDN</span></span>

<span data-ttu-id="7c02d-171">hello illustrerar följande diagram hello hög nivå interaktion mellan hello komponenterna i ett DRM-undersystem.</span><span class="sxs-lookup"><span data-stu-id="7c02d-171">hello following diagram illustrates hello high level interaction among hello components in a DRM subsystem.</span></span>

![DRM-undersystemet med CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="7c02d-173">Det finns tre grundläggande ”lager” i hello design:</span><span class="sxs-lookup"><span data-stu-id="7c02d-173">There are three basic “layers” in hello design:</span></span>

1. <span data-ttu-id="7c02d-174">Säkerhetskopiera office lager (i svart) som inte exponeras externt.</span><span class="sxs-lookup"><span data-stu-id="7c02d-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="7c02d-175">”DMZ” lager (blå) som innehåller alla hello slutpunkter mot offentlig.</span><span class="sxs-lookup"><span data-stu-id="7c02d-175">“DMZ” layer (blue) containing all hello endpoints facing public;</span></span>
3. <span data-ttu-id="7c02d-176">Offentliga Internet lager (lätta blå) som innehåller CDN och spelare med trafik över offentligt Internet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="7c02d-177">Det bör finnas ett innehållshantering verktyg för att styra DRM-skydd, oavsett är statisk eller dynamisk kryptering.</span><span class="sxs-lookup"><span data-stu-id="7c02d-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="7c02d-178">hello indata för DRM kryptering bör innehålla:</span><span class="sxs-lookup"><span data-stu-id="7c02d-178">hello inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="7c02d-179">MBR videoinnehåll.</span><span class="sxs-lookup"><span data-stu-id="7c02d-179">MBR video content;</span></span>
2. <span data-ttu-id="7c02d-180">Innehållsnyckeln;</span><span class="sxs-lookup"><span data-stu-id="7c02d-180">Content key;</span></span>
3. <span data-ttu-id="7c02d-181">Licens förvärv URL: er.</span><span class="sxs-lookup"><span data-stu-id="7c02d-181">License acquisition URLs.</span></span>

<span data-ttu-id="7c02d-182">Under uppspelningen tiden är hello hög nivå flödet:</span><span class="sxs-lookup"><span data-stu-id="7c02d-182">During playback time, hello high level flow is:</span></span>

1. <span data-ttu-id="7c02d-183">Användaren autentiseras;</span><span class="sxs-lookup"><span data-stu-id="7c02d-183">User is authenticated;</span></span>
2. <span data-ttu-id="7c02d-184">Autentiseringstoken har skapats för hello användaren.</span><span class="sxs-lookup"><span data-stu-id="7c02d-184">Authorization token is created for hello user;</span></span>
3. <span data-ttu-id="7c02d-185">DRM-skyddat innehåll (manifestet) är hämtade tooplayer;</span><span class="sxs-lookup"><span data-stu-id="7c02d-185">DRM protected content (manifest) is downloaded tooplayer;</span></span>
4. <span data-ttu-id="7c02d-186">Player skickar förvärv begäran toolicense licensservrar tillsammans med nyckel-ID och auktorisering token.</span><span class="sxs-lookup"><span data-stu-id="7c02d-186">Player submits license acquisition request toolicense servers together with key ID and authorization token.</span></span>

<span data-ttu-id="7c02d-187">Innan du flyttar toohello nästa avsnitt, några ord om hello design med nyckelhantering.</span><span class="sxs-lookup"><span data-stu-id="7c02d-187">Before moving toohello next topic, a few words about hello design of key management.</span></span>

| <span data-ttu-id="7c02d-188">**Tillgång till ContentKey –**</span><span class="sxs-lookup"><span data-stu-id="7c02d-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="7c02d-189">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="7c02d-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="7c02d-190">1-till-1</span><span class="sxs-lookup"><span data-stu-id="7c02d-190">1–to-1</span></span> |<span data-ttu-id="7c02d-191">hello enklaste fallet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-191">hello simplest case.</span></span> <span data-ttu-id="7c02d-192">Det ger hello finest kontroll.</span><span class="sxs-lookup"><span data-stu-id="7c02d-192">It provides hello finest control.</span></span> <span data-ttu-id="7c02d-193">Men det vanligtvis resulterar i hello högsta licens leverans kostnad.</span><span class="sxs-lookup"><span data-stu-id="7c02d-193">But this generally results in hello highest license delivery cost.</span></span> <span data-ttu-id="7c02d-194">Begäran måste anges för varje skyddad tillgång på minst en licens.</span><span class="sxs-lookup"><span data-stu-id="7c02d-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="7c02d-195">1-till-många</span><span class="sxs-lookup"><span data-stu-id="7c02d-195">1–to-Many</span></span> |<span data-ttu-id="7c02d-196">Du kan använda hello samma innehåll nyckel för flera tillgångar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-196">You could use hello same content key for multiple assets.</span></span> <span data-ttu-id="7c02d-197">Till exempel för alla hello tillgångar i en logisk grupp, till exempel en kategori eller en delmängd av kategori (eller film Gen) använda en enda innehållsnyckel.</span><span class="sxs-lookup"><span data-stu-id="7c02d-197">For example, for all hello assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="7c02d-198">Många-till-1</span><span class="sxs-lookup"><span data-stu-id="7c02d-198">Many–to-1</span></span> |<span data-ttu-id="7c02d-199">Nycklar för multiinnehåll krävs för varje tillgång.</span><span class="sxs-lookup"><span data-stu-id="7c02d-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="7c02d-200">Du måste till exempel två separata innehåll nycklar, var och en med sin egen ContentKeyType om du behöver skydd för tooapply för dynamiska CENC med multi-DRM för MPEG DASH och dynamisk AES-128-kryptering för HLS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-200">For example, if you need tooapply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="7c02d-201">(För hello innehållsnyckeln används för dynamiska CENC skydd, ContentKeyType.CommonEncryption ska användas, medan för hello innehåll nyckel som används för dynamiska AES-128-kryptering, ContentKeyType.EnvelopeEncryption ska användas.)</span><span class="sxs-lookup"><span data-stu-id="7c02d-201">(For hello content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for hello content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="7c02d-202">Ett annat exempel är CENC DASH att skydda innehåll, i teorin, en innehållsnyckel kan använda tooprotect video-ström och ett annat innehåll viktiga tooprotect ljudström.</span><span class="sxs-lookup"><span data-stu-id="7c02d-202">Another example, in CENC protection of DASH content, in theory, one content key can be used tooprotect video stream and another content key tooprotect audio stream.</span></span> |
| <span data-ttu-id="7c02d-203">Många-för-många</span><span class="sxs-lookup"><span data-stu-id="7c02d-203">Many – too- Many</span></span> |<span data-ttu-id="7c02d-204">Kombinationen av hello ovan två scenarier: en uppsättning av innehåll som nycklar används för varje hello flera resurser i hello samma ”grupp”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-204">Combination of hello above two scenarios: one set of content keys are used for each of hello multiple assets in hello same asset “group”.</span></span> |

<span data-ttu-id="7c02d-205">En annan viktig faktor tooconsider är hello användningen av beständiga och icke-beständig licenser.</span><span class="sxs-lookup"><span data-stu-id="7c02d-205">Another important factor tooconsider is hello use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="7c02d-206">Varför är detta viktigt?</span><span class="sxs-lookup"><span data-stu-id="7c02d-206">Why are these considerations important?</span></span>

<span data-ttu-id="7c02d-207">De har direkt inverkan toolicense leverans om du använder offentliga moln för licensleverans av.</span><span class="sxs-lookup"><span data-stu-id="7c02d-207">They have direct impact toolicense delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="7c02d-208">Nu ska vi titta efter två olika design fall tooillustrate hello:</span><span class="sxs-lookup"><span data-stu-id="7c02d-208">Let’s consider hello following two different design cases tooillustrate:</span></span>

1. <span data-ttu-id="7c02d-209">Månatlig prenumeration: använda beständiga licens och 1-till-många innehåll nyckeln till tillgången mappning.</span><span class="sxs-lookup"><span data-stu-id="7c02d-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="7c02d-210">T.ex.</span><span class="sxs-lookup"><span data-stu-id="7c02d-210">E.g.</span></span> <span data-ttu-id="7c02d-211">för alla hello barnen filmer använder vi en enda innehållsnyckel för kryptering.</span><span class="sxs-lookup"><span data-stu-id="7c02d-211">for all hello kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="7c02d-212">I det här fallet:</span><span class="sxs-lookup"><span data-stu-id="7c02d-212">In this case:</span></span>

    <span data-ttu-id="7c02d-213">Totalt antal # licenser som krävs för alla barnen filmer enhet = 1</span><span class="sxs-lookup"><span data-stu-id="7c02d-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="7c02d-214">Månatlig prenumeration: använda icke-beständig licens och 1-till-1-mappning mellan innehållsnyckeln och tillgångshantering.</span><span class="sxs-lookup"><span data-stu-id="7c02d-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="7c02d-215">I det här fallet:</span><span class="sxs-lookup"><span data-stu-id="7c02d-215">In this case:</span></span>

    <span data-ttu-id="7c02d-216">Totalt antal # licenser som krävs för alla barnen filmer enhet = [# filmer bevakade] x [# sessioner]</span><span class="sxs-lookup"><span data-stu-id="7c02d-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="7c02d-217">Som du kan enkelt se, begära hello två olika konstruktionerna resultera i mycket olika licens mönster därför licensleverans om licensleveranstjänst tillhandahålls av ett offentligt moln, till exempel Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="7c02d-217">As you can easily see, hello two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-tootechnology-for-implementation"></a><span data-ttu-id="7c02d-218">Mappning design tootechnology för implementering</span><span class="sxs-lookup"><span data-stu-id="7c02d-218">Mapping design tootechnology for implementation</span></span>
<span data-ttu-id="7c02d-219">Därefter mappa vi vårt allmänna design tootechnologies på Microsoft Azure-/ Azure Media Services-plattformen genom att ange vilken teknik toouse för varje byggblock.</span><span class="sxs-lookup"><span data-stu-id="7c02d-219">Next, we map our generic design tootechnologies on Microsoft Azure/Azure Media Services platform, by specifying which technology toouse for each building block.</span></span>

<span data-ttu-id="7c02d-220">hello visar följande tabell hello mappning:</span><span class="sxs-lookup"><span data-stu-id="7c02d-220">hello following table shows hello mapping:</span></span>

| <span data-ttu-id="7c02d-221">**Byggblock**</span><span class="sxs-lookup"><span data-stu-id="7c02d-221">**Building Block**</span></span> | <span data-ttu-id="7c02d-222">**Teknik**</span><span class="sxs-lookup"><span data-stu-id="7c02d-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="7c02d-223">**Player**</span><span class="sxs-lookup"><span data-stu-id="7c02d-223">**Player**</span></span> |[<span data-ttu-id="7c02d-224">Azure Media Player</span><span class="sxs-lookup"><span data-stu-id="7c02d-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="7c02d-225">**Identitetsprovider (IDP)**</span><span class="sxs-lookup"><span data-stu-id="7c02d-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="7c02d-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7c02d-226">Azure Active Directory</span></span> |
| <span data-ttu-id="7c02d-227">**Secure Token Service (STS)**</span><span class="sxs-lookup"><span data-stu-id="7c02d-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="7c02d-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7c02d-228">Azure Active Directory</span></span> |
| <span data-ttu-id="7c02d-229">**Arbetsflöde för DRM-skydd**</span><span class="sxs-lookup"><span data-stu-id="7c02d-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="7c02d-230">Azure Media Services dynamisk skydd</span><span class="sxs-lookup"><span data-stu-id="7c02d-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="7c02d-231">**DRM-licensleverans**</span><span class="sxs-lookup"><span data-stu-id="7c02d-231">**DRM License Delivery**</span></span> |<span data-ttu-id="7c02d-232">1. Azure Media Services licensleverans (PlayReady Widevine, FairPlay), eller</span><span class="sxs-lookup"><span data-stu-id="7c02d-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="7c02d-233">2. Axinom licensserver</span><span class="sxs-lookup"><span data-stu-id="7c02d-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="7c02d-234">3. Anpassade PlayReady licensserver</span><span class="sxs-lookup"><span data-stu-id="7c02d-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="7c02d-235">**Ursprung**</span><span class="sxs-lookup"><span data-stu-id="7c02d-235">**Origin**</span></span> |<span data-ttu-id="7c02d-236">Azure Media Services strömmande slutpunkt</span><span class="sxs-lookup"><span data-stu-id="7c02d-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="7c02d-237">**Hantering av nycklar**</span><span class="sxs-lookup"><span data-stu-id="7c02d-237">**Key Management**</span></span> |<span data-ttu-id="7c02d-238">Behövs inte för referensimplementering</span><span class="sxs-lookup"><span data-stu-id="7c02d-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="7c02d-239">**Innehållshantering**</span><span class="sxs-lookup"><span data-stu-id="7c02d-239">**Content Management**</span></span> |<span data-ttu-id="7c02d-240">Ett C#-konsolprogram</span><span class="sxs-lookup"><span data-stu-id="7c02d-240">A C# console application</span></span> |

<span data-ttu-id="7c02d-241">Med andra ord kommer både identitet Provider (IDP) och Secure säkerhetstokentjänst (STS) att Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="7c02d-242">Vi använder för spelare, [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="7c02d-243">Stöder både Azure Media Services och Azure Media Player DASH och CENC med multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="7c02d-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="7c02d-244">följande diagram visar hello hello övergripande struktur och flöde med hello ovan teknik mappning.</span><span class="sxs-lookup"><span data-stu-id="7c02d-244">hello following diagram shows hello overall structure and flow with hello above technology mapping.</span></span>

![CENC på AMS](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="7c02d-246">I ordning tooset in dynamisk CENC kryptering använder hello innehållshantering verktyget hello följande indata:</span><span class="sxs-lookup"><span data-stu-id="7c02d-246">In order tooset up dynamic CENC encryption, hello content management tool will use hello following inputs:</span></span>

1. <span data-ttu-id="7c02d-247">Öppna innehåll.</span><span class="sxs-lookup"><span data-stu-id="7c02d-247">Open content;</span></span>
2. <span data-ttu-id="7c02d-248">Innehållsnyckeln från nyckeln generation och hantering</span><span class="sxs-lookup"><span data-stu-id="7c02d-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="7c02d-249">Licens förvärv webbadresserna.</span><span class="sxs-lookup"><span data-stu-id="7c02d-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="7c02d-250">En lista med information från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="7c02d-251">hello utdata hello innehållshantering verktyget blir:</span><span class="sxs-lookup"><span data-stu-id="7c02d-251">hello output of hello content management tool will be:</span></span>

1. <span data-ttu-id="7c02d-252">ContentKeyAuthorizationPolicy som innehåller hello-specifikationen på hur licensleverans verifierar en JWT-token och DRM-licens specifikationerna.</span><span class="sxs-lookup"><span data-stu-id="7c02d-252">ContentKeyAuthorizationPolicy containing hello specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="7c02d-253">AssetDeliveryPolicy som innehåller specifikationer direktuppspelning format, DRM-skydd och licens förvärv URL: er.</span><span class="sxs-lookup"><span data-stu-id="7c02d-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="7c02d-254">Under körning är hello flödet som nedan:</span><span class="sxs-lookup"><span data-stu-id="7c02d-254">During runtime, hello flow is as below:</span></span>

1. <span data-ttu-id="7c02d-255">Vid autentisering av användare genereras en JWT-token;</span><span class="sxs-lookup"><span data-stu-id="7c02d-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="7c02d-256">En av hello anspråk som ingår i hello JWT-token är ”grupper” anspråk som innehåller hello objekt-ID för ”EntitledUserGroup”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-256">One of hello claims contained in hello JWT token is “groups” claim containing hello group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="7c02d-257">Denna begäran används för att skicka ”Kontrollera rätt”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="7c02d-258">Player hämtningar klienten manifestet för en CENC skyddat innehåll och ”ser” hello följande:</span><span class="sxs-lookup"><span data-stu-id="7c02d-258">Player downloads client manifest of a CENC protected content and “sees” hello following:</span></span>

   1. <span data-ttu-id="7c02d-259">nyckel-ID</span><span class="sxs-lookup"><span data-stu-id="7c02d-259">key ID,</span></span>
   2. <span data-ttu-id="7c02d-260">hello innehållet är skyddade, CENC</span><span class="sxs-lookup"><span data-stu-id="7c02d-260">hello content is CENC protected,</span></span>
   3. <span data-ttu-id="7c02d-261">Licens förvärv URL: er.</span><span class="sxs-lookup"><span data-stu-id="7c02d-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="7c02d-262">Player begär licens förvärv baserat på hello webbläsare/DRM stöds.</span><span class="sxs-lookup"><span data-stu-id="7c02d-262">Player makes a license acquisition request based on hello browser/DRM supported.</span></span> <span data-ttu-id="7c02d-263">I hello licens förvärv begäran, nyckel-ID och hello JWT skickas också token.</span><span class="sxs-lookup"><span data-stu-id="7c02d-263">In hello license acquisition request, key ID and hello JWT token will also be submitted.</span></span> <span data-ttu-id="7c02d-264">Licensleveranstjänst kontrollerar hello JWT-token och hello anspråk finns innan utfärdande hello behövs licens.</span><span class="sxs-lookup"><span data-stu-id="7c02d-264">License delivery service will verify hello JWT token and hello claims contained before issuing hello needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="7c02d-265">Implementering</span><span class="sxs-lookup"><span data-stu-id="7c02d-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="7c02d-266">Procedurer för implementering</span><span class="sxs-lookup"><span data-stu-id="7c02d-266">Implementation procedures</span></span>
<span data-ttu-id="7c02d-267">hello implementering innehåller hello följande steg:</span><span class="sxs-lookup"><span data-stu-id="7c02d-267">hello implementation will include hello following steps:</span></span>

1. <span data-ttu-id="7c02d-268">Förbereda test tillgångarna: koda/package en test video toomulti bithastighet fragmenterad MP4 i Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="7c02d-268">Prepare test asset(s): encode/package a test video toomulti-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="7c02d-269">Den här tillgången är inte DRM-skyddat.</span><span class="sxs-lookup"><span data-stu-id="7c02d-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="7c02d-270">DRM skydd kommer att göras av dynamisk protection senare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="7c02d-271">Skapa nyckel-ID och innehåll nyckel (eventuellt från viktiga startvärde).</span><span class="sxs-lookup"><span data-stu-id="7c02d-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="7c02d-272">Exemplet nyckelhanteringssystem inte behövs eftersom vi arbetar med en uppsättning med ID: T och nyckeln till ett par test tillgångar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="7c02d-273">Använd AMS API tooconfigure multi-DRM-licensleveranstjänster för hello test tillgång.</span><span class="sxs-lookup"><span data-stu-id="7c02d-273">Use AMS API tooconfigure multi-DRM license delivery services for hello test asset.</span></span> <span data-ttu-id="7c02d-274">Om du använder anpassade licensservrar av ditt företag eller företagets leverantörer i stället för licens-tjänster i Azure Media Services kan du hoppa över detta steg och ange licens förvärv URL: er i hello steg för att konfigurera licens.</span><span class="sxs-lookup"><span data-stu-id="7c02d-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in hello step for configuring license delivery.</span></span> <span data-ttu-id="7c02d-275">AMS API är nödvändiga toospecify vissa detaljerad konfigurationer, till exempel auktorisering principbegränsning licens svar mallar för olika tjänster för DRM-licens, osv. För tillfället hello Azure-portalen som inte ännu ange hello behövs Användargränssnittet för den här konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-275">AMS API is needed toospecify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, hello Azure portal does not yet provide hello needed UI for this configuration.</span></span> <span data-ttu-id="7c02d-276">Du kan hitta API-nivå info och exempelkod i Julia Kornich dokument: [med PlayReady och/eller Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="7c02d-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="7c02d-277">Använd AMS API tooconfigure tillgångsleveransprincip för hello test tillgång.</span><span class="sxs-lookup"><span data-stu-id="7c02d-277">Use AMS API tooconfigure asset delivery policy for hello test asset.</span></span> <span data-ttu-id="7c02d-278">Du kan hitta API-nivå info och exempelkod i Julia Kornich dokument: [med PlayReady och/eller Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="7c02d-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="7c02d-279">Skapa och konfigurera en Azure Active Directory-klient i Azure</span><span class="sxs-lookup"><span data-stu-id="7c02d-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="7c02d-280">Skapa några användarkonton och grupper i Azure Active Directory-klient: du bör skapa minst ”EntitledUser” och lägga till en användargrupp för toothis.</span><span class="sxs-lookup"><span data-stu-id="7c02d-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user toothis group.</span></span> <span data-ttu-id="7c02d-281">Användare i den här gruppen ska skicka rätt kontroll i licenser och användare inte i den här gruppen misslyckas toopass autentiseringskontroll och kommer inte att kunna tooacquire någon licens.</span><span class="sxs-lookup"><span data-stu-id="7c02d-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail toopass authentication check and will not be able tooacquire any license.</span></span> <span data-ttu-id="7c02d-282">Vara medlem i gruppen ”EntitledUser” är ett obligatoriskt ”grupper” anspråk i hello JWT-token som utfärdas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-282">Being a member of this “EntitledUser” group is a required “groups” claim in hello JWT token issued by Azure AD.</span></span> <span data-ttu-id="7c02d-283">Detta anspråk krav anges när du konfigurerar multi-DRM-licens leverans services steg.</span><span class="sxs-lookup"><span data-stu-id="7c02d-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="7c02d-284">Skapa en ASP.NET MVC-app som ska vara värd för din videospelare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="7c02d-285">ASP.NET-app skyddas med användarautentisering mot hello Azure Active Directory-klient.</span><span class="sxs-lookup"><span data-stu-id="7c02d-285">This ASP.NET app will be protected with user authentication against hello Azure Active Directory tenant.</span></span> <span data-ttu-id="7c02d-286">Rätt anspråk ska inkluderas i hello åtkomsttoken som erhålls efter autentisering av användare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-286">Proper claims will be included in hello access tokens obtained after user authentication.</span></span> <span data-ttu-id="7c02d-287">OpenID Connect API rekommenderas för det här steget.</span><span class="sxs-lookup"><span data-stu-id="7c02d-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="7c02d-288">Du behöver tooinstall hello följande NuGet-paket:</span><span class="sxs-lookup"><span data-stu-id="7c02d-288">You need tooinstall hello following NuGet packages:</span></span>
   * <span data-ttu-id="7c02d-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="7c02d-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="7c02d-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="7c02d-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="7c02d-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="7c02d-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="7c02d-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="7c02d-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="7c02d-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="7c02d-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="7c02d-294">Skapa en Windows Media player [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="7c02d-295">[Azure Media Player ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) kan du toospecify vilka DRM-teknik toouse på olika DRM-plattformen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you toospecify which DRM technology toouse on different DRM platform.</span></span>
9. <span data-ttu-id="7c02d-296">Testningsmatris:</span><span class="sxs-lookup"><span data-stu-id="7c02d-296">Test matrix:</span></span>

| <span data-ttu-id="7c02d-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="7c02d-297">**DRM**</span></span> | <span data-ttu-id="7c02d-298">**Webbläsare**</span><span class="sxs-lookup"><span data-stu-id="7c02d-298">**Browser**</span></span> | <span data-ttu-id="7c02d-299">**Resultat för rätt användare**</span><span class="sxs-lookup"><span data-stu-id="7c02d-299">**Result for Entitled User**</span></span> | <span data-ttu-id="7c02d-300">**Resultat för icke rätt användare**</span><span class="sxs-lookup"><span data-stu-id="7c02d-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="7c02d-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="7c02d-301">**PlayReady**</span></span> |<span data-ttu-id="7c02d-302">MS kant eller IE11 på Windows 10</span><span class="sxs-lookup"><span data-stu-id="7c02d-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="7c02d-303">Lyckas</span><span class="sxs-lookup"><span data-stu-id="7c02d-303">Succeed</span></span> |<span data-ttu-id="7c02d-304">Misslyckas</span><span class="sxs-lookup"><span data-stu-id="7c02d-304">Fail</span></span> |
| <span data-ttu-id="7c02d-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="7c02d-305">**Widevine**</span></span> |<span data-ttu-id="7c02d-306">Chrome på Windows 10</span><span class="sxs-lookup"><span data-stu-id="7c02d-306">Chrome on Windows 10</span></span> |<span data-ttu-id="7c02d-307">Lyckas</span><span class="sxs-lookup"><span data-stu-id="7c02d-307">Succeed</span></span> |<span data-ttu-id="7c02d-308">Misslyckas</span><span class="sxs-lookup"><span data-stu-id="7c02d-308">Fail</span></span> |
| <span data-ttu-id="7c02d-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="7c02d-309">**FairPlay**</span></span> |<span data-ttu-id="7c02d-310">TBD</span><span class="sxs-lookup"><span data-stu-id="7c02d-310">TBD</span></span> | | |

<span data-ttu-id="7c02d-311">George Trifonov för Azure Media Services-teamet har skrivit en blogg som ger detaljerade anvisningar för att konfigurera Azure Active Directory för en ASP.NET MVC player app: [integrera Azure Media Services OWIN MVC baserat app med Azure Active Directory och begränsa innehåll viktiga leverans baserat på JWT anspråk](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="7c02d-312">George har skapat en blogg på [JWT-token autentisering i Azure Media Services och dynamisk kryptering](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="7c02d-313">Och här är operativsystemets [på Azure AD-integrering med Azure Media Services viktiga leverans](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="7c02d-314">Information om Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="7c02d-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="7c02d-315">Du kan hitta information för utvecklare i [Utvecklarhandbok för Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="7c02d-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="7c02d-316">Du kan hitta information för administratörer i [administrera din Azure AD-katalog](../active-directory/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="7c02d-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="7c02d-317">Vissa saker i implementering</span><span class="sxs-lookup"><span data-stu-id="7c02d-317">Some gotchas in implementation</span></span>
<span data-ttu-id="7c02d-318">Det finns vissa ”saker” i hello implementering.</span><span class="sxs-lookup"><span data-stu-id="7c02d-318">There are some “gotchas” in hello implementation.</span></span> <span data-ttu-id="7c02d-319">Förhoppningsvis hjälper hello följande lista över ”saker” dig felsöka om du stöter på problem.</span><span class="sxs-lookup"><span data-stu-id="7c02d-319">Hopefully hello following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="7c02d-320">**Utfärdaren** URL bör avslutas med **”/”**.</span><span class="sxs-lookup"><span data-stu-id="7c02d-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="7c02d-321">**Målgruppen** ska vara hello player programmet klient-ID och bör du också lägga till **”/”** hello slutet av hello utfärdar-URL.</span><span class="sxs-lookup"><span data-stu-id="7c02d-321">**Audience** should be hello player application client ID and you should also add **"/"** at hello end of hello issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="7c02d-322">I [JWT avkodarens](http://jwt.calebb.net/), bör du se **eller** och **iss** som nedan i hello JWT-token:</span><span class="sxs-lookup"><span data-stu-id="7c02d-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in hello JWT token:</span></span>

    ![1 gotcha](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="7c02d-324">Lägga till behörigheter toohello program i AAD (på fliken Konfigurera av programmet hello).</span><span class="sxs-lookup"><span data-stu-id="7c02d-324">Add Permissions toohello application in AAD (on Configure tab of hello application).</span></span> <span data-ttu-id="7c02d-325">Detta krävs för varje program (lokala och distribuerade versioner).</span><span class="sxs-lookup"><span data-stu-id="7c02d-325">This is required for each application (local and deployed versions).</span></span>

    ![2 gotcha](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="7c02d-327">Använd hello rätt utfärdaren för inställning av dynamisk CENC skydd:</span><span class="sxs-lookup"><span data-stu-id="7c02d-327">Use hello right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="7c02d-328">Det fungerar inte hello följande:</span><span class="sxs-lookup"><span data-stu-id="7c02d-328">hello following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="7c02d-329">hello GUID är hello AAD-klient-ID.</span><span class="sxs-lookup"><span data-stu-id="7c02d-329">hello GUID is hello AAD tenant ID.</span></span> <span data-ttu-id="7c02d-330">hello GUID kan hittas i slutpunkter popup-fönster i Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-330">hello GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="7c02d-331">Bevilja gruppmedlemskap anspråk privilegier.</span><span class="sxs-lookup"><span data-stu-id="7c02d-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="7c02d-332">Kontrollera att i AAD programmanifestfilen har vi hello följande</span><span class="sxs-lookup"><span data-stu-id="7c02d-332">Make sure in AAD application manifest file, we have hello following</span></span>

    <span data-ttu-id="7c02d-333">”groupMembershipClaims”: ”alla” (standardvärdet för hello är null)</span><span class="sxs-lookup"><span data-stu-id="7c02d-333">"groupMembershipClaims": "All",    (hello default value is null)</span></span>
5. <span data-ttu-id="7c02d-334">Ange rätt TokenType när du skapar begränsning krav.</span><span class="sxs-lookup"><span data-stu-id="7c02d-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="7c02d-335">Sedan lägger till stöd för JWT (AAD) dessutom tooSWT (ACS), är hello standard TokenType TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="7c02d-335">Since adding support of JWT (AAD) in addition tooSWT (ACS), hello default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="7c02d-336">Om du använder SWT/ACS måste du ange tooTokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="7c02d-336">If you use SWT/ACS, you must set tooTokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="7c02d-337">Ytterligare artiklar om implementering</span><span class="sxs-lookup"><span data-stu-id="7c02d-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="7c02d-338">Vi kommer nästa iden uss vissa ytterligare avsnitt i våra designen och implementeringen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="7c02d-339">HTTP eller HTTPS?</span><span class="sxs-lookup"><span data-stu-id="7c02d-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="7c02d-340">hello player ASP.NET MVC-program Vi byggde måste stödja hello följande:</span><span class="sxs-lookup"><span data-stu-id="7c02d-340">hello ASP.NET MVC player application we built must support hello following:</span></span>

1. <span data-ttu-id="7c02d-341">Autentisering av användare via Azure AD som måste toobe under HTTPS;</span><span class="sxs-lookup"><span data-stu-id="7c02d-341">User authentication through Azure AD which needs toobe under HTTPS;</span></span>
2. <span data-ttu-id="7c02d-342">JWT-token exchange mellan klienten och Azure AD som måste toobe under HTTPS;</span><span class="sxs-lookup"><span data-stu-id="7c02d-342">JWT token exchange between client and Azure AD which needs toobe under HTTPS;</span></span>
3. <span data-ttu-id="7c02d-343">DRM-licenser av hello-klient som är nödvändiga toobe under HTTPS om licensleverans tillhandahålls av Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="7c02d-343">DRM license acquisition by hello client which is required toobe under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="7c02d-344">Naturligtvis tvingade PlayReady produktsvit inte HTTPS för licensleverans av.</span><span class="sxs-lookup"><span data-stu-id="7c02d-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="7c02d-345">Om licensservern PlayReady är utanför Azure Media Services kan användas antingen HTTP eller HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="7c02d-346">Hello ASP.NET player-programmet kommer därför använda HTTPS som bästa praxis.</span><span class="sxs-lookup"><span data-stu-id="7c02d-346">Therefore, hello ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="7c02d-347">Detta innebär hello Azure Media Player görs på en sida under HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-347">This means hello Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="7c02d-348">Men för strömning vi föredrar HTTP måste därför vi tooconsider blandat innehåll problemet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-348">However, for streaming we prefer HTTP, hence we need tooconsider mixed content issue.</span></span>

1. <span data-ttu-id="7c02d-349">Blandat innehåll tillåts inte i webbläsaren.</span><span class="sxs-lookup"><span data-stu-id="7c02d-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="7c02d-350">Men Tillåt plugin-program som Silverlight och OSMF plugin-program för smooth och STRECK.</span><span class="sxs-lookup"><span data-stu-id="7c02d-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="7c02d-351">Blandat innehåll är en säkerhetsfunktion - detta är på grund av toohello hot av hello möjlighet tooinject skadliga JS vilket kan orsaka hello kunden data toobe i fara.</span><span class="sxs-lookup"><span data-stu-id="7c02d-351">Mixed content is a security concern - This is due toohello threat of hello ability tooinject malicious JS which can cause hello customer data toobe at risk.</span></span>  <span data-ttu-id="7c02d-352">Webbläsare blockera det som standard och hittills hello endast sätt toowork runt har hello (ursprungliga) på serversidan, tooallow alla domäner (oavsett https eller http).</span><span class="sxs-lookup"><span data-stu-id="7c02d-352">Browsers block this by default and so far hello only way toowork around it is on hello server (origin) side, tooallow all domains (regardless https or http).</span></span> <span data-ttu-id="7c02d-353">Detta är förmodligen inte bra antingen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="7c02d-354">Vi bör inte blandat innehåll: båda använda HTTP eller båda använder HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="7c02d-355">När du spelar blandat innehåll kräver silverlightSS teknisk att du avmarkerar en varning om blandat innehåll.</span><span class="sxs-lookup"><span data-stu-id="7c02d-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="7c02d-356">flashSS teknisk hanterar blandat innehåll utan blandat innehåll varning.</span><span class="sxs-lookup"><span data-stu-id="7c02d-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="7c02d-357">Om din strömningsslutpunkt skapades innan augusti 2014, stöder inte HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="7c02d-358">I det här fallet, skapa och använda en ny strömmande slutpunkt för HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="7c02d-359">I hello referens-implementering för DRM-skyddat innehåll, program och strömning inte under HTTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-359">In hello reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="7c02d-360">För att öppna innehållet hello player behöver inte ha autentisering eller licens, så att du har hello liberty toouse antingen HTTP eller HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-360">For open contents, hello player does not need authentication or license, so you have hello liberty toouse either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="7c02d-361">Azure Active Directory signering nyckelförnyelse</span><span class="sxs-lookup"><span data-stu-id="7c02d-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="7c02d-362">Det här är en viktig punkt tootake i beräkningen av implementeringen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-362">This is an important point tootake into consideration of your implementation.</span></span> <span data-ttu-id="7c02d-363">Om du anser det i din implementering, hello slutförts system så småningom att sluta fungera helt inom högst 6 veckor.</span><span class="sxs-lookup"><span data-stu-id="7c02d-363">If you do not consider this in your implementation, hello completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="7c02d-364">Azure AD använder industry standard tooestablish förtroende mellan sig själv och program med hjälp av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-364">Azure AD uses industry standard tooestablish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="7c02d-365">Mer specifikt använder Azure AD signeringsnyckel som består av en offentlig och privat nyckel.</span><span class="sxs-lookup"><span data-stu-id="7c02d-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="7c02d-366">När Azure AD skapar en säkerhetstoken som innehåller information om hello användare, är denna token signerat av Azure AD med hjälp av den privata nyckeln innan den skickas tillbaka toohello program.</span><span class="sxs-lookup"><span data-stu-id="7c02d-366">When Azure AD creates a security token that contains information about hello user, this token is signed by Azure AD using its private key before it is sent back toohello application.</span></span> <span data-ttu-id="7c02d-367">tooverify hello token är giltig och faktiskt har sitt ursprung från Azure AD, hello programmet måste verifiera hello token signatur med hjälp av hello offentlig nyckel som exponeras av Azure AD som ingår i hello klient federation Metadatadokumentet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-367">tooverify that hello token is valid and actually originated from Azure AD, hello application must validate hello token’s signature using hello public key exposed by Azure AD that is contained in hello tenant’s federation metadata document.</span></span> <span data-ttu-id="7c02d-368">Den offentliga nyckeln – och hello signeringsnyckel som härleds – är hello samma som används för alla klienter i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-368">This public key – and hello signing key from which it derives – is hello same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="7c02d-369">Detaljerad information om Azure AD-nyckelförnyelse kan hittas i hello dokument: [viktig Information om nyckeln signering förnyelse i Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="7c02d-369">Detailed info on Azure AD key rollover can be found in hello document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="7c02d-370">Mellan hello [privat-offentligt nyckelpar](https://login.microsoftonline.com/common/discovery/keys/),</span><span class="sxs-lookup"><span data-stu-id="7c02d-370">Between hello [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="7c02d-371">hello privata nyckeln används av Azure Active Directory toogenerate JWT-token;</span><span class="sxs-lookup"><span data-stu-id="7c02d-371">hello private key is used by Azure Active Directory toogenerate a JWT token;</span></span>
* <span data-ttu-id="7c02d-372">hello offentlig nyckel som används av ett program, till exempel DRM-Licensleveranstjänster i AMS tooverify hello JWT-token;</span><span class="sxs-lookup"><span data-stu-id="7c02d-372">hello public key is used by an application such as DRM License Delivery Services in AMS tooverify hello JWT token;</span></span>

<span data-ttu-id="7c02d-373">För säkerhet ändamål roterar Azure Active Directory certificate regelbundet (var 6 veckor).</span><span class="sxs-lookup"><span data-stu-id="7c02d-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="7c02d-374">Vid säkerhetsintrång, kan hello nyckelförnyelse inträffa varje gång.</span><span class="sxs-lookup"><span data-stu-id="7c02d-374">In case of security breaches, hello key rollover can occur any time.</span></span> <span data-ttu-id="7c02d-375">Hej licensleveranstjänster i AMS måste därför tooupdate hello offentlig nyckel som används som Azure AD roterar hello nyckelpar, annars misslyckas tokenautentisering i AMS och ingen licens utfärdas.</span><span class="sxs-lookup"><span data-stu-id="7c02d-375">Therefore, hello license delivery services in AMS need tooupdate hello public key used as Azure AD rotates hello key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="7c02d-376">Detta uppnås genom att ange TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument när du konfigurerar DRM-licensleveranstjänster.</span><span class="sxs-lookup"><span data-stu-id="7c02d-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="7c02d-377">Hej JWT tokenflöde är som nedan:</span><span class="sxs-lookup"><span data-stu-id="7c02d-377">hello JWT token flow is as below:</span></span>

1. <span data-ttu-id="7c02d-378">Azure AD utfärdar hello JWT-token med hello aktuella privat nyckel för en autentiserad användare;</span><span class="sxs-lookup"><span data-stu-id="7c02d-378">Azure AD will issue hello JWT token with hello current private key for an authenticated user;</span></span>
2. <span data-ttu-id="7c02d-379">När en spelare får en CENC med multi-DRM-skyddat innehåll, kommer den först lokalisera hello JWT-token som utfärdas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-379">When a player sees a CENC with multi-DRM protected content, it will first locate hello JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="7c02d-380">hello player skickar licens förvärv begäran med hello JWT-token toolicense leveranstjänster i AMS;</span><span class="sxs-lookup"><span data-stu-id="7c02d-380">hello player sends license acquisition request with hello JWT token toolicense delivery services in AMS;</span></span>
4. <span data-ttu-id="7c02d-381">Hej licensleveranstjänster i AMS använder hello aktuella giltig offentlig nyckel från Azure AD tooverify hello JWT-token innan utfärda licenser.</span><span class="sxs-lookup"><span data-stu-id="7c02d-381">hello license delivery services in AMS will use hello current/valid public key from Azure AD tooverify hello JWT token, before issuing licenses.</span></span>

<span data-ttu-id="7c02d-382">DRM-licensleveranstjänster kommer alltid kontroll av hello aktuella giltig offentlig nyckel från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-382">DRM license delivery services will always be checking for hello current/valid public key from Azure AD.</span></span> <span data-ttu-id="7c02d-383">hello offentliga nyckeln som presenteras av Azure AD kommer att hello-nyckel som används för att verifiera en JWT-token som utfärdas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-383">hello public key presented by Azure AD will be hello key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="7c02d-384">Vad händer om hello nyckelförnyelse händer efter AAD genererar en JWT-token, men innan hello JWT token skickas av spelare tooDRM licensleveranstjänster i AMS för verifiering?</span><span class="sxs-lookup"><span data-stu-id="7c02d-384">What if hello key rollover happens after AAD generates a JWT token but before hello JWT token is sent by players tooDRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="7c02d-385">Eftersom en nyckel kan återställas när som helst, finns det alltid mer än en giltig offentlig nyckel i hello federation Metadatadokumentet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-385">Because a key may be rolled at any moment, there is always more than one valid public key available in hello federation metadata document.</span></span> <span data-ttu-id="7c02d-386">Azure Media Services licensleverans kan använda någon av hello nycklar anges i hello dokument, eftersom en nyckel kan återställas snart, en annan kan dess ersättare, och så vidare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-386">Azure Media Services license delivery can use any of hello keys specified in hello document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-hello-access-token"></a><span data-ttu-id="7c02d-387">Där är hello åtkomst-Token?</span><span class="sxs-lookup"><span data-stu-id="7c02d-387">Where is hello Access Token?</span></span>
<span data-ttu-id="7c02d-388">Om du tittar på hur en webbapp anropar en API-app under [Programidentitet med OAuth 2.0 klientens autentiseringsuppgifter Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello autentiseringsflödet är som nedan:</span><span class="sxs-lookup"><span data-stu-id="7c02d-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello authentication flow is as below:</span></span>

1. <span data-ttu-id="7c02d-389">En användare är inloggad i tooAzure AD i hello webbprogram (se hello [webbläsare tooWeb programmet](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="7c02d-389">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="7c02d-390">hello Azure AD autentiseringsslutpunkt dirigerar hello användaren agenten tillbaka toohello client-program med en Auktoriseringskoden.</span><span class="sxs-lookup"><span data-stu-id="7c02d-390">hello Azure AD authorization endpoint redirects hello user agent back toohello client application with an authorization code.</span></span> <span data-ttu-id="7c02d-391">hello användaragent returnerar auktorisering kod toohello klientprogrammets omdirigerings-URI.</span><span class="sxs-lookup"><span data-stu-id="7c02d-391">hello user agent returns authorization code toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="7c02d-392">hello webbprogrammet måste tooacquire en åtkomst-token så att den kan autentisera toohello webb-API och hämta hello önskad resurs.</span><span class="sxs-lookup"><span data-stu-id="7c02d-392">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="7c02d-393">Den gör en begäran tooAzure Annonsens tokenslutpunkten, hello autentiseringsuppgifter, klient-ID och API: er webbprogrammet ID URI.</span><span class="sxs-lookup"><span data-stu-id="7c02d-393">It makes a request tooAzure AD’s token endpoint, providing hello credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="7c02d-394">Hello auktorisering kod tooprove anger att hello användaren har godkänt.</span><span class="sxs-lookup"><span data-stu-id="7c02d-394">It presents hello authorization code tooprove that hello user has consented.</span></span>
4. <span data-ttu-id="7c02d-395">Azure AD autentiserar hello program och returnerar en JWT åtkomst-token som används toocall hello webb-API.</span><span class="sxs-lookup"><span data-stu-id="7c02d-395">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
5. <span data-ttu-id="7c02d-396">Via HTTPS använder hello webbprogrammet hello returneras JWT åtkomst-token tooadd hello JWT sträng med en ”ägar” beteckning i hello Authorization-huvud för hello begäran toohello webb-API.</span><span class="sxs-lookup"><span data-stu-id="7c02d-396">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="7c02d-397">hello webb-API verifierar sedan hello JWT-token och om verifieringen lyckas returnerar hello önskad resurs.</span><span class="sxs-lookup"><span data-stu-id="7c02d-397">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

<span data-ttu-id="7c02d-398">I det här flödet ”Programidentitet” förtroenden hello webb-API som hello web autentiserade hello programanvändare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-398">In this “application identity” flow, hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="7c02d-399">Därför kan kallas det här mönstret betrodda undersystemet.</span><span class="sxs-lookup"><span data-stu-id="7c02d-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="7c02d-400">Hej [diagram på den här sidan](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) beskriver hur auktoriseringskod bevilja flödet fungerar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-400">hello [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="7c02d-401">I licenser med tokenbegränsningar vi följer hello samma betrodda undersystemet mönster.</span><span class="sxs-lookup"><span data-stu-id="7c02d-401">In license acquisition with token restriction, we are following hello same trusted subsystem pattern.</span></span> <span data-ttu-id="7c02d-402">Och hello licensleveranstjänst i Azure Media Services är hello webb-API-resurs, hello ”backend resurs” ett webbprogram måste tooaccess.</span><span class="sxs-lookup"><span data-stu-id="7c02d-402">And hello license delivery service in Azure Media Services is hello web API resource, hello “backend resource” a web application needs tooaccess.</span></span> <span data-ttu-id="7c02d-403">Var finns så hello åtkomst-token?</span><span class="sxs-lookup"><span data-stu-id="7c02d-403">So where is hello access token?</span></span>

<span data-ttu-id="7c02d-404">Faktiskt får vi åtkomst-token från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="7c02d-405">Efter lyckad användarautentisering returneras auktoriseringskod.</span><span class="sxs-lookup"><span data-stu-id="7c02d-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="7c02d-406">hello auktoriseringskod sedan används tillsammans med klient-ID och app nyckeln tooexchange för åtkomst-token.</span><span class="sxs-lookup"><span data-stu-id="7c02d-406">hello authorization code is then used, together with client ID and app key, tooexchange for access token.</span></span> <span data-ttu-id="7c02d-407">Och hello åtkomst-token för åtkomst till en ”pekaren” programmet pekar eller som representerar Azure Media Services licensleveranstjänst.</span><span class="sxs-lookup"><span data-stu-id="7c02d-407">And hello access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="7c02d-408">Vi behöver tooregister och konfigurera hello ”pekaren” app i Azure AD med hjälp av hello stegen nedan:</span><span class="sxs-lookup"><span data-stu-id="7c02d-408">We need tooregister and configure hello “pointer” app in Azure AD by following hello steps below:</span></span>

1. <span data-ttu-id="7c02d-409">I hello Azure AD-klient</span><span class="sxs-lookup"><span data-stu-id="7c02d-409">In hello Azure AD tenant</span></span>

   * <span data-ttu-id="7c02d-410">Lägg till ett program (resurs) med inloggnings-URL:</span><span class="sxs-lookup"><span data-stu-id="7c02d-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="7c02d-411">https://[resource_name].azurewebsites.NET/ och</span><span class="sxs-lookup"><span data-stu-id="7c02d-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="7c02d-412">App-ID-URL:</span><span class="sxs-lookup"><span data-stu-id="7c02d-412">app ID URL:</span></span>

   <span data-ttu-id="7c02d-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span><span class="sxs-lookup"><span data-stu-id="7c02d-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="7c02d-414">Lägg till en ny nyckel för hello resurs app;</span><span class="sxs-lookup"><span data-stu-id="7c02d-414">Add a new key for hello resource app;</span></span>
3. <span data-ttu-id="7c02d-415">Uppdatera manifestfilen för hello app så att hello groupMembershipClaims egenskapen har hello följande värde: ”groupMembershipClaims”: ”alla”</span><span class="sxs-lookup"><span data-stu-id="7c02d-415">Update hello app manifest file so that hello groupMembershipClaims property has hello following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="7c02d-416">Lägg till hello resurs app som har lagts till i steg 1 ovan i hello Azure AD app pekar toohello player webbapp i hello avsnittet ”behörigheter tooother program”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-416">In hello Azure AD app pointing toohello player web app, in hello section “permissions tooother applications”, add hello resource app which was added in step 1 above.</span></span> <span data-ttu-id="7c02d-417">Kontrollera ”åtkomst [resource_name]” markering under ”delegerad behörighet”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="7c02d-418">Detta ger hello web app behörighet toocreate åtkomst-token för att komma åt hello resurs app.</span><span class="sxs-lookup"><span data-stu-id="7c02d-418">This gives hello web app permission toocreate access tokens for accessing hello resource app.</span></span> <span data-ttu-id="7c02d-419">Du bör göra detta för både lokala och distribuerade versionen av hello webbprogram om du utvecklar med Visual Studio och Azure webbapp.</span><span class="sxs-lookup"><span data-stu-id="7c02d-419">You should do this for both local and deployed version of hello web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="7c02d-420">Därför är hello JWT-token som utfärdas av Azure AD verkligen hello åtkomst-token för åtkomst till resursen ”pekaren”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-420">Therefore, hello JWT token issued by Azure AD is indeed hello access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="7c02d-421">Vad händer om Live Streaming?</span><span class="sxs-lookup"><span data-stu-id="7c02d-421">What about Live Streaming?</span></span>
<span data-ttu-id="7c02d-422">I hello ovan, har vår fokus på tillgångar på begäran.</span><span class="sxs-lookup"><span data-stu-id="7c02d-422">In hello above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="7c02d-423">Vad händer om direktsänd strömning?</span><span class="sxs-lookup"><span data-stu-id="7c02d-423">What about live streaming?</span></span>

<span data-ttu-id="7c02d-424">hello bra är att du kan använda exakt hello samma designen och implementeringen för att skydda direktsänd strömning i Azure Media Services genom att behandla hello tillgången som är associerad med ett program som en ”VOD tillgång”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-424">hello good news is that you can use exactly hello same design and implementation for protecting live streaming in Azure Media Services, by treating hello asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="7c02d-425">Det är särskilt välkända att toodo direktsänd strömning i Azure Media Services behöver toocreate en kanal och sedan ett program under hello-kanal.</span><span class="sxs-lookup"><span data-stu-id="7c02d-425">Specifically, it is well known that toodo live streaming in Azure Media Services, you need toocreate a channel, then a program under hello channel.</span></span> <span data-ttu-id="7c02d-426">toocreate hello programmet måste toocreate en tillgång som innehåller hello live Arkiv för hello program.</span><span class="sxs-lookup"><span data-stu-id="7c02d-426">toocreate hello program, you need toocreate an asset which will contain hello live archive for hello program.</span></span> <span data-ttu-id="7c02d-427">I ordning tooprovide CENC med multi-DRM-skydd av hello levande innehåll, behöver du toodo, är tooapply hello samma installationen/bearbetning toohello tillgång som om det var en ”VOD tillgång” innan du startar hello.</span><span class="sxs-lookup"><span data-stu-id="7c02d-427">In order tooprovide CENC with multi-DRM protection of hello live content, all you need toodo, is tooapply hello same setup/processing toohello asset as if it was a “VOD asset” before you start hello program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="7c02d-428">Nyheter om licensservrar utanför Azure Media Services?</span><span class="sxs-lookup"><span data-stu-id="7c02d-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="7c02d-429">Kunder kan ofta har investerat i licens servergruppen antingen i sina egna data center eller värdbaserad av DRM-leverantörer.</span><span class="sxs-lookup"><span data-stu-id="7c02d-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="7c02d-430">Lyckligtvis innehållsskydd för Azure Media Services kan du toooperate i hybrid läge: innehållet finns och dynamiskt skyddas i Azure Media Services medan DRM-licenser levereras av utanför Azure Media Services-servrar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-430">Fortunately, Azure Media Services Content Protection allows you toooperate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="7c02d-431">Det finns i det här fallet hello följande överväganden för ändringar:</span><span class="sxs-lookup"><span data-stu-id="7c02d-431">In this case, there are hello following considerations of changes:</span></span>

1. <span data-ttu-id="7c02d-432">hello Secure Token Service måste tooissue token som accepteras och som kan verifieras av hello licens-servergrupp.</span><span class="sxs-lookup"><span data-stu-id="7c02d-432">hello Secure Token Service needs tooissue tokens which are acceptable and can be verified by hello license server farm.</span></span> <span data-ttu-id="7c02d-433">Till exempel hello Widevine licensservrar som tillhandahålls av Axinom kräver en JWT-token som innehåller ”rätt meddelandet”.</span><span class="sxs-lookup"><span data-stu-id="7c02d-433">For example, hello Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="7c02d-434">Du måste därför toohave en STS tooissue sådana JWT-token.</span><span class="sxs-lookup"><span data-stu-id="7c02d-434">Therefore, you need toohave an STS tooissue such JWT token.</span></span> <span data-ttu-id="7c02d-435">hello författare har slutfört en sådan implementering och hello information finns i följande dokument i hello [Azure Documentation Center](https://azure.microsoft.com/documentation/): [med Axinom toodeliver Widevine-licenser tooAzure Media Services](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="7c02d-435">hello authors have completed such an implementation and you can find hello details in hello following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom toodeliver Widevine licenses tooAzure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="7c02d-436">Du behöver inte längre tooconfigure licensleveranstjänst (ContentKeyAuthorizationPolicy) i Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="7c02d-436">You no longer need tooconfigure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="7c02d-437">Vad du behöver toodo är tooprovide hello licens förvärv URL: er (för PlayReady Widevine och FairPlay) när du konfigurerar AssetDeliveryPolicy ställer in CENC med multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="7c02d-437">What you need toodo is tooprovide hello license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-toouse-a-custom-sts"></a><span data-ttu-id="7c02d-438">Vad händer om jag vill toouse anpassade STS?</span><span class="sxs-lookup"><span data-stu-id="7c02d-438">What if I want toouse a custom STS?</span></span>
<span data-ttu-id="7c02d-439">Det kan finnas flera skäl som en kund kan välja toouse en anpassad STS (Secure Token Service) för att tillhandahålla JWT-tokens.</span><span class="sxs-lookup"><span data-stu-id="7c02d-439">There could be a few reasons that a customer may choose toouse a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="7c02d-440">Vissa av dessa är:</span><span class="sxs-lookup"><span data-stu-id="7c02d-440">Some of them are:</span></span>

1. <span data-ttu-id="7c02d-441">hello identitet Provider (IDP) används av kunden hello stöder inte STS.</span><span class="sxs-lookup"><span data-stu-id="7c02d-441">hello Identity Provider (IDP) used by hello customer does not support STS.</span></span> <span data-ttu-id="7c02d-442">I det här fallet kan en anpassad STS vara ett alternativ.</span><span class="sxs-lookup"><span data-stu-id="7c02d-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="7c02d-443">hello kunden behöva flexibla eller strängare kontroll i integrera STS med kundens prenumeranten faktureringssystem.</span><span class="sxs-lookup"><span data-stu-id="7c02d-443">hello customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="7c02d-444">Till exempel operatör MVPD kan erbjuda flera OTT prenumeranten paket som premium och basic, sport kan etc. hello operatorn toomatch hello anspråk i en token med en prenumerant paketet så att endast innehållet i det högra hello-paketet har frigjorts.</span><span class="sxs-lookup"><span data-stu-id="7c02d-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. hello operator may want toomatch hello claims in a token with a subscriber’s package so that only contents in hello right package is made available.</span></span> <span data-ttu-id="7c02d-445">I det här fallet ger en anpassad STS hello behövs flexibilitet och kontroll.</span><span class="sxs-lookup"><span data-stu-id="7c02d-445">In this case, a custom STS provides hello needed flexibility and control.</span></span>

<span data-ttu-id="7c02d-446">Två ändringar behöver toobe görs när du använder en anpassad STS:</span><span class="sxs-lookup"><span data-stu-id="7c02d-446">Two changes need toobe made when using a custom STS:</span></span>

1. <span data-ttu-id="7c02d-447">När du konfigurerar licensleveranstjänst för en tillgång behöver toospecify hello säkerhetsnyckeln används för verifiering av hello anpassade STS (Mer information finns nedan) i stället för hello aktuella nyckeln från Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7c02d-447">When configuring license delivery service for an asset, you need toospecify hello security key used for verification by hello custom STS (more details below) instead of hello current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="7c02d-448">När en JTW-token genereras har en säkerhetsnyckel angetts i stället för hello privat nyckel för hello aktuella X509 certifikat i Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7c02d-448">When a JTW token is generated, a security key is specified instead of hello private key of hello current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="7c02d-449">Det finns två typer av säkerhetsnycklar:</span><span class="sxs-lookup"><span data-stu-id="7c02d-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="7c02d-450">Symmetrisk nyckel: hello samma nyckel används för både generera och verifiera en JWT-token;</span><span class="sxs-lookup"><span data-stu-id="7c02d-450">Symmetric key: hello same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="7c02d-451">Asymmetrisk nyckel: ett privat-offentligt nyckelpar i X509 används certifikat med privat nyckel för att kryptera/Generera en JWT-token och hello offentlig nyckel för att verifiera hello-token.</span><span class="sxs-lookup"><span data-stu-id="7c02d-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and hello public key for verifying hello token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="7c02d-452">Teknisk kommentar</span><span class="sxs-lookup"><span data-stu-id="7c02d-452">Tech note</span></span>
<span data-ttu-id="7c02d-453">Om du använder .NET Framework / C# som utvecklingsplattform för hello X509 certifikat som används för asymmetrisk säkerhetsnyckeln måste ha en nyckellängd på minst 2048.</span><span class="sxs-lookup"><span data-stu-id="7c02d-453">If you use .NET Framework/C# as your development platform, hello X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="7c02d-454">Detta är ett krav för hello klass System.IdentityModel.Tokens.X509AsymmetricSecurityKey i .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="7c02d-454">This is a requirement of hello class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="7c02d-455">I annat fall genereras hello följande undantag:</span><span class="sxs-lookup"><span data-stu-id="7c02d-455">Otherwise, hello following exception will be thrown:</span></span>

<span data-ttu-id="7c02d-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' för signering får inte vara mindre än '2048-bitar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="hello-completed-system-and-test"></a><span data-ttu-id="7c02d-457">hello slutförts system och testning</span><span class="sxs-lookup"><span data-stu-id="7c02d-457">hello completed system and test</span></span>
<span data-ttu-id="7c02d-458">Går igenom några scenarier i hello slutförts slutpunkt till slutpunkt systemet så att läsare kan ha en grundläggande ”bild” hello beteenden innan du hämtar ett inloggningskonto.</span><span class="sxs-lookup"><span data-stu-id="7c02d-458">We will walk through a few scenarios in hello completed end-to-end system so that readers can have a basic “picture” of hello behavior before getting a login account.</span></span>

<span data-ttu-id="7c02d-459">hello player-webbprogram och dess inloggningen finns [här](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="7c02d-459">hello player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="7c02d-460">Om du behöver är ”icke-integrerade” scenario: video tillgångar finns i Azure Media Services som är antingen oskyddade eller DRM-skyddat men utan token autentisering (utfärdar en licens toowhoever som begär den), du kan testa den utan inloggning (genom att växla tooHTTP om din videoströmning är över HTTP).</span><span class="sxs-lookup"><span data-stu-id="7c02d-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license toowhoever requesting it), you can test it without login (by switching tooHTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="7c02d-461">Om du behöver är integrerad slutpunkt till slutpunkt-scenario: video tillgångar är under dynamisk DRM-skydd i Azure Media Services med token autentisering och JWT-token som genereras av Azure AD, måste du toologin.</span><span class="sxs-lookup"><span data-stu-id="7c02d-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need toologin.</span></span>

### <a name="user-login"></a><span data-ttu-id="7c02d-462">Användarinloggning</span><span class="sxs-lookup"><span data-stu-id="7c02d-462">User login</span></span>
<span data-ttu-id="7c02d-463">I ordning tootest hello slutpunkt till slutpunkt integrerad DRM-systemet behöver du toohave en ”konto” har skapats eller lagts till.</span><span class="sxs-lookup"><span data-stu-id="7c02d-463">In order tootest hello end-to-end integrated DRM system, you need toohave an “account” created or added.</span></span>

<span data-ttu-id="7c02d-464">Vilket konto?</span><span class="sxs-lookup"><span data-stu-id="7c02d-464">What account?</span></span>

<span data-ttu-id="7c02d-465">Även om Azure ursprungligen åtkomst endast av Microsoft-kontoanvändare, kan nu åtkomst av användare från båda systemen.</span><span class="sxs-lookup"><span data-stu-id="7c02d-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="7c02d-466">Detta görs genom att låta alla hello Azure egenskaper att lita på Azure AD för autentisering med Azure AD autentisera organisationsanvändare och genom att skapa en federationsrelation där Azure AD litar på konsumentidentitetssystemet för hello Microsoft-konto tooauthenticate konsumentanvändare.</span><span class="sxs-lookup"><span data-stu-id="7c02d-466">This was done by having all hello Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts hello Microsoft account consumer identity system tooauthenticate consumer users.</span></span> <span data-ttu-id="7c02d-467">Därför är Azure AD kan tooauthenticate ”Microsoft-gästkonton samt” interna ”Azure AD-konton.</span><span class="sxs-lookup"><span data-stu-id="7c02d-467">As a result, Azure AD is able tooauthenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="7c02d-468">Eftersom Azure AD litar på Microsoft-konto (MSA)-domän, kan du lägga till alla konton från någon av hello följande domäner toohello anpassad Azure AD-klient och använda hello konto toologin:</span><span class="sxs-lookup"><span data-stu-id="7c02d-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of hello following domains toohello custom Azure AD tenant and use hello account toologin:</span></span>

| <span data-ttu-id="7c02d-469">**Domännamn**</span><span class="sxs-lookup"><span data-stu-id="7c02d-469">**Domain Name**</span></span> | <span data-ttu-id="7c02d-470">**Domän**</span><span class="sxs-lookup"><span data-stu-id="7c02d-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="7c02d-471">**Anpassad Azure AD-klient domän**</span><span class="sxs-lookup"><span data-stu-id="7c02d-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="7c02d-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="7c02d-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="7c02d-473">**Företagets domän**</span><span class="sxs-lookup"><span data-stu-id="7c02d-473">**Corporate domain**</span></span> |<span data-ttu-id="7c02d-474">Microsoft.com</span><span class="sxs-lookup"><span data-stu-id="7c02d-474">microsoft.com</span></span> |
| <span data-ttu-id="7c02d-475">**Microsoft-konto (MSA)-domän**</span><span class="sxs-lookup"><span data-stu-id="7c02d-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="7c02d-476">Outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="7c02d-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="7c02d-477">Du kan kontakta någon av hello författare toohave ett konto som har skapats eller lagts till för dig.</span><span class="sxs-lookup"><span data-stu-id="7c02d-477">You may contact any of hello authors toohave an account created or added for you.</span></span>

<span data-ttu-id="7c02d-478">Nedan finns hello skärmdumpar av olika inloggningssidor som används av olika domänkonton.</span><span class="sxs-lookup"><span data-stu-id="7c02d-478">Below are hello screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="7c02d-479">**Anpassad Azure AD-klient domänkonto**: I detta fall kan du se hello anpassade inloggningssidan i hello anpassad Azure AD-klient domän.</span><span class="sxs-lookup"><span data-stu-id="7c02d-479">**Custom Azure AD tenant domain account**: In this case, you see hello customized login page of hello custom Azure AD tenant domain.</span></span>

![Domänkonto för anpassad Azure AD-klient](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="7c02d-481">**Microsoft domänkonto med smartkort**: I det här fallet visas hello inloggningssidan anpassade genom Microsoft företagets IT med tvåfaktorsautentisering.</span><span class="sxs-lookup"><span data-stu-id="7c02d-481">**Microsoft domain account with smart card**: In this case you see hello login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![Domänkonto för anpassad Azure AD-klient](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="7c02d-483">**Microsoft-konto (MSA)**: I detta fall kan du se hello inloggningssidan för Account för konsumenter.</span><span class="sxs-lookup"><span data-stu-id="7c02d-483">**Microsoft Account (MSA)**: In this case, you see hello login page of Microsoft Account for consumers.</span></span>

![Domänkonto för anpassad Azure AD-klient](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="7c02d-485">Använder krypterade Media-tillägg för PlayReady</span><span class="sxs-lookup"><span data-stu-id="7c02d-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="7c02d-486">På en modern webbläsare med krypterade Media tillägg (EME) för PlayReady-stöd, till exempel Internet Explorer 11 på Windows 8.1 och in och Microsoft Edge-webbläsaren på Windows 10, PlayReady hello underliggande DRM för EME.</span><span class="sxs-lookup"><span data-stu-id="7c02d-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be hello underlying DRM for EME.</span></span>

![Med hjälp av EME för PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="7c02d-488">hello mörkt player område är på grund av toohello faktum att PlayReady skydd förhindrar en gör skärmdump av skyddade video.</span><span class="sxs-lookup"><span data-stu-id="7c02d-488">hello dark player area is due toohello fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="7c02d-489">hello visar följande skärmbild hello player-plugin-program och mus/EME support.</span><span class="sxs-lookup"><span data-stu-id="7c02d-489">hello following screen shows hello player plugins and MSE/EME support.</span></span>

![Med hjälp av EME för PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="7c02d-491">EME i Microsoft Edge och Internet Explorer 11 på Windows 10 kan anropas av [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) på Windows 10-enheter som stöder den.</span><span class="sxs-lookup"><span data-stu-id="7c02d-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="7c02d-492">PlayReady SL3000 låser upp hello flödet av förbättrade premium-innehåll (4K HDR, etc.) och nya modeller för innehållsleverans (tidig fönster för förbättrat innehåll).</span><span class="sxs-lookup"><span data-stu-id="7c02d-492">PlayReady SL3000 unlocks hello flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="7c02d-493">Fokusera på hello Windows-enheter: PlayReady är hello endast DRM i hello-maskinvara som är tillgängliga på Windows-enheter (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="7c02d-493">Focus on hello Windows devices: PlayReady is hello only DRM in hello HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="7c02d-494">En strömmande tjänst kan använda PlayReady via EME eller en UWP-appen och ger en högre bildkvaliteten med PlayReady SL3000 än en annan DRM.</span><span class="sxs-lookup"><span data-stu-id="7c02d-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="7c02d-495">Normalt 2K innehåll flödar via Chrome eller Firefox och 4 K innehåll via Microsoft Edge/IE11 eller en UWP-appen på hello samma enhet (beroende på implementering och inställningar).</span><span class="sxs-lookup"><span data-stu-id="7c02d-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on hello same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="7c02d-496">Med hjälp av EME för Widevine</span><span class="sxs-lookup"><span data-stu-id="7c02d-496">Using EME for Widevine</span></span>
<span data-ttu-id="7c02d-497">På en modern webbläsare med EME/Widevine-support, till exempel Chrome 41 + på Windows 10, Windows 8.1-, Mac OS x Yosemite och Chrome för Android 4.4.4 är Google Widevines hello DRM bakom EME.</span><span class="sxs-lookup"><span data-stu-id="7c02d-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is hello DRM behind EME.</span></span>

![Med hjälp av EME för Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="7c02d-499">Observera att Widevine inte hindrar något från att göra en skärmdump av skyddade video.</span><span class="sxs-lookup"><span data-stu-id="7c02d-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Med hjälp av EME för Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="7c02d-501">Inte berättigat till användare</span><span class="sxs-lookup"><span data-stu-id="7c02d-501">Not entitled users</span></span>
<span data-ttu-id="7c02d-502">Om en användare inte är medlem i gruppen ”rätt användare” hello användaren kommer inte att kunna toopass ”rätt kontrollera” och hello multi-DRM-Licenstjänsten nekar tooissue hello begärda licens enligt nedan.</span><span class="sxs-lookup"><span data-stu-id="7c02d-502">If a user is not a member of "Entitled Users" group, hello user will not be able toopass “entitlement check” and hello multi-DRM license service will refuse tooissue hello requested license as shown below.</span></span> <span data-ttu-id="7c02d-503">hello detaljerad beskrivning är ”licens hämta misslyckades”, vilket är fungerar.</span><span class="sxs-lookup"><span data-stu-id="7c02d-503">hello detailed description is “License acquire failed”, which is as designed.</span></span>

![Icke rätt användare](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="7c02d-505">Kör anpassade Secure Token Service</span><span class="sxs-lookup"><span data-stu-id="7c02d-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="7c02d-506">Hello scenariot anpassade Secure säkerhetstokentjänst (STS) som körs utfärdas hello JWT-token av hello anpassade STS med hjälp av antingen symmetriskt eller asymmetriskt nyckel.</span><span class="sxs-lookup"><span data-stu-id="7c02d-506">For hello scenario of running custom Secure Token Service (STS), hello JWT token will be issued by hello custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="7c02d-507">hello fall med symmetriska nyckel (med hjälp av Chrome):</span><span class="sxs-lookup"><span data-stu-id="7c02d-507">hello case of using symmetric key (using Chrome):</span></span>

![Kör anpassade STS](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="7c02d-509">Hej fallet med hjälp av asymmetrisk nyckel via X509 certifikat (med Microsoft moderna webbläsare).</span><span class="sxs-lookup"><span data-stu-id="7c02d-509">hello case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![Kör anpassade STS](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="7c02d-511">I båda hello ovan fall hello användaren autentisering förblir samma – via Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-511">In both of hello above cases, user authentication stays hello same – through Azure AD.</span></span> <span data-ttu-id="7c02d-512">hello enda skillnaden är att JWT-token har utfärdats av hello anpassade STS i stället för Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7c02d-512">hello only difference is that JWT tokens are issued by hello custom STS instead of Azure AD.</span></span> <span data-ttu-id="7c02d-513">Naturligtvis när du konfigurerar skydd för dynamiska CENC hello begränsning för licensleveranstjänst anger hello JWT-token, antingen symmetriskt eller asymmetriskt nyckel.</span><span class="sxs-lookup"><span data-stu-id="7c02d-513">Of course, when configuring dynamic CENC protection, hello restriction of license delivery service specifies hello type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="7c02d-514">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="7c02d-514">Summary</span></span>
<span data-ttu-id="7c02d-515">I det här dokumentet beskrivs vi CENC med flera native DRM och åtkomstkontroll via tokenautentisering: sin design och dess implementering med Azure, Azure Media Services och Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="7c02d-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="7c02d-516">En referens design visas som innehåller alla nödvändiga hello-komponenter i ett DRM/CENC undersystem;</span><span class="sxs-lookup"><span data-stu-id="7c02d-516">A reference design is presented which contains all hello necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="7c02d-517">En referensimplementering på Azure, Azure Media Services och Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="7c02d-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="7c02d-518">Vissa avsnitt som är direkt inblandade i hello design och implementeringslösning beskrivs också.</span><span class="sxs-lookup"><span data-stu-id="7c02d-518">Some topics directly involved in hello design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="7c02d-519">Sökvägar för Media Services-utbildning</span><span class="sxs-lookup"><span data-stu-id="7c02d-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="7c02d-520">Ge feedback</span><span class="sxs-lookup"><span data-stu-id="7c02d-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 
