---
title: aaaAzure Media Services fragmenterad MP4 live infognings-specifikationen | Microsoft Docs
description: "Den här specifikationen beskriver hello-protokollet och format för fragmenterad MP4-baserade direktsänd strömning införandet för Azure Media Services. Du kan använda Azure Media Services toostream direktsända händelser och broadcast innehåll i realtid med Azure som hello molnplattform. Det här dokumentet beskriver också bästa praxis för att skapa mycket överflödiga och robusta live infognings-metoder."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="5dfcb-105">Azure Media Services fragmenterad MP4 live infognings-specifikationen</span><span class="sxs-lookup"><span data-stu-id="5dfcb-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="5dfcb-106">Den här specifikationen beskriver hello-protokollet och format för fragmenterad MP4-baserade direktsänd strömning införandet för Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="5dfcb-107">Media Services tillhandahåller en liveströmningstjänst som kunder använder toostream direktsända händelser och broadcast innehåll i realtid med Azure som hello molnplattform.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="5dfcb-108">Det här dokumentet beskriver också bästa praxis för att skapa mycket överflödiga och robusta live infognings-metoder.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="5dfcb-109">1. Överensstämmelse notation</span><span class="sxs-lookup"><span data-stu-id="5dfcb-109">1. Conformance notation</span></span>
<span data-ttu-id="5dfcb-110">hello nyckelord ”måste”, ”får inte”, ”krävs”, ”skall”, ”skall inte”, ”SHOULD”, ”bör inte”, är ”rekommenderade”, ”maj” och ”valfritt” i det här dokumentet toobe tolkas som beskrivs i RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="5dfcb-111">2. Diagram för tjänsten</span><span class="sxs-lookup"><span data-stu-id="5dfcb-111">2. Service diagram</span></span>
<span data-ttu-id="5dfcb-112">hello följande diagram visar hello övergripande arkitektur hello direktsänd strömning service i Media Services:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="5dfcb-113">En livekodare skickar live feeds toochannels som skapas och etablerats via hello Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="5dfcb-114">Kanaler, program och strömningsslutpunkter i Media Services-referensen alla hello direktsänd strömning funktioner, inklusive infogande, formatering, moln DVR, säkerhet, skalbarhet och redundans.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="5dfcb-115">Kunder kan du kan också välja toodeploy ett Azure Content Delivery Network lager mellan hello strömmande slutpunkt och hello slutpunkter på klienter.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="5dfcb-116">Klienten slutpunkter ström från hello strömmande slutpunkten med hjälp av anpassningsbar strömning av HTTP-protokoll.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="5dfcb-117">Exempel: Microsoft Smooth Streaming, dynamiska anpassningsbar strömning via HTTP (TANKSTRECK eller MPEG-DASH) och Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![infognings-flöde][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="5dfcb-119">3. Formatet för Bitstream – ISO 14496 12 fragmenterad MP4</span><span class="sxs-lookup"><span data-stu-id="5dfcb-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="5dfcb-120">hello kabelformat för direktsänd strömning mata in beskrivs i det här dokumentet är baserad på [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="5dfcb-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="5dfcb-121">En detaljerad förklaring av fragmenterad MP4-format och tillägg både för video-on-demand-filer och direktsänd strömning införandet finns [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="5dfcb-122">Live infognings-format definitioner</span><span class="sxs-lookup"><span data-stu-id="5dfcb-122">Live ingest format definitions</span></span>
<span data-ttu-id="5dfcb-123">hello beskrivs följande lista specialformat definitioner som gäller toolive mata in i Azure Media Services:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="5dfcb-124">Hej **ftyp**, **Live Manifest serverrutan**, och **moov** rutor måste skickas med varje begäran (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="5dfcb-125">Dessa rutor måste skickas hello början av hello dataströmmen och infognings-helst hello kodare måste ansluta tooresume dataströmmen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="5dfcb-126">Mer information finns i avsnittet 6 i [1].</span><span class="sxs-lookup"><span data-stu-id="5dfcb-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="5dfcb-127">[1] avsnitt 3.3.2 definierar en valfri ruta som kallas **StreamManifestBox** för live mata in.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="5dfcb-128">På grund av toohello routning logiken för hello Azure belastningsutjämnare, är med hjälp av den här rutan föråldrad.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="5dfcb-129">hello rutan får inte vara när du vill föra in till Media Services.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="5dfcb-130">Om den här rutan finns ignoreras Media Services tyst det.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="5dfcb-131">Hej **TrackFragmentExtendedHeaderBox** rutan som definierats i 3.2.3.2 i [1] måste finnas för varje fragment.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="5dfcb-132">Version 2 av hello **TrackFragmentExtendedHeaderBox** kryssrutan ska använda toogenerate media segment som har identiska URL: er i flera datacenter.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="5dfcb-133">hello fragment fältet är REQUIRED mellan datacenter växling vid fel i index-baserad strömningsformat, till exempel Apple HLS och indexbaserade MPEG-DASH.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="5dfcb-134">tooenable mellan datacenter redundans hello fragment index måste synkroniseras mellan flera kodare och ökas med 1 för varje efterföljande media fragment även över kodare omstarter eller fel.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="5dfcb-135">[1] avsnitt 3.3.6 definierar en ruta som kallas **MovieFragmentRandomAccessBox** (**mfra**) som kan skickas hello slutet av live införandet tooindicate slutet på dataströmmen (EOS) toohello kanal.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="5dfcb-136">På grund av toohello infognings-logiken för Media Services med EOS är föråldrad och hello **mfra** rutan för live införandet inte ska skickas.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="5dfcb-137">Om skickas ignoreras Media Services tyst det.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="5dfcb-138">tooreset hello tillstånd hello infognings-punkt, rekommenderar vi att du använder [kanal återställa](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="5dfcb-139">Vi rekommenderar också att du använder [programmet avslutas](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend en presentation och dataströmmen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="5dfcb-140">hello MP4 fragment varaktigheten ska vara konstant, tooreduce hello storleken på hello klientmanifesten.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="5dfcb-141">En konstant MP4 fragment varaktighet förbättrar också klienten hämta heuristik via hello Upprepa taggar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="5dfcb-142">hello varaktighet kan variera toocompensate för hastigheterna heltal.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="5dfcb-143">hello MP4 fragment varaktigheten ska vara mellan 2 och cirka 6 sekunder.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="5dfcb-144">MP4 Fragmentera tidsstämplar och index (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` och `fragment_index`) ska komma in i stigande ordning.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="5dfcb-145">Även om Media Services är flexibel tooduplicate fragment, har den begränsad möjlighet tooreorder fragment enligt toohello media tidslinje.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="5dfcb-146">4. Protokollet formatet – HTTP</span><span class="sxs-lookup"><span data-stu-id="5dfcb-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="5dfcb-147">ISO fragmenterad MP4-baserade live infognings för Media Services använder en standard tidskrävande HTTP POST-begäran tootransmit kodad media data som paketeras i fragmenterad MP4 format toohello service.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="5dfcb-148">Varje HTTP POST skickar en fullständig fragmenterad MP4 bitstream (”stream”), från hello som börjar med rubriken rutorna (**ftyp**, **Live Manifest serverrutan**, och **moov** rutor), och fortsätter med en sekvens av fragment (**moof** och **mdat** rutor).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="5dfcb-149">URL-syntax för hello HTTP POST-begäran, finns i avsnittet 9.2 i [1].</span><span class="sxs-lookup"><span data-stu-id="5dfcb-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="5dfcb-150">Ett exempel på hello POST URL är:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="5dfcb-151">Krav</span><span class="sxs-lookup"><span data-stu-id="5dfcb-151">Requirements</span></span>
<span data-ttu-id="5dfcb-152">Här följer hello detaljerade krav:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="5dfcb-153">hello kodaren ska starta hello broadcast genom att skicka en HTTP POST-begäran med en tom ”text” (nollängd innehåll) med hjälp av hello samma införandet URL.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="5dfcb-154">Detta kan hjälpa hello kodare snabbt identifiera om hello live införandet slutpunkten är giltig och om det inte finns någon autentisering eller andra villkor som krävs.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="5dfcb-155">Per HTTP-protokoll hello-server kan inte skicka tillbaka ett HTTP-svar tills hello hela förfrågan, inklusive hello POST brödtext tas emot.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="5dfcb-156">Eftersom hello tidskrävande en direktsänd händelse, utan det här steget hello kodare kanske inte kan toodetect eventuella fel tills den är klar skickar alla hello-data.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="5dfcb-157">hello kodare måste hantera fel eller autentiseringsfrågor på grund av (1).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="5dfcb-158">Om (1) lyckas med svaret 200 fortsätta.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="5dfcb-159">hello kodare måste starta en ny HTTP POST-begäran med hello fragmenterad MP4-dataström.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="5dfcb-160">hello nyttolasten måste börja med hello sidhuvud rutorna följt av fragment.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="5dfcb-161">Observera att hello **ftyp**, **Live Manifest serverrutan**, och **moov** rutorna (i ordning) måste skickas med varje begäran, även om hello kodare måste ansluta eftersom hello föregående begäran avslutades tidigare toohello slutet hello dataströmmen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="5dfcb-162">hello kodare måste använda segmentvis överföringskodning för uppladdning av, eftersom det är omöjligt toopredict hello hela innehållslängden för hello live händelse.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="5dfcb-163">När hello händelsen över, när du har skickat hello senaste fragment, måste avslutas hello kodare avslutas hello segmentvis överföringskodning meddelandesekvens (de flesta HTTP klientstackar hantera automatiskt).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="5dfcb-164">hello kodare måste vänta tills hello service tooreturn hello slutliga svarskoden och avbryta hello-anslutningen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="5dfcb-165">hello kodare får inte använda hello `Events()` substantiv enligt beskrivningen i 9.2 i [1] för live införandet till Media Services.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="5dfcb-166">Om hello HTTP POST-begäran avslutas eller tider med en TCP fel tidigare toohello end hello stream, hello-kodare måste utfärda en ny POST-begäran med hjälp av en ny anslutning och följ hello föregående krav.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="5dfcb-167">Dessutom måste hello kodare och skicka hello föregående två MP4-fragment för varje spår i hello dataströmmen och återuppta utan introduktion till en avvikelse i hello media tidslinje.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="5dfcb-168">Skicka hello två sista MP4 fragment för varje spår säkerställer att det finns inga data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="5dfcb-169">Med andra ord om en dataström som innehåller både ljud och video spåra och hello aktuell POST-begäran misslyckas, hello kodare måste ansluta och skicka hello två sista fragment för hello ljud spår, som tidigare har skickats, och två sista hello fragment för hello video spåra, som tidigare har skickats, tooensure att det finns inga data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="5dfcb-170">hello kodare måste upprätthålla en ”vidarebefordra” buffert på media fragment som skickas igen när anslutningen upprättas.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="5dfcb-171">5. tidsrymd</span><span class="sxs-lookup"><span data-stu-id="5dfcb-171">5. Timescale</span></span>
<span data-ttu-id="5dfcb-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) beskriver hello användning av tidsrymd för **SmoothStreamingMedia** (avsnittet 2.2.2.1) **StreamElement** (avsnittet 2.2.2.3) **StreamFragmentElement**(Punkt 2.2.2.6) och **LiveSMIL** (punkt 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="5dfcb-173">Om hello tidsrymd värdet inte finns, är 10 000 000 (10 MHz) hello standardvärdet används.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="5dfcb-174">Även om hello Smooth Streaming formatspecifikationen inte blockerar användningen av andra tidsrymd värden, de flesta implementeringar av encoder använda denna standardinställning värde (10 MHz) toogenerate Smooth Streaming mata in data.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="5dfcb-175">På grund av toohello [Azure Media dynamisk paketering](media-services-dynamic-packaging-overview.md) funktion, rekommenderar vi att du använder en 90-KHz tidsrymd för videoströmmar och 44,1 eller 48.1 KHz för ljudströmmar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="5dfcb-176">Om du använder olika tidsrymd värden för olika dataströmmar, måste hello dataströmmen nivå tidsrymd skickas.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="5dfcb-177">Mer information finns i [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="5dfcb-178">6. Definitionen för ”dataströmmen”</span><span class="sxs-lookup"><span data-stu-id="5dfcb-178">6. Definition of “stream”</span></span>
<span data-ttu-id="5dfcb-179">Dataströmmen är hello grundläggande åtgärd i live införandet för att skapa direktsända presentationer hantering strömmande växling vid fel och redundans scenarier.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="5dfcb-180">Dataströmmen har definierats som en unik, fragmenterad MP4-bitstream som kan innehålla en enda spåra eller flera band.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="5dfcb-181">En fullständig presentation kan innehålla en eller flera strömmar, beroende på hello konfiguration av hello livekodare.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="5dfcb-182">hello som följande exempel visar olika alternativ för att använda dataströmmar toocompose en fullständig presentation.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="5dfcb-183">**Exempel:**</span><span class="sxs-lookup"><span data-stu-id="5dfcb-183">**Example:**</span></span> 

<span data-ttu-id="5dfcb-184">En kund vill toocreate en direktsänd strömning presentation som innehåller följande ljud/video bithastighet hello:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="5dfcb-185">Video – 3000 kbit/s, 1500 kbit/s, 750 kbit/s</span><span class="sxs-lookup"><span data-stu-id="5dfcb-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="5dfcb-186">Ljud – 128 kbit/s</span><span class="sxs-lookup"><span data-stu-id="5dfcb-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="5dfcb-187">Alternativ 1: Alla spår i en dataström</span><span class="sxs-lookup"><span data-stu-id="5dfcb-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="5dfcb-188">I det här alternativet, en enda kodare genererar alla ljud/video spår och paketerar dem till en fragmenterad MP4-bitstream.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="5dfcb-189">hello fragmenterad MP4 bitstream skickas via en HTTP POST-anslutning.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="5dfcb-190">I det här exemplet finns bara en dataström för live presentationen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-190">In this example, there is only one stream for this live presentation.</span></span>

![Dataströmmar-ett spåra][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="5dfcb-192">Alternativ 2: Varje spår i en separat ström</span><span class="sxs-lookup"><span data-stu-id="5dfcb-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="5dfcb-193">I det här alternativet hello kodare placerar en spårning i varje fragment MP4-bitstream och publicerar alla hello dataströmmar över separat HTTP-anslutningar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="5dfcb-194">Detta kan göras med en kodare eller flera kodare.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="5dfcb-195">hello live införandet ser live presentationen som består av fyra dataströmmar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Dataströmmar separat spår][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="5dfcb-197">Alternativ 3: Paketera ljud spåra med hello lägsta bithastighet video spår till en dataström</span><span class="sxs-lookup"><span data-stu-id="5dfcb-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="5dfcb-198">I det här alternativet väljer hello kunden toobundle hello ljud spåra med hello lägsta bithastighet video spår i en fragment MP4 bitstream och lämna hello andra två video spår som separata dataströmmar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Spårar dataströmmar ljud och video][image4]

### <a name="summary"></a><span data-ttu-id="5dfcb-200">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="5dfcb-200">Summary</span></span>
<span data-ttu-id="5dfcb-201">Detta är inte en fullständig förteckning över alla möjliga införandet alternativ för det här exemplet.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="5dfcb-202">Som ett faktiskt stöds grupperingen spår i dataströmmar av live införandet.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="5dfcb-203">Kunder och kodare leverantörer kan välja sina egna implementeringar baserat på engineering komplexitet, kodare kapacitet och redundans och överväganden för växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="5dfcb-204">I de flesta fall är det dock bara en ljud spåra hello hela live presentationen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="5dfcb-205">Så det är viktigt tooensure hello hälsa hello infognings-dataström som innehåller hello ljud spåra. Den här beräkningen ofta resulterar i att placera hello ljud spåra i sin egen dataström (som alternativ 2) eller paketering med hello lägsta bithastighet video spår (som alternativ 3).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="5dfcb-206">Dessutom för bättre redundans och feltolerans skickar hello samma ljud spår i två olika dataströmmar (alternativ 2 med redundant ljud spår) eller sammanföra hello ljud spåra med minst två av hello lägsta bithastighet video spår (alternativ 3 med ljud paketerade i på minst två videoströmmar) rekommenderas för Direktmigrering mata in i Media Services.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="5dfcb-207">7. -Redundans</span><span class="sxs-lookup"><span data-stu-id="5dfcb-207">7. Service failover</span></span>
<span data-ttu-id="5dfcb-208">Det angivna hello karaktär för direktsänd strömning är bra redundansstöd viktiga för att säkerställa hello tillgänglighet av hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="5dfcb-209">Media Services är utformad toohandle olika typer av fel, inklusive nätverksfel, fel och problem med lagring.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="5dfcb-210">När den används tillsammans med rätt redundanslogiken från hello livekodaren sida, kan kunder uppnå en hög tillförlitlig tjänst för liveströmning från hello molnet.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="5dfcb-211">I det här avsnittet diskuterar vi tjänsten redundanssituationer.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="5dfcb-212">I det här fallet hello fel händer någonstans i hello-tjänsten och den visar sig som ett nätverksfel.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="5dfcb-213">Här följer några rekommendationer för hello kodare implementering för att hantera redundans för tjänsten:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="5dfcb-214">Använd en 10 sekunder timeout för att fastställa hello TCP-anslutning.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="5dfcb-215">Om ett försök tooestablish hello anslutningen tar längre än 10 sekunder, avbryta hello åtgärden och försök igen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="5dfcb-216">Använd en kort tidsgräns för att skicka hello HTTP-begäran meddelandet segment.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="5dfcb-217">Om hello mål MP4 fragment varaktighet N sekunder Använd en skicka-timeout mellan N och 2 N: e sekund. till exempel om hello MP4 fragment varaktighet 6 sekunder, använda en tidsgräns på 6 too12 sekunder.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="5dfcb-218">Om en timeout uppstår infognings Återställ hello anslutning, öppna en ny anslutning och återuppta ström på hello ny anslutning.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="5dfcb-219">Underhålla en rullande buffert som har fragment för hello två sista för varje spår som har och helt skickades toohello service.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="5dfcb-220">Om hello HTTP POST-begäran för en dataström avslutas eller timeout tidigare toohello slutet på dataströmmen för hello, öppna en ny anslutning och börjar en annan HTTP POST-begäran, skicka hello dataströmmen huvuden, skicka hello två sista fragment för varje spår och återuppta hello dataströmmen utan Introduktion till en avvikelse i hello media tidslinje.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="5dfcb-221">Detta minskar hello risken för dataförluster.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="5dfcb-222">Vi rekommenderar att hello-kodaren inte begränsa hello antal återförsök tooestablish en anslutning eller återuppta strömning efter ett TCP-fel har inträffat.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="5dfcb-223">Efter ett TCP-fel:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-223">After a TCP error:</span></span>
  
    <span data-ttu-id="5dfcb-224">a.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-224">a.</span></span> <span data-ttu-id="5dfcb-225">hello aktuella anslutningen måste stängas och en ny anslutning måste skapas för en ny HTTP POST-begäran.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="5dfcb-226">b.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-226">b.</span></span> <span data-ttu-id="5dfcb-227">hello nya HTTP POST URL måste vara hello samma som hello inledande POST URL.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="5dfcb-228">c.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-228">c.</span></span> <span data-ttu-id="5dfcb-229">hello nya HTTP POST måste innehålla dataströmmen huvuden (**ftyp**, **Live Manifest serverrutan**, och **moov** rutor) som är identiska toohello dataströmmen huvuden i hello inledande POST.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="5dfcb-230">d.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-230">d.</span></span> <span data-ttu-id="5dfcb-231">hello två sista fragment skickas för varje spår skickas och strömning måste fortsätta utan att en avvikelse i hello media tidslinje.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="5dfcb-232">hello MP4 fragment tidsstämplar öka kontinuerligt, även över HTTP POST-förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="5dfcb-233">hello kodaren ska avsluta hello HTTP POST-begäran om data inte skickas med en hastighet som motsvarar hello MP4 fragment varaktighet.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="5dfcb-234">En HTTP POST-begäran som inte skickar data kan förhindra Media Services snabbt kopplar från hello kodare i hello-händelse en tjänstuppdatering.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="5dfcb-235">Därför hello HTTP POST för sparse (ad signal) spårar bör vara kortvarigt och avslutar så snart hello sparse fragment skickas.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="5dfcb-236">8. kodaren växling vid fel</span><span class="sxs-lookup"><span data-stu-id="5dfcb-236">8. Encoder failover</span></span>
<span data-ttu-id="5dfcb-237">Kodaren redundans är hello andra typen av failover-scenariot som behöver åtgärdas toobe för slutpunkt till slutpunkt live strömmande leverans.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="5dfcb-238">I det här scenariot inträffar hello fel på hello kodare sida.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![kodaren växling vid fel][image5]

<span data-ttu-id="5dfcb-240">hello följande förväntningar gäller från hello live införandet slutpunkten när kodaren redundans inträffar:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="5dfcb-241">En ny instans av kodaren ska skapas toocontinue direktuppspelning, enligt beskrivningen i hello diagram (dataströmmen för 3000k video med streckad linje).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="5dfcb-242">Det gick inte att instansen hello nya kodare måste använda hello samma URL: en för HTTP POST-begäranden som hello.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="5dfcb-243">hello nya kodare POST-begäran måste innehålla hello samma fragmenterad MP4-huvud rutor som hello instans som misslyckats.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="5dfcb-244">hello nya kodare måste synkroniseras korrekt med alla andra körs kodare för hello samma live presentation toogenerate synkroniseras ljud/video prover med justerade fragment gränser.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="5dfcb-245">hello ny ström måste vara samma sak med hello tidigare stream, och utbytbara på hello sidhuvud och fragment nivåer.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="5dfcb-246">hello nya kodare försök toominimize data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="5dfcb-247">Hej `fragment_absolute_time` och `fragment_index` av media fragment bör öka från hello punkt där hello kodare senast avbröts.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="5dfcb-248">Hej `fragment_absolute_time` och `fragment_index` bör öka i ett kontinuerligt sätt, men det är tillåtna toointroduce en avvikelse om det behövs.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="5dfcb-249">Media Services ignorerar fragment som den redan har tagit emot och bearbetas, så det är bättre tooerr längs hello skicka fragment än toointroduce avbrott hello media tidslinjen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="5dfcb-250">9. kodaren redundans</span><span class="sxs-lookup"><span data-stu-id="5dfcb-250">9. Encoder redundancy</span></span>
<span data-ttu-id="5dfcb-251">För vissa viktiga live-händelser att begäran ännu högre tillgänglighet och kvalitet rekommenderar vi att du använder aktiv / aktiv-kodare tooachieve sömlös redundans med inga data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![kodaren redundans][image6]

<span data-ttu-id="5dfcb-253">Enligt beskrivningen i det här diagrammet push två grupper av kodare två kopior av varje dataström samtidigt i hello live-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="5dfcb-254">Den här inställningen stöds eftersom Media Services kan filtrera ut dubbla fragment baserat på dataström-ID och fragment tidsstämpel.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="5dfcb-255">Hej resulterande direktsänd dataström och arkivet är en enda kopia av alla hello-dataströmmar som är hello bästa möjliga aggregering från hello två källor.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="5dfcb-256">Till exempel i extrema fall hypotetiska är så länge det finns en kodare (det inte är toobe hello samma) körs vid en viss tidpunkt för varje dataström hello resulterande direktsänd dataström från hello-tjänsten kontinuerligt utan dataförlust.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="5dfcb-257">hello kraven för det här scenariot är hello nästan samma som hello krav i hello ”kodare redundans” fall, med undantag för hello hello andra uppsättning kodare med i hello samma tid som hello primära kodare.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="5dfcb-258">10. tjänsten redundans</span><span class="sxs-lookup"><span data-stu-id="5dfcb-258">10. Service redundancy</span></span>
<span data-ttu-id="5dfcb-259">För hög redundant global distributionsplatsen måste ibland du ha mellan region säkerhetskopiering toohandle regionala katastrofer.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="5dfcb-260">Expandera hello ”kodare redundans” topologi kan kunder välja toohave en redundant tjänstdistribution i en annan region som är kopplad till hello andra uppsättning kodare.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="5dfcb-261">Kunder som också kan arbeta med en innehållsleveransnätverk providern toodeploy en Global Traffic Manager framför hello två service distributioner tooseamlessly väg klienttrafik.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="5dfcb-262">hello kraven för hello kodare är hello samma som hello ”kodare redundans” fallet.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="5dfcb-263">hello endast undantaget är hello andra uppsättning kodare behov toobe pekar tooa olika live infognings-slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="5dfcb-264">hello visar följande diagram den här installationen:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-264">hello following diagram shows this setup:</span></span>

![tjänsten redundans][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="5dfcb-266">11. Särskilda typer av införandet format</span><span class="sxs-lookup"><span data-stu-id="5dfcb-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="5dfcb-267">Det här avsnittet beskriver särskilda typer av live införandet format som är utformad toohandle specifika scenarier.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="5dfcb-268">Sparse spåra</span><span class="sxs-lookup"><span data-stu-id="5dfcb-268">Sparse track</span></span>
<span data-ttu-id="5dfcb-269">När en presentation direktsänd strömning med en rich-klient-upplevelse, ofta det är nödvändigt tootransmit tid-synkroniserade händelser eller signalerar band med hello huvudsakliga media data.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="5dfcb-270">Ett exempel på detta är dynamiska live ad infogning.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="5dfcb-271">Den här typen av händelse-signalering skiljer sig från vanlig ljud/video streaming sin sparse natur.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="5dfcb-272">Med andra ord hello-signalering data vanligtvis sker inte kontinuerligt och hello-intervall kan vara svårt toopredict.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="5dfcb-273">hello begreppet sparse spåra var utformad tooingest och utsända in-band-signaling data.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="5dfcb-274">hello är följande en rekommenderad implementering för att föra in sparse spåra:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="5dfcb-275">Skapa en separat fragmenterad MP4-bitstream som innehåller endast sparse spårar utan ljud/video spår.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="5dfcb-276">I hello **Live Manifest serverrutan** enligt definitionen i avsnittet 6 i [1], använda hello *parentTrackName* toospecify hello på parameternamn hello överordnade spåra. Mer information finns i avsnittet 4.2.1.2.1.2 i [1].</span><span class="sxs-lookup"><span data-stu-id="5dfcb-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="5dfcb-277">I hello **Live Manifest serverrutan**, **manifestOutput** måste anges för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="5dfcb-278">Eftersom hello sparse hello signalering händelse, rekommenderar vi hello följande:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="5dfcb-279">a.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-279">a.</span></span> <span data-ttu-id="5dfcb-280">Hello början av hello direktsänd händelse skickar hello kodare hello första huvud rutorna toohello-tjänster hello service tooregister hello sparse spåra i hello klienten manifest.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="5dfcb-281">b.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-281">b.</span></span> <span data-ttu-id="5dfcb-282">hello kodaren ska upphöra hello HTTP POST-begäran om data inte skickas.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="5dfcb-283">En tidskrävande HTTP POST som inte skickar data kan förhindra Media Services snabbt kopplar från hello kodare hello service update eller server startas om för händelsen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="5dfcb-284">I dessa fall har hello mediaserver blockerats tillfälligt i en receive-åtgärd på hello socket.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="5dfcb-285">c.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-285">c.</span></span> <span data-ttu-id="5dfcb-286">Under hello tid signalering data inte är tillgängliga, bör hello kodare stänga hello HTTP POST-begäran.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="5dfcb-287">När hello POST-begäran är aktiv ska hello kodaren skicka data.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="5dfcb-288">d.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-288">d.</span></span> <span data-ttu-id="5dfcb-289">När du skickar sparse fragment kan hello kodare ange ett explicit content-length-huvud, om den är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="5dfcb-290">e.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-290">e.</span></span> <span data-ttu-id="5dfcb-291">När du skickar sparse fragment med en ny anslutning ska hello kodaren börja skicka från hello sidhuvud rutorna följt av nya hello-fragment.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="5dfcb-292">Detta är i de fall i vilka failover händer emellan och hello ny sparse-anslutning används etablerade tooa ny server som inte har upptäckt hello sparse spåra innan.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="5dfcb-293">f.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-293">f.</span></span> <span data-ttu-id="5dfcb-294">hello sparse spåra fragment blir tillgängliga toohello klient när hello motsvarande överordnade spåra fragment som har ett lika mycket eller större tidsstämpelvärde görs tillgängliga toohello klienten.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="5dfcb-295">Till exempel om hello sparse fragment har en tidsstämpel för t = 1000, förväntas som när hello klienten ser ”video” (förutsatt att hello överordnade spåra namn är ”video”) Fragmentera tidsstämpel 1000 eller senare, du kan ladda ned hello sparse fragment t = 1000.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="5dfcb-296">Observera att hello faktiska signal kan användas för en annan plats i hello presentation tidslinjen för den avsedda syften.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="5dfcb-297">I det här exemplet är det möjligt att hello sparse fragment av t = 1000 har en nyttolast för XML, vilket är för att infoga en annons i ett läge som ett par sekunder senare.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="5dfcb-298">g.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-298">g.</span></span> <span data-ttu-id="5dfcb-299">hello nyttolasten för sparse spåra fragment kan vara i olika format (till exempel XML, text eller binär), beroende på hello scenario.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="5dfcb-300">Redundant ljud spåra</span><span class="sxs-lookup"><span data-stu-id="5dfcb-300">Redundant audio track</span></span>
<span data-ttu-id="5dfcb-301">I ett typiskt HTTP anpassningsbar strömning scenario (till exempel Smooth Streaming eller TANKSTRECK), ofta finns bara ett ljud spår i hello hela presentationen.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="5dfcb-302">Till skillnad från video spår som har flera olika för hello klienten toochoose från felvillkor kan hello ljud spåra vara en enskild felpunkt om hello införandet av hello-dataström som innehåller hello ljud spåra har brutits.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="5dfcb-303">toosolve problemet Media Services stöder live införandet av redundanta ljud-spår.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="5dfcb-304">hello idé är att hello samma ljud spåra kan skickas flera gånger i olika dataströmmar.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="5dfcb-305">Även om hello tjänsten registrerar endast hello ljud spåra en gång i manifestet för hello-klienten, kan den använda redundant ljud spår som reserver för att hämta ljud fragment om hello primära ljud spåra har problem.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="5dfcb-306">tooingest redundant ljud spår hello kodare måste:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="5dfcb-307">Skapa hello samma ljud spåra i flera fragment MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="5dfcb-308">hello redundant ljud spårar måste vara samma sak, med hello samma fragment tidsstämplar och vara utbytbara på fragment-nivå och hello-huvud.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="5dfcb-309">Se till att ”ljud” hello-posten i hello Live Server Manifest (avsnittet 6 i [1]) är hello samma för alla redundant ljud spår.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="5dfcb-310">hello efter genomförandet rekommenderas för redundant ljud spårar:</span><span class="sxs-lookup"><span data-stu-id="5dfcb-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="5dfcb-311">Skicka varje unik ljud spår i en dataström med sig själv.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="5dfcb-312">Du kan också skicka en redundant dataström för var och en av dessa ljud spåra strömmar, där hello andra dataströmmen skiljer sig från hello först endast genom hello identifierare i hello HTTP POST-URL: {protokollet} :// {serveradress} / {publicera punkt path}/Streams({identifier}).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="5dfcb-313">Använd separata dataströmmar toosend hello två lägsta video bithastighet.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="5dfcb-314">Var och en av dessa strömmar måste även innehålla en kopia av varje unik ljud spår. När flera språk stöds ska dessa strömmar innehålla ljud spår för varje språk.</span><span class="sxs-lookup"><span data-stu-id="5dfcb-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="5dfcb-315">Använda en separat server (kodare) instanser tooencode och skicka hello redundant dataströmmar som nämns i (1) och (2).</span><span class="sxs-lookup"><span data-stu-id="5dfcb-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="5dfcb-316">Sökvägar för Media Services-utbildning</span><span class="sxs-lookup"><span data-stu-id="5dfcb-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="5dfcb-317">Ge feedback</span><span class="sxs-lookup"><span data-stu-id="5dfcb-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
