---
title: Azure Media Services fragmenterad MP4 live infognings-specifikationen | Microsoft Docs
description: "Den här specifikationen beskriver protokollet och format för fragmenterad MP4-baserade direktsänd strömning införandet för Azure Media Services. Du kan använda Azure Media Services för att strömma direktsända händelser och broadcast innehåll i realtid med hjälp av Azure som molnplattform. Det här dokumentet beskriver också bästa praxis för att skapa mycket överflödiga och robusta live infognings-metoder."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 6250b73504bec765b8299060a29e84e771791cc9
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="c0b29-105">Azure Media Services fragmenterad MP4 live infognings-specifikationen</span><span class="sxs-lookup"><span data-stu-id="c0b29-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="c0b29-106">Den här specifikationen beskriver protokollet och format för fragmenterad MP4-baserade direktsänd strömning införandet för Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="c0b29-106">This specification describes the protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="c0b29-107">Media Services tillhandahåller en liveströmningstjänst som kunder använder för att strömma direktsända händelser och broadcast innehåll i realtid med hjälp av Azure som molnplattform.</span><span class="sxs-lookup"><span data-stu-id="c0b29-107">Media Services provides a live streaming service that customers can use to stream live events and broadcast content in real time by using Azure as the cloud platform.</span></span> <span data-ttu-id="c0b29-108">Det här dokumentet beskriver också bästa praxis för att skapa mycket överflödiga och robusta live infognings-metoder.</span><span class="sxs-lookup"><span data-stu-id="c0b29-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="c0b29-109">1. Överensstämmelse notation</span><span class="sxs-lookup"><span data-stu-id="c0b29-109">1. Conformance notation</span></span>
<span data-ttu-id="c0b29-110">Nyckeln ord ”måste”, ”får inte”, ”krävs”, ”skall”, ”skall inte”, ”SHOULD”, ”bör inte”, ”rekommenderade” ”får” och ”valfritt” i det här dokumentet är tolkas som de beskrivs i RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="c0b29-110">The key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are to be interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="c0b29-111">2. Diagram för tjänsten</span><span class="sxs-lookup"><span data-stu-id="c0b29-111">2. Service diagram</span></span>
<span data-ttu-id="c0b29-112">Följande diagram visar liveströmningstjänst övergripande arkitektur i Media Services:</span><span class="sxs-lookup"><span data-stu-id="c0b29-112">The following diagram shows the high-level architecture of the live streaming service in Media Services:</span></span>

1. <span data-ttu-id="c0b29-113">En livekodare skickar live feeds till kanaler som skapas och etableras via Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="c0b29-113">A live encoder pushes live feeds to channels that are created and provisioned via the Azure Media Services SDK.</span></span>
2. <span data-ttu-id="c0b29-114">Kanaler, program och strömningsslutpunkter i Media Services hanterar alla funktioner för liveströmning, inklusive infogande, formatering, DVR, säkerhet, skalbarhet och redundans för moln.</span><span class="sxs-lookup"><span data-stu-id="c0b29-114">Channels, programs, and streaming endpoints in Media Services handle all the live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="c0b29-115">Kunder kan du kan också välja att distribuera ett Azure Content Delivery Network lager mellan den strömmande slutpunkten och klientslutpunkterna.</span><span class="sxs-lookup"><span data-stu-id="c0b29-115">Optionally, customers can choose to deploy an Azure Content Delivery Network layer between the streaming endpoint and the client endpoints.</span></span>
4. <span data-ttu-id="c0b29-116">Klienten slutpunkter ström från den strömmande slutpunkten med hjälp av anpassningsbar strömning av HTTP-protokoll.</span><span class="sxs-lookup"><span data-stu-id="c0b29-116">Client endpoints stream from the streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="c0b29-117">Exempel: Microsoft Smooth Streaming, dynamiska anpassningsbar strömning via HTTP (TANKSTRECK eller MPEG-DASH) och Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="c0b29-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![infognings-flöde][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="c0b29-119">3. Formatet för Bitstream – ISO 14496 12 fragmenterad MP4</span><span class="sxs-lookup"><span data-stu-id="c0b29-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="c0b29-120">Kabelformat för direktsänd strömning infognings som beskrivs i det här dokumentet är baserad på [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="c0b29-120">The wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="c0b29-121">En detaljerad förklaring av fragmenterad MP4-format och tillägg både för video-on-demand-filer och direktsänd strömning införandet finns [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0b29-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="c0b29-122">Live infognings-format definitioner</span><span class="sxs-lookup"><span data-stu-id="c0b29-122">Live ingest format definitions</span></span>
<span data-ttu-id="c0b29-123">I följande lista beskrivs specialformat definitioner som gäller för levande mata in i Azure Media Services:</span><span class="sxs-lookup"><span data-stu-id="c0b29-123">The following list describes special format definitions that apply to live ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="c0b29-124">Den **ftyp**, **Live Manifest serverrutan**, och **moov** rutor måste skickas med varje begäran (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="c0b29-124">The **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="c0b29-125">Dessa rutor måste skickas i början av dataströmmen och infognings-helst kodaren måste ansluta för att återuppta dataströmmen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-125">These boxes MUST be sent at the beginning of the stream and any time the encoder must reconnect to resume stream ingest.</span></span> <span data-ttu-id="c0b29-126">Mer information finns i avsnittet 6 i [1].</span><span class="sxs-lookup"><span data-stu-id="c0b29-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="c0b29-127">[1] avsnitt 3.3.2 definierar en valfri ruta som kallas **StreamManifestBox** för live mata in.</span><span class="sxs-lookup"><span data-stu-id="c0b29-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="c0b29-128">På grund av Routning logiken för Azure belastningsutjämnare är med den här rutan föråldrad.</span><span class="sxs-lookup"><span data-stu-id="c0b29-128">Due to the routing logic of the Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="c0b29-129">Rutan bör inte när du vill föra in till Media Services.</span><span class="sxs-lookup"><span data-stu-id="c0b29-129">The box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="c0b29-130">Om den här rutan finns ignoreras Media Services tyst det.</span><span class="sxs-lookup"><span data-stu-id="c0b29-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="c0b29-131">Den **TrackFragmentExtendedHeaderBox** rutan som definierats i 3.2.3.2 i [1] måste finnas för varje fragment.</span><span class="sxs-lookup"><span data-stu-id="c0b29-131">The **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="c0b29-132">Version 2 av den **TrackFragmentExtendedHeaderBox** kryssrutan ska användas för att generera media-segment som har identiska URL: er i flera datacenter.</span><span class="sxs-lookup"><span data-stu-id="c0b29-132">Version 2 of the **TrackFragmentExtendedHeaderBox** box SHOULD be used to generate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="c0b29-133">Fältet fragment index är REQUIRED mellan datacenter växling vid fel i index-baserad strömningsformat, till exempel Apple HLS och indexbaserade MPEG-DASH.</span><span class="sxs-lookup"><span data-stu-id="c0b29-133">The fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="c0b29-134">Om du vill aktivera cross-datacenter redundans fragment-index måste synkroniseras mellan flera kodare och ökas med 1 för varje efterföljande media fragment även över kodare omstarter eller fel.</span><span class="sxs-lookup"><span data-stu-id="c0b29-134">To enable cross-datacenter failover, the fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="c0b29-135">[1] avsnitt 3.3.6 definierar en ruta som kallas **MovieFragmentRandomAccessBox** (**mfra**) som kan skickas i slutet av live införandet anger slutet på dataströmmen (EOS) till kanalen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at the end of live ingestion to indicate end-of-stream (EOS) to the channel.</span></span> <span data-ttu-id="c0b29-136">På grund av infognings-logiken för Media Services med EOS är inaktuell och **mfra** rutan för live införandet inte ska skickas.</span><span class="sxs-lookup"><span data-stu-id="c0b29-136">Due to the ingest logic of Media Services, using EOS is deprecated, and the **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="c0b29-137">Om skickas ignoreras Media Services tyst det.</span><span class="sxs-lookup"><span data-stu-id="c0b29-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="c0b29-138">Du kan återställa infognings-punkt, rekommenderar vi att du använder [kanal återställa](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="c0b29-138">To reset the state of the ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="c0b29-139">Vi rekommenderar också att du använder [programmet avslutas](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) att avsluta en presentation och dataströmmen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) to end a presentation and stream.</span></span>
6. <span data-ttu-id="c0b29-140">MP4 fragment varaktigheten ska vara konstant, för att minska storleken på klientmanifesten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-140">The MP4 fragment duration SHOULD be constant, to reduce the size of the client manifests.</span></span> <span data-ttu-id="c0b29-141">En konstant MP4 fragment varaktighet förbättrar också klienten hämta heuristik med Upprepa taggar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-141">A constant MP4 fragment duration also improves client download heuristics through the use of repeat tags.</span></span> <span data-ttu-id="c0b29-142">Varaktigheten kan variera för att kompensera för hastigheterna heltal.</span><span class="sxs-lookup"><span data-stu-id="c0b29-142">The duration MAY fluctuate to compensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="c0b29-143">MP4 fragment varaktigheten ska vara mellan 2 och cirka 6 sekunder.</span><span class="sxs-lookup"><span data-stu-id="c0b29-143">The MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="c0b29-144">MP4 Fragmentera tidsstämplar och index (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` och `fragment_index`) ska komma in i stigande ordning.</span><span class="sxs-lookup"><span data-stu-id="c0b29-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="c0b29-145">Även om Media Services är motståndskraftiga mot dubbla fragment, har den begränsad möjlighet att ordna om fragment enligt media tidslinjen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-145">Although Media Services is resilient to duplicate fragments, it has limited ability to reorder fragments according to the media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="c0b29-146">4. Protokollet formatet – HTTP</span><span class="sxs-lookup"><span data-stu-id="c0b29-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="c0b29-147">ISO fragmenterad MP4-baserade live infognings för Media Services använder en standard tidskrävande HTTP POST-begäran för att överföra data för kodade media som är packade fragmenterad MP4-format till tjänsten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request to transmit encoded media data that is packaged in fragmented MP4 format to the service.</span></span> <span data-ttu-id="c0b29-148">Varje HTTP POST skickar en fullständig fragmenterad MP4 bitstream (”stream”), från början med rubriken rutor (**ftyp**, **Live Manifest serverrutan**, och **moov** rutor ), och fortsätter med en sekvens av fragment (**moof** och **mdat** rutor).</span><span class="sxs-lookup"><span data-stu-id="c0b29-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from the beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="c0b29-149">URL-syntax för HTTP POST-begäran, finns i avsnittet 9.2 i [1].</span><span class="sxs-lookup"><span data-stu-id="c0b29-149">For URL syntax for the HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="c0b29-150">Ett exempel på POST-URL är:</span><span class="sxs-lookup"><span data-stu-id="c0b29-150">An example of the POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="c0b29-151">Krav</span><span class="sxs-lookup"><span data-stu-id="c0b29-151">Requirements</span></span>
<span data-ttu-id="c0b29-152">Här följer detaljerade krav:</span><span class="sxs-lookup"><span data-stu-id="c0b29-152">Here are the detailed requirements:</span></span>

1. <span data-ttu-id="c0b29-153">Kodaren ska starta sändningen genom att skicka en HTTP POST-begäran med ett tomt ”text” (nollängd innehåll) med hjälp av samma införandet URL.</span><span class="sxs-lookup"><span data-stu-id="c0b29-153">The encoder SHOULD start the broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using the same ingestion URL.</span></span> <span data-ttu-id="c0b29-154">Detta kan hjälpa kodaren snabbt identifiera om live införandet slutpunkten är giltig och om det inte finns någon autentisering eller andra villkor som krävs.</span><span class="sxs-lookup"><span data-stu-id="c0b29-154">This can help the encoder quickly detect whether the live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="c0b29-155">Per HTTP-protokollet på servern kan inte skicka tillbaka ett HTTP-svar förrän hela begäran, inklusive POST meddelandetexten, tas emot.</span><span class="sxs-lookup"><span data-stu-id="c0b29-155">Per HTTP protocol, the server can't send back an HTTP response until the entire request, including the POST body, is received.</span></span> <span data-ttu-id="c0b29-156">Eftersom en direktsänd händelse, utan det här steget tidskrävande kanske kodaren inte kan identifiera eventuella fel tills den är klar skickar alla data.</span><span class="sxs-lookup"><span data-stu-id="c0b29-156">Given the long-running nature of a live event, without this step, the encoder might not be able to detect any error until it finishes sending all the data.</span></span>
2. <span data-ttu-id="c0b29-157">Kodaren måste hantera fel eller autentiseringsfrågor på grund av (1).</span><span class="sxs-lookup"><span data-stu-id="c0b29-157">The encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="c0b29-158">Om (1) lyckas med svaret 200 fortsätta.</span><span class="sxs-lookup"><span data-stu-id="c0b29-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="c0b29-159">Kodaren måste starta en ny HTTP POST-begäran med fragmenterad MP4-dataström.</span><span class="sxs-lookup"><span data-stu-id="c0b29-159">The encoder MUST start a new HTTP POST request with the fragmented MP4 stream.</span></span> <span data-ttu-id="c0b29-160">Nyttolasten måste börja med rutorna sidhuvud följt av fragment.</span><span class="sxs-lookup"><span data-stu-id="c0b29-160">The payload MUST start with the header boxes, followed by fragments.</span></span> <span data-ttu-id="c0b29-161">Observera att den **ftyp**, **Live Manifest serverrutan**, och **moov** rutorna (i ordning) måste skickas med varje begäran, även om kodaren måste ansluta eftersom den tidigare begäran avbröts innan slutet på dataströmmen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-161">Note that the **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if the encoder must reconnect because the previous request was terminated prior to the end of the stream.</span></span> 
4. <span data-ttu-id="c0b29-162">Kodaren måste använda chunked-överföringskodning för att ladda upp, eftersom det är omöjligt att förutsäga hela innehållslängden för direktsänd händelse.</span><span class="sxs-lookup"><span data-stu-id="c0b29-162">The encoder MUST use chunked transfer encoding for uploading, because it’s impossible to predict the entire content length of the live event.</span></span>
5. <span data-ttu-id="c0b29-163">När händelsen är över, när du har skickat det senaste fragmentet måste avslutas kodaren avslutas chunked överföringskodning meddelandesekvens (de flesta HTTP klientstackar hantera automatiskt).</span><span class="sxs-lookup"><span data-stu-id="c0b29-163">When the event is over, after sending the last fragment, the encoder MUST gracefully end the chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="c0b29-164">Kodaren måste vänta på att tjänsten för att returnera den sista svarskoden och avslutar anslutningen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-164">The encoder MUST wait for the service to return the final response code, and then terminate the connection.</span></span> 
6. <span data-ttu-id="c0b29-165">Kodaren måste inte använda den `Events()` substantiv enligt beskrivningen i 9.2 i [1] för live införandet till Media Services.</span><span class="sxs-lookup"><span data-stu-id="c0b29-165">The encoder MUST NOT use the `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="c0b29-166">Om HTTP POST-begäran avslutas eller med ett TCP-fel innan slutet på dataströmmen, måste kodaren utfärda en ny POST-begäran med hjälp av en ny anslutning och följ de föregående krav.</span><span class="sxs-lookup"><span data-stu-id="c0b29-166">If the HTTP POST request terminates or times out with a TCP error prior to the end of the stream, the encoder MUST issue a new POST request by using a new connection, and follow the preceding requirements.</span></span> <span data-ttu-id="c0b29-167">Kodaren måste dessutom skicka föregående två MP4 fragment för varje spår i dataströmmen och fortsätta utan att en avvikelse i tidslinjen för media.</span><span class="sxs-lookup"><span data-stu-id="c0b29-167">Additionally, the encoder MUST resend the previous two MP4 fragments for each track in the stream, and resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="c0b29-168">Skicka om de två sista MP4-fragment för varje spår säkerställer att det finns inga data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="c0b29-168">Resending the last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="c0b29-169">Med andra ord om en dataström som innehåller både ljud och video spåra och aktuell POST-begäran misslyckas, måste kodaren återansluta och skicka om två sista fragment för ljud spår som tidigare har skickats, och de två sista fragment för videon spåra, som tidigare har skickats, så att det finns inga data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="c0b29-169">In other words, if a stream contains both an audio and a video track, and the current POST request fails, the encoder must reconnect and resend the last two fragments for the audio track, which were previously successfully sent, and the last two fragments for the video track, which were previously successfully sent, to ensure that there is no data loss.</span></span> <span data-ttu-id="c0b29-170">Kodaren måste upprätthålla en ”vidarebefordra” buffert på media fragment som skickas igen när anslutningen upprättas.</span><span class="sxs-lookup"><span data-stu-id="c0b29-170">The encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="c0b29-171">5. tidsrymd</span><span class="sxs-lookup"><span data-stu-id="c0b29-171">5. Timescale</span></span>
<span data-ttu-id="c0b29-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) beskriver användningen av tidsrymd för **SmoothStreamingMedia** (avsnittet 2.2.2.1) **StreamElement** (avsnittet 2.2.2.3) **StreamFragmentElement**(Punkt 2.2.2.6) och **LiveSMIL** (punkt 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="c0b29-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes the usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="c0b29-173">Om tidsrymd värdet inte finns, är används standardvärdet 10 000 000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="c0b29-173">If the timescale value is not present, the default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="c0b29-174">Även om formatspecifikationen Smooth Streaming inte blockerar användningen av andra tidsrymd värden, de flesta implementeringar av encoder använda denna standardinställning värde (10 MHz) för att generera Smooth Streaming mata in data.</span><span class="sxs-lookup"><span data-stu-id="c0b29-174">Although the Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) to generate Smooth Streaming ingest data.</span></span> <span data-ttu-id="c0b29-175">På grund av att den [Azure Media dynamisk paketering](media-services-dynamic-packaging-overview.md) funktion, rekommenderar vi att du använder en 90-KHz tidsrymd för videoströmmar och 44,1 eller 48.1 KHz för ljudströmmar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-175">Due to the [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="c0b29-176">Om du använder olika tidsrymd värden för olika dataströmmar, måste dataström-nivå tidsrymd skickas.</span><span class="sxs-lookup"><span data-stu-id="c0b29-176">If different timescale values are used for different streams, the stream-level timescale MUST be sent.</span></span> <span data-ttu-id="c0b29-177">Mer information finns i [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0b29-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="c0b29-178">6. Definitionen för ”dataströmmen”</span><span class="sxs-lookup"><span data-stu-id="c0b29-178">6. Definition of “stream”</span></span>
<span data-ttu-id="c0b29-179">Dataströmmen är den grundläggande enheten av åtgärden i live införandet för att skapa direktsända presentationer hantering strömmande växling vid fel och redundans scenarier.</span><span class="sxs-lookup"><span data-stu-id="c0b29-179">Stream is the basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="c0b29-180">Dataströmmen har definierats som en unik, fragmenterad MP4-bitstream som kan innehålla en enda spåra eller flera band.</span><span class="sxs-lookup"><span data-stu-id="c0b29-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="c0b29-181">En fullständig presentation kan innehålla en eller flera strömmar, beroende på konfigurationen av direktsänd kodare.</span><span class="sxs-lookup"><span data-stu-id="c0b29-181">A full live presentation might contain one or more streams, depending on the configuration of the live encoders.</span></span> <span data-ttu-id="c0b29-182">Följande exempel visar olika alternativ för att använda dataströmmar för att skapa en fullständig presentation.</span><span class="sxs-lookup"><span data-stu-id="c0b29-182">The following examples illustrate various options of using streams to compose a full live presentation.</span></span>

<span data-ttu-id="c0b29-183">**Exempel:**</span><span class="sxs-lookup"><span data-stu-id="c0b29-183">**Example:**</span></span> 

<span data-ttu-id="c0b29-184">En kund vill skapa en direktsänd strömning presentation som innehåller följande ljud/video bithastighet:</span><span class="sxs-lookup"><span data-stu-id="c0b29-184">A customer wants to create a live streaming presentation that includes the following audio/video bitrates:</span></span>

<span data-ttu-id="c0b29-185">Video – 3000 kbit/s, 1500 kbit/s, 750 kbit/s</span><span class="sxs-lookup"><span data-stu-id="c0b29-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="c0b29-186">Ljud – 128 kbit/s</span><span class="sxs-lookup"><span data-stu-id="c0b29-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="c0b29-187">Alternativ 1: Alla spår i en dataström</span><span class="sxs-lookup"><span data-stu-id="c0b29-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="c0b29-188">I det här alternativet, en enda kodare genererar alla ljud/video spår och paketerar dem till en fragmenterad MP4-bitstream.</span><span class="sxs-lookup"><span data-stu-id="c0b29-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="c0b29-189">Fragmenterad MP4-bitstream skickas via en HTTP POST-anslutning.</span><span class="sxs-lookup"><span data-stu-id="c0b29-189">The fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="c0b29-190">I det här exemplet finns bara en dataström för live presentationen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-190">In this example, there is only one stream for this live presentation.</span></span>

![Dataströmmar-ett spåra][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="c0b29-192">Alternativ 2: Varje spår i en separat ström</span><span class="sxs-lookup"><span data-stu-id="c0b29-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="c0b29-193">I det här alternativet kodaren placerar en spårning i varje fragment MP4-bitstream och publicerar alla strömmar över separat HTTP-anslutningar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-193">In this option, the encoder puts one track into each fragment MP4 bitstream, and then posts all of the streams over separate HTTP connections.</span></span> <span data-ttu-id="c0b29-194">Detta kan göras med en kodare eller flera kodare.</span><span class="sxs-lookup"><span data-stu-id="c0b29-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="c0b29-195">Live införandet ser live presentationen som består av fyra dataströmmar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-195">The live ingestion sees this live presentation as composed of four streams.</span></span>

![Dataströmmar separat spår][image3]

### <a name="option-3-bundle-audio-track-with-the-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="c0b29-197">Alternativ 3: Paketera ljud spåra med lägsta bithastighet video spåret till en dataström</span><span class="sxs-lookup"><span data-stu-id="c0b29-197">Option 3: Bundle audio track with the lowest bitrate video track into one stream</span></span>
<span data-ttu-id="c0b29-198">I det här alternativet väljer kunden att paketera ljud spåra med lägsta bithastighet video spår i en fragment MP4 bitstream och lämna de andra två video spår som separata dataströmmar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-198">In this option, the customer chooses to bundle the audio track with the lowest-bitrate video track in one fragment MP4 bitstream, and leave the other two video tracks as separate streams.</span></span> 

![Spårar dataströmmar ljud och video][image4]

### <a name="summary"></a><span data-ttu-id="c0b29-200">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="c0b29-200">Summary</span></span>
<span data-ttu-id="c0b29-201">Detta är inte en fullständig förteckning över alla möjliga införandet alternativ för det här exemplet.</span><span class="sxs-lookup"><span data-stu-id="c0b29-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="c0b29-202">Som ett faktiskt stöds grupperingen spår i dataströmmar av live införandet.</span><span class="sxs-lookup"><span data-stu-id="c0b29-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="c0b29-203">Kunder och kodare leverantörer kan välja sina egna implementeringar baserat på engineering komplexitet, kodare kapacitet och redundans och överväganden för växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="c0b29-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="c0b29-204">I de flesta fall är det dock bara en ljud spåra för hela live presentationen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-204">However, in most cases, there is only one audio track for the entire live presentation.</span></span> <span data-ttu-id="c0b29-205">Därför är det viktigt att säkerställa infognings-dataström som innehåller ljud spåra hälsa. Den här beräkningen ofta resulterar i att placera ljud spåra i sin egen dataström (som alternativ 2) eller paketering med lägsta bithastighet video spår (som alternativ 3).</span><span class="sxs-lookup"><span data-stu-id="c0b29-205">So, it’s important to ensure the healthiness of the ingest stream that contains the audio track. This consideration often results in putting the audio track in its own stream (as in Option 2) or bundling it with the lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="c0b29-206">Dessutom för bättre redundans och feltolerans skicka samma ljud spår i två olika dataströmmar (alternativ 2 med redundant ljud spår) eller paketering ljud spåra med minst två av video spårar lägsta bithastighet (alternativ 3 med ljud paketerade i minst två videoströmmar) rekommenderas för Direktmigrering mata in i Media Services.</span><span class="sxs-lookup"><span data-stu-id="c0b29-206">Also, for better redundancy and fault tolerance, sending the same audio track in two different streams (Option 2 with redundant audio tracks) or bundling the audio track with at least two of the lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="c0b29-207">7. -Redundans</span><span class="sxs-lookup"><span data-stu-id="c0b29-207">7. Service failover</span></span>
<span data-ttu-id="c0b29-208">Hänsyn till direktsänd strömning, är stöd för bra redundans viktigt för att säkerställa tillgängligheten för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-208">Given the nature of live streaming, good failover support is critical for ensuring the availability of the service.</span></span> <span data-ttu-id="c0b29-209">Media Services har utformats för att hantera olika typer av fel, inklusive nätverksfel, fel och problem med lagring.</span><span class="sxs-lookup"><span data-stu-id="c0b29-209">Media Services is designed to handle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="c0b29-210">När den används tillsammans med rätt redundanslogiken från livekodaren sida, kan kunder uppnå en hög tillförlitlig tjänst för liveströmning från molnet.</span><span class="sxs-lookup"><span data-stu-id="c0b29-210">When used in conjunction with proper failover logic from the live encoder side, customers can achieve a highly reliable live streaming service from the cloud.</span></span>

<span data-ttu-id="c0b29-211">I det här avsnittet diskuterar vi tjänsten redundanssituationer.</span><span class="sxs-lookup"><span data-stu-id="c0b29-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="c0b29-212">I det här fallet felet sker någonstans i tjänsten och den visar sig som ett nätverksfel.</span><span class="sxs-lookup"><span data-stu-id="c0b29-212">In this case, the failure happens somewhere within the service, and it manifests itself as a network error.</span></span> <span data-ttu-id="c0b29-213">Här följer några rekommendationer för kodare implementeringen för att hantera redundans för tjänsten:</span><span class="sxs-lookup"><span data-stu-id="c0b29-213">Here are some recommendations for the encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="c0b29-214">Använd en 10 sekunder timeout för TCP-anslutningen upprättas.</span><span class="sxs-lookup"><span data-stu-id="c0b29-214">Use a 10-second timeout for establishing the TCP connection.</span></span> <span data-ttu-id="c0b29-215">Om ett försök att upprätta anslutningen tar längre än 10 sekunder, avbryta åtgärden och försök igen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-215">If an attempt to establish the connection takes longer than 10 seconds, abort the operation and try again.</span></span> 
2. <span data-ttu-id="c0b29-216">Använd en kort tidsgräns för att skicka meddelandet segment för HTTP-begäran.</span><span class="sxs-lookup"><span data-stu-id="c0b29-216">Use a short timeout for sending the HTTP request message chunks.</span></span> <span data-ttu-id="c0b29-217">Om mål MP4 fragment varaktighet N sekunder Använd en skicka-timeout mellan N och 2 N: e sekund. till exempel om MP4 fragment varaktighet 6 sekunder, använda en tidsgräns på 6 och 12 sekunder.</span><span class="sxs-lookup"><span data-stu-id="c0b29-217">If the target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if the MP4 fragment duration is 6 seconds, use a timeout of 6 to 12 seconds.</span></span> <span data-ttu-id="c0b29-218">Om en timeout uppstår, återställa anslutningen, öppna en ny anslutning och återgå till dataströmmen mata in på den nya anslutningen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-218">If a timeout occurs, reset the connection, open a new connection, and resume stream ingest on the new connection.</span></span> 
3. <span data-ttu-id="c0b29-219">Underhålla en rullande buffert som har två sista fragment för varje spår som har och helt skickades till tjänsten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-219">Maintain a rolling buffer that has the last two fragments for each track that were successfully and completely sent to the service.</span></span>  <span data-ttu-id="c0b29-220">Om HTTP POST-begäran för en dataström avslutas eller timeout före slutet på dataströmmen öppna en ny anslutning och börjar en annan HTTP POST-begäran, skicka dataströmmen huvuden, skicka de senaste två fragment för varje spår och återuppta dataströmmen utan att en d iscontinuity i tidslinjen media.</span><span class="sxs-lookup"><span data-stu-id="c0b29-220">If the HTTP POST request for a stream is terminated or times out prior to the end of the stream, open a new connection and begin another HTTP POST request, resend the stream headers, resend the last two fragments for each track, and resume the stream without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="c0b29-221">Detta minskar risken för dataförluster.</span><span class="sxs-lookup"><span data-stu-id="c0b29-221">This reduces the chance of data loss.</span></span>
4. <span data-ttu-id="c0b29-222">Vi rekommenderar att kodaren inte begränsar antalet försök att upprätta en anslutning eller återuppta strömning efter ett TCP-fel har inträffat.</span><span class="sxs-lookup"><span data-stu-id="c0b29-222">We recommend that the encoder does NOT limit the number of retries to establish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="c0b29-223">Efter ett TCP-fel:</span><span class="sxs-lookup"><span data-stu-id="c0b29-223">After a TCP error:</span></span>
  
    <span data-ttu-id="c0b29-224">a.</span><span class="sxs-lookup"><span data-stu-id="c0b29-224">a.</span></span> <span data-ttu-id="c0b29-225">Den aktuella anslutningen måste stängas och en ny anslutning måste skapas för en ny HTTP POST-begäran.</span><span class="sxs-lookup"><span data-stu-id="c0b29-225">The current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="c0b29-226">b.</span><span class="sxs-lookup"><span data-stu-id="c0b29-226">b.</span></span> <span data-ttu-id="c0b29-227">Den nya HTTP POST URL måste vara samma som den första POST-URL.</span><span class="sxs-lookup"><span data-stu-id="c0b29-227">The new HTTP POST URL MUST be the same as the initial POST URL.</span></span>
  
    <span data-ttu-id="c0b29-228">c.</span><span class="sxs-lookup"><span data-stu-id="c0b29-228">c.</span></span> <span data-ttu-id="c0b29-229">Den nya HTTP POST inkludera dataströmmen huvuden (**ftyp**, **Live Manifest serverrutan**, och **moov** rutor) som är identiska med stream-huvudena i första POST.</span><span class="sxs-lookup"><span data-stu-id="c0b29-229">The new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical to the stream headers in the initial POST.</span></span>
  
    <span data-ttu-id="c0b29-230">d.</span><span class="sxs-lookup"><span data-stu-id="c0b29-230">d.</span></span> <span data-ttu-id="c0b29-231">De två sista fragment skickas för varje spår skickas och strömning måste fortsätta utan att en avvikelse i tidslinjen för media.</span><span class="sxs-lookup"><span data-stu-id="c0b29-231">The last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="c0b29-232">MP4 fragment tidsstämplar öka kontinuerligt, även över HTTP POST-förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-232">The MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="c0b29-233">Kodaren ska avsluta HTTP POST-begäran om data inte skickas med en hastighet som motsvarar MP4 fragment varaktighet.</span><span class="sxs-lookup"><span data-stu-id="c0b29-233">The encoder SHOULD terminate the HTTP POST request if data is not being sent at a rate commensurate with the MP4 fragment duration.</span></span>  <span data-ttu-id="c0b29-234">En HTTP POST-begäran som inte skickar data kan förhindra Media Services snabbt kopplar från kodaren vid en tjänstuppdatering.</span><span class="sxs-lookup"><span data-stu-id="c0b29-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update.</span></span> <span data-ttu-id="c0b29-235">Därför HTTP POST för sparse (ad signal) spårar bör vara kortvarigt och avslutar som sparse fragment skickas.</span><span class="sxs-lookup"><span data-stu-id="c0b29-235">For this reason, the HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as the sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="c0b29-236">8. kodaren växling vid fel</span><span class="sxs-lookup"><span data-stu-id="c0b29-236">8. Encoder failover</span></span>
<span data-ttu-id="c0b29-237">Kodaren redundans är den andra typen av failover-scenariot som måste åtgärdas för slutpunkt till slutpunkt live strömmande leverans.</span><span class="sxs-lookup"><span data-stu-id="c0b29-237">Encoder failover is the second type of failover scenario that needs to be addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="c0b29-238">Felet inträffar på kodare sida i det här scenariot.</span><span class="sxs-lookup"><span data-stu-id="c0b29-238">In this scenario, the error condition occurs on the encoder side.</span></span> 

![kodaren växling vid fel][image5]

<span data-ttu-id="c0b29-240">Följande förväntningar gäller från slutpunkten live införandet när kodaren redundans inträffar:</span><span class="sxs-lookup"><span data-stu-id="c0b29-240">The following expectations apply from the live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="c0b29-241">En ny instans av kodaren ska skapas om du vill fortsätta direktuppspelning, enligt beskrivningen i diagrammet (dataströmmen för 3000k video med streckad linje).</span><span class="sxs-lookup"><span data-stu-id="c0b29-241">A new encoder instance SHOULD be created to continue streaming, as illustrated in the diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="c0b29-242">Nya kodaren måste använda samma URL för HTTP POST-begäranden som misslyckats instans.</span><span class="sxs-lookup"><span data-stu-id="c0b29-242">The new encoder MUST use the same URL for HTTP POST requests as the failed instance.</span></span>
3. <span data-ttu-id="c0b29-243">Nya kodaren POST-begäran måste innehålla samma fragmenterad MP4-huvud rutorna instans som misslyckats.</span><span class="sxs-lookup"><span data-stu-id="c0b29-243">The new encoder’s POST request MUST include the same fragmented MP4 header boxes as the failed instance.</span></span>
4. <span data-ttu-id="c0b29-244">Nya kodaren måste synkroniseras korrekt med alla andra körs kodare för samma live presentation att generera synkroniserade ljud/video prover med justerade fragment gränser.</span><span class="sxs-lookup"><span data-stu-id="c0b29-244">The new encoder MUST be properly synced with all other running encoders for the same live presentation to generate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="c0b29-245">Nya dataströmmen måste vara samma sak med föregående dataströmmen och utbytbara på rubriken och fragment.</span><span class="sxs-lookup"><span data-stu-id="c0b29-245">The new stream MUST be semantically equivalent with the previous stream, and interchangeable at the header and fragment levels.</span></span>
6. <span data-ttu-id="c0b29-246">Nya kodaren bör försöka minimera dataförlust.</span><span class="sxs-lookup"><span data-stu-id="c0b29-246">The new encoder SHOULD try to minimize data loss.</span></span> <span data-ttu-id="c0b29-247">Den `fragment_absolute_time` och `fragment_index` av media fragment bör öka från den punkt där kodaren senast avbröts.</span><span class="sxs-lookup"><span data-stu-id="c0b29-247">The `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from the point where the encoder last stopped.</span></span> <span data-ttu-id="c0b29-248">Den `fragment_absolute_time` och `fragment_index` bör öka i ett kontinuerligt sätt, men det är tillåtet att införa en avvikelse om det behövs.</span><span class="sxs-lookup"><span data-stu-id="c0b29-248">The `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible to introduce a discontinuity, if necessary.</span></span> <span data-ttu-id="c0b29-249">Media Services ignorerar fragment som den redan har tagit emot och bearbetas, så är det bättre att ta till en viss skicka fragment än att införa avbrott i tidslinjen media.</span><span class="sxs-lookup"><span data-stu-id="c0b29-249">Media Services ignores fragments that it has already received and processed, so it's better to err on the side of resending fragments than to introduce discontinuities in the media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="c0b29-250">9. kodaren redundans</span><span class="sxs-lookup"><span data-stu-id="c0b29-250">9. Encoder redundancy</span></span>
<span data-ttu-id="c0b29-251">För vissa viktiga live-händelser att begäran ännu högre tillgänglighet och kvalitet rekommenderar vi att du gör aktiv / aktiv-kodare för sömlös redundans utan att förlora data.</span><span class="sxs-lookup"><span data-stu-id="c0b29-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders to achieve seamless failover with no data loss.</span></span>

![kodaren redundans][image6]

<span data-ttu-id="c0b29-253">Enligt beskrivningen i det här diagrammet push två grupper av kodare två kopior av varje dataström samtidigt i live-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into the live service.</span></span> <span data-ttu-id="c0b29-254">Den här inställningen stöds eftersom Media Services kan filtrera ut dubbla fragment baserat på dataström-ID och fragment tidsstämpel.</span><span class="sxs-lookup"><span data-stu-id="c0b29-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="c0b29-255">Resulterande direktsänd dataström och arkivera är en enda kopia av alla dataströmmar som är den bästa möjliga aggregeringen från två källor.</span><span class="sxs-lookup"><span data-stu-id="c0b29-255">The resulting live stream and archive is a single copy of all the streams that is the best possible aggregation from the two sources.</span></span> <span data-ttu-id="c0b29-256">Till exempel i hypotetiska extrema fall så länge det finns en kodare (det inte behöver vara samma) körs vid en viss tidpunkt för varje ström, den resulterande direktsända dataströmmen från tjänsten är kontinuerligt utan dataförlust.</span><span class="sxs-lookup"><span data-stu-id="c0b29-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have to be the same one) running at any given point in time for each stream, the resulting live stream from the service is continuous without data loss.</span></span> 

<span data-ttu-id="c0b29-257">Kraven för det här scenariot är nästan desamma som kraven i ”kodare redundans” fallet, med undantaget att den andra uppsättningen kodare körs vid samma tillfälle som de primära kodare.</span><span class="sxs-lookup"><span data-stu-id="c0b29-257">The requirements for this scenario are almost the same as the requirements in the "Encoder failover" case, with the exception that the second set of encoders are running at the same time as the primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="c0b29-258">10. tjänsten redundans</span><span class="sxs-lookup"><span data-stu-id="c0b29-258">10. Service redundancy</span></span>
<span data-ttu-id="c0b29-259">För hög redundant global distributionsplatsen måste ibland du ha mellan region säkerhetskopiering ska hantera regionala katastrofer.</span><span class="sxs-lookup"><span data-stu-id="c0b29-259">For highly redundant global distribution, sometimes you must have cross-region backup to handle regional disasters.</span></span> <span data-ttu-id="c0b29-260">Expandera ”kodare redundans”-topologi kan kunder välja att en redundant tjänstdistribution i en annan region som är kopplad till den andra uppsättningen kodare.</span><span class="sxs-lookup"><span data-stu-id="c0b29-260">Expanding on the “Encoder redundancy” topology, customers can choose to have a redundant service deployment in a different region that's connected with the second set of encoders.</span></span> <span data-ttu-id="c0b29-261">Kunder kan arbeta med en innehållsleveransnätverk provider för att distribuera en Global Traffic Manager framför de två distributionerna för att skicka sömlöst klienttrafik.</span><span class="sxs-lookup"><span data-stu-id="c0b29-261">Customers also can work with a Content Delivery Network provider to deploy a Global Traffic Manager in front of the two service deployments to seamlessly route client traffic.</span></span> <span data-ttu-id="c0b29-262">Kraven för kodare är samma som ”kodare redundans”.</span><span class="sxs-lookup"><span data-stu-id="c0b29-262">The requirements for the encoders are the same as the “Encoder redundancy” case.</span></span> <span data-ttu-id="c0b29-263">Det enda undantaget är att den andra uppsättningen kodare måste vara pekar på en annan live infognings-slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-263">The only exception is that the second set of encoders needs to be pointed to a different live ingest endpoint.</span></span> <span data-ttu-id="c0b29-264">Följande diagram visar den här installationen:</span><span class="sxs-lookup"><span data-stu-id="c0b29-264">The following diagram shows this setup:</span></span>

![tjänsten redundans][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="c0b29-266">11. Särskilda typer av införandet format</span><span class="sxs-lookup"><span data-stu-id="c0b29-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="c0b29-267">Det här avsnittet beskriver särskilda typer av live införandet som utformats för att hantera specifika scenarier.</span><span class="sxs-lookup"><span data-stu-id="c0b29-267">This section discusses special types of live ingestion formats that are designed to handle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="c0b29-268">Sparse spåra</span><span class="sxs-lookup"><span data-stu-id="c0b29-268">Sparse track</span></span>
<span data-ttu-id="c0b29-269">När en presentation direktsänd strömning med en rich-klient-upplevelse, ofta det är nödvändigt att överföra tid-synkroniserade händelser eller signalerar band med huvudsakliga media-data.</span><span class="sxs-lookup"><span data-stu-id="c0b29-269">When delivering a live streaming presentation with a rich client experience, often it's necessary to transmit time-synced events or signals in-band with the main media data.</span></span> <span data-ttu-id="c0b29-270">Ett exempel på detta är dynamiska live ad infogning.</span><span class="sxs-lookup"><span data-stu-id="c0b29-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="c0b29-271">Den här typen av händelse-signalering skiljer sig från vanlig ljud/video streaming sin sparse natur.</span><span class="sxs-lookup"><span data-stu-id="c0b29-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="c0b29-272">Med andra ord signaling data sker vanligtvis inte kontinuerligt och intervallet kan vara svårt att förutse.</span><span class="sxs-lookup"><span data-stu-id="c0b29-272">In other words, the signaling data usually does not happen continuously, and the interval can be hard to predict.</span></span> <span data-ttu-id="c0b29-273">Begreppet sparse spåra har utformats för att mata in och broadcast signaling i band-data.</span><span class="sxs-lookup"><span data-stu-id="c0b29-273">The concept of sparse track was designed to ingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="c0b29-274">Följande är en rekommenderad implementering för att föra in sparse spåra:</span><span class="sxs-lookup"><span data-stu-id="c0b29-274">The following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="c0b29-275">Skapa en separat fragmenterad MP4-bitstream som innehåller endast sparse spårar utan ljud/video spår.</span><span class="sxs-lookup"><span data-stu-id="c0b29-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="c0b29-276">I den **Live Manifest serverrutan** som definieras i avsnitt 6 i [1], använda den *parentTrackName* parametern för att ange namnet på det överordnade spåret. Mer information finns i avsnittet 4.2.1.2.1.2 i [1].</span><span class="sxs-lookup"><span data-stu-id="c0b29-276">In the **Live Server Manifest Box** as defined in Section 6 in [1], use the *parentTrackName* parameter to specify the name of the parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="c0b29-277">I den **Live Manifest serverrutan**, **manifestOutput** måste anges till **SANT**.</span><span class="sxs-lookup"><span data-stu-id="c0b29-277">In the **Live Server Manifest Box**, **manifestOutput** MUST be set to **true**.</span></span>
4. <span data-ttu-id="c0b29-278">Eftersom sparse signaling händelsen, rekommenderar vi följande:</span><span class="sxs-lookup"><span data-stu-id="c0b29-278">Given the sparse nature of the signaling event, we recommended the following:</span></span>
   
    <span data-ttu-id="c0b29-279">a.</span><span class="sxs-lookup"><span data-stu-id="c0b29-279">a.</span></span> <span data-ttu-id="c0b29-280">I början av direktsänd händelse skickar kodaren rutorna första huvud tjänsten, vilket gör att tjänsten för att registrera sparse spåra i manifestet för klienten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-280">At the beginning of the live event, the encoder sends the initial header boxes to the service, which allows the service to register the sparse track in the client manifest.</span></span>
   
    <span data-ttu-id="c0b29-281">b.</span><span class="sxs-lookup"><span data-stu-id="c0b29-281">b.</span></span> <span data-ttu-id="c0b29-282">Kodaren ska upphöra HTTP POST-begäran om data inte skickas.</span><span class="sxs-lookup"><span data-stu-id="c0b29-282">The encoder SHOULD terminate the HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="c0b29-283">En tidskrävande HTTP POST som inte skickar data kan förhindra Media Services snabbt kopplar från kodaren vid service update eller server startas om.</span><span class="sxs-lookup"><span data-stu-id="c0b29-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update or server reboot.</span></span> <span data-ttu-id="c0b29-284">I dessa fall har mediaserver blockerats tillfälligt i en receive-åtgärd på socketen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-284">In these cases, the media server is temporarily blocked in a receive operation on the socket.</span></span>
   
    <span data-ttu-id="c0b29-285">c.</span><span class="sxs-lookup"><span data-stu-id="c0b29-285">c.</span></span> <span data-ttu-id="c0b29-286">Under den tid när signaling data inte är tillgänglig, kodaren SHOULD Stäng HTTP POST för begäran.</span><span class="sxs-lookup"><span data-stu-id="c0b29-286">During the time when signaling data is not available, the encoder SHOULD close the HTTP POST request.</span></span> <span data-ttu-id="c0b29-287">När POST-begäran är aktiv ska kodaren skicka data.</span><span class="sxs-lookup"><span data-stu-id="c0b29-287">While the POST request is active, the encoder SHOULD send data.</span></span>

    <span data-ttu-id="c0b29-288">d.</span><span class="sxs-lookup"><span data-stu-id="c0b29-288">d.</span></span> <span data-ttu-id="c0b29-289">När du skickar sparse fragment kan kodaren ange ett explicit content-length-huvud, om den är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="c0b29-289">When sending sparse fragments, the encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="c0b29-290">e.</span><span class="sxs-lookup"><span data-stu-id="c0b29-290">e.</span></span> <span data-ttu-id="c0b29-291">När du skickar sparse fragment med en ny anslutning ska kodaren börja skicka i rutorna sidhuvud, följt av de nya fragment.</span><span class="sxs-lookup"><span data-stu-id="c0b29-291">When sending sparse fragments with a new connection, the encoder SHOULD start sending from the header boxes, followed by the new fragments.</span></span> <span data-ttu-id="c0b29-292">Detta är i de fall där växling sker mellan och den nya sparse-anslutningen upprättas till en ny server som inte har visas sparse spåra innan.</span><span class="sxs-lookup"><span data-stu-id="c0b29-292">This is for cases in which failover happens in-between, and the new sparse connection is being established to a new server that has not seen the sparse track before.</span></span>

    <span data-ttu-id="c0b29-293">f.</span><span class="sxs-lookup"><span data-stu-id="c0b29-293">f.</span></span> <span data-ttu-id="c0b29-294">Sparse spåra fragment blir tillgängliga för klienten när motsvarande överordnade spåra-fragment som har ett lika mycket eller större tidsstämpelvärde görs tillgänglig för klienten.</span><span class="sxs-lookup"><span data-stu-id="c0b29-294">The sparse track fragment becomes available to the client when the corresponding parent track fragment that has an equal or larger timestamp value is made available to the client.</span></span> <span data-ttu-id="c0b29-295">Till exempel om sparse fragment har en tidsstämpel för t = 1000, förväntas som när klienten ser ”video” (förutsatt att namnet på överordnade spåra är ”video”) Fragmentera tidsstämpel 1000 eller senare, den kan hämta sparse fragment-t = 1000.</span><span class="sxs-lookup"><span data-stu-id="c0b29-295">For example, if the sparse fragment has a timestamp of t=1000, it is expected that after the client sees "video" (assuming the parent track name is "video") fragment timestamp 1000 or beyond, it can download the sparse fragment t=1000.</span></span> <span data-ttu-id="c0b29-296">Observera att den faktiska signalen kunde användas för en annan plats i en presentation tidslinje för den avsedda syften.</span><span class="sxs-lookup"><span data-stu-id="c0b29-296">Note that the actual signal could be used for a different position in the presentation timeline for its designated purpose.</span></span> <span data-ttu-id="c0b29-297">I det här exemplet är det möjligt som sparse fragment av t = 1000 har en nyttolast för XML, vilket är för att infoga en annons i ett läge som ett par sekunder senare.</span><span class="sxs-lookup"><span data-stu-id="c0b29-297">In this example, it’s possible that the sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="c0b29-298">g.</span><span class="sxs-lookup"><span data-stu-id="c0b29-298">g.</span></span> <span data-ttu-id="c0b29-299">Nyttolasten för sparse spåra fragment kan finnas i olika format (till exempel XML, text eller binär), beroende på scenario.</span><span class="sxs-lookup"><span data-stu-id="c0b29-299">The payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on the scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="c0b29-300">Redundant ljud spåra</span><span class="sxs-lookup"><span data-stu-id="c0b29-300">Redundant audio track</span></span>
<span data-ttu-id="c0b29-301">I ett typiskt HTTP anpassningsbar strömning scenario (till exempel Smooth Streaming eller TANKSTRECK), ofta finns bara ett ljud spår i hela presentationen.</span><span class="sxs-lookup"><span data-stu-id="c0b29-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in the entire presentation.</span></span> <span data-ttu-id="c0b29-302">Till skillnad från video spår som har flera olika för klienten i felvillkor välja kan ljud spåra vara en enskild felpunkt om införandet av strömmen som innehåller ljud spåra har brutits.</span><span class="sxs-lookup"><span data-stu-id="c0b29-302">Unlike video tracks, which have multiple quality levels for the client to choose from in error conditions, the audio track can be a single point of failure if the ingestion of the stream that contains the audio track is broken.</span></span> 

<span data-ttu-id="c0b29-303">Media Services stöder live införandet av redundanta ljud spår för att lösa problemet.</span><span class="sxs-lookup"><span data-stu-id="c0b29-303">To solve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="c0b29-304">Tanken är att samma ljud spår kan skickas flera gånger i olika dataströmmar.</span><span class="sxs-lookup"><span data-stu-id="c0b29-304">The idea is that the same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="c0b29-305">Även om tjänsten registrerar endast ljud spåra en gång i manifestet för klienten, kan den använda redundant ljud spår som reserver för att hämta ljud fragment om det primära ljud spåret har problem.</span><span class="sxs-lookup"><span data-stu-id="c0b29-305">Although the service only registers the audio track once in the client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if the primary audio track has issues.</span></span> <span data-ttu-id="c0b29-306">För att mata in redundant ljud spårar kodaren måste:</span><span class="sxs-lookup"><span data-stu-id="c0b29-306">To ingest redundant audio tracks, the encoder needs to:</span></span>

1. <span data-ttu-id="c0b29-307">Skapa samma ljud spår i flera fragment MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="c0b29-307">Create the same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="c0b29-308">Redundant ljud spårar måste vara samma sak med samma fragment tidsstämplar och vara utbytbara på rubriken och fragment.</span><span class="sxs-lookup"><span data-stu-id="c0b29-308">The redundant audio tracks MUST be semantically equivalent, with the same fragment timestamps, and be interchangeable at the header and fragment levels.</span></span>
2. <span data-ttu-id="c0b29-309">Kontrollera att posten ”ljud” i den Live Server Manifest (avsnittet 6 i [1]) är detsamma för alla redundant ljud spår.</span><span class="sxs-lookup"><span data-stu-id="c0b29-309">Ensure that the “audio” entry in the Live Server Manifest (Section 6 in [1]) is the same for all redundant audio tracks.</span></span>

<span data-ttu-id="c0b29-310">Följande implementeringen rekommenderas för redundant ljud spårar:</span><span class="sxs-lookup"><span data-stu-id="c0b29-310">The following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="c0b29-311">Skicka varje unik ljud spår i en dataström med sig själv.</span><span class="sxs-lookup"><span data-stu-id="c0b29-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="c0b29-312">Dessutom skicka en redundant dataström för var och en av dessa ljud spåra strömmar, där andra dataströmmen skiljer sig från först endast av identifieraren i HTTP POST-URL: {protokollet} :// {server address} / {publicera punkt path}/Streams({identifier}).</span><span class="sxs-lookup"><span data-stu-id="c0b29-312">Also, send a redundant stream for each of these audio track streams, where the second stream differs from the first only by the identifier in the HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="c0b29-313">Använda separata dataströmmar för att skicka två lägsta video bithastighet.</span><span class="sxs-lookup"><span data-stu-id="c0b29-313">Use separate streams to send the two lowest video bitrates.</span></span> <span data-ttu-id="c0b29-314">Var och en av dessa strömmar måste även innehålla en kopia av varje unik ljud spår. När flera språk stöds ska dessa strömmar innehålla ljud spår för varje språk.</span><span class="sxs-lookup"><span data-stu-id="c0b29-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="c0b29-315">Använda separata serverinstanser (kodare) för att koda och skicka redundant strömmar som nämns i (1) och (2).</span><span class="sxs-lookup"><span data-stu-id="c0b29-315">Use separate server (encoder) instances to encode and send the redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="c0b29-316">Sökvägar för Media Services-utbildning</span><span class="sxs-lookup"><span data-stu-id="c0b29-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="c0b29-317">Ge feedback</span><span class="sxs-lookup"><span data-stu-id="c0b29-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
