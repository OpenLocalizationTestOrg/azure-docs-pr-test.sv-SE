---
title: "aaaConfigure ett virtuellt nätverk för Premium Azure Redis-Cache | Microsoft Docs"
description: "Lär dig hur toocreate och hantera virtuella nätverk stöd för din Premium-nivån Azure Redis-Cache-instanser"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: fab715f4d9365ee4c2f8b89d2e2e58768c25b671
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="996f8-103">Hur tooconfigure för virtuella nätverk som har stöd för Premium Azure Redis-Cache</span><span class="sxs-lookup"><span data-stu-id="996f8-103">How tooconfigure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="996f8-104">Azure Redis-Cache har olika cache erbjudanden, vilket ger flexibilitet i hello valet av cachestorlek och funktioner, inklusive funktioner för Premium-nivån, till exempel klustring, beständiga och stöd för virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-104">Azure Redis Cache has different cache offerings, which provide flexibility in hello choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="996f8-105">Ett virtuellt nätverk är ett privat nätverk i hello molnet.</span><span class="sxs-lookup"><span data-stu-id="996f8-105">A VNet is a private network in hello cloud.</span></span> <span data-ttu-id="996f8-106">När en instans av Azure Redis-Cache har konfigurerats med ett VNet, är inte offentligt adresserbara och kan endast nås från virtuella datorer och program i hello virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within hello VNet.</span></span> <span data-ttu-id="996f8-107">Den här artikeln beskriver hur tooconfigure virtuella nätverket har stöd för en premium Azure Redis-Cache-instans.</span><span class="sxs-lookup"><span data-stu-id="996f8-107">This article describes how tooconfigure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="996f8-108">Azure Redis-Cache har stöd för både klassiska och Resource Manager VNets.</span><span class="sxs-lookup"><span data-stu-id="996f8-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="996f8-109">Information om andra cache premium-funktioner finns [introduktion toohello Azure Redis Cache Premium-nivån](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="996f8-109">For information on other premium cache features, see [Introduction toohello Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="996f8-110">Varför VNet?</span><span class="sxs-lookup"><span data-stu-id="996f8-110">Why VNet?</span></span>
<span data-ttu-id="996f8-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) distribution ger förbättrad säkerhet och isolering för Azure Redis-Cache, samt undernät, principer för åtkomstkontroll och andra funktioner toofurther begränsa åtkomsten.</span><span class="sxs-lookup"><span data-stu-id="996f8-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features toofurther restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="996f8-112">Stöd för virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="996f8-112">Virtual network support</span></span>
<span data-ttu-id="996f8-113">Stöd för virtuella nätverk (VNet) är konfigurerat på hello **nytt Redis-Cache** bladet under skapande av cachen.</span><span class="sxs-lookup"><span data-stu-id="996f8-113">Virtual Network (VNet) support is configured on hello **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="996f8-114">När du har valt en premium-prisnivån, du kan konfigurera Redis VNet integration genom att välja ett VNet i hello samma prenumeration och plats som ditt cacheminne.</span><span class="sxs-lookup"><span data-stu-id="996f8-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in hello same subscription and location as your cache.</span></span> <span data-ttu-id="996f8-115">toouse ett nytt virtuellt nätverk, skapa den första genom att följa stegen hello i [skapa ett virtuellt nätverk med hello Azure-portalen](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) eller [skapa ett virtuellt nätverk (klassiska) med hjälp av hello Azure-portalen](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) och returnerar sedan toohello **Nytt Redis-Cache** bladet toocreate och konfigurera din premium-cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-115">toouse a new VNet, create it first by following hello steps in [Create a virtual network using hello Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using hello Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return toohello **New Redis Cache** blade toocreate and configure your premium cache.</span></span>

<span data-ttu-id="996f8-116">tooconfigure hello VNet för ditt nya cacheminne, klickar du på **virtuellt nätverk** på hello **nytt Redis-Cache** bladet och väljer hello önskad VNet hello nedrullningsbara listan.</span><span class="sxs-lookup"><span data-stu-id="996f8-116">tooconfigure hello VNet for your new cache, click **Virtual Network** on hello **New Redis Cache** blade, and select hello desired VNet from hello drop-down list.</span></span>

![Virtuellt nätverk][redis-cache-vnet]

<span data-ttu-id="996f8-118">Välj hello önskade undernät från hello **undernät** nedrullningsbara listan, och ange önskade hello **statisk IP-adress**.</span><span class="sxs-lookup"><span data-stu-id="996f8-118">Select hello desired subnet from hello **Subnet** drop-down list, and specify hello desired **Static IP address**.</span></span> <span data-ttu-id="996f8-119">Om du använder en klassiska VNet hello **statisk IP-adress** fältet är valfritt och om inget anges en väljs från hello valda undernät.</span><span class="sxs-lookup"><span data-stu-id="996f8-119">If you are using a classic VNet hello **Static IP address** field is optional, and if none is specified, one is chosen from hello selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="996f8-120">När du distribuerar ett Azure Redis-Cache tooa Resource Manager VNet måste hello cache vara i ett dedikerat undernät som innehåller några resurser förutom Azure Redis-Cache-instanser.</span><span class="sxs-lookup"><span data-stu-id="996f8-120">When deploying an Azure Redis Cache tooa Resource Manager VNet, hello cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="996f8-121">Om ett försök görs toodeploy misslyckas en Azure Redis-Cache tooa Resource Manager VNet tooa undernät som innehåller andra resurser, hello-distribution.</span><span class="sxs-lookup"><span data-stu-id="996f8-121">If an attempt is made toodeploy an Azure Redis Cache tooa Resource Manager VNet tooa subnet that contains other resources, hello deployment fails.</span></span>
> 
> 

![Virtuellt nätverk][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="996f8-123">Azure reserverar vissa IP-adresser inom varje undernät, och dessa adresser kan inte användas.</span><span class="sxs-lookup"><span data-stu-id="996f8-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="996f8-124">hello är första och sista IP-adresser för hello undernät reserverade för överensstämmelse med protokollet, tillsammans med tre flera adresser som används för Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="996f8-124">hello first and last IP addresses of hello subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="996f8-125">Mer information finns i [finns det några begränsningar med hjälp av IP-adresser inom dessa undernät?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="996f8-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="996f8-126">I tillägg toohello IP-adresser används av hello Azure VNET infrastruktur, varje Redis-instansen i hello undernät använder två IP-adresser per Fragmentera och en ytterligare IP-adress för hello belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="996f8-126">In addition toohello IP addresses used by hello Azure VNET infrastructure, each Redis instance in hello subnet uses two IP addresses per shard and one additional IP address for hello load balancer.</span></span> <span data-ttu-id="996f8-127">En icke-klustrade cache anses toohave en Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="996f8-127">A non-clustered cache is considered toohave one shard.</span></span>
> 
> 

<span data-ttu-id="996f8-128">När hello-cache skapas, du kan visa hello konfigurationen för hello VNet genom att klicka på **virtuellt nätverk** från hello **resurs menyn**.</span><span class="sxs-lookup"><span data-stu-id="996f8-128">After hello cache is created, you can view hello configuration for hello VNet by clicking **Virtual Network** from hello **Resource menu**.</span></span>

![Virtuellt nätverk][redis-cache-vnet-info]

<span data-ttu-id="996f8-130">tooconnect tooyour Azure Redis-cache-instans när du använder ett virtuellt nätverk, ange hello värdnamnet för ditt cacheminne i hello anslutningssträngen som visas i följande exempel hello:</span><span class="sxs-lookup"><span data-stu-id="996f8-130">tooconnect tooyour Azure Redis cache instance when using a VNet, specify hello host name of your cache in hello connection string as shown in hello following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="996f8-131">Azure Redis-Cache VNet vanliga frågor och svar</span><span class="sxs-lookup"><span data-stu-id="996f8-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="996f8-132">hello följande lista innehåller svar toocommonly frågor och svar om hello Azure Redis-Cache skalning.</span><span class="sxs-lookup"><span data-stu-id="996f8-132">hello following list contains answers toocommonly asked questions about hello Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="996f8-133">Vilka är några vanliga problem med Azure Redis-Cache och Vnet?</span><span class="sxs-lookup"><span data-stu-id="996f8-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="996f8-134">Hur kan jag bekräfta att min cache fungerar i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="996f8-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="996f8-135">Kan jag använda Vnet med en standard- eller basic-cache?</span><span class="sxs-lookup"><span data-stu-id="996f8-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="996f8-136">Varför skapa ett Redis-cache misslyckas i vissa undernät, men inte andra?</span><span class="sxs-lookup"><span data-stu-id="996f8-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="996f8-137">Vad är utrymmeskraven hello undernät?</span><span class="sxs-lookup"><span data-stu-id="996f8-137">What are hello subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="996f8-138">Fungerar alla cachefunktioner när värd en cachelagring i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="996f8-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="996f8-139">Vilka är några vanliga problem med Azure Redis-Cache och Vnet?</span><span class="sxs-lookup"><span data-stu-id="996f8-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="996f8-140">När Azure Redis-Cache finns i ett VNet, används hello portarna i följande tabeller hello.</span><span class="sxs-lookup"><span data-stu-id="996f8-140">When Azure Redis Cache is hosted in a VNet, hello ports in hello following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="996f8-141">Om hello portar i följande tabeller hello blockeras fungerar hello cachen inte korrekt.</span><span class="sxs-lookup"><span data-stu-id="996f8-141">If hello ports in hello following tables are blocked, hello cache may not function correctly.</span></span> <span data-ttu-id="996f8-142">Med en eller flera av de här portarna blockeras är hello vanligaste felkonfiguration problem när du använder Azure Redis-Cache i ett VNet.</span><span class="sxs-lookup"><span data-stu-id="996f8-142">Having one or more of these ports blocked is hello most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="996f8-143">Utgående portkrav</span><span class="sxs-lookup"><span data-stu-id="996f8-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="996f8-144">Krav för inkommande portar</span><span class="sxs-lookup"><span data-stu-id="996f8-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="996f8-145">Utgående portkrav</span><span class="sxs-lookup"><span data-stu-id="996f8-145">Outbound port requirements</span></span>

<span data-ttu-id="996f8-146">Det finns sju krav för utgående port.</span><span class="sxs-lookup"><span data-stu-id="996f8-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="996f8-147">Om du vill alla utgående anslutningar toohello internet kan göras via en klient lokalt granskning enhet.</span><span class="sxs-lookup"><span data-stu-id="996f8-147">If desired, all outbound connections toohello internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="996f8-148">Tre hello portar vidarebefordra trafik tooAzure slutpunkter servicing Azure Storage- och Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="996f8-148">Three of hello ports route traffic tooAzure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="996f8-149">hello återstående portintervall och för intern kommunikation för Redis-undernät.</span><span class="sxs-lookup"><span data-stu-id="996f8-149">hello remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="996f8-150">Inga undernät NSG-regler krävs för intern kommunikation för Redis-undernät.</span><span class="sxs-lookup"><span data-stu-id="996f8-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="996f8-151">Portar</span><span class="sxs-lookup"><span data-stu-id="996f8-151">Port(s)</span></span> | <span data-ttu-id="996f8-152">Riktning</span><span class="sxs-lookup"><span data-stu-id="996f8-152">Direction</span></span> | <span data-ttu-id="996f8-153">Transportprotokoll</span><span class="sxs-lookup"><span data-stu-id="996f8-153">Transport Protocol</span></span> | <span data-ttu-id="996f8-154">Syfte</span><span class="sxs-lookup"><span data-stu-id="996f8-154">Purpose</span></span> | <span data-ttu-id="996f8-155">Lokala IP</span><span class="sxs-lookup"><span data-stu-id="996f8-155">Local IP</span></span> | <span data-ttu-id="996f8-156">Fjärr-IP</span><span class="sxs-lookup"><span data-stu-id="996f8-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="996f8-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="996f8-157">80, 443</span></span> |<span data-ttu-id="996f8-158">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-158">Outbound</span></span> |<span data-ttu-id="996f8-159">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-159">TCP</span></span> |<span data-ttu-id="996f8-160">Redis-beroenden på Azure Storage/PKI (Internet)</span><span class="sxs-lookup"><span data-stu-id="996f8-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="996f8-161">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="996f8-162">53</span><span class="sxs-lookup"><span data-stu-id="996f8-162">53</span></span> |<span data-ttu-id="996f8-163">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-163">Outbound</span></span> |<span data-ttu-id="996f8-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="996f8-164">TCP/UDP</span></span> |<span data-ttu-id="996f8-165">Redis-beroenden i DNS (Internet/VNet)</span><span class="sxs-lookup"><span data-stu-id="996f8-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="996f8-166">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="996f8-167">8443</span><span class="sxs-lookup"><span data-stu-id="996f8-167">8443</span></span> |<span data-ttu-id="996f8-168">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-168">Outbound</span></span> |<span data-ttu-id="996f8-169">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-169">TCP</span></span> |<span data-ttu-id="996f8-170">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-170">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-171">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-171">(Redis subnet)</span></span> | <span data-ttu-id="996f8-172">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-172">(Redis subnet)</span></span> |
| <span data-ttu-id="996f8-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="996f8-173">10221-10231</span></span> |<span data-ttu-id="996f8-174">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-174">Outbound</span></span> |<span data-ttu-id="996f8-175">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-175">TCP</span></span> |<span data-ttu-id="996f8-176">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-176">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-177">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-177">(Redis subnet)</span></span> | <span data-ttu-id="996f8-178">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-178">(Redis subnet)</span></span> |
| <span data-ttu-id="996f8-179">20226</span><span class="sxs-lookup"><span data-stu-id="996f8-179">20226</span></span> |<span data-ttu-id="996f8-180">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-180">Outbound</span></span> |<span data-ttu-id="996f8-181">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-181">TCP</span></span> |<span data-ttu-id="996f8-182">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-182">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-183">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-183">(Redis subnet)</span></span> |<span data-ttu-id="996f8-184">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-184">(Redis subnet)</span></span> |
| <span data-ttu-id="996f8-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="996f8-185">13000-13999</span></span> |<span data-ttu-id="996f8-186">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-186">Outbound</span></span> |<span data-ttu-id="996f8-187">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-187">TCP</span></span> |<span data-ttu-id="996f8-188">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-188">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-189">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-189">(Redis subnet)</span></span> |<span data-ttu-id="996f8-190">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-190">(Redis subnet)</span></span> |
| <span data-ttu-id="996f8-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="996f8-191">15000-15999</span></span> |<span data-ttu-id="996f8-192">Utgående</span><span class="sxs-lookup"><span data-stu-id="996f8-192">Outbound</span></span> |<span data-ttu-id="996f8-193">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-193">TCP</span></span> |<span data-ttu-id="996f8-194">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-194">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-195">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-195">(Redis subnet)</span></span> |<span data-ttu-id="996f8-196">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="996f8-197">Krav för inkommande portar</span><span class="sxs-lookup"><span data-stu-id="996f8-197">Inbound port requirements</span></span>

<span data-ttu-id="996f8-198">Det finns åtta inkommande port intervallet krav.</span><span class="sxs-lookup"><span data-stu-id="996f8-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="996f8-199">Inkommande begäranden i dessa områden är antingen inkommande trafik från andra tjänster i hello samma virtuella nätverk eller interna toohello Redis undernät kommunikation.</span><span class="sxs-lookup"><span data-stu-id="996f8-199">Inbound requests in these ranges are either inbound from other services hosted in hello same VNET or internal toohello Redis subnet communications.</span></span>

| <span data-ttu-id="996f8-200">Portar</span><span class="sxs-lookup"><span data-stu-id="996f8-200">Port(s)</span></span> | <span data-ttu-id="996f8-201">Riktning</span><span class="sxs-lookup"><span data-stu-id="996f8-201">Direction</span></span> | <span data-ttu-id="996f8-202">Transportprotokoll</span><span class="sxs-lookup"><span data-stu-id="996f8-202">Transport Protocol</span></span> | <span data-ttu-id="996f8-203">Syfte</span><span class="sxs-lookup"><span data-stu-id="996f8-203">Purpose</span></span> | <span data-ttu-id="996f8-204">Lokala IP</span><span class="sxs-lookup"><span data-stu-id="996f8-204">Local IP</span></span> | <span data-ttu-id="996f8-205">Fjärr-IP</span><span class="sxs-lookup"><span data-stu-id="996f8-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="996f8-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="996f8-206">6379, 6380</span></span> |<span data-ttu-id="996f8-207">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-207">Inbound</span></span> |<span data-ttu-id="996f8-208">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-208">TCP</span></span> |<span data-ttu-id="996f8-209">Klienten kommunikation tooRedis Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="996f8-209">Client communication tooRedis, Azure load balancing</span></span> | <span data-ttu-id="996f8-210">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-210">(Redis subnet)</span></span> |<span data-ttu-id="996f8-211">Virtuellt nätverk, Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="996f8-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="996f8-212">8443</span><span class="sxs-lookup"><span data-stu-id="996f8-212">8443</span></span> |<span data-ttu-id="996f8-213">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-213">Inbound</span></span> |<span data-ttu-id="996f8-214">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-214">TCP</span></span> |<span data-ttu-id="996f8-215">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-215">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-216">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-216">(Redis subnet)</span></span> |<span data-ttu-id="996f8-217">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-217">(Redis subnet)</span></span> |
| <span data-ttu-id="996f8-218">8500</span><span class="sxs-lookup"><span data-stu-id="996f8-218">8500</span></span> |<span data-ttu-id="996f8-219">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-219">Inbound</span></span> |<span data-ttu-id="996f8-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="996f8-220">TCP/UDP</span></span> |<span data-ttu-id="996f8-221">Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="996f8-221">Azure load balancing</span></span> | <span data-ttu-id="996f8-222">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-222">(Redis subnet)</span></span> |<span data-ttu-id="996f8-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="996f8-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="996f8-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="996f8-224">10221-10231</span></span> |<span data-ttu-id="996f8-225">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-225">Inbound</span></span> |<span data-ttu-id="996f8-226">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-226">TCP</span></span> |<span data-ttu-id="996f8-227">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-227">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-228">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-228">(Redis subnet)</span></span> |<span data-ttu-id="996f8-229">(Redis undernät), Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="996f8-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="996f8-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="996f8-230">13000-13999</span></span> |<span data-ttu-id="996f8-231">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-231">Inbound</span></span> |<span data-ttu-id="996f8-232">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-232">TCP</span></span> |<span data-ttu-id="996f8-233">Klienten kommunikation tooRedis kluster, Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="996f8-233">Client communication tooRedis Clusters, Azure load balancing</span></span> | <span data-ttu-id="996f8-234">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-234">(Redis subnet)</span></span> |<span data-ttu-id="996f8-235">Virtuellt nätverk, Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="996f8-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="996f8-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="996f8-236">15000-15999</span></span> |<span data-ttu-id="996f8-237">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-237">Inbound</span></span> |<span data-ttu-id="996f8-238">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-238">TCP</span></span> |<span data-ttu-id="996f8-239">Klienten kommunikation tooRedis kluster, Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="996f8-239">Client communication tooRedis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="996f8-240">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-240">(Redis subnet)</span></span> |<span data-ttu-id="996f8-241">Virtuellt nätverk, Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="996f8-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="996f8-242">16001</span><span class="sxs-lookup"><span data-stu-id="996f8-242">16001</span></span> |<span data-ttu-id="996f8-243">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-243">Inbound</span></span> |<span data-ttu-id="996f8-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="996f8-244">TCP/UDP</span></span> |<span data-ttu-id="996f8-245">Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="996f8-245">Azure load balancing</span></span> | <span data-ttu-id="996f8-246">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-246">(Redis subnet)</span></span> |<span data-ttu-id="996f8-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="996f8-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="996f8-248">20226</span><span class="sxs-lookup"><span data-stu-id="996f8-248">20226</span></span> |<span data-ttu-id="996f8-249">Inkommande</span><span class="sxs-lookup"><span data-stu-id="996f8-249">Inbound</span></span> |<span data-ttu-id="996f8-250">TCP</span><span class="sxs-lookup"><span data-stu-id="996f8-250">TCP</span></span> |<span data-ttu-id="996f8-251">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="996f8-251">Internal communications for Redis</span></span> | <span data-ttu-id="996f8-252">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-252">(Redis subnet)</span></span> |<span data-ttu-id="996f8-253">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="996f8-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="996f8-254">Ytterligare anslutningskrav för virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="996f8-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="996f8-255">Det finns anslutningskrav för Azure Redis-Cache som inte kanske ursprungligen uppfyllas i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="996f8-256">Azure Redis-Cache måste alla hello följande objekt toofunction när de används i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-256">Azure Redis Cache requires all hello following items toofunction properly when used within a virtual network.</span></span>

* <span data-ttu-id="996f8-257">Utgående anslutning tooAzure lagring nätverksslutpunkter över hela världen.</span><span class="sxs-lookup"><span data-stu-id="996f8-257">Outbound network connectivity tooAzure Storage endpoints worldwide.</span></span> <span data-ttu-id="996f8-258">Detta inkluderar slutpunkter finns i hello samma region som hello Azure Redis-cacheinstansen som lagring slutpunkter finns i **andra** Azure-regioner.</span><span class="sxs-lookup"><span data-stu-id="996f8-258">This includes endpoints located in hello same region as hello Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="996f8-259">Azure Storage-slutpunkter lösa under hello följande DNS-domäner: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, och *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="996f8-259">Azure Storage endpoints resolve under hello following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="996f8-260">Utgående nätverksanslutningar för*ocsp.msocsp.com*, *mscrl.microsoft.com*, och *crl.microsoft.com*. Den här anslutningen är nödvändiga toosupport SSL-funktion.</span><span class="sxs-lookup"><span data-stu-id="996f8-260">Outbound network connectivity too*ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed toosupport SSL functionality.</span></span>
* <span data-ttu-id="996f8-261">hello DNS-konfiguration för hello virtuella nätverket måste kunna lösa alla hello slutpunkter och domäner som anges i hello tidigare punkter.</span><span class="sxs-lookup"><span data-stu-id="996f8-261">hello DNS configuration for hello virtual network must be capable of resolving all of hello endpoints and domains mentioned in hello earlier points.</span></span> <span data-ttu-id="996f8-262">Dessa DNS-krav kan uppfyllas genom att säkerställa att en giltig DNS-infrastruktur konfigurerad och underhålls för hello virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for hello virtual network.</span></span>
* <span data-ttu-id="996f8-263">Utgående network connectivity toohello följande Azure-övervakning slutpunkter som löser under hello följande DNS-domäner: shoebox2 black.shoebox2.metrics.nsatc.net, norra prod2.prod2.metrics.nsatc.net azglobal-black.azglobal.metrics.nsatc.net, shoebox2 red.shoebox2.metrics.nsatc.net Öst-prod2.prod2.metrics.nsatc.net azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="996f8-263">Outbound network connectivity toohello following Azure Monitoring endpoints, which resolve under hello following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="996f8-264">Hur kan jag bekräfta att min cache fungerar i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="996f8-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="996f8-265">När du ansluter tooan Azure Redis-Cache-instans som är värd för ett virtuellt nätverk hello din cache-klienter måste vara i samma virtuella nätverk, inklusive testprogrammen eller pinga diagnosverktyg.</span><span class="sxs-lookup"><span data-stu-id="996f8-265">When connecting tooan Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in hello same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="996f8-266">När hello portkrav har konfigurerats enligt beskrivningen i föregående avsnitt i hello, kan du kontrollera att ditt cacheminne fungerar genom att utföra följande steg hello.</span><span class="sxs-lookup"><span data-stu-id="996f8-266">Once hello port requirements are configured as described in hello previous section, you can verify that your cache is working by performing hello following steps.</span></span>

- <span data-ttu-id="996f8-267">[Starta om](cache-administration.md#reboot) alla hello cachelagra noder.</span><span class="sxs-lookup"><span data-stu-id="996f8-267">[Reboot](cache-administration.md#reboot) all of hello cache nodes.</span></span> <span data-ttu-id="996f8-268">Om alla hello krävs cacheberoenden inte kan nås (enligt beskrivningen i [inkommande portkrav](cache-how-to-premium-vnet.md#inbound-port-requirements) och [utgående portkrav](cache-how-to-premium-vnet.md#outbound-port-requirements)), hello cachen inte kan toorestart har.</span><span class="sxs-lookup"><span data-stu-id="996f8-268">If all of hello required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), hello cache won't be able toorestart successfully.</span></span>
- <span data-ttu-id="996f8-269">När hello cachenoder har startats om (som rapporteras av hello Cachestatus i hello Azure-portalen) kan du utföra hello följande test:</span><span class="sxs-lookup"><span data-stu-id="996f8-269">Once hello cache nodes have restarted (as reported by hello cache status in hello Azure portal), you can perform hello following tests:</span></span>
  - <span data-ttu-id="996f8-270">Pinga hello cache slutpunkten (via port 6380) från en dator som ligger inom hello samma virtuella nätverk som hello cache, med hjälp av [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="996f8-270">ping hello cache endpoint (using port 6380) from a machine that is within hello same VNET as hello cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="996f8-271">Exempel:</span><span class="sxs-lookup"><span data-stu-id="996f8-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="996f8-272">Om hello `tcping` verktyget rapporterar att hello porten är öppen, hello cache är tillgängligt för anslutningen från klienter i hello virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-272">If hello `tcping` tool reports that hello port is open, hello cache is available for connection from clients in hello VNET.</span></span>

  - <span data-ttu-id="996f8-273">Ett annat sätt tootest är toocreate en test-cacheklient (som kan vara en enkel konsoltillämpning med StackExchange.Redis) som ansluter toohello cache och lägger till och hämtar några objekt från hello cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-273">Another way tootest is toocreate a test cache client (which could be a simple console application using StackExchange.Redis) that connects toohello cache and adds and retrieves some items from hello cache.</span></span> <span data-ttu-id="996f8-274">Installera hello exempel klientprogrammet på en virtuell dator som är i hello samma virtuella nätverk som hello cache och kör den tooverify anslutningen toohello cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-274">Install hello sample client application onto a VM that is in hello same VNET as hello cache and run it tooverify connectivity toohello cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="996f8-275">Kan jag använda Vnet med en standard- eller basic-cache?</span><span class="sxs-lookup"><span data-stu-id="996f8-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="996f8-276">Vnet kan endast användas med premium-cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="996f8-277">Varför skapa ett Redis-cache misslyckas i vissa undernät, men inte andra?</span><span class="sxs-lookup"><span data-stu-id="996f8-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="996f8-278">Om du distribuerar ett Azure Redis-Cache tooa Resource Manager VNet måste hello cache vara i ett dedikerat undernät som innehåller inga andra resurstypen.</span><span class="sxs-lookup"><span data-stu-id="996f8-278">If you are deploying an Azure Redis Cache tooa Resource Manager VNet, hello cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="996f8-279">Om ett försök görs toodeploy misslyckas en Azure Redis-Cache tooa Resource Manager VNet-undernät som innehåller andra resurser, hello-distribution.</span><span class="sxs-lookup"><span data-stu-id="996f8-279">If an attempt is made toodeploy an Azure Redis Cache tooa Resource Manager VNet subnet that contains other resources, hello deployment fails.</span></span> <span data-ttu-id="996f8-280">Du måste ta bort hello befintliga resurser i hello undernät innan du kan skapa ett nytt Redis-cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-280">You must delete hello existing resources inside hello subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="996f8-281">Du kan distribuera flera typer av resurser tooa klassiska virtuella nätverk som du har tillräckligt med IP-adresser tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="996f8-281">You can deploy multiple types of resources tooa classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-hello-subnet-address-space-requirements"></a><span data-ttu-id="996f8-282">Vad är utrymmeskraven hello undernät?</span><span class="sxs-lookup"><span data-stu-id="996f8-282">What are hello subnet address space requirements?</span></span>
<span data-ttu-id="996f8-283">Azure reserverar vissa IP-adresser inom varje undernät, och dessa adresser kan inte användas.</span><span class="sxs-lookup"><span data-stu-id="996f8-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="996f8-284">hello är första och sista IP-adresser för hello undernät reserverade för överensstämmelse med protokollet, tillsammans med tre flera adresser som används för Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="996f8-284">hello first and last IP addresses of hello subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="996f8-285">Mer information finns i [finns det några begränsningar med hjälp av IP-adresser inom dessa undernät?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="996f8-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="996f8-286">I tillägg toohello IP-adresser används av hello Azure VNET infrastruktur, varje Redis-instansen i hello undernät använder två IP-adresser per Fragmentera och en ytterligare IP-adress för hello belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="996f8-286">In addition toohello IP addresses used by hello Azure VNET infrastructure, each Redis instance in hello subnet uses two IP addresses per shard and one additional IP address for hello load balancer.</span></span> <span data-ttu-id="996f8-287">En icke-klustrade cache anses toohave en Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="996f8-287">A non-clustered cache is considered toohave one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="996f8-288">Fungerar alla cachefunktioner när värd en cachelagring i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="996f8-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="996f8-289">När din cache är en del av ett VNET, endast klienter i hello VNET kan komma åt hello cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-289">When your cache is part of a VNET, only clients in hello VNET can access hello cache.</span></span> <span data-ttu-id="996f8-290">Därför fungerar hello följande funktioner för hantering av cache inte just nu.</span><span class="sxs-lookup"><span data-stu-id="996f8-290">As a result, hello following cache management features don't work at this time.</span></span>

* <span data-ttu-id="996f8-291">Redis-konsolen - eftersom Redis-konsolen körs i din lokala webbläsare som är utanför hello VNET, det går inte att ansluta tooyour cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-291">Redis Console - Because Redis Console runs in your local browser, which is outside hello VNET, it can't connect tooyour cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="996f8-292">Använda ExpressRoute med Azure Redis-Cache</span><span class="sxs-lookup"><span data-stu-id="996f8-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="996f8-293">Kunder kan ansluta en [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) krets tootheir virtuell nätverksinfrastruktur, vilket utöka sina lokala nätverk tooAzure.</span><span class="sxs-lookup"><span data-stu-id="996f8-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit tootheir virtual network infrastructure, thus extending their on-premises network tooAzure.</span></span> 

<span data-ttu-id="996f8-294">Som standard en nyligen skapade ExpressRoute-krets utför inte Tvingad tunneling (annons med en standardväg 0.0.0.0/0) på ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="996f8-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="996f8-295">Därför utgående Internetanslutning tillåts direkt från hello VNET och klientprogrammen finns kan tooconnect tooother Azure slutpunkter, inklusive Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-295">As a result, outbound Internet connectivity is allowed directly from hello VNET and client applications are able tooconnect tooother Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="996f8-296">Men en gemensam konfiguration av customer är toouse Tvingad tunneltrafik (annonsera en standardväg) som tvingar utgående Internet-trafik tooinstead flöde lokalt.</span><span class="sxs-lookup"><span data-stu-id="996f8-296">However a common customer configuration is toouse forced tunneling (advertise a default route) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="996f8-297">Den här trafikflöde bryter anslutningen till Azure Redis-Cache om hello utgående trafik sedan blockeras lokalt så att hello Azure Redis-Cache-instansen inte är kan toocommunicate med dess beroenden.</span><span class="sxs-lookup"><span data-stu-id="996f8-297">This traffic flow breaks connectivity with Azure Redis Cache if hello outbound traffic is then blocked on-premises such that hello Azure Redis Cache instance is not able toocommunicate with its dependencies.</span></span>

<span data-ttu-id="996f8-298">hello-lösning är toodefine (minst) användardefinierade vägar (udr: er) i hello undernät som innehåller hello Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-298">hello solution is toodefine one (or more) user-defined routes (UDRs) on hello subnet that contains hello Azure Redis Cache.</span></span> <span data-ttu-id="996f8-299">En UDR definierar undernät-specifika vägar som ska användas i stället för hello standardväg.</span><span class="sxs-lookup"><span data-stu-id="996f8-299">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>

<span data-ttu-id="996f8-300">Om möjligt bör toouse hello följande konfiguration:</span><span class="sxs-lookup"><span data-stu-id="996f8-300">If possible, it is recommended toouse hello following configuration:</span></span>

* <span data-ttu-id="996f8-301">Hej ExpressRoute configuration annonserar 0.0.0.0/0 och som standard kraft tunnlar all utgående trafik lokalt.</span><span class="sxs-lookup"><span data-stu-id="996f8-301">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="996f8-302">Hej UDR tillämpas toohello undernät som innehåller hello Azure Redis-Cache definierar 0.0.0.0/0 med en fungerande väg för TCP/IP-trafik toohello offentliga internet. till exempel genom att ange hello nästa hopp-typen too'Internet'.</span><span class="sxs-lookup"><span data-stu-id="996f8-302">hello UDR applied toohello subnet containing hello Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic toohello public internet; for example by setting hello next hop type too'Internet'.</span></span>

<span data-ttu-id="996f8-303">hello är kombinerade effekten av dessa steg att hello undernätverksnivå UDR företräde framför hello ExpressRoute Tvingad tunneltrafik tillse utgående Internetåtkomst från hello Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-303">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure Redis Cache.</span></span>

<span data-ttu-id="996f8-304">Anslutande tooan Azure Redis-Cache-instansen från ett lokalt program som använder ExpressRoute är inte en typisk användningsscenariot på grund av orsaker som tooperformance (för bästa prestanda Azure Redis-Cache ska gälla för klienterna hello samma region som hello Azure Redis-Cache).</span><span class="sxs-lookup"><span data-stu-id="996f8-304">Connecting tooan Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due tooperformance reasons (for best performance Azure Redis Cache clients should be in hello same region as hello Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="996f8-305">Hej vägar som definierats i en UDR **måste** vara specifikt nog tootake företräde framför alla vägar annonseras av hello ExpressRoute konfiguration.</span><span class="sxs-lookup"><span data-stu-id="996f8-305">hello routes defined in a UDR **must** be specific enough tootake precedence over any routes advertised by hello ExpressRoute configuration.</span></span> <span data-ttu-id="996f8-306">hello följande exempel använder hello bred 0.0.0.0/0 adressintervallet och som sådan kan potentiellt av misstag åsidosättas av flödet annonser med hjälp av mer specifika adressintervall.</span><span class="sxs-lookup"><span data-stu-id="996f8-306">hello following example uses hello broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="996f8-307">Azure Redis-Cache stöds inte med ExpressRoute-konfigurationer som **felaktigt cross-annonsera vägar från hello offentlig peering sökväg toohello privat peering sökväg**.</span><span class="sxs-lookup"><span data-stu-id="996f8-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="996f8-308">ExpressRoute-konfigurationer som har konfigurerats, offentlig peering får vägannonser från Microsoft för ett stort antal Microsoft Azure IP-adressintervall.</span><span class="sxs-lookup"><span data-stu-id="996f8-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="996f8-309">Om dessa adressintervall felaktigt cross-annonserade på hello privat peering sökväg, är hello resultatet att alla utgående paket från hello Azure Redis-Cache instans undernät är felaktigt kraft tunneldata tooa kundens lokala nätverk infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="996f8-309">If these address ranges are incorrectly cross-advertised on hello private peering path, hello result is that all outbound network packets from hello Azure Redis Cache instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="996f8-310">Det här nätverket flödet bryts Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="996f8-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="996f8-311">hello lösning toothis problemet är toostop mellan reklam vägar från hello offentlig peering sökväg toohello privat peering sökväg.</span><span class="sxs-lookup"><span data-stu-id="996f8-311">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


<span data-ttu-id="996f8-312">Bakgrundsinformation om användardefinierade vägar är tillgänglig i det här [översikt](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="996f8-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="996f8-313">Mer information om ExpressRoute finns [teknisk översikt för ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="996f8-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="996f8-314">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="996f8-314">Next steps</span></span>
<span data-ttu-id="996f8-315">Lär dig hur toouse mer premium cachelagra funktioner.</span><span class="sxs-lookup"><span data-stu-id="996f8-315">Learn how toouse more premium cache features.</span></span>

* [<span data-ttu-id="996f8-316">Introduktion toohello Azure Redis Cache Premium-nivån</span><span class="sxs-lookup"><span data-stu-id="996f8-316">Introduction toohello Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

