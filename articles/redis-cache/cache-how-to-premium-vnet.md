---
title: "Konfigurera ett virtuellt nätverk för Premium Azure Redis-Cache | Microsoft Docs"
description: "Lär dig hur du skapar och hanterar virtuella nätverk stöd för din Premium-nivån Azure Redis-Cache-instanser"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: 59d46990e02c0719d2b4df01e216a97fd649c509
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="042e7-103">Så här konfigurerar du stöd för virtuella nätverk för Premium Azure Redis-Cache</span><span class="sxs-lookup"><span data-stu-id="042e7-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="042e7-104">Azure Redis-Cache har olika cache-erbjudanden som ger flexibilitet vid val av cachestorlek och funktioner, inklusive funktioner för Premium-nivån, till exempel klustring, beständiga och stöd för virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="042e7-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="042e7-105">Ett virtuellt nätverk är ett privat nätverk i molnet.</span><span class="sxs-lookup"><span data-stu-id="042e7-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="042e7-106">När en instans av Azure Redis-Cache har konfigurerats med ett VNet, är inte offentligt adresserbara och kan endast nås från virtuella datorer och program inom VNet.</span><span class="sxs-lookup"><span data-stu-id="042e7-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="042e7-107">Den här artikeln beskriver hur du konfigurerar virtual network-stöd för en premium Azure Redis-Cache-instans.</span><span class="sxs-lookup"><span data-stu-id="042e7-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="042e7-108">Azure Redis-Cache har stöd för både klassiska och Resource Manager VNets.</span><span class="sxs-lookup"><span data-stu-id="042e7-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="042e7-109">Information om andra cache premium-funktioner finns [introduktion till Azure Redis Cache Premium-nivån](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="042e7-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="042e7-110">Varför VNet?</span><span class="sxs-lookup"><span data-stu-id="042e7-110">Why VNet?</span></span>
<span data-ttu-id="042e7-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) distribution ger förbättrad säkerhet och isolering för Azure Redis-Cache, samt undernät, principer för åtkomstkontroll och andra funktioner för att ytterligare begränsa åtkomsten.</span><span class="sxs-lookup"><span data-stu-id="042e7-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="042e7-112">Stöd för virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="042e7-112">Virtual network support</span></span>
<span data-ttu-id="042e7-113">Stöd för virtuella nätverk (VNet) har konfigurerats på den **nytt Redis-Cache** bladet under skapande av cachen.</span><span class="sxs-lookup"><span data-stu-id="042e7-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="042e7-114">När du har valt en premium-prisnivån, kan du konfigurera Redis VNet integration genom att välja ett virtuellt nätverk som finns i samma prenumeration och plats som ditt cacheminne.</span><span class="sxs-lookup"><span data-stu-id="042e7-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="042e7-115">Om du vill använda ett nytt virtuellt nätverk, skapa den första genom att följa stegen i [skapa ett virtuellt nätverk med Azure-portalen](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) eller [skapa ett virtuellt nätverk (klassiska) med hjälp av Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) och återgå sedan till **Nytt Redis-Cache** bladet för att skapa och konfigurera din premium-cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="042e7-116">Om du vill konfigurera VNet för ditt nya cacheminne, klickar du på **virtuellt nätverk** på den **nytt Redis-Cache** , och välj det önskade virtuella nätverket från den nedrullningsbara listan.</span><span class="sxs-lookup"><span data-stu-id="042e7-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Virtuellt nätverk][redis-cache-vnet]

<span data-ttu-id="042e7-118">Välj önskad undernät från det **undernät** nedrullningsbara listan, och ange den önskade **statisk IP-adress**.</span><span class="sxs-lookup"><span data-stu-id="042e7-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="042e7-119">Om du använder ett klassiskt virtuellt nätverk i **statisk IP-adress** fältet är valfritt och om inget anges väljs en från det valda undernätet.</span><span class="sxs-lookup"><span data-stu-id="042e7-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="042e7-120">När du distribuerar ett Azure Redis-Cache till en Resource Manager-VNet, måste cachen vara i ett dedikerat undernät som innehåller några resurser förutom Azure Redis-Cache-instanser.</span><span class="sxs-lookup"><span data-stu-id="042e7-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="042e7-121">Om ett försök görs att distribuera ett Azure Redis-Cache till en Resource Manager VNet till ett undernät som innehåller andra resurser, misslyckas distributionen.</span><span class="sxs-lookup"><span data-stu-id="042e7-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Virtuellt nätverk][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="042e7-123">Azure reserverar vissa IP-adresser inom varje undernät, och dessa adresser kan inte användas.</span><span class="sxs-lookup"><span data-stu-id="042e7-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="042e7-124">De första och sista IP-adresserna undernät är reserverade för överensstämmelse med protokollet, tillsammans med tre flera adresser som används för Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="042e7-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="042e7-125">Mer information finns i [finns det några begränsningar med hjälp av IP-adresser inom dessa undernät?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="042e7-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="042e7-126">Förutom IP-adresser som används av den virtuella Azure-infrastrukturen, varje Redis-instansen i undernät använder två IP-adresser per Fragmentera och en ytterligare IP-adress för belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="042e7-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="042e7-127">En icke-klustrade cache anses ha en Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="042e7-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="042e7-128">När cachen har skapats kan du visa konfigurationen för det virtuella nätverket genom att klicka på **virtuellt nätverk** från den **resurs menyn**.</span><span class="sxs-lookup"><span data-stu-id="042e7-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Virtuellt nätverk][redis-cache-vnet-info]

<span data-ttu-id="042e7-130">För att ansluta till din Azure Redis-cache-instans när du använder ett virtuellt nätverk, anger du värdnamnet för ditt cacheminne i anslutningssträngen som visas i följande exempel:</span><span class="sxs-lookup"><span data-stu-id="042e7-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="042e7-131">Azure Redis-Cache VNet vanliga frågor och svar</span><span class="sxs-lookup"><span data-stu-id="042e7-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="042e7-132">I följande lista innehåller svar på vanliga frågor om Azure Redis-Cache skalning.</span><span class="sxs-lookup"><span data-stu-id="042e7-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="042e7-133">Vilka är några vanliga problem med Azure Redis-Cache och Vnet?</span><span class="sxs-lookup"><span data-stu-id="042e7-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="042e7-134">Hur kan jag bekräfta att min cache fungerar i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="042e7-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="042e7-135">Kan jag använda Vnet med en standard- eller basic-cache?</span><span class="sxs-lookup"><span data-stu-id="042e7-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="042e7-136">Varför skapa ett Redis-cache misslyckas i vissa undernät, men inte andra?</span><span class="sxs-lookup"><span data-stu-id="042e7-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="042e7-137">Vad är utrymmeskraven på undernät?</span><span class="sxs-lookup"><span data-stu-id="042e7-137">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="042e7-138">Fungerar alla cachefunktioner när värd en cachelagring i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="042e7-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="042e7-139">Vilka är några vanliga problem med Azure Redis-Cache och Vnet?</span><span class="sxs-lookup"><span data-stu-id="042e7-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="042e7-140">När Azure Redis-Cache finns i ett virtuellt nätverk, används portarna i följande tabeller.</span><span class="sxs-lookup"><span data-stu-id="042e7-140">When Azure Redis Cache is hosted in a VNet, the ports in the following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="042e7-141">Om portar i tabellerna nedan blockeras fungerar cachen inte korrekt.</span><span class="sxs-lookup"><span data-stu-id="042e7-141">If the ports in the following tables are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="042e7-142">Med en eller flera av de här portarna blockeras är de vanligaste felkonfiguration problemet när du använder Azure Redis-Cache i ett VNet.</span><span class="sxs-lookup"><span data-stu-id="042e7-142">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="042e7-143">Utgående portkrav</span><span class="sxs-lookup"><span data-stu-id="042e7-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="042e7-144">Krav för inkommande portar</span><span class="sxs-lookup"><span data-stu-id="042e7-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="042e7-145">Utgående portkrav</span><span class="sxs-lookup"><span data-stu-id="042e7-145">Outbound port requirements</span></span>

<span data-ttu-id="042e7-146">Det finns sju krav för utgående port.</span><span class="sxs-lookup"><span data-stu-id="042e7-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="042e7-147">Om önskade, alla utgående anslutningar till internet kan göras via en klient lokalt granskning enhet.</span><span class="sxs-lookup"><span data-stu-id="042e7-147">If desired, all outbound connections to the internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="042e7-148">Tre av portarna som dirigerar trafik till Azure-slutpunkter servicing Azure Storage- och Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="042e7-148">Three of the ports route traffic to Azure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="042e7-149">Återstående portintervall och för intern kommunikation för Redis-undernät.</span><span class="sxs-lookup"><span data-stu-id="042e7-149">The remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="042e7-150">Inga undernät NSG-regler krävs för intern kommunikation för Redis-undernät.</span><span class="sxs-lookup"><span data-stu-id="042e7-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="042e7-151">Portar</span><span class="sxs-lookup"><span data-stu-id="042e7-151">Port(s)</span></span> | <span data-ttu-id="042e7-152">Riktning</span><span class="sxs-lookup"><span data-stu-id="042e7-152">Direction</span></span> | <span data-ttu-id="042e7-153">Transportprotokoll</span><span class="sxs-lookup"><span data-stu-id="042e7-153">Transport Protocol</span></span> | <span data-ttu-id="042e7-154">Syfte</span><span class="sxs-lookup"><span data-stu-id="042e7-154">Purpose</span></span> | <span data-ttu-id="042e7-155">Lokala IP</span><span class="sxs-lookup"><span data-stu-id="042e7-155">Local IP</span></span> | <span data-ttu-id="042e7-156">Fjärr-IP</span><span class="sxs-lookup"><span data-stu-id="042e7-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="042e7-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="042e7-157">80, 443</span></span> |<span data-ttu-id="042e7-158">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-158">Outbound</span></span> |<span data-ttu-id="042e7-159">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-159">TCP</span></span> |<span data-ttu-id="042e7-160">Redis-beroenden på Azure Storage/PKI (Internet)</span><span class="sxs-lookup"><span data-stu-id="042e7-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="042e7-161">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="042e7-162">53</span><span class="sxs-lookup"><span data-stu-id="042e7-162">53</span></span> |<span data-ttu-id="042e7-163">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-163">Outbound</span></span> |<span data-ttu-id="042e7-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="042e7-164">TCP/UDP</span></span> |<span data-ttu-id="042e7-165">Redis-beroenden i DNS (Internet/VNet)</span><span class="sxs-lookup"><span data-stu-id="042e7-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="042e7-166">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="042e7-167">8443</span><span class="sxs-lookup"><span data-stu-id="042e7-167">8443</span></span> |<span data-ttu-id="042e7-168">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-168">Outbound</span></span> |<span data-ttu-id="042e7-169">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-169">TCP</span></span> |<span data-ttu-id="042e7-170">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-170">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-171">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-171">(Redis subnet)</span></span> | <span data-ttu-id="042e7-172">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-172">(Redis subnet)</span></span> |
| <span data-ttu-id="042e7-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="042e7-173">10221-10231</span></span> |<span data-ttu-id="042e7-174">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-174">Outbound</span></span> |<span data-ttu-id="042e7-175">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-175">TCP</span></span> |<span data-ttu-id="042e7-176">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-176">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-177">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-177">(Redis subnet)</span></span> | <span data-ttu-id="042e7-178">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-178">(Redis subnet)</span></span> |
| <span data-ttu-id="042e7-179">20226</span><span class="sxs-lookup"><span data-stu-id="042e7-179">20226</span></span> |<span data-ttu-id="042e7-180">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-180">Outbound</span></span> |<span data-ttu-id="042e7-181">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-181">TCP</span></span> |<span data-ttu-id="042e7-182">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-182">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-183">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-183">(Redis subnet)</span></span> |<span data-ttu-id="042e7-184">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-184">(Redis subnet)</span></span> |
| <span data-ttu-id="042e7-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="042e7-185">13000-13999</span></span> |<span data-ttu-id="042e7-186">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-186">Outbound</span></span> |<span data-ttu-id="042e7-187">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-187">TCP</span></span> |<span data-ttu-id="042e7-188">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-188">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-189">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-189">(Redis subnet)</span></span> |<span data-ttu-id="042e7-190">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-190">(Redis subnet)</span></span> |
| <span data-ttu-id="042e7-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="042e7-191">15000-15999</span></span> |<span data-ttu-id="042e7-192">Utgående</span><span class="sxs-lookup"><span data-stu-id="042e7-192">Outbound</span></span> |<span data-ttu-id="042e7-193">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-193">TCP</span></span> |<span data-ttu-id="042e7-194">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-194">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-195">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-195">(Redis subnet)</span></span> |<span data-ttu-id="042e7-196">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="042e7-197">Krav för inkommande portar</span><span class="sxs-lookup"><span data-stu-id="042e7-197">Inbound port requirements</span></span>

<span data-ttu-id="042e7-198">Det finns åtta inkommande port intervallet krav.</span><span class="sxs-lookup"><span data-stu-id="042e7-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="042e7-199">Inkommande begäranden i dessa områden är inkommande trafik från andra tjänster i samma virtuella nätverk eller intern kommunikation för Redis-undernät.</span><span class="sxs-lookup"><span data-stu-id="042e7-199">Inbound requests in these ranges are either inbound from other services hosted in the same VNET or internal to the Redis subnet communications.</span></span>

| <span data-ttu-id="042e7-200">Portar</span><span class="sxs-lookup"><span data-stu-id="042e7-200">Port(s)</span></span> | <span data-ttu-id="042e7-201">Riktning</span><span class="sxs-lookup"><span data-stu-id="042e7-201">Direction</span></span> | <span data-ttu-id="042e7-202">Transportprotokoll</span><span class="sxs-lookup"><span data-stu-id="042e7-202">Transport Protocol</span></span> | <span data-ttu-id="042e7-203">Syfte</span><span class="sxs-lookup"><span data-stu-id="042e7-203">Purpose</span></span> | <span data-ttu-id="042e7-204">Lokala IP</span><span class="sxs-lookup"><span data-stu-id="042e7-204">Local IP</span></span> | <span data-ttu-id="042e7-205">Fjärr-IP</span><span class="sxs-lookup"><span data-stu-id="042e7-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="042e7-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="042e7-206">6379, 6380</span></span> |<span data-ttu-id="042e7-207">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-207">Inbound</span></span> |<span data-ttu-id="042e7-208">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-208">TCP</span></span> |<span data-ttu-id="042e7-209">Klientkommunikation till Redis Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="042e7-209">Client communication to Redis, Azure load balancing</span></span> | <span data-ttu-id="042e7-210">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-210">(Redis subnet)</span></span> |<span data-ttu-id="042e7-211">Virtuellt nätverk, Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="042e7-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="042e7-212">8443</span><span class="sxs-lookup"><span data-stu-id="042e7-212">8443</span></span> |<span data-ttu-id="042e7-213">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-213">Inbound</span></span> |<span data-ttu-id="042e7-214">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-214">TCP</span></span> |<span data-ttu-id="042e7-215">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-215">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-216">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-216">(Redis subnet)</span></span> |<span data-ttu-id="042e7-217">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-217">(Redis subnet)</span></span> |
| <span data-ttu-id="042e7-218">8500</span><span class="sxs-lookup"><span data-stu-id="042e7-218">8500</span></span> |<span data-ttu-id="042e7-219">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-219">Inbound</span></span> |<span data-ttu-id="042e7-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="042e7-220">TCP/UDP</span></span> |<span data-ttu-id="042e7-221">Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="042e7-221">Azure load balancing</span></span> | <span data-ttu-id="042e7-222">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-222">(Redis subnet)</span></span> |<span data-ttu-id="042e7-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="042e7-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="042e7-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="042e7-224">10221-10231</span></span> |<span data-ttu-id="042e7-225">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-225">Inbound</span></span> |<span data-ttu-id="042e7-226">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-226">TCP</span></span> |<span data-ttu-id="042e7-227">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-227">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-228">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-228">(Redis subnet)</span></span> |<span data-ttu-id="042e7-229">(Redis undernät), Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="042e7-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="042e7-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="042e7-230">13000-13999</span></span> |<span data-ttu-id="042e7-231">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-231">Inbound</span></span> |<span data-ttu-id="042e7-232">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-232">TCP</span></span> |<span data-ttu-id="042e7-233">Klientkommunikation till Redis-kluster, Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="042e7-233">Client communication to Redis Clusters, Azure load balancing</span></span> | <span data-ttu-id="042e7-234">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-234">(Redis subnet)</span></span> |<span data-ttu-id="042e7-235">Virtuellt nätverk, Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="042e7-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="042e7-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="042e7-236">15000-15999</span></span> |<span data-ttu-id="042e7-237">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-237">Inbound</span></span> |<span data-ttu-id="042e7-238">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-238">TCP</span></span> |<span data-ttu-id="042e7-239">Klientkommunikation till Redis-kluster, Azure läsa in belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="042e7-239">Client communication to Redis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="042e7-240">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-240">(Redis subnet)</span></span> |<span data-ttu-id="042e7-241">Virtuellt nätverk, Azure belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="042e7-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="042e7-242">16001</span><span class="sxs-lookup"><span data-stu-id="042e7-242">16001</span></span> |<span data-ttu-id="042e7-243">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-243">Inbound</span></span> |<span data-ttu-id="042e7-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="042e7-244">TCP/UDP</span></span> |<span data-ttu-id="042e7-245">Azure belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="042e7-245">Azure load balancing</span></span> | <span data-ttu-id="042e7-246">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-246">(Redis subnet)</span></span> |<span data-ttu-id="042e7-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="042e7-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="042e7-248">20226</span><span class="sxs-lookup"><span data-stu-id="042e7-248">20226</span></span> |<span data-ttu-id="042e7-249">Inkommande</span><span class="sxs-lookup"><span data-stu-id="042e7-249">Inbound</span></span> |<span data-ttu-id="042e7-250">TCP</span><span class="sxs-lookup"><span data-stu-id="042e7-250">TCP</span></span> |<span data-ttu-id="042e7-251">Intern kommunikation för Redis</span><span class="sxs-lookup"><span data-stu-id="042e7-251">Internal communications for Redis</span></span> | <span data-ttu-id="042e7-252">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-252">(Redis subnet)</span></span> |<span data-ttu-id="042e7-253">(Redis undernät)</span><span class="sxs-lookup"><span data-stu-id="042e7-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="042e7-254">Ytterligare anslutningskrav för virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="042e7-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="042e7-255">Det finns anslutningskrav för Azure Redis-Cache som inte kanske ursprungligen uppfyllas i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="042e7-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="042e7-256">Azure Redis-Cache kräver följande ska fungera korrekt när den används i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="042e7-256">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="042e7-257">Utgående nätverksanslutning till Azure Storage slutpunkter över hela världen.</span><span class="sxs-lookup"><span data-stu-id="042e7-257">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="042e7-258">Detta inkluderar slutpunkter finns i samma region som Azure Redis-Cache-instans, samt lagring slutpunkter finns i **andra** Azure-regioner.</span><span class="sxs-lookup"><span data-stu-id="042e7-258">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="042e7-259">Azure Storage-slutpunkter lösa under följande DNS-domäner: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, och *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="042e7-259">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="042e7-260">Utgående nätverksanslutning till *ocsp.msocsp.com*, *mscrl.microsoft.com*, och *crl.microsoft.com*. Den här anslutningen krävs för att stödja SSL-funktioner.</span><span class="sxs-lookup"><span data-stu-id="042e7-260">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="042e7-261">DNS-konfigurationen för det virtuella nätverket måste kunna matcha alla slutpunkter och domäner som nämns i tidigare återställningspunkter.</span><span class="sxs-lookup"><span data-stu-id="042e7-261">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="042e7-262">Dessa DNS-krav kan uppfyllas genom att säkerställa att ett giltigt DNS-infrastrukturen är konfigurerad och underhålls för det virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="042e7-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="042e7-263">Utgående nätverksanslutning till följande Azure-övervakning slutpunkter, vilket löser under följande DNS-domäner: shoebox2 black.shoebox2.metrics.nsatc.net Nord-prod2.prod2.metrics.nsatc.net azglobal-black.azglobal.metrics.nsatc.net , shoebox2 red.shoebox2.metrics.nsatc.net Öst-prod2.prod2.metrics.nsatc.net azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="042e7-263">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="042e7-264">Hur kan jag bekräfta att min cache fungerar i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="042e7-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="042e7-265">När du ansluter till en Azure Redis-Cache-instans som är värd för ett virtuellt nätverk kan måste cacheklienter vara i samma virtuella nätverk, inklusive testprogrammen eller pinga diagnosverktyg.</span><span class="sxs-lookup"><span data-stu-id="042e7-265">When connecting to an Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in the same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="042e7-266">När portkraven har konfigurerats enligt beskrivningen i föregående avsnitt, kan du kontrollera att ditt cacheminne fungerar genom att utföra följande steg.</span><span class="sxs-lookup"><span data-stu-id="042e7-266">Once the port requirements are configured as described in the previous section, you can verify that your cache is working by performing the following steps.</span></span>

- <span data-ttu-id="042e7-267">[Starta om](cache-administration.md#reboot) alla cachenoder.</span><span class="sxs-lookup"><span data-stu-id="042e7-267">[Reboot](cache-administration.md#reboot) all of the cache nodes.</span></span> <span data-ttu-id="042e7-268">Om alla nödvändiga cacheberoenden inte kan nås (enligt beskrivningen i [inkommande portkrav](cache-how-to-premium-vnet.md#inbound-port-requirements) och [utgående portkrav](cache-how-to-premium-vnet.md#outbound-port-requirements)), cachen inte kan starta korrekt.</span><span class="sxs-lookup"><span data-stu-id="042e7-268">If all of the required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), the cache won't be able to restart successfully.</span></span>
- <span data-ttu-id="042e7-269">När cachenoderna har startats om (som rapporteras av Cachestatus i Azure-portalen) kan du utföra följande test:</span><span class="sxs-lookup"><span data-stu-id="042e7-269">Once the cache nodes have restarted (as reported by the cache status in the Azure portal), you can perform the following tests:</span></span>
  - <span data-ttu-id="042e7-270">Pinga cache-slutpunkten (med port 6380) från en dator som ligger inom samma virtuella nätverk som cache, med hjälp av [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="042e7-270">ping the cache endpoint (using port 6380) from a machine that is within the same VNET as the cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="042e7-271">Exempel:</span><span class="sxs-lookup"><span data-stu-id="042e7-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="042e7-272">Om den `tcping` verktyget rapporterar att porten är öppen, cachen är tillgängliga för anslutningen från klienter i virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="042e7-272">If the `tcping` tool reports that the port is open, the cache is available for connection from clients in the VNET.</span></span>

  - <span data-ttu-id="042e7-273">Ett annat sätt att testa är att skapa en test-cacheklient (som kan vara ett enkelt konsolprogram med StackExchange.Redis) som ansluter till cacheminnet och lägger till och hämtar några objekt från cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="042e7-273">Another way to test is to create a test cache client (which could be a simple console application using StackExchange.Redis) that connects to the cache and adds and retrieves some items from the cache.</span></span> <span data-ttu-id="042e7-274">Installera klienten exempelprogrammet till en virtuell dator som är i samma virtuella nätverk som cacheminnet och köra den för att verifiera anslutningen till cachen.</span><span class="sxs-lookup"><span data-stu-id="042e7-274">Install the sample client application onto a VM that is in the same VNET as the cache and run it to verify connectivity to the cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="042e7-275">Kan jag använda Vnet med en standard- eller basic-cache?</span><span class="sxs-lookup"><span data-stu-id="042e7-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="042e7-276">Vnet kan endast användas med premium-cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="042e7-277">Varför skapa ett Redis-cache misslyckas i vissa undernät, men inte andra?</span><span class="sxs-lookup"><span data-stu-id="042e7-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="042e7-278">Om du distribuerar ett Azure Redis-Cache till en Resource Manager-VNet måste cachen vara i ett dedikerat undernät som innehåller inga andra resurstypen.</span><span class="sxs-lookup"><span data-stu-id="042e7-278">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="042e7-279">Om ett försök görs att distribuera ett Azure Redis-Cache till en Resource Manager VNet-undernät som innehåller andra resurser, misslyckas distributionen.</span><span class="sxs-lookup"><span data-stu-id="042e7-279">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="042e7-280">Du måste ta bort befintliga resurser i undernätet innan du kan skapa ett nytt Redis-cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-280">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="042e7-281">Du kan distribuera flera typer av resurser till ett klassiskt virtuellt nätverk som du har tillräckligt med tillgängliga IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="042e7-281">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="042e7-282">Vad är utrymmeskraven på undernät?</span><span class="sxs-lookup"><span data-stu-id="042e7-282">What are the subnet address space requirements?</span></span>
<span data-ttu-id="042e7-283">Azure reserverar vissa IP-adresser inom varje undernät, och dessa adresser kan inte användas.</span><span class="sxs-lookup"><span data-stu-id="042e7-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="042e7-284">De första och sista IP-adresserna undernät är reserverade för överensstämmelse med protokollet, tillsammans med tre flera adresser som används för Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="042e7-284">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="042e7-285">Mer information finns i [finns det några begränsningar med hjälp av IP-adresser inom dessa undernät?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="042e7-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="042e7-286">Förutom IP-adresser som används av den virtuella Azure-infrastrukturen, varje Redis-instansen i undernät använder två IP-adresser per Fragmentera och en ytterligare IP-adress för belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="042e7-286">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="042e7-287">En icke-klustrade cache anses ha en Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="042e7-287">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="042e7-288">Fungerar alla cachefunktioner när värd en cachelagring i ett virtuellt nätverk?</span><span class="sxs-lookup"><span data-stu-id="042e7-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="042e7-289">När din cache är en del av ett virtuellt nätverk kan bara klienter i virtuella nätverk kan komma åt cachen.</span><span class="sxs-lookup"><span data-stu-id="042e7-289">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="042e7-290">Följande funktioner för hantering av cache fungerar därför inte just nu.</span><span class="sxs-lookup"><span data-stu-id="042e7-290">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="042e7-291">Redis-konsolen - eftersom Redis-konsolen körs i din lokala webbläsare som är utanför det virtuella nätverket, det går inte att ansluta till ditt cacheminne.</span><span class="sxs-lookup"><span data-stu-id="042e7-291">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="042e7-292">Använda ExpressRoute med Azure Redis-Cache</span><span class="sxs-lookup"><span data-stu-id="042e7-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="042e7-293">Kunder kan ansluta en [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) krets på sina virtuella nätverksinfrastrukturen därför utöka sina lokala nätverk till Azure.</span><span class="sxs-lookup"><span data-stu-id="042e7-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="042e7-294">Som standard en nyligen skapade ExpressRoute-krets utför inte Tvingad tunneling (annons med en standardväg 0.0.0.0/0) på ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="042e7-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="042e7-295">Därför utgående Internetanslutning är tillåtna direkt från VNET och klientprogram ska kunna ansluta till andra Azure-slutpunkter inklusive Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-295">As a result, outbound Internet connectivity is allowed directly from the VNET and client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="042e7-296">Men en gemensam konfiguration av customer är att använda Tvingad tunneltrafik (annonsera en standardväg) som tvingar utgående Internet-trafiken flöda lokalt i stället.</span><span class="sxs-lookup"><span data-stu-id="042e7-296">However a common customer configuration is to use forced tunneling (advertise a default route) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="042e7-297">Den här trafikflöde bryter anslutningen till Azure Redis-Cache om utgående trafik sedan blockeras lokalt så att den Azure Redis-Cache-instansen inte är kan kommunicera med dess beroenden.</span><span class="sxs-lookup"><span data-stu-id="042e7-297">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="042e7-298">Lösningen är att definiera en (eller flera) användardefinierade vägar (udr: er) för det undernät som innehåller Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-298">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="042e7-299">En UDR definierar undernät-specifika vägar som ska användas i stället för standardväg.</span><span class="sxs-lookup"><span data-stu-id="042e7-299">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="042e7-300">Om möjligt bör du använder följande konfiguration:</span><span class="sxs-lookup"><span data-stu-id="042e7-300">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="042e7-301">ExpressRoute-konfigurationen annonserar 0.0.0.0/0 och som standard kraft tunnlar all utgående trafik lokalt.</span><span class="sxs-lookup"><span data-stu-id="042e7-301">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="042e7-302">UDR tillämpad på undernätet som innehåller Azure Redis-Cache definierar 0.0.0.0/0 med en fungerande väg för TCP/IP-trafik till det offentliga internet; till exempel genom att nästa hopptyp ”Internet”.</span><span class="sxs-lookup"><span data-stu-id="042e7-302">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="042e7-303">Den kombinerade effekten av dessa steg är att undernätverksnivån UDR företräde framför den ExpressRoute Tvingad tunneltrafik tillse utgående Internetåtkomst från Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-303">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="042e7-304">Ansluter till en Azure Redis-Cache-instans från ett lokalt program som använder ExpressRoute är inte en typisk användningsscenariot på grund av prestandaskäl (för bästa prestanda Azure Redis-Cache klienter måste vara i samma region som Azure Redis-Cache).</span><span class="sxs-lookup"><span data-stu-id="042e7-304">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="042e7-305">De vägar som definierats i en UDR **måste** vara specifikt nog att företräde framför alla vägarna som annonseras av ExpressRoute-konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="042e7-305">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="042e7-306">I följande exempel använder adressintervallet bred 0.0.0.0/0 och som sådan kan potentiellt av misstag åsidosättas av flödet annonser med hjälp av mer specifika adressintervall.</span><span class="sxs-lookup"><span data-stu-id="042e7-306">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="042e7-307">Azure Redis-Cache stöds inte med ExpressRoute-konfigurationer som **felaktigt cross-annonsera vägar från offentlig peering sökvägen att privat peering sökväg**.</span><span class="sxs-lookup"><span data-stu-id="042e7-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="042e7-308">ExpressRoute-konfigurationer som har konfigurerats, offentlig peering får vägannonser från Microsoft för ett stort antal Microsoft Azure IP-adressintervall.</span><span class="sxs-lookup"><span data-stu-id="042e7-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="042e7-309">Om dessa adressintervall felaktigt cross-annonseras i privat peering sökväg, är resultatet att alla utgående paket från Azure Redis-Cache-instansens undernät är felaktigt kraft tunnlar kundens lokala nätverkets infrastruktur .</span><span class="sxs-lookup"><span data-stu-id="042e7-309">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="042e7-310">Det här nätverket flödet bryts Azure Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="042e7-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="042e7-311">Lösning på problemet är att stoppa mellan reklam vägar från offentlig peering sökvägen att privat peering sökväg.</span><span class="sxs-lookup"><span data-stu-id="042e7-311">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="042e7-312">Bakgrundsinformation om användardefinierade vägar är tillgänglig i det här [översikt](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="042e7-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="042e7-313">Mer information om ExpressRoute finns [teknisk översikt för ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="042e7-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="042e7-314">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="042e7-314">Next steps</span></span>
<span data-ttu-id="042e7-315">Lär dig hur du använder flera funktioner som cache premium.</span><span class="sxs-lookup"><span data-stu-id="042e7-315">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="042e7-316">Introduktion till Azure Redis Cache Premium-nivån</span><span class="sxs-lookup"><span data-stu-id="042e7-316">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

