---
title: aaaDeploy dina Azure IoT Suite anslutna factory gateway | Microsoft Docs
description: "Hur toodeploy en gateway på Windows- eller Linux tooenable anslutning toohello anslutna factory förkonfigurerade lösningen."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="a28de-103">Distribuera en gateway på Windows- eller Linux för hello anslutna factory förkonfigurerade lösningen</span><span class="sxs-lookup"><span data-stu-id="a28de-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="a28de-104">hello obligatorisk programvara toodeploy en gateway för hello anslutna factory förkonfigurerade lösningen består av två komponenter:</span><span class="sxs-lookup"><span data-stu-id="a28de-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="a28de-105">Hej *OPC Proxy* upprättar en anslutning tooIoT hubb.</span><span class="sxs-lookup"><span data-stu-id="a28de-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="a28de-106">Hej *OPC Proxy* sedan väntar på kommando- och meddelanden från hello integrerad OPC webbläsare som körs i hello anslutna factory lösning portal.</span><span class="sxs-lookup"><span data-stu-id="a28de-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="a28de-107">Hej *OPC Publisher* ansluter tooexisting lokalt OPC UA servrar och vidarebefordrar telemetri från dem tooIoT hubb.</span><span class="sxs-lookup"><span data-stu-id="a28de-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="a28de-108">Båda komponenterna är öppen källkod och är tillgängliga som källa på GitHub och Docker-behållare:</span><span class="sxs-lookup"><span data-stu-id="a28de-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="a28de-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="a28de-109">GitHub</span></span> | <span data-ttu-id="a28de-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="a28de-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="a28de-111">[OPC Publisher][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="a28de-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="a28de-112">[OPC Publisher][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="a28de-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="a28de-113">[OPC-Proxy][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="a28de-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="a28de-114">[OPC-Proxy][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="a28de-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="a28de-115">Ingen offentlig IP-adress eller tomrum i brandväggen för hello gateway krävs för någon komponent.</span><span class="sxs-lookup"><span data-stu-id="a28de-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="a28de-116">använda endast utgående portarna 443, 5671 och 8883 hello OPC-Proxy och OPC utgivare.</span><span class="sxs-lookup"><span data-stu-id="a28de-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="a28de-117">hello steg i den här artikeln visar hur toodeploy en gateway med Docker på antingen [Windows](#windows-deployment) eller [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="a28de-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="a28de-118">hello gateway kan toohello anslutna factory förkonfigurerade lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="a28de-119">hello gateway-programvara som körs i hello dockerbehållare är [Azure IoT kant].</span><span class="sxs-lookup"><span data-stu-id="a28de-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="a28de-120">Windows-distribution</span><span class="sxs-lookup"><span data-stu-id="a28de-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="a28de-121">Om du ännu inte har en gateway-enhet, rekommenderar Microsoft att du köper en kommersiell gateway från någon av våra partners.</span><span class="sxs-lookup"><span data-stu-id="a28de-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="a28de-122">Besök hello [Azure IoT-enhet katalogen] för gateway-enheter som är kompatibla med hello anslutet factory lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="a28de-123">Följ instruktionerna för hello som medföljer hello enheten tooset in hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="a28de-124">Du kan också använda hello följande instruktioner toomanually ställa in ett av dina befintliga gatewayer.</span><span class="sxs-lookup"><span data-stu-id="a28de-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="a28de-125">Installera Docker</span><span class="sxs-lookup"><span data-stu-id="a28de-125">Install Docker</span></span>

<span data-ttu-id="a28de-126">Installera [Docker för Windows] på din Windows-baserade gateway-enhet.</span><span class="sxs-lookup"><span data-stu-id="a28de-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="a28de-127">Välj en enhet på din värd datorn tooshare med Docker under Windows Docker-installationen.</span><span class="sxs-lookup"><span data-stu-id="a28de-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="a28de-128">följande skärmbild visar dela hello D enheten på datorn Windows hello:</span><span class="sxs-lookup"><span data-stu-id="a28de-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Installera Docker][img-install-docker]

<span data-ttu-id="a28de-130">Skapa en mapp med namnet **docker** i hello rot hello delad enhet.</span><span class="sxs-lookup"><span data-stu-id="a28de-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="a28de-131">Du kan också utföra det här steget när du har installerat docker från hello **inställningar** menyn.</span><span class="sxs-lookup"><span data-stu-id="a28de-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="a28de-132">Konfigurera hello-gateway</span><span class="sxs-lookup"><span data-stu-id="a28de-132">Configure hello gateway</span></span>

1. <span data-ttu-id="a28de-133">Du behöver hello **iothubowner** anslutningssträngen för dina Azure IoT Suite anslutna factory distribution toocomplete hello gateway-distribution.</span><span class="sxs-lookup"><span data-stu-id="a28de-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="a28de-134">I hello [Azure-portalen], navigera tooyour IoT-hubb i hello resursgruppen skapade när du distribuerade hello anslutna factory lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="a28de-135">Klicka på **principer för delad åtkomst** tooaccess hello **iothubowner** anslutningssträngen:</span><span class="sxs-lookup"><span data-stu-id="a28de-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Hitta hello anslutningssträngen för IoT-hubb][img-hub-connection]

    <span data-ttu-id="a28de-137">Kopiera hello **anslutningssträngen--primärnyckel** värde.</span><span class="sxs-lookup"><span data-stu-id="a28de-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="a28de-138">Konfigurera hello gateway för din IoT-hubb genom att köra hello två gateway moduler **när** från en kommandotolk med:</span><span class="sxs-lookup"><span data-stu-id="a28de-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="a28de-139">**&lt;ApplicationName&gt;**  är hello toogive tooyour OPC UA Publisher hello format **utgivare.&lt; fullständigt kvalificerade domännamnet&gt;**.</span><span class="sxs-lookup"><span data-stu-id="a28de-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="a28de-140">Om exempelvis factory nätverket kallas **myfactorynetwork.com**, hello **ApplicationName** värdet är **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="a28de-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="a28de-141">**&lt;IoTHubOwnerConnectionString&gt;**  är hello **iothubowner** anslutningssträngen som du kopierade i föregående steg i hello.</span><span class="sxs-lookup"><span data-stu-id="a28de-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="a28de-142">Den här anslutningssträngen används endast i det här steget, du behöver i hello följande steg:</span><span class="sxs-lookup"><span data-stu-id="a28de-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="a28de-143">Du använder hello mappas D:\\docker-mappen (hello `-v` argumentet) senare toopersist hello två X.509-certifikat med hello gateway moduler.</span><span class="sxs-lookup"><span data-stu-id="a28de-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="a28de-144">Köra hello gateway</span><span class="sxs-lookup"><span data-stu-id="a28de-144">Run hello gateway</span></span>

1. <span data-ttu-id="a28de-145">Starta om hello gateway med hello följande kommandon:</span><span class="sxs-lookup"><span data-stu-id="a28de-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="a28de-146">Av säkerhetsskäl hello två X.509-certifikat som är kvar i hello D:\\docker mapp innehåller hello privat nyckel.</span><span class="sxs-lookup"><span data-stu-id="a28de-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="a28de-147">Begränsa toohello autentiseringsuppgifter toothis mapp (vanligtvis **administratörer**) du använder toorun hello dockerbehållare.</span><span class="sxs-lookup"><span data-stu-id="a28de-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="a28de-148">Högerklicka på hello D:\\docker-mappen, Välj **egenskaper**, sedan **säkerhet**, och sedan **redigera**.</span><span class="sxs-lookup"><span data-stu-id="a28de-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="a28de-149">Ge **administratörer** fullständig kontroll och ta bort alla andra:</span><span class="sxs-lookup"><span data-stu-id="a28de-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Bevilja behörigheter tooDocker resursen][img-docker-share]

1. <span data-ttu-id="a28de-151">Kontrollera nätverksanslutningen.</span><span class="sxs-lookup"><span data-stu-id="a28de-151">Verify network connectivity.</span></span> <span data-ttu-id="a28de-152">Ange hello-kommando från en kommandotolk `ping publisher.<your fully qualified domain name>` tooping din gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="a28de-153">Lägg till hello IP-adress och namnet på gateway toohello hosts-filen på din gateway om hello mål kan inte nås.</span><span class="sxs-lookup"><span data-stu-id="a28de-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="a28de-154">hello hosts-filen finns i hello **Windows\\System32\\drivrutiner\\etc** mapp.</span><span class="sxs-lookup"><span data-stu-id="a28de-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="a28de-155">Försök därefter tooconnect toohello utgivaren med hjälp av en lokal OPC UA klient på hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="a28de-156">Hej OPC UA endpoint URL: en är `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="a28de-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="a28de-157">Om du inte har en OPC UA-klient, hämtar och använder en [öppen källkod OPC UA klienten].</span><span class="sxs-lookup"><span data-stu-id="a28de-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="a28de-158">När du har slutfört dessa lokala tester, bläddra toohello **ansluta din egen OPC UA Server** sida i hello anslutna factory lösning portal.</span><span class="sxs-lookup"><span data-stu-id="a28de-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="a28de-159">Ange hello publisher slutpunkts-URL (`tcp://publisher.<your fully qualified domain name>:62222`) och klicka på **Anslut**.</span><span class="sxs-lookup"><span data-stu-id="a28de-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="a28de-160">Du får en certifikatvarning om och klicka sedan på **Fortsätt.**</span><span class="sxs-lookup"><span data-stu-id="a28de-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="a28de-161">Nästa du får ett felmeddelande som hello hello UA webbklienten inte litar på utgivaren.</span><span class="sxs-lookup"><span data-stu-id="a28de-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="a28de-162">tooresolve det här felet, kopiera hello **UA webbklienten** certifikat från hello **D:\\docker\\avvisade certifikat\\certifikat** mappen toohello **D:\\docker\\UA program\\certifikat** mapp på hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="a28de-163">Du behöver inte toorestart för hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="a28de-164">Upprepa det här steget.</span><span class="sxs-lookup"><span data-stu-id="a28de-164">Repeat this step.</span></span> <span data-ttu-id="a28de-165">Nu kan du ansluta toohello gateway hello molnet och du är redo tooadd OPC UA servrar toohello lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="a28de-166">Lägga till OPC UA-servrar</span><span class="sxs-lookup"><span data-stu-id="a28de-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="a28de-167">Bläddra toohello **ansluta din egen OPC UA Server** sida i hello anslutna factory lösning portal.</span><span class="sxs-lookup"><span data-stu-id="a28de-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="a28de-168">Följ samma steg som i föregående avsnitt tooestablish hello förtroende mellan hello anslutna factory portal och hello OPC UA server hello.</span><span class="sxs-lookup"><span data-stu-id="a28de-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="a28de-169">Det här steget upprättas ömsesidigt förtroende av hello certifikat från hello ansluten factory portal och hello OPC UA server och skapar en anslutning.</span><span class="sxs-lookup"><span data-stu-id="a28de-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="a28de-170">Bläddra hello OPC UA noder trädet serverns OPC UA, högerklicka på hello OPC noder och välj **publicera**.</span><span class="sxs-lookup"><span data-stu-id="a28de-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="a28de-171">Hello OPC UA server för publishing toowork sätt och hello publisher måste finnas på hello samma nätverk.</span><span class="sxs-lookup"><span data-stu-id="a28de-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="a28de-172">Med andra ord om hello fullständigt kvalificerade domännamnet för hello utgivaren är **publisher.mydomain.com** sedan hello fullständigt kvalificerade domännamnet för hello OPC UA server måste vara, till exempel **myopcuaserver.mydomain.com**. Om din konfiguration skiljer sig, kan du manuellt lägga till noder toohello publishesnodes.json fil hittades i hello **D:\\docker** mapp.</span><span class="sxs-lookup"><span data-stu-id="a28de-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="a28de-173">Hej publishesnodes.json automatiskt genereras på hello först lyckad publicering av en OPC-nod.</span><span class="sxs-lookup"><span data-stu-id="a28de-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="a28de-174">Telemetri nu flödar från hello gateway-enhet.</span><span class="sxs-lookup"><span data-stu-id="a28de-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="a28de-175">Du kan visa hello telemetri i hello **Factory platser** vy över hello anslutna factory portal under **nya Factory**.</span><span class="sxs-lookup"><span data-stu-id="a28de-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="a28de-176">Linux-distribution</span><span class="sxs-lookup"><span data-stu-id="a28de-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="a28de-177">Om du ännu inte har en gateway-enhet, rekommenderar Microsoft att du köper en kommersiell gateway från någon av våra partners.</span><span class="sxs-lookup"><span data-stu-id="a28de-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="a28de-178">Besök hello [Azure IoT-enhet katalogen] för gateway-enheter som är kompatibla med hello anslutet factory lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="a28de-179">Följ instruktionerna för hello som medföljer hello enheten tooset in hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="a28de-180">Du kan också använda hello följande instruktioner toomanually ställa in ett av dina befintliga gatewayer.</span><span class="sxs-lookup"><span data-stu-id="a28de-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="a28de-181">[Installera Docker] på Linux-gateway-enheten.</span><span class="sxs-lookup"><span data-stu-id="a28de-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="a28de-182">Konfigurera hello-gateway</span><span class="sxs-lookup"><span data-stu-id="a28de-182">Configure hello gateway</span></span>

1. <span data-ttu-id="a28de-183">Du behöver hello **iothubowner** anslutningssträngen för dina Azure IoT Suite anslutna factory distribution toocomplete hello gateway-distribution.</span><span class="sxs-lookup"><span data-stu-id="a28de-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="a28de-184">I hello [Azure-portalen], navigera tooyour IoT-hubb i hello resursgruppen skapade när du distribuerade hello anslutna factory lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="a28de-185">Klicka på **principer för delad åtkomst** tooaccess hello **iothubowner** anslutningssträngen:</span><span class="sxs-lookup"><span data-stu-id="a28de-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Hitta hello anslutningssträngen för IoT-hubb][img-hub-connection]

    <span data-ttu-id="a28de-187">Kopiera hello **anslutningssträngen--primärnyckel** värde.</span><span class="sxs-lookup"><span data-stu-id="a28de-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="a28de-188">Konfigurera hello gateway för din IoT-hubb genom att köra hello två gateway moduler **när** från ett gränssnitt med:</span><span class="sxs-lookup"><span data-stu-id="a28de-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="a28de-189">**&lt;ApplicationName&gt;**  är hello namnet på hello OPC UA hello Programgateway skapar hello format **utgivare.&lt; fullständigt kvalificerade domännamnet&gt;**.</span><span class="sxs-lookup"><span data-stu-id="a28de-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="a28de-190">Till exempel **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="a28de-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="a28de-191">**&lt;IoTHubOwnerConnectionString&gt;**  är hello **iothubowner** anslutningssträngen som du kopierade i föregående steg i hello.</span><span class="sxs-lookup"><span data-stu-id="a28de-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="a28de-192">Den här anslutningssträngen används endast i det här steget, du behöver i hello följande steg:</span><span class="sxs-lookup"><span data-stu-id="a28de-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="a28de-193">Du använder hello **/ delade** mapp (hello `-v` argumentet) senare toopersist hello två X.509-certifikat med hello gateway moduler.</span><span class="sxs-lookup"><span data-stu-id="a28de-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="a28de-194">Köra hello gateway</span><span class="sxs-lookup"><span data-stu-id="a28de-194">Run hello gateway</span></span>

1. <span data-ttu-id="a28de-195">Starta om hello gateway med hello följande kommandon:</span><span class="sxs-lookup"><span data-stu-id="a28de-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="a28de-196">Av säkerhetsskäl hello två X.509-certifikat som är kvar i hello **/ delade** mapp innehåller hello privat nyckel.</span><span class="sxs-lookup"><span data-stu-id="a28de-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="a28de-197">Begränsa åtkomst toothis mappen toohello autentiseringsuppgifter du använder toorun hello dockerbehållare.</span><span class="sxs-lookup"><span data-stu-id="a28de-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="a28de-198">tooset hello behörigheter för **rot** endast använda hello `chmod` shell kommandot på hello-mappen.</span><span class="sxs-lookup"><span data-stu-id="a28de-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="a28de-199">Kontrollera nätverksanslutningen.</span><span class="sxs-lookup"><span data-stu-id="a28de-199">Verify network connectivity.</span></span> <span data-ttu-id="a28de-200">Ange hello-kommando från en shell `ping publisher.<your fully qualified domain name>` tooping din gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="a28de-201">Lägg till hello IP-adress och namnet på gateway tooyour hosts-filen på din gateway om hello mål kan inte nås.</span><span class="sxs-lookup"><span data-stu-id="a28de-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="a28de-202">hello hosts-filen finns i hello **/etc** mapp.</span><span class="sxs-lookup"><span data-stu-id="a28de-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="a28de-203">Försök därefter tooconnect toohello utgivaren med hjälp av en lokal OPC UA klient på hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="a28de-204">Hej OPC UA endpoint URL: en är `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="a28de-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="a28de-205">Om du inte har en OPC UA-klient, hämtar och använder en [öppen källkod OPC UA klienten].</span><span class="sxs-lookup"><span data-stu-id="a28de-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="a28de-206">När du har slutfört dessa lokala tester, bläddra toohello **ansluta din egen OPC UA Server** sida i hello anslutna factory lösning portal.</span><span class="sxs-lookup"><span data-stu-id="a28de-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="a28de-207">Ange hello publisher slutpunkts-URL (`tcp://publisher.<your fully qualified domain name>:62222`) och klicka på **Anslut**.</span><span class="sxs-lookup"><span data-stu-id="a28de-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="a28de-208">Du får en certifikatvarning om och klicka sedan på **Fortsätt.**</span><span class="sxs-lookup"><span data-stu-id="a28de-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="a28de-209">Nästa du får ett felmeddelande som hello hello UA webbklienten inte litar på utgivaren.</span><span class="sxs-lookup"><span data-stu-id="a28de-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="a28de-210">tooresolve det här felet, kopiera hello **UA webbklienten** certifikat från hello **/delad/Avvisad certifikat/certifikat** mappen toohello **/shared/UA program/certifikat** mapp på hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="a28de-211">Du behöver inte toorestart för hello gateway.</span><span class="sxs-lookup"><span data-stu-id="a28de-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="a28de-212">Upprepa det här steget.</span><span class="sxs-lookup"><span data-stu-id="a28de-212">Repeat this step.</span></span> <span data-ttu-id="a28de-213">Nu kan du ansluta toohello gateway hello molnet och du är redo tooadd OPC UA servrar toohello lösning.</span><span class="sxs-lookup"><span data-stu-id="a28de-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="a28de-214">Lägga till OPC UA-servrar</span><span class="sxs-lookup"><span data-stu-id="a28de-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="a28de-215">Bläddra toohello **ansluta din egen OPC UA Server** sida i hello anslutna factory lösning portal.</span><span class="sxs-lookup"><span data-stu-id="a28de-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="a28de-216">Följ samma steg som i föregående avsnitt tooestablish hello förtroende mellan hello anslutna factory portal och hello OPC UA server hello.</span><span class="sxs-lookup"><span data-stu-id="a28de-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="a28de-217">Det här steget upprättas ömsesidigt förtroende av hello certifikat från hello ansluten factory portal och hello OPC UA server och skapar en anslutning.</span><span class="sxs-lookup"><span data-stu-id="a28de-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="a28de-218">Bläddra hello OPC UA noder trädet serverns OPC UA, högerklicka på hello OPC noder och välj **publicera**.</span><span class="sxs-lookup"><span data-stu-id="a28de-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="a28de-219">Hello OPC UA server för publishing toowork sätt och hello publisher måste finnas på hello samma nätverk.</span><span class="sxs-lookup"><span data-stu-id="a28de-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="a28de-220">Med andra ord om hello fullständigt kvalificerade domännamnet för hello utgivaren är **publisher.mydomain.com** sedan hello fullständigt kvalificerade domännamnet för hello OPC UA server måste vara, till exempel **myopcuaserver.mydomain.com**. Om din konfiguration skiljer sig, kan du manuellt lägga till noder toohello publishesnodes.json fil hittades i hello **/ delade** mapp.</span><span class="sxs-lookup"><span data-stu-id="a28de-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="a28de-221">Hej publishesnodes.json genereras automatiskt på hello först lyckad publicering av en OPC-nod.</span><span class="sxs-lookup"><span data-stu-id="a28de-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="a28de-222">Telemetri nu flödar från hello gateway-enhet.</span><span class="sxs-lookup"><span data-stu-id="a28de-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="a28de-223">Du kan visa hello telemetri i hello **Factory platser** vy över hello anslutna factory portal under **nya Factory**.</span><span class="sxs-lookup"><span data-stu-id="a28de-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a28de-224">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="a28de-224">Next steps</span></span>

<span data-ttu-id="a28de-225">toolearn mer om hello arkitektur av hello anslutna fabriken förkonfigurerade lösningen, se [anslutna factory förkonfigurerade lösningen genomgången][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="a28de-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker för Windows]: https://www.docker.com/docker-windows
[Azure IoT-enhet katalogen]: https://catalog.azureiotsuite.com/?q=opc
[Azure-portalen]: http://portal.azure.com/
[öppen källkod OPC UA klienten]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Installera Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT kant]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy