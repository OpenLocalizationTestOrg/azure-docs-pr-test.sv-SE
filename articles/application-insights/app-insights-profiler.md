---
title: "Profilering live-webbappar på Azure med Application Insights | Microsoft Docs"
description: "Identifiera hot sökvägen i koden web server med en låg storleken profiler."
services: application-insights
documentationcenter: 
author: CFreemanwa
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/04/2017
ms.author: bwren
ms.openlocfilehash: ff39f9a84b86c14859aaee50ee368643fb2848ea
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="profiling-live-azure-web-apps-with-application-insights"></a><span data-ttu-id="23aa1-103">Profilering live Azure-webbappar med Application Insights</span><span class="sxs-lookup"><span data-stu-id="23aa1-103">Profiling live Azure web apps with Application Insights</span></span>

<span data-ttu-id="23aa1-104">*Den här funktionen av Application Insights är GA för Apptjänster och förhandsgranskning för beräkning.*</span><span class="sxs-lookup"><span data-stu-id="23aa1-104">*This feature of Application Insights is GA for App Services and in preview for Compute.*</span></span>

<span data-ttu-id="23aa1-105">Ta reda på hur mycket tid läggs på varje metod i webbprogrammet live med hjälp av verktyget profilering av [Azure Application Insights](app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="23aa1-105">Find out how much time is spent in each method in your live web application by using the profiling tool of [Azure Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="23aa1-106">Den visas detaljerad profiler för live-frågor som har hanteras av din app och markeras 'varm sökvägen' som används mest tid.</span><span class="sxs-lookup"><span data-stu-id="23aa1-106">It shows you detailed profiles of live requests that were served by your app, and highlights the 'hot path' that is using the most time.</span></span> <span data-ttu-id="23aa1-107">Väljs automatiskt exempel som har olika svarstider.</span><span class="sxs-lookup"><span data-stu-id="23aa1-107">It automatically selects examples that have different response times.</span></span> <span data-ttu-id="23aa1-108">Profileraren använder olika metoder för att minimera kostnader.</span><span class="sxs-lookup"><span data-stu-id="23aa1-108">The profiler uses various techniques to minimize overhead.</span></span>

<span data-ttu-id="23aa1-109">Profileraren fungerar för närvarande för ASP.NET-webbprogram som körs på Azure App Service i minst den grundläggande prisnivån.</span><span class="sxs-lookup"><span data-stu-id="23aa1-109">The profiler currently works for ASP.NET web apps running on Azure App Services, in at least the Basic pricing tier.</span></span> 

<a id="installation"></a>
## <a name="enable-the-profiler"></a><span data-ttu-id="23aa1-110">Aktivera profileraren</span><span class="sxs-lookup"><span data-stu-id="23aa1-110">Enable the profiler</span></span>

<span data-ttu-id="23aa1-111">[Installera Application Insights](app-insights-asp-net.md) i koden.</span><span class="sxs-lookup"><span data-stu-id="23aa1-111">[Install Application Insights](app-insights-asp-net.md) in your code.</span></span> <span data-ttu-id="23aa1-112">Om den redan är installerad, kontrollera att du har den senaste versionen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-112">If it's already installed, make sure you have the latest version.</span></span> <span data-ttu-id="23aa1-113">(Att göra detta, högerklicka på projektet i Solution Explorer och välja hantera NuGet-paket.</span><span class="sxs-lookup"><span data-stu-id="23aa1-113">(To do this, right-click your project in Solution Explorer, and choose Manage NuGet packages.</span></span> <span data-ttu-id="23aa1-114">Välj uppdateringar och alla uppdateringspaket.) Omdistribuera din app.</span><span class="sxs-lookup"><span data-stu-id="23aa1-114">Select Updates and update all packages.) Re-deploy your app.</span></span>

<span data-ttu-id="23aa1-115">*Med hjälp av ASP.NET Core? [Markera den här kryssrutan](#aspnetcore).*</span><span class="sxs-lookup"><span data-stu-id="23aa1-115">*Using ASP.NET Core? [Check here](#aspnetcore).*</span></span>

<span data-ttu-id="23aa1-116">I [https://portal.azure.com](https://portal.azure.com), öppna Application Insights-resurs för webbappen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-116">In [https://portal.azure.com](https://portal.azure.com), open the Application Insights resource for your web app.</span></span> <span data-ttu-id="23aa1-117">Öppna **prestanda** och på **aktivera Application Insights Profiler...** .</span><span class="sxs-lookup"><span data-stu-id="23aa1-117">Open **Performance** and click **Enable Application Insights Profiler...**.</span></span>

![Klicka på Aktivera profileraren banderoll][enable-profiler-banner]

<span data-ttu-id="23aa1-119">Du kan alltid Klicka **konfigurera** för att visa status, aktivera eller inaktivera profileraren.</span><span class="sxs-lookup"><span data-stu-id="23aa1-119">Alternatively, you can always click **Configure** to view status, enable, or disable the Profiler.</span></span>

![Klicka på Konfigurera i bladet prestanda][performance-blade]

<span data-ttu-id="23aa1-121">Webbprogram som är konfigurerade med Application Insights visas på Konfigurera bladet.</span><span class="sxs-lookup"><span data-stu-id="23aa1-121">Web apps that are configured with Application Insights are listed on Configure blade.</span></span> <span data-ttu-id="23aa1-122">Följ instruktionerna för att installera agenten Profiler om det behövs.</span><span class="sxs-lookup"><span data-stu-id="23aa1-122">Follow instructions to install the Profiler agent if needed.</span></span> <span data-ttu-id="23aa1-123">Om inget webbprogram har konfigurerats med Application Insights ännu, klickar du på *Lägg till länkade appar*.</span><span class="sxs-lookup"><span data-stu-id="23aa1-123">If no web app is configured with Application Insights yet, click *Add Linked Apps*.</span></span>

<span data-ttu-id="23aa1-124">Använd den *aktivera profileraren* eller *inaktivera profileraren* knapparna i bladet konfigurera att styra Profiler på alla dina länkade webbprogram.</span><span class="sxs-lookup"><span data-stu-id="23aa1-124">Use the *Enable Profiler* or *Disable Profiler* buttons in the Configure blade to control the Profiler on all your linked web apps.</span></span>



![Konfigurera bladet][linked app services]

<span data-ttu-id="23aa1-126">För att stoppa eller starta om profiler för en enskild App Service-instans, hittar du den **i Apptjänst resursen**i **Webjobs**.</span><span class="sxs-lookup"><span data-stu-id="23aa1-126">To stop or restart the profiler for an individual App Service instance, you'll find it **in the App Service resource**, in **Web Jobs**.</span></span> <span data-ttu-id="23aa1-127">Om du vill ta bort den, tittar du under **tillägg**.</span><span class="sxs-lookup"><span data-stu-id="23aa1-127">To delete it, look under **Extensions**.</span></span>

![Inaktivera profiler för en webb-jobb][disable-profiler-webjob]

<span data-ttu-id="23aa1-129">Vi rekommenderar att du har den profilerare som är aktiverad på alla dina webbprogram för att identifiera eventuella prestandaproblem så snart som möjligt.</span><span class="sxs-lookup"><span data-stu-id="23aa1-129">We recommend that you have the Profiler enabled on all your web apps to discover any performance issues as soon as possible.</span></span>

<span data-ttu-id="23aa1-130">Om du använder WebDeploy för att distribuera ändringarna till ditt webbprogram, kontrollera att du utesluter den **App_Data** mappen tas bort under distributionen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-130">If you use WebDeploy to deploy changes to your web application, ensure that you exclude the **App_Data** folder from being deleted during deployment.</span></span> <span data-ttu-id="23aa1-131">Annars tillägget profileraren filer tas bort när du sedan distribuera webbappen till Azure.</span><span class="sxs-lookup"><span data-stu-id="23aa1-131">Otherwise, the profiler extension's files will be deleted when you next deploy the web application to Azure.</span></span>

### <a name="using-profiler-with-azure-vms-and-compute-resources-preview"></a><span data-ttu-id="23aa1-132">Med hjälp av profiler med Azure Virtual Machines och beräkningsresurser (förhandsgranskning)</span><span class="sxs-lookup"><span data-stu-id="23aa1-132">Using profiler with Azure VMs and Compute resources (preview)</span></span>

<span data-ttu-id="23aa1-133">När du [aktivera Application Insights för Azure app Service vid körning](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), Profiler är automatiskt tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="23aa1-133">When you [enable Application Insights for Azure app services at run time](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), Profiler is automatically available.</span></span> <span data-ttu-id="23aa1-134">(Om du redan har aktiverat Programinsikter för resursen du kan behöva uppdatera till den lates versionen via den **konfigurera** guiden.)</span><span class="sxs-lookup"><span data-stu-id="23aa1-134">(If you already enabled Application Insights for the resource, you might need to update to the lates version through the **Configure** wizard.)</span></span>

<span data-ttu-id="23aa1-135">Det finns en [förhandsversionen av profileraren för Azure Compute resurser](https://go.microsoft.com/fwlink/?linkid=848155).</span><span class="sxs-lookup"><span data-stu-id="23aa1-135">There is a [preview version of the Profiler for Azure Compute resources](https://go.microsoft.com/fwlink/?linkid=848155).</span></span>


## <a name="limits"></a><span data-ttu-id="23aa1-136">Begränsningar</span><span class="sxs-lookup"><span data-stu-id="23aa1-136">Limits</span></span>

<span data-ttu-id="23aa1-137">Standard-datalagring är 5 dagar.</span><span class="sxs-lookup"><span data-stu-id="23aa1-137">The default data retention is 5 days.</span></span> <span data-ttu-id="23aa1-138">Maximal 10 GB inhämtas per dag.</span><span class="sxs-lookup"><span data-stu-id="23aa1-138">Maximum 10 GB ingested per day.</span></span>

<span data-ttu-id="23aa1-139">Det är gratis för tjänsten profiler.</span><span class="sxs-lookup"><span data-stu-id="23aa1-139">There is no charge for the profiler service.</span></span> <span data-ttu-id="23aa1-140">Ditt webbprogram måste vara finns i den grundläggande nivån av App-tjänster.</span><span class="sxs-lookup"><span data-stu-id="23aa1-140">Your web app must be hosted in at least the Basic tier of App Services.</span></span>

## <a name="viewing-profiler-data"></a><span data-ttu-id="23aa1-141">Visa profiler data</span><span class="sxs-lookup"><span data-stu-id="23aa1-141">Viewing profiler data</span></span>

<span data-ttu-id="23aa1-142">Öppna bladet för prestanda och rulla ned till listan med åtgärden.</span><span class="sxs-lookup"><span data-stu-id="23aa1-142">Open the Performance blade and scroll down to the operation list.</span></span>




![Application Insights prestanda bladet exempel kolumn][performance-blade-examples]

<span data-ttu-id="23aa1-144">Kolumner i tabellen är:</span><span class="sxs-lookup"><span data-stu-id="23aa1-144">The columns in the table are:</span></span>

* <span data-ttu-id="23aa1-145">**Antal** -antal dessa begäranden i tidsintervallet på bladet.</span><span class="sxs-lookup"><span data-stu-id="23aa1-145">**Count** - The number of these requests in the time range of the blade.</span></span>
* <span data-ttu-id="23aa1-146">**Medianvärdet** – typiska överföringstiden för din app svara på en begäran.</span><span class="sxs-lookup"><span data-stu-id="23aa1-146">**Median** - The typical time your app takes to respond to a request.</span></span> <span data-ttu-id="23aa1-147">Hälften av alla svar var snabbare än så.</span><span class="sxs-lookup"><span data-stu-id="23aa1-147">Half of all responses were faster than this.</span></span>
* <span data-ttu-id="23aa1-148">**95: e percentilen** 95% av svar var snabbare än så.</span><span class="sxs-lookup"><span data-stu-id="23aa1-148">**95th percentile** 95% of responses were faster than this.</span></span> <span data-ttu-id="23aa1-149">Om denna bild är bland annat medianvärdet, kan det finnas ett tillfälligt problem med din app.</span><span class="sxs-lookup"><span data-stu-id="23aa1-149">If this figure is very different from the median, there might be an intermittent problem with your app.</span></span> <span data-ttu-id="23aa1-150">(Eller det kan förklaras av en design-funktion, till exempel cachelagring.)</span><span class="sxs-lookup"><span data-stu-id="23aa1-150">(Or it might be explained by a design feature such as caching.)</span></span>
* <span data-ttu-id="23aa1-151">**Exempel** -en ikon som indikerar att profileraren har hämtats stackspår för den här åtgärden.</span><span class="sxs-lookup"><span data-stu-id="23aa1-151">**Examples** - an icon indicates that the profiler has captured stack traces for this operation.</span></span>

<span data-ttu-id="23aa1-152">Klicka på ikonen exempel öppna trace explorer.</span><span class="sxs-lookup"><span data-stu-id="23aa1-152">Click the Examples icon to open the trace explorer.</span></span> <span data-ttu-id="23aa1-153">Utforskaren innehåller flera exempel att profileraren har hämtats, klassificeras efter svarstid.</span><span class="sxs-lookup"><span data-stu-id="23aa1-153">The explorer shows several samples that the profiler has captured, classified by response time.</span></span>

<span data-ttu-id="23aa1-154">Välj ett exempel för att visa en kod på objektnivå uppdelning av tid köra begäran.</span><span class="sxs-lookup"><span data-stu-id="23aa1-154">Select a sample to show a code-level breakdown of time spent executing the request.</span></span>

![Application Insights Trace Explorer][trace-explorer]

<span data-ttu-id="23aa1-156">**Visa varm sökvägen** öppnas den största löv nod eller Stäng minst något.</span><span class="sxs-lookup"><span data-stu-id="23aa1-156">**Show hot path** opens the biggest leaf node, or at least something close.</span></span> <span data-ttu-id="23aa1-157">I de flesta fall den här noden inte gränsar till en prestandabegränsning.</span><span class="sxs-lookup"><span data-stu-id="23aa1-157">In most cases this node will be adjacent to a performance bottleneck.</span></span>



* <span data-ttu-id="23aa1-158">**Etiketten**: namnet på den funktion eller en händelse.</span><span class="sxs-lookup"><span data-stu-id="23aa1-158">**Label**: The name of the function or event.</span></span> <span data-ttu-id="23aa1-159">Trädet innehåller en blandning av koden och händelser som inträffade (till exempel SQL- och HTTP-händelser).</span><span class="sxs-lookup"><span data-stu-id="23aa1-159">The tree shows a mix of code and events that occurred (such as SQL and http events).</span></span> <span data-ttu-id="23aa1-160">Händelsen översta representerar varaktighet för begäran.</span><span class="sxs-lookup"><span data-stu-id="23aa1-160">The top event represents the overall request duration.</span></span>
* <span data-ttu-id="23aa1-161">**Förfluten tid**: tidsintervallet mellan start av åtgärden och slut.</span><span class="sxs-lookup"><span data-stu-id="23aa1-161">**Elapsed**: The time interval between the start of the operation and the end.</span></span>
* <span data-ttu-id="23aa1-162">**När**: Visar när funktionen/händelsen körs i förhållande till andra funktioner.</span><span class="sxs-lookup"><span data-stu-id="23aa1-162">**When**: Shows when the function/event was running in relation to other functions.</span></span>

## <a name="how-to-read-performance-data"></a><span data-ttu-id="23aa1-163">Läsa prestandadata</span><span class="sxs-lookup"><span data-stu-id="23aa1-163">How to read performance data</span></span>

<span data-ttu-id="23aa1-164">Microsoft service profiler använder en kombination av urvalsmetoden och instrumentation för att analysera prestandan för ditt program.</span><span class="sxs-lookup"><span data-stu-id="23aa1-164">Microsoft service profiler uses a combination of sampling method and instrumentation to analyze the performance of your application.</span></span>
<span data-ttu-id="23aa1-165">När detaljerad samling pågår prover service profiler instruktionspekaren för den datorn CPU i varje millisekunder.</span><span class="sxs-lookup"><span data-stu-id="23aa1-165">When detailed collection is in progress, service profiler samples the instruction pointer of each of the machine's CPU in every millisecond.</span></span>
<span data-ttu-id="23aa1-166">Varje prov avbildar fullständig anropsstacken för tråden för närvarande körs, ger detaljerad och användbar information om vad som tråden som utfördes på båda hög och låg gjord.</span><span class="sxs-lookup"><span data-stu-id="23aa1-166">Each sample captures the complete call stack of the thread currently executing, giving detailed and useful information about what that thread was doing at both high and low levels of abstraction.</span></span> <span data-ttu-id="23aa1-167">Service profiler samlar även in andra händelser, till exempel kontexten växling händelser, TPL händelser och trådpoolen händelser för att spåra aktivitet korrelation och orsakssamband.</span><span class="sxs-lookup"><span data-stu-id="23aa1-167">Service profiler also collects other events such as context switching events, TPL events, and thread-pool events to track activity correlation and causality.</span></span>

<span data-ttu-id="23aa1-168">Anropsstacken visas i tidslinjevyn är resultatet av provtagning och instrumentation ovan.</span><span class="sxs-lookup"><span data-stu-id="23aa1-168">The call stack shown in the timeline view is the result of the above sampling and instrumentation.</span></span> <span data-ttu-id="23aa1-169">Eftersom varje prov fångar fullständig anropsstacken trådens, inkluderar den kod från .NET framework, samt andra ramverk som du refererar till.</span><span class="sxs-lookup"><span data-stu-id="23aa1-169">Because each sample captures the complete call stack of the thread, it includes code from the .NET framework, as well as other frameworks you reference.</span></span>

### <span data-ttu-id="23aa1-170"><a id="jitnewobj"></a>Objekt-allokering (`clr!JIT\_New or clr!JIT\_Newarr1`)</span><span class="sxs-lookup"><span data-stu-id="23aa1-170"><a id="jitnewobj"></a>Object Allocation (`clr!JIT\_New or clr!JIT\_Newarr1`)</span></span>
<span data-ttu-id="23aa1-171">`clr!JIT\_New and clr!JIT\_Newarr1`är hjälpfunktioner i .NET framework som allokerar minne från hanterad heap.</span><span class="sxs-lookup"><span data-stu-id="23aa1-171">`clr!JIT\_New and clr!JIT\_Newarr1` are helper functions inside .NET framework that allocates memory from managed heap.</span></span> <span data-ttu-id="23aa1-172">`clr!JIT\_New`anropas när ett objekt har allokerats.</span><span class="sxs-lookup"><span data-stu-id="23aa1-172">`clr!JIT\_New` is invoked when an object is allocated.</span></span> <span data-ttu-id="23aa1-173">`clr!JIT\_Newarr1`anropas när en objektmatris allokeras.</span><span class="sxs-lookup"><span data-stu-id="23aa1-173">`clr!JIT\_Newarr1` is invoked when an object array is allocated.</span></span> <span data-ttu-id="23aa1-174">Dessa två funktioner är vanligtvis mycket snabbt och bör ta relativt små lång tid.</span><span class="sxs-lookup"><span data-stu-id="23aa1-174">These two functions are typically very fast and should take relatively small amount of time.</span></span> <span data-ttu-id="23aa1-175">Om du ser `clr!JIT\_New` eller `clr!JIT\_Newarr1` ta en lång tid i tidslinjen, det är en indikation på att koden fördela många objekt och förbruka mycket minne.</span><span class="sxs-lookup"><span data-stu-id="23aa1-175">If you see `clr!JIT\_New` or `clr!JIT\_Newarr1` take a substantial amount of time in your timeline, it's an indication that the code may be allocating many objects and consuming significant amount of memory.</span></span>

### <span data-ttu-id="23aa1-176"><a id="theprestub"></a>Läser in kod (`clr!ThePreStub`)</span><span class="sxs-lookup"><span data-stu-id="23aa1-176"><a id="theprestub"></a>Loading Code (`clr!ThePreStub`)</span></span>
<span data-ttu-id="23aa1-177">`clr!ThePreStub`är en hjälpfunktion i .NET framework som förbereder koden ska köras för första gången.</span><span class="sxs-lookup"><span data-stu-id="23aa1-177">`clr!ThePreStub` is a helper function inside .NET framework that prepares the code to execute for the first time.</span></span> <span data-ttu-id="23aa1-178">Detta innefattar vanligtvis sådana, men inte begränsat till, JIT (Just i tid)-kompilering.</span><span class="sxs-lookup"><span data-stu-id="23aa1-178">This typically includes, but not limited to, JIT (Just In Time) compilation.</span></span> <span data-ttu-id="23aa1-179">För varje C#-metoden `clr!ThePreStub` ska anropas en gång under livslängden för en process.</span><span class="sxs-lookup"><span data-stu-id="23aa1-179">For each C# method, `clr!ThePreStub` should be invoked at most once during the lifetime of a process.</span></span>

<span data-ttu-id="23aa1-180">Om du ser `clr!ThePreStub` tar lång tid en begäran anger att begäran är den första som kör den metoden och tiden för körningen av .NET framework att läsa in den här metoden är viktig.</span><span class="sxs-lookup"><span data-stu-id="23aa1-180">If you see `clr!ThePreStub` takes significant amount of time for a request, it indicates that request is the first one that executes that method, and the time for .NET framework runtime to load that method is significant.</span></span> <span data-ttu-id="23aa1-181">Du kan överväga en värmts process som körs som del av koden innan användarna åtkomst till den eller Överväg att köra NGen på din sammansättningar.</span><span class="sxs-lookup"><span data-stu-id="23aa1-181">You can consider a warm-up process that executes that portion of the code before your users access it, or consider running NGen on your assemblies.</span></span>

### <span data-ttu-id="23aa1-182"><a id="lockcontention"></a>Låskonkurrens (`clr!JITutil\_MonContention` eller `clr!JITutil\_MonEnterWorker`)</span><span class="sxs-lookup"><span data-stu-id="23aa1-182"><a id="lockcontention"></a>Lock Contention (`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker`)</span></span>
<span data-ttu-id="23aa1-183">`clr!JITutil\_MonContention`eller `clr!JITutil\_MonEnterWorker` indikerar den aktuella tråden väntar på att en låsas upp.</span><span class="sxs-lookup"><span data-stu-id="23aa1-183">`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker` indicate the current thread is waiting for a lock to be released.</span></span> <span data-ttu-id="23aa1-184">Detta normalt visas när du kör en C# lock-instruktion, startar Monitor.Enter metod eller anropa en metod med attributet MethodImplOptions.Synchronized.</span><span class="sxs-lookup"><span data-stu-id="23aa1-184">This typically shows up when executing a C# lock statement, invoking Monitor.Enter method, or invoking a method with MethodImplOptions.Synchronized attribute.</span></span> <span data-ttu-id="23aa1-185">Låskonkurrens inträffar oftast när tråden A hämtar ett lås och tråd B försöker hämta samma låset innan tråd A släpper den.</span><span class="sxs-lookup"><span data-stu-id="23aa1-185">Lock contention typically happens when thread A acquires a lock, and thread B tries to acquire the same lock before thread A releases it.</span></span>

### <span data-ttu-id="23aa1-186"><a id="ngencold"></a>Läser in kod (`[COLD]`)</span><span class="sxs-lookup"><span data-stu-id="23aa1-186"><a id="ngencold"></a>Loading code (`[COLD]`)</span></span>
<span data-ttu-id="23aa1-187">Om metodnamnet innehåller `[COLD]`, som `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, innebär det att .NET framework-körningen kör kod som inte är optimerad av <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profil interaktiv optimering</a> för första gången.</span><span class="sxs-lookup"><span data-stu-id="23aa1-187">If the method name contains `[COLD]`, such as `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, it means that the .NET framework runtime is executing code that is not optimized by <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profile-guided optimization</a> for the first time.</span></span> <span data-ttu-id="23aa1-188">För varje metod ska det visas högst en gång under livslängden för processen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-188">For each method, it should show up at most once during the lifetime of the process.</span></span>

<span data-ttu-id="23aa1-189">Om inläsning av koden tar lång tid en begäran, anger att begäran är den första att köra den icke-optimerad delen av metoden.</span><span class="sxs-lookup"><span data-stu-id="23aa1-189">If loading code takes significant amount of time for a request, it indicates that request is the first one to execute the unoptimized portion of the method.</span></span> <span data-ttu-id="23aa1-190">Du kan överväga en varmt in process som körs som del av koden innan användarna åtkomst till den.</span><span class="sxs-lookup"><span data-stu-id="23aa1-190">You can consider a warm up process that executes that portion of the code before your users access it.</span></span>

### <span data-ttu-id="23aa1-191"><a id="httpclientsend"></a>Skicka HTTP-begäran</span><span class="sxs-lookup"><span data-stu-id="23aa1-191"><a id="httpclientsend"></a>Send HTTP Request</span></span>
<span data-ttu-id="23aa1-192">Metoder som `HttpClient.Send` ange koden som väntar på att en HTTP-begäran att slutföra.</span><span class="sxs-lookup"><span data-stu-id="23aa1-192">Methods such as `HttpClient.Send` indicate the code is waiting for a HTTP request to complete.</span></span>

### <span data-ttu-id="23aa1-193"><a id="sqlcommand"></a>Databasåtgärden</span><span class="sxs-lookup"><span data-stu-id="23aa1-193"><a id="sqlcommand"></a>Database Operation</span></span>
<span data-ttu-id="23aa1-194">Metoden, till exempel SqlCommand.Execute anger koden väntar på en databasåtgärd ska slutföras.</span><span class="sxs-lookup"><span data-stu-id="23aa1-194">Method such as SqlCommand.Execute indicates the code is waiting for a database operation to complete.</span></span>

### <span data-ttu-id="23aa1-195"><a id="await"></a>Väntar på (`AWAIT\_TIME`)</span><span class="sxs-lookup"><span data-stu-id="23aa1-195"><a id="await"></a>Waiting (`AWAIT\_TIME`)</span></span>
<span data-ttu-id="23aa1-196">`AWAIT\_TIME`Anger kod som väntar på en annan aktivitet ska slutföras.</span><span class="sxs-lookup"><span data-stu-id="23aa1-196">`AWAIT\_TIME` indicates the code is waiting for another task to complete.</span></span> <span data-ttu-id="23aa1-197">Detta inträffar vanligtvis med C#-await-instruktionen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-197">This typically happens with C# 'await' statement.</span></span> <span data-ttu-id="23aa1-198">När koden har en C#-await-tråden unwinds och returnerar kontrollen till trådpoolen och det finns ingen tråd blockeras väntar på 'await' om du vill avsluta.</span><span class="sxs-lookup"><span data-stu-id="23aa1-198">When the code does a C# 'await', the thread unwinds and returns control to the thread-pool, and there is no thread that is blocked waiting for the 'await' to finish.</span></span> <span data-ttu-id="23aa1-199">Dock blockeras logiskt tråden som gjorde await' ”väntar på att åtgärden har slutförts.</span><span class="sxs-lookup"><span data-stu-id="23aa1-199">However, logically the thread that did the await is 'blocked' waiting for the operation to complete.</span></span> <span data-ttu-id="23aa1-200">Den `AWAIT\_TIME` anger blockerade väntar på att åtgärden har slutförts.</span><span class="sxs-lookup"><span data-stu-id="23aa1-200">The `AWAIT\_TIME` indicates the blocked time waiting for the task to complete.</span></span>

### <span data-ttu-id="23aa1-201"><a id="block"></a>Blockerade tid</span><span class="sxs-lookup"><span data-stu-id="23aa1-201"><a id="block"></a>Blocked Time</span></span>
<span data-ttu-id="23aa1-202">`BLOCKED_TIME`Anger kod som väntar på en annan resursen ska vara tillgängliga, till exempel väntar på ett synkroniseringsobjekt väntar på en tråd ska vara tillgängliga eller väntar på att en begäran om att avsluta.</span><span class="sxs-lookup"><span data-stu-id="23aa1-202">`BLOCKED_TIME` indicates the code is waiting for another resource to be available, such as waiting for a synchronization object, waiting for a thread to be available, or waiting for a request to finish.</span></span>

### <span data-ttu-id="23aa1-203"><a id="cpu"></a>CPU-tid</span><span class="sxs-lookup"><span data-stu-id="23aa1-203"><a id="cpu"></a>CPU Time</span></span>
<span data-ttu-id="23aa1-204">Processorn är upptagen med att köra instruktionerna.</span><span class="sxs-lookup"><span data-stu-id="23aa1-204">The CPU is busy executing the instructions.</span></span>

### <span data-ttu-id="23aa1-205"><a id="disk"></a>Disktid i procent</span><span class="sxs-lookup"><span data-stu-id="23aa1-205"><a id="disk"></a>Disk Time</span></span>
<span data-ttu-id="23aa1-206">Programmet utför diskåtgärder.</span><span class="sxs-lookup"><span data-stu-id="23aa1-206">The application is performing disk operations.</span></span>

### <span data-ttu-id="23aa1-207"><a id="network"></a>Network Time</span><span class="sxs-lookup"><span data-stu-id="23aa1-207"><a id="network"></a>Network Time</span></span>
<span data-ttu-id="23aa1-208">Programmet utför nätverksåtgärder.</span><span class="sxs-lookup"><span data-stu-id="23aa1-208">The application is performing network operations.</span></span>

### <span data-ttu-id="23aa1-209"><a id="when"></a>När kolumnen</span><span class="sxs-lookup"><span data-stu-id="23aa1-209"><a id="when"></a>When column</span></span>
<span data-ttu-id="23aa1-210">Det här är en visualisering av hur INKLUSIVA exemplen som samlas in för en nod variera över tid.</span><span class="sxs-lookup"><span data-stu-id="23aa1-210">This is a visualization of how the INCLUSIVE samples collected for a node vary over time.</span></span> <span data-ttu-id="23aa1-211">Det totala intervallet för begäran är uppdelat i 32 tid buckets och inklusiva exemplen för noden ackumuleras till dessa 32 buckets.</span><span class="sxs-lookup"><span data-stu-id="23aa1-211">The total range of the request is divided into 32 time buckets and the inclusive samples for that node are accumulated into those 32 buckets.</span></span> <span data-ttu-id="23aa1-212">Varje bucket sedan representeras som en stapel vars höjd representerar ett skalade värde.</span><span class="sxs-lookup"><span data-stu-id="23aa1-212">Each bucket is then represented as a bar whose height represents a scaled value.</span></span> <span data-ttu-id="23aa1-213">För markerade noder `CPU_TIME` eller `BLOCKED_TIME`, eller om det finns en tydlig relationen mellan förbrukar en resurs (cpu, disk, tråd), i fältet representerar förbrukar en av dessa resurser för att bucket tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="23aa1-213">For nodes marked `CPU_TIME` or `BLOCKED_TIME`, or where there is an obvious relationship of consuming a resource (cpu, disk, thread), the bar represents consuming one of those resources for the period of time of that bucket.</span></span> <span data-ttu-id="23aa1-214">De här måtten kan du få mer än 100% genom att använda flera resurser.</span><span class="sxs-lookup"><span data-stu-id="23aa1-214">For these metrics you can get greater than 100% by consuming multiple resources.</span></span> <span data-ttu-id="23aa1-215">Till exempel om i genomsnitt du använder två processorer via ett intervall som får sedan du 200%.</span><span class="sxs-lookup"><span data-stu-id="23aa1-215">For example, if on average you use two CPUs over an interval then you get 200%.</span></span>


## <span data-ttu-id="23aa1-216"><a id="troubleshooting"></a>Felsökning</span><span class="sxs-lookup"><span data-stu-id="23aa1-216"><a id="troubleshooting"></a>Troubleshooting</span></span>

### <a name="how-can-i-know-whether-application-insights-profiler-is-running"></a><span data-ttu-id="23aa1-217">Hur vet jag om Application Insights profiler körs?</span><span class="sxs-lookup"><span data-stu-id="23aa1-217">How can I know whether Application Insights profiler is running?</span></span>

<span data-ttu-id="23aa1-218">Profileraren körs som en kontinuerlig web-jobb i webbprogrammet.</span><span class="sxs-lookup"><span data-stu-id="23aa1-218">The profiler runs as a continuous web job in Web App.</span></span> <span data-ttu-id="23aa1-219">Du kan öppna resursen webbprogram i https://portal.azure.com och kontrollera statusen för ”ApplicationInsightsProfiler” i bladet WebJobs.</span><span class="sxs-lookup"><span data-stu-id="23aa1-219">You can open the Web App resource in https://portal.azure.com and check "ApplicationInsightsProfiler" status in the WebJobs blade.</span></span> <span data-ttu-id="23aa1-220">Om den inte körs, öppna **loggar** vill veta mer.</span><span class="sxs-lookup"><span data-stu-id="23aa1-220">If it isn't running, open **Logs** to find out more.</span></span>

### <a name="why-cant-i-find-any-stack-examples-even-though-the-profiler-is-running"></a><span data-ttu-id="23aa1-221">Varför hittar inte någon stack-exempel trots att profileraren körs?</span><span class="sxs-lookup"><span data-stu-id="23aa1-221">Why can't I find any stack examples even though the profiler is running?</span></span>

<span data-ttu-id="23aa1-222">Här följer några saker du kan kontrollera.</span><span class="sxs-lookup"><span data-stu-id="23aa1-222">Here are a few things you can check.</span></span>

1. <span data-ttu-id="23aa1-223">Se till att din Web App Service-Plan grundläggande nivån och högre.</span><span class="sxs-lookup"><span data-stu-id="23aa1-223">Make sure your Web App Service Plan is Basic tier and above.</span></span>
2. <span data-ttu-id="23aa1-224">Kontrollera att ditt webbprogram har Application Insights SDK 2.2 Beta och ovan aktiverad.</span><span class="sxs-lookup"><span data-stu-id="23aa1-224">Make sure your Web App has Application Insights SDK 2.2 Beta and above enabled.</span></span>
3. <span data-ttu-id="23aa1-225">Kontrollera att ditt webbprogram har inställningen APPINSIGHTS_INSTRUMENTATIONKEY med samma instrumentation nyckel som används av Application Insights SDK.</span><span class="sxs-lookup"><span data-stu-id="23aa1-225">Make sure your Web App has the APPINSIGHTS_INSTRUMENTATIONKEY setting with the same instrumentation key used by Application Insights SDK.</span></span>
4. <span data-ttu-id="23aa1-226">Kontrollera att ditt webbprogram som körs på .net Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="23aa1-226">Make sure your Web App is running on .Net Framework 4.6.</span></span>
5. <span data-ttu-id="23aa1-227">Om det är ett ASP.NET Core-program kan också kontrollera [de nödvändiga beroendena](#aspnetcore).</span><span class="sxs-lookup"><span data-stu-id="23aa1-227">If it's an ASP.NET Core application, please also check [the required dependencies](#aspnetcore).</span></span>

<span data-ttu-id="23aa1-228">Finns en kort värmts period när profileraren aktivt samlar in spårningar för flera prestanda när profileraren har startats.</span><span class="sxs-lookup"><span data-stu-id="23aa1-228">After the profiler is started, there is a short warm-up period when the profiler actively collects several performance traces.</span></span> <span data-ttu-id="23aa1-229">Samlar in prestanda spårningar i två minuter i varje timme efter att profileraren.</span><span class="sxs-lookup"><span data-stu-id="23aa1-229">After that, the profiler collects performance traces for two minutes in every hour.</span></span>  

### <a name="i-was-using-azure-service-profiler-what-happened-to-it"></a><span data-ttu-id="23aa1-230">Jag använde Azure Service Profiler.</span><span class="sxs-lookup"><span data-stu-id="23aa1-230">I was using Azure Service Profiler.</span></span> <span data-ttu-id="23aa1-231">Vad hände med den?</span><span class="sxs-lookup"><span data-stu-id="23aa1-231">What happened to it?</span></span>  

<span data-ttu-id="23aa1-232">När du aktiverar Application Insights profileraren har Azure Service Profiler-agenten inaktiverats.</span><span class="sxs-lookup"><span data-stu-id="23aa1-232">When you enable Application Insights Profiler, Azure Service Profiler agent is disabled.</span></span>

### <span data-ttu-id="23aa1-233"><a id="double-counting"></a>Dubbel inventering i parallella trådar</span><span class="sxs-lookup"><span data-stu-id="23aa1-233"><a id="double-counting"></a>Double counting in parallel threads</span></span>

<span data-ttu-id="23aa1-234">I vissa fall är totala tidsmått i visningsprogrammet för stacken större än den verkliga varaktigheten av begäran.</span><span class="sxs-lookup"><span data-stu-id="23aa1-234">In some cases the total time metric in the stack viewer is more than the actual duration of the request.</span></span>

<span data-ttu-id="23aa1-235">Detta kan inträffa när det finns två eller flera trådar som är associerade med en begäran körs parallellt.</span><span class="sxs-lookup"><span data-stu-id="23aa1-235">This can happen when there are two or more threads associated with a request, operating in parallel.</span></span> <span data-ttu-id="23aa1-236">Den totala tråd tiden är sedan mer än tid som gått.</span><span class="sxs-lookup"><span data-stu-id="23aa1-236">The total thread time is then more than the elapsed time.</span></span> <span data-ttu-id="23aa1-237">I många fall kan du väntar på en tråd på den andra ska slutföras.</span><span class="sxs-lookup"><span data-stu-id="23aa1-237">In many cases one thread may be waiting on the other to complete.</span></span> <span data-ttu-id="23aa1-238">Visningsprogrammet försöker identifiera detta och utelämna ointressanta vänta, men överför kanten av visar för mycket i stället för att utelämna vad som kan vara viktig information.</span><span class="sxs-lookup"><span data-stu-id="23aa1-238">The viewer tries to detect this and omit the uninteresting wait, but errs on the side of showing too much rather than omitting what may be critical information.</span></span>  

<span data-ttu-id="23aa1-239">När du ser parallella trådar i dina spår måste du bestämma vilka trådar som väntar på och identifiera kritiska för begäran.</span><span class="sxs-lookup"><span data-stu-id="23aa1-239">When you see parallel threads in your traces, you need to determine which threads are waiting so you can determine the critical path for the request.</span></span> <span data-ttu-id="23aa1-240">I de flesta fall är helt enkelt tråden som snabbt försätts i tillståndet vänta väntar på andra trådar.</span><span class="sxs-lookup"><span data-stu-id="23aa1-240">In most cases, the thread that quickly goes into a wait state is simply waiting on the other threads.</span></span> <span data-ttu-id="23aa1-241">Koncentrera dig på de andra och ignorera tiden i väntande trådar.</span><span class="sxs-lookup"><span data-stu-id="23aa1-241">Concentrate on the others and ignore the time in the waiting threads.</span></span>

### <span data-ttu-id="23aa1-242"><a id="issue-loading-trace-in-viewer"></a>Inga profildata</span><span class="sxs-lookup"><span data-stu-id="23aa1-242"><a id="issue-loading-trace-in-viewer"></a>No profiling data</span></span>

1. <span data-ttu-id="23aa1-243">Om de data som du försöker visa är äldre än några veckor, begränsa tiden filtret och försök igen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-243">If the data you are trying to view is older than a couple of weeks, try limiting your time filter and try again.</span></span>

2. <span data-ttu-id="23aa1-244">Kontrollera att proxyservrar eller en brandvägg har inte blockerat åtkomsten till https://gateway.azureserviceprofiler.net.</span><span class="sxs-lookup"><span data-stu-id="23aa1-244">Check that proxies or a firewall have not blocked access to https://gateway.azureserviceprofiler.net.</span></span>

3. <span data-ttu-id="23aa1-245">Kontrollera att du använder i appen Application Insights instrumentation nyckeln är samma som du har aktiverat profilering med Application Insights-resursen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-245">Check that the Application Insights instrumentation key you are using in your app is the same as the Application Insights resource you've enabled profiling with.</span></span> <span data-ttu-id="23aa1-246">Nyckeln är vanligtvis i ApplicationInsights.config men finns också i web.config eller app.config.</span><span class="sxs-lookup"><span data-stu-id="23aa1-246">The key is usually in ApplicationInsights.config but can also be found in web.config or app.config.</span></span>

### <a name="error-report-in-the-profiling-viewer"></a><span data-ttu-id="23aa1-247">Felrapport i visningsprogrammet för profilering</span><span class="sxs-lookup"><span data-stu-id="23aa1-247">Error report in the profiling viewer</span></span>

<span data-ttu-id="23aa1-248">Filen ett supportärende från portalen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-248">File a support ticket from the portal.</span></span> <span data-ttu-id="23aa1-249">Inkludera Korrelations-ID i felmeddelandet.</span><span class="sxs-lookup"><span data-stu-id="23aa1-249">Please include the correlation ID from the error message.</span></span>

## <a name="manual-installation"></a><span data-ttu-id="23aa1-250">Manuell installation</span><span class="sxs-lookup"><span data-stu-id="23aa1-250">Manual installation</span></span>

<span data-ttu-id="23aa1-251">När du konfigurerar profileraren görs följande uppdateringar till Webbappens inställningar.</span><span class="sxs-lookup"><span data-stu-id="23aa1-251">When you configure the profiler, the following updates are made to the Web App's settings.</span></span> <span data-ttu-id="23aa1-252">Du kan göra dem själv manuellt om din miljö kräver, till exempel om programmet körs i Azure App Service miljö (ASE):</span><span class="sxs-lookup"><span data-stu-id="23aa1-252">You can do them yourself manually if your environment requires, for example, if your application runs in Azure App Service Environment (ASE):</span></span>

1. <span data-ttu-id="23aa1-253">Öppna inställningar i bladet web app kontroll.</span><span class="sxs-lookup"><span data-stu-id="23aa1-253">In the web app control blade, open Settings.</span></span>
2. <span data-ttu-id="23aa1-254">Ange ”.net Framework-version” till v4.6.</span><span class="sxs-lookup"><span data-stu-id="23aa1-254">Set ".Net Framework version" to v4.6.</span></span>
3. <span data-ttu-id="23aa1-255">Värdet ”alltid på” på.</span><span class="sxs-lookup"><span data-stu-id="23aa1-255">Set "Always On" to On.</span></span>
4. <span data-ttu-id="23aa1-256">Lägga till appinställningen ”__APPINSIGHTS_INSTRUMENTATIONKEY__” och ange värdet till samma instrumentation nyckel som används av SDK.</span><span class="sxs-lookup"><span data-stu-id="23aa1-256">Add app setting "__APPINSIGHTS_INSTRUMENTATIONKEY__" and set the value to the same instrumentation key used by the SDK.</span></span>
5. <span data-ttu-id="23aa1-257">Öppna avancerade verktyg.</span><span class="sxs-lookup"><span data-stu-id="23aa1-257">Open Advanced Tools.</span></span>
6. <span data-ttu-id="23aa1-258">Klicka på ”Gå” för att öppna Kudu-webbplatsen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-258">Click "Go" to open the Kudu website.</span></span>
7. <span data-ttu-id="23aa1-259">Välj ”webbplatstillägg” i Kudu-webbplatsen.</span><span class="sxs-lookup"><span data-stu-id="23aa1-259">In the Kudu website, select "Site extensions".</span></span>
8. <span data-ttu-id="23aa1-260">Installera ”__Programinsikter__” från galleriet.</span><span class="sxs-lookup"><span data-stu-id="23aa1-260">Install "__Application Insights__" from Gallery.</span></span>
9. <span data-ttu-id="23aa1-261">Starta om webbprogrammet.</span><span class="sxs-lookup"><span data-stu-id="23aa1-261">Restart the web app.</span></span>

## <span data-ttu-id="23aa1-262"><a id="aspnetcore"></a>ASP.NET Core-stöd</span><span class="sxs-lookup"><span data-stu-id="23aa1-262"><a id="aspnetcore"></a>ASP.NET Core Support</span></span>

<span data-ttu-id="23aa1-263">ASP.NET Core programmet behöver installera Microsoft.ApplicationInsights.AspNetCore Nuget-paketet 2.1.0-beta6 eller högre för att fungera med profileraren.</span><span class="sxs-lookup"><span data-stu-id="23aa1-263">ASP.NET Core application needs to install Microsoft.ApplicationInsights.AspNetCore Nuget package 2.1.0-beta6 or higher to work with the Profiler.</span></span> <span data-ttu-id="23aa1-264">Vi stöder inte längre lägre versioner efter 6/27/2017.</span><span class="sxs-lookup"><span data-stu-id="23aa1-264">We no longer support the lower versions after 6/27/2017.</span></span>

## <a name="next-steps"></a><span data-ttu-id="23aa1-265">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="23aa1-265">Next steps</span></span>

* [<span data-ttu-id="23aa1-266">Arbeta med Application Insights i Visual Studio</span><span class="sxs-lookup"><span data-stu-id="23aa1-266">Working with Application Insights in Visual Studio</span></span>](https://docs.microsoft.com/azure/application-insights/app-insights-visual-studio)

[performance-blade]: ./media/app-insights-profiler/performance-blade.png
[performance-blade-examples]: ./media/app-insights-profiler/performance-blade-examples.png
[trace-explorer]: ./media/app-insights-profiler/trace-explorer.png
[trace-explorer-toolbar]: ./media/app-insights-profiler/trace-explorer-toolbar.png
[trace-explorer-hint-tip]: ./media/app-insights-profiler/trace-explorer-hint-tip.png
[trace-explorer-hot-path]: ./media/app-insights-profiler/trace-explorer-hot-path.png
[enable-profiler-banner]: ./media/app-insights-profiler/enable-profiler-banner.png
[disable-profiler-webjob]: ./media/app-insights-profiler/disable-profiler-webjob.png
[linked app services]: ./media/app-insights-profiler/linked-app-services.png
