---
title: "aaaService primär autentisering för API Apps i Azure App Service | Microsoft Docs"
description: "Lär dig hur tooprotect en API-app i Azure App Service för scenarier med tjänst-till-tjänst."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="97c3c-103">Tjänstens huvudnamn autentisering för API Apps i Azure App Service</span><span class="sxs-lookup"><span data-stu-id="97c3c-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="97c3c-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="97c3c-104">Overview</span></span>
<span data-ttu-id="97c3c-105">Den här artikeln förklarar hur toouse Apptjänst autentisering för *interna* åt tooAPI appar.</span><span class="sxs-lookup"><span data-stu-id="97c3c-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="97c3c-106">Ett internt scenario är där du har en API-app som du vill toobe kan användas endast av egna programkod.</span><span class="sxs-lookup"><span data-stu-id="97c3c-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="97c3c-107">hello rekommenderat sätt tooimplement det här scenariot i App Service toouse Azure AD tooprotect hello kallas API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="97c3c-108">Du kan anropa hello skyddade API-app med en ägartoken som du får från Azure AD genom att tillhandahålla Programidentitet (tjänstens huvudnamn) autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="97c3c-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="97c3c-109">Alternativ toousing Azure AD finns hello **tjänst-till-tjänst autentisering** avsnitt i hello [översikt över Azure App Service-autentisering](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="97c3c-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="97c3c-110">I den här artikeln lär du dig:</span><span class="sxs-lookup"><span data-stu-id="97c3c-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="97c3c-111">Hur toouse Azure Active Directory (AD Azure) tooprotect en API-app från oautentiserad åtkomst.</span><span class="sxs-lookup"><span data-stu-id="97c3c-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="97c3c-112">Hur tooconsume skyddade API-app från en API-app, webbapp eller mobilapp med hjälp av autentiseringsuppgifter för Azure AD service principal (app identitet).</span><span class="sxs-lookup"><span data-stu-id="97c3c-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="97c3c-113">Information om hur tooconsume från en logikapp finns [använda anpassat API som finns på Apptjänst med Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="97c3c-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="97c3c-114">Hur toomake till att hello skyddade API-appen kan inte anropas från en webbläsare med inloggade användare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="97c3c-115">Hur toomake till att hello skyddade API-app kan endast anropas med en specifik Azure AD tjänstens huvudnamn.</span><span class="sxs-lookup"><span data-stu-id="97c3c-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="97c3c-116">hello artikeln innehåller två avsnitt:</span><span class="sxs-lookup"><span data-stu-id="97c3c-116">hello article contains two sections:</span></span>

* <span data-ttu-id="97c3c-117">Hej [hur tooconfigure service principal autentisering i Azure App Service](#authconfig) förklaras i allmänna hur tooconfigure autentisering för API-app och hur tooconsume hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="97c3c-118">Det här avsnittet gäller även tooall ramverk som stöds av Apptjänsten, inklusive .NET, Node.js och Java.</span><span class="sxs-lookup"><span data-stu-id="97c3c-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="97c3c-119">Från och med hello [fortsätter hello .NET komma igång-Självstudier](#tutorialstart) avsnittet hello kursen hjälper dig att konfigurera ett ”intern åtkomst” scenario för en .NET-exempelprogram som körs i Apptjänst.</span><span class="sxs-lookup"><span data-stu-id="97c3c-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="97c3c-120"><a id="authconfig"></a>Hur tooconfigure service principal autentisering i Azure App Service</span><span class="sxs-lookup"><span data-stu-id="97c3c-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="97c3c-121">Det här avsnittet innehåller allmänna anvisningar som gäller tooany API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="97c3c-122">För steg specifika toohello tooDo lista .NET exempelprogrammet gå för[fortsätter hello .NET API Apps självstudiekursen serien](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="97c3c-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="97c3c-123">I hello [Azure-portalen](https://portal.azure.com/), navigera toohello **inställningar** bladet hello API-appen som du vill tooprotect och hitta hello **funktioner** avsnittet och klicka på **Autentisering / auktorisering**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Autentisering/auktorisering i Azure-portalen](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="97c3c-125">I hello **autentisering / auktorisering** bladet, klickar du på **på**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="97c3c-126">I hello **åtgärd tootake när begäran inte har autentiserats** listrutan, Välj **logga in med Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="97c3c-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="97c3c-127">Under **autentiseringsproviders**väljer **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Autentisering/auktorisering i bladet i Azure-portalen](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="97c3c-129">Konfigurera hello **inställningarna för Azure Active Directory** bladet toocreate en ny Azure AD-program eller Använd ett befintligt Azure AD-program om du redan har en som du vill toouse.</span><span class="sxs-lookup"><span data-stu-id="97c3c-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="97c3c-130">Internt scenarier innebär vanligen en API-app som anropar en API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="97c3c-131">Du kan använda separata Azure AD-program för varje API-app eller en Azure AD-program.</span><span class="sxs-lookup"><span data-stu-id="97c3c-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="97c3c-132">Detaljerad information om det här bladet finns [hur tooconfigure Apptjänst programmet toouse Azure Active Directory inloggningen](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="97c3c-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="97c3c-133">När du är klar med hello authentication provider configuration bladet, klickar du på **OK**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="97c3c-134">I hello **autentisering / auktorisering** bladet, klickar du på **spara**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Klicka på Spara](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="97c3c-136">När det är klart gör Apptjänst endast begäranden från anropare i hello konfigurerat Azure AD-klient.</span><span class="sxs-lookup"><span data-stu-id="97c3c-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="97c3c-137">Ingen autentisering eller auktorisering kod krävs i hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="97c3c-138">hello ägartoken skickas toohello API-app tillsammans med vanliga anspråk i HTTP-rubriker, och du kan läsa informationen i koden toovalidate som begäranden från en viss anropare, till exempel ett huvudnamn för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="97c3c-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="97c3c-139">Det här autentisering fungerar hello samma sätt för alla språk som apptjänst, inklusive .NET, Node.js och Java.</span><span class="sxs-lookup"><span data-stu-id="97c3c-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="97c3c-140">Hur tooconsume hello skyddade API-app</span><span class="sxs-lookup"><span data-stu-id="97c3c-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="97c3c-141">hello anroparen måste ange en Azure AD ägar-token med API-anrop.</span><span class="sxs-lookup"><span data-stu-id="97c3c-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="97c3c-142">tooget ägartoken med hjälp av service principal autentiseringsuppgifter, hello anroparen använder Active Directory Authentication Library (ADAL för [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), eller [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="97c3c-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="97c3c-143">tooget en token hello-kod som anropar ADAL ger tooADAL hello följande information:</span><span class="sxs-lookup"><span data-stu-id="97c3c-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="97c3c-144">hello namnet på din Azure AD-klient.</span><span class="sxs-lookup"><span data-stu-id="97c3c-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="97c3c-145">hello-ID och klienten klienthemlighet (app-nyckel) av hello Azure AD-app som är associerade med hello anroparen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="97c3c-146">hello klient-ID för hello Azure AD-program som är associerade med hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="97c3c-147">(Om en Azure AD-program används det här är hello samma klient-ID som hello en för hello anroparen.)</span><span class="sxs-lookup"><span data-stu-id="97c3c-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="97c3c-148">Dessa värden är tillgängliga i hello Azure AD-sidor i hello [klassiska Azure-portalen](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="97c3c-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="97c3c-149">När hello token har erhållits inkluderar hello anroparen den med HTTP-förfrågningar i hello Authorization-huvud.</span><span class="sxs-lookup"><span data-stu-id="97c3c-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="97c3c-150">Apptjänst validerar hello token och tillåter hello begäranden tooreach hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="97c3c-151">Hur tooprotect hello API-app från åtkomst av användare i hello samma klient</span><span class="sxs-lookup"><span data-stu-id="97c3c-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="97c3c-152">Ägar-token för användare i samma klient betraktas som giltigt för hello hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="97c3c-153">Om du vill tooensure som bara en tjänst som kan anropa hello skyddade API-app, Lägg till kod i hello skyddade API app toovalidate hello följande anspråk från token hello:</span><span class="sxs-lookup"><span data-stu-id="97c3c-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="97c3c-154">`appid`bör vara hello klient-ID för hello Azure AD-program som är associerad med hello anroparen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="97c3c-155">`oid`(`objectidentifier`) ska vara hello service ägar-ID för hello anroparen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="97c3c-156">Apptjänst innehåller också hello `objectidentifier` anspråk i hello X-MS-CLIENT-SÄKERHETSOBJEKT-ID-huvudet.</span><span class="sxs-lookup"><span data-stu-id="97c3c-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="97c3c-157">Hur tooprotect hello API-app från webbläsaråtkomst</span><span class="sxs-lookup"><span data-stu-id="97c3c-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="97c3c-158">Om du inte verifiera anspråk i koden i hello skyddade API-app och om du använder en separat Azure AD-program för hello skyddade API-app, se till att hello Azure AD-program svars-URL: en är inte hello samma som hello bas-URL för API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="97c3c-159">Om hello Reply URL pekar direkt toohello skyddade API-app, en användare i hello samma Azure AD-klient Bläddra toohello API-app, logga in och anropa hello API.</span><span class="sxs-lookup"><span data-stu-id="97c3c-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="97c3c-160"><a id="tutorialstart"></a>Fortsätter hello .NET API Apps självstudiekursen serien</span><span class="sxs-lookup"><span data-stu-id="97c3c-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="97c3c-161">Om du följer hello Node.js eller Java självstudiekursen serier för API apps, hoppar du över toohello [nästa steg](#next-steps) avsnitt.</span><span class="sxs-lookup"><span data-stu-id="97c3c-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="97c3c-162">hello resten av den här artikeln fortsätter hello .NET API Apps självstudiekursen serien och förutsätter att du har slutfört hello [användaren autentisering kursen](app-service-api-dotnet-user-principal-auth.md) och ha hello exempelprogram som körs i Azure med autentisering av användare aktiverad.</span><span class="sxs-lookup"><span data-stu-id="97c3c-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="97c3c-163">Konfigurera autentisering i Azure</span><span class="sxs-lookup"><span data-stu-id="97c3c-163">Set up authentication in Azure</span></span>
<span data-ttu-id="97c3c-164">I det här avsnittet konfigurerar du Apptjänst så att endast HTTP-begäranden kan tooreach hello API-appen på datanivå hello är hello de som har en giltig Azure AD-ägar-token.</span><span class="sxs-lookup"><span data-stu-id="97c3c-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="97c3c-165">I följande avsnitt hello, konfigurerar hello mellannivå-API-app toosend programmet autentiseringsuppgifter tooAzure AD, få tillbaka en ägartoken och skicka hello ägar-token toohello appen på datanivå-API.</span><span class="sxs-lookup"><span data-stu-id="97c3c-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="97c3c-166">Den här processen illustreras i hello diagram.</span><span class="sxs-lookup"><span data-stu-id="97c3c-166">This process is illustrated in hello diagram.</span></span>

![Diagram för autentisering av tjänsten](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="97c3c-168">Om du stöter på problem när följande hello självstudiekursen anvisningar Se hello [felsökning](#troubleshooting) avsnittet hello slutet av hello kursen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="97c3c-169">I hello [Azure-portalen](https://portal.azure.com/), navigera toohello **inställningar** bladet hello API-appen som du skapade för hello ToDoListDataAPI (datanivå) API-app och klicka sedan på **inställningar**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="97c3c-170">I hello **inställningar** bladet, hitta hello **funktioner** avsnittet och klicka sedan på **autentisering / auktorisering**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Autentisering/auktorisering i Azure-portalen](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="97c3c-172">I hello **autentisering / auktorisering** bladet, klickar du på **på**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="97c3c-173">I hello **åtgärd tootake när begäran inte har autentiserats** listrutan, Välj **logga in med Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="97c3c-174">Detta är hello-inställningen som orsakar Apptjänst tooensure som endast autentiserade begäranden reach hello API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="97c3c-175">App Service för begäranden som har giltigt ägar-token, skickar hello token längs toohello API-app och fyller HTTP-huvuden med vanliga anspråk toomake informationen enklare tillgängliga tooyour kod.</span><span class="sxs-lookup"><span data-stu-id="97c3c-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="97c3c-176">Under **autentiseringsproviders**, klickar du på **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Autentisering/auktorisering i bladet i Azure-portalen](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="97c3c-178">I hello **inställningarna för Azure Active Directory** bladet, klickar du på **Express**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="97c3c-179">Med hello **Express** alternativet Azure kan automatiskt skapa ett AAD-program i din Azure AD [klient](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="97c3c-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="97c3c-180">Du har inte toocreate en klient, eftersom varje Azure-konto har en automatiskt.</span><span class="sxs-lookup"><span data-stu-id="97c3c-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="97c3c-181">Under **hanteringsläge**, klickar du på **Skapa nytt AD-App** om den inte redan har markerats.</span><span class="sxs-lookup"><span data-stu-id="97c3c-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="97c3c-182">hello portal ansluts hello **skapa App** textrutan med ett standardvärde.</span><span class="sxs-lookup"><span data-stu-id="97c3c-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="97c3c-183">Som standard hello Azure AD-program med namnet hello samma som hello API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="97c3c-184">Om du vill kan ange du ett annat namn.</span><span class="sxs-lookup"><span data-stu-id="97c3c-184">If you prefer, you can enter a different name.</span></span>
   
    ![Azure AD-inställningar](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="97c3c-186">**Obs**: som ett alternativ kan du använda en enda Azure AD program för både hello anropa API-app och hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="97c3c-187">Om du väljer detta alternativ kan du inte behöver hello **Skapa nytt AD-App** alternativet här eftersom du redan har skapat ett Azure AD-program tidigare i hello användaren autentisering kursen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="97c3c-188">Den här kursen ska du använda separata Azure AD-program för hello anropa API-app och hello skyddade API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="97c3c-189">Anteckna hello värdet i hello **skapa App** textrutan; du måste slå upp AAD-program i hello klassiska Azure-portalen senare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="97c3c-190">Klicka på **OK**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-190">Click **OK**.</span></span>
10. <span data-ttu-id="97c3c-191">I hello **autentisering / auktorisering** bladet, klickar du på **spara**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Klicka på Spara](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="97c3c-193">App Service skapar ett Azure Active Directory-program med **inloggnings-URL** och **Reply URL** automatiskt in toohello URL för API-appen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="97c3c-194">hello senare värdet kan användare i din AAD-klient toolog i och åtkomst hello API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="97c3c-195">Kontrollera att hello API-app är skyddat</span><span class="sxs-lookup"><span data-stu-id="97c3c-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="97c3c-196">I en webbläsare går toohello Webbadressen till hello API-app: i hello **API-app** bladet i hello Azure-portalen klickar du på länken hello under **URL**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="97c3c-197">Du är omdirigerade tooa inloggningsskärm eftersom oautentiserade begäranden inte tillåts tooreach hello API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="97c3c-198">Om din webbläsare gå toohello Swagger-användargränssnitt, webbläsaren kanske redan har loggat in – i så fall öppna en InPrivate- eller Incognito fönster och gå toohello Swagger UI-URL.</span><span class="sxs-lookup"><span data-stu-id="97c3c-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="97c3c-199">Logga in med autentiseringsuppgifterna för en användare i din AAD-klient.</span><span class="sxs-lookup"><span data-stu-id="97c3c-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="97c3c-200">När du är inloggad, visas hello ”har skapats” i hello webbläsare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="97c3c-201">Konfigurera hello ToDoListAPI-projektet tooacquire och skicka hello Azure AD-token</span><span class="sxs-lookup"><span data-stu-id="97c3c-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="97c3c-202">I det här avsnittet du hello följande uppgifter:</span><span class="sxs-lookup"><span data-stu-id="97c3c-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="97c3c-203">Lägg till kod i hello mellannivå-API-app som använder Azure AD application autentiseringsuppgifter tooacquire en token och skickar den med HTTP-begäranden toohello appen på datanivå-API.</span><span class="sxs-lookup"><span data-stu-id="97c3c-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="97c3c-204">Hämta hello-autentiseringsuppgifter som du behöver från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="97c3c-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="97c3c-205">Ange hello autentiseringsuppgifter i Azure App Service runtime miljöinställningar i hello mellannivå-API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="97c3c-206">Konfigurera hello ToDoListAPI-projektet tooacquire och skicka hello Azure AD-token</span><span class="sxs-lookup"><span data-stu-id="97c3c-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="97c3c-207">Gör följande ändringar i hello ToDoListAPI-projektet i Visual Studio hello.</span><span class="sxs-lookup"><span data-stu-id="97c3c-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="97c3c-208">Ta bort kommentarerna all hello kod i hello *ServicePrincipal.cs* fil.</span><span class="sxs-lookup"><span data-stu-id="97c3c-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="97c3c-209">Detta är hello-kod som använder ADAL för .NET tooacquire hello Azure AD-ägartoken.</span><span class="sxs-lookup"><span data-stu-id="97c3c-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="97c3c-210">Den använder flera konfigurationsvärden som du ska ange i hello Azure körningsmiljö senare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="97c3c-211">Här är hello kod:</span><span class="sxs-lookup"><span data-stu-id="97c3c-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="97c3c-212">**Obs:** koden kräver hello ADAL för .NET-NuGet-paketet (Microsoft.IdentityModel.Clients.ActiveDirectory) som redan är installerad i hello-projekt.</span><span class="sxs-lookup"><span data-stu-id="97c3c-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="97c3c-213">Om du skapar det här projektet från början, har du tooinstall det här paketet.</span><span class="sxs-lookup"><span data-stu-id="97c3c-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="97c3c-214">Det här paketet installeras inte automatiskt av hello API app nytt projekt mallen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="97c3c-215">I *domänkontrollanter/ToDoListController*, ta bort kommentarerna hello koden i hello `NewDataAPIClient` metod som lägger till hello token tooHTTP begäranden i hello authorization-huvud.</span><span class="sxs-lookup"><span data-stu-id="97c3c-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="97c3c-216">Distribuera hello ToDoListAPI-projektet.</span><span class="sxs-lookup"><span data-stu-id="97c3c-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="97c3c-217">(Högerklicka på hello-projektet och klicka sedan på **publicera > Publicera**.)</span><span class="sxs-lookup"><span data-stu-id="97c3c-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="97c3c-218">Visual Studio distribuerar hello-projektet och öppnar en webbläsare toohello webbprogram bas-URL.</span><span class="sxs-lookup"><span data-stu-id="97c3c-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="97c3c-219">Det här alternativet visas sidan 403-fel, vilket är normalt för ett försök toogo tooa Web API bas-URL från en webbläsare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="97c3c-220">Stäng hello webbläsare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="97c3c-221">Få konfigurationsvärden för Azure AD</span><span class="sxs-lookup"><span data-stu-id="97c3c-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="97c3c-222">I hello [klassiska Azure-portalen](https://manage.windowsazure.com/), gå för**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="97c3c-223">På hello **Directory** klickar du på AAD-klient.</span><span class="sxs-lookup"><span data-stu-id="97c3c-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="97c3c-224">Klicka på **program > program som företaget äger**, och klicka sedan på hello är markerat.</span><span class="sxs-lookup"><span data-stu-id="97c3c-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="97c3c-225">Klicka på hello namnet på hello som Azure skapade när du aktiverat autentisering för hello ToDoListDataAPI (datanivå) API-app i hello listan med program.</span><span class="sxs-lookup"><span data-stu-id="97c3c-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="97c3c-226">Klicka på hello **konfigurera** fliken.</span><span class="sxs-lookup"><span data-stu-id="97c3c-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="97c3c-227">Kopiera hello **klient-ID** värde och spara den någonstans du hämtar det senare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="97c3c-228">Gå tillbaka i hello klassiska Azure-portalen toohello lista över **program som företaget äger**, och klicka på hello AAD-program som du skapade för hello mellannivå-API-appen ToDoListAPI (hello du skapade i föregående självstudien hello inte hello du skapade i den här kursen).</span><span class="sxs-lookup"><span data-stu-id="97c3c-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="97c3c-229">Klicka på hello **konfigurera** fliken.</span><span class="sxs-lookup"><span data-stu-id="97c3c-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="97c3c-230">Kopiera hello **klient-ID** värde och spara den någonstans du hämtar det senare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="97c3c-231">Under **nycklar**väljer **1 års** från hello **Markera varaktighet** listrutan.</span><span class="sxs-lookup"><span data-stu-id="97c3c-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="97c3c-232">Klicka på **Spara**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-232">Click **Save**.</span></span>
    
     ![Generera appkey](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="97c3c-234">Kopiera hello nyckelvärdet och spara den någonstans du hämtar det senare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Kopiera den nya appen nyckeln](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="97c3c-236">Konfigurera Azure AD-inställningar i hello mellannivå-API app körningsmiljön</span><span class="sxs-lookup"><span data-stu-id="97c3c-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="97c3c-237">Gå toohello [Azure-portalen](https://portal.azure.com/), och sedan gå toohello **API-App** bladet för hello API-app som är värd för TodoListAPI (mellannivå) hello-projektet.</span><span class="sxs-lookup"><span data-stu-id="97c3c-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="97c3c-238">Klicka på **Inställningar > Programinställningar**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="97c3c-239">I hello **appinställningar** lägger du till följande hello nycklar och värden:</span><span class="sxs-lookup"><span data-stu-id="97c3c-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="97c3c-240">**Nyckel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-240">**Key**</span></span> | <span data-ttu-id="97c3c-241">IDA: utfärdare</span><span class="sxs-lookup"><span data-stu-id="97c3c-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="97c3c-242">**Värde**</span><span class="sxs-lookup"><span data-stu-id="97c3c-242">**Value**</span></span> |<span data-ttu-id="97c3c-243">https://login.microsoftonline.com/ {Azure AD klientnamn}</span><span class="sxs-lookup"><span data-stu-id="97c3c-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="97c3c-244">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-244">**Example**</span></span> |<span data-ttu-id="97c3c-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="97c3c-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="97c3c-246">**Nyckel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-246">**Key**</span></span> | <span data-ttu-id="97c3c-247">IDA: ClientId</span><span class="sxs-lookup"><span data-stu-id="97c3c-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="97c3c-248">**Värde**</span><span class="sxs-lookup"><span data-stu-id="97c3c-248">**Value**</span></span> |<span data-ttu-id="97c3c-249">Klient-ID för hello anropar programmet (mellannivå - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="97c3c-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="97c3c-250">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-250">**Example**</span></span> |<span data-ttu-id="97c3c-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="97c3c-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="97c3c-252">**Nyckel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-252">**Key**</span></span> | <span data-ttu-id="97c3c-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="97c3c-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="97c3c-254">**Värde**</span><span class="sxs-lookup"><span data-stu-id="97c3c-254">**Value**</span></span> |<span data-ttu-id="97c3c-255">App-nyckeln för hello anropar programmet (mellannivå - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="97c3c-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="97c3c-256">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-256">**Example**</span></span> |<span data-ttu-id="97c3c-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="97c3c-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="97c3c-258">**Nyckel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-258">**Key**</span></span> | <span data-ttu-id="97c3c-259">IDA: resurs</span><span class="sxs-lookup"><span data-stu-id="97c3c-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="97c3c-260">**Värde**</span><span class="sxs-lookup"><span data-stu-id="97c3c-260">**Value**</span></span> |<span data-ttu-id="97c3c-261">Klient-ID för hello kallas program (ToDoListDataAPI på datanivå -)</span><span class="sxs-lookup"><span data-stu-id="97c3c-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="97c3c-262">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-262">**Example**</span></span> |<span data-ttu-id="97c3c-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="97c3c-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="97c3c-264">**Obs**: för `ida:Resource`, kontrollera att du använder hello kallas programmets **klient-ID** och inte dess **App-ID URI**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="97c3c-265">`ida:ClientId`och `ida:Resource` är olika värden för den här självstudiekursen eftersom du använder separata Azure AD applicaations för hello mellannivå och datanivå.</span><span class="sxs-lookup"><span data-stu-id="97c3c-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="97c3c-266">Om du använder en enda Azure AD-program för hello anropa API-app och hello skyddas API-app kan du vill använda samma värde i både hello `ida:ClientId` och `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="97c3c-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="97c3c-267">hello koden använder ConfigurationManager tooget värdena, så att de kan lagras i Web.config-filen för hello projekt eller i hello Azure körningsmiljön.</span><span class="sxs-lookup"><span data-stu-id="97c3c-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="97c3c-268">När ett ASP.NET-program körs i Azure App Service, miljö automatiskt inställningar åsidosätter inställningar från Web.config. Miljöinställningarna är vanligtvis en [säkrare sätt toostore känslig information jämfört med tooa Web.config-filen](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="97c3c-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="97c3c-269">Klicka på **Spara**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-269">Click **Save**.</span></span>
   
    ![Klicka på Spara](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="97c3c-271">Testa programmet hello</span><span class="sxs-lookup"><span data-stu-id="97c3c-271">Test hello application</span></span>
1. <span data-ttu-id="97c3c-272">I en webbläsare går toohello HTTPS-URL för hello AngularJS frontend-webbprogram.</span><span class="sxs-lookup"><span data-stu-id="97c3c-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="97c3c-273">Klicka på hello **tooDo lista** fliken och logga in med autentiseringsuppgifterna för en användare i din Azure AD-klient.</span><span class="sxs-lookup"><span data-stu-id="97c3c-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="97c3c-274">Lägg till uppgiften objekt tooverify som programmet hello fungerar.</span><span class="sxs-lookup"><span data-stu-id="97c3c-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![sidan tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="97c3c-276">Kontrollera alla hello-inställningar som du angav i hello Azure-portalen om hello program inte fungerar som förväntat.</span><span class="sxs-lookup"><span data-stu-id="97c3c-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="97c3c-277">Om alla hello inställningar visas toobe rätt finns hello [felsökning](#troubleshooting) senare i den här kursen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="97c3c-278">Skydda hello API-app från webbläsaråtkomst</span><span class="sxs-lookup"><span data-stu-id="97c3c-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="97c3c-279">Du har skapat en separat för den här självstudiekursen Azure AD-program för hello ToDoListDataAPI (datanivå) API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="97c3c-280">Som du har sett när App Service skapar ett AAD-program, konfigurerar hello AAD-program på ett sätt som gör att en användare toogo toohello API-appens URL i en webbläsare och logga på.</span><span class="sxs-lookup"><span data-stu-id="97c3c-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="97c3c-281">Det innebär är det möjligt för en användare i din Azure AD-klient, inte bara en tjänstens huvudnamn, tooaccess hello API.</span><span class="sxs-lookup"><span data-stu-id="97c3c-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="97c3c-282">Om du vill tooprevent webbläsare utan att skriva någon kod i hello skyddade API-app, kan du ändra hello **Reply URL** i hello AAD-program så att det skiljer sig från hello API app bas-URL.</span><span class="sxs-lookup"><span data-stu-id="97c3c-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="97c3c-283">Inaktivera webbläsaråtkomst</span><span class="sxs-lookup"><span data-stu-id="97c3c-283">Disable browser access</span></span>
1. <span data-ttu-id="97c3c-284">I hello klassiska portalen **konfigurera** fliken för hello AAD-program som har skapats för hello TodoListService, ändrar hello värdet i hello **Reply URL** så att det är en giltig URL, men inte hello API Apps URL-ADRESSEN.</span><span class="sxs-lookup"><span data-stu-id="97c3c-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="97c3c-285">Klicka på **Spara**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="97c3c-286">Kontrollera webbläsaråtkomst fungerar inte längre</span><span class="sxs-lookup"><span data-stu-id="97c3c-286">Verify browser access no longer works</span></span>
<span data-ttu-id="97c3c-287">Tidigare verifierade du att du kan gå toohello API-appens URL i en webbläsare genom att logga in med autentiseringsuppgifterna för en enskild användare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="97c3c-288">I det här avsnittet kan kontrollera du att det inte längre.</span><span class="sxs-lookup"><span data-stu-id="97c3c-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="97c3c-289">Gå toohello URL för hello API-app igen i ett nytt webbläsarfönster.</span><span class="sxs-lookup"><span data-stu-id="97c3c-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="97c3c-290">Logga in när du uppmanas till detta toodo så.</span><span class="sxs-lookup"><span data-stu-id="97c3c-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="97c3c-291">Inloggningen lyckas men leder tooan felsidan.</span><span class="sxs-lookup"><span data-stu-id="97c3c-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="97c3c-292">Du har konfigurerat hello AAD app så att användare i hello AAD-klient inte kan logga in och komma åt hello-API från en webbläsare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="97c3c-293">Du kan fortfarande komma åt hello API-app med hjälp av en service principal-token som du kan kontrollera genom att gå toohello webbappens Webbadress och lägga till flera arbetsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="97c3c-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="97c3c-294">Begränsa åtkomst tooa viss tjänstens huvudnamn</span><span class="sxs-lookup"><span data-stu-id="97c3c-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="97c3c-295">Just nu, och varje anropare som kan hämta en token för en användare eller tjänstens huvudnamn i Azure AD-klienten kan anropa hello TodoListDataAPI (datanivå) API-app.</span><span class="sxs-lookup"><span data-stu-id="97c3c-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="97c3c-296">Du kanske vill toomake till att hello API-appen på datanivå accepterar bara anrop från hello TodoListAPI (mellannivå) API-app och bara från en viss tjänstens huvudnamn.</span><span class="sxs-lookup"><span data-stu-id="97c3c-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="97c3c-297">Du kan lägga till dessa begränsningar genom att lägga till kod toovalidate hello `appid` och `objectidentifier` anspråk på inkommande samtal.</span><span class="sxs-lookup"><span data-stu-id="97c3c-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="97c3c-298">För den här kursen kan du placera hello-kod som verifierar app-ID och tjänsten ägar-ID direkt i domänkontrollanten-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="97c3c-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="97c3c-299">Alternativen är toouse en anpassad `Authorize` attribut eller toodo verifieringen i Start-sekvenser (t.ex. OWIN mellanprogram).</span><span class="sxs-lookup"><span data-stu-id="97c3c-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="97c3c-300">Ett exempel på hello senare finns [i det här exempelprogrammet](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="97c3c-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="97c3c-301">Gör följande ändringar toohello TodoListDataAPI-projektet hello.</span><span class="sxs-lookup"><span data-stu-id="97c3c-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="97c3c-302">Öppna hello *Controllers/TodoListController.cs* fil.</span><span class="sxs-lookup"><span data-stu-id="97c3c-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="97c3c-303">Ta bort kommentarerna hello rader som anges `trustedCallerClientId` och `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="97c3c-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="97c3c-304">Ta bort kommentarerna hello koden i hello CheckCallerId metod.</span><span class="sxs-lookup"><span data-stu-id="97c3c-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="97c3c-305">Den här metoden anropas hello början av varje åtgärdsmetod i hello controller.</span><span class="sxs-lookup"><span data-stu-id="97c3c-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="97c3c-306">Omdistribuera hello ToDoListDataAPI-projektet tooAzure Apptjänst.</span><span class="sxs-lookup"><span data-stu-id="97c3c-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="97c3c-307">Gå toohello AngularJS klientdelen webbprogram HTTPS-URL i webbläsaren, och klicka på hello hello på startsidan i **tooDo lista** fliken.</span><span class="sxs-lookup"><span data-stu-id="97c3c-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="97c3c-308">hello program fungerar inte eftersom anrop toohello tillbaka avslutas inte importeras.</span><span class="sxs-lookup"><span data-stu-id="97c3c-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="97c3c-309">hello ny kod kontrollerar faktiska appid och objectidentifier men som inte ännu har hello rätt värden toocheck dem mot.</span><span class="sxs-lookup"><span data-stu-id="97c3c-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="97c3c-310">hello webbläsare verktyg Utvecklarkonsolen rapporterar hello servern returnerar ett HTTP 401-fel.</span><span class="sxs-lookup"><span data-stu-id="97c3c-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Fel i Developer Tools-konsolen](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="97c3c-312">I följande steg hello konfigurerar du hello förväntade värden.</span><span class="sxs-lookup"><span data-stu-id="97c3c-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="97c3c-313">Med hjälp av Azure AD PowerShell, hämta hello värdet för hello service principal för hello Azure AD-program som du skapade för hello TodoListWebApp projekt.</span><span class="sxs-lookup"><span data-stu-id="97c3c-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="97c3c-314">a.</span><span class="sxs-lookup"><span data-stu-id="97c3c-314">a.</span></span> <span data-ttu-id="97c3c-315">Anvisningar för hur tooinstall Azure PowerShell och ansluter tooyour prenumeration, se [med hjälp av Azure PowerShell med Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="97c3c-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="97c3c-316">b.</span><span class="sxs-lookup"><span data-stu-id="97c3c-316">b.</span></span> <span data-ttu-id="97c3c-317">tooget en lista över tjänstens huvudnamn köra hello `Login-AzureRmAccount` kommando och sedan hello `Get-AzureRmADServicePrincipal` kommando.</span><span class="sxs-lookup"><span data-stu-id="97c3c-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="97c3c-318">c.</span><span class="sxs-lookup"><span data-stu-id="97c3c-318">c.</span></span> <span data-ttu-id="97c3c-319">Hitta hello objectid för hello tjänstens huvudnamn för hello TodoListAPI program och spara den på en plats som du kan kopiera från senare.</span><span class="sxs-lookup"><span data-stu-id="97c3c-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="97c3c-320">Navigera toohello API app bladet för hello API-app som du har distribuerat hello ToDoListDataAPI-projektet till i hello Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="97c3c-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="97c3c-321">Klicka på **Inställningar > programinställningar**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="97c3c-322">I hello **appinställningar** lägger du till följande hello nycklar och värden:</span><span class="sxs-lookup"><span data-stu-id="97c3c-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="97c3c-323">**Nyckel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-323">**Key**</span></span> | <span data-ttu-id="97c3c-324">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="97c3c-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="97c3c-325">**Värde**</span><span class="sxs-lookup"><span data-stu-id="97c3c-325">**Value**</span></span> |<span data-ttu-id="97c3c-326">Tjänsten ägar-id på anrop av programmet</span><span class="sxs-lookup"><span data-stu-id="97c3c-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="97c3c-327">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-327">**Example**</span></span> |<span data-ttu-id="97c3c-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="97c3c-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="97c3c-329">**Nyckel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-329">**Key**</span></span> | <span data-ttu-id="97c3c-330">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="97c3c-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="97c3c-331">**Värde**</span><span class="sxs-lookup"><span data-stu-id="97c3c-331">**Value**</span></span> |<span data-ttu-id="97c3c-332">Klient-ID för anropar program - kopieras från hello TodoListAPI Azure AD-program</span><span class="sxs-lookup"><span data-stu-id="97c3c-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="97c3c-333">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="97c3c-333">**Example**</span></span> |<span data-ttu-id="97c3c-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="97c3c-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="97c3c-335">Klicka på **Spara**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-335">Click **Save**.</span></span>
    
     ![Klicka på Spara](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="97c3c-337">Returnera toohello webbappens Webbadress i webbläsaren, och klicka på hello hello på startsidan i **tooDo lista** fliken.</span><span class="sxs-lookup"><span data-stu-id="97c3c-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="97c3c-338">Det här programmet hello fungerar som förväntat eftersom hello betrodda anropare app-ID och tjänstens huvudnamn hello förväntade värden.</span><span class="sxs-lookup"><span data-stu-id="97c3c-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![sidan tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="97c3c-340">Skapa hello projekt från grunden</span><span class="sxs-lookup"><span data-stu-id="97c3c-340">Building hello projects from scratch</span></span>
<span data-ttu-id="97c3c-341">hello två Web API-projekt har skapats med hjälp av hello **Azure API Apps** mall och ersätta hello standard värden controller med en ToDoList-styrenhet.</span><span class="sxs-lookup"><span data-stu-id="97c3c-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="97c3c-342">För att hämta Azure AD service principal token i hello ToDoListAPI-projektet hello [Active Directory Authentication Library (ADAL) för .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet-paketet har installerats.</span><span class="sxs-lookup"><span data-stu-id="97c3c-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="97c3c-343">För information om hur skapar för ett program för AngularJS-sida med en webb-API-serverdel som ToDoListAngular, se [händerna på Lab: skapa en enkel sida program (SPA) med ASP.NET Web API och Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="97c3c-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="97c3c-344">Information om hur tooadd koden för Azure AD finns [skydda AngularJS enda sidan appar med Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="97c3c-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="97c3c-345">Felsökning</span><span class="sxs-lookup"><span data-stu-id="97c3c-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="97c3c-346">Kontrollera att du blanda inte ihop ToDoListAPI (mellannivå) och ToDoListDataAPI (datanivå).</span><span class="sxs-lookup"><span data-stu-id="97c3c-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="97c3c-347">Till exempel i den här självstudiekursen du lägger till autentisering toohello API-appen på datanivå, **men hello appkey måste komma från hello Azure AD-program som du skapade för hello mellannivå-API-app**.</span><span class="sxs-lookup"><span data-stu-id="97c3c-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="97c3c-348">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="97c3c-348">Next steps</span></span>
<span data-ttu-id="97c3c-349">Detta är hello sista kurs i hello API Apps serien.</span><span class="sxs-lookup"><span data-stu-id="97c3c-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="97c3c-350">Mer information om Azure Active Directory finns i hello följande resurser.</span><span class="sxs-lookup"><span data-stu-id="97c3c-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="97c3c-351">Azure AD-utvecklarhandboken</span><span class="sxs-lookup"><span data-stu-id="97c3c-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="97c3c-352">Azure AD-scenarier</span><span class="sxs-lookup"><span data-stu-id="97c3c-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="97c3c-353">Azure AD-exempel</span><span class="sxs-lookup"><span data-stu-id="97c3c-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="97c3c-354">Hej [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) exempel liknar toowhat visas i den här självstudiekursen, men utan att använda autentisering i Apptjänst.</span><span class="sxs-lookup"><span data-stu-id="97c3c-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="97c3c-355">Information om andra sätt toodeploy Visual Studio-projekt tooAPI appar med hjälp av Visual Studio eller [automatisera distributionen](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) från en [källkontrollsystem](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), se [hur toodeploy en Azure Apptjänst-app](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="97c3c-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

