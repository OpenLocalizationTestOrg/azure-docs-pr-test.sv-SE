---
title: Skapa och ladda upp en Linux VHD i Azure
description: "Lär dig att skapa och ladda upp en Azure virtuell hårddisk (VHD) som innehåller en Linux-operativsystem."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: ccadf55c492c097ef96f25e469dbf36fc87b6102
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="888b8-103">Information om icke-godkända distributioner</span><span class="sxs-lookup"><span data-stu-id="888b8-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="888b8-104">Azure-plattformen SLA gäller för virtuella datorer som kör Linux OS bara när en av de [-godkända distributioner](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) används.</span><span class="sxs-lookup"><span data-stu-id="888b8-104">The Azure platform SLA applies to virtual machines running the Linux OS only when one of the [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="888b8-105">Alla Linux-distributioner som tillhandahålls i galleriet Azure-avbildning som påtecknade distributioner med önskad konfiguration.</span><span class="sxs-lookup"><span data-stu-id="888b8-105">All Linux distributions that are provided in the Azure image gallery are endorsed distributions with the required configuration.</span></span>

* [<span data-ttu-id="888b8-106">Linux på Azure - godkända distributioner</span><span class="sxs-lookup"><span data-stu-id="888b8-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="888b8-107">Stöd för Linux-avbildningar i Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="888b8-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="888b8-108">Alla distributioner som körs på Azure måste uppfylla vissa krav för att prova att fungera på plattformen.</span><span class="sxs-lookup"><span data-stu-id="888b8-108">All distributions running on Azure will need to meet a number of prerequisites to have a chance to properly run on the platform.</span></span>  <span data-ttu-id="888b8-109">Den här artikeln är inte menat omfattande som varje distribution är olika. och det är fullt möjligt att även om du uppfyller alla följande villkor du fortfarande behöver justera avsevärt Linux-system för att säkerställa att den körs korrekt på plattformen.</span><span class="sxs-lookup"><span data-stu-id="888b8-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all the criteria below you will still need to significantly tweak your Linux system to ensure that it properly runs on the platform.</span></span>

<span data-ttu-id="888b8-110">Det är därför som vi rekommenderar att du börjar med en av våra [Linux på Azure-godkända distributioner](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="888b8-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="888b8-111">I följande artiklar hjälper dig att förbereda de olika påtecknade Linux-distributioner som stöds i Azure:</span><span class="sxs-lookup"><span data-stu-id="888b8-111">The following articles will guide you through how to prepare the various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="888b8-112">**[CentOS-baserade distributioner](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="888b8-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="888b8-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="888b8-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="888b8-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="888b8-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="888b8-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="888b8-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="888b8-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="888b8-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="888b8-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="888b8-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="888b8-118">Resten av den här artikeln fokuserar på allmänna riktlinjer för att köra Linux-distribution på Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-118">The rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="888b8-119">Allmän Linux installationsinformation</span><span class="sxs-lookup"><span data-stu-id="888b8-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="888b8-120">VHDX-format stöds inte i Azure, endast **fast virtuell Hårddisk**.</span><span class="sxs-lookup"><span data-stu-id="888b8-120">The VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="888b8-121">Du kan konvertera disken till VHD-format med hjälp av Hyper-V Manager eller cmdlet convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="888b8-121">You can convert the disk to VHD format using Hyper-V Manager or the convert-vhd cmdlet.</span></span> <span data-ttu-id="888b8-122">Om du använder VirtualBox innebär detta att välja **fast storlek** till skillnad från standardvärdet dynamiskt allokerade när skapas.</span><span class="sxs-lookup"><span data-stu-id="888b8-122">If you are using VirtualBox this means selecting **Fixed size** as opposed to the default dynamically allocated when creating the disk.</span></span>
* <span data-ttu-id="888b8-123">Azure har endast stöd för virtuella datorer i generation 1.</span><span class="sxs-lookup"><span data-stu-id="888b8-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="888b8-124">Du kan konvertera en virtuell dator i generation 1 från VHDX till VHD-format och dynamiskt expanderande till en disk med fast storlek.</span><span class="sxs-lookup"><span data-stu-id="888b8-124">You can convert a generation 1 virtual machine from VHDX to the VHD file format and from dynamically expanding to a fixed sized disk.</span></span> <span data-ttu-id="888b8-125">Men du kan inte ändra en virtuell dator generation.</span><span class="sxs-lookup"><span data-stu-id="888b8-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="888b8-126">Mer information finns i [bör jag skapa en virtuell dator i generation 1 eller 2 i Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="888b8-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="888b8-127">Den maximala storleken för den virtuella Hårddisken är 1,023 GB.</span><span class="sxs-lookup"><span data-stu-id="888b8-127">The maximum size allowed for the VHD is 1,023 GB.</span></span>
* <span data-ttu-id="888b8-128">När du installerar Linux-system är *rekommenderas* att du använder standard partitioner i stället för LVM (ofta är standard för många installationer).</span><span class="sxs-lookup"><span data-stu-id="888b8-128">When installing the Linux system it is *recommended* that you use standard partitions rather than LVM (often the default for many installations).</span></span> <span data-ttu-id="888b8-129">Det här undviker LVM står i konflikt med klonade virtuella datorer, särskilt om en OS-disk någonsin måste vara kopplad till en annan identisk virtuell dator för felsökning.</span><span class="sxs-lookup"><span data-stu-id="888b8-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs to be attached to another identical VM for troubleshooting.</span></span> <span data-ttu-id="888b8-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) eller [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) får användas i datadiskar.</span><span class="sxs-lookup"><span data-stu-id="888b8-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="888b8-131">Kernel-stöd för att montera UDF-filsystem krävs.</span><span class="sxs-lookup"><span data-stu-id="888b8-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="888b8-132">Vid första start på Azure skickas etablering konfigurationen för Linux-VM via UDF-formaterad media som är anslutna till gästen.</span><span class="sxs-lookup"><span data-stu-id="888b8-132">At first boot on Azure the provisioning configuration is passed to the Linux VM via UDF-formatted media that is attached to the guest.</span></span> <span data-ttu-id="888b8-133">Azure Linux-agenten måste kunna montera UDF-filsystemet för att läsa konfigurationen och etablera den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="888b8-133">The Azure Linux agent must be able to mount the UDF file system to read its configuration and provision the VM.</span></span>
* <span data-ttu-id="888b8-134">Linux kernel-versioner än 2.6.37 stöder inte NUMA på Hyper-V med större VM-storlekar.</span><span class="sxs-lookup"><span data-stu-id="888b8-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="888b8-135">Det här problemet påverkar huvudsakligen äldre distributioner med hjälp av den överordnade Red Hat 2.6.32 kernel och åtgärdades i RHEL 6.6 (kernel-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="888b8-135">This issue primarily impacts older distributions using the upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="888b8-136">System som kör anpassade kernlar som är äldre än 2.6.37 eller RHEL-baserade kernlar som är äldre än 2.6.32-504 måste ange parametern Start `numa=off` på kommandoraden i grub.conf kernel.</span><span class="sxs-lookup"><span data-stu-id="888b8-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set the boot parameter `numa=off` on the kernel command-line in grub.conf.</span></span> <span data-ttu-id="888b8-137">Mer information finns i Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="888b8-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="888b8-138">Konfigurera inte en byte-partition på OS-disk.</span><span class="sxs-lookup"><span data-stu-id="888b8-138">Do not configure a swap partition on the OS disk.</span></span> <span data-ttu-id="888b8-139">Linux-agenten kan konfigureras för att skapa en växlingsfil på tillfällig disken.</span><span class="sxs-lookup"><span data-stu-id="888b8-139">The Linux agent can be configured to create a swap file on the temporary resource disk.</span></span>  <span data-ttu-id="888b8-140">Mer information om detta finns i stegen nedan.</span><span class="sxs-lookup"><span data-stu-id="888b8-140">More information about this can be found in the steps below.</span></span>
* <span data-ttu-id="888b8-141">Alla de virtuella hårddiskarna måste ha storlekar som multiplar av 1 MB.</span><span class="sxs-lookup"><span data-stu-id="888b8-141">All of the VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="888b8-142">Installera kernel moduler utan Hyper-V</span><span class="sxs-lookup"><span data-stu-id="888b8-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="888b8-143">Azure körs på Hyper-V-hypervisor så Linux kräver att vissa kernel-moduler är installerade för att kunna köras i Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-143">Azure runs on the Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order to run in Azure.</span></span> <span data-ttu-id="888b8-144">Om du har en virtuell dator som har skapats utanför Hyper-V, Linux-installationsprogram kanske inte med drivrutiner för Hyper-V inledande ramdisk (initrd eller initramfs) såvida inte den upptäcker att den körs en Hyper-V-miljö.</span><span class="sxs-lookup"><span data-stu-id="888b8-144">If you have a VM that was created outside of Hyper-V, the Linux installers may not include the drivers for Hyper-V in the initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="888b8-145">När du använder ett system med olika virtualisering (d.v.s. Virtualbox, KVM osv.) för att förbereda avbildningen Linux, du kan behöva återskapa initrd för att säkerställa att åtminstone `hv_vmbus` och `hv_storvsc` kernel-moduler är tillgängliga på den första ramdisk.</span><span class="sxs-lookup"><span data-stu-id="888b8-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) to prepare your Linux image, you may need to rebuild the initrd to ensure that at least the `hv_vmbus` and `hv_storvsc` kernel modules are available on the initial ramdisk.</span></span>  <span data-ttu-id="888b8-146">Detta är ett känt problem minst på system baserat på den överordnade Red Hat-distributionen.</span><span class="sxs-lookup"><span data-stu-id="888b8-146">This is a known issue at least on systems based on the upstream Red Hat distribution.</span></span>

<span data-ttu-id="888b8-147">Mekanism för att återskapa initrd eller initramfs avbildningen kan variera beroende på distributionsplatsen.</span><span class="sxs-lookup"><span data-stu-id="888b8-147">The mechanism for rebuilding the initrd or initramfs image may vary depending on the distribution.</span></span> <span data-ttu-id="888b8-148">Dokumentationen för din distribution eller stöd för på rätt sätt.</span><span class="sxs-lookup"><span data-stu-id="888b8-148">Please consult your distribution's documentation or support for the proper procedure.</span></span>  <span data-ttu-id="888b8-149">Här är ett exempel på hur du återskapa den initrd med hjälp av den `mkinitrd` verktyget:</span><span class="sxs-lookup"><span data-stu-id="888b8-149">Here is one example for how to rebuild the initrd using the `mkinitrd` utility:</span></span>

<span data-ttu-id="888b8-150">Först säkerhetskopiera den befintliga initrd avbildningen:</span><span class="sxs-lookup"><span data-stu-id="888b8-150">First, back up the existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="888b8-151">Därefter återskapa initrd med den `hv_vmbus` och `hv_storvsc` kernel moduler:</span><span class="sxs-lookup"><span data-stu-id="888b8-151">Next, rebuild the initrd with the `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="888b8-152">Ändra storlek på virtuella hårddiskar</span><span class="sxs-lookup"><span data-stu-id="888b8-152">Resizing VHDs</span></span>
<span data-ttu-id="888b8-153">VHD-avbildningar i Azure måste ha en virtuell storlek justeras till 1MB.</span><span class="sxs-lookup"><span data-stu-id="888b8-153">VHD images on Azure must have a virtual size aligned to 1MB.</span></span>  <span data-ttu-id="888b8-154">Normalt ska redan virtuella hårddiskar som skapats med hjälp av Hyper-V justeras korrekt.</span><span class="sxs-lookup"><span data-stu-id="888b8-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="888b8-155">Om den virtuella Hårddisken inte är korrekt justerat så att du får ett felmeddelande liknande följande när du försöker skapa en *bild* från den virtuella Hårddisken:</span><span class="sxs-lookup"><span data-stu-id="888b8-155">If the VHD is not aligned correctly then you may receive an error message similar to the following when you attempt to create an *image* from your VHD:</span></span>

    "The VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. The size must be a whole number (in MBs).”

<span data-ttu-id="888b8-156">För att åtgärda detta kan du ändra storlek på den virtuella datorn med Hyper-V Manager-konsolen eller [storleksändring VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell-cmdlet.</span><span class="sxs-lookup"><span data-stu-id="888b8-156">To remedy this you can resize the VM using either the Hyper-V Manager console or the [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="888b8-157">Om du inte körs i en Windows-miljö bör det att använda qemu img konvertera (om det behövs) och ändra storlek på den virtuella Hårddisken.</span><span class="sxs-lookup"><span data-stu-id="888b8-157">If you are not running in a Windows environment then it is recommended to use qemu-img to convert (if needed) and resize the VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="888b8-158">Det finns ett känt fel i qemu img versioner > = 2.2.1 som resulterar i en felaktigt formaterad virtuell Hårddisk.</span><span class="sxs-lookup"><span data-stu-id="888b8-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="888b8-159">Problemet har åtgärdats i QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="888b8-159">The issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="888b8-160">Det rekommenderas att använda qemu img 2.2.0 eller lägre eller uppdatera till 2.6 eller senare.</span><span class="sxs-lookup"><span data-stu-id="888b8-160">It is recommended to use either qemu-img 2.2.0 or lower, or update to 2.6 or higher.</span></span> <span data-ttu-id="888b8-161">Referens: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="888b8-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="888b8-162">Ändra storlek på den virtuella Hårddisken direkt med hjälp av verktyg som `qemu-img` eller `vbox-manage` kan resultera i en VHD som inte kan startas.</span><span class="sxs-lookup"><span data-stu-id="888b8-162">Resizing the VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="888b8-163">Därför rekommenderas att första konvertera den virtuella Hårddisken till en rå diskavbildning.</span><span class="sxs-lookup"><span data-stu-id="888b8-163">So it is recommended to first convert the VHD to a RAW disk image.</span></span>  <span data-ttu-id="888b8-164">Om VM-avbildning har redan skapats som RÅDATA diskavbildning (standard för vissa hypervisor-program, till exempel KVM) kan du hoppa över det här steget:</span><span class="sxs-lookup"><span data-stu-id="888b8-164">If the VM image was already created as RAW disk image (the default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="888b8-165">Beräkna den nödvändiga storleken för diskavbildning så att den virtuella storleken justeras till 1MB.</span><span class="sxs-lookup"><span data-stu-id="888b8-165">Calculate the required size of the disk image to ensure that the virtual size is aligned to 1MB.</span></span>  <span data-ttu-id="888b8-166">Du följande kommandoskript bash kan hjälpa till med den här.</span><span class="sxs-lookup"><span data-stu-id="888b8-166">The following bash shell script can assist with this.</span></span>  <span data-ttu-id="888b8-167">Skriptet använder ”`qemu-img info`” att identifiera virtuella storleken på disk image och beräknar sedan storleken till nästa 1 MB:</span><span class="sxs-lookup"><span data-stu-id="888b8-167">The script uses "`qemu-img info`" to determine the virtual size of the disk image and then calculates the size to the next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="888b8-168">Ändra storlek på raw disken med $rounded_size som angetts i skriptet ovan:</span><span class="sxs-lookup"><span data-stu-id="888b8-168">Resize the raw disk using $rounded_size as set in the above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="888b8-169">Nu kan konvertera RÅDATA disken till en virtuell Hårddisk med fast storlek:</span><span class="sxs-lookup"><span data-stu-id="888b8-169">Now, convert the RAW disk back to a fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="888b8-170">Eller med qemu version **2.6 +** inkluderar den `force_size` alternativ:</span><span class="sxs-lookup"><span data-stu-id="888b8-170">Or, with qemu version **2.6+** include the `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="888b8-171">Linux-Kernel-krav</span><span class="sxs-lookup"><span data-stu-id="888b8-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="888b8-172">Linux Integration Services (LIS)-drivrutiner för Hyper-V och Azure bidragit direkt till den överordnade Linux-kerneln.</span><span class="sxs-lookup"><span data-stu-id="888b8-172">The Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly to the upstream Linux kernel.</span></span> <span data-ttu-id="888b8-173">Många distributioner som innehåller de senaste Linux kernel-version (d.v.s. 3.x) redan har dessa drivrutiner eller annat sätt tillhandahålla anpassats versioner av drivrutinerna med deras kärnor.</span><span class="sxs-lookup"><span data-stu-id="888b8-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="888b8-174">De här drivrutinerna som uppdateras kontinuerligt i överordnad kernel med nya korrigeringar och funktioner, så när det är möjligt bör köra en [godkända distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) som innehåller dessa korrigeringar och uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="888b8-174">These drivers are constantly being updated in the upstream kernel with new fixes and features, so when possible it is recommended to run an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="888b8-175">Om du använder en variant av Red Hat Enterprise Linux versioner **6.0 6.3**, måste du installera de senaste drivrutinerna för LIS för Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="888b8-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need to install the latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="888b8-176">Drivrutinerna kan hittas [på den här platsen](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="888b8-176">The drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="888b8-177">Från och med RHEL **6.4 +** (och derivat) drivrutinerna LIS ingår redan i kernel och därför inga ytterligare Installationspaketen behövs för att köra dessa system på Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-177">As of RHEL **6.4+** (and derivatives) the LIS drivers are already included with the kernel and so no additional installation packages are needed to run those systems on Azure.</span></span>

<span data-ttu-id="888b8-178">Om en anpassad kernel krävs, rekommenderas att använda en nyare version av kernel (d.v.s. **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="888b8-178">If a custom kernel is required, it is recommended to use a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="888b8-179">För dessa distributioner eller leverantörer som hanterar sina egna kernel möda kommer att behöva regelbundet backport LIS drivrutiner från överordnad kerneln till din anpassade kernel.</span><span class="sxs-lookup"><span data-stu-id="888b8-179">For those distributions or vendors who maintain their own kernel, some effort will be required to regularly backport the LIS drivers from the upstream kernel to your custom kernel.</span></span>  <span data-ttu-id="888b8-180">Även om du redan kör en relativt nya kernel-version, rekommenderas att hålla koll på eventuella överordnade korrigeringar i LIS drivrutiner och backport dem efter behov.</span><span class="sxs-lookup"><span data-stu-id="888b8-180">Even if you are already running a relatively recent kernel version, it is highly recommended to keep track of any upstream fixes in the LIS drivers and backport those as needed.</span></span> <span data-ttu-id="888b8-181">LIS drivrutinens källfiler finns tillgängliga i den [sköter underhåll SJÄLVA](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) filen i trädet Linux kernel källa:</span><span class="sxs-lookup"><span data-stu-id="888b8-181">The location of the LIS driver source files is available in the [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in the Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="888b8-182">Vid en mycket minsta avsaknaden av följande korrigeringsfiler har rapporterats orsaka problem på Azure och så de måste inkluderas i kernel.</span><span class="sxs-lookup"><span data-stu-id="888b8-182">At a very minimum, the absence of the following patches have been known to cause problems on Azure and so these must be included in the kernel.</span></span> <span data-ttu-id="888b8-183">Den här listan är inte menat fullständig eller fullständig för alla distributioner:</span><span class="sxs-lookup"><span data-stu-id="888b8-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="888b8-184">ata_piix: skjuta upp diskar i Hyper-V-drivrutiner som standard</span><span class="sxs-lookup"><span data-stu-id="888b8-184">ata_piix: defer disks to the Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="888b8-185">storvsc: kontot för transit paket i sökvägen för återställning</span><span class="sxs-lookup"><span data-stu-id="888b8-185">storvsc: Account for in-transit packets in the RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="888b8-186">storvsc: undvika användningen av WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="888b8-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="888b8-187">storvsc: inaktivera skriva samma för RAID och drivrutiner för nätverkskort för virtuell värddator</span><span class="sxs-lookup"><span data-stu-id="888b8-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="888b8-188">storvsc: NULL-pekare avreferera-korrigering</span><span class="sxs-lookup"><span data-stu-id="888b8-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="888b8-189">storvsc: ring buffer fel kan resultera i i/o-låsning</span><span class="sxs-lookup"><span data-stu-id="888b8-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="888b8-190">scsi_sysfs: skydda dig mot dubbla körning av __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="888b8-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="the-azure-linux-agent"></a><span data-ttu-id="888b8-191">Azure Linux-agenten</span><span class="sxs-lookup"><span data-stu-id="888b8-191">The Azure Linux Agent</span></span>
<span data-ttu-id="888b8-192">Den [Azure Linux-agenten](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) krävs för att korrekt etablera en virtuell Linux-dator i Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-192">The [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required to properly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="888b8-193">Du kan hämta den senaste versionen, filen problem eller skicka pull-förfrågningar på den [Linux-agenten GitHub-repo-](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="888b8-193">You can get the latest version, file issues or submit pull requests at the [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="888b8-194">Linux-agenten släpps under Apache 2.0-licens.</span><span class="sxs-lookup"><span data-stu-id="888b8-194">The Linux agent is released under the Apache 2.0 license.</span></span> <span data-ttu-id="888b8-195">Många distributioner ange redan RPM eller deb paket för agenten och så i vissa fall detta kan du installera och uppdatera visningsläge.</span><span class="sxs-lookup"><span data-stu-id="888b8-195">Many distributions already provide RPM or deb packages for the agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="888b8-196">Azure Linux-agenten kräver Python v2.6 +.</span><span class="sxs-lookup"><span data-stu-id="888b8-196">The Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="888b8-197">Agenten kräver också pyasn1 python-modulen.</span><span class="sxs-lookup"><span data-stu-id="888b8-197">The agent also requires the python-pyasn1 module.</span></span> <span data-ttu-id="888b8-198">De flesta distributioner ger detta som ett separat paket som kan installeras.</span><span class="sxs-lookup"><span data-stu-id="888b8-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="888b8-199">Azure Linux-agenten kanske inte kompatibelt med NetworkManager i vissa fall.</span><span class="sxs-lookup"><span data-stu-id="888b8-199">In some cases the Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="888b8-200">Många av de RPM/Deb-paket som tillhandahålls av distributioner konfigurera NetworkManager som en konflikt i waagent-paketet och därmed kommer att avinstallera NetworkManager när du installerar Linux-agenten.</span><span class="sxs-lookup"><span data-stu-id="888b8-200">Many of the RPM/Deb packages provided by distributions configure NetworkManager as a conflict to the waagent package, and thus will uninstall NetworkManager when you install the Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="888b8-201">Systemkrav för allmänna Linux</span><span class="sxs-lookup"><span data-stu-id="888b8-201">General Linux System Requirements</span></span>

* <span data-ttu-id="888b8-202">Ändra raden kernel Start i GRUB eller GRUB2 för att inkludera följande parametrar.</span><span class="sxs-lookup"><span data-stu-id="888b8-202">Modify the kernel boot line in GRUB or GRUB2 to include the following parameters.</span></span> <span data-ttu-id="888b8-203">Detta säkerställer också att alla konsolmeddelanden skickas till den första seriella porten som kan hjälpa Azure support med felsökning av problem:</span><span class="sxs-lookup"><span data-stu-id="888b8-203">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="888b8-204">Detta säkerställer också att alla konsolmeddelanden skickas till den första seriella porten som kan hjälpa Azure support med felsökning av problem.</span><span class="sxs-lookup"><span data-stu-id="888b8-204">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="888b8-205">Förutom de som nämns ovan, rekommenderas att *ta bort* om de finns följande parametrar:</span><span class="sxs-lookup"><span data-stu-id="888b8-205">In addition to the above, it is recommended to *remove* the following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="888b8-206">Grafisk och tyst Start inte är användbara i en molnmiljö där vi vill att alla loggar som ska skickas till den seriella porten.</span><span class="sxs-lookup"><span data-stu-id="888b8-206">Graphical and quiet boot are not useful in a cloud environment where we want all the logs to be sent to the serial port.</span></span> <span data-ttu-id="888b8-207">Den `crashkernel` alternativet kan vara left konfigureras om så önskas, men Observera att den här parametern minskar mängden tillgängligt minne på den virtuella datorn med 128 MB eller mer, som kan vara problematiskt på de virtuella datorn är mindre.</span><span class="sxs-lookup"><span data-stu-id="888b8-207">The `crashkernel` option may be left configured if desired, but note that this parameter will reduce the amount of available memory in the VM by 128MB or more, which may be problematic on the smaller VM sizes.</span></span>

* <span data-ttu-id="888b8-208">Installera Azure Linux-Agent</span><span class="sxs-lookup"><span data-stu-id="888b8-208">Installing the Azure Linux Agent</span></span>
  
    <span data-ttu-id="888b8-209">Azure Linux-agenten krävs för att etablera en Linux-avbildning på Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-209">The Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="888b8-210">Många distributioner ger agenten som ett RPM eller Deb-paket (paketet kallas vanligtvis 'WALinuxAgent' eller 'walinuxagent').</span><span class="sxs-lookup"><span data-stu-id="888b8-210">Many distributions provide the agent as an RPM or Deb package (the package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="888b8-211">Agenten kan också installeras manuellt genom att följa stegen i den [Linux-agenten Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="888b8-211">The agent can also be installed manually by following the steps in the [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="888b8-212">Se till att SSH-server har installerats och konfigurerats för att starta när datorn startas.</span><span class="sxs-lookup"><span data-stu-id="888b8-212">Ensure that the SSH server is installed and configured to start at boot time.</span></span>  <span data-ttu-id="888b8-213">Detta är vanligtvis standardvärdet.</span><span class="sxs-lookup"><span data-stu-id="888b8-213">This is usually the default.</span></span>

* <span data-ttu-id="888b8-214">Skapa inte växlingsutrymme på OS-disk</span><span class="sxs-lookup"><span data-stu-id="888b8-214">Do not create swap space on the OS disk</span></span>
  
    <span data-ttu-id="888b8-215">Azure Linux-agenten kan automatiskt konfigurera växlingsutrymme med den lokala resurs disken som är kopplad till den virtuella datorn när du har etablerat på Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-215">The Azure Linux Agent can automatically configure swap space using the local resource disk that is attached to the VM after provisioning on Azure.</span></span> <span data-ttu-id="888b8-216">Observera att den lokala resurs disken är en *tillfälliga* disk och kan tömmas när den virtuella datorn avetableras.</span><span class="sxs-lookup"><span data-stu-id="888b8-216">Note that the local resource disk is a *temporary* disk, and might be emptied when the VM is deprovisioned.</span></span> <span data-ttu-id="888b8-217">När du har installerat Azure Linux-agenten (se föregående steg), ändra följande parametrar i /etc/waagent.conf på rätt sätt:</span><span class="sxs-lookup"><span data-stu-id="888b8-217">After installing the Azure Linux Agent (see previous step), modify the following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

* <span data-ttu-id="888b8-218">Kör följande kommandon för att ta bort etableringen av den virtuella datorn som ett sista steg:</span><span class="sxs-lookup"><span data-stu-id="888b8-218">As a final step, run the following commands to deprovision the virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="888b8-219">På Virtualbox kan du se följande fel när du har kört ' waagent-force - deprovision': `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="888b8-219">On Virtualbox you may see the following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="888b8-220">Det här felmeddelandet är inte viktigt och kan ignoreras.</span><span class="sxs-lookup"><span data-stu-id="888b8-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="888b8-221">Du måste sedan att stänga av den virtuella datorn och överför den virtuella Hårddisken till Azure.</span><span class="sxs-lookup"><span data-stu-id="888b8-221">You will then need to shut down the virtual machine and upload the VHD to Azure.</span></span>

