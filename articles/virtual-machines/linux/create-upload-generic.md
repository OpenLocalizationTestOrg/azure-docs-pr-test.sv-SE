---
title: aaaCreate och ladda upp en Linux-VHD i Azure
description: "Lär dig toocreate och överför en Azure virtuell hårddisk (VHD) som innehåller en Linux-operativsystem."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: 208e15c035edb5520fc29ba8e4e71c42b041864d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="b10dd-103">Information om icke-godkända distributioner</span><span class="sxs-lookup"><span data-stu-id="b10dd-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="b10dd-104">hello Azure-plattformen SLA gäller toovirtual datorer som kör hello Linux OS bara när en av hello [-godkända distributioner](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) används.</span><span class="sxs-lookup"><span data-stu-id="b10dd-104">hello Azure platform SLA applies toovirtual machines running hello Linux OS only when one of hello [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="b10dd-105">Alla Linux-distributioner som finns angivna i hello Azure avbildningen galleriet är godkända distributioner med hello nödvändig konfiguration.</span><span class="sxs-lookup"><span data-stu-id="b10dd-105">All Linux distributions that are provided in hello Azure image gallery are endorsed distributions with hello required configuration.</span></span>

* [<span data-ttu-id="b10dd-106">Linux på Azure - godkända distributioner</span><span class="sxs-lookup"><span data-stu-id="b10dd-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="b10dd-107">Stöd för Linux-avbildningar i Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="b10dd-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="b10dd-108">Alla distributioner som körs på Azure måste toomeet ett antal krav toohave en chans tooproperly köras på hello-plattformar.</span><span class="sxs-lookup"><span data-stu-id="b10dd-108">All distributions running on Azure will need toomeet a number of prerequisites toohave a chance tooproperly run on hello platform.</span></span>  <span data-ttu-id="b10dd-109">Den här artikeln är inte menat omfattande som varje distribution är olika. och det är fullt möjligt att även om du uppfyller alla hello villkoren nedan du måste fortfarande toosignificantly justera tooensure ditt Linux-system som körs korrekt på hello-plattformen.</span><span class="sxs-lookup"><span data-stu-id="b10dd-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all hello criteria below you will still need toosignificantly tweak your Linux system tooensure that it properly runs on hello platform.</span></span>

<span data-ttu-id="b10dd-110">Det är därför som vi rekommenderar att du börjar med en av våra [Linux på Azure-godkända distributioner](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="b10dd-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="b10dd-111">hello följande artiklar får du stegvisa anvisningar hur tooprepare hello olika godkända Linux-distributioner som stöds i Azure:</span><span class="sxs-lookup"><span data-stu-id="b10dd-111">hello following articles will guide you through how tooprepare hello various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="b10dd-112">**[CentOS-baserade distributioner](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b10dd-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b10dd-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b10dd-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b10dd-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b10dd-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b10dd-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b10dd-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b10dd-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b10dd-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b10dd-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b10dd-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="b10dd-118">hello resten av den här artikeln fokuserar på allmänna riktlinjer för att köra Linux-distribution på Azure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-118">hello rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="b10dd-119">Allmän Linux installationsinformation</span><span class="sxs-lookup"><span data-stu-id="b10dd-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="b10dd-120">Hej VHDX-format stöds inte i Azure, endast **fast virtuell Hårddisk**.</span><span class="sxs-lookup"><span data-stu-id="b10dd-120">hello VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="b10dd-121">Du kan konvertera hello tooVHD diskformat med Hyper-V Manager eller hello convert-vhd-cmdlet.</span><span class="sxs-lookup"><span data-stu-id="b10dd-121">You can convert hello disk tooVHD format using Hyper-V Manager or hello convert-vhd cmdlet.</span></span> <span data-ttu-id="b10dd-122">Om du använder VirtualBox innebär detta att välja **fast storlek** som motsats toohello standard dynamiskt allokerade när du skapar hello disk.</span><span class="sxs-lookup"><span data-stu-id="b10dd-122">If you are using VirtualBox this means selecting **Fixed size** as opposed toohello default dynamically allocated when creating hello disk.</span></span>
* <span data-ttu-id="b10dd-123">Azure har endast stöd för virtuella datorer i generation 1.</span><span class="sxs-lookup"><span data-stu-id="b10dd-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="b10dd-124">Du kan konvertera en generation 1 virtuell dator från VHDX toohello VHD-filformatet och dynamiskt expanderande tooa fast storlek disk.</span><span class="sxs-lookup"><span data-stu-id="b10dd-124">You can convert a generation 1 virtual machine from VHDX toohello VHD file format and from dynamically expanding tooa fixed sized disk.</span></span> <span data-ttu-id="b10dd-125">Men du kan inte ändra en virtuell dator generation.</span><span class="sxs-lookup"><span data-stu-id="b10dd-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="b10dd-126">Mer information finns i [bör jag skapa en virtuell dator i generation 1 eller 2 i Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="b10dd-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="b10dd-127">Maximal storlek för hello tillåts för hello VHD 1,023 GB.</span><span class="sxs-lookup"><span data-stu-id="b10dd-127">hello maximum size allowed for hello VHD is 1,023 GB.</span></span>
* <span data-ttu-id="b10dd-128">När du installerar hello Linux-system är *rekommenderas* att du använder standard partitioner i stället för LVM (ofta hello standard för många installationer).</span><span class="sxs-lookup"><span data-stu-id="b10dd-128">When installing hello Linux system it is *recommended* that you use standard partitions rather than LVM (often hello default for many installations).</span></span> <span data-ttu-id="b10dd-129">På så sätt undviker LVM står i konflikt med klonade virtuella datorer, särskilt om en OS-disk behövs toobe kopplade tooanother identiska VM för felsökning.</span><span class="sxs-lookup"><span data-stu-id="b10dd-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs toobe attached tooanother identical VM for troubleshooting.</span></span> <span data-ttu-id="b10dd-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) eller [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) får användas i datadiskar.</span><span class="sxs-lookup"><span data-stu-id="b10dd-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="b10dd-131">Kernel-stöd för att montera UDF-filsystem krävs.</span><span class="sxs-lookup"><span data-stu-id="b10dd-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="b10dd-132">Vid första start på Azure hello skickas etablering configuration toohello Linux VM via UDF-formaterad media som är bifogade toohello gäst.</span><span class="sxs-lookup"><span data-stu-id="b10dd-132">At first boot on Azure hello provisioning configuration is passed toohello Linux VM via UDF-formatted media that is attached toohello guest.</span></span> <span data-ttu-id="b10dd-133">hello Azure Linux-agenten måste kunna toomount hello UDF filen system tooread dess konfiguration och etablera hello VM.</span><span class="sxs-lookup"><span data-stu-id="b10dd-133">hello Azure Linux agent must be able toomount hello UDF file system tooread its configuration and provision hello VM.</span></span>
* <span data-ttu-id="b10dd-134">Linux kernel-versioner än 2.6.37 stöder inte NUMA på Hyper-V med större VM-storlekar.</span><span class="sxs-lookup"><span data-stu-id="b10dd-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="b10dd-135">I detta fall främst påverkar äldre distributioner med hello uppströms Red Hat 2.6.32 kernel och åtgärdades i RHEL 6.6 (kernel-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="b10dd-135">This issue primarily impacts older distributions using hello upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="b10dd-136">System som kör anpassade kernlar som är äldre än 2.6.37 eller RHEL-baserade kernlar som är äldre än 2.6.32-504 måste ange hello Start parametern `numa=off` på hello kernel kommandoradsverktyg i grub.conf.</span><span class="sxs-lookup"><span data-stu-id="b10dd-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set hello boot parameter `numa=off` on hello kernel command-line in grub.conf.</span></span> <span data-ttu-id="b10dd-137">Mer information finns i Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="b10dd-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="b10dd-138">Konfigurera inte en byte-partition på hello OS-disken.</span><span class="sxs-lookup"><span data-stu-id="b10dd-138">Do not configure a swap partition on hello OS disk.</span></span> <span data-ttu-id="b10dd-139">hello Linux-agenten kan vara konfigurerade toocreate en växlingsfil på hello temporär disk.</span><span class="sxs-lookup"><span data-stu-id="b10dd-139">hello Linux agent can be configured toocreate a swap file on hello temporary resource disk.</span></span>  <span data-ttu-id="b10dd-140">Mer information om detta finns i hello stegen nedan.</span><span class="sxs-lookup"><span data-stu-id="b10dd-140">More information about this can be found in hello steps below.</span></span>
* <span data-ttu-id="b10dd-141">Alla virtuella hårddiskar hello måste ha storlekar som multiplar av 1 MB.</span><span class="sxs-lookup"><span data-stu-id="b10dd-141">All of hello VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="b10dd-142">Installera kernel moduler utan Hyper-V</span><span class="sxs-lookup"><span data-stu-id="b10dd-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="b10dd-143">Azure körs på hello Hyper-V hypervisor-programmet så Linux kräver att vissa kernel-moduler är installerade i ordning toorun i Azure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-143">Azure runs on hello Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order toorun in Azure.</span></span> <span data-ttu-id="b10dd-144">Om du har en virtuell dator som har skapats utanför Hyper-V hello Linux installationsprogram får inte innehålla hello drivrutiner för Hyper-V i hello inledande ramdisk (initrd eller initramfs) om den identifierar att den körs en Hyper-V-miljö.</span><span class="sxs-lookup"><span data-stu-id="b10dd-144">If you have a VM that was created outside of Hyper-V, hello Linux installers may not include hello drivers for Hyper-V in hello initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="b10dd-145">När du använder en annan virtualisering system (d.v.s. Virtualbox, KVM o.s.v.) tooprepare Linux avbildningen måste du kanske måste toorebuild hello initrd tooensure minst hello `hv_vmbus` och `hv_storvsc` kernel-moduler är tillgängliga på hello inledande ramdisk.</span><span class="sxs-lookup"><span data-stu-id="b10dd-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) tooprepare your Linux image, you may need toorebuild hello initrd tooensure that at least hello `hv_vmbus` and `hv_storvsc` kernel modules are available on hello initial ramdisk.</span></span>  <span data-ttu-id="b10dd-146">Detta är ett känt problem minst på system baserat på hello överordnade Red Hat-distribution.</span><span class="sxs-lookup"><span data-stu-id="b10dd-146">This is a known issue at least on systems based on hello upstream Red Hat distribution.</span></span>

<span data-ttu-id="b10dd-147">hello mekanism för att återskapa hello initrd eller initramfs avbildningen kan variera beroende på hello-distribution.</span><span class="sxs-lookup"><span data-stu-id="b10dd-147">hello mechanism for rebuilding hello initrd or initramfs image may vary depending on hello distribution.</span></span> <span data-ttu-id="b10dd-148">Dokumentationen för din distribution eller stöd för hello rätt proceduren.</span><span class="sxs-lookup"><span data-stu-id="b10dd-148">Please consult your distribution's documentation or support for hello proper procedure.</span></span>  <span data-ttu-id="b10dd-149">Här är ett exempel på hur toorebuild hello initrd med hello `mkinitrd` verktyget:</span><span class="sxs-lookup"><span data-stu-id="b10dd-149">Here is one example for how toorebuild hello initrd using hello `mkinitrd` utility:</span></span>

<span data-ttu-id="b10dd-150">Säkerhetskopiera först hello befintliga initrd avbildningen:</span><span class="sxs-lookup"><span data-stu-id="b10dd-150">First, back up hello existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="b10dd-151">Därefter återskapa hello initrd med hello `hv_vmbus` och `hv_storvsc` kernel moduler:</span><span class="sxs-lookup"><span data-stu-id="b10dd-151">Next, rebuild hello initrd with hello `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="b10dd-152">Ändra storlek på virtuella hårddiskar</span><span class="sxs-lookup"><span data-stu-id="b10dd-152">Resizing VHDs</span></span>
<span data-ttu-id="b10dd-153">VHD-avbildningar i Azure måste ha en virtuell storlek justerad too1MB.</span><span class="sxs-lookup"><span data-stu-id="b10dd-153">VHD images on Azure must have a virtual size aligned too1MB.</span></span>  <span data-ttu-id="b10dd-154">Normalt ska redan virtuella hårddiskar som skapats med hjälp av Hyper-V justeras korrekt.</span><span class="sxs-lookup"><span data-stu-id="b10dd-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="b10dd-155">Om hello VHD inte justeras korrekt och att du får ett fel meddelande liknande toohello följande när du försöker toocreate en *bild* från den virtuella Hårddisken:</span><span class="sxs-lookup"><span data-stu-id="b10dd-155">If hello VHD is not aligned correctly then you may receive an error message similar toohello following when you attempt toocreate an *image* from your VHD:</span></span>

    "hello VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. hello size must be a whole number (in MBs).”

<span data-ttu-id="b10dd-156">tooremedy detta du kan ändra storlek hello VM som använder hello Hyper-V Manager-konsolen eller hello [storleksändring VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell-cmdlet.</span><span class="sxs-lookup"><span data-stu-id="b10dd-156">tooremedy this you can resize hello VM using either hello Hyper-V Manager console or hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="b10dd-157">Om du inte körs i en Windows-miljö är det rekommenderade toouse qemu img tooconvert (om det behövs) och ändra storlek på hello VHD.</span><span class="sxs-lookup"><span data-stu-id="b10dd-157">If you are not running in a Windows environment then it is recommended toouse qemu-img tooconvert (if needed) and resize hello VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="b10dd-158">Det finns ett känt fel i qemu img versioner > = 2.2.1 som resulterar i en felaktigt formaterad virtuell Hårddisk.</span><span class="sxs-lookup"><span data-stu-id="b10dd-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="b10dd-159">hello problemet är åtgärdat i QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="b10dd-159">hello issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="b10dd-160">Det rekommenderas toouse qemu img 2.2.0 eller lägre eller uppdatering too2.6 eller högre.</span><span class="sxs-lookup"><span data-stu-id="b10dd-160">It is recommended toouse either qemu-img 2.2.0 or lower, or update too2.6 or higher.</span></span> <span data-ttu-id="b10dd-161">Referens: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="b10dd-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="b10dd-162">Ändra storlek på hello VHD direkt med hjälp av verktyg som `qemu-img` eller `vbox-manage` kan resultera i en VHD som inte kan startas.</span><span class="sxs-lookup"><span data-stu-id="b10dd-162">Resizing hello VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="b10dd-163">Därför rekommenderas toofirst konvertera hello VHD tooa RAW diskavbildning.</span><span class="sxs-lookup"><span data-stu-id="b10dd-163">So it is recommended toofirst convert hello VHD tooa RAW disk image.</span></span>  <span data-ttu-id="b10dd-164">Om hello VM-avbildning har redan skapats som RÅDATA diskavbildning (hello standard för vissa hypervisor-program, till exempel KVM) kan du hoppa över det här steget:</span><span class="sxs-lookup"><span data-stu-id="b10dd-164">If hello VM image was already created as RAW disk image (hello default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="b10dd-165">Beräkna hello storlek som krävs av hello disk image tooensure som hello virtuell storlek är justerade too1MB.</span><span class="sxs-lookup"><span data-stu-id="b10dd-165">Calculate hello required size of hello disk image tooensure that hello virtual size is aligned too1MB.</span></span>  <span data-ttu-id="b10dd-166">hello följande bash shell-skript kan hjälpa till med den här.</span><span class="sxs-lookup"><span data-stu-id="b10dd-166">hello following bash shell script can assist with this.</span></span>  <span data-ttu-id="b10dd-167">hello-skript som använder ”`qemu-img info`” toodetermine hello virtuell storlek på hello diskavbildning och beräknar sedan hello storlek toohello nästa 1 MB:</span><span class="sxs-lookup"><span data-stu-id="b10dd-167">hello script uses "`qemu-img info`" toodetermine hello virtual size of hello disk image and then calculates hello size toohello next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="b10dd-168">Ändra storlek på hello rådata disk med hjälp av $rounded_size som angetts i hello ovan skript:</span><span class="sxs-lookup"><span data-stu-id="b10dd-168">Resize hello raw disk using $rounded_size as set in hello above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="b10dd-169">Nu kan konvertera hello RÅDATA disk tillbaka tooa VHD med fast storlek:</span><span class="sxs-lookup"><span data-stu-id="b10dd-169">Now, convert hello RAW disk back tooa fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="b10dd-170">Eller med qemu version **2.6 +** inkluderar hello `force_size` alternativ:</span><span class="sxs-lookup"><span data-stu-id="b10dd-170">Or, with qemu version **2.6+** include hello `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="b10dd-171">Linux-Kernel-krav</span><span class="sxs-lookup"><span data-stu-id="b10dd-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="b10dd-172">hello Linux Integration Services (LIS) drivrutiner för Hyper-V och Azure tillhandahålls direkt toohello överordnade Linux kernel.</span><span class="sxs-lookup"><span data-stu-id="b10dd-172">hello Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly toohello upstream Linux kernel.</span></span> <span data-ttu-id="b10dd-173">Många distributioner som innehåller de senaste Linux kernel-version (d.v.s. 3.x) redan har dessa drivrutiner eller annat sätt tillhandahålla anpassats versioner av drivrutinerna med deras kärnor.</span><span class="sxs-lookup"><span data-stu-id="b10dd-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="b10dd-174">De här drivrutinerna som uppdateras kontinuerligt i hello överordnade kernel med nya korrigeringar och funktioner, så när det är möjligt bör toorun en [godkända distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) som innehåller dessa korrigeringar och uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="b10dd-174">These drivers are constantly being updated in hello upstream kernel with new fixes and features, so when possible it is recommended toorun an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="b10dd-175">Om du använder en variant av Red Hat Enterprise Linux versioner **6.0 6.3**, behöver du tooinstall hello senaste LIS drivrutiner för Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="b10dd-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need tooinstall hello latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="b10dd-176">hello drivrutinerna finns [på den här platsen](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="b10dd-176">hello drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="b10dd-177">Från och med RHEL **6.4 +** (och derivat) hello LIS drivrutiner ingår redan i hello kernel och därför inga ytterligare Installationspaketen är nödvändiga toorun dessa system på Azure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-177">As of RHEL **6.4+** (and derivatives) hello LIS drivers are already included with hello kernel and so no additional installation packages are needed toorun those systems on Azure.</span></span>

<span data-ttu-id="b10dd-178">Om en anpassad kernel krävs, är det rekommenderade toouse en nyare version av kernel (d.v.s. **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="b10dd-178">If a custom kernel is required, it is recommended toouse a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="b10dd-179">För dessa distributioner eller leverantörer som hanterar sina egna kernel blir möda nödvändiga tooregularly backport hello LIS drivrutiner från hello överordnade kernel tooyour anpassade kernel.</span><span class="sxs-lookup"><span data-stu-id="b10dd-179">For those distributions or vendors who maintain their own kernel, some effort will be required tooregularly backport hello LIS drivers from hello upstream kernel tooyour custom kernel.</span></span>  <span data-ttu-id="b10dd-180">Även om du redan kör en relativt nya kernel-version, rekommenderas tookeep reda på någon uppströms åtgärdas i hello LIS drivrutiner och backport dem efter behov.</span><span class="sxs-lookup"><span data-stu-id="b10dd-180">Even if you are already running a relatively recent kernel version, it is highly recommended tookeep track of any upstream fixes in hello LIS drivers and backport those as needed.</span></span> <span data-ttu-id="b10dd-181">hello hello LIS drivrutinens källfiler finns tillgängliga i hello [sköter underhåll SJÄLVA](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) filen i hello Linux kernel källa trädet:</span><span class="sxs-lookup"><span data-stu-id="b10dd-181">hello location of hello LIS driver source files is available in hello [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in hello Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="b10dd-182">Vid en mycket minsta hello frånvaron av hello följande korrigeringsfiler har rapporterats toocause problem på Azure och så de måste inkluderas i hello kernel.</span><span class="sxs-lookup"><span data-stu-id="b10dd-182">At a very minimum, hello absence of hello following patches have been known toocause problems on Azure and so these must be included in hello kernel.</span></span> <span data-ttu-id="b10dd-183">Den här listan är inte menat fullständig eller fullständig för alla distributioner:</span><span class="sxs-lookup"><span data-stu-id="b10dd-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="b10dd-184">ata_piix: skjuta upp diskar toohello Hyper-V-drivrutiner som standard</span><span class="sxs-lookup"><span data-stu-id="b10dd-184">ata_piix: defer disks toohello Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="b10dd-185">storvsc: kontot för transit paket i hello Återställ sökväg</span><span class="sxs-lookup"><span data-stu-id="b10dd-185">storvsc: Account for in-transit packets in hello RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="b10dd-186">storvsc: undvika användningen av WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="b10dd-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="b10dd-187">storvsc: inaktivera skriva samma för RAID och drivrutiner för nätverkskort för virtuell värddator</span><span class="sxs-lookup"><span data-stu-id="b10dd-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="b10dd-188">storvsc: NULL-pekare avreferera-korrigering</span><span class="sxs-lookup"><span data-stu-id="b10dd-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="b10dd-189">storvsc: ring buffer fel kan resultera i i/o-låsning</span><span class="sxs-lookup"><span data-stu-id="b10dd-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="b10dd-190">scsi_sysfs: skydda dig mot dubbla körning av __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="b10dd-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="hello-azure-linux-agent"></a><span data-ttu-id="b10dd-191">hello Azure Linux-agenten</span><span class="sxs-lookup"><span data-stu-id="b10dd-191">hello Azure Linux Agent</span></span>
<span data-ttu-id="b10dd-192">Hej [Azure Linux-agenten](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) krävs tooproperly etablera en virtuell Linux-dator i Azure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-192">hello [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required tooproperly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="b10dd-193">Du kan hämta hello senaste versionen, filen problem eller skicka pull-förfrågningar på hello [Linux-agenten GitHub-repo-](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="b10dd-193">You can get hello latest version, file issues or submit pull requests at hello [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="b10dd-194">hello Linux-agenten släpps under hello Apache 2.0-licens.</span><span class="sxs-lookup"><span data-stu-id="b10dd-194">hello Linux agent is released under hello Apache 2.0 license.</span></span> <span data-ttu-id="b10dd-195">Många distributioner ange redan RPM eller deb paket för hello agent och så i vissa fall detta kan du installera och uppdatera visningsläge.</span><span class="sxs-lookup"><span data-stu-id="b10dd-195">Many distributions already provide RPM or deb packages for hello agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="b10dd-196">hello Azure Linux-agenten kräver Python v2.6 +.</span><span class="sxs-lookup"><span data-stu-id="b10dd-196">hello Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="b10dd-197">hello agent kräver också hello python pyasn1 modul.</span><span class="sxs-lookup"><span data-stu-id="b10dd-197">hello agent also requires hello python-pyasn1 module.</span></span> <span data-ttu-id="b10dd-198">De flesta distributioner ger detta som ett separat paket som kan installeras.</span><span class="sxs-lookup"><span data-stu-id="b10dd-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="b10dd-199">Hello Azure Linux-agenten kanske inte kompatibelt med NetworkManager i vissa fall.</span><span class="sxs-lookup"><span data-stu-id="b10dd-199">In some cases hello Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="b10dd-200">Många av hello RPM/Deb-paket som tillhandahålls av distributioner konfigurera NetworkManager som en konflikt toohello waagent paket och därmed kommer att avinstallera NetworkManager när du installerar hello Linux-agenten.</span><span class="sxs-lookup"><span data-stu-id="b10dd-200">Many of hello RPM/Deb packages provided by distributions configure NetworkManager as a conflict toohello waagent package, and thus will uninstall NetworkManager when you install hello Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="b10dd-201">Systemkrav för allmänna Linux</span><span class="sxs-lookup"><span data-stu-id="b10dd-201">General Linux System Requirements</span></span>

* <span data-ttu-id="b10dd-202">Ändra hello kernel Start rad i GRUB eller GRUB2 tooinclude hello följande parametrar.</span><span class="sxs-lookup"><span data-stu-id="b10dd-202">Modify hello kernel boot line in GRUB or GRUB2 tooinclude hello following parameters.</span></span> <span data-ttu-id="b10dd-203">Detta säkerställer också att alla konsolmeddelanden skickas toohello första serieport, som kan hjälpa Azure support med felsökning av problem:</span><span class="sxs-lookup"><span data-stu-id="b10dd-203">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="b10dd-204">Detta säkerställer också att alla konsolmeddelanden skickas toohello första serieport, som kan hjälpa Azure support med felsökning av problem.</span><span class="sxs-lookup"><span data-stu-id="b10dd-204">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="b10dd-205">Dessutom toohello ovan, rekommenderas för*ta bort* hello följande parametrar om de finns:</span><span class="sxs-lookup"><span data-stu-id="b10dd-205">In addition toohello above, it is recommended too*remove* hello following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="b10dd-206">Grafisk och tyst Start inte är användbara i en molnmiljö där vi vill att alla hello loggar toobe skickas toohello serieport.</span><span class="sxs-lookup"><span data-stu-id="b10dd-206">Graphical and quiet boot are not useful in a cloud environment where we want all hello logs toobe sent toohello serial port.</span></span> <span data-ttu-id="b10dd-207">Hej `crashkernel` alternativet kan vara left konfigureras om så önskas, men Observera att den här parametern minskar hello mängden tillgängligt minne i hello VM 128 MB eller mer, som kan vara problematiskt på hello mindre VM-storlekar.</span><span class="sxs-lookup"><span data-stu-id="b10dd-207">hello `crashkernel` option may be left configured if desired, but note that this parameter will reduce hello amount of available memory in hello VM by 128MB or more, which may be problematic on hello smaller VM sizes.</span></span>

* <span data-ttu-id="b10dd-208">Installera hello Azure Linux-agenten</span><span class="sxs-lookup"><span data-stu-id="b10dd-208">Installing hello Azure Linux Agent</span></span>
  
    <span data-ttu-id="b10dd-209">hello Azure Linux-agenten krävs för att etablera en Linux-avbildning på Azure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-209">hello Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="b10dd-210">Många distributioner ange hello agent som ett RPM eller Deb (hello paketet kallas vanligtvis 'WALinuxAgent' eller 'walinuxagent').</span><span class="sxs-lookup"><span data-stu-id="b10dd-210">Many distributions provide hello agent as an RPM or Deb package (hello package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="b10dd-211">hello agent kan även installeras manuellt genom att följa stegen hello i hello [Linux-agenten Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="b10dd-211">hello agent can also be installed manually by following hello steps in hello [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="b10dd-212">Se till att hello SSH-server är installerat och konfigurerat toostart vid start.</span><span class="sxs-lookup"><span data-stu-id="b10dd-212">Ensure that hello SSH server is installed and configured toostart at boot time.</span></span>  <span data-ttu-id="b10dd-213">Detta är vanligtvis hello standard.</span><span class="sxs-lookup"><span data-stu-id="b10dd-213">This is usually hello default.</span></span>

* <span data-ttu-id="b10dd-214">Skapa inte växlingsutrymme på hello OS-disk</span><span class="sxs-lookup"><span data-stu-id="b10dd-214">Do not create swap space on hello OS disk</span></span>
  
    <span data-ttu-id="b10dd-215">hello Azure Linux-agenten kan automatiskt konfigurera växlingsutrymme med hello lokala resursen disk som är bifogade toohello VM efter etableringen på Azure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-215">hello Azure Linux Agent can automatically configure swap space using hello local resource disk that is attached toohello VM after provisioning on Azure.</span></span> <span data-ttu-id="b10dd-216">Observera den lokala resurs hello-disken är en *tillfälliga* disk och kan tömmas när hello VM är avetablerade.</span><span class="sxs-lookup"><span data-stu-id="b10dd-216">Note that hello local resource disk is a *temporary* disk, and might be emptied when hello VM is deprovisioned.</span></span> <span data-ttu-id="b10dd-217">När du har installerat hello Azure Linux-agenten (se föregående steg), ändra hello följande parametrar i /etc/waagent.conf på rätt sätt:</span><span class="sxs-lookup"><span data-stu-id="b10dd-217">After installing hello Azure Linux Agent (see previous step), modify hello following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this toowhatever you need it toobe.

* <span data-ttu-id="b10dd-218">Kör hello följande kommandon toodeprovision hello virtuell dator som ett sista steg:</span><span class="sxs-lookup"><span data-stu-id="b10dd-218">As a final step, run hello following commands toodeprovision hello virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="b10dd-219">På Virtualbox kan du se följande fel när du har kört hello ' waagent-force - deprovision': `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="b10dd-219">On Virtualbox you may see hello following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="b10dd-220">Det här felmeddelandet är inte viktigt och kan ignoreras.</span><span class="sxs-lookup"><span data-stu-id="b10dd-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="b10dd-221">Du behöver tooshut ned hello virtuella datorn och därefter överföra hello VHD tooAzure.</span><span class="sxs-lookup"><span data-stu-id="b10dd-221">You will then need tooshut down hello virtual machine and upload hello VHD tooAzure.</span></span>

