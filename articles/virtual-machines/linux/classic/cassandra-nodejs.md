---
title: aaaRun Cassandra med Linux i Azure | Microsoft Docs
description: "Hur toorun en Cassandra kluster på Linux i Azure Virtual Machines från en Node.js-app"
services: virtual-machines-linux
documentationcenter: nodejs
author: tomarcher
manager: routlaw
editor: 
tags: azure-service-management
ms.assetid: 30de1f29-e97d-492f-ae34-41ec83488de0
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: tarcher
ms.openlocfilehash: 381ca301bbe88d3740cf182f9c44fada5b9ba7cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a><span data-ttu-id="ee0d6-103">Kör Cassandra med Linux på Azure och få åtkomst till det från Node.js</span><span class="sxs-lookup"><span data-stu-id="ee0d6-103">Running Cassandra with Linux on Azure and Accessing it from Node.js</span></span>
> [!IMPORTANT] 
> <span data-ttu-id="ee0d6-104">Azure har två olika distributionsmodeller för att skapa och arbeta med resurser: [Resource Manager och klassisk](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="ee0d6-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="ee0d6-105">Den här artikeln täcker hello klassiska distributionsmodellen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-105">This article covers using hello Classic deployment model.</span></span> <span data-ttu-id="ee0d6-106">Microsoft rekommenderar att de flesta nya distributioner använder hello Resource Manager-modellen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-106">Microsoft recommends that most new deployments use hello Resource Manager model.</span></span> <span data-ttu-id="ee0d6-107">Se Resource Manager-mallar för [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) och [Väck klustret och Cassandra på CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span><span class="sxs-lookup"><span data-stu-id="ee0d6-107">See Resource Manager templates for [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) and [Spark cluster and Cassandra on CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span></span>

## <a name="overview"></a><span data-ttu-id="ee0d6-108">Översikt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-108">Overview</span></span>
<span data-ttu-id="ee0d6-109">Microsoft Azure är en öppen molnplattform som körs både Microsoft som bra som icke-Microsoft-programvara som innehåller operativsystem, programservrar, meddelanden mellanprogram såväl som SQL- och NoSQL-databaser från båda modellerna kommersiella och Öppna källa.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-109">Microsoft Azure is an open cloud platform that runs both Microsoft as well as non-Microsoft software which  includes operating systems, application servers, messaging middleware as well as SQL and NoSQL databases from both commercial and open source models.</span></span> <span data-ttu-id="ee0d6-110">Bygga flexibel tjänster på offentliga moln, inklusive Azure kräver noggrann planering och arkitektur för avsiktlig för båda programservrarna som korrekt lagring lager.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-110">Building resilient services on public clouds including Azure requires careful planning and deliberate architecture for both applications servers as well storage layers.</span></span> <span data-ttu-id="ee0d6-111">Cassandras distribuerade lagringsarkitektur naturligt hjälper till att skapa hög tillgänglighet system som är feltolerant för klustret.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-111">Cassandra’s distributed storage architecture naturally helps in building highly available systems that are fault tolerant for cluster failures.</span></span> <span data-ttu-id="ee0d6-112">Cassandra är molnskala NoSQL-databas som underhålls av Apache Software Foundation på cassandra.apache.org; Cassandra är skriven i Java och därför körs på både på Windows och Linux plattformar.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-112">Cassandra is a cloud scale NoSQL database maintained by Apache Software Foundation at cassandra.apache.org; Cassandra is written in Java and hence runs on both on Windows as well as Linux platforms.</span></span>

<span data-ttu-id="ee0d6-113">hello fokuserar den här artikeln på tooshow Cassandra distributionen på Ubuntu som ett enstaka och flera Datacenter-kluster som utnyttjar Microsoft Azure virtuella datorer och virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-113">hello focus of this article is tooshow Cassandra deployment on Ubuntu as a single and multi-data center cluster leveraging Microsoft Azure Virtual Machines and Virtual Networks.</span></span> <span data-ttu-id="ee0d6-114">hello Klusterdistribution för produktionsarbetsbelastningar optimerade ligger utanför omfånget för den här artikeln eftersom den kräver flera disk nodkonfiguration, lämpliga ring topologi design- och datamodeller toosupport hello behövs replikering, datakonsekvens, genomflöde och krav för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-114">hello cluster deployment for production optimized workloads is out of scope of this article as it requires multi-disk node configuration, appropriate ring topology design and data modeling toosupport hello needed replication, data consistency, throughput and high availability requirements.</span></span>

<span data-ttu-id="ee0d6-115">Den här artikeln tar en grundläggande tillvägagångssätt tooshow vad ingår i byggnaden hello Cassandra klustret jämfört med Docker, Chef eller Puppet, vilket kan göra hello distribution av infrastruktur mycket enklare.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-115">This article takes a fundamental approach tooshow what is involved in building hello Cassandra cluster compared Docker, Chef or Puppet which can make hello infrastructure deployment a lot easier.</span></span>  

## <a name="hello-deployment-models"></a><span data-ttu-id="ee0d6-116">Hej distributionsmodeller</span><span class="sxs-lookup"><span data-stu-id="ee0d6-116">hello Deployment Models</span></span>
<span data-ttu-id="ee0d6-117">Microsoft Azure-nätverk kan hello distribution isolerat privat kluster, hello åtkomst som kan vara begränsad tooattain bra metataggkontroll nätverkssäkerhet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-117">Microsoft Azure networking allows hello deployment of isolated private clusters, hello access of which can be restricted tooattain fine grained network security.</span></span>  <span data-ttu-id="ee0d6-118">Eftersom den här artikeln om hur du visar hello Cassandra distribution på en grundläggande nivå kan fokuserar vi inte på hello konsekvensnivå och hello optimala lagringsdesignen för genomströmning.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-118">Since this article is about showing hello Cassandra deployment at a fundamental level, we will not focus on hello consistency level and hello optimal storage design for throughput.</span></span> <span data-ttu-id="ee0d6-119">Här är hello lista över nätverkskrav för vår hypotetiska klustret:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-119">Here is hello list of networking requirements for our hypothetical cluster:</span></span>

* <span data-ttu-id="ee0d6-120">Externa system kan inte komma åt Cassandra databasen från inom eller utanför Azure</span><span class="sxs-lookup"><span data-stu-id="ee0d6-120">External systems can’t access Cassandra database from within or outside Azure</span></span>
* <span data-ttu-id="ee0d6-121">Cassandra klustret har toobe bakom en belastningsutjämnare för thrift-trafik</span><span class="sxs-lookup"><span data-stu-id="ee0d6-121">Cassandra cluster has toobe behind a load balancer for thrift traffic</span></span>
* <span data-ttu-id="ee0d6-122">Distribuera Cassandra noder i två grupper i varje Datacenter för en förbättrad klustret</span><span class="sxs-lookup"><span data-stu-id="ee0d6-122">Deploy Cassandra nodes in two groups in each data center for an enhanced cluster availability</span></span>
* <span data-ttu-id="ee0d6-123">Låsa hello klustret så som endast programmet servergruppen har åtkomst toohello databasen direkt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-123">Lock down hello cluster so that only application server farm has access toohello database directly</span></span>
* <span data-ttu-id="ee0d6-124">Inga offentliga nätverk slutpunkter än SSH</span><span class="sxs-lookup"><span data-stu-id="ee0d6-124">No public networking endpoints other than SSH</span></span>
* <span data-ttu-id="ee0d6-125">Varje Cassandra nod måste en fast interna IP-adress</span><span class="sxs-lookup"><span data-stu-id="ee0d6-125">Each Cassandra node needs a fixed internal IP address</span></span>

<span data-ttu-id="ee0d6-126">Cassandra kan vara distribuerade tooa enda Azure region eller toomultiple regioner baserat på hello distribuerade uppbyggnad hello arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-126">Cassandra can be deployed tooa single Azure region or toomultiple regions based on hello distributed nature of hello workload.</span></span> <span data-ttu-id="ee0d6-127">Distributionsmodell för flera regioner kan vara balanserad tooserve slutanvändare närmare tooa viss geografisk plats via hello samma Cassandra infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-127">Multi-region deployment model can be leveraged tooserve end users closer tooa particular geography through hello same Cassandra infrastructure.</span></span> <span data-ttu-id="ee0d6-128">Cassandras inbyggda nod replikering tar hand om hello synkronisering av flera master skriver härstammar från flera datacenter och anger en konsekvent överblick över hello data tooapplications.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-128">Cassandra’s built-in node replication takes care of hello synchronization of multi-master writes originating from multiple data centers and presents a consistent view of hello data tooapplications.</span></span> <span data-ttu-id="ee0d6-129">Distribution av flera regioner kan också med hello minska riskerna för hello bredare avbrott i Azure-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-129">Multi-region deployment can also help with hello risk mitigation of hello broader Azure service outages.</span></span> <span data-ttu-id="ee0d6-130">Cassandras justerbara konsekvens och replikeringstopologin hjälper att uppfylla olika Återställningspunktmål behov av program.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-130">Cassandra’s tunable consistency and replication topology will help in meeting diverse RPO needs of applications.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="ee0d6-131">Distribution av enskild Region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-131">Single Region Deployment</span></span>
<span data-ttu-id="ee0d6-132">Vi börjar med en enskild region-distribution och skörd hello learnings att skapa en modell för flera regioner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-132">We will start with a single region deployment and harvest hello learnings in creating a multi-region model.</span></span> <span data-ttu-id="ee0d6-133">Azure virtuella nätverk kommer att använda toocreate isolerade undernät så att hello nätverkssäkerhetskrav som nämns ovan kan uppfyllas.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-133">Azure virtual networking will be used toocreate isolated subnets so that hello network security requirements mentioned above can be met.</span></span>  <span data-ttu-id="ee0d6-134">hello processen som beskrivs i avsnittet Skapa hello enskild region distributionen använder Ubuntu 14.04 LTS och Cassandra 2.08; hello process kan dock lätt att antagna toohello andra varianter av Linux.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-134">hello process described in creating hello single region deployment uses Ubuntu 14.04 LTS and Cassandra 2.08; however, hello process can easily be adopted toohello other Linux variants.</span></span> <span data-ttu-id="ee0d6-135">hello nedan följer några av hello systemfel egenskaper hello enskild region distribution.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-135">hello following are some of hello systemic characteristics of hello single region deployment.</span></span>  

<span data-ttu-id="ee0d6-136">**Hög tillgänglighet:** hello Cassandra noder som visas i bild 1 distribueras hello tootwo tillgänglighetsuppsättningar så att hello noder sprids mellan flera feldomäner för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-136">**High Availability:** hello Cassandra nodes shown in hello Figure 1 are deployed tootwo availability sets so that hello nodes are spread between multiple fault domains for high availability.</span></span> <span data-ttu-id="ee0d6-137">Virtuella datorer med varje tillgänglighetsuppsättning är mappade too2 feldomäner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-137">VMs annotated with each availability set is mapped too2 fault domains.</span></span>  <span data-ttu-id="ee0d6-138">Microsoft Azure använder hello begreppet fel domän toomanage oplanerade stillestånd (t.ex. maskinvara eller programvara misslyckanden) under hello begreppet uppgraderingsdomänen (t.ex. värd eller OS-korrigering/uppgraderingar, programuppgraderingar) används för att hantera schemalagda stillestånd.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-138">Microsoft Azure uses hello concept of fault domain toomanage unplanned down time (e.g. hardware or software failures) while hello concept of upgrade domain (e.g. host or guest OS patching/upgrades, application upgrades) is used for managing scheduled down time.</span></span> <span data-ttu-id="ee0d6-139">Se [katastrofåterställning och hög tillgänglighet för Azure-program](http://msdn.microsoft.com/library/dn251004.aspx) för hello roll för fel- och domäner för att uppnå hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-139">Please see [Disaster Recovery and High Availability for Azure Applications](http://msdn.microsoft.com/library/dn251004.aspx) for hello role of fault and upgrade domains in attaining high availability.</span></span>

![Distribution av enskild region](./media/cassandra-nodejs/cassandra-linux1.png)

<span data-ttu-id="ee0d6-141">Figur 1: Distribution av enskild region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-141">Figure 1: Single region deployment</span></span>

<span data-ttu-id="ee0d6-142">Observera att när hello detta skrivs, Azure inte tillåter hello explicit mappningen för en grupp med virtuella datorer tooa specifika feldomän; även om hello distributionsmodell som illustreras i bild 1, är det därför statistiskt troligt att alla hello virtuella datorer kan vara mappade tootwo feldomäner i stället för fyra.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-142">Note that at hello time of this writing, Azure doesn’t allow hello explicit mapping of a group of VMs tooa specific fault domain; consequently, even with hello deployment model shown in Figure 1, it is statistically probable that all hello virtual machines may be mapped tootwo fault domains instead of four.</span></span>

<span data-ttu-id="ee0d6-143">**Belastningsutjämna belastningsutjämning Thrift trafik:** Thrift klientbibliotek inuti hello webbservern ansluta toohello klustret via en intern belastningsutjämnare.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-143">**Load Balancing Thrift Traffic:** Thrift client libraries inside hello web server connect toohello cluster through an internal load balancer.</span></span> <span data-ttu-id="ee0d6-144">Detta kräver hello processen att lägga till data ”hello interna belastningsutjämnare toohello-undernät (se bild 1) i hello kontexten för hello Molntjänsten värd hello Cassandra klustret.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-144">This requires hello process of adding hello internal load balancer toohello “data” subnet (refer Figure 1) in hello context of hello cloud service hosting hello Cassandra cluster.</span></span> <span data-ttu-id="ee0d6-145">När hello intern belastningsutjämnare har definierats, kräver varje nod hello belastningsutjämnade endpoint toobe lagts till med hello anteckningar av en belastningsutjämnad uppsättning med tidigare definierade belastningsutjämnarens namn.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-145">Once hello internal load balancer is defined, each node requires hello load balanced endpoint toobe added with hello annotations of a load balanced set with previously defined load balancer name.</span></span> <span data-ttu-id="ee0d6-146">Se [Azure intern belastningsutjämning ](../../../load-balancer/load-balancer-internal-overview.md)för mer information.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-146">See [Azure Internal Load Balancing ](../../../load-balancer/load-balancer-internal-overview.md)for more details.</span></span>

<span data-ttu-id="ee0d6-147">**Klustret frö:** är det viktigt tooselect hello de flesta noder för hög tillgänglighet för frö som hello nya noder kommunicerar med seed noder toodiscover hello topologi hello klustret.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-147">**Cluster Seeds:** It is important tooselect hello most highly available nodes for seeds as hello new nodes will communicate with seed nodes toodiscover hello topology of hello cluster.</span></span> <span data-ttu-id="ee0d6-148">En nod från varje tillgänglighetsuppsättning utses seed noder tooavoid enskild felpunkt.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-148">One node from each availability set is designated as seed nodes tooavoid single point of failure.</span></span>

<span data-ttu-id="ee0d6-149">**Replikering faktor och konsekvensnivå:** Cassandras inbyggda hög tillgänglighet och data hållbarhet kännetecknas av hello replikering faktor (RF - antal kopior av varje rad som lagras på hello kluster) och konsekvensnivå (antal repliker toobe läsa/skriva innan det returneras hello resultatet toohello anroparen).</span><span class="sxs-lookup"><span data-stu-id="ee0d6-149">**Replication Factor and Consistency Level:** Cassandra’s build-in high-availability and data durability is characterized by hello Replication Factor (RF - number of copies of each row stored on hello cluster) and Consistency Level (number of replicas toobe read/written before returning hello result toohello caller).</span></span> <span data-ttu-id="ee0d6-150">Replikering faktor anges under hello KEYSPACE (liknande tooa relationsdatabas) skapa medan hello konsekvensnivå anges vid utfärdande hello CRUD-fråga.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-150">Replication factor is specified during hello KEYSPACE (similar tooa relational database) creation whereas hello consistency level is specified while issuing hello CRUD query.</span></span> <span data-ttu-id="ee0d6-151">Se Cassandra dokumentation på [konfigurera konsekvent](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) konsekvenskontroll information och hello formel för beräkning av kvorum.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-151">See Cassandra documentation at [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) for consistency details and hello formula for quorum computation.</span></span>

<span data-ttu-id="ee0d6-152">Cassandra stöder två typer av integritet datamodeller – konsekvens och slutliga konsekvensen; hello replikering faktor och konsekvensnivå avgör tillsammans om hello data blir konsekvent som en skrivåtgärd är klar eller att det blir överensstämmelse.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-152">Cassandra supports two types of data integrity models – Consistency and Eventual Consistency; hello Replication Factor and Consistency Level will together determine if hello data will be consistent as soon as a write operation is complete or it will be eventually consistent.</span></span> <span data-ttu-id="ee0d6-153">Till exempel resulterar ange KVORUM som hello konsekvensnivå kommer alltid garanterar data konsekvenskontroll när alla konsekvensnivå nedan hello antal repliker toobe skrivs som behövs tooattain KVORUM (t.ex. en) i data som överensstämmelse.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-153">For example, specifying QUORUM as hello Consistency Level will always ensures data Consistency while any consistency level, below hello number of replicas toobe written as needed tooattain QUORUM (e.g. ONE) results in data being eventually consistent.</span></span>

<span data-ttu-id="ee0d6-154">hello 8 kluster visas ovan, med en faktor för replikering på 3 och KVORUM (2 noder läsas eller skrivas konsekvent) läsning och skrivning konsekvensnivå, kan överleva hello teoretisk förlust av på de flesta 1 nod per replikering gruppen innan programmet hello hello Granska resultatet hello-fel.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-154">hello 8-node cluster shown above, with a replication factor of 3 and QUORUM (2 nodes are read or written for consistency) read/write consistency level, can survive hello theoretical loss of at hello most 1 node per replication group before hello application start noticing hello failure.</span></span> <span data-ttu-id="ee0d6-155">Detta förutsätter att alla hello viktiga blanksteg väl har balanserad förfrågningar om läsning och skrivning.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-155">This assumes that all hello key spaces have well balanced read/write requests.</span></span>  <span data-ttu-id="ee0d6-156">hello följande är hello parametrar som vi ska använda för hello distribuerade klustret:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-156">hello following are hello parameters we will use for hello deployed cluster:</span></span>

<span data-ttu-id="ee0d6-157">Enskild region Cassandra klusterkonfiguration:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-157">Single region Cassandra cluster configuration:</span></span>

| <span data-ttu-id="ee0d6-158">Kluster-Parameter</span><span class="sxs-lookup"><span data-stu-id="ee0d6-158">Cluster Parameter</span></span> | <span data-ttu-id="ee0d6-159">Värde</span><span class="sxs-lookup"><span data-stu-id="ee0d6-159">Value</span></span> | <span data-ttu-id="ee0d6-160">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-160">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ee0d6-161">Antalet noder (N)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-161">Number of Nodes (N)</span></span> |<span data-ttu-id="ee0d6-162">8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-162">8</span></span> |<span data-ttu-id="ee0d6-163">Totalt antal noder i klustret hello</span><span class="sxs-lookup"><span data-stu-id="ee0d6-163">Total number of nodes in hello cluster</span></span> |
| <span data-ttu-id="ee0d6-164">Replikering faktor (RF)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-164">Replication Factor (RF)</span></span> |<span data-ttu-id="ee0d6-165">3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-165">3</span></span> |<span data-ttu-id="ee0d6-166">Antal repliker på en viss rad</span><span class="sxs-lookup"><span data-stu-id="ee0d6-166">Number of replicas of a given row</span></span> |
| <span data-ttu-id="ee0d6-167">Konsekvensnivå (skriva)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-167">Consistency Level (Write)</span></span> |<span data-ttu-id="ee0d6-168">QUORUM[(RF/2) +1) = 2] hello resultatet av hello formeln avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-168">QUORUM[(RF/2) +1) = 2] hello result of hello formula is rounded down</span></span> |<span data-ttu-id="ee0d6-169">Vid hello skriver de flesta 2 repliker innan hello svar skickas toohello anroparens 3 replik är skriven i ett överensstämmelse sätt.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-169">Writes at hello most 2 replicas before hello response is sent toohello caller; 3rd replica is written in an eventually consistent manner.</span></span> |
| <span data-ttu-id="ee0d6-170">Konsekvensnivå (läsa)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-170">Consistency Level (Read)</span></span> |<span data-ttu-id="ee0d6-171">KVORUM [(RF/2) + 1 = 2] hello resultatet av hello formel avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-171">QUORUM [(RF/2) +1= 2] hello result of hello formula is rounded down</span></span> |<span data-ttu-id="ee0d6-172">Läser 2 repliker innan du skickar svar toohello anroparen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-172">Reads 2 replicas before sending response toohello caller.</span></span> |
| <span data-ttu-id="ee0d6-173">Replikeringsstrategi</span><span class="sxs-lookup"><span data-stu-id="ee0d6-173">Replication Strategy</span></span> |<span data-ttu-id="ee0d6-174">NetworkTopologyStrategy Se [datareplikering](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="ee0d6-174">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="ee0d6-175">Förstår hello topologi för distribution och placerar repliker på noder så att alla hello repliker inte slutar på hello samma rack</span><span class="sxs-lookup"><span data-stu-id="ee0d6-175">Understands hello deployment topology and places replicas on nodes so that all hello replicas don’t end up on hello same rack</span></span> |
| <span data-ttu-id="ee0d6-176">Snitch</span><span class="sxs-lookup"><span data-stu-id="ee0d6-176">Snitch</span></span> |<span data-ttu-id="ee0d6-177">GossipingPropertyFileSnitch Se [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="ee0d6-177">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="ee0d6-178">NetworkTopologyStrategy använder ett koncept för snitch toounderstand hello-topologi.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-178">NetworkTopologyStrategy uses a concept of snitch toounderstand hello topology.</span></span> <span data-ttu-id="ee0d6-179">GossipingPropertyFileSnitch ger bättre kontroll i varje nod toodata center och rack.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-179">GossipingPropertyFileSnitch gives better control in mapping each node toodata center and rack.</span></span> <span data-ttu-id="ee0d6-180">hello klustret använder sedan ett toopropagate denna information.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-180">hello cluster then uses gossip toopropagate this information.</span></span> <span data-ttu-id="ee0d6-181">Detta är mycket enklare i dynamisk IP-inställningen relativa tooPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="ee0d6-181">This is much simpler in dynamic IP setting relative tooPropertyFileSnitch</span></span> |

<span data-ttu-id="ee0d6-182">**Azure överväganden för Cassandra kluster:** kapaciteten för Microsoft Azure-datorer använder Azure Blob storage för disk; Azure Storage sparar 3 repliker för varje disk för hög hållbarhet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-182">**Azure Considerations for Cassandra Cluster:** Microsoft Azure Virtual Machines capability uses Azure Blob storage for disk persistence; Azure Storage saves 3 replicas of each disk for high durability.</span></span> <span data-ttu-id="ee0d6-183">Det innebär att varje rad med data som infogas i en tabell med Cassandra lagras redan i 3 repliker och därför datakonsekvens är redan tagit hand om även om hello replikering faktor (RF) är 1.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-183">That means each row of data inserted into a Cassandra table is already stored in 3 replicas and hence data consistency is already taken care of even if hello Replication Factor (RF) is 1.</span></span> <span data-ttu-id="ee0d6-184">hello huvudsakliga problem med replikering faktor 1 är att programmet hello får driftstopp, även om en enskild nod Cassandra misslyckas.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-184">hello main problem with Replication Factor being 1 is that hello application will experience downtime even if a single Cassandra node fails.</span></span> <span data-ttu-id="ee0d6-185">Om en nod avser hello problem (t.ex. maskinvara, programvara systemfel) identifieras av Azure-Infrastrukturkontrollanten kan det dock etablerar en ny nod i dess ställe med hjälp av hello samma lagringsenheter.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-185">However, if a node is down for hello problems (e.g. hardware, system software failures) recognized by Azure Fabric Controller, it will provision a new node in its place using hello same storage drives.</span></span> <span data-ttu-id="ee0d6-186">Etablera en ny nod tooreplace hello gamla en kan ta några minuter.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-186">Provisioning a new node tooreplace hello old one may take a few minutes.</span></span>  <span data-ttu-id="ee0d6-187">På samma sätt för planerat underhållsaktiviteter som gästoperativsystemet ändringar Cassandra uppgraderar och ändringar i programmet Azure-Infrastrukturkontrollanten utför rullande uppgraderingar av hello noder i klustret hello.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-187">Similarly for planned maintenance activities like guest OS changes, Cassandra upgrades and application changes Azure Fabric Controller performs rolling upgrades of hello nodes in hello cluster.</span></span>  <span data-ttu-id="ee0d6-188">Även rullande uppgraderingar kan ta bort några noder samtidigt och därför hello klustret kan ha kort driftstopp för några partitioner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-188">Rolling upgrades also may take down a few nodes at a time and hence hello cluster may experience brief downtime for a few partitions.</span></span> <span data-ttu-id="ee0d6-189">Dock går hello data inte förlorade på grund av toohello inbyggd redundans för Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-189">However, hello data will not be lost due toohello built-in Azure Storage redundancy.</span></span>  

<span data-ttu-id="ee0d6-190">För system distribueras tooAzure som inte kräver hög tillgänglighet (t.ex. runt 99,9 som är likvärdiga too8.76 timmar per år, se [hög tillgänglighet](http://en.wikipedia.org/wiki/High_availability) information) du kan toorun med RF = 1 och konsekvensnivå = en.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-190">For systems deployed tooAzure that doesn’t require high availability (e.g. around 99.9 which is equivalent too8.76 hrs/year; see [High Availability](http://en.wikipedia.org/wiki/High_availability) for details) you may be able toorun with RF=1 and Consistency Level=ONE.</span></span>  <span data-ttu-id="ee0d6-191">För program med hög tillgänglighet, RF = 3 och konsekvensnivå = KVORUM tolererar hello stillestånd på en av hello noder en hello repliker.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-191">For applications with high availability requirements, RF=3 and Consistency Level=QUORUM will tolerate hello down time of one of hello nodes one of hello replicas.</span></span> <span data-ttu-id="ee0d6-192">RF = 1 i traditionella distributioner (t.ex. på plats) kan inte användas på grund av förlust av data toohello uppstår problem angående diskfel.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-192">RF=1 in traditional deployments (e.g. on-premises) can’t be used due toohello possible data loss resulting from problems like disk failures.</span></span>   

## <a name="multi-region-deployment"></a><span data-ttu-id="ee0d6-193">Distribution av flera regioner</span><span class="sxs-lookup"><span data-stu-id="ee0d6-193">Multi-region Deployment</span></span>
<span data-ttu-id="ee0d6-194">Cassandra's data-center-medveten replikering och konsekvent modell ovan hjälper dig med hello flera regioner distribution Out of box hello utan hello måste för några externa verktygsuppsättning.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-194">Cassandra’s data-center-aware replication and consistency model described above helps with hello multi-region deployment out of hello box without hello need for any external tooling.</span></span> <span data-ttu-id="ee0d6-195">Detta är detsamma hello traditionella relationsdatabaser där hello konfigurerad för databasspegling för multimaster skrivningar kan vara ganska komplicerat.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-195">This is quite different from hello traditional relational databases where hello setup for database mirroring for multi-master writes can be quite complex.</span></span> <span data-ttu-id="ee0d6-196">Cassandra i en flera region konfigurera kan hjälpa dig med hello Användningsscenarier inklusive hello följande:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-196">Cassandra in a multi-region set up can help with hello usage scenarios including hello following:</span></span>

<span data-ttu-id="ee0d6-197">**Närhet baserat distribution:** program med flera klienter, med Rensa koppling av användare för klient-till-region, kan vara fått av hello flera regioner klustret låg latens.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-197">**Proximity based deployment:** Multi-tenant applications, with clear mapping of tenant users -to-region, can be benefited by hello multi-region cluster’s low latencies.</span></span> <span data-ttu-id="ee0d6-198">Till exempel en learning management system för utbildningssyfte kan distribuera ett kluster som är distribuerade i östra USA och västra USA regioner tooserve hello respektive universitet för transaktionell samt analytics.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-198">For example a learning management systems for educational institutions can deploy a distributed cluster in East US and West US regions tooserve hello respective campuses for transactional as well as analytics.</span></span> <span data-ttu-id="ee0d6-199">hello data kan vara lokalt konsekvent vid hello tid läsningar och skrivningar och kan vara överensstämmelse över både hello regioner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-199">hello data can be locally consistent at hello time reads and writes and can be eventually consistent across both hello regions.</span></span> <span data-ttu-id="ee0d6-200">Det finns andra exempel som Mediedistribution, e-handel och något och allt som fungerar geo koncentrerad användaren grundläggande är ett bra användningsfall för denna distributionsmodell.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-200">There are other examples like media distribution, e-commerce and anything and everything that serves geo concentrated user base is a good use case for this deployment model.</span></span>

<span data-ttu-id="ee0d6-201">**Hög tillgänglighet:** redundans är en nyckelfaktor för att uppnå hög tillgänglighet av programvara och maskinvara, se Skapa tillförlitliga Molnsystem på Microsoft Azure för ytterligare information.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-201">**High Availability:** Redundancy is a key factor in attaining high availability of software and hardware; see Building Reliable Cloud Systems on Microsoft Azure for details.</span></span> <span data-ttu-id="ee0d6-202">På Microsoft Azure är hello endast tillförlitligt sätt att uppnå true redundans genom att distribuera ett kluster med flera regioner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-202">On Microsoft Azure, hello only reliable way of achieving true redundancy is by deploying a multi-region cluster.</span></span> <span data-ttu-id="ee0d6-203">Program kan distribueras i en aktiv-aktiv eller aktivt-passivt läge och om någon av hello regioner är nere kan Azure Traffic Manager kan omdirigera trafik toohello aktiva regionen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-203">Applications can be deployed in an active-active or active-passive mode and if one of hello regions is down, Azure Traffic Manager can redirect traffic toohello active region.</span></span>  <span data-ttu-id="ee0d6-204">Med hello enskild region distribution om hello tillgänglighet är 99,9, en två-region-distribution kan uppnå tillgänglighet 99.9999 beräknas genom hello formel: (1-(1-0.999) * (1-0,999)) * 100); Se hello ovan papper för information.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-204">With hello single region deployment, if hello availability is 99.9, a two-region deployment can attain an availability of 99.9999 computed by hello formula: (1-(1-0.999) * (1-0.999))*100); see hello above paper for details.</span></span>

<span data-ttu-id="ee0d6-205">**Katastrofåterställning:** flera regioner Cassandra klustret om korrekt utformad klarar oåterkalleligt data center avbrott.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-205">**Disaster Recovery:** Multi-region Cassandra cluster, if properly designed, can withstand catastrophic data center outages.</span></span> <span data-ttu-id="ee0d6-206">Om en region är nere kan starta hello programmet distribuerades tooother regioner betjänar hello slutanvändare.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-206">If one region is down, hello application deployed tooother regions can start serving hello end users.</span></span> <span data-ttu-id="ee0d6-207">Precis som alla andra business continuity implementeringar har hello programmet toobe feltoleranta för dataförluster uppstår till följd av hello data i hello asynkron pipeline.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-207">Like any other business continuity implementations, hello application has toobe tolerant for some data loss resulting from hello data in hello asynchronous pipeline.</span></span> <span data-ttu-id="ee0d6-208">Cassandra är dock hello recovery mycket snabbare än hello tidsåtgång av traditionella processer.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-208">However, Cassandra makes hello recovery much swifter than hello time taken by traditional database recovery processes.</span></span> <span data-ttu-id="ee0d6-209">Bild 2 visar hello vanliga flera regioner distributionsmodell med åtta noder i varje region.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-209">Figure 2 shows hello typical multi-region deployment model with eight nodes in each region.</span></span> <span data-ttu-id="ee0d6-210">Båda regioner är speglade bilder från varandra för hello samma symmetriplan; Verkligt Designer är beroende av hello belastningstyp (t.ex. transaktionell eller analytiska), Återställningspunktsmål, RTO, datakonsekvens och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-210">Both regions are mirror images of each other for hello same of symmetry; real world designs depend on hello workload type (e.g. transactional or analytical), RPO, RTO, data consistency and availability requirements.</span></span>

![Distribution av flera region](./media/cassandra-nodejs/cassandra-linux2.png)

<span data-ttu-id="ee0d6-212">Figur 2: Distribution av flera regioner Cassandra</span><span class="sxs-lookup"><span data-stu-id="ee0d6-212">Figure 2: Multi-region Cassandra deployment</span></span>

### <a name="network-integration"></a><span data-ttu-id="ee0d6-213">Integrering av nätverk</span><span class="sxs-lookup"><span data-stu-id="ee0d6-213">Network Integration</span></span>
<span data-ttu-id="ee0d6-214">Uppsättningar av virtuella datorer distribuerade tooprivate nätverk finns på områdena kommunicerar med varandra med hjälp av en VPN-tunnel.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-214">Sets of virtual machines deployed tooprivate networks located on two regions communicates with each other using a VPN tunnel.</span></span> <span data-ttu-id="ee0d6-215">hello VPN-tunnel som ansluter två programvara gateways etablerats under distributionsprocessen för hello nätverk.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-215">hello VPN tunnel connects two software gateways provisioned during hello network deployment process.</span></span> <span data-ttu-id="ee0d6-216">Båda områden har liknande nätverksarkitektur vad gäller ”web” och ”data” undernät; Azure-nätverk kan hello skapandet av så många undernät efter behov och tillämpa ACL: er som krävs av nätverkssäkerhet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-216">Both regions have similar network architecture in terms of “web” and “data” subnets; Azure networking allows hello creation of as many subnets as needed and apply ACLs as needed by network security.</span></span> <span data-ttu-id="ee0d6-217">När du utformar hello klustertopologi bland data center kommunikation latens och hello ekonomiska effekten av hello nätverket trafik måste toobe anses vara.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-217">While designing hello cluster topology inter data center communication latency and hello economic impact of hello network traffic need toobe considered.</span></span>

### <a name="data-consistency-for-multi-data-center-deployment"></a><span data-ttu-id="ee0d6-218">Datakonsekvens för distribution av flera Datacenter</span><span class="sxs-lookup"><span data-stu-id="ee0d6-218">Data Consistency for Multi-Data Center Deployment</span></span>
<span data-ttu-id="ee0d6-219">Distribuerad distributioner behöver toobe medveten om hello klustret topologi inverkan på genomflöde och hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-219">Distributed deployments need toobe aware of hello cluster topology impact on throughput and high availability.</span></span> <span data-ttu-id="ee0d6-220">hello RF och konsekvensnivå måste toobe valt på sätt som hello kvorum beroende inte av hello tillgängligheten för alla hello-datacenter.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-220">hello RF and Consistency Level need toobe selected in such way that hello quorum doesn’t depend on hello availability of all hello data centers.</span></span>
<span data-ttu-id="ee0d6-221">För ett system som kräver hög konsekvens, en LOCAL_QUORUM för konsekvensnivå (för läsning och skrivning) ser till att den hello lokala läser och skriver uppfylls från hello lokala replikeras asynkront noder när data är toohello remote datacenter.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-221">For a system that needs high consistency, a LOCAL_QUORUM for consistency level (for reads and writes) will make sure that hello local reads and writes are satisfied from hello local nodes while data is replicated asynchronously toohello remote data centers.</span></span>  <span data-ttu-id="ee0d6-222">Tabell 2 sammanfattar hello konfiguration information för hello flera regioner kluster beskrivs senare i hello Skriv upp.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-222">Table 2 summarizes hello configuration details for hello multi-region cluster outlined later in hello write up.</span></span>

<span data-ttu-id="ee0d6-223">**Två region Cassandra klusterkonfigurationen**</span><span class="sxs-lookup"><span data-stu-id="ee0d6-223">**Two-region Cassandra cluster configuration**</span></span>

| <span data-ttu-id="ee0d6-224">Kluster-Parameter</span><span class="sxs-lookup"><span data-stu-id="ee0d6-224">Cluster Parameter</span></span> | <span data-ttu-id="ee0d6-225">Värde</span><span class="sxs-lookup"><span data-stu-id="ee0d6-225">Value</span></span> | <span data-ttu-id="ee0d6-226">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-226">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ee0d6-227">Antalet noder (N)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-227">Number of Nodes (N)</span></span> |<span data-ttu-id="ee0d6-228">8 + 8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-228">8 + 8</span></span> |<span data-ttu-id="ee0d6-229">Totalt antal noder i klustret hello</span><span class="sxs-lookup"><span data-stu-id="ee0d6-229">Total number of nodes in hello cluster</span></span> |
| <span data-ttu-id="ee0d6-230">Replikering faktor (RF)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-230">Replication Factor (RF)</span></span> |<span data-ttu-id="ee0d6-231">3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-231">3</span></span> |<span data-ttu-id="ee0d6-232">Antal repliker på en viss rad</span><span class="sxs-lookup"><span data-stu-id="ee0d6-232">Number of replicas of a given row</span></span> |
| <span data-ttu-id="ee0d6-233">Konsekvensnivå (skriva)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-233">Consistency Level (Write)</span></span> |<span data-ttu-id="ee0d6-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] hello resultatet av hello formel avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] hello result of hello formula is rounded down</span></span> |<span data-ttu-id="ee0d6-235">2 noder skrivs toohello första Datacenter synkront; hello ytterligare 2 noder krävs för kvorum skrivs asynkront toohello 2 datacenter.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-235">2 nodes will be written toohello first data center synchronously; hello additional 2 nodes needed for quorum will be written asynchronously toohello 2nd data center.</span></span> |
| <span data-ttu-id="ee0d6-236">Konsekvensnivå (läsa)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-236">Consistency Level (Read)</span></span> |<span data-ttu-id="ee0d6-237">LOCAL_QUORUM ((RF/2) + 1) = 2 hello resultatet av hello formel avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-237">LOCAL_QUORUM ((RF/2) +1) = 2 hello result of hello formula is rounded down</span></span> |<span data-ttu-id="ee0d6-238">Läs begäranden uppfylls från en enda region. 2 noder är skrivskyddade innan hello svar skickas tillbaka toohello klienten.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-238">Read requests are satisfied from only one region; 2 nodes are read before hello response is sent back toohello client.</span></span> |
| <span data-ttu-id="ee0d6-239">Replikeringsstrategi</span><span class="sxs-lookup"><span data-stu-id="ee0d6-239">Replication Strategy</span></span> |<span data-ttu-id="ee0d6-240">NetworkTopologyStrategy Se [datareplikering](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="ee0d6-240">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="ee0d6-241">Förstår hello topologi för distribution och placerar repliker på noder så att alla hello repliker inte slutar på hello samma rack</span><span class="sxs-lookup"><span data-stu-id="ee0d6-241">Understands hello deployment topology and places replicas on nodes so that all hello replicas don’t end up on hello same rack</span></span> |
| <span data-ttu-id="ee0d6-242">Snitch</span><span class="sxs-lookup"><span data-stu-id="ee0d6-242">Snitch</span></span> |<span data-ttu-id="ee0d6-243">GossipingPropertyFileSnitch Se [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="ee0d6-243">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="ee0d6-244">NetworkTopologyStrategy använder ett koncept för snitch toounderstand hello-topologi.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-244">NetworkTopologyStrategy uses a concept of snitch toounderstand hello topology.</span></span> <span data-ttu-id="ee0d6-245">GossipingPropertyFileSnitch ger bättre kontroll i varje nod toodata center och rack.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-245">GossipingPropertyFileSnitch gives better control in mapping each node toodata center and rack.</span></span> <span data-ttu-id="ee0d6-246">hello klustret använder sedan ett toopropagate denna information.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-246">hello cluster then uses gossip toopropagate this information.</span></span> <span data-ttu-id="ee0d6-247">Detta är mycket enklare i dynamisk IP-inställningen relativa tooPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="ee0d6-247">This is much simpler in dynamic IP setting relative tooPropertyFileSnitch</span></span> |

## <a name="hello-software-configuration"></a><span data-ttu-id="ee0d6-248">hello konfiguration av programvara</span><span class="sxs-lookup"><span data-stu-id="ee0d6-248">hello SOFTWARE CONFIGURATION</span></span>
<span data-ttu-id="ee0d6-249">hello följande programvaruversioner som används under distributionen av hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-249">hello following software versions are used during hello deployment:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-250">Programvara</span><span class="sxs-lookup"><span data-stu-id="ee0d6-250">Software</span></span></th><th><span data-ttu-id="ee0d6-251">Källa</span><span class="sxs-lookup"><span data-stu-id="ee0d6-251">Source</span></span></th><th><span data-ttu-id="ee0d6-252">Version</span><span class="sxs-lookup"><span data-stu-id="ee0d6-252">Version</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-253">JRE</span><span class="sxs-lookup"><span data-stu-id="ee0d6-253">JRE</span></span>    </td><td><span data-ttu-id="ee0d6-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span><span class="sxs-lookup"><span data-stu-id="ee0d6-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span></span></td><td><span data-ttu-id="ee0d6-255">8U5</span><span class="sxs-lookup"><span data-stu-id="ee0d6-255">8U5</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-256">JNA</span><span class="sxs-lookup"><span data-stu-id="ee0d6-256">JNA</span></span>    </td><td><span data-ttu-id="ee0d6-257">[JNA](https://github.com/twall/jna) </span><span class="sxs-lookup"><span data-stu-id="ee0d6-257">[JNA](https://github.com/twall/jna) </span></span></td><td> <span data-ttu-id="ee0d6-258">3.2.7</span><span class="sxs-lookup"><span data-stu-id="ee0d6-258">3.2.7</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-259">Cassandra</span><span class="sxs-lookup"><span data-stu-id="ee0d6-259">Cassandra</span></span></td><td>[<span data-ttu-id="ee0d6-260">Apache Cassandra 2.0.8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-260">Apache Cassandra 2.0.8</span></span>](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> <span data-ttu-id="ee0d6-261">2.0.8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-261">2.0.8</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-262">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="ee0d6-262">Ubuntu</span></span>    </td><td><span data-ttu-id="ee0d6-263">[Microsoft Azure](https://azure.microsoft.com/) </span><span class="sxs-lookup"><span data-stu-id="ee0d6-263">[Microsoft Azure](https://azure.microsoft.com/) </span></span></td><td><span data-ttu-id="ee0d6-264">14.04 LTS</span><span class="sxs-lookup"><span data-stu-id="ee0d6-264">14.04 LTS</span></span></td></tr>
</table>

<span data-ttu-id="ee0d6-265">Hämtning av JRE kräver manuell godkännande av Oracle-licens, toosimplify hello distribution, ladda ned alla hello nödvändig programvara toohello desktop för senare överföring till hello Ubuntu mallavbildningen som vi ska skapa som ett ozonbildande toohello kluster distribution.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-265">Since downloading of JRE requires manual acceptance of Oracle license, toosimplify hello deployment, download all hello required software toohello desktop for later uploading into hello Ubuntu template image we will be creating as a precursor toohello cluster deployment.</span></span>

<span data-ttu-id="ee0d6-266">Hämta hello ovan programvara till en välkänd download katalog (t.ex. %TEMP%/downloads i Windows eller ~/Downloads på de flesta distributioner av Linux- eller Mac) på hello lokal dator.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-266">Download hello above software into a well-known download directory (e.g. %TEMP%/downloads on Windows or ~/Downloads on most Linux distributions or Mac) on hello local computer.</span></span>

### <a name="create-ubuntu-vm"></a><span data-ttu-id="ee0d6-267">SKAPA VIRTUELL UBUNTU-DATOR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-267">CREATE UBUNTU VM</span></span>
<span data-ttu-id="ee0d6-268">I det här steget i processen för hello skapar vi Ubuntu avbildningen med hello programvara som krävs så att hello avbildningen kan återanvändas för att etablera flera Cassandra noder.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-268">In this step of hello process we will create Ubuntu image with hello pre-requisite software so that hello image can be reused for provisioning several Cassandra nodes.</span></span>  

#### <a name="step-1-generate-ssh-key-pair"></a><span data-ttu-id="ee0d6-269">STEG 1: Skapa SSH-nyckel</span><span class="sxs-lookup"><span data-stu-id="ee0d6-269">STEP 1: Generate SSH key pair</span></span>
<span data-ttu-id="ee0d6-270">Azure behöver X509 offentlig nyckel som är PEM eller DER-kodade på hello etablering tid.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-270">Azure needs an X509 public key that is either PEM or DER encoded at hello provisioning time.</span></span> <span data-ttu-id="ee0d6-271">Skapa en offentlig/privat nyckel använder hello instruktioner på hur tooUse SSH med Linux på Azure.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-271">Generate a public/private key pair using hello instructions located at How tooUse SSH with Linux on Azure.</span></span> <span data-ttu-id="ee0d6-272">Om du planerar toouse putty.exe som en SSH-klienten på Windows eller Linux måste du ha tooconvert hello PEM-kodade RSA privata nyckel tooPPK format med hjälp av puttygen.exe; hello instruktioner för detta finns i hello ovan webbsida.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-272">If you plan toouse putty.exe as an SSH client either on Windows or Linux, you have tooconvert hello PEM encoded RSA private key tooPPK format using puttygen.exe; hello instructions for this can be found in hello above web page.</span></span>

#### <a name="step-2-create-ubuntu-template-vm"></a><span data-ttu-id="ee0d6-273">STEG 2: Skapa Ubuntu VM-mallen</span><span class="sxs-lookup"><span data-stu-id="ee0d6-273">STEP 2: Create Ubuntu template VM</span></span>
<span data-ttu-id="ee0d6-274">toocreate hello mallen VM, logga in på hello Azure klassiska portal och Använd hello följande sekvens: Klicka på ny, beräkning, VIRTUELLA, från GALLERIET, UBUNTU, Ubuntu Server 14.04 LTS och klicka på högerpilen för hello.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-274">toocreate hello template VM, log into hello Azure classic portal and use hello following sequence: Click NEW, COMPUTE, VIRTUAL MACHINE, FROM GALLERY, UBUNTU, Ubuntu Server 14.04 LTS, and then click hello right arrow.</span></span> <span data-ttu-id="ee0d6-275">En genomgång som beskriver hur toocreate en Linux VM, se Skapa en virtuell dator kör Linux.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-275">For a tutorial that describes how toocreate a Linux VM, see Create a Virtual Machine Running Linux.</span></span>

<span data-ttu-id="ee0d6-276">Ange följande information på skärmen hello ”konfiguration av virtuell dator” #1 hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-276">Enter hello following information on hello “Virtual machine configuration” screen #1:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-277">FÄLTNAMN</span><span class="sxs-lookup"><span data-stu-id="ee0d6-277">FIELD NAME</span></span>              </td><td>       <span data-ttu-id="ee0d6-278">FÄLTVÄRDE</span><span class="sxs-lookup"><span data-stu-id="ee0d6-278">FIELD VALUE</span></span>               </td><td>         <span data-ttu-id="ee0d6-279">KOMMENTARER</span><span class="sxs-lookup"><span data-stu-id="ee0d6-279">REMARKS</span></span>                </td><tr>
<tr><td><span data-ttu-id="ee0d6-280">VERSION UTGIVNINGSDATUM</span><span class="sxs-lookup"><span data-stu-id="ee0d6-280">VERSION RELEASE DATE</span></span>    </td><td> <span data-ttu-id="ee0d6-281">Välj ett datum hello listrutan</span><span class="sxs-lookup"><span data-stu-id="ee0d6-281">Select a date from hello drop down</span></span></td><td></td><tr>
<tr><td><span data-ttu-id="ee0d6-282">NAMN PÅ VIRTUELL DATOR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-282">VIRTUAL MACHINE NAME</span></span>    </td><td> <span data-ttu-id="ee0d6-283">fråga mall</span><span class="sxs-lookup"><span data-stu-id="ee0d6-283">cass-template</span></span>                   </td><td> <span data-ttu-id="ee0d6-284">Detta är hello värdnamnet för hello VM</span><span class="sxs-lookup"><span data-stu-id="ee0d6-284">This is hello hostname of hello VM</span></span> </td><tr>
<tr><td><span data-ttu-id="ee0d6-285">NIVÅ</span><span class="sxs-lookup"><span data-stu-id="ee0d6-285">TIER</span></span>                     </td><td> <span data-ttu-id="ee0d6-286">STANDARD</span><span class="sxs-lookup"><span data-stu-id="ee0d6-286">STANDARD</span></span>                           </td><td> <span data-ttu-id="ee0d6-287">Lämna hello standard</span><span class="sxs-lookup"><span data-stu-id="ee0d6-287">Leave hello default</span></span>              </td><tr>
<tr><td><span data-ttu-id="ee0d6-288">STORLEK</span><span class="sxs-lookup"><span data-stu-id="ee0d6-288">SIZE</span></span>                     </td><td> <span data-ttu-id="ee0d6-289">A1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-289">A1</span></span>                              </td><td><span data-ttu-id="ee0d6-290">Välj hello VM baserat på hello i/o-behov. lämna hello standard för detta ändamål</span><span class="sxs-lookup"><span data-stu-id="ee0d6-290">Select hello VM based on hello IO needs; for this purpose leave hello default</span></span> </td><tr>
<tr><td> <span data-ttu-id="ee0d6-291">NYTT ANVÄNDARNAMN</span><span class="sxs-lookup"><span data-stu-id="ee0d6-291">NEW USER NAME</span></span>             </td><td> <span data-ttu-id="ee0d6-292">localadmin</span><span class="sxs-lookup"><span data-stu-id="ee0d6-292">localadmin</span></span>                       </td><td> <span data-ttu-id="ee0d6-293">”admin” är ett reserverat användarnamn i Ubuntu 12. xx och efter</span><span class="sxs-lookup"><span data-stu-id="ee0d6-293">"admin" is a reserved user name in Ubuntu 12.xx and after</span></span></td><tr>
<tr><td> <span data-ttu-id="ee0d6-294">AUTENTISERING</span><span class="sxs-lookup"><span data-stu-id="ee0d6-294">AUTHENTICATION</span></span>         </td><td> <span data-ttu-id="ee0d6-295">Markera kryssrutan</span><span class="sxs-lookup"><span data-stu-id="ee0d6-295">Click check box</span></span>                 </td><td><span data-ttu-id="ee0d6-296">Markera om du vill ha toosecure med en SSH-nyckel</span><span class="sxs-lookup"><span data-stu-id="ee0d6-296">Check if you want toosecure with an SSH key</span></span> </td><tr>
<tr><td> <span data-ttu-id="ee0d6-297">CERTIFIKAT</span><span class="sxs-lookup"><span data-stu-id="ee0d6-297">CERTIFICATE</span></span>             </td><td> <span data-ttu-id="ee0d6-298">filnamnet för hello certifikat med offentlig nyckel</span><span class="sxs-lookup"><span data-stu-id="ee0d6-298">file name of hello public key certificate</span></span> </td><td> <span data-ttu-id="ee0d6-299">Använd hello offentliga nyckel som har skapats tidigare</span><span class="sxs-lookup"><span data-stu-id="ee0d6-299">Use hello public key generated previously</span></span></td><tr>
<tr><td> <span data-ttu-id="ee0d6-300">Nytt lösenord</span><span class="sxs-lookup"><span data-stu-id="ee0d6-300">New Password</span></span>    </td><td> <span data-ttu-id="ee0d6-301">starkt lösenord</span><span class="sxs-lookup"><span data-stu-id="ee0d6-301">strong password</span></span> </td><td> </td><tr>
<tr><td> <span data-ttu-id="ee0d6-302">Bekräfta lösenord</span><span class="sxs-lookup"><span data-stu-id="ee0d6-302">Confirm Password</span></span>    </td><td> <span data-ttu-id="ee0d6-303">starkt lösenord</span><span class="sxs-lookup"><span data-stu-id="ee0d6-303">strong password</span></span> </td><td></td><tr>
</table>

<span data-ttu-id="ee0d6-304">Ange följande information på skärmen hello ”konfiguration av virtuell dator” #2 hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-304">Enter hello following information on hello “Virtual machine configuration” screen #2:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-305">FÄLTNAMN</span><span class="sxs-lookup"><span data-stu-id="ee0d6-305">FIELD NAME</span></span>             </th><th> <span data-ttu-id="ee0d6-306">FÄLTVÄRDE</span><span class="sxs-lookup"><span data-stu-id="ee0d6-306">FIELD VALUE</span></span>                       </th><th> <span data-ttu-id="ee0d6-307">KOMMENTARER</span><span class="sxs-lookup"><span data-stu-id="ee0d6-307">REMARKS</span></span>                                 </th></tr>
<tr><td> <span data-ttu-id="ee0d6-308">MOLNTJÄNSTEN</span><span class="sxs-lookup"><span data-stu-id="ee0d6-308">CLOUD SERVICE</span></span>    </td><td> <span data-ttu-id="ee0d6-309">Skapa en ny molntjänst</span><span class="sxs-lookup"><span data-stu-id="ee0d6-309">Create a new cloud service</span></span>    </td><td><span data-ttu-id="ee0d6-310">Molntjänst är en behållare beräkningsresurser som virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-310">Cloud service is a container compute resources like virtual machines</span></span></td></tr>
<tr><td> <span data-ttu-id="ee0d6-311">DNS-MOLNTJÄNSTNAMNET</span><span class="sxs-lookup"><span data-stu-id="ee0d6-311">CLOUD SERVICE DNS NAME</span></span>    </td><td><span data-ttu-id="ee0d6-312">Ubuntu template.cloudapp.net</span><span class="sxs-lookup"><span data-stu-id="ee0d6-312">ubuntu-template.cloudapp.net</span></span>    </td><td><span data-ttu-id="ee0d6-313">Ge en datorn storleksoberoende belastningsutjämnarens namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-313">Give a machine agnostic load balancer name</span></span></td></tr>
<tr><td> <span data-ttu-id="ee0d6-314">REGION/TILLHÖRIGHETSGRUPP/VIRTUELLT NÄTVERK</span><span class="sxs-lookup"><span data-stu-id="ee0d6-314">REGION/AFFINITY GROUP/VIRTUAL NETWORK</span></span> </td><td>    <span data-ttu-id="ee0d6-315">Västra USA</span><span class="sxs-lookup"><span data-stu-id="ee0d6-315">West US</span></span>    </td><td> <span data-ttu-id="ee0d6-316">Välj en region som ditt webbprogram åtkomst hello Cassandra klustret</span><span class="sxs-lookup"><span data-stu-id="ee0d6-316">Select a region from which your web applications access hello Cassandra cluster</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-317">STORAGE-KONTO</span><span class="sxs-lookup"><span data-stu-id="ee0d6-317">STORAGE ACCOUNT</span></span> </td><td>    <span data-ttu-id="ee0d6-318">Använd standard</span><span class="sxs-lookup"><span data-stu-id="ee0d6-318">Use default</span></span>    </td><td><span data-ttu-id="ee0d6-319">Använda hello standardkontot för lagring eller ett befintligt lagringskonto i en viss region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-319">Use hello default storage account  or a pre-created storage account in a particular region</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-320">TILLGÄNGLIGHETSUPPSÄTTNING</span><span class="sxs-lookup"><span data-stu-id="ee0d6-320">AVAILABILITY SET</span></span> </td><td>    <span data-ttu-id="ee0d6-321">Ingen</span><span class="sxs-lookup"><span data-stu-id="ee0d6-321">None</span></span> </td><td>    <span data-ttu-id="ee0d6-322">Lämna det tomt</span><span class="sxs-lookup"><span data-stu-id="ee0d6-322">Leave it blank</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-323">SLUTPUNKTER</span><span class="sxs-lookup"><span data-stu-id="ee0d6-323">ENDPOINTS</span></span>    </td><td><span data-ttu-id="ee0d6-324">Använd standard</span><span class="sxs-lookup"><span data-stu-id="ee0d6-324">Use default</span></span> </td><td>    <span data-ttu-id="ee0d6-325">Använd hello standard SSH-konfigurationen</span><span class="sxs-lookup"><span data-stu-id="ee0d6-325">Use hello default SSH configuration</span></span> </td></tr>
</table>

<span data-ttu-id="ee0d6-326">Klicka på högerpilen och lämna hello standardvärden på hello-skärmen #3 hello ”Kontrollera” knappen toocomplete hello VM etableringsprocessen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-326">Click right arrow, leave hello defaults on hello screen #3 and click hello “check” button toocomplete hello VM provisioning process.</span></span> <span data-ttu-id="ee0d6-327">Hello VM med hello namnet ”ubuntu-mall” ska vara ”körs” status efter några minuter.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-327">After a few minutes, hello VM with hello name “ubuntu-template” should be in a “running” status.</span></span>

### <a name="install-hello-necessary-software"></a><span data-ttu-id="ee0d6-328">INSTALLERA hello programvara som krävs</span><span class="sxs-lookup"><span data-stu-id="ee0d6-328">INSTALL hello NECESSARY SOFTWARE</span></span>
#### <a name="step-1-upload-tarballs"></a><span data-ttu-id="ee0d6-329">STEG 1: Ladda upp tarballs</span><span class="sxs-lookup"><span data-stu-id="ee0d6-329">STEP 1: Upload tarballs</span></span>
<span data-ttu-id="ee0d6-330">Använd scp eller pscp och kopiera hello tidigare hämtade programvara för ~ / hämtningar directory använder hello följande kommandoformatet:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-330">Using scp or pscp, copy hello previously downloaded software too~/downloads directory using hello following command format:</span></span>

##### <a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a><span data-ttu-id="ee0d6-331">pscp server-jre-8u5-linux-x64.tar.gzlocaladmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span><span class="sxs-lookup"><span data-stu-id="ee0d6-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span></span>
<span data-ttu-id="ee0d6-332">Upprepa hello ovanstående kommando för JRE samt som hello Cassandra bitar.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-332">Repeat hello above command for JRE as well as for hello Cassandra bits.</span></span>

#### <a name="step-2-prepare-hello-directory-structure-and-extract-hello-archives"></a><span data-ttu-id="ee0d6-333">STEG 2: Förbered hello katalogstrukturen och extrahera hello-Arkiv</span><span class="sxs-lookup"><span data-stu-id="ee0d6-333">STEP 2: Prepare hello directory structure and extract hello archives</span></span>
<span data-ttu-id="ee0d6-334">Logga in på hello VM och skapa hello katalogstrukturen och extrahera programvara som en superanvändare använder hello bash-skriptet nedan:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-334">Log into hello VM and create hello directory structure and extract software as a super user using hello bash script below:</span></span>

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change hello ownership toohello service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile tooadd JRE toohello PATH"
    echo "installation is complete"


<span data-ttu-id="ee0d6-335">Om du klistrar in det här skriptet i vim fönstret ser du att tooremove hello transport returnerade ('\r ”) med hjälp av hello följande kommando:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-335">If you paste this script into vim window, make sure tooremove hello carriage return (‘\r”) using hello following command:</span></span>

    tr -d '\r' <infile.sh >outfile.sh

#### <a name="step-3-edit-etcprofile"></a><span data-ttu-id="ee0d6-336">Steg 3: Redigera etc-profil</span><span class="sxs-lookup"><span data-stu-id="ee0d6-336">Step 3: Edit etc/profile</span></span>
<span data-ttu-id="ee0d6-337">Lägg till följande hello slutet hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-337">Append hello following at hello end:</span></span>

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

#### <a name="step-4-install-jna-for-production-systems"></a><span data-ttu-id="ee0d6-338">Steg 4: Installera JNA för produktionssystem</span><span class="sxs-lookup"><span data-stu-id="ee0d6-338">Step 4: Install JNA for production systems</span></span>
<span data-ttu-id="ee0d6-339">Använd hello följande kommando sekvens: hello följande kommando installera jna-3.2.7.jar och jna-plattformen-3.2.7.jar too/usr/share.java directory sudo lgh-get installeras libjna java</span><span class="sxs-lookup"><span data-stu-id="ee0d6-339">Use hello following command sequence: hello following command will install jna-3.2.7.jar and jna-platform-3.2.7.jar too/usr/share.java directory sudo apt-get install libjna-java</span></span>

<span data-ttu-id="ee0d6-340">Skapa symboliska länkar i $CASS_HOME/lib directory så att Cassandra startskript kan hitta dessa burkar:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-340">Create symbolic links in $CASS_HOME/lib directory so that Cassandra startup script can find these jars:</span></span>

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

#### <a name="step-5-configure-cassandrayaml"></a><span data-ttu-id="ee0d6-341">Steg 5: Konfigurera cassandra.yaml</span><span class="sxs-lookup"><span data-stu-id="ee0d6-341">Step 5: Configure cassandra.yaml</span></span>
<span data-ttu-id="ee0d6-342">Redigera cassandra.yaml på varje VM tooreflect konfiguration som krävs av alla hello virtuella datorer [vi ska justera detta under hello faktiska etableringen]:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-342">Edit cassandra.yaml on each VM tooreflect configuration needed by all hello virtual machines [we will tweak this during hello actual provisioning]:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-343">Fältnamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-343">Field Name</span></span>   </th><th> <span data-ttu-id="ee0d6-344">Värde</span><span class="sxs-lookup"><span data-stu-id="ee0d6-344">Value</span></span>  </th><th>    <span data-ttu-id="ee0d6-345">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-345">Remarks</span></span> </th></tr>
<tr><td><span data-ttu-id="ee0d6-346">klusternamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-346">cluster_name</span></span> </td><td>    <span data-ttu-id="ee0d6-347">”CustomerService”</span><span class="sxs-lookup"><span data-stu-id="ee0d6-347">“CustomerService”</span></span>    </td><td> <span data-ttu-id="ee0d6-348">Använd hello namn som motsvarar din distribution</span><span class="sxs-lookup"><span data-stu-id="ee0d6-348">Use hello name that reflects your deployment</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-349">listen_address</span><span class="sxs-lookup"><span data-stu-id="ee0d6-349">listen_address</span></span>    </td><td><span data-ttu-id="ee0d6-350">[lämna det tomt]</span><span class="sxs-lookup"><span data-stu-id="ee0d6-350">[leave it blank]</span></span>    </td><td> <span data-ttu-id="ee0d6-351">Ta bort ”localhost”</span><span class="sxs-lookup"><span data-stu-id="ee0d6-351">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="ee0d6-352">rpc_addres</span><span class="sxs-lookup"><span data-stu-id="ee0d6-352">rpc_addres</span></span>   </td><td><span data-ttu-id="ee0d6-353">[lämna det tomt]</span><span class="sxs-lookup"><span data-stu-id="ee0d6-353">[leave it blank]</span></span>    </td><td> <span data-ttu-id="ee0d6-354">Ta bort ”localhost”</span><span class="sxs-lookup"><span data-stu-id="ee0d6-354">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="ee0d6-355">frö</span><span class="sxs-lookup"><span data-stu-id="ee0d6-355">seeds</span></span>    </td><td><span data-ttu-id="ee0d6-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span><span class="sxs-lookup"><span data-stu-id="ee0d6-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span></span>    </td><td><span data-ttu-id="ee0d6-357">Lista över alla hello IP-adresser som är avsedda som frö.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-357">List of  all hello IP addresses which are designated as seeds.</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-358">endpoint_snitch</span><span class="sxs-lookup"><span data-stu-id="ee0d6-358">endpoint_snitch</span></span> </td><td> <span data-ttu-id="ee0d6-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="ee0d6-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span></span> </td><td> <span data-ttu-id="ee0d6-360">Det här används av hello NetworkTopologyStrateg för procedurens hello datacenter och hello rack av hello VM</span><span class="sxs-lookup"><span data-stu-id="ee0d6-360">This is used by hello NetworkTopologyStrateg for inferring hello data center and hello rack of hello VM</span></span></td></tr>
</table>

#### <a name="step-6-capture-hello-vm-image"></a><span data-ttu-id="ee0d6-361">Steg 6: Hämta hello VM-avbildning</span><span class="sxs-lookup"><span data-stu-id="ee0d6-361">Step 6: Capture hello VM image</span></span>
<span data-ttu-id="ee0d6-362">Logga in på hello virtuell dator med hello värdnamn (hk-cas-template.cloudapp.net) och hello privata SSH-nyckeln skapade tidigare.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-362">Log into hello virtual machine using hello hostname (hk-cas-template.cloudapp.net) and hello SSH private key previously created.</span></span> <span data-ttu-id="ee0d6-363">Se hur tooUse SSH med Linux i Azure för information om hur toolog med hello kommandot ssh eller putty.exe.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-363">See How tooUse SSH with Linux on Azure for details on how toolog in using hello command ssh or putty.exe.</span></span>

<span data-ttu-id="ee0d6-364">Kör följande sekvens med åtgärder toocapture hello avbildningen hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-364">Execute hello following sequence of actions toocapture hello image:</span></span>

##### <a name="1-deprovision"></a><span data-ttu-id="ee0d6-365">1. Avetablering</span><span class="sxs-lookup"><span data-stu-id="ee0d6-365">1. Deprovision</span></span>
<span data-ttu-id="ee0d6-366">Kommandot hello ”sudo waagent – avetablering + användare” tooremove virtuella instansen specifik information.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-366">Use hello command “sudo waagent –deprovision+user” tooremove Virtual Machine instance specific information.</span></span> <span data-ttu-id="ee0d6-367">Se för [hur tooCapture en Linux-dator](capture-image.md) tooUse som en mall för mer information om hello image-hämtningen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-367">See for [How tooCapture a Linux Virtual Machine](capture-image.md) tooUse as a Template more details on hello image capture process.</span></span>

##### <a name="2-shutdown-hello-vm"></a><span data-ttu-id="ee0d6-368">2: avstängning hello VM</span><span class="sxs-lookup"><span data-stu-id="ee0d6-368">2: Shutdown hello VM</span></span>
<span data-ttu-id="ee0d6-369">Kontrollera att hello den virtuella datorn har markerats och klicka på hello avstängning länk från hello nedre kommandofältet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-369">Make sure that hello virtual machine is highlighted and click hello SHUTDOWN link from hello bottom command bar.</span></span>

##### <a name="3-capture-hello-image"></a><span data-ttu-id="ee0d6-370">3: hello infångningsavbildning</span><span class="sxs-lookup"><span data-stu-id="ee0d6-370">3: Capture hello image</span></span>
<span data-ttu-id="ee0d6-371">Kontrollera att hello den virtuella datorn har markerats och klicka på hello AVBILDA länk från hello nedre kommandofältet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-371">Make sure that hello virtual machine is highlighted and click hello CAPTURE link from hello bottom command bar.</span></span> <span data-ttu-id="ee0d6-372">Namnge en bild (t.ex. hk-cas-2-08-ub-14-04-2014071) hello nästa skärm, lämpliga AVBILDNINGSBESKRIVNINGEN och på hello ”Kontrollera” Markera toofinish hello insamlingen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-372">In hello next screen, give an IMAGE NAME (e.g. hk-cas-2-08-ub-14-04-2014071), appropriate IMAGE DESCRIPTION, and click hello “check” mark toofinish hello CAPTURE process.</span></span>

<span data-ttu-id="ee0d6-373">Detta tar några sekunder och hello avbildningen ska vara tillgänglig under Mina AVBILDNINGAR i hello avbildningen gallery.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-373">This will take a few seconds and hello image should be available in MY IMAGES section of hello image gallery.</span></span> <span data-ttu-id="ee0d6-374">Virtuella hello källdatorn tas automatiskt bort när hello avbildningen har avbildats.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-374">hello source VM will be automatically deleted after hello image is successfully captured.</span></span> 

## <a name="single-region-deployment-process"></a><span data-ttu-id="ee0d6-375">Processen för distribution av enskild Region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-375">Single Region Deployment Process</span></span>
<span data-ttu-id="ee0d6-376">**Steg 1: Skapa hello virtuellt nätverk** logga in hello Azure-portalen och skapa ett virtuellt nätverk (klassiskt) med hello-attribut visas i följande tabell hello.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-376">**Step 1: Create hello Virtual Network** Log into hello Azure portal and create a virtual network (classic) with hello attributes shown in hello following table.</span></span> <span data-ttu-id="ee0d6-377">Se [skapa ett virtuellt nätverk (klassiska) med hello Azure-portalen](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) detaljerade anvisningar för hello process.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-377">See [Create a virtual network (classic) using hello Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of hello process.</span></span>      

<table>
<tr><th><span data-ttu-id="ee0d6-378">VM attributets namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-378">VM Attribute Name</span></span></th><th><span data-ttu-id="ee0d6-379">Värde</span><span class="sxs-lookup"><span data-stu-id="ee0d6-379">Value</span></span></th><th><span data-ttu-id="ee0d6-380">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-380">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-381">Namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-381">Name</span></span></td><td><span data-ttu-id="ee0d6-382">vnet-fråga-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-382">vnet-cass-west-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="ee0d6-383">Region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-383">Region</span></span></td><td><span data-ttu-id="ee0d6-384">Västra USA</span><span class="sxs-lookup"><span data-stu-id="ee0d6-384">West US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="ee0d6-385">DNS-servrar</span><span class="sxs-lookup"><span data-stu-id="ee0d6-385">DNS Servers</span></span></td><td><span data-ttu-id="ee0d6-386">Ingen</span><span class="sxs-lookup"><span data-stu-id="ee0d6-386">None</span></span></td><td><span data-ttu-id="ee0d6-387">Ignorera detta eftersom vi inte använder en DNS-Server</span><span class="sxs-lookup"><span data-stu-id="ee0d6-387">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-388">Adressutrymmet</span><span class="sxs-lookup"><span data-stu-id="ee0d6-388">Address Space</span></span></td><td><span data-ttu-id="ee0d6-389">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="ee0d6-389">10.1.0.0/16</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="ee0d6-390">Starta IP</span><span class="sxs-lookup"><span data-stu-id="ee0d6-390">Starting IP</span></span></td><td><span data-ttu-id="ee0d6-391">10.1.0.0</span><span class="sxs-lookup"><span data-stu-id="ee0d6-391">10.1.0.0</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="ee0d6-392">CIDR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-392">CIDR</span></span> </td><td><span data-ttu-id="ee0d6-393">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-393">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="ee0d6-394">Lägg till följande undernät hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-394">Add hello following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-395">Namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-395">Name</span></span></th><th><span data-ttu-id="ee0d6-396">Starta IP</span><span class="sxs-lookup"><span data-stu-id="ee0d6-396">Starting IP</span></span></th><th><span data-ttu-id="ee0d6-397">CIDR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-397">CIDR</span></span></th><th><span data-ttu-id="ee0d6-398">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-398">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-399">webbprogram</span><span class="sxs-lookup"><span data-stu-id="ee0d6-399">web</span></span></td><td><span data-ttu-id="ee0d6-400">10.1.1.0</span><span class="sxs-lookup"><span data-stu-id="ee0d6-400">10.1.1.0</span></span></td><td><span data-ttu-id="ee0d6-401">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-401">/24 (251)</span></span></td><td><span data-ttu-id="ee0d6-402">Undernät för hello webbgrupp</span><span class="sxs-lookup"><span data-stu-id="ee0d6-402">Subnet for hello web farm</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-403">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-403">data</span></span></td><td><span data-ttu-id="ee0d6-404">10.1.2.0</span><span class="sxs-lookup"><span data-stu-id="ee0d6-404">10.1.2.0</span></span></td><td><span data-ttu-id="ee0d6-405">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-405">/24 (251)</span></span></td><td><span data-ttu-id="ee0d6-406">Undernät för hello databasnoder</span><span class="sxs-lookup"><span data-stu-id="ee0d6-406">Subnet for hello database nodes</span></span></td></tr>
</table>

<span data-ttu-id="ee0d6-407">Data och Web undernät kan skyddas via nätverkssäkerhetsgrupper hello täckning som ligger utanför omfånget för den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-407">Data and Web subnets can be protected through network security groups hello coverage of which is out of scope for this article.</span></span>  

<span data-ttu-id="ee0d6-408">**Steg 2: Etablera virtuella datorer** med hello avbildning som har skapats tidigare, vi skapar hello följande virtuella datorer i molnet hello server ”hk-c-svc-Väst” och binda dem toohello respektive undernät som visas nedan:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-408">**Step 2: Provision Virtual Machines** Using hello image created previously, we will create hello following virtual machines in hello cloud server “hk-c-svc-west” and bind them toohello respective subnets as shown below:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-409">Namnet på datorn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-409">Machine Name</span></span>    </th><th><span data-ttu-id="ee0d6-410">Undernät</span><span class="sxs-lookup"><span data-stu-id="ee0d6-410">Subnet</span></span>    </th><th><span data-ttu-id="ee0d6-411">IP-adress</span><span class="sxs-lookup"><span data-stu-id="ee0d6-411">IP Address</span></span>    </th><th><span data-ttu-id="ee0d6-412">Tillgänglighetsuppsättning</span><span class="sxs-lookup"><span data-stu-id="ee0d6-412">Availability set</span></span></th><th><span data-ttu-id="ee0d6-413">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="ee0d6-413">DC/Rack</span></span></th><th><span data-ttu-id="ee0d6-414">Startvärde för?</span><span class="sxs-lookup"><span data-stu-id="ee0d6-414">Seed?</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-415">HK-c1-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-415">hk-c1-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-416">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-416">data</span></span>    </td><td><span data-ttu-id="ee0d6-417">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-417">10.1.2.4</span></span>    </td><td><span data-ttu-id="ee0d6-418">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-418">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="ee0d6-419">DC = WESTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-419">dc =WESTUS rack =rack1</span></span> </td><td><span data-ttu-id="ee0d6-420">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-420">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-421">HK-c2-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-421">hk-c2-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-422">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-422">data</span></span>    </td><td><span data-ttu-id="ee0d6-423">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="ee0d6-423">10.1.2.5</span></span>    </td><td><span data-ttu-id="ee0d6-424">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-424">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="ee0d6-425">DC = WESTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-425">dc =WESTUS rack =rack1</span></span>    </td><td><span data-ttu-id="ee0d6-426">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-426">No</span></span> </td></tr>
<tr><td><span data-ttu-id="ee0d6-427">HK-c3-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-427">hk-c3-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-428">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-428">data</span></span>    </td><td><span data-ttu-id="ee0d6-429">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="ee0d6-429">10.1.2.6</span></span>    </td><td><span data-ttu-id="ee0d6-430">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-430">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="ee0d6-431">DC = WESTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-431">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="ee0d6-432">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-432">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-433">HK-c4-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-433">hk-c4-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-434">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-434">data</span></span>    </td><td><span data-ttu-id="ee0d6-435">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="ee0d6-435">10.1.2.7</span></span>    </td><td><span data-ttu-id="ee0d6-436">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-436">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="ee0d6-437">DC = WESTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-437">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="ee0d6-438">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-438">No</span></span> </td></tr>
<tr><td><span data-ttu-id="ee0d6-439">HK-c5-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-439">hk-c5-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-440">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-440">data</span></span>    </td><td><span data-ttu-id="ee0d6-441">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-441">10.1.2.8</span></span>    </td><td><span data-ttu-id="ee0d6-442">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-442">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="ee0d6-443">DC = WESTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-443">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="ee0d6-444">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-444">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-445">HK-c6-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-445">hk-c6-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-446">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-446">data</span></span>    </td><td><span data-ttu-id="ee0d6-447">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="ee0d6-447">10.1.2.9</span></span>    </td><td><span data-ttu-id="ee0d6-448">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-448">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="ee0d6-449">DC = WESTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-449">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="ee0d6-450">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-450">No</span></span> </td></tr>
<tr><td><span data-ttu-id="ee0d6-451">HK-c7-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-451">hk-c7-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-452">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-452">data</span></span>    </td><td><span data-ttu-id="ee0d6-453">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="ee0d6-453">10.1.2.10</span></span>    </td><td><span data-ttu-id="ee0d6-454">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-454">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="ee0d6-455">DC = WESTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-455">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="ee0d6-456">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-456">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-457">HK-c8-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-457">hk-c8-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-458">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-458">data</span></span>    </td><td><span data-ttu-id="ee0d6-459">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="ee0d6-459">10.1.2.11</span></span>    </td><td><span data-ttu-id="ee0d6-460">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-460">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="ee0d6-461">DC = WESTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-461">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="ee0d6-462">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-462">No</span></span> </td></tr>
<tr><td><span data-ttu-id="ee0d6-463">HK-w1-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-463">hk-w1-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-464">webbprogram</span><span class="sxs-lookup"><span data-stu-id="ee0d6-464">web</span></span>    </td><td><span data-ttu-id="ee0d6-465">10.1.1.4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-465">10.1.1.4</span></span>    </td><td><span data-ttu-id="ee0d6-466">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-466">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="ee0d6-467">Saknas</span><span class="sxs-lookup"><span data-stu-id="ee0d6-467">N/A</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-468">HK-w2-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-468">hk-w2-west-us</span></span>    </td><td><span data-ttu-id="ee0d6-469">webbprogram</span><span class="sxs-lookup"><span data-stu-id="ee0d6-469">web</span></span>    </td><td><span data-ttu-id="ee0d6-470">10.1.1.5</span><span class="sxs-lookup"><span data-stu-id="ee0d6-470">10.1.1.5</span></span>    </td><td><span data-ttu-id="ee0d6-471">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-471">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="ee0d6-472">Saknas</span><span class="sxs-lookup"><span data-stu-id="ee0d6-472">N/A</span></span></td></tr>
</table>

<span data-ttu-id="ee0d6-473">Skapandet av hello ovan lista över virtuella datorer kräver hello följande process:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-473">Creation of hello above list of VMs requires hello following process:</span></span>

1. <span data-ttu-id="ee0d6-474">Skapa en tom molntjänst i ett visst område</span><span class="sxs-lookup"><span data-stu-id="ee0d6-474">Create an empty cloud service in a particular region</span></span>
2. <span data-ttu-id="ee0d6-475">Skapa en virtuell dator från hello tidigare avbildning och koppla den toohello virtuella nätverk som skapades tidigare; Upprepa detta för alla hello virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-475">Create a VM from hello previously captured image and attach it toohello virtual network created previously; repeat this for all hello VMs</span></span>
3. <span data-ttu-id="ee0d6-476">Lägg till en molntjänst för intern belastningsutjämnare toohello och koppla den toohello ”data-undernät</span><span class="sxs-lookup"><span data-stu-id="ee0d6-476">Add an internal load balancer toohello cloud service and attach it toohello “data” subnet</span></span>
4. <span data-ttu-id="ee0d6-477">Lägg till en slutpunkt för Utjämning av nätverksbelastning för thrift-trafik via en belastningsutjämnad uppsättning anslutna toohello som tidigare har skapat intern belastningsutjämnare för varje VM som skapats tidigare</span><span class="sxs-lookup"><span data-stu-id="ee0d6-477">For each VM created previously, add a load balanced endpoint for thrift traffic through a load balanced set connected toohello previously created internal load balancer</span></span>

<span data-ttu-id="ee0d6-478">hello ovan processen kan utföras med hjälp av Azure klassiska portal; använda en Windows-dator (Använd en virtuell dator i Azure om du inte har åtkomst tooa Windows-dator), Använd följande PowerShell-skriptet tooprovision hello alla 8 virtuella datorer automatiskt.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-478">hello above process can be executed using Azure classic portal; use a Windows machine (use a VM on Azure if you don't have access tooa Windows machine), use hello following PowerShell script tooprovision all 8 VMs automatically.</span></span>

<span data-ttu-id="ee0d6-479">**Lista över 1: PowerShell-skript för etablering av virtuella datorer**</span><span class="sxs-lookup"><span data-stu-id="ee0d6-479">**List 1: PowerShell script for provisioning virtual machines**</span></span>

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into hello current Powershell session before proceeding
        #hello process: 1. create Azure Storage account, 2. create virtual network, 3.create hello VM template, 2. crate a list of VMs from hello template

        #fundamental variables - change these tooreflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores hello list of azure vm configuration objects
        #create hello list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add hello thrift endpoint toohello internal load balancer for all hello VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

<span data-ttu-id="ee0d6-480">**Steg 3: Konfigurera Cassandra på varje virtuell dator**</span><span class="sxs-lookup"><span data-stu-id="ee0d6-480">**Step 3: Configure Cassandra on each VM**</span></span>

<span data-ttu-id="ee0d6-481">Logga in på hello VM och utför hello följande:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-481">Log into hello VM and perform hello following:</span></span>

* <span data-ttu-id="ee0d6-482">Redigera $CASS_HOME/conf/cassandra-rackdc.properties toospecify hello data center och rack egenskaper:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-482">Edit $CASS_HOME/conf/cassandra-rackdc.properties toospecify hello data center and rack properties:</span></span>
  
       dc =EASTUS, rack =rack1
* <span data-ttu-id="ee0d6-483">Redigera cassandra.yaml tooconfigure seed noder enligt nedan:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-483">Edit cassandra.yaml tooconfigure seed nodes as below:</span></span>
  
       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

<span data-ttu-id="ee0d6-484">**Steg 4: Starta hello virtuella datorer och testa hello kluster**</span><span class="sxs-lookup"><span data-stu-id="ee0d6-484">**Step 4: Start hello VMs and test hello cluster**</span></span>

<span data-ttu-id="ee0d6-485">Logga in på en av noderna i hello (t.ex. hk-c1-Väst-us) och kör hello efter kommandot toosee hello status för hello klustret:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-485">Log into one of hello nodes (e.g. hk-c1-west-us) and run hello following command toosee hello status of hello cluster:</span></span>

       nodetool –h 10.1.2.4 –p 7199 status

<span data-ttu-id="ee0d6-486">Du bör se hello Visa liknande toohello en nedan för ett kluster på 8 noder:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-486">You should see hello display similar toohello one below for an 8-node cluster:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-487">Status</span><span class="sxs-lookup"><span data-stu-id="ee0d6-487">Status</span></span></th><th><span data-ttu-id="ee0d6-488">Adress</span><span class="sxs-lookup"><span data-stu-id="ee0d6-488">Address</span></span>    </th><th><span data-ttu-id="ee0d6-489">Läsa in</span><span class="sxs-lookup"><span data-stu-id="ee0d6-489">Load</span></span>    </th><th><span data-ttu-id="ee0d6-490">Token</span><span class="sxs-lookup"><span data-stu-id="ee0d6-490">Tokens</span></span>    </th><th><span data-ttu-id="ee0d6-491">Äger</span><span class="sxs-lookup"><span data-stu-id="ee0d6-491">Owns</span></span> </th><th><span data-ttu-id="ee0d6-492">Värd-ID</span><span class="sxs-lookup"><span data-stu-id="ee0d6-492">Host ID</span></span>    </th><th><span data-ttu-id="ee0d6-493">Rack</span><span class="sxs-lookup"><span data-stu-id="ee0d6-493">Rack</span></span></th></tr>
<tr><th><span data-ttu-id="ee0d6-494">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-494">UN</span></span>    </td><td><span data-ttu-id="ee0d6-495">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-495">10.1.2.4</span></span>     </td><td><span data-ttu-id="ee0d6-496">87.81 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-496">87.81 KB</span></span>    </td><td><span data-ttu-id="ee0d6-497">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-497">256</span></span>    </td><td><span data-ttu-id="ee0d6-498">38.0%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-498">38.0%</span></span>    </td><td><span data-ttu-id="ee0d6-499">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-499">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-500">rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-500">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-501">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-501">UN</span></span>    </td><td><span data-ttu-id="ee0d6-502">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="ee0d6-502">10.1.2.5</span></span>     </td><td><span data-ttu-id="ee0d6-503">41.08 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-503">41.08 KB</span></span>    </td><td><span data-ttu-id="ee0d6-504">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-504">256</span></span>    </td><td><span data-ttu-id="ee0d6-505">68.9%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-505">68.9%</span></span>    </td><td><span data-ttu-id="ee0d6-506">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-506">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-507">rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-507">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-508">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-508">UN</span></span>    </td><td><span data-ttu-id="ee0d6-509">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="ee0d6-509">10.1.2.6</span></span>     </td><td><span data-ttu-id="ee0d6-510">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-510">55.29 KB</span></span>    </td><td><span data-ttu-id="ee0d6-511">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-511">256</span></span>    </td><td><span data-ttu-id="ee0d6-512">68.8%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-512">68.8%</span></span>    </td><td><span data-ttu-id="ee0d6-513">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-513">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-514">rack2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-514">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-515">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-515">UN</span></span>    </td><td><span data-ttu-id="ee0d6-516">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="ee0d6-516">10.1.2.7</span></span>     </td><td><span data-ttu-id="ee0d6-517">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-517">55.29 KB</span></span>    </td><td><span data-ttu-id="ee0d6-518">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-518">256</span></span>    </td><td><span data-ttu-id="ee0d6-519">68.8%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-519">68.8%</span></span>    </td><td><span data-ttu-id="ee0d6-520">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-520">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-521">rack2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-521">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-522">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-522">UN</span></span>    </td><td><span data-ttu-id="ee0d6-523">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-523">10.1.2.8</span></span>     </td><td><span data-ttu-id="ee0d6-524">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-524">55.29 KB</span></span>    </td><td><span data-ttu-id="ee0d6-525">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-525">256</span></span>    </td><td><span data-ttu-id="ee0d6-526">68.8%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-526">68.8%</span></span>    </td><td><span data-ttu-id="ee0d6-527">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-527">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-528">rack3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-528">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-529">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-529">UN</span></span>    </td><td><span data-ttu-id="ee0d6-530">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="ee0d6-530">10.1.2.9</span></span>     </td><td><span data-ttu-id="ee0d6-531">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-531">55.29 KB</span></span>    </td><td><span data-ttu-id="ee0d6-532">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-532">256</span></span>    </td><td><span data-ttu-id="ee0d6-533">68.8%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-533">68.8%</span></span>    </td><td><span data-ttu-id="ee0d6-534">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-534">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-535">rack3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-535">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-536">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-536">UN</span></span>    </td><td><span data-ttu-id="ee0d6-537">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="ee0d6-537">10.1.2.10</span></span>     </td><td><span data-ttu-id="ee0d6-538">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-538">55.29 KB</span></span>    </td><td><span data-ttu-id="ee0d6-539">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-539">256</span></span>    </td><td><span data-ttu-id="ee0d6-540">68.8%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-540">68.8%</span></span>    </td><td><span data-ttu-id="ee0d6-541">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-541">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-542">rack4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-542">rack4</span></span></td></tr>
<tr><th><span data-ttu-id="ee0d6-543">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-543">UN</span></span>    </td><td><span data-ttu-id="ee0d6-544">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="ee0d6-544">10.1.2.11</span></span>     </td><td><span data-ttu-id="ee0d6-545">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="ee0d6-545">55.29 KB</span></span>    </td><td><span data-ttu-id="ee0d6-546">256</span><span class="sxs-lookup"><span data-stu-id="ee0d6-546">256</span></span>    </td><td><span data-ttu-id="ee0d6-547">68.8%</span><span class="sxs-lookup"><span data-stu-id="ee0d6-547">68.8%</span></span>    </td><td><span data-ttu-id="ee0d6-548">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-548">Guid (removed)</span></span></td><td><span data-ttu-id="ee0d6-549">rack4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-549">rack4</span></span></td></tr>
</table>

## <a name="test-hello-single-region-cluster"></a><span data-ttu-id="ee0d6-550">Testa hello Region kluster</span><span class="sxs-lookup"><span data-stu-id="ee0d6-550">Test hello Single Region Cluster</span></span>
<span data-ttu-id="ee0d6-551">Använd hello följande steg tootest hello klustret:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-551">Use hello following steps tootest hello cluster:</span></span>

1. <span data-ttu-id="ee0d6-552">Med hello Powershell-kommandot Get-AzureInternalLoadbalancer kommandot Hämta hello IP-adressen för hello intern belastningsutjämnare (t.ex.)  10.1.2.101).</span><span class="sxs-lookup"><span data-stu-id="ee0d6-552">Using hello Powershell command Get-AzureInternalLoadbalancer commandlet, obtain hello IP address of hello internal load balancer (e.g.  10.1.2.101).</span></span> <span data-ttu-id="ee0d6-553">hello syntaxen för kommandot hello visas nedan: Get-AzureLoadbalancer – ServiceName ”hk-c-svc-Väst-oss” [visar hello information om hello intern belastningsutjämnare tillsammans med dess IP-adress]</span><span class="sxs-lookup"><span data-stu-id="ee0d6-553">hello syntax of hello command is shown below: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [displays hello details of hello internal load balancer along with its IP address]</span></span>
2. <span data-ttu-id="ee0d6-554">Logga in på hello webbservergrupp VM (t.ex. hk-w1-Väst-us) med hjälp av Putty eller ssh</span><span class="sxs-lookup"><span data-stu-id="ee0d6-554">Log into hello web farm VM (e.g. hk-w1-west-us) using Putty or ssh</span></span>
3. <span data-ttu-id="ee0d6-555">Köra $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="ee0d6-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
4. <span data-ttu-id="ee0d6-556">Använd hello efter CQL kommandon tooverify om hello klustret fungerar:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-556">Use hello following CQL commands tooverify if hello cluster is working:</span></span>
   
     <span data-ttu-id="ee0d6-557">Skapa KEYSPACE customers_ks med replikering = {'class': 'SimpleStrategy', 'replication_factor': 3};   ANVÄNDA customers_ks;   Skapa tabell Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Infoga i Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   Infoga i Customers(customer_id, firstname, lastname) värden (2, ”Jane', 'Berg”).</span><span class="sxs-lookup"><span data-stu-id="ee0d6-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span></span>
   
     <span data-ttu-id="ee0d6-558">Välj * från kunder.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-558">SELECT * FROM Customers;</span></span>

<span data-ttu-id="ee0d6-559">Du bör se en skärm som hello en nedan:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-559">You should see a display like hello one below:</span></span>

<table>
  <tr><th> <span data-ttu-id="ee0d6-560">customer_id</span><span class="sxs-lookup"><span data-stu-id="ee0d6-560">customer_id</span></span> </th><th> <span data-ttu-id="ee0d6-561">Förnamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-561">firstname</span></span> </th><th> <span data-ttu-id="ee0d6-562">Efternamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-562">lastname</span></span> </th></tr>
  <tr><td> <span data-ttu-id="ee0d6-563">1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-563">1</span></span> </td><td> <span data-ttu-id="ee0d6-564">John</span><span class="sxs-lookup"><span data-stu-id="ee0d6-564">John</span></span> </td><td> <span data-ttu-id="ee0d6-565">Berg</span><span class="sxs-lookup"><span data-stu-id="ee0d6-565">Doe</span></span> </td></tr>
  <tr><td> <span data-ttu-id="ee0d6-566">2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-566">2</span></span> </td><td> <span data-ttu-id="ee0d6-567">Jane</span><span class="sxs-lookup"><span data-stu-id="ee0d6-567">Jane</span></span> </td><td> <span data-ttu-id="ee0d6-568">Berg</span><span class="sxs-lookup"><span data-stu-id="ee0d6-568">Doe</span></span> </td></tr>
</table>

<span data-ttu-id="ee0d6-569">Observera att hello keyspace skapade i steg 4 använder SimpleStrategy med en replication_factor 3.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-569">Please note that hello keyspace created in step 4 uses SimpleStrategy with a  replication_factor of 3.</span></span> <span data-ttu-id="ee0d6-570">SimpleStrategy rekommenderas för enda data center distributioner medan NetworkTopologyStrategy för flera data center distributioner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-570">SimpleStrategy is recommended for single data center deployments whereas NetworkTopologyStrategy for multi-data center deployments.</span></span> <span data-ttu-id="ee0d6-571">En replication_factor 3 ger tolerans för nodfel.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-571">A replication_factor of 3 will give tolerance for node failures.</span></span>

## <span data-ttu-id="ee0d6-572"><a id="tworegion"></a>Flera regioner distributionsprocessen</span><span class="sxs-lookup"><span data-stu-id="ee0d6-572"><a id="tworegion"> </a>Multi-Region Deployment Process</span></span>
<span data-ttu-id="ee0d6-573">Utnyttja hello enskild region distributionen har slutförts och upprepa hello samma process för att installera andra hello-region.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-573">Will leverage hello single region deployment completed and repeat hello same process for installing hello second region.</span></span> <span data-ttu-id="ee0d6-574">hello viktiga skillnaden mellan hello enda och distribution i flera region är hello VPN-tunnel konfiguration för kommunikation mellan region. Vi börjar med hello nätverksinstallation, etablera hello virtuella datorer och konfigurera Cassandra.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-574">hello key difference between hello single and multiple region deployment is hello VPN tunnel setup for inter-region communication; we will start with hello network installation, provision hello VMs and configure Cassandra.</span></span>

### <a name="step-1-create-hello-virtual-network-at-hello-2nd-region"></a><span data-ttu-id="ee0d6-575">Steg 1: Skapa hello virtuella nätverk på hello 2 Region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-575">Step 1: Create hello Virtual Network at hello 2nd Region</span></span>
<span data-ttu-id="ee0d6-576">Logga in på hello klassiska Azure-portalen och skapa ett virtuellt nätverk med hello attribut visas i hello tabell.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-576">Log into hello Azure classic portal and create a Virtual Network with hello attributes show in hello table.</span></span> <span data-ttu-id="ee0d6-577">Se [konfigurera ett virtuellt nätverk Cloud-Only i hello klassiska Azure-portalen](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) detaljerade anvisningar för hello process.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-577">See [Configure a Cloud-Only Virtual Network in hello Azure classic portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of hello process.</span></span>      

<table>
<tr><th><span data-ttu-id="ee0d6-578">Attributets namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-578">Attribute Name</span></span>    </th><th><span data-ttu-id="ee0d6-579">Värde</span><span class="sxs-lookup"><span data-stu-id="ee0d6-579">Value</span></span>    </th><th><span data-ttu-id="ee0d6-580">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-580">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-581">Namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-581">Name</span></span>    </td><td><span data-ttu-id="ee0d6-582">vnet-fråga-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-582">vnet-cass-east-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="ee0d6-583">Region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-583">Region</span></span>    </td><td><span data-ttu-id="ee0d6-584">Östra USA</span><span class="sxs-lookup"><span data-stu-id="ee0d6-584">East US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="ee0d6-585">DNS-servrar</span><span class="sxs-lookup"><span data-stu-id="ee0d6-585">DNS Servers</span></span>        </td><td></td><td><span data-ttu-id="ee0d6-586">Ignorera detta eftersom vi inte använder en DNS-Server</span><span class="sxs-lookup"><span data-stu-id="ee0d6-586">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-587">Konfigurera en punkt-till-plats-VPN</span><span class="sxs-lookup"><span data-stu-id="ee0d6-587">Configure a point-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="ee0d6-588">Ignorera detta</span><span class="sxs-lookup"><span data-stu-id="ee0d6-588">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-589">Konfigurera ett VPN mellan två platser</span><span class="sxs-lookup"><span data-stu-id="ee0d6-589">Configure a site-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="ee0d6-590">Ignorera detta</span><span class="sxs-lookup"><span data-stu-id="ee0d6-590">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-591">Adressutrymmet</span><span class="sxs-lookup"><span data-stu-id="ee0d6-591">Address Space</span></span>    </td><td><span data-ttu-id="ee0d6-592">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="ee0d6-592">10.2.0.0/16</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="ee0d6-593">Starta IP</span><span class="sxs-lookup"><span data-stu-id="ee0d6-593">Starting IP</span></span>    </td><td><span data-ttu-id="ee0d6-594">10.2.0.0</span><span class="sxs-lookup"><span data-stu-id="ee0d6-594">10.2.0.0</span></span>    </td><td></td></tr>
<tr><td><span data-ttu-id="ee0d6-595">CIDR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-595">CIDR</span></span>    </td><td><span data-ttu-id="ee0d6-596">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-596">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="ee0d6-597">Lägg till följande undernät hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-597">Add hello following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-598">Namn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-598">Name</span></span>    </th><th><span data-ttu-id="ee0d6-599">Starta IP</span><span class="sxs-lookup"><span data-stu-id="ee0d6-599">Starting IP</span></span>    </th><th><span data-ttu-id="ee0d6-600">CIDR</span><span class="sxs-lookup"><span data-stu-id="ee0d6-600">CIDR</span></span>    </th><th><span data-ttu-id="ee0d6-601">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-601">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-602">webbprogram</span><span class="sxs-lookup"><span data-stu-id="ee0d6-602">web</span></span>    </td><td><span data-ttu-id="ee0d6-603">10.2.1.0</span><span class="sxs-lookup"><span data-stu-id="ee0d6-603">10.2.1.0</span></span>    </td><td><span data-ttu-id="ee0d6-604">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-604">/24 (251)</span></span>    </td><td><span data-ttu-id="ee0d6-605">Undernät för hello webbgrupp</span><span class="sxs-lookup"><span data-stu-id="ee0d6-605">Subnet for hello web farm</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-606">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-606">data</span></span>    </td><td><span data-ttu-id="ee0d6-607">10.2.2.0</span><span class="sxs-lookup"><span data-stu-id="ee0d6-607">10.2.2.0</span></span>    </td><td><span data-ttu-id="ee0d6-608">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="ee0d6-608">/24 (251)</span></span>    </td><td><span data-ttu-id="ee0d6-609">Undernät för hello databasnoder</span><span class="sxs-lookup"><span data-stu-id="ee0d6-609">Subnet for hello database nodes</span></span></td></tr>
</table>


### <a name="step-2-create-local-networks"></a><span data-ttu-id="ee0d6-610">Steg 2: Skapa lokala nätverk</span><span class="sxs-lookup"><span data-stu-id="ee0d6-610">Step 2: Create Local Networks</span></span>
<span data-ttu-id="ee0d6-611">Ett lokalt nätverk i Azure virtuella nätverk är en proxy-adressutrymme som mappar tooa fjärrplats, inklusive ett privat moln eller en annan Azure-region.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-611">A Local Network in Azure virtual networking is a proxy address space that maps tooa remote site including a private cloud or another Azure region.</span></span> <span data-ttu-id="ee0d6-612">Det här adressutrymmet för proxy är bundna tooa fjärr-gateway för routning nätverket toohello höger nätverk mål.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-612">This proxy address space is bound tooa remote gateway for routing network toohello right networking destinations.</span></span> <span data-ttu-id="ee0d6-613">Se [konfigurera VNet-tooVNet anslutning](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) hello instruktioner för VNET-till-VNET-anslutning upprättas.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-613">See [Configure a VNet tooVNet Connection](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) for hello instructions on establishing VNET-to-VNET connection.</span></span>

<span data-ttu-id="ee0d6-614">Skapa två lokala nätverk per hello följande information:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-614">Create two local networks per hello following details:</span></span>

| <span data-ttu-id="ee0d6-615">Nätverksnamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-615">Network Name</span></span> | <span data-ttu-id="ee0d6-616">VPN Gateway-adress</span><span class="sxs-lookup"><span data-stu-id="ee0d6-616">VPN Gateway Address</span></span> | <span data-ttu-id="ee0d6-617">Adressutrymmet</span><span class="sxs-lookup"><span data-stu-id="ee0d6-617">Address Space</span></span> | <span data-ttu-id="ee0d6-618">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="ee0d6-618">Remarks</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ee0d6-619">HK-lnet-Map-to-East-US</span><span class="sxs-lookup"><span data-stu-id="ee0d6-619">hk-lnet-map-to-east-us</span></span> |<span data-ttu-id="ee0d6-620">23.1.1.1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-620">23.1.1.1</span></span> |<span data-ttu-id="ee0d6-621">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="ee0d6-621">10.2.0.0/16</span></span> |<span data-ttu-id="ee0d6-622">När du skapar hello lokalt nätverk ger en platshållare för gateway-adress.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-622">While creating hello Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="ee0d6-623">hello verkliga gatewayadress fylls när hello gateway har skapats.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-623">hello real gateway address is filled once hello gateway is created.</span></span> <span data-ttu-id="ee0d6-624">Se till att hello-adressutrymmet exakt matchar hello respektive Fjärrnätverket; i det här fallet skapas hello VNET i hello östra USA.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-624">Make sure hello address space exactly matches hello respective remote VNET; in this case hello VNET created in hello East US region.</span></span> |
| <span data-ttu-id="ee0d6-625">HK-lnet-Map-to-West-US</span><span class="sxs-lookup"><span data-stu-id="ee0d6-625">hk-lnet-map-to-west-us</span></span> |<span data-ttu-id="ee0d6-626">23.2.2.2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-626">23.2.2.2</span></span> |<span data-ttu-id="ee0d6-627">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="ee0d6-627">10.1.0.0/16</span></span> |<span data-ttu-id="ee0d6-628">När du skapar hello lokalt nätverk ger en platshållare för gateway-adress.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-628">While creating hello Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="ee0d6-629">hello verkliga gatewayadress fylls när hello gateway har skapats.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-629">hello real gateway address is filled once hello gateway is created.</span></span> <span data-ttu-id="ee0d6-630">Se till att hello-adressutrymmet exakt matchar hello respektive Fjärrnätverket; i det här fallet skapas hello VNET i hello västra USA region.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-630">Make sure hello address space exactly matches hello respective remote VNET; in this case hello VNET created in hello West US region.</span></span> |

### <a name="step-3-map-local-network-toohello-respective-vnets"></a><span data-ttu-id="ee0d6-631">Steg 3: Karta ”lokalt” nätverk toohello respektive Vnet</span><span class="sxs-lookup"><span data-stu-id="ee0d6-631">Step 3: Map “Local” network toohello respective VNETs</span></span>
<span data-ttu-id="ee0d6-632">Markera varje virtuellt nätverk från hello klassiska Azure-portalen, klickar du på ”Konfigurera”, markera ”Anslut toohello lokala nätverk” och välj hello lokala nätverk per hello följande information:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-632">From hello Azure classic portal, select each vnet, click “Configure”, check “Connect toohello local network”, and select hello Local Networks per hello following details:</span></span>

| <span data-ttu-id="ee0d6-633">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="ee0d6-633">Virtual Network</span></span> | <span data-ttu-id="ee0d6-634">Lokalt nätverk</span><span class="sxs-lookup"><span data-stu-id="ee0d6-634">Local Network</span></span> |
| --- | --- |
| <span data-ttu-id="ee0d6-635">HK-vnet-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-635">hk-vnet-west-us</span></span> |<span data-ttu-id="ee0d6-636">HK-lnet-Map-to-East-US</span><span class="sxs-lookup"><span data-stu-id="ee0d6-636">hk-lnet-map-to-east-us</span></span> |
| <span data-ttu-id="ee0d6-637">HK-vnet-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-637">hk-vnet-east-us</span></span> |<span data-ttu-id="ee0d6-638">HK-lnet-Map-to-West-US</span><span class="sxs-lookup"><span data-stu-id="ee0d6-638">hk-lnet-map-to-west-us</span></span> |

### <a name="step-4-create-gateways-on-vnet1-and-vnet2"></a><span data-ttu-id="ee0d6-639">Steg 4: Skapa Gateways på VNET1 och VNET2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-639">Step 4: Create Gateways on VNET1 and VNET2</span></span>
<span data-ttu-id="ee0d6-640">Klicka på Skapa GATEWAYEN som utlöser hello VPN-gateway etableringsprocessen hello instrumentpanelen för båda hello virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-640">From hello dashboard of both hello virtual networks, click CREATE GATEWAY which will trigger hello VPN gateway provisioning process.</span></span> <span data-ttu-id="ee0d6-641">Efter några minuter hello instrumentpanelen i varje virtuellt nätverk ska visa hello faktiska gateway-adress.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-641">After a few minutes hello dashboard of each virtual network should display hello actual gateway address.</span></span>

### <a name="step-5-update-local-networks-with-hello-respective-gateway-addresses"></a><span data-ttu-id="ee0d6-642">Steg 5: Uppdatera ”lokala” nätverk med hello respektive ”” gatewayadresser</span><span class="sxs-lookup"><span data-stu-id="ee0d6-642">Step 5: Update “Local” networks with hello respective “Gateway” addresses</span></span>
<span data-ttu-id="ee0d6-643">Redigera båda hello lokala nätverk tooreplace hello platshållare gateway IP-adressen med hello verkliga IP-adressen för hello bara etablerad gateway.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-643">Edit both hello local networks tooreplace hello placeholder gateway IP address with hello real IP address of hello just provisioned gateways.</span></span> <span data-ttu-id="ee0d6-644">Använd följande mappning hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-644">Use hello following mapping:</span></span>

<table>
<tr><th><span data-ttu-id="ee0d6-645">Lokalt nätverk</span><span class="sxs-lookup"><span data-stu-id="ee0d6-645">Local Network</span></span>    </th><th><span data-ttu-id="ee0d6-646">Virtuell nätverksgateway</span><span class="sxs-lookup"><span data-stu-id="ee0d6-646">Virtual Network Gateway</span></span></th></tr>
<tr><td><span data-ttu-id="ee0d6-647">HK-lnet-Map-to-East-US</span><span class="sxs-lookup"><span data-stu-id="ee0d6-647">hk-lnet-map-to-east-us</span></span> </td><td><span data-ttu-id="ee0d6-648">Gateway för hk-vnet-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-648">Gateway of hk-vnet-west-us</span></span></td></tr>
<tr><td><span data-ttu-id="ee0d6-649">HK-lnet-Map-to-West-US</span><span class="sxs-lookup"><span data-stu-id="ee0d6-649">hk-lnet-map-to-west-us</span></span> </td><td><span data-ttu-id="ee0d6-650">Gateway för hk-vnet-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-650">Gateway of hk-vnet-east-us</span></span></td></tr>
</table>

### <a name="step-6-update-hello-shared-key"></a><span data-ttu-id="ee0d6-651">Steg 6: Uppdatera hello delad nyckel</span><span class="sxs-lookup"><span data-stu-id="ee0d6-651">Step 6: Update hello shared key</span></span>
<span data-ttu-id="ee0d6-652">Använd hello följande Powershell-skriptet tooupdate hello IPSec-nyckel för varje VPN-gateway [Använd hello saké en nyckel för både hello gateways]: Set-AzureVNetGatewayKey - VNetName hk-vnet-Öst-oss - LocalNetworkSiteName hk-lnet-map-to-west-us - SharedKey D9E76BKK Set-AzureVNetGatewayKey - VNetName hk-vnet-Väst-oss - LocalNetworkSiteName hk-lnet-map-to-east-us - SharedKey D9E76BKK</span><span class="sxs-lookup"><span data-stu-id="ee0d6-652">Use hello following Powershell script tooupdate hello IPSec key of each VPN gateway [use hello sake key for both hello gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span></span>

### <a name="step-7-establish-hello-vnet-to-vnet-connection"></a><span data-ttu-id="ee0d6-653">Steg 7: Skapa hello VNET-till-VNET-anslutning</span><span class="sxs-lookup"><span data-stu-id="ee0d6-653">Step 7: Establish hello VNET-to-VNET connection</span></span>
<span data-ttu-id="ee0d6-654">Använd hello ”INSTRUMENTPANELEN”-menyn i båda hello virtuella nätverk tooestablish gateway-till-gateway-anslutningen från hello klassiska Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-654">From hello Azure classic portal, use hello “DASHBOARD” menu of both hello virtual networks tooestablish gateway-to-gateway connection.</span></span> <span data-ttu-id="ee0d6-655">Använd hello ”Anslut” menyalternativ i hello längst ned i verktygsfältet.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-655">Use hello “CONNECT” menu items in hello bottom toolbar.</span></span> <span data-ttu-id="ee0d6-656">Efter några minuter ska hello instrumentpanelen visa hello anslutningsinformation grafiskt.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-656">After a few minutes hello dashboard should display hello connection details graphically.</span></span>

### <a name="step-8-create-hello-virtual-machines-in-region-2"></a><span data-ttu-id="ee0d6-657">Steg 8: Skapa hello virtuella datorer i området #2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-657">Step 8: Create hello virtual machines in region #2</span></span>
<span data-ttu-id="ee0d6-658">Skapa hello Ubuntu avbildning enligt beskrivningen i region #1 distribution av följande hello samma steg eller kopiera hello avbildningen VHD-filen toohello Azure storage-konto finns i området #2 och skapa hello avbildning.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-658">Create hello Ubuntu image as described in region #1 deployment by following hello same steps or copy hello image VHD file toohello Azure storage account located in region #2 and create hello image.</span></span> <span data-ttu-id="ee0d6-659">Använd den här avbildningen och skapa hello efter listan över virtuella datorer till en ny molntjänst hk-c-svc-Öst-oss:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-659">Use this image and create hello following list of virtual machines into a new cloud service hk-c-svc-east-us:</span></span>

| <span data-ttu-id="ee0d6-660">Namnet på datorn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-660">Machine Name</span></span> | <span data-ttu-id="ee0d6-661">Undernät</span><span class="sxs-lookup"><span data-stu-id="ee0d6-661">Subnet</span></span> | <span data-ttu-id="ee0d6-662">IP-adress</span><span class="sxs-lookup"><span data-stu-id="ee0d6-662">IP Address</span></span> | <span data-ttu-id="ee0d6-663">Tillgänglighetsuppsättning</span><span class="sxs-lookup"><span data-stu-id="ee0d6-663">Availability set</span></span> | <span data-ttu-id="ee0d6-664">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="ee0d6-664">DC/Rack</span></span> | <span data-ttu-id="ee0d6-665">Startvärde för?</span><span class="sxs-lookup"><span data-stu-id="ee0d6-665">Seed?</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="ee0d6-666">HK-c1-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-666">hk-c1-east-us</span></span> |<span data-ttu-id="ee0d6-667">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-667">data</span></span> |<span data-ttu-id="ee0d6-668">10.2.2.4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-668">10.2.2.4</span></span> |<span data-ttu-id="ee0d6-669">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-669">hk-c-aset-1</span></span> |<span data-ttu-id="ee0d6-670">DC = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-670">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="ee0d6-671">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-671">Yes</span></span> |
| <span data-ttu-id="ee0d6-672">HK-c2-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-672">hk-c2-east-us</span></span> |<span data-ttu-id="ee0d6-673">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-673">data</span></span> |<span data-ttu-id="ee0d6-674">10.2.2.5</span><span class="sxs-lookup"><span data-stu-id="ee0d6-674">10.2.2.5</span></span> |<span data-ttu-id="ee0d6-675">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-675">hk-c-aset-1</span></span> |<span data-ttu-id="ee0d6-676">DC = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-676">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="ee0d6-677">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-677">No</span></span> |
| <span data-ttu-id="ee0d6-678">HK-c3-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-678">hk-c3-east-us</span></span> |<span data-ttu-id="ee0d6-679">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-679">data</span></span> |<span data-ttu-id="ee0d6-680">10.2.2.6</span><span class="sxs-lookup"><span data-stu-id="ee0d6-680">10.2.2.6</span></span> |<span data-ttu-id="ee0d6-681">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-681">hk-c-aset-1</span></span> |<span data-ttu-id="ee0d6-682">DC = EASTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-682">dc =EASTUS rack =rack2</span></span> |<span data-ttu-id="ee0d6-683">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-683">Yes</span></span> |
| <span data-ttu-id="ee0d6-684">HK-c5-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-684">hk-c5-east-us</span></span> |<span data-ttu-id="ee0d6-685">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-685">data</span></span> |<span data-ttu-id="ee0d6-686">10.2.2.8</span><span class="sxs-lookup"><span data-stu-id="ee0d6-686">10.2.2.8</span></span> |<span data-ttu-id="ee0d6-687">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-687">hk-c-aset-2</span></span> |<span data-ttu-id="ee0d6-688">DC = EASTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-688">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="ee0d6-689">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-689">Yes</span></span> |
| <span data-ttu-id="ee0d6-690">HK-c6-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-690">hk-c6-east-us</span></span> |<span data-ttu-id="ee0d6-691">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-691">data</span></span> |<span data-ttu-id="ee0d6-692">10.2.2.9</span><span class="sxs-lookup"><span data-stu-id="ee0d6-692">10.2.2.9</span></span> |<span data-ttu-id="ee0d6-693">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-693">hk-c-aset-2</span></span> |<span data-ttu-id="ee0d6-694">DC = EASTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="ee0d6-694">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="ee0d6-695">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-695">No</span></span> |
| <span data-ttu-id="ee0d6-696">HK-c7-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-696">hk-c7-east-us</span></span> |<span data-ttu-id="ee0d6-697">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-697">data</span></span> |<span data-ttu-id="ee0d6-698">10.2.2.10</span><span class="sxs-lookup"><span data-stu-id="ee0d6-698">10.2.2.10</span></span> |<span data-ttu-id="ee0d6-699">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-699">hk-c-aset-2</span></span> |<span data-ttu-id="ee0d6-700">DC = EASTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-700">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="ee0d6-701">Ja</span><span class="sxs-lookup"><span data-stu-id="ee0d6-701">Yes</span></span> |
| <span data-ttu-id="ee0d6-702">HK-c8-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-702">hk-c8-east-us</span></span> |<span data-ttu-id="ee0d6-703">Data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-703">data</span></span> |<span data-ttu-id="ee0d6-704">10.2.2.11</span><span class="sxs-lookup"><span data-stu-id="ee0d6-704">10.2.2.11</span></span> |<span data-ttu-id="ee0d6-705">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-705">hk-c-aset-2</span></span> |<span data-ttu-id="ee0d6-706">DC = EASTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-706">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="ee0d6-707">Nej</span><span class="sxs-lookup"><span data-stu-id="ee0d6-707">No</span></span> |
| <span data-ttu-id="ee0d6-708">HK-w1-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-708">hk-w1-east-us</span></span> |<span data-ttu-id="ee0d6-709">webbprogram</span><span class="sxs-lookup"><span data-stu-id="ee0d6-709">web</span></span> |<span data-ttu-id="ee0d6-710">10.2.1.4</span><span class="sxs-lookup"><span data-stu-id="ee0d6-710">10.2.1.4</span></span> |<span data-ttu-id="ee0d6-711">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-711">hk-w-aset-1</span></span> |<span data-ttu-id="ee0d6-712">Saknas</span><span class="sxs-lookup"><span data-stu-id="ee0d6-712">N/A</span></span> |<span data-ttu-id="ee0d6-713">Saknas</span><span class="sxs-lookup"><span data-stu-id="ee0d6-713">N/A</span></span> |
| <span data-ttu-id="ee0d6-714">HK-w2-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="ee0d6-714">hk-w2-east-us</span></span> |<span data-ttu-id="ee0d6-715">webbprogram</span><span class="sxs-lookup"><span data-stu-id="ee0d6-715">web</span></span> |<span data-ttu-id="ee0d6-716">10.2.1.5</span><span class="sxs-lookup"><span data-stu-id="ee0d6-716">10.2.1.5</span></span> |<span data-ttu-id="ee0d6-717">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-717">hk-w-aset-1</span></span> |<span data-ttu-id="ee0d6-718">Saknas</span><span class="sxs-lookup"><span data-stu-id="ee0d6-718">N/A</span></span> |<span data-ttu-id="ee0d6-719">Saknas</span><span class="sxs-lookup"><span data-stu-id="ee0d6-719">N/A</span></span> |

<span data-ttu-id="ee0d6-720">Följ hello samma instruktioner som region #1 men använda 10.2.xxx.xxx adressutrymme.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-720">Follow hello same instructions as region #1 but use 10.2.xxx.xxx address space.</span></span>

### <a name="step-9-configure-cassandra-on-each-vm"></a><span data-ttu-id="ee0d6-721">Steg 9: Konfigurera Cassandra på varje virtuell dator</span><span class="sxs-lookup"><span data-stu-id="ee0d6-721">Step 9: Configure Cassandra on each VM</span></span>
<span data-ttu-id="ee0d6-722">Logga in på hello VM och utför hello följande:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-722">Log into hello VM and perform hello following:</span></span>

1. <span data-ttu-id="ee0d6-723">Redigera $CASS_HOME/conf/cassandra-rackdc.properties toospecify hello data center och rack egenskaper i hello-format: dc = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-723">Edit $CASS_HOME/conf/cassandra-rackdc.properties toospecify hello data center and rack properties in hello format:  dc =EASTUS  rack =rack1</span></span>
2. <span data-ttu-id="ee0d6-724">Redigera de noder som cassandra.yaml tooconfigure startvärde: frö: ”10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10”</span><span class="sxs-lookup"><span data-stu-id="ee0d6-724">Edit cassandra.yaml tooconfigure seed nodes:  Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span></span>

### <a name="step-10-start-cassandra"></a><span data-ttu-id="ee0d6-725">Steg 10: Starta Cassandra</span><span class="sxs-lookup"><span data-stu-id="ee0d6-725">Step 10: Start Cassandra</span></span>
<span data-ttu-id="ee0d6-726">Logga in på varje virtuell dator och starta Cassandra i bakgrunden hello genom att köra följande kommando hello: $CASS_HOME/bin/cassandra</span><span class="sxs-lookup"><span data-stu-id="ee0d6-726">Log into each VM and start Cassandra in hello background by running hello following command: $CASS_HOME/bin/cassandra</span></span>

## <a name="test-hello-multi-region-cluster"></a><span data-ttu-id="ee0d6-727">Testa hello flera regioner kluster</span><span class="sxs-lookup"><span data-stu-id="ee0d6-727">Test hello Multi-Region Cluster</span></span>
<span data-ttu-id="ee0d6-728">Nu har Cassandra distribuerade too16 noder med 8 noder i varje Azure-region.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-728">By now Cassandra has been deployed too16 nodes with 8 nodes in each Azure region.</span></span> <span data-ttu-id="ee0d6-729">Dessa noder finns i samma kluster tack vare hello vanliga klusternamnet och hello seed nodkonfiguration hello.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-729">These nodes are in hello same cluster by virtue of hello common cluster name and hello seed node configuration.</span></span> <span data-ttu-id="ee0d6-730">Använd följande process tootest hello klustret hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-730">Use hello following process tootest hello cluster:</span></span>

### <a name="step-1-get-hello-internal-load-balancer-ip-for-both-hello-regions-using-powershell"></a><span data-ttu-id="ee0d6-731">Steg 1: Hämta hello interna belastningsutjämnare IP för båda hello regioner med hjälp av PowerShell</span><span class="sxs-lookup"><span data-stu-id="ee0d6-731">Step 1: Get hello internal load balancer IP for both hello regions using PowerShell</span></span>
* <span data-ttu-id="ee0d6-732">Get-AzureInternalLoadbalancer - ServiceName ”hk-c-svc-Väst-oss”</span><span class="sxs-lookup"><span data-stu-id="ee0d6-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span></span>
* <span data-ttu-id="ee0d6-733">Get-AzureInternalLoadbalancer - ServiceName ”hk-c-svc-Öst-oss”</span><span class="sxs-lookup"><span data-stu-id="ee0d6-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span></span>  
  
    <span data-ttu-id="ee0d6-734">Observera hello IP-adresser (t.ex. west - 10.1.2.101, Öst - 10.2.2.101) visas.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-734">Note hello IP addresses (e.g. west - 10.1.2.101, east - 10.2.2.101) displayed.</span></span>

### <a name="step-2-execute-hello-following-in-hello-west-region-after-logging-into-hk-w1-west-us"></a><span data-ttu-id="ee0d6-735">Steg 2: Kör hello följande när du har loggat in hk-w1-Väst-oss i hello west region</span><span class="sxs-lookup"><span data-stu-id="ee0d6-735">Step 2: Execute hello following in hello west region after logging into hk-w1-west-us</span></span>
1. <span data-ttu-id="ee0d6-736">Köra $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="ee0d6-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
2. <span data-ttu-id="ee0d6-737">Kör följande CQL kommandon hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-737">Execute hello following CQL commands:</span></span>
   
     <span data-ttu-id="ee0d6-738">Skapa KEYSPACE customers_ks med replikering = {'class': 'NetworkToplogyStrategy', 'WESTUS': 3, EASTUS: 3};   ANVÄNDA customers_ks;   Skapa tabell Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Infoga i Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   Infoga i Customers(customer_id, firstname, lastname) värden (2, ”Jane', 'Berg”).   Välj * från kunder.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="ee0d6-739">Du bör se en skärm som hello en nedan:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-739">You should see a display like hello one below:</span></span>

| <span data-ttu-id="ee0d6-740">customer_id</span><span class="sxs-lookup"><span data-stu-id="ee0d6-740">customer_id</span></span> | <span data-ttu-id="ee0d6-741">Förnamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-741">firstname</span></span> | <span data-ttu-id="ee0d6-742">Efternamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-742">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ee0d6-743">1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-743">1</span></span> |<span data-ttu-id="ee0d6-744">John</span><span class="sxs-lookup"><span data-stu-id="ee0d6-744">John</span></span> |<span data-ttu-id="ee0d6-745">Berg</span><span class="sxs-lookup"><span data-stu-id="ee0d6-745">Doe</span></span> |
| <span data-ttu-id="ee0d6-746">2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-746">2</span></span> |<span data-ttu-id="ee0d6-747">Jane</span><span class="sxs-lookup"><span data-stu-id="ee0d6-747">Jane</span></span> |<span data-ttu-id="ee0d6-748">Berg</span><span class="sxs-lookup"><span data-stu-id="ee0d6-748">Doe</span></span> |

### <a name="step-3-execute-hello-following-in-hello-east-region-after-logging-into-hk-w1-east-us"></a><span data-ttu-id="ee0d6-749">Steg 3: Kör hello följande i hello Öst region när du har loggat in hk-w1-Öst-oss:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-749">Step 3: Execute hello following in hello east region after logging into hk-w1-east-us:</span></span>
1. <span data-ttu-id="ee0d6-750">Köra $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="ee0d6-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span></span>
2. <span data-ttu-id="ee0d6-751">Kör följande CQL kommandon hello:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-751">Execute hello following CQL commands:</span></span>
   
     <span data-ttu-id="ee0d6-752">ANVÄNDA customers_ks;   Skapa tabell Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Infoga i Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   Infoga i Customers(customer_id, firstname, lastname) värden (2, ”Jane', 'Berg”).   Välj * från kunder.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="ee0d6-753">Du bör se hello samma visas som visas för hello West region:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-753">You should see hello same display as seen for hello West region:</span></span>

| <span data-ttu-id="ee0d6-754">customer_id</span><span class="sxs-lookup"><span data-stu-id="ee0d6-754">customer_id</span></span> | <span data-ttu-id="ee0d6-755">Förnamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-755">firstname</span></span> | <span data-ttu-id="ee0d6-756">Efternamn</span><span class="sxs-lookup"><span data-stu-id="ee0d6-756">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ee0d6-757">1</span><span class="sxs-lookup"><span data-stu-id="ee0d6-757">1</span></span> |<span data-ttu-id="ee0d6-758">John</span><span class="sxs-lookup"><span data-stu-id="ee0d6-758">John</span></span> |<span data-ttu-id="ee0d6-759">Berg</span><span class="sxs-lookup"><span data-stu-id="ee0d6-759">Doe</span></span> |
| <span data-ttu-id="ee0d6-760">2</span><span class="sxs-lookup"><span data-stu-id="ee0d6-760">2</span></span> |<span data-ttu-id="ee0d6-761">Jane</span><span class="sxs-lookup"><span data-stu-id="ee0d6-761">Jane</span></span> |<span data-ttu-id="ee0d6-762">Berg</span><span class="sxs-lookup"><span data-stu-id="ee0d6-762">Doe</span></span> |

<span data-ttu-id="ee0d6-763">Kör några fler infogningar och finns att hämta de replikerade toowest-oss tillhör hello klustret.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-763">Execute a few more inserts and see that those get replicated toowest-us part of hello cluster.</span></span>

## <a name="test-cassandra-cluster-from-nodejs"></a><span data-ttu-id="ee0d6-764">Cassandra Testklustret från Node.js</span><span class="sxs-lookup"><span data-stu-id="ee0d6-764">Test Cassandra Cluster from Node.js</span></span>
<span data-ttu-id="ee0d6-765">Med hjälp av en av hello virtuella Linux-datorer reflektionsimportören i hello ”web” skiktet tidigare, vi ska utföra en enkel Node.js skriptet tooread hello tidigare infogas data</span><span class="sxs-lookup"><span data-stu-id="ee0d6-765">Using one of hello Linux VMs crated in hello "web" tier previously, we will execute a simple Node.js script tooread hello previously inserted data</span></span>

<span data-ttu-id="ee0d6-766">**Steg 1: Installera Node.js och Cassandra-klienten**</span><span class="sxs-lookup"><span data-stu-id="ee0d6-766">**Step 1: Install Node.js and Cassandra Client**</span></span>

1. <span data-ttu-id="ee0d6-767">Installera Node.js och npm</span><span class="sxs-lookup"><span data-stu-id="ee0d6-767">Install Node.js and npm</span></span>
2. <span data-ttu-id="ee0d6-768">Installera nod paketet ”cassandra-klient” med hjälp av npm</span><span class="sxs-lookup"><span data-stu-id="ee0d6-768">Install node package "cassandra-client" using npm</span></span>
3. <span data-ttu-id="ee0d6-769">Kör hello följande skript i Kommandotolken hello shell som visar hello json-strängen hello hämtas data:</span><span class="sxs-lookup"><span data-stu-id="ee0d6-769">Execute hello following script at hello shell prompt which displays hello json string of hello retrieved data:</span></span>
   
        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };
   
        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed toocreate Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }
   
        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed toocreate column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }
   
        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);
   
           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }
   
        //update will also insert hello record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }
   
        //read hello two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }
   
        //exectue hello code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)

## <a name="conclusion"></a><span data-ttu-id="ee0d6-770">Slutsats</span><span class="sxs-lookup"><span data-stu-id="ee0d6-770">Conclusion</span></span>
<span data-ttu-id="ee0d6-771">Microsoft Azure är en flexibel plattform som gör att hello körning av både Microsoft samt programvara med öppen källkod som visas av den här övningen.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-771">Microsoft Azure is a flexible platform that allows hello running of both Microsoft as well as open source software as demonstrated by this exercise.</span></span> <span data-ttu-id="ee0d6-772">Hög tillgänglighet Cassandra kluster kan distribueras på ett enda datacenter via hello sprida hello klusternoder över flera feldomäner.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-772">Highly available Cassandra clusters can be deployed on a single data center through hello spreading of hello cluster nodes across multiple fault domains.</span></span> <span data-ttu-id="ee0d6-773">Cassandra kluster kan också distribueras över flera Azure geografiskt avlägsna regioner för katastrofåterställning bevis system.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-773">Cassandra clusters can also be deployed across multiple geographically distant Azure regions for disaster proof systems.</span></span> <span data-ttu-id="ee0d6-774">Azure och Cassandra tillsammans aktiverar hello konstruktionen av skalbara, hög tillgänglighet och katastrofåterställning återställningsbara molntjänster behövs dagens internet skalas tjänster.</span><span class="sxs-lookup"><span data-stu-id="ee0d6-774">Azure and Cassandra together enables hello construction of highly scalable, highly available and disaster recoverable cloud services needed by today's internet scale services.</span></span>  

## <a name="references"></a><span data-ttu-id="ee0d6-775">Referenser</span><span class="sxs-lookup"><span data-stu-id="ee0d6-775">References</span></span>
* [<span data-ttu-id="ee0d6-776">http://cassandra.apache.org</span><span class="sxs-lookup"><span data-stu-id="ee0d6-776">http://cassandra.apache.org</span></span>](http://cassandra.apache.org)
* [<span data-ttu-id="ee0d6-777">http://www.datastax.com</span><span class="sxs-lookup"><span data-stu-id="ee0d6-777">http://www.datastax.com</span></span>](http://www.datastax.com)
* [<span data-ttu-id="ee0d6-778">http://www.nodejs.org</span><span class="sxs-lookup"><span data-stu-id="ee0d6-778">http://www.nodejs.org</span></span>](http://www.nodejs.org)

