---
title: "Kör Cassandra med Linux i Azure | Microsoft Docs"
description: "Hur du kör ett Cassandra kluster på Linux i Azure Virtual Machines från en Node.js-app"
services: virtual-machines-linux
documentationcenter: nodejs
author: tomarcher
manager: routlaw
editor: 
tags: azure-service-management
ms.assetid: 30de1f29-e97d-492f-ae34-41ec83488de0
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: tarcher
ms.openlocfilehash: 1ff3d77ced6c9d90029b251490c05e52d9b43515
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a><span data-ttu-id="17423-103">Kör Cassandra med Linux på Azure och få åtkomst till det från Node.js</span><span class="sxs-lookup"><span data-stu-id="17423-103">Running Cassandra with Linux on Azure and Accessing it from Node.js</span></span>
> [!IMPORTANT] 
> <span data-ttu-id="17423-104">Azure har två olika distributionsmodeller för att skapa och arbeta med resurser: [Resource Manager och klassisk](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="17423-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="17423-105">Den här artikeln täcker den klassiska distributionsmodellen.</span><span class="sxs-lookup"><span data-stu-id="17423-105">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="17423-106">Microsoft rekommenderar att de flesta nya distributioner använder Resource Manager-modellen.</span><span class="sxs-lookup"><span data-stu-id="17423-106">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="17423-107">Se Resource Manager-mallar för [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) och [Väck klustret och Cassandra på CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span><span class="sxs-lookup"><span data-stu-id="17423-107">See Resource Manager templates for [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) and [Spark cluster and Cassandra on CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span></span>

## <a name="overview"></a><span data-ttu-id="17423-108">Översikt</span><span class="sxs-lookup"><span data-stu-id="17423-108">Overview</span></span>
<span data-ttu-id="17423-109">Microsoft Azure är en öppen molnplattform som körs både Microsoft som bra som icke-Microsoft-programvara som innehåller operativsystem, programservrar, meddelanden mellanprogram såväl som SQL- och NoSQL-databaser från båda modellerna kommersiella och Öppna källa.</span><span class="sxs-lookup"><span data-stu-id="17423-109">Microsoft Azure is an open cloud platform that runs both Microsoft as well as non-Microsoft software which  includes operating systems, application servers, messaging middleware as well as SQL and NoSQL databases from both commercial and open source models.</span></span> <span data-ttu-id="17423-110">Bygga flexibel tjänster på offentliga moln, inklusive Azure kräver noggrann planering och arkitektur för avsiktlig för båda programservrarna som korrekt lagring lager.</span><span class="sxs-lookup"><span data-stu-id="17423-110">Building resilient services on public clouds including Azure requires careful planning and deliberate architecture for both applications servers as well storage layers.</span></span> <span data-ttu-id="17423-111">Cassandras distribuerade lagringsarkitektur naturligt hjälper till att skapa hög tillgänglighet system som är feltolerant för klustret.</span><span class="sxs-lookup"><span data-stu-id="17423-111">Cassandra’s distributed storage architecture naturally helps in building highly available systems that are fault tolerant for cluster failures.</span></span> <span data-ttu-id="17423-112">Cassandra är molnskala NoSQL-databas som underhålls av Apache Software Foundation på cassandra.apache.org; Cassandra är skriven i Java och därför körs på både på Windows och Linux plattformar.</span><span class="sxs-lookup"><span data-stu-id="17423-112">Cassandra is a cloud scale NoSQL database maintained by Apache Software Foundation at cassandra.apache.org; Cassandra is written in Java and hence runs on both on Windows as well as Linux platforms.</span></span>

<span data-ttu-id="17423-113">Den här artikeln fokuserar på att visa Cassandra distribution på Ubuntu som ett enstaka och flera Datacenter-kluster som utnyttjar Microsoft Azure virtuella datorer och virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="17423-113">The focus of this article is to show Cassandra deployment on Ubuntu as a single and multi-data center cluster leveraging Microsoft Azure Virtual Machines and Virtual Networks.</span></span> <span data-ttu-id="17423-114">Kluster-distributionen för produktionsarbetsbelastningar optimerade ligger utanför omfånget för den här artikeln eftersom den kräver flera disk nodkonfiguration, lämpliga ring topologi utformning och datamodeller för att stödja nödvändiga replikering, datakonsekvens, genomflöde och hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="17423-114">The cluster deployment for production optimized workloads is out of scope of this article as it requires multi-disk node configuration, appropriate ring topology design and data modeling to support the needed replication, data consistency, throughput and high availability requirements.</span></span>

<span data-ttu-id="17423-115">Den här artikeln tar en grundläggande metod för att visa vad ingår i att skapa klustret Cassandra jämfört med Docker, Chef eller Puppet, vilket kan göra distribution av infrastruktur som är mycket enklare.</span><span class="sxs-lookup"><span data-stu-id="17423-115">This article takes a fundamental approach to show what is involved in building the Cassandra cluster compared Docker, Chef or Puppet which can make the infrastructure deployment a lot easier.</span></span>  

## <a name="the-deployment-models"></a><span data-ttu-id="17423-116">Distributionsmodellerna</span><span class="sxs-lookup"><span data-stu-id="17423-116">The Deployment Models</span></span>
<span data-ttu-id="17423-117">Microsoft Azure-nätverk kan distributionen av isolerat privat kluster åtkomst som kan vara begränsad till uppnå detaljerade nätverkssäkerhet.</span><span class="sxs-lookup"><span data-stu-id="17423-117">Microsoft Azure networking allows the deployment of isolated private clusters, the access of which can be restricted to attain fine grained network security.</span></span>  <span data-ttu-id="17423-118">Eftersom den här artikeln om hur du visar Cassandra distribution på en grundläggande nivå kan fokuserar vi inte på nivån konsekvens och optimala lagringsdesignen för genomströmning.</span><span class="sxs-lookup"><span data-stu-id="17423-118">Since this article is about showing the Cassandra deployment at a fundamental level, we will not focus on the consistency level and the optimal storage design for throughput.</span></span> <span data-ttu-id="17423-119">Här är listan över nätverkskraven för vår hypotetiska klustret:</span><span class="sxs-lookup"><span data-stu-id="17423-119">Here is the list of networking requirements for our hypothetical cluster:</span></span>

* <span data-ttu-id="17423-120">Externa system kan inte komma åt Cassandra databasen från inom eller utanför Azure</span><span class="sxs-lookup"><span data-stu-id="17423-120">External systems can’t access Cassandra database from within or outside Azure</span></span>
* <span data-ttu-id="17423-121">Cassandra klustret måste vara bakom en belastningsutjämnare för thrift-trafik</span><span class="sxs-lookup"><span data-stu-id="17423-121">Cassandra cluster has to be behind a load balancer for thrift traffic</span></span>
* <span data-ttu-id="17423-122">Distribuera Cassandra noder i två grupper i varje Datacenter för en förbättrad klustret</span><span class="sxs-lookup"><span data-stu-id="17423-122">Deploy Cassandra nodes in two groups in each data center for an enhanced cluster availability</span></span>
* <span data-ttu-id="17423-123">Låsa klustret så som endast programmet servergruppen har åtkomst till databasen direkt</span><span class="sxs-lookup"><span data-stu-id="17423-123">Lock down the cluster so that only application server farm has access to the database directly</span></span>
* <span data-ttu-id="17423-124">Inga offentliga nätverk slutpunkter än SSH</span><span class="sxs-lookup"><span data-stu-id="17423-124">No public networking endpoints other than SSH</span></span>
* <span data-ttu-id="17423-125">Varje Cassandra nod måste en fast interna IP-adress</span><span class="sxs-lookup"><span data-stu-id="17423-125">Each Cassandra node needs a fixed internal IP address</span></span>

<span data-ttu-id="17423-126">Cassandra kan distribueras till en enda Azure region eller till flera regioner baserat på distribuerade uppbyggnad arbetsbelastningen.</span><span class="sxs-lookup"><span data-stu-id="17423-126">Cassandra can be deployed to a single Azure region or to multiple regions based on the distributed nature of the workload.</span></span> <span data-ttu-id="17423-127">Distributionsmodell för flera regioner kan utnyttjas för att hantera användare närmare till en viss geografisk plats via samma Cassandra infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="17423-127">Multi-region deployment model can be leveraged to serve end users closer to a particular geography through the same Cassandra infrastructure.</span></span> <span data-ttu-id="17423-128">Cassandras inbyggda nod replikering tar hand om synkronisering av flera master skriver härstammar från flera datacenter och anger en konsekvent bild av data till program.</span><span class="sxs-lookup"><span data-stu-id="17423-128">Cassandra’s built-in node replication takes care of the synchronization of multi-master writes originating from multiple data centers and presents a consistent view of the data to applications.</span></span> <span data-ttu-id="17423-129">Distribution av flera regioner kan också med riskhanteringen av de bredare avbrott i Azure-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="17423-129">Multi-region deployment can also help with the risk mitigation of the broader Azure service outages.</span></span> <span data-ttu-id="17423-130">Cassandras justerbara konsekvens och replikeringstopologin hjälper att uppfylla olika Återställningspunktmål behov av program.</span><span class="sxs-lookup"><span data-stu-id="17423-130">Cassandra’s tunable consistency and replication topology will help in meeting diverse RPO needs of applications.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="17423-131">Distribution av enskild Region</span><span class="sxs-lookup"><span data-stu-id="17423-131">Single Region Deployment</span></span>
<span data-ttu-id="17423-132">Vi börjar med en enskild region-distribution och inhämta learnings att skapa en modell för flera regioner.</span><span class="sxs-lookup"><span data-stu-id="17423-132">We will start with a single region deployment and harvest the learnings in creating a multi-region model.</span></span> <span data-ttu-id="17423-133">Azure virtuella nätverk används för att skapa isolerade undernät så att nätverkssäkerhetskrav som nämns ovan kan uppfyllas.</span><span class="sxs-lookup"><span data-stu-id="17423-133">Azure virtual networking will be used to create isolated subnets so that the network security requirements mentioned above can be met.</span></span>  <span data-ttu-id="17423-134">Processen som beskrivs i samma region distributionen skapas använder Ubuntu 14.04 LTS och Cassandra 2.08; processen kan enkelt antas till andra varianter av Linux.</span><span class="sxs-lookup"><span data-stu-id="17423-134">The process described in creating the single region deployment uses Ubuntu 14.04 LTS and Cassandra 2.08; however, the process can easily be adopted to the other Linux variants.</span></span> <span data-ttu-id="17423-135">Följande är några av de systemfel egenskaperna för distribution av enskild region.</span><span class="sxs-lookup"><span data-stu-id="17423-135">The following are some of the systemic characteristics of the single region deployment.</span></span>  

<span data-ttu-id="17423-136">**Hög tillgänglighet:** Cassandra noderna visas i bild 1 har distribuerats till två tillgänglighetsuppsättningar så att noderna sprids mellan flera feldomäner för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="17423-136">**High Availability:** The Cassandra nodes shown in the Figure 1 are deployed to two availability sets so that the nodes are spread between multiple fault domains for high availability.</span></span> <span data-ttu-id="17423-137">Virtuella datorer med varje tillgänglighetsuppsättning är mappad till 2 feldomäner.</span><span class="sxs-lookup"><span data-stu-id="17423-137">VMs annotated with each availability set is mapped to 2 fault domains.</span></span>  <span data-ttu-id="17423-138">Microsoft Azure använder begreppet feldomän att hantera oplanerad ned samtidigt (t.ex. maskinvara eller programvara misslyckanden) begreppet uppgraderingsdomänen (t.ex. värd eller OS-korrigering/uppgraderingar, programuppgraderingar) används för att hantera schemalagda stillestånd.</span><span class="sxs-lookup"><span data-stu-id="17423-138">Microsoft Azure uses the concept of fault domain to manage unplanned down time (e.g. hardware or software failures) while the concept of upgrade domain (e.g. host or guest OS patching/upgrades, application upgrades) is used for managing scheduled down time.</span></span> <span data-ttu-id="17423-139">Se [katastrofåterställning och hög tillgänglighet för Azure-program](http://msdn.microsoft.com/library/dn251004.aspx) för fel- och domäner för att uppnå hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="17423-139">Please see [Disaster Recovery and High Availability for Azure Applications](http://msdn.microsoft.com/library/dn251004.aspx) for the role of fault and upgrade domains in attaining high availability.</span></span>

![Distribution av enskild region](./media/cassandra-nodejs/cassandra-linux1.png)

<span data-ttu-id="17423-141">Figur 1: Distribution av enskild region</span><span class="sxs-lookup"><span data-stu-id="17423-141">Figure 1: Single region deployment</span></span>

<span data-ttu-id="17423-142">Observera att när detta skrivs Azure tillåter inte att explicit mappningen för en grupp med virtuella datorer till en specifik feldomän; även om den distributionsmodell som illustreras i bild 1, är det därför statistiskt troligt att de virtuella datorerna kan mappas till två feldomäner i stället för fyra.</span><span class="sxs-lookup"><span data-stu-id="17423-142">Note that at the time of this writing, Azure doesn’t allow the explicit mapping of a group of VMs to a specific fault domain; consequently, even with the deployment model shown in Figure 1, it is statistically probable that all the virtual machines may be mapped to two fault domains instead of four.</span></span>

<span data-ttu-id="17423-143">**Belastningsutjämna belastningsutjämning Thrift trafik:** Thrift klientbibliotek inuti webbservern ansluta till klustret via en intern belastningsutjämnare.</span><span class="sxs-lookup"><span data-stu-id="17423-143">**Load Balancing Thrift Traffic:** Thrift client libraries inside the web server connect to the cluster through an internal load balancer.</span></span> <span data-ttu-id="17423-144">Detta kräver att processen att lägga till den interna belastningsutjämnaren ”data-undernätet (se bild 1) i samband med Molntjänsten värd Cassandra klustret.</span><span class="sxs-lookup"><span data-stu-id="17423-144">This requires the process of adding the internal load balancer to the “data” subnet (refer Figure 1) in the context of the cloud service hosting the Cassandra cluster.</span></span> <span data-ttu-id="17423-145">När den interna belastningsutjämnaren har definierats, kräver varje nod belastningsutjämnade-slutpunkt som ska läggas till med anteckningar av en belastningsutjämnad uppsättning med tidigare definierad belastningsutjämnarens namn.</span><span class="sxs-lookup"><span data-stu-id="17423-145">Once the internal load balancer is defined, each node requires the load balanced endpoint to be added with the annotations of a load balanced set with previously defined load balancer name.</span></span> <span data-ttu-id="17423-146">Se [Azure intern belastningsutjämning ](../../../load-balancer/load-balancer-internal-overview.md)för mer information.</span><span class="sxs-lookup"><span data-stu-id="17423-146">See [Azure Internal Load Balancing ](../../../load-balancer/load-balancer-internal-overview.md)for more details.</span></span>

<span data-ttu-id="17423-147">**Klustret frö:** är det viktigt att välja de flesta högtillgänglig noderna för frö när nya noder kommunicerar med seed nod för att identifiera topologin för klustret.</span><span class="sxs-lookup"><span data-stu-id="17423-147">**Cluster Seeds:** It is important to select the most highly available nodes for seeds as the new nodes will communicate with seed nodes to discover the topology of the cluster.</span></span> <span data-ttu-id="17423-148">En nod från varje tillgänglighetsuppsättning betecknas som seed noder för att undvika enskild felpunkt.</span><span class="sxs-lookup"><span data-stu-id="17423-148">One node from each availability set is designated as seed nodes to avoid single point of failure.</span></span>

<span data-ttu-id="17423-149">**Replikering faktor och konsekvensnivå:** Cassandras inbyggda hög tillgänglighet och data hållbarhet kännetecknas av replikering faktor (RF - antal kopior av varje rad som lagras på klustret) och konsekvensnivå (antal replikerna att läsa/skriva innan resultatet returneras till anroparen).</span><span class="sxs-lookup"><span data-stu-id="17423-149">**Replication Factor and Consistency Level:** Cassandra’s build-in high-availability and data durability is characterized by the Replication Factor (RF - number of copies of each row stored on the cluster) and Consistency Level (number of replicas to be read/written before returning the result to the caller).</span></span> <span data-ttu-id="17423-150">Replikering faktor anges under genereringen KEYSPACE (liknar en relationsdatabas) medan konsekvensnivå anges vid utfärdande CRUD-frågan.</span><span class="sxs-lookup"><span data-stu-id="17423-150">Replication factor is specified during the KEYSPACE (similar to a relational database) creation whereas the consistency level is specified while issuing the CRUD query.</span></span> <span data-ttu-id="17423-151">Se Cassandra dokumentation på [konfigurera konsekvent](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) konsekvenskontroll information och formel för beräkning av kvorum.</span><span class="sxs-lookup"><span data-stu-id="17423-151">See Cassandra documentation at [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) for consistency details and the formula for quorum computation.</span></span>

<span data-ttu-id="17423-152">Cassandra stöder två typer av integritet datamodeller – konsekvens och slutliga konsekvensen; Replikering faktor och konsekvensnivå avgör tillsammans om data blir konsekvent som en skrivåtgärd är klar eller att det blir överensstämmelse.</span><span class="sxs-lookup"><span data-stu-id="17423-152">Cassandra supports two types of data integrity models – Consistency and Eventual Consistency; the Replication Factor and Consistency Level will together determine if the data will be consistent as soon as a write operation is complete or it will be eventually consistent.</span></span> <span data-ttu-id="17423-153">Till exempel ange KVORUM som nivån konsekvenskontroll kommer alltid garanterar data konsekvenskontroll när alla konsekvensnivå, nedan antal repliker som ska skrivas efter behov för att uppnå KVORUM (t.ex. en) resulterar i att överensstämmelse data.</span><span class="sxs-lookup"><span data-stu-id="17423-153">For example, specifying QUORUM as the Consistency Level will always ensures data Consistency while any consistency level, below the number of replicas to be written as needed to attain QUORUM (e.g. ONE) results in data being eventually consistent.</span></span>

<span data-ttu-id="17423-154">8 noder klustret ovan med en faktor för replikering på 3 och KVORUM (2 noder läsas eller skrivas konsekvent) läsning och skrivning konsekvensnivå, kan överleva teoretisk förlust av högst 1 nod per replikeringsgrupp innan programmet startas meddela den ett fel uppstod.</span><span class="sxs-lookup"><span data-stu-id="17423-154">The 8-node cluster shown above, with a replication factor of 3 and QUORUM (2 nodes are read or written for consistency) read/write consistency level, can survive the theoretical loss of at the most 1 node per replication group before the application start noticing the failure.</span></span> <span data-ttu-id="17423-155">Detta förutsätter att alla nyckel blanksteg väl har belastningsutjämnade läsning och skrivning begäranden.</span><span class="sxs-lookup"><span data-stu-id="17423-155">This assumes that all the key spaces have well balanced read/write requests.</span></span>  <span data-ttu-id="17423-156">Följande är de parametrar som vi ska använda för distribuerade klustret:</span><span class="sxs-lookup"><span data-stu-id="17423-156">The following are the parameters we will use for the deployed cluster:</span></span>

<span data-ttu-id="17423-157">Enskild region Cassandra klusterkonfiguration:</span><span class="sxs-lookup"><span data-stu-id="17423-157">Single region Cassandra cluster configuration:</span></span>

| <span data-ttu-id="17423-158">Kluster-Parameter</span><span class="sxs-lookup"><span data-stu-id="17423-158">Cluster Parameter</span></span> | <span data-ttu-id="17423-159">Värde</span><span class="sxs-lookup"><span data-stu-id="17423-159">Value</span></span> | <span data-ttu-id="17423-160">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-160">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="17423-161">Antalet noder (N)</span><span class="sxs-lookup"><span data-stu-id="17423-161">Number of Nodes (N)</span></span> |<span data-ttu-id="17423-162">8</span><span class="sxs-lookup"><span data-stu-id="17423-162">8</span></span> |<span data-ttu-id="17423-163">Totalt antal noder i klustret</span><span class="sxs-lookup"><span data-stu-id="17423-163">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="17423-164">Replikering faktor (RF)</span><span class="sxs-lookup"><span data-stu-id="17423-164">Replication Factor (RF)</span></span> |<span data-ttu-id="17423-165">3</span><span class="sxs-lookup"><span data-stu-id="17423-165">3</span></span> |<span data-ttu-id="17423-166">Antal repliker på en viss rad</span><span class="sxs-lookup"><span data-stu-id="17423-166">Number of replicas of a given row</span></span> |
| <span data-ttu-id="17423-167">Konsekvensnivå (skriva)</span><span class="sxs-lookup"><span data-stu-id="17423-167">Consistency Level (Write)</span></span> |<span data-ttu-id="17423-168">QUORUM[(RF/2) +1) = 2] är resultatet av formeln avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="17423-168">QUORUM[(RF/2) +1) = 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="17423-169">Skriver högst 2 repliker innan svaret skickas till anroparens 3 replik är skriven i ett överensstämmelse sätt.</span><span class="sxs-lookup"><span data-stu-id="17423-169">Writes at the most 2 replicas before the response is sent to the caller; 3rd replica is written in an eventually consistent manner.</span></span> |
| <span data-ttu-id="17423-170">Konsekvensnivå (läsa)</span><span class="sxs-lookup"><span data-stu-id="17423-170">Consistency Level (Read)</span></span> |<span data-ttu-id="17423-171">KVORUM [(RF/2) + 1 = 2] resultatet av formeln avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="17423-171">QUORUM [(RF/2) +1= 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="17423-172">Läser 2 repliker innan du skickar svar till anroparen.</span><span class="sxs-lookup"><span data-stu-id="17423-172">Reads 2 replicas before sending response to the caller.</span></span> |
| <span data-ttu-id="17423-173">Replikeringsstrategi</span><span class="sxs-lookup"><span data-stu-id="17423-173">Replication Strategy</span></span> |<span data-ttu-id="17423-174">NetworkTopologyStrategy Se [datareplikering](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="17423-174">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="17423-175">Förstår topologi för distribution och placerar repliker på noder så att alla repliker inte slutar på samma rack.</span><span class="sxs-lookup"><span data-stu-id="17423-175">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="17423-176">Snitch</span><span class="sxs-lookup"><span data-stu-id="17423-176">Snitch</span></span> |<span data-ttu-id="17423-177">GossipingPropertyFileSnitch Se [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="17423-177">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="17423-178">NetworkTopologyStrategy använder ett koncept för snitch för att förstå topologin.</span><span class="sxs-lookup"><span data-stu-id="17423-178">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="17423-179">GossipingPropertyFileSnitch ger bättre kontroll i varje nod att mappa till datacenter och rack.</span><span class="sxs-lookup"><span data-stu-id="17423-179">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="17423-180">Klustret använder sedan ett för att sprida informationen.</span><span class="sxs-lookup"><span data-stu-id="17423-180">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="17423-181">Detta är mycket enklare i dynamisk IP-inställningen i förhållande till PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="17423-181">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

<span data-ttu-id="17423-182">**Azure överväganden för Cassandra kluster:** kapaciteten för Microsoft Azure-datorer använder Azure Blob storage för disk; Azure Storage sparar 3 repliker för varje disk för hög hållbarhet.</span><span class="sxs-lookup"><span data-stu-id="17423-182">**Azure Considerations for Cassandra Cluster:** Microsoft Azure Virtual Machines capability uses Azure Blob storage for disk persistence; Azure Storage saves 3 replicas of each disk for high durability.</span></span> <span data-ttu-id="17423-183">Det innebär att varje rad med data som infogas i en tabell med Cassandra lagras redan i 3 repliker och därför datakonsekvens är redan tagit hand om även om replikering faktor (RF) är 1.</span><span class="sxs-lookup"><span data-stu-id="17423-183">That means each row of data inserted into a Cassandra table is already stored in 3 replicas and hence data consistency is already taken care of even if the Replication Factor (RF) is 1.</span></span> <span data-ttu-id="17423-184">Det huvudsakliga problemet med replikering faktor 1 är att programmet får driftstopp, även om en enskild nod Cassandra misslyckas.</span><span class="sxs-lookup"><span data-stu-id="17423-184">The main problem with Replication Factor being 1 is that the application will experience downtime even if a single Cassandra node fails.</span></span> <span data-ttu-id="17423-185">Om en nod avser problem (t.ex. maskinvara, programvara systemfel) som identifieras av Azure-Infrastrukturkontrollanten, kommer den etablera en ny nod i stället använda samma lagringsenheter.</span><span class="sxs-lookup"><span data-stu-id="17423-185">However, if a node is down for the problems (e.g. hardware, system software failures) recognized by Azure Fabric Controller, it will provision a new node in its place using the same storage drives.</span></span> <span data-ttu-id="17423-186">Etablera en ny nod för att ersätta det gamla kan ta några minuter.</span><span class="sxs-lookup"><span data-stu-id="17423-186">Provisioning a new node to replace the old one may take a few minutes.</span></span>  <span data-ttu-id="17423-187">På samma sätt för planerat underhållsaktiviteter som gäst-OS ändringar Cassandra uppgraderar och ändringar i programmet Azure-Infrastrukturkontrollanten utför rullande uppgraderingar av noderna i klustret.</span><span class="sxs-lookup"><span data-stu-id="17423-187">Similarly for planned maintenance activities like guest OS changes, Cassandra upgrades and application changes Azure Fabric Controller performs rolling upgrades of the nodes in the cluster.</span></span>  <span data-ttu-id="17423-188">Även rullande uppgraderingar kan ta bort några noder samtidigt och därför klustret kan ha kort driftstopp för några partitioner.</span><span class="sxs-lookup"><span data-stu-id="17423-188">Rolling upgrades also may take down a few nodes at a time and hence the cluster may experience brief downtime for a few partitions.</span></span> <span data-ttu-id="17423-189">Dock går data inte förlorade på grund av den inbyggda Azure Storage-redundansen.</span><span class="sxs-lookup"><span data-stu-id="17423-189">However, the data will not be lost due to the built-in Azure Storage redundancy.</span></span>  

<span data-ttu-id="17423-190">För datorer som distribueras till Azure som inte kräver hög tillgänglighet (t.ex. runt 99,9 som motsvarar 8.76 timmar per år, se [hög tillgänglighet](http://en.wikipedia.org/wiki/High_availability) information) du kan köra med RF = 1 och konsekvensnivå = en.</span><span class="sxs-lookup"><span data-stu-id="17423-190">For systems deployed to Azure that doesn’t require high availability (e.g. around 99.9 which is equivalent to 8.76 hrs/year; see [High Availability](http://en.wikipedia.org/wiki/High_availability) for details) you may be able to run with RF=1 and Consistency Level=ONE.</span></span>  <span data-ttu-id="17423-191">För program med hög tillgänglighet, RF = 3 och konsekvensnivå = KVORUM tolererar nertid av en av noderna och en av replikerna.</span><span class="sxs-lookup"><span data-stu-id="17423-191">For applications with high availability requirements, RF=3 and Consistency Level=QUORUM will tolerate the down time of one of the nodes one of the replicas.</span></span> <span data-ttu-id="17423-192">RF = 1 i traditionella distributioner (t.ex. på plats) kan inte användas på grund av att det uppstår problem angående diskfel förlust av data.</span><span class="sxs-lookup"><span data-stu-id="17423-192">RF=1 in traditional deployments (e.g. on-premises) can’t be used due to the possible data loss resulting from problems like disk failures.</span></span>   

## <a name="multi-region-deployment"></a><span data-ttu-id="17423-193">Distribution av flera regioner</span><span class="sxs-lookup"><span data-stu-id="17423-193">Multi-region Deployment</span></span>
<span data-ttu-id="17423-194">Cassandra's data-center-medveten replikering och konsekvent modell ovan hjälper dig med distributionen av flera regioner direkt utan att behöva några externa verktygsuppsättning.</span><span class="sxs-lookup"><span data-stu-id="17423-194">Cassandra’s data-center-aware replication and consistency model described above helps with the multi-region deployment out of the box without the need for any external tooling.</span></span> <span data-ttu-id="17423-195">Detta är ganska olika från traditionella relationsdatabaser där installationsprogrammet för databasspegling för multimaster skrivningar kan vara ganska komplicerat.</span><span class="sxs-lookup"><span data-stu-id="17423-195">This is quite different from the traditional relational databases where the setup for database mirroring for multi-master writes can be quite complex.</span></span> <span data-ttu-id="17423-196">Cassandra i en flera region konfigurera kan hjälpa dig med Användningsscenarier inklusive följande:</span><span class="sxs-lookup"><span data-stu-id="17423-196">Cassandra in a multi-region set up can help with the usage scenarios including the following:</span></span>

<span data-ttu-id="17423-197">**Närhet baserat distribution:** program med flera klienter, med Rensa koppling av användare för klient-till-region, kan vara fått av flera regioner klustrets låg latens.</span><span class="sxs-lookup"><span data-stu-id="17423-197">**Proximity based deployment:** Multi-tenant applications, with clear mapping of tenant users -to-region, can be benefited by the multi-region cluster’s low latencies.</span></span> <span data-ttu-id="17423-198">Till exempel en learning management system för utbildningssyfte kan distribuera ett kluster som är distribuerade i östra USA och västra USA ska fungera respektive universitet för transaktionell samt analytics.</span><span class="sxs-lookup"><span data-stu-id="17423-198">For example a learning management systems for educational institutions can deploy a distributed cluster in East US and West US regions to serve the respective campuses for transactional as well as analytics.</span></span> <span data-ttu-id="17423-199">Data kan vara lokalt konsekvent vid den tiden läsningar och skrivningar och kan vara överensstämmelse mellan de båda regionerna.</span><span class="sxs-lookup"><span data-stu-id="17423-199">The data can be locally consistent at the time reads and writes and can be eventually consistent across both the regions.</span></span> <span data-ttu-id="17423-200">Det finns andra exempel som Mediedistribution, e-handel och något och allt som fungerar geo koncentrerad användaren grundläggande är ett bra användningsfall för denna distributionsmodell.</span><span class="sxs-lookup"><span data-stu-id="17423-200">There are other examples like media distribution, e-commerce and anything and everything that serves geo concentrated user base is a good use case for this deployment model.</span></span>

<span data-ttu-id="17423-201">**Hög tillgänglighet:** redundans är en nyckelfaktor för att uppnå hög tillgänglighet av programvara och maskinvara, se Skapa tillförlitliga Molnsystem på Microsoft Azure för ytterligare information.</span><span class="sxs-lookup"><span data-stu-id="17423-201">**High Availability:** Redundancy is a key factor in attaining high availability of software and hardware; see Building Reliable Cloud Systems on Microsoft Azure for details.</span></span> <span data-ttu-id="17423-202">På Microsoft Azure är endast tillförlitligt sätt att uppnå true redundans genom att distribuera ett kluster med flera regioner.</span><span class="sxs-lookup"><span data-stu-id="17423-202">On Microsoft Azure, the only reliable way of achieving true redundancy is by deploying a multi-region cluster.</span></span> <span data-ttu-id="17423-203">Program kan distribueras i en aktiv-aktiv eller aktivt-passivt läge och om någon av regionerna är nere kan Azure Traffic Manager kan omdirigera trafik till den aktiva regionen.</span><span class="sxs-lookup"><span data-stu-id="17423-203">Applications can be deployed in an active-active or active-passive mode and if one of the regions is down, Azure Traffic Manager can redirect traffic to the active region.</span></span>  <span data-ttu-id="17423-204">Med enskild region-distributionen om tillgängligheten är 99,9, en två-region-distribution kan uppnå tillgänglighet 99.9999 beräknas genom följande formel: (1-(1-0.999) * (1-0,999)) * 100); finns i ovanstående information.</span><span class="sxs-lookup"><span data-stu-id="17423-204">With the single region deployment, if the availability is 99.9, a two-region deployment can attain an availability of 99.9999 computed by the formula: (1-(1-0.999) * (1-0.999))*100); see the above paper for details.</span></span>

<span data-ttu-id="17423-205">**Katastrofåterställning:** flera regioner Cassandra klustret om korrekt utformad klarar oåterkalleligt data center avbrott.</span><span class="sxs-lookup"><span data-stu-id="17423-205">**Disaster Recovery:** Multi-region Cassandra cluster, if properly designed, can withstand catastrophic data center outages.</span></span> <span data-ttu-id="17423-206">Om en region är nere, starta program som distribueras till andra regioner betjänar slutanvändarna.</span><span class="sxs-lookup"><span data-stu-id="17423-206">If one region is down, the application deployed to other regions can start serving the end users.</span></span> <span data-ttu-id="17423-207">Programmet måste vara feltoleranta för dataförluster uppstår till följd av data i pipeline för asynkron som alla andra business continuity implementeringar.</span><span class="sxs-lookup"><span data-stu-id="17423-207">Like any other business continuity implementations, the application has to be tolerant for some data loss resulting from the data in the asynchronous pipeline.</span></span> <span data-ttu-id="17423-208">Dock gör Cassandra återställningen mycket snabbare än den tid som traditionella processer.</span><span class="sxs-lookup"><span data-stu-id="17423-208">However, Cassandra makes the recovery much swifter than the time taken by traditional database recovery processes.</span></span> <span data-ttu-id="17423-209">Bild 2 visar en typisk distribution i flera regioner modellen med åtta noder i varje region.</span><span class="sxs-lookup"><span data-stu-id="17423-209">Figure 2 shows the typical multi-region deployment model with eight nodes in each region.</span></span> <span data-ttu-id="17423-210">Båda regioner är speglade bilder från varandra för samma symmetriplan; Verkligt Designer beror på Arbetsbelastningstyp (t.ex. transaktionell eller analytiska), Återställningspunktsmål, RTO, datakonsekvens och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="17423-210">Both regions are mirror images of each other for the same of symmetry; real world designs depend on the workload type (e.g. transactional or analytical), RPO, RTO, data consistency and availability requirements.</span></span>

![Distribution av flera region](./media/cassandra-nodejs/cassandra-linux2.png)

<span data-ttu-id="17423-212">Figur 2: Distribution av flera regioner Cassandra</span><span class="sxs-lookup"><span data-stu-id="17423-212">Figure 2: Multi-region Cassandra deployment</span></span>

### <a name="network-integration"></a><span data-ttu-id="17423-213">Integrering av nätverk</span><span class="sxs-lookup"><span data-stu-id="17423-213">Network Integration</span></span>
<span data-ttu-id="17423-214">Uppsättningar av virtuella datorer distribueras på privata nätverk som finns på områdena kommunicerar med varandra med hjälp av en VPN-tunnel.</span><span class="sxs-lookup"><span data-stu-id="17423-214">Sets of virtual machines deployed to private networks located on two regions communicates with each other using a VPN tunnel.</span></span> <span data-ttu-id="17423-215">VPN-tunnel ansluter två programvara gateways etablerats under distribueringen av nätverket.</span><span class="sxs-lookup"><span data-stu-id="17423-215">The VPN tunnel connects two software gateways provisioned during the network deployment process.</span></span> <span data-ttu-id="17423-216">Båda områden har liknande nätverksarkitektur vad gäller ”web” och ”data” undernät; Azure-nätverk kan skapa så många undernät efter behov och tillämpas ACL: er som krävs av nätverkssäkerhet.</span><span class="sxs-lookup"><span data-stu-id="17423-216">Both regions have similar network architecture in terms of “web” and “data” subnets; Azure networking allows the creation of as many subnets as needed and apply ACLs as needed by network security.</span></span> <span data-ttu-id="17423-217">Vid utformning av klustertopologi bland måste data center svarstiden för kommunikationen och ekonomiska av nätverkstrafiken beaktas.</span><span class="sxs-lookup"><span data-stu-id="17423-217">While designing the cluster topology inter data center communication latency and the economic impact of the network traffic need to be considered.</span></span>

### <a name="data-consistency-for-multi-data-center-deployment"></a><span data-ttu-id="17423-218">Datakonsekvens för distribution av flera Datacenter</span><span class="sxs-lookup"><span data-stu-id="17423-218">Data Consistency for Multi-Data Center Deployment</span></span>
<span data-ttu-id="17423-219">Distribuerad distributioner måste vara medveten om klustret topologi påverkan på genomflöde och hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="17423-219">Distributed deployments need to be aware of the cluster topology impact on throughput and high availability.</span></span> <span data-ttu-id="17423-220">RF och konsekvensnivå måste väljas så att kvorum inte beroende av tillgängligheten för alla datacenter.</span><span class="sxs-lookup"><span data-stu-id="17423-220">The RF and Consistency Level need to be selected in such way that the quorum doesn’t depend on the availability of all the data centers.</span></span>
<span data-ttu-id="17423-221">För ett system som kräver hög konsekvens, kontrollerar en LOCAL_QUORUM för konsekvensnivå (för läsning och skrivning) att att lokala läsningar och skrivningar uppfylls från lokala noder medan data replikeras asynkront till fjärr-datacenter.</span><span class="sxs-lookup"><span data-stu-id="17423-221">For a system that needs high consistency, a LOCAL_QUORUM for consistency level (for reads and writes) will make sure that the local reads and writes are satisfied from the local nodes while data is replicated asynchronously to the remote data centers.</span></span>  <span data-ttu-id="17423-222">Tabell 2 sammanfattar konfigurationsinformation för flera regioner klustret beskrivs senare i skrivning upp.</span><span class="sxs-lookup"><span data-stu-id="17423-222">Table 2 summarizes the configuration details for the multi-region cluster outlined later in the write up.</span></span>

<span data-ttu-id="17423-223">**Två region Cassandra klusterkonfigurationen**</span><span class="sxs-lookup"><span data-stu-id="17423-223">**Two-region Cassandra cluster configuration**</span></span>

| <span data-ttu-id="17423-224">Kluster-Parameter</span><span class="sxs-lookup"><span data-stu-id="17423-224">Cluster Parameter</span></span> | <span data-ttu-id="17423-225">Värde</span><span class="sxs-lookup"><span data-stu-id="17423-225">Value</span></span> | <span data-ttu-id="17423-226">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-226">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="17423-227">Antalet noder (N)</span><span class="sxs-lookup"><span data-stu-id="17423-227">Number of Nodes (N)</span></span> |<span data-ttu-id="17423-228">8 + 8</span><span class="sxs-lookup"><span data-stu-id="17423-228">8 + 8</span></span> |<span data-ttu-id="17423-229">Totalt antal noder i klustret</span><span class="sxs-lookup"><span data-stu-id="17423-229">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="17423-230">Replikering faktor (RF)</span><span class="sxs-lookup"><span data-stu-id="17423-230">Replication Factor (RF)</span></span> |<span data-ttu-id="17423-231">3</span><span class="sxs-lookup"><span data-stu-id="17423-231">3</span></span> |<span data-ttu-id="17423-232">Antal repliker på en viss rad</span><span class="sxs-lookup"><span data-stu-id="17423-232">Number of replicas of a given row</span></span> |
| <span data-ttu-id="17423-233">Konsekvensnivå (skriva)</span><span class="sxs-lookup"><span data-stu-id="17423-233">Consistency Level (Write)</span></span> |<span data-ttu-id="17423-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] resultatet av formeln avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="17423-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] The result of the formula is rounded down</span></span> |<span data-ttu-id="17423-235">2 noder ska skrivas till första datacentret synkront; ytterligare 2 noder som behövs för kvorum skrivs asynkront till 2 datacentret.</span><span class="sxs-lookup"><span data-stu-id="17423-235">2 nodes will be written to the first data center synchronously; the additional 2 nodes needed for quorum will be written asynchronously to the 2nd data center.</span></span> |
| <span data-ttu-id="17423-236">Konsekvensnivå (läsa)</span><span class="sxs-lookup"><span data-stu-id="17423-236">Consistency Level (Read)</span></span> |<span data-ttu-id="17423-237">LOCAL_QUORUM ((RF/2) + 1) = 2 resultatet av formeln avrundas nedåt</span><span class="sxs-lookup"><span data-stu-id="17423-237">LOCAL_QUORUM ((RF/2) +1) = 2 The result of the formula is rounded down</span></span> |<span data-ttu-id="17423-238">Läs begäranden uppfylls från en enda region. 2 noder är skrivskyddade innan svaret skickas tillbaka till klienten.</span><span class="sxs-lookup"><span data-stu-id="17423-238">Read requests are satisfied from only one region; 2 nodes are read before the response is sent back to the client.</span></span> |
| <span data-ttu-id="17423-239">Replikeringsstrategi</span><span class="sxs-lookup"><span data-stu-id="17423-239">Replication Strategy</span></span> |<span data-ttu-id="17423-240">NetworkTopologyStrategy Se [datareplikering](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="17423-240">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="17423-241">Förstår topologi för distribution och placerar repliker på noder så att alla repliker inte slutar på samma rack.</span><span class="sxs-lookup"><span data-stu-id="17423-241">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="17423-242">Snitch</span><span class="sxs-lookup"><span data-stu-id="17423-242">Snitch</span></span> |<span data-ttu-id="17423-243">GossipingPropertyFileSnitch Se [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) i Cassandra dokumentationen för mer information</span><span class="sxs-lookup"><span data-stu-id="17423-243">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="17423-244">NetworkTopologyStrategy använder ett koncept för snitch för att förstå topologin.</span><span class="sxs-lookup"><span data-stu-id="17423-244">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="17423-245">GossipingPropertyFileSnitch ger bättre kontroll i varje nod att mappa till datacenter och rack.</span><span class="sxs-lookup"><span data-stu-id="17423-245">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="17423-246">Klustret använder sedan ett för att sprida informationen.</span><span class="sxs-lookup"><span data-stu-id="17423-246">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="17423-247">Detta är mycket enklare i dynamisk IP-inställningen i förhållande till PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="17423-247">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

## <a name="the-software-configuration"></a><span data-ttu-id="17423-248">KONFIGURATION AV PROGRAMVARA</span><span class="sxs-lookup"><span data-stu-id="17423-248">THE SOFTWARE CONFIGURATION</span></span>
<span data-ttu-id="17423-249">Följande programvaruversioner används under distributionen:</span><span class="sxs-lookup"><span data-stu-id="17423-249">The following software versions are used during the deployment:</span></span>

<table>
<tr><th><span data-ttu-id="17423-250">Programvara</span><span class="sxs-lookup"><span data-stu-id="17423-250">Software</span></span></th><th><span data-ttu-id="17423-251">Källa</span><span class="sxs-lookup"><span data-stu-id="17423-251">Source</span></span></th><th><span data-ttu-id="17423-252">Version</span><span class="sxs-lookup"><span data-stu-id="17423-252">Version</span></span></th></tr>
<tr><td><span data-ttu-id="17423-253">JRE</span><span class="sxs-lookup"><span data-stu-id="17423-253">JRE</span></span>    </td><td><span data-ttu-id="17423-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span><span class="sxs-lookup"><span data-stu-id="17423-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span></span></td><td><span data-ttu-id="17423-255">8U5</span><span class="sxs-lookup"><span data-stu-id="17423-255">8U5</span></span></td></tr>
<tr><td><span data-ttu-id="17423-256">JNA</span><span class="sxs-lookup"><span data-stu-id="17423-256">JNA</span></span>    </td><td><span data-ttu-id="17423-257">[JNA](https://github.com/twall/jna) </span><span class="sxs-lookup"><span data-stu-id="17423-257">[JNA](https://github.com/twall/jna) </span></span></td><td> <span data-ttu-id="17423-258">3.2.7</span><span class="sxs-lookup"><span data-stu-id="17423-258">3.2.7</span></span></td></tr>
<tr><td><span data-ttu-id="17423-259">Cassandra</span><span class="sxs-lookup"><span data-stu-id="17423-259">Cassandra</span></span></td><td>[<span data-ttu-id="17423-260">Apache Cassandra 2.0.8</span><span class="sxs-lookup"><span data-stu-id="17423-260">Apache Cassandra 2.0.8</span></span>](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> <span data-ttu-id="17423-261">2.0.8</span><span class="sxs-lookup"><span data-stu-id="17423-261">2.0.8</span></span></td></tr>
<tr><td><span data-ttu-id="17423-262">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="17423-262">Ubuntu</span></span>    </td><td><span data-ttu-id="17423-263">[Microsoft Azure](https://azure.microsoft.com/) </span><span class="sxs-lookup"><span data-stu-id="17423-263">[Microsoft Azure](https://azure.microsoft.com/) </span></span></td><td><span data-ttu-id="17423-264">14.04 LTS</span><span class="sxs-lookup"><span data-stu-id="17423-264">14.04 LTS</span></span></td></tr>
</table>

<span data-ttu-id="17423-265">Hämtning av JRE kräver manuell godkännande av Oracle-licens, för att förenkla distributionen, ladda ned alla nödvändiga program på skrivbordet för senare överföring till Ubuntu-mallavbildningen som vi ska skapa som en ozonbildande till kluster-distributionen.</span><span class="sxs-lookup"><span data-stu-id="17423-265">Since downloading of JRE requires manual acceptance of Oracle license, to simplify the deployment, download all the required software to the desktop for later uploading into the Ubuntu template image we will be creating as a precursor to the cluster deployment.</span></span>

<span data-ttu-id="17423-266">Ladda ned programmen ovan i en välkänd download katalog (t.ex. %TEMP%/downloads i Windows eller ~/Downloads på de flesta distributioner av Linux- eller Mac) på den lokala datorn.</span><span class="sxs-lookup"><span data-stu-id="17423-266">Download the above software into a well-known download directory (e.g. %TEMP%/downloads on Windows or ~/Downloads on most Linux distributions or Mac) on the local computer.</span></span>

### <a name="create-ubuntu-vm"></a><span data-ttu-id="17423-267">SKAPA VIRTUELL UBUNTU-DATOR</span><span class="sxs-lookup"><span data-stu-id="17423-267">CREATE UBUNTU VM</span></span>
<span data-ttu-id="17423-268">I det här steget i processen skapar vi Ubuntu avbildningen med programvara som krävs så att bilden kan återanvändas för att etablera flera Cassandra noder.</span><span class="sxs-lookup"><span data-stu-id="17423-268">In this step of the process we will create Ubuntu image with the pre-requisite software so that the image can be reused for provisioning several Cassandra nodes.</span></span>  

#### <a name="step-1-generate-ssh-key-pair"></a><span data-ttu-id="17423-269">STEG 1: Skapa SSH-nyckel</span><span class="sxs-lookup"><span data-stu-id="17423-269">STEP 1: Generate SSH key pair</span></span>
<span data-ttu-id="17423-270">Azure behöver X509 offentlig nyckel som är PEM eller DER-kodade då etablering.</span><span class="sxs-lookup"><span data-stu-id="17423-270">Azure needs an X509 public key that is either PEM or DER encoded at the provisioning time.</span></span> <span data-ttu-id="17423-271">Generera en offentliga/privata nyckelpar med instruktioner på hur du använda SSH med Linux på Azure.</span><span class="sxs-lookup"><span data-stu-id="17423-271">Generate a public/private key pair using the instructions located at How to Use SSH with Linux on Azure.</span></span> <span data-ttu-id="17423-272">Om du planerar att använda putty.exe som en SSH-klienten på Windows eller Linux måste du konvertera PEM-kodade RSA den privata nyckeln PPK format med hjälp av puttygen.exe; instruktioner för detta finns på webbsidan som ovan.</span><span class="sxs-lookup"><span data-stu-id="17423-272">If you plan to use putty.exe as an SSH client either on Windows or Linux, you have to convert the PEM encoded RSA private key to PPK format using puttygen.exe; the instructions for this can be found in the above web page.</span></span>

#### <a name="step-2-create-ubuntu-template-vm"></a><span data-ttu-id="17423-273">STEG 2: Skapa Ubuntu VM-mallen</span><span class="sxs-lookup"><span data-stu-id="17423-273">STEP 2: Create Ubuntu template VM</span></span>
<span data-ttu-id="17423-274">Logga in på den klassiska Azure-portalen för att skapa VM-mallen, och använder följande sekvens: Klicka på ny, beräkning, VIRTUELLA, från GALLERIET, UBUNTU, Ubuntu Server 14.04 LTS och klicka på pilen till höger.</span><span class="sxs-lookup"><span data-stu-id="17423-274">To create the template VM, log into the Azure classic portal and use the following sequence: Click NEW, COMPUTE, VIRTUAL MACHINE, FROM GALLERY, UBUNTU, Ubuntu Server 14.04 LTS, and then click the right arrow.</span></span> <span data-ttu-id="17423-275">En genomgång som beskriver hur du skapar en Linux VM, se Skapa en virtuell dator kör Linux.</span><span class="sxs-lookup"><span data-stu-id="17423-275">For a tutorial that describes how to create a Linux VM, see Create a Virtual Machine Running Linux.</span></span>

<span data-ttu-id="17423-276">Ange följande information på skärmen ”konfiguration av virtuell dator” #1:</span><span class="sxs-lookup"><span data-stu-id="17423-276">Enter the following information on the “Virtual machine configuration” screen #1:</span></span>

<table>
<tr><th><span data-ttu-id="17423-277">FÄLTNAMN</span><span class="sxs-lookup"><span data-stu-id="17423-277">FIELD NAME</span></span>              </td><td>       <span data-ttu-id="17423-278">FÄLTVÄRDE</span><span class="sxs-lookup"><span data-stu-id="17423-278">FIELD VALUE</span></span>               </td><td>         <span data-ttu-id="17423-279">KOMMENTARER</span><span class="sxs-lookup"><span data-stu-id="17423-279">REMARKS</span></span>                </td><tr>
<tr><td><span data-ttu-id="17423-280">VERSION UTGIVNINGSDATUM</span><span class="sxs-lookup"><span data-stu-id="17423-280">VERSION RELEASE DATE</span></span>    </td><td> <span data-ttu-id="17423-281">Välj ett datum i nedrullningsbara ned</span><span class="sxs-lookup"><span data-stu-id="17423-281">Select a date from the drop down</span></span></td><td></td><tr>
<tr><td><span data-ttu-id="17423-282">NAMN PÅ VIRTUELL DATOR</span><span class="sxs-lookup"><span data-stu-id="17423-282">VIRTUAL MACHINE NAME</span></span>    </td><td> <span data-ttu-id="17423-283">fråga mall</span><span class="sxs-lookup"><span data-stu-id="17423-283">cass-template</span></span>                   </td><td> <span data-ttu-id="17423-284">Detta är värdnamnet på den virtuella datorn</span><span class="sxs-lookup"><span data-stu-id="17423-284">This is the hostname of the VM</span></span> </td><tr>
<tr><td><span data-ttu-id="17423-285">NIVÅ</span><span class="sxs-lookup"><span data-stu-id="17423-285">TIER</span></span>                     </td><td> <span data-ttu-id="17423-286">STANDARD</span><span class="sxs-lookup"><span data-stu-id="17423-286">STANDARD</span></span>                           </td><td> <span data-ttu-id="17423-287">Låt standardvärdet</span><span class="sxs-lookup"><span data-stu-id="17423-287">Leave the default</span></span>              </td><tr>
<tr><td><span data-ttu-id="17423-288">STORLEK</span><span class="sxs-lookup"><span data-stu-id="17423-288">SIZE</span></span>                     </td><td> <span data-ttu-id="17423-289">A1</span><span class="sxs-lookup"><span data-stu-id="17423-289">A1</span></span>                              </td><td><span data-ttu-id="17423-290">Välj den virtuella datorn baserat på i/o-behov. Låt standardvärdet för detta ändamål</span><span class="sxs-lookup"><span data-stu-id="17423-290">Select the VM based on the IO needs; for this purpose leave the default</span></span> </td><tr>
<tr><td> <span data-ttu-id="17423-291">NYTT ANVÄNDARNAMN</span><span class="sxs-lookup"><span data-stu-id="17423-291">NEW USER NAME</span></span>             </td><td> <span data-ttu-id="17423-292">localadmin</span><span class="sxs-lookup"><span data-stu-id="17423-292">localadmin</span></span>                       </td><td> <span data-ttu-id="17423-293">”admin” är ett reserverat användarnamn i Ubuntu 12. xx och efter</span><span class="sxs-lookup"><span data-stu-id="17423-293">"admin" is a reserved user name in Ubuntu 12.xx and after</span></span></td><tr>
<tr><td> <span data-ttu-id="17423-294">AUTENTISERING</span><span class="sxs-lookup"><span data-stu-id="17423-294">AUTHENTICATION</span></span>         </td><td> <span data-ttu-id="17423-295">Markera kryssrutan</span><span class="sxs-lookup"><span data-stu-id="17423-295">Click check box</span></span>                 </td><td><span data-ttu-id="17423-296">Markera om du vill skydda med en SSH-nyckel</span><span class="sxs-lookup"><span data-stu-id="17423-296">Check if you want to secure with an SSH key</span></span> </td><tr>
<tr><td> <span data-ttu-id="17423-297">CERTIFIKAT</span><span class="sxs-lookup"><span data-stu-id="17423-297">CERTIFICATE</span></span>             </td><td> <span data-ttu-id="17423-298">filnamnet på det offentliga nyckelcertifikatet</span><span class="sxs-lookup"><span data-stu-id="17423-298">file name of the public key certificate</span></span> </td><td> <span data-ttu-id="17423-299">Använd den offentliga nyckeln som skapats tidigare</span><span class="sxs-lookup"><span data-stu-id="17423-299">Use the public key generated previously</span></span></td><tr>
<tr><td> <span data-ttu-id="17423-300">Nytt lösenord</span><span class="sxs-lookup"><span data-stu-id="17423-300">New Password</span></span>    </td><td> <span data-ttu-id="17423-301">starkt lösenord</span><span class="sxs-lookup"><span data-stu-id="17423-301">strong password</span></span> </td><td> </td><tr>
<tr><td> <span data-ttu-id="17423-302">Bekräfta lösenord</span><span class="sxs-lookup"><span data-stu-id="17423-302">Confirm Password</span></span>    </td><td> <span data-ttu-id="17423-303">starkt lösenord</span><span class="sxs-lookup"><span data-stu-id="17423-303">strong password</span></span> </td><td></td><tr>
</table>

<span data-ttu-id="17423-304">Ange följande information på skärmen ”konfiguration av virtuell dator” #2:</span><span class="sxs-lookup"><span data-stu-id="17423-304">Enter the following information on the “Virtual machine configuration” screen #2:</span></span>

<table>
<tr><th><span data-ttu-id="17423-305">FÄLTNAMN</span><span class="sxs-lookup"><span data-stu-id="17423-305">FIELD NAME</span></span>             </th><th> <span data-ttu-id="17423-306">FÄLTVÄRDE</span><span class="sxs-lookup"><span data-stu-id="17423-306">FIELD VALUE</span></span>                       </th><th> <span data-ttu-id="17423-307">KOMMENTARER</span><span class="sxs-lookup"><span data-stu-id="17423-307">REMARKS</span></span>                                 </th></tr>
<tr><td> <span data-ttu-id="17423-308">MOLNTJÄNSTEN</span><span class="sxs-lookup"><span data-stu-id="17423-308">CLOUD SERVICE</span></span>    </td><td> <span data-ttu-id="17423-309">Skapa en ny molntjänst</span><span class="sxs-lookup"><span data-stu-id="17423-309">Create a new cloud service</span></span>    </td><td><span data-ttu-id="17423-310">Molntjänst är en behållare beräkningsresurser som virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="17423-310">Cloud service is a container compute resources like virtual machines</span></span></td></tr>
<tr><td> <span data-ttu-id="17423-311">DNS-MOLNTJÄNSTNAMNET</span><span class="sxs-lookup"><span data-stu-id="17423-311">CLOUD SERVICE DNS NAME</span></span>    </td><td><span data-ttu-id="17423-312">Ubuntu template.cloudapp.net</span><span class="sxs-lookup"><span data-stu-id="17423-312">ubuntu-template.cloudapp.net</span></span>    </td><td><span data-ttu-id="17423-313">Ge en datorn storleksoberoende belastningsutjämnarens namn</span><span class="sxs-lookup"><span data-stu-id="17423-313">Give a machine agnostic load balancer name</span></span></td></tr>
<tr><td> <span data-ttu-id="17423-314">REGION/TILLHÖRIGHETSGRUPP/VIRTUELLT NÄTVERK</span><span class="sxs-lookup"><span data-stu-id="17423-314">REGION/AFFINITY GROUP/VIRTUAL NETWORK</span></span> </td><td>    <span data-ttu-id="17423-315">Västra USA</span><span class="sxs-lookup"><span data-stu-id="17423-315">West US</span></span>    </td><td> <span data-ttu-id="17423-316">Välj en region som ditt webbprogram till Cassandra klustret</span><span class="sxs-lookup"><span data-stu-id="17423-316">Select a region from which your web applications access the Cassandra cluster</span></span></td></tr>
<tr><td><span data-ttu-id="17423-317">STORAGE-KONTO</span><span class="sxs-lookup"><span data-stu-id="17423-317">STORAGE ACCOUNT</span></span> </td><td>    <span data-ttu-id="17423-318">Använd standard</span><span class="sxs-lookup"><span data-stu-id="17423-318">Use default</span></span>    </td><td><span data-ttu-id="17423-319">Använda standardkontot för lagring eller ett befintligt lagringskonto i en viss region</span><span class="sxs-lookup"><span data-stu-id="17423-319">Use the default storage account  or a pre-created storage account in a particular region</span></span></td></tr>
<tr><td><span data-ttu-id="17423-320">TILLGÄNGLIGHETSUPPSÄTTNING</span><span class="sxs-lookup"><span data-stu-id="17423-320">AVAILABILITY SET</span></span> </td><td>    <span data-ttu-id="17423-321">Ingen</span><span class="sxs-lookup"><span data-stu-id="17423-321">None</span></span> </td><td>    <span data-ttu-id="17423-322">Lämna det tomt</span><span class="sxs-lookup"><span data-stu-id="17423-322">Leave it blank</span></span></td></tr>
<tr><td><span data-ttu-id="17423-323">SLUTPUNKTER</span><span class="sxs-lookup"><span data-stu-id="17423-323">ENDPOINTS</span></span>    </td><td><span data-ttu-id="17423-324">Använd standard</span><span class="sxs-lookup"><span data-stu-id="17423-324">Use default</span></span> </td><td>    <span data-ttu-id="17423-325">Använd standardkonfigurationen för SSH</span><span class="sxs-lookup"><span data-stu-id="17423-325">Use the default SSH configuration</span></span> </td></tr>
</table>

<span data-ttu-id="17423-326">Klicka på högerpilen och lämna standardvärdena på skärmen #3 knappen ”Kontrollera” för att slutföra etableringsprocessen VM.</span><span class="sxs-lookup"><span data-stu-id="17423-326">Click right arrow, leave the defaults on the screen #3 and click the “check” button to complete the VM provisioning process.</span></span> <span data-ttu-id="17423-327">Den virtuella datorn med namnet ”ubuntu-mall” måste vara i statusen ”körs” efter några minuter.</span><span class="sxs-lookup"><span data-stu-id="17423-327">After a few minutes, the VM with the name “ubuntu-template” should be in a “running” status.</span></span>

### <a name="install-the-necessary-software"></a><span data-ttu-id="17423-328">INSTALLERA NÖDVÄNDIG PROGRAMVARA</span><span class="sxs-lookup"><span data-stu-id="17423-328">INSTALL THE NECESSARY SOFTWARE</span></span>
#### <a name="step-1-upload-tarballs"></a><span data-ttu-id="17423-329">STEG 1: Ladda upp tarballs</span><span class="sxs-lookup"><span data-stu-id="17423-329">STEP 1: Upload tarballs</span></span>
<span data-ttu-id="17423-330">Använder scp eller pscp, kopierar du tidigare hämtade programvaran till ~/downloads katalogen med hjälp av följande kommandoformat:</span><span class="sxs-lookup"><span data-stu-id="17423-330">Using scp or pscp, copy the previously downloaded software to ~/downloads directory using the following command format:</span></span>

##### <a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a><span data-ttu-id="17423-331">pscp server-jre-8u5-linux-x64.tar.gzlocaladmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span><span class="sxs-lookup"><span data-stu-id="17423-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span></span>
<span data-ttu-id="17423-332">Upprepa ovanstående kommando för JRE samt som Cassandra bitar.</span><span class="sxs-lookup"><span data-stu-id="17423-332">Repeat the above command for JRE as well as for the Cassandra bits.</span></span>

#### <a name="step-2-prepare-the-directory-structure-and-extract-the-archives"></a><span data-ttu-id="17423-333">STEG 2: Förbered katalogstrukturen och extrahera Arkiv</span><span class="sxs-lookup"><span data-stu-id="17423-333">STEP 2: Prepare the directory structure and extract the archives</span></span>
<span data-ttu-id="17423-334">Logga in på den virtuella datorn och skapa katalogstrukturen och extrahera programvara som en superanvändare använder bash-skriptet nedan:</span><span class="sxs-lookup"><span data-stu-id="17423-334">Log into the VM and create the directory structure and extract software as a super user using the bash script below:</span></span>

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change the ownership to the service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile to add JRE to the PATH"
    echo "installation is complete"


<span data-ttu-id="17423-335">Om du klistrar in det här skriptet i vim fönster måste du ta bort radmatningen ('\r ”) med följande kommando:</span><span class="sxs-lookup"><span data-stu-id="17423-335">If you paste this script into vim window, make sure to remove the carriage return (‘\r”) using the following command:</span></span>

    tr -d '\r' <infile.sh >outfile.sh

#### <a name="step-3-edit-etcprofile"></a><span data-ttu-id="17423-336">Steg 3: Redigera etc-profil</span><span class="sxs-lookup"><span data-stu-id="17423-336">Step 3: Edit etc/profile</span></span>
<span data-ttu-id="17423-337">Lägg till följande i slutet:</span><span class="sxs-lookup"><span data-stu-id="17423-337">Append the following at the end:</span></span>

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

#### <a name="step-4-install-jna-for-production-systems"></a><span data-ttu-id="17423-338">Steg 4: Installera JNA för produktionssystem</span><span class="sxs-lookup"><span data-stu-id="17423-338">Step 4: Install JNA for production systems</span></span>
<span data-ttu-id="17423-339">Använd följande kommandosekvens: följande kommando kommer installerar jna 3.2.7.jar och jna plattform 3.2.7.jar till /usr/share.java directory lgh sudo-get libjna java</span><span class="sxs-lookup"><span data-stu-id="17423-339">Use the following command sequence: The following command will install jna-3.2.7.jar and jna-platform-3.2.7.jar to /usr/share.java directory sudo apt-get install libjna-java</span></span>

<span data-ttu-id="17423-340">Skapa symboliska länkar i $CASS_HOME/lib directory så att Cassandra startskript kan hitta dessa burkar:</span><span class="sxs-lookup"><span data-stu-id="17423-340">Create symbolic links in $CASS_HOME/lib directory so that Cassandra startup script can find these jars:</span></span>

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

#### <a name="step-5-configure-cassandrayaml"></a><span data-ttu-id="17423-341">Steg 5: Konfigurera cassandra.yaml</span><span class="sxs-lookup"><span data-stu-id="17423-341">Step 5: Configure cassandra.yaml</span></span>
<span data-ttu-id="17423-342">Redigera cassandra.yaml på varje virtuell konfiguration som krävs av alla virtuella datorer [vi ska justera detta under den faktiska etableringen]:</span><span class="sxs-lookup"><span data-stu-id="17423-342">Edit cassandra.yaml on each VM to reflect configuration needed by all the virtual machines [we will tweak this during the actual provisioning]:</span></span>

<table>
<tr><th><span data-ttu-id="17423-343">Fältnamn</span><span class="sxs-lookup"><span data-stu-id="17423-343">Field Name</span></span>   </th><th> <span data-ttu-id="17423-344">Värde</span><span class="sxs-lookup"><span data-stu-id="17423-344">Value</span></span>  </th><th>    <span data-ttu-id="17423-345">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-345">Remarks</span></span> </th></tr>
<tr><td><span data-ttu-id="17423-346">klusternamn</span><span class="sxs-lookup"><span data-stu-id="17423-346">cluster_name</span></span> </td><td>    <span data-ttu-id="17423-347">”CustomerService”</span><span class="sxs-lookup"><span data-stu-id="17423-347">“CustomerService”</span></span>    </td><td> <span data-ttu-id="17423-348">Använda namn som motsvarar din distribution</span><span class="sxs-lookup"><span data-stu-id="17423-348">Use the name that reflects your deployment</span></span></td></tr>
<tr><td><span data-ttu-id="17423-349">listen_address</span><span class="sxs-lookup"><span data-stu-id="17423-349">listen_address</span></span>    </td><td><span data-ttu-id="17423-350">[lämna det tomt]</span><span class="sxs-lookup"><span data-stu-id="17423-350">[leave it blank]</span></span>    </td><td> <span data-ttu-id="17423-351">Ta bort ”localhost”</span><span class="sxs-lookup"><span data-stu-id="17423-351">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="17423-352">rpc_addres</span><span class="sxs-lookup"><span data-stu-id="17423-352">rpc_addres</span></span>   </td><td><span data-ttu-id="17423-353">[lämna det tomt]</span><span class="sxs-lookup"><span data-stu-id="17423-353">[leave it blank]</span></span>    </td><td> <span data-ttu-id="17423-354">Ta bort ”localhost”</span><span class="sxs-lookup"><span data-stu-id="17423-354">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="17423-355">frö</span><span class="sxs-lookup"><span data-stu-id="17423-355">seeds</span></span>    </td><td><span data-ttu-id="17423-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span><span class="sxs-lookup"><span data-stu-id="17423-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span></span>    </td><td><span data-ttu-id="17423-357">Lista över alla IP-adresser som är avsedda som frö.</span><span class="sxs-lookup"><span data-stu-id="17423-357">List of  all the IP addresses which are designated as seeds.</span></span></td></tr>
<tr><td><span data-ttu-id="17423-358">endpoint_snitch</span><span class="sxs-lookup"><span data-stu-id="17423-358">endpoint_snitch</span></span> </td><td> <span data-ttu-id="17423-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="17423-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span></span> </td><td> <span data-ttu-id="17423-360">Detta används av NetworkTopologyStrateg för procedurens datacenter och rack av den virtuella datorn</span><span class="sxs-lookup"><span data-stu-id="17423-360">This is used by the NetworkTopologyStrateg for inferring the data center and the rack of the VM</span></span></td></tr>
</table>

#### <a name="step-6-capture-the-vm-image"></a><span data-ttu-id="17423-361">Steg 6: Hämta VM-avbildning</span><span class="sxs-lookup"><span data-stu-id="17423-361">Step 6: Capture the VM image</span></span>
<span data-ttu-id="17423-362">Logga in på den virtuella datorn med värdnamn (hk-cas-template.cloudapp.net) och privata SSH-nyckeln skapade tidigare.</span><span class="sxs-lookup"><span data-stu-id="17423-362">Log into the virtual machine using the hostname (hk-cas-template.cloudapp.net) and the SSH private key previously created.</span></span> <span data-ttu-id="17423-363">Se hur du använda SSH med Linux i Azure för information om hur du loggar in med hjälp av kommandot ssh eller putty.exe.</span><span class="sxs-lookup"><span data-stu-id="17423-363">See How to Use SSH with Linux on Azure for details on how to log in using the command ssh or putty.exe.</span></span>

<span data-ttu-id="17423-364">Kör följande sekvens med åtgärder för att avbilda:</span><span class="sxs-lookup"><span data-stu-id="17423-364">Execute the following sequence of actions to capture the image:</span></span>

##### <a name="1-deprovision"></a><span data-ttu-id="17423-365">1. Avetablering</span><span class="sxs-lookup"><span data-stu-id="17423-365">1. Deprovision</span></span>
<span data-ttu-id="17423-366">Använd kommandot ”sudo waagent – avetablering + användare” ta bort virtuella instansen specifik information.</span><span class="sxs-lookup"><span data-stu-id="17423-366">Use the command “sudo waagent –deprovision+user” to remove Virtual Machine instance specific information.</span></span> <span data-ttu-id="17423-367">Se för [så här skapar du en virtuell Linux-dator](capture-image.md) ska användas som en mall för mer information på image-hämtningen.</span><span class="sxs-lookup"><span data-stu-id="17423-367">See for [How to Capture a Linux Virtual Machine](capture-image.md) to Use as a Template more details on the image capture process.</span></span>

##### <a name="2-shutdown-the-vm"></a><span data-ttu-id="17423-368">2: Stäng den virtuella datorn</span><span class="sxs-lookup"><span data-stu-id="17423-368">2: Shutdown the VM</span></span>
<span data-ttu-id="17423-369">Kontrollera att den virtuella datorn har markerats och klicka på länken avstängning från kommandofältet längst ned.</span><span class="sxs-lookup"><span data-stu-id="17423-369">Make sure that the virtual machine is highlighted and click the SHUTDOWN link from the bottom command bar.</span></span>

##### <a name="3-capture-the-image"></a><span data-ttu-id="17423-370">3: spara avbildningen</span><span class="sxs-lookup"><span data-stu-id="17423-370">3: Capture the image</span></span>
<span data-ttu-id="17423-371">Kontrollera att den virtuella datorn har markerats och klicka på länken avbildning från kommandofältet längst ned.</span><span class="sxs-lookup"><span data-stu-id="17423-371">Make sure that the virtual machine is highlighted and click the CAPTURE link from the bottom command bar.</span></span> <span data-ttu-id="17423-372">På nästa skärm namnge en bild (t.ex. hk-cas-2-08-ub-14-04-2014071), lämpliga AVBILDNINGSBESKRIVNINGEN och klicka på ”kryssmarkeringen” om du vill slutföra bildtagningen.</span><span class="sxs-lookup"><span data-stu-id="17423-372">In the next screen, give an IMAGE NAME (e.g. hk-cas-2-08-ub-14-04-2014071), appropriate IMAGE DESCRIPTION, and click the “check” mark to finish the CAPTURE process.</span></span>

<span data-ttu-id="17423-373">Detta tar några sekunder och avbildningen ska vara tillgänglig under Mina AVBILDNINGAR i galleriet för avbildningen.</span><span class="sxs-lookup"><span data-stu-id="17423-373">This will take a few seconds and the image should be available in MY IMAGES section of the image gallery.</span></span> <span data-ttu-id="17423-374">Den Virtuella källdatorn tas automatiskt bort när avbildningen har gjorts.</span><span class="sxs-lookup"><span data-stu-id="17423-374">The source VM will be automatically deleted after the image is successfully captured.</span></span> 

## <a name="single-region-deployment-process"></a><span data-ttu-id="17423-375">Processen för distribution av enskild Region</span><span class="sxs-lookup"><span data-stu-id="17423-375">Single Region Deployment Process</span></span>
<span data-ttu-id="17423-376">**Steg 1: Skapa det virtuella nätverket** logga in på Azure-portalen och skapa ett virtuellt nätverk (klassiskt) med attribut som visas i följande tabell.</span><span class="sxs-lookup"><span data-stu-id="17423-376">**Step 1: Create the Virtual Network** Log into the Azure portal and create a virtual network (classic) with the attributes shown in the following table.</span></span> <span data-ttu-id="17423-377">Se [skapa ett virtuellt nätverk (klassiska) med hjälp av Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) för detaljerade steg i processen.</span><span class="sxs-lookup"><span data-stu-id="17423-377">See [Create a virtual network (classic) using the Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="17423-378">VM attributets namn</span><span class="sxs-lookup"><span data-stu-id="17423-378">VM Attribute Name</span></span></th><th><span data-ttu-id="17423-379">Värde</span><span class="sxs-lookup"><span data-stu-id="17423-379">Value</span></span></th><th><span data-ttu-id="17423-380">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-380">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="17423-381">Namn</span><span class="sxs-lookup"><span data-stu-id="17423-381">Name</span></span></td><td><span data-ttu-id="17423-382">vnet-fråga-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-382">vnet-cass-west-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="17423-383">Region</span><span class="sxs-lookup"><span data-stu-id="17423-383">Region</span></span></td><td><span data-ttu-id="17423-384">Västra USA</span><span class="sxs-lookup"><span data-stu-id="17423-384">West US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="17423-385">DNS-servrar</span><span class="sxs-lookup"><span data-stu-id="17423-385">DNS Servers</span></span></td><td><span data-ttu-id="17423-386">Ingen</span><span class="sxs-lookup"><span data-stu-id="17423-386">None</span></span></td><td><span data-ttu-id="17423-387">Ignorera detta eftersom vi inte använder en DNS-Server</span><span class="sxs-lookup"><span data-stu-id="17423-387">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="17423-388">Adressutrymmet</span><span class="sxs-lookup"><span data-stu-id="17423-388">Address Space</span></span></td><td><span data-ttu-id="17423-389">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="17423-389">10.1.0.0/16</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="17423-390">Starta IP</span><span class="sxs-lookup"><span data-stu-id="17423-390">Starting IP</span></span></td><td><span data-ttu-id="17423-391">10.1.0.0</span><span class="sxs-lookup"><span data-stu-id="17423-391">10.1.0.0</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="17423-392">CIDR</span><span class="sxs-lookup"><span data-stu-id="17423-392">CIDR</span></span> </td><td><span data-ttu-id="17423-393">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="17423-393">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="17423-394">Lägg till följande undernät:</span><span class="sxs-lookup"><span data-stu-id="17423-394">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="17423-395">Namn</span><span class="sxs-lookup"><span data-stu-id="17423-395">Name</span></span></th><th><span data-ttu-id="17423-396">Starta IP</span><span class="sxs-lookup"><span data-stu-id="17423-396">Starting IP</span></span></th><th><span data-ttu-id="17423-397">CIDR</span><span class="sxs-lookup"><span data-stu-id="17423-397">CIDR</span></span></th><th><span data-ttu-id="17423-398">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-398">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="17423-399">webbprogram</span><span class="sxs-lookup"><span data-stu-id="17423-399">web</span></span></td><td><span data-ttu-id="17423-400">10.1.1.0</span><span class="sxs-lookup"><span data-stu-id="17423-400">10.1.1.0</span></span></td><td><span data-ttu-id="17423-401">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="17423-401">/24 (251)</span></span></td><td><span data-ttu-id="17423-402">Undernät för webbservergrupp</span><span class="sxs-lookup"><span data-stu-id="17423-402">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="17423-403">Data</span><span class="sxs-lookup"><span data-stu-id="17423-403">data</span></span></td><td><span data-ttu-id="17423-404">10.1.2.0</span><span class="sxs-lookup"><span data-stu-id="17423-404">10.1.2.0</span></span></td><td><span data-ttu-id="17423-405">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="17423-405">/24 (251)</span></span></td><td><span data-ttu-id="17423-406">Undernät för databasnoder</span><span class="sxs-lookup"><span data-stu-id="17423-406">Subnet for the database nodes</span></span></td></tr>
</table>

<span data-ttu-id="17423-407">Data och Web undernät kan skyddas via nätverkssäkerhetsgrupper täckning som ligger utanför omfånget för den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="17423-407">Data and Web subnets can be protected through network security groups the coverage of which is out of scope for this article.</span></span>  

<span data-ttu-id="17423-408">**Steg 2: Etablera virtuella datorer** med den avbildning som har skapats tidigare vi skapar följande virtuella datorer i molnet server ”hk-c-svc-Väst” och binda dem till respektive undernät som visas nedan:</span><span class="sxs-lookup"><span data-stu-id="17423-408">**Step 2: Provision Virtual Machines** Using the image created previously, we will create the following virtual machines in the cloud server “hk-c-svc-west” and bind them to the respective subnets as shown below:</span></span>

<table>
<tr><th><span data-ttu-id="17423-409">Namnet på datorn</span><span class="sxs-lookup"><span data-stu-id="17423-409">Machine Name</span></span>    </th><th><span data-ttu-id="17423-410">Undernät</span><span class="sxs-lookup"><span data-stu-id="17423-410">Subnet</span></span>    </th><th><span data-ttu-id="17423-411">IP-adress</span><span class="sxs-lookup"><span data-stu-id="17423-411">IP Address</span></span>    </th><th><span data-ttu-id="17423-412">Tillgänglighetsuppsättning</span><span class="sxs-lookup"><span data-stu-id="17423-412">Availability set</span></span></th><th><span data-ttu-id="17423-413">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="17423-413">DC/Rack</span></span></th><th><span data-ttu-id="17423-414">Startvärde för?</span><span class="sxs-lookup"><span data-stu-id="17423-414">Seed?</span></span></th></tr>
<tr><td><span data-ttu-id="17423-415">HK-c1-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-415">hk-c1-west-us</span></span>    </td><td><span data-ttu-id="17423-416">Data</span><span class="sxs-lookup"><span data-stu-id="17423-416">data</span></span>    </td><td><span data-ttu-id="17423-417">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="17423-417">10.1.2.4</span></span>    </td><td><span data-ttu-id="17423-418">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-418">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="17423-419">DC = WESTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="17423-419">dc =WESTUS rack =rack1</span></span> </td><td><span data-ttu-id="17423-420">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-420">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="17423-421">HK-c2-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-421">hk-c2-west-us</span></span>    </td><td><span data-ttu-id="17423-422">Data</span><span class="sxs-lookup"><span data-stu-id="17423-422">data</span></span>    </td><td><span data-ttu-id="17423-423">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="17423-423">10.1.2.5</span></span>    </td><td><span data-ttu-id="17423-424">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-424">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="17423-425">DC = WESTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="17423-425">dc =WESTUS rack =rack1</span></span>    </td><td><span data-ttu-id="17423-426">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-426">No</span></span> </td></tr>
<tr><td><span data-ttu-id="17423-427">HK-c3-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-427">hk-c3-west-us</span></span>    </td><td><span data-ttu-id="17423-428">Data</span><span class="sxs-lookup"><span data-stu-id="17423-428">data</span></span>    </td><td><span data-ttu-id="17423-429">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="17423-429">10.1.2.6</span></span>    </td><td><span data-ttu-id="17423-430">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-430">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="17423-431">DC = WESTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="17423-431">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="17423-432">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-432">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="17423-433">HK-c4-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-433">hk-c4-west-us</span></span>    </td><td><span data-ttu-id="17423-434">Data</span><span class="sxs-lookup"><span data-stu-id="17423-434">data</span></span>    </td><td><span data-ttu-id="17423-435">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="17423-435">10.1.2.7</span></span>    </td><td><span data-ttu-id="17423-436">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-436">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="17423-437">DC = WESTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="17423-437">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="17423-438">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-438">No</span></span> </td></tr>
<tr><td><span data-ttu-id="17423-439">HK-c5-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-439">hk-c5-west-us</span></span>    </td><td><span data-ttu-id="17423-440">Data</span><span class="sxs-lookup"><span data-stu-id="17423-440">data</span></span>    </td><td><span data-ttu-id="17423-441">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="17423-441">10.1.2.8</span></span>    </td><td><span data-ttu-id="17423-442">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-442">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="17423-443">DC = WESTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="17423-443">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="17423-444">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-444">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="17423-445">HK-c6-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-445">hk-c6-west-us</span></span>    </td><td><span data-ttu-id="17423-446">Data</span><span class="sxs-lookup"><span data-stu-id="17423-446">data</span></span>    </td><td><span data-ttu-id="17423-447">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="17423-447">10.1.2.9</span></span>    </td><td><span data-ttu-id="17423-448">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-448">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="17423-449">DC = WESTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="17423-449">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="17423-450">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-450">No</span></span> </td></tr>
<tr><td><span data-ttu-id="17423-451">HK-c7-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-451">hk-c7-west-us</span></span>    </td><td><span data-ttu-id="17423-452">Data</span><span class="sxs-lookup"><span data-stu-id="17423-452">data</span></span>    </td><td><span data-ttu-id="17423-453">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="17423-453">10.1.2.10</span></span>    </td><td><span data-ttu-id="17423-454">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-454">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="17423-455">DC = WESTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="17423-455">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="17423-456">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-456">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="17423-457">HK-c8-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-457">hk-c8-west-us</span></span>    </td><td><span data-ttu-id="17423-458">Data</span><span class="sxs-lookup"><span data-stu-id="17423-458">data</span></span>    </td><td><span data-ttu-id="17423-459">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="17423-459">10.1.2.11</span></span>    </td><td><span data-ttu-id="17423-460">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-460">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="17423-461">DC = WESTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="17423-461">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="17423-462">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-462">No</span></span> </td></tr>
<tr><td><span data-ttu-id="17423-463">HK-w1-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-463">hk-w1-west-us</span></span>    </td><td><span data-ttu-id="17423-464">webbprogram</span><span class="sxs-lookup"><span data-stu-id="17423-464">web</span></span>    </td><td><span data-ttu-id="17423-465">10.1.1.4</span><span class="sxs-lookup"><span data-stu-id="17423-465">10.1.1.4</span></span>    </td><td><span data-ttu-id="17423-466">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-466">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="17423-467">Saknas</span><span class="sxs-lookup"><span data-stu-id="17423-467">N/A</span></span></td></tr>
<tr><td><span data-ttu-id="17423-468">HK-w2-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-468">hk-w2-west-us</span></span>    </td><td><span data-ttu-id="17423-469">webbprogram</span><span class="sxs-lookup"><span data-stu-id="17423-469">web</span></span>    </td><td><span data-ttu-id="17423-470">10.1.1.5</span><span class="sxs-lookup"><span data-stu-id="17423-470">10.1.1.5</span></span>    </td><td><span data-ttu-id="17423-471">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-471">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="17423-472">Saknas</span><span class="sxs-lookup"><span data-stu-id="17423-472">N/A</span></span></td></tr>
</table>

<span data-ttu-id="17423-473">Skapa listan ovan för virtuella datorer kräver följande process:</span><span class="sxs-lookup"><span data-stu-id="17423-473">Creation of the above list of VMs requires the following process:</span></span>

1. <span data-ttu-id="17423-474">Skapa en tom molntjänst i ett visst område</span><span class="sxs-lookup"><span data-stu-id="17423-474">Create an empty cloud service in a particular region</span></span>
2. <span data-ttu-id="17423-475">Skapa en virtuell dator från den tidigare avbildningen och koppla den till det virtuella nätverket som skapats tidigare; Upprepa detta för alla virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="17423-475">Create a VM from the previously captured image and attach it to the virtual network created previously; repeat this for all the VMs</span></span>
3. <span data-ttu-id="17423-476">Lägg till en intern belastningsutjämnare till Molntjänsten och koppla den till undernätet ”data”</span><span class="sxs-lookup"><span data-stu-id="17423-476">Add an internal load balancer to the cloud service and attach it to the “data” subnet</span></span>
4. <span data-ttu-id="17423-477">Lägg till en slutpunkt för Utjämning av nätverksbelastning för thrift-trafik via en belastningsutjämnad uppsättning som är anslutna till den tidigare skapade interna belastningsutjämnaren för varje VM som skapats tidigare</span><span class="sxs-lookup"><span data-stu-id="17423-477">For each VM created previously, add a load balanced endpoint for thrift traffic through a load balanced set connected to the previously created internal load balancer</span></span>

<span data-ttu-id="17423-478">Ovanstående procedur kan utföras med hjälp av Azure klassiska portal; Använd Windows-dator (Använd en virtuell dator i Azure om du inte har åtkomst till en Windows-dator), använda följande PowerShell-skript för att etablera alla 8 virtuella datorer automatiskt.</span><span class="sxs-lookup"><span data-stu-id="17423-478">The above process can be executed using Azure classic portal; use a Windows machine (use a VM on Azure if you don't have access to a Windows machine), use the following PowerShell script to provision all 8 VMs automatically.</span></span>

<span data-ttu-id="17423-479">**Lista över 1: PowerShell-skript för etablering av virtuella datorer**</span><span class="sxs-lookup"><span data-stu-id="17423-479">**List 1: PowerShell script for provisioning virtual machines**</span></span>

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into the current Powershell session before proceeding
        #The process: 1. create Azure Storage account, 2. create virtual network, 3.create the VM template, 2. crate a list of VMs from the template

        #fundamental variables - change these to reflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores the list of azure vm configuration objects
        #create the list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add the thrift endpoint to the internal load balancer for all the VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

<span data-ttu-id="17423-480">**Steg 3: Konfigurera Cassandra på varje virtuell dator**</span><span class="sxs-lookup"><span data-stu-id="17423-480">**Step 3: Configure Cassandra on each VM**</span></span>

<span data-ttu-id="17423-481">Logga in på den virtuella datorn och utför följande:</span><span class="sxs-lookup"><span data-stu-id="17423-481">Log into the VM and perform the following:</span></span>

* <span data-ttu-id="17423-482">Redigera $CASS_HOME/conf/cassandra-rackdc.properties om du vill ange egenskaper för data center och rack:</span><span class="sxs-lookup"><span data-stu-id="17423-482">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties:</span></span>
  
       dc =EASTUS, rack =rack1
* <span data-ttu-id="17423-483">Redigera cassandra.yaml om du vill konfigurera seed noder enligt nedan:</span><span class="sxs-lookup"><span data-stu-id="17423-483">Edit cassandra.yaml to configure seed nodes as below:</span></span>
  
       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

<span data-ttu-id="17423-484">**Steg 4: Starta de virtuella datorerna och testar klustret**</span><span class="sxs-lookup"><span data-stu-id="17423-484">**Step 4: Start the VMs and test the cluster**</span></span>

<span data-ttu-id="17423-485">Logga in på en av noderna (t.ex. hk-c1-Väst-us) och kör följande kommando för att se status för klustret:</span><span class="sxs-lookup"><span data-stu-id="17423-485">Log into one of the nodes (e.g. hk-c1-west-us) and run the following command to see the status of the cluster:</span></span>

       nodetool –h 10.1.2.4 –p 7199 status

<span data-ttu-id="17423-486">Du bör se visningen liknar den nedan för ett kluster på 8 noder:</span><span class="sxs-lookup"><span data-stu-id="17423-486">You should see the display similar to the one below for an 8-node cluster:</span></span>

<table>
<tr><th><span data-ttu-id="17423-487">Status</span><span class="sxs-lookup"><span data-stu-id="17423-487">Status</span></span></th><th><span data-ttu-id="17423-488">Adress</span><span class="sxs-lookup"><span data-stu-id="17423-488">Address</span></span>    </th><th><span data-ttu-id="17423-489">Läsa in</span><span class="sxs-lookup"><span data-stu-id="17423-489">Load</span></span>    </th><th><span data-ttu-id="17423-490">Token</span><span class="sxs-lookup"><span data-stu-id="17423-490">Tokens</span></span>    </th><th><span data-ttu-id="17423-491">Äger</span><span class="sxs-lookup"><span data-stu-id="17423-491">Owns</span></span> </th><th><span data-ttu-id="17423-492">Värd-ID</span><span class="sxs-lookup"><span data-stu-id="17423-492">Host ID</span></span>    </th><th><span data-ttu-id="17423-493">Rack</span><span class="sxs-lookup"><span data-stu-id="17423-493">Rack</span></span></th></tr>
<tr><th><span data-ttu-id="17423-494">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-494">UN</span></span>    </td><td><span data-ttu-id="17423-495">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="17423-495">10.1.2.4</span></span>     </td><td><span data-ttu-id="17423-496">87.81 KB</span><span class="sxs-lookup"><span data-stu-id="17423-496">87.81 KB</span></span>    </td><td><span data-ttu-id="17423-497">256</span><span class="sxs-lookup"><span data-stu-id="17423-497">256</span></span>    </td><td><span data-ttu-id="17423-498">38.0%</span><span class="sxs-lookup"><span data-stu-id="17423-498">38.0%</span></span>    </td><td><span data-ttu-id="17423-499">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-499">Guid (removed)</span></span></td><td><span data-ttu-id="17423-500">rack1</span><span class="sxs-lookup"><span data-stu-id="17423-500">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="17423-501">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-501">UN</span></span>    </td><td><span data-ttu-id="17423-502">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="17423-502">10.1.2.5</span></span>     </td><td><span data-ttu-id="17423-503">41.08 KB</span><span class="sxs-lookup"><span data-stu-id="17423-503">41.08 KB</span></span>    </td><td><span data-ttu-id="17423-504">256</span><span class="sxs-lookup"><span data-stu-id="17423-504">256</span></span>    </td><td><span data-ttu-id="17423-505">68.9%</span><span class="sxs-lookup"><span data-stu-id="17423-505">68.9%</span></span>    </td><td><span data-ttu-id="17423-506">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-506">Guid (removed)</span></span></td><td><span data-ttu-id="17423-507">rack1</span><span class="sxs-lookup"><span data-stu-id="17423-507">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="17423-508">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-508">UN</span></span>    </td><td><span data-ttu-id="17423-509">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="17423-509">10.1.2.6</span></span>     </td><td><span data-ttu-id="17423-510">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="17423-510">55.29 KB</span></span>    </td><td><span data-ttu-id="17423-511">256</span><span class="sxs-lookup"><span data-stu-id="17423-511">256</span></span>    </td><td><span data-ttu-id="17423-512">68.8%</span><span class="sxs-lookup"><span data-stu-id="17423-512">68.8%</span></span>    </td><td><span data-ttu-id="17423-513">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-513">Guid (removed)</span></span></td><td><span data-ttu-id="17423-514">rack2</span><span class="sxs-lookup"><span data-stu-id="17423-514">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="17423-515">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-515">UN</span></span>    </td><td><span data-ttu-id="17423-516">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="17423-516">10.1.2.7</span></span>     </td><td><span data-ttu-id="17423-517">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="17423-517">55.29 KB</span></span>    </td><td><span data-ttu-id="17423-518">256</span><span class="sxs-lookup"><span data-stu-id="17423-518">256</span></span>    </td><td><span data-ttu-id="17423-519">68.8%</span><span class="sxs-lookup"><span data-stu-id="17423-519">68.8%</span></span>    </td><td><span data-ttu-id="17423-520">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-520">Guid (removed)</span></span></td><td><span data-ttu-id="17423-521">rack2</span><span class="sxs-lookup"><span data-stu-id="17423-521">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="17423-522">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-522">UN</span></span>    </td><td><span data-ttu-id="17423-523">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="17423-523">10.1.2.8</span></span>     </td><td><span data-ttu-id="17423-524">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="17423-524">55.29 KB</span></span>    </td><td><span data-ttu-id="17423-525">256</span><span class="sxs-lookup"><span data-stu-id="17423-525">256</span></span>    </td><td><span data-ttu-id="17423-526">68.8%</span><span class="sxs-lookup"><span data-stu-id="17423-526">68.8%</span></span>    </td><td><span data-ttu-id="17423-527">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-527">Guid (removed)</span></span></td><td><span data-ttu-id="17423-528">rack3</span><span class="sxs-lookup"><span data-stu-id="17423-528">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="17423-529">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-529">UN</span></span>    </td><td><span data-ttu-id="17423-530">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="17423-530">10.1.2.9</span></span>     </td><td><span data-ttu-id="17423-531">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="17423-531">55.29 KB</span></span>    </td><td><span data-ttu-id="17423-532">256</span><span class="sxs-lookup"><span data-stu-id="17423-532">256</span></span>    </td><td><span data-ttu-id="17423-533">68.8%</span><span class="sxs-lookup"><span data-stu-id="17423-533">68.8%</span></span>    </td><td><span data-ttu-id="17423-534">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-534">Guid (removed)</span></span></td><td><span data-ttu-id="17423-535">rack3</span><span class="sxs-lookup"><span data-stu-id="17423-535">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="17423-536">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-536">UN</span></span>    </td><td><span data-ttu-id="17423-537">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="17423-537">10.1.2.10</span></span>     </td><td><span data-ttu-id="17423-538">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="17423-538">55.29 KB</span></span>    </td><td><span data-ttu-id="17423-539">256</span><span class="sxs-lookup"><span data-stu-id="17423-539">256</span></span>    </td><td><span data-ttu-id="17423-540">68.8%</span><span class="sxs-lookup"><span data-stu-id="17423-540">68.8%</span></span>    </td><td><span data-ttu-id="17423-541">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-541">Guid (removed)</span></span></td><td><span data-ttu-id="17423-542">rack4</span><span class="sxs-lookup"><span data-stu-id="17423-542">rack4</span></span></td></tr>
<tr><th><span data-ttu-id="17423-543">AVREGISTRERAR</span><span class="sxs-lookup"><span data-stu-id="17423-543">UN</span></span>    </td><td><span data-ttu-id="17423-544">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="17423-544">10.1.2.11</span></span>     </td><td><span data-ttu-id="17423-545">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="17423-545">55.29 KB</span></span>    </td><td><span data-ttu-id="17423-546">256</span><span class="sxs-lookup"><span data-stu-id="17423-546">256</span></span>    </td><td><span data-ttu-id="17423-547">68.8%</span><span class="sxs-lookup"><span data-stu-id="17423-547">68.8%</span></span>    </td><td><span data-ttu-id="17423-548">GUID (tas bort)</span><span class="sxs-lookup"><span data-stu-id="17423-548">Guid (removed)</span></span></td><td><span data-ttu-id="17423-549">rack4</span><span class="sxs-lookup"><span data-stu-id="17423-549">rack4</span></span></td></tr>
</table>

## <a name="test-the-single-region-cluster"></a><span data-ttu-id="17423-550">Testa det enda Region-klustret</span><span class="sxs-lookup"><span data-stu-id="17423-550">Test the Single Region Cluster</span></span>
<span data-ttu-id="17423-551">Använd följande steg för att testa klustret:</span><span class="sxs-lookup"><span data-stu-id="17423-551">Use the following steps to test the cluster:</span></span>

1. <span data-ttu-id="17423-552">Med Powershell-kommandot Get-AzureInternalLoadbalancer-kommandot, hämta IP-adressen för den interna belastningsutjämnaren (t.ex.)  10.1.2.101).</span><span class="sxs-lookup"><span data-stu-id="17423-552">Using the Powershell command Get-AzureInternalLoadbalancer commandlet, obtain the IP address of the internal load balancer (e.g.  10.1.2.101).</span></span> <span data-ttu-id="17423-553">Syntaxen för kommandot visas nedan: Get-AzureLoadbalancer – ServiceName ”hk-c-svc-Väst-oss” [visar information om den interna belastningsutjämnaren tillsammans med dess IP-adress]</span><span class="sxs-lookup"><span data-stu-id="17423-553">The syntax of the command is shown below: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [displays the details of the internal load balancer along with its IP address]</span></span>
2. <span data-ttu-id="17423-554">Logga in på webbservergrupp VM (t.ex. hk-w1-Väst-us) med hjälp av Putty eller ssh</span><span class="sxs-lookup"><span data-stu-id="17423-554">Log into the web farm VM (e.g. hk-w1-west-us) using Putty or ssh</span></span>
3. <span data-ttu-id="17423-555">Köra $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="17423-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
4. <span data-ttu-id="17423-556">Använd följande CQL kommandon för att kontrollera om klustret fungerar:</span><span class="sxs-lookup"><span data-stu-id="17423-556">Use the following CQL commands to verify if the cluster is working:</span></span>
   
     <span data-ttu-id="17423-557">Skapa KEYSPACE customers_ks med replikering = {'class': 'SimpleStrategy', 'replication_factor': 3};   ANVÄNDA customers_ks;   Skapa tabell Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Infoga i Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   Infoga i Customers(customer_id, firstname, lastname) värden (2, ”Jane', 'Berg”).</span><span class="sxs-lookup"><span data-stu-id="17423-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span></span>
   
     <span data-ttu-id="17423-558">Välj * från kunder.</span><span class="sxs-lookup"><span data-stu-id="17423-558">SELECT * FROM Customers;</span></span>

<span data-ttu-id="17423-559">Du bör se en skärm som liknar den nedan:</span><span class="sxs-lookup"><span data-stu-id="17423-559">You should see a display like the one below:</span></span>

<table>
  <tr><th> <span data-ttu-id="17423-560">customer_id</span><span class="sxs-lookup"><span data-stu-id="17423-560">customer_id</span></span> </th><th> <span data-ttu-id="17423-561">Förnamn</span><span class="sxs-lookup"><span data-stu-id="17423-561">firstname</span></span> </th><th> <span data-ttu-id="17423-562">Efternamn</span><span class="sxs-lookup"><span data-stu-id="17423-562">lastname</span></span> </th></tr>
  <tr><td> <span data-ttu-id="17423-563">1</span><span class="sxs-lookup"><span data-stu-id="17423-563">1</span></span> </td><td> <span data-ttu-id="17423-564">John</span><span class="sxs-lookup"><span data-stu-id="17423-564">John</span></span> </td><td> <span data-ttu-id="17423-565">Berg</span><span class="sxs-lookup"><span data-stu-id="17423-565">Doe</span></span> </td></tr>
  <tr><td> <span data-ttu-id="17423-566">2</span><span class="sxs-lookup"><span data-stu-id="17423-566">2</span></span> </td><td> <span data-ttu-id="17423-567">Jane</span><span class="sxs-lookup"><span data-stu-id="17423-567">Jane</span></span> </td><td> <span data-ttu-id="17423-568">Berg</span><span class="sxs-lookup"><span data-stu-id="17423-568">Doe</span></span> </td></tr>
</table>

<span data-ttu-id="17423-569">Observera att keyspace skapade i steg 4 använder SimpleStrategy med en replication_factor 3.</span><span class="sxs-lookup"><span data-stu-id="17423-569">Please note that the keyspace created in step 4 uses SimpleStrategy with a  replication_factor of 3.</span></span> <span data-ttu-id="17423-570">SimpleStrategy rekommenderas för enda data center distributioner medan NetworkTopologyStrategy för flera data center distributioner.</span><span class="sxs-lookup"><span data-stu-id="17423-570">SimpleStrategy is recommended for single data center deployments whereas NetworkTopologyStrategy for multi-data center deployments.</span></span> <span data-ttu-id="17423-571">En replication_factor 3 ger tolerans för nodfel.</span><span class="sxs-lookup"><span data-stu-id="17423-571">A replication_factor of 3 will give tolerance for node failures.</span></span>

## <span data-ttu-id="17423-572"><a id="tworegion"></a>Flera regioner distributionsprocessen</span><span class="sxs-lookup"><span data-stu-id="17423-572"><a id="tworegion"> </a>Multi-Region Deployment Process</span></span>
<span data-ttu-id="17423-573">Utnyttja den enda region distributionen har slutförts och upprepa samma steg för att installera andra region.</span><span class="sxs-lookup"><span data-stu-id="17423-573">Will leverage the single region deployment completed and repeat the same process for installing the second region.</span></span> <span data-ttu-id="17423-574">Den viktigaste skillnaden mellan enstaka och flera region distributionen är VPN-tunnel konfiguration för kommunikation mellan region. Vi börjar med nätverksinstallation, etablera virtuella datorer och konfigurera Cassandra.</span><span class="sxs-lookup"><span data-stu-id="17423-574">The key difference between the single and multiple region deployment is the VPN tunnel setup for inter-region communication; we will start with the network installation, provision the VMs and configure Cassandra.</span></span>

### <a name="step-1-create-the-virtual-network-at-the-2nd-region"></a><span data-ttu-id="17423-575">Steg 1: Skapa virtuella nätverk på 2 Region</span><span class="sxs-lookup"><span data-stu-id="17423-575">Step 1: Create the Virtual Network at the 2nd Region</span></span>
<span data-ttu-id="17423-576">Logga in på den klassiska Azure-portalen och skapa ett virtuellt nätverk med attribut visas i tabellen.</span><span class="sxs-lookup"><span data-stu-id="17423-576">Log into the Azure classic portal and create a Virtual Network with the attributes show in the table.</span></span> <span data-ttu-id="17423-577">Se [konfigurera ett virtuellt nätverk Cloud-Only i den klassiska Azure-portalen](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) för detaljerade steg i processen.</span><span class="sxs-lookup"><span data-stu-id="17423-577">See [Configure a Cloud-Only Virtual Network in the Azure classic portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="17423-578">Attributets namn</span><span class="sxs-lookup"><span data-stu-id="17423-578">Attribute Name</span></span>    </th><th><span data-ttu-id="17423-579">Värde</span><span class="sxs-lookup"><span data-stu-id="17423-579">Value</span></span>    </th><th><span data-ttu-id="17423-580">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-580">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="17423-581">Namn</span><span class="sxs-lookup"><span data-stu-id="17423-581">Name</span></span>    </td><td><span data-ttu-id="17423-582">vnet-fråga-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-582">vnet-cass-east-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="17423-583">Region</span><span class="sxs-lookup"><span data-stu-id="17423-583">Region</span></span>    </td><td><span data-ttu-id="17423-584">Östra USA</span><span class="sxs-lookup"><span data-stu-id="17423-584">East US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="17423-585">DNS-servrar</span><span class="sxs-lookup"><span data-stu-id="17423-585">DNS Servers</span></span>        </td><td></td><td><span data-ttu-id="17423-586">Ignorera detta eftersom vi inte använder en DNS-Server</span><span class="sxs-lookup"><span data-stu-id="17423-586">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="17423-587">Konfigurera en punkt-till-plats-VPN</span><span class="sxs-lookup"><span data-stu-id="17423-587">Configure a point-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="17423-588">Ignorera detta</span><span class="sxs-lookup"><span data-stu-id="17423-588">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="17423-589">Konfigurera ett VPN mellan två platser</span><span class="sxs-lookup"><span data-stu-id="17423-589">Configure a site-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="17423-590">Ignorera detta</span><span class="sxs-lookup"><span data-stu-id="17423-590">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="17423-591">Adressutrymmet</span><span class="sxs-lookup"><span data-stu-id="17423-591">Address Space</span></span>    </td><td><span data-ttu-id="17423-592">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="17423-592">10.2.0.0/16</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="17423-593">Starta IP</span><span class="sxs-lookup"><span data-stu-id="17423-593">Starting IP</span></span>    </td><td><span data-ttu-id="17423-594">10.2.0.0</span><span class="sxs-lookup"><span data-stu-id="17423-594">10.2.0.0</span></span>    </td><td></td></tr>
<tr><td><span data-ttu-id="17423-595">CIDR</span><span class="sxs-lookup"><span data-stu-id="17423-595">CIDR</span></span>    </td><td><span data-ttu-id="17423-596">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="17423-596">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="17423-597">Lägg till följande undernät:</span><span class="sxs-lookup"><span data-stu-id="17423-597">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="17423-598">Namn</span><span class="sxs-lookup"><span data-stu-id="17423-598">Name</span></span>    </th><th><span data-ttu-id="17423-599">Starta IP</span><span class="sxs-lookup"><span data-stu-id="17423-599">Starting IP</span></span>    </th><th><span data-ttu-id="17423-600">CIDR</span><span class="sxs-lookup"><span data-stu-id="17423-600">CIDR</span></span>    </th><th><span data-ttu-id="17423-601">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-601">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="17423-602">webbprogram</span><span class="sxs-lookup"><span data-stu-id="17423-602">web</span></span>    </td><td><span data-ttu-id="17423-603">10.2.1.0</span><span class="sxs-lookup"><span data-stu-id="17423-603">10.2.1.0</span></span>    </td><td><span data-ttu-id="17423-604">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="17423-604">/24 (251)</span></span>    </td><td><span data-ttu-id="17423-605">Undernät för webbservergrupp</span><span class="sxs-lookup"><span data-stu-id="17423-605">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="17423-606">Data</span><span class="sxs-lookup"><span data-stu-id="17423-606">data</span></span>    </td><td><span data-ttu-id="17423-607">10.2.2.0</span><span class="sxs-lookup"><span data-stu-id="17423-607">10.2.2.0</span></span>    </td><td><span data-ttu-id="17423-608">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="17423-608">/24 (251)</span></span>    </td><td><span data-ttu-id="17423-609">Undernät för databasnoder</span><span class="sxs-lookup"><span data-stu-id="17423-609">Subnet for the database nodes</span></span></td></tr>
</table>


### <a name="step-2-create-local-networks"></a><span data-ttu-id="17423-610">Steg 2: Skapa lokala nätverk</span><span class="sxs-lookup"><span data-stu-id="17423-610">Step 2: Create Local Networks</span></span>
<span data-ttu-id="17423-611">Ett lokalt nätverk i Azure virtuella nätverk är en proxy-adressutrymme som mappar till en fjärrplats, inklusive ett privat moln eller en annan Azure-region.</span><span class="sxs-lookup"><span data-stu-id="17423-611">A Local Network in Azure virtual networking is a proxy address space that maps to a remote site including a private cloud or another Azure region.</span></span> <span data-ttu-id="17423-612">Det här adressutrymmet för proxy är bunden till en fjärr-gateway för routning nätverket till rätt nätverk mål.</span><span class="sxs-lookup"><span data-stu-id="17423-612">This proxy address space is bound to a remote gateway for routing network to the right networking destinations.</span></span> <span data-ttu-id="17423-613">Se [konfigurera ett virtuellt nätverk för virtuella nätverk anslutningen](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) anvisningar för VNET-till-VNET-anslutning upprättas.</span><span class="sxs-lookup"><span data-stu-id="17423-613">See [Configure a VNet to VNet Connection](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) for the instructions on establishing VNET-to-VNET connection.</span></span>

<span data-ttu-id="17423-614">Skapa två lokala nätverk per följande information:</span><span class="sxs-lookup"><span data-stu-id="17423-614">Create two local networks per the following details:</span></span>

| <span data-ttu-id="17423-615">Nätverksnamn</span><span class="sxs-lookup"><span data-stu-id="17423-615">Network Name</span></span> | <span data-ttu-id="17423-616">VPN Gateway-adress</span><span class="sxs-lookup"><span data-stu-id="17423-616">VPN Gateway Address</span></span> | <span data-ttu-id="17423-617">Adressutrymmet</span><span class="sxs-lookup"><span data-stu-id="17423-617">Address Space</span></span> | <span data-ttu-id="17423-618">Kommentarer</span><span class="sxs-lookup"><span data-stu-id="17423-618">Remarks</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="17423-619">HK-lnet-Map-to-East-US</span><span class="sxs-lookup"><span data-stu-id="17423-619">hk-lnet-map-to-east-us</span></span> |<span data-ttu-id="17423-620">23.1.1.1</span><span class="sxs-lookup"><span data-stu-id="17423-620">23.1.1.1</span></span> |<span data-ttu-id="17423-621">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="17423-621">10.2.0.0/16</span></span> |<span data-ttu-id="17423-622">När du skapar ge det lokala nätverket en platshållare för gateway-adress.</span><span class="sxs-lookup"><span data-stu-id="17423-622">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="17423-623">Verklig gateway-adressen är fylld när gatewayen har skapats.</span><span class="sxs-lookup"><span data-stu-id="17423-623">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="17423-624">Se till att adressutrymmet exakt matchar respektive Fjärrnätverket; i det här fallet skapas VNET i östra USA.</span><span class="sxs-lookup"><span data-stu-id="17423-624">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the East US region.</span></span> |
| <span data-ttu-id="17423-625">HK-lnet-Map-to-West-US</span><span class="sxs-lookup"><span data-stu-id="17423-625">hk-lnet-map-to-west-us</span></span> |<span data-ttu-id="17423-626">23.2.2.2</span><span class="sxs-lookup"><span data-stu-id="17423-626">23.2.2.2</span></span> |<span data-ttu-id="17423-627">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="17423-627">10.1.0.0/16</span></span> |<span data-ttu-id="17423-628">När du skapar ge det lokala nätverket en platshållare för gateway-adress.</span><span class="sxs-lookup"><span data-stu-id="17423-628">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="17423-629">Verklig gateway-adressen är fylld när gatewayen har skapats.</span><span class="sxs-lookup"><span data-stu-id="17423-629">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="17423-630">Se till att adressutrymmet exakt matchar respektive Fjärrnätverket; i det här fallet skapas VNET i USA, västra region.</span><span class="sxs-lookup"><span data-stu-id="17423-630">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the West US region.</span></span> |

### <a name="step-3-map-local-network-to-the-respective-vnets"></a><span data-ttu-id="17423-631">Steg 3: Karta ”lokalt” nätverk till respektive Vnet</span><span class="sxs-lookup"><span data-stu-id="17423-631">Step 3: Map “Local” network to the respective VNETs</span></span>
<span data-ttu-id="17423-632">Markera varje virtuellt nätverk från den klassiska Azure-portalen, klickar du på ”Konfigurera”, kontrollera ”ansluta till det lokala nätverket” och väljer du de lokala nätverk per följande information:</span><span class="sxs-lookup"><span data-stu-id="17423-632">From the Azure classic portal, select each vnet, click “Configure”, check “Connect to the local network”, and select the Local Networks per the following details:</span></span>

| <span data-ttu-id="17423-633">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="17423-633">Virtual Network</span></span> | <span data-ttu-id="17423-634">Lokalt nätverk</span><span class="sxs-lookup"><span data-stu-id="17423-634">Local Network</span></span> |
| --- | --- |
| <span data-ttu-id="17423-635">HK-vnet-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-635">hk-vnet-west-us</span></span> |<span data-ttu-id="17423-636">HK-lnet-Map-to-East-US</span><span class="sxs-lookup"><span data-stu-id="17423-636">hk-lnet-map-to-east-us</span></span> |
| <span data-ttu-id="17423-637">HK-vnet-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-637">hk-vnet-east-us</span></span> |<span data-ttu-id="17423-638">HK-lnet-Map-to-West-US</span><span class="sxs-lookup"><span data-stu-id="17423-638">hk-lnet-map-to-west-us</span></span> |

### <a name="step-4-create-gateways-on-vnet1-and-vnet2"></a><span data-ttu-id="17423-639">Steg 4: Skapa Gateways på VNET1 och VNET2</span><span class="sxs-lookup"><span data-stu-id="17423-639">Step 4: Create Gateways on VNET1 and VNET2</span></span>
<span data-ttu-id="17423-640">Klicka på Skapa GATEWAYEN som utlöser VPN-gatewayen etableringsprocessen från instrumentpanelen för virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="17423-640">From the dashboard of both the virtual networks, click CREATE GATEWAY which will trigger the VPN gateway provisioning process.</span></span> <span data-ttu-id="17423-641">Efter några minuter visas på instrumentpanelen i varje virtuellt nätverk bör faktiska gateway-adress.</span><span class="sxs-lookup"><span data-stu-id="17423-641">After a few minutes the dashboard of each virtual network should display the actual gateway address.</span></span>

### <a name="step-5-update-local-networks-with-the-respective-gateway-addresses"></a><span data-ttu-id="17423-642">Steg 5: Uppdatera ”lokala” nätverk med respektive ”Gateway”-adresser</span><span class="sxs-lookup"><span data-stu-id="17423-642">Step 5: Update “Local” networks with the respective “Gateway” addresses</span></span>
<span data-ttu-id="17423-643">Redigera både de lokala nätverk för att ersätta platshållare gateway IP-adress med bara etablerad gateway verkliga IP-adress.</span><span class="sxs-lookup"><span data-stu-id="17423-643">Edit both the local networks to replace the placeholder gateway IP address with the real IP address of the just provisioned gateways.</span></span> <span data-ttu-id="17423-644">Använd följande mappning:</span><span class="sxs-lookup"><span data-stu-id="17423-644">Use the following mapping:</span></span>

<table>
<tr><th><span data-ttu-id="17423-645">Lokalt nätverk</span><span class="sxs-lookup"><span data-stu-id="17423-645">Local Network</span></span>    </th><th><span data-ttu-id="17423-646">Virtuell nätverksgateway</span><span class="sxs-lookup"><span data-stu-id="17423-646">Virtual Network Gateway</span></span></th></tr>
<tr><td><span data-ttu-id="17423-647">HK-lnet-Map-to-East-US</span><span class="sxs-lookup"><span data-stu-id="17423-647">hk-lnet-map-to-east-us</span></span> </td><td><span data-ttu-id="17423-648">Gateway för hk-vnet-Väst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-648">Gateway of hk-vnet-west-us</span></span></td></tr>
<tr><td><span data-ttu-id="17423-649">HK-lnet-Map-to-West-US</span><span class="sxs-lookup"><span data-stu-id="17423-649">hk-lnet-map-to-west-us</span></span> </td><td><span data-ttu-id="17423-650">Gateway för hk-vnet-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-650">Gateway of hk-vnet-east-us</span></span></td></tr>
</table>

### <a name="step-6-update-the-shared-key"></a><span data-ttu-id="17423-651">Steg 6: Uppdatera delad nyckel</span><span class="sxs-lookup"><span data-stu-id="17423-651">Step 6: Update the shared key</span></span>
<span data-ttu-id="17423-652">Använd följande Powershell-skript för att uppdatera IPSec-nyckel för varje VPN-gateway [Använd saké nyckel för både gateway]: Set-AzureVNetGatewayKey - VNetName hk-vnet-Öst-oss - LocalNetworkSiteName hk-lnet-map-to-west-us - SharedKey D9E76BKK Set-AzureVNetGatewayKey - VNetName hk-vnet-Väst-oss - LocalNetworkSiteName hk-lnet-map-to-east-us - SharedKey D9E76BKK</span><span class="sxs-lookup"><span data-stu-id="17423-652">Use the following Powershell script to update the IPSec key of each VPN gateway [use the sake key for both the gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span></span>

### <a name="step-7-establish-the-vnet-to-vnet-connection"></a><span data-ttu-id="17423-653">Steg 7: Skapa VNET-till-VNET-anslutning</span><span class="sxs-lookup"><span data-stu-id="17423-653">Step 7: Establish the VNET-to-VNET connection</span></span>
<span data-ttu-id="17423-654">Använd menyn ”INSTRUMENTPANELEN” virtuella nätverk från den klassiska Azure-portalen för att upprätta en anslutning för gateway-till-gateway.</span><span class="sxs-lookup"><span data-stu-id="17423-654">From the Azure classic portal, use the “DASHBOARD” menu of both the virtual networks to establish gateway-to-gateway connection.</span></span> <span data-ttu-id="17423-655">Använd ”Anslut” menyalternativ i det nedersta verktygsfältet.</span><span class="sxs-lookup"><span data-stu-id="17423-655">Use the “CONNECT” menu items in the bottom toolbar.</span></span> <span data-ttu-id="17423-656">Efter några minuter ska instrumentpanelen visa anslutningsinformationen grafiskt.</span><span class="sxs-lookup"><span data-stu-id="17423-656">After a few minutes the dashboard should display the connection details graphically.</span></span>

### <a name="step-8-create-the-virtual-machines-in-region-2"></a><span data-ttu-id="17423-657">Steg 8: Skapa de virtuella datorerna i området #2</span><span class="sxs-lookup"><span data-stu-id="17423-657">Step 8: Create the virtual machines in region #2</span></span>
<span data-ttu-id="17423-658">Skapa avbildningen Ubuntu enligt beskrivningen i region #1 distribution genom att följa samma steg eller kopiera avbildningen VHD-filen till Azure storage-konto finns i området #2 och skapa avbildningen.</span><span class="sxs-lookup"><span data-stu-id="17423-658">Create the Ubuntu image as described in region #1 deployment by following the same steps or copy the image VHD file to the Azure storage account located in region #2 and create the image.</span></span> <span data-ttu-id="17423-659">Använd den här avbildningen och skapa följande lista över virtuella datorer till en ny molntjänst hk-c-svc-Öst-oss:</span><span class="sxs-lookup"><span data-stu-id="17423-659">Use this image and create the following list of virtual machines into a new cloud service hk-c-svc-east-us:</span></span>

| <span data-ttu-id="17423-660">Namnet på datorn</span><span class="sxs-lookup"><span data-stu-id="17423-660">Machine Name</span></span> | <span data-ttu-id="17423-661">Undernät</span><span class="sxs-lookup"><span data-stu-id="17423-661">Subnet</span></span> | <span data-ttu-id="17423-662">IP-adress</span><span class="sxs-lookup"><span data-stu-id="17423-662">IP Address</span></span> | <span data-ttu-id="17423-663">Tillgänglighetsuppsättning</span><span class="sxs-lookup"><span data-stu-id="17423-663">Availability set</span></span> | <span data-ttu-id="17423-664">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="17423-664">DC/Rack</span></span> | <span data-ttu-id="17423-665">Startvärde för?</span><span class="sxs-lookup"><span data-stu-id="17423-665">Seed?</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="17423-666">HK-c1-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-666">hk-c1-east-us</span></span> |<span data-ttu-id="17423-667">Data</span><span class="sxs-lookup"><span data-stu-id="17423-667">data</span></span> |<span data-ttu-id="17423-668">10.2.2.4</span><span class="sxs-lookup"><span data-stu-id="17423-668">10.2.2.4</span></span> |<span data-ttu-id="17423-669">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-669">hk-c-aset-1</span></span> |<span data-ttu-id="17423-670">DC = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="17423-670">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="17423-671">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-671">Yes</span></span> |
| <span data-ttu-id="17423-672">HK-c2-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-672">hk-c2-east-us</span></span> |<span data-ttu-id="17423-673">Data</span><span class="sxs-lookup"><span data-stu-id="17423-673">data</span></span> |<span data-ttu-id="17423-674">10.2.2.5</span><span class="sxs-lookup"><span data-stu-id="17423-674">10.2.2.5</span></span> |<span data-ttu-id="17423-675">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-675">hk-c-aset-1</span></span> |<span data-ttu-id="17423-676">DC = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="17423-676">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="17423-677">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-677">No</span></span> |
| <span data-ttu-id="17423-678">HK-c3-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-678">hk-c3-east-us</span></span> |<span data-ttu-id="17423-679">Data</span><span class="sxs-lookup"><span data-stu-id="17423-679">data</span></span> |<span data-ttu-id="17423-680">10.2.2.6</span><span class="sxs-lookup"><span data-stu-id="17423-680">10.2.2.6</span></span> |<span data-ttu-id="17423-681">HK-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-681">hk-c-aset-1</span></span> |<span data-ttu-id="17423-682">DC = EASTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="17423-682">dc =EASTUS rack =rack2</span></span> |<span data-ttu-id="17423-683">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-683">Yes</span></span> |
| <span data-ttu-id="17423-684">HK-c5-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-684">hk-c5-east-us</span></span> |<span data-ttu-id="17423-685">Data</span><span class="sxs-lookup"><span data-stu-id="17423-685">data</span></span> |<span data-ttu-id="17423-686">10.2.2.8</span><span class="sxs-lookup"><span data-stu-id="17423-686">10.2.2.8</span></span> |<span data-ttu-id="17423-687">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-687">hk-c-aset-2</span></span> |<span data-ttu-id="17423-688">DC = EASTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="17423-688">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="17423-689">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-689">Yes</span></span> |
| <span data-ttu-id="17423-690">HK-c6-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-690">hk-c6-east-us</span></span> |<span data-ttu-id="17423-691">Data</span><span class="sxs-lookup"><span data-stu-id="17423-691">data</span></span> |<span data-ttu-id="17423-692">10.2.2.9</span><span class="sxs-lookup"><span data-stu-id="17423-692">10.2.2.9</span></span> |<span data-ttu-id="17423-693">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-693">hk-c-aset-2</span></span> |<span data-ttu-id="17423-694">DC = EASTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="17423-694">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="17423-695">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-695">No</span></span> |
| <span data-ttu-id="17423-696">HK-c7-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-696">hk-c7-east-us</span></span> |<span data-ttu-id="17423-697">Data</span><span class="sxs-lookup"><span data-stu-id="17423-697">data</span></span> |<span data-ttu-id="17423-698">10.2.2.10</span><span class="sxs-lookup"><span data-stu-id="17423-698">10.2.2.10</span></span> |<span data-ttu-id="17423-699">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-699">hk-c-aset-2</span></span> |<span data-ttu-id="17423-700">DC = EASTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="17423-700">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="17423-701">Ja</span><span class="sxs-lookup"><span data-stu-id="17423-701">Yes</span></span> |
| <span data-ttu-id="17423-702">HK-c8-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-702">hk-c8-east-us</span></span> |<span data-ttu-id="17423-703">Data</span><span class="sxs-lookup"><span data-stu-id="17423-703">data</span></span> |<span data-ttu-id="17423-704">10.2.2.11</span><span class="sxs-lookup"><span data-stu-id="17423-704">10.2.2.11</span></span> |<span data-ttu-id="17423-705">HK-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="17423-705">hk-c-aset-2</span></span> |<span data-ttu-id="17423-706">DC = EASTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="17423-706">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="17423-707">Nej</span><span class="sxs-lookup"><span data-stu-id="17423-707">No</span></span> |
| <span data-ttu-id="17423-708">HK-w1-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-708">hk-w1-east-us</span></span> |<span data-ttu-id="17423-709">webbprogram</span><span class="sxs-lookup"><span data-stu-id="17423-709">web</span></span> |<span data-ttu-id="17423-710">10.2.1.4</span><span class="sxs-lookup"><span data-stu-id="17423-710">10.2.1.4</span></span> |<span data-ttu-id="17423-711">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-711">hk-w-aset-1</span></span> |<span data-ttu-id="17423-712">Saknas</span><span class="sxs-lookup"><span data-stu-id="17423-712">N/A</span></span> |<span data-ttu-id="17423-713">Saknas</span><span class="sxs-lookup"><span data-stu-id="17423-713">N/A</span></span> |
| <span data-ttu-id="17423-714">HK-w2-Öst-oss</span><span class="sxs-lookup"><span data-stu-id="17423-714">hk-w2-east-us</span></span> |<span data-ttu-id="17423-715">webbprogram</span><span class="sxs-lookup"><span data-stu-id="17423-715">web</span></span> |<span data-ttu-id="17423-716">10.2.1.5</span><span class="sxs-lookup"><span data-stu-id="17423-716">10.2.1.5</span></span> |<span data-ttu-id="17423-717">HK-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="17423-717">hk-w-aset-1</span></span> |<span data-ttu-id="17423-718">Saknas</span><span class="sxs-lookup"><span data-stu-id="17423-718">N/A</span></span> |<span data-ttu-id="17423-719">Saknas</span><span class="sxs-lookup"><span data-stu-id="17423-719">N/A</span></span> |

<span data-ttu-id="17423-720">Följ samma anvisningar som region #1 men använda 10.2.xxx.xxx adressutrymme.</span><span class="sxs-lookup"><span data-stu-id="17423-720">Follow the same instructions as region #1 but use 10.2.xxx.xxx address space.</span></span>

### <a name="step-9-configure-cassandra-on-each-vm"></a><span data-ttu-id="17423-721">Steg 9: Konfigurera Cassandra på varje virtuell dator</span><span class="sxs-lookup"><span data-stu-id="17423-721">Step 9: Configure Cassandra on each VM</span></span>
<span data-ttu-id="17423-722">Logga in på den virtuella datorn och utför följande:</span><span class="sxs-lookup"><span data-stu-id="17423-722">Log into the VM and perform the following:</span></span>

1. <span data-ttu-id="17423-723">Redigera $CASS_HOME/conf/cassandra-rackdc.properties för att ange egenskaper för data center och rack i formatet: dc = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="17423-723">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties in the format:  dc =EASTUS  rack =rack1</span></span>
2. <span data-ttu-id="17423-724">Redigera cassandra.yaml om du vill konfigurera seed noder: frö: ”10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10”</span><span class="sxs-lookup"><span data-stu-id="17423-724">Edit cassandra.yaml to configure seed nodes:  Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span></span>

### <a name="step-10-start-cassandra"></a><span data-ttu-id="17423-725">Steg 10: Starta Cassandra</span><span class="sxs-lookup"><span data-stu-id="17423-725">Step 10: Start Cassandra</span></span>
<span data-ttu-id="17423-726">Logga in på varje virtuell dator och starta Cassandra i bakgrunden genom att köra följande kommando: $CASS_HOME/bin/cassandra</span><span class="sxs-lookup"><span data-stu-id="17423-726">Log into each VM and start Cassandra in the background by running the following command: $CASS_HOME/bin/cassandra</span></span>

## <a name="test-the-multi-region-cluster"></a><span data-ttu-id="17423-727">Testa flera regioner klustret</span><span class="sxs-lookup"><span data-stu-id="17423-727">Test the Multi-Region Cluster</span></span>
<span data-ttu-id="17423-728">Nu har Cassandra distribuerats till 16 noder med 8 noder i varje Azure-region.</span><span class="sxs-lookup"><span data-stu-id="17423-728">By now Cassandra has been deployed to 16 nodes with 8 nodes in each Azure region.</span></span> <span data-ttu-id="17423-729">Dessa noder finns i samma kluster tack vare vanliga klusternamnet och nodkonfiguration startvärde.</span><span class="sxs-lookup"><span data-stu-id="17423-729">These nodes are in the same cluster by virtue of the common cluster name and the seed node configuration.</span></span> <span data-ttu-id="17423-730">Du kan använda följande process för att testa klustret:</span><span class="sxs-lookup"><span data-stu-id="17423-730">Use the following process to test the cluster:</span></span>

### <a name="step-1-get-the-internal-load-balancer-ip-for-both-the-regions-using-powershell"></a><span data-ttu-id="17423-731">Steg 1: Hämta den intern belastningsutjämnaren IP-Adressen för båda regioner med hjälp av PowerShell</span><span class="sxs-lookup"><span data-stu-id="17423-731">Step 1: Get the internal load balancer IP for both the regions using PowerShell</span></span>
* <span data-ttu-id="17423-732">Get-AzureInternalLoadbalancer - ServiceName ”hk-c-svc-Väst-oss”</span><span class="sxs-lookup"><span data-stu-id="17423-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span></span>
* <span data-ttu-id="17423-733">Get-AzureInternalLoadbalancer - ServiceName ”hk-c-svc-Öst-oss”</span><span class="sxs-lookup"><span data-stu-id="17423-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span></span>  
  
    <span data-ttu-id="17423-734">Observera de IP-adresserna (t.ex. west - 10.1.2.101, Öst - 10.2.2.101) visas.</span><span class="sxs-lookup"><span data-stu-id="17423-734">Note the IP addresses (e.g. west - 10.1.2.101, east - 10.2.2.101) displayed.</span></span>

### <a name="step-2-execute-the-following-in-the-west-region-after-logging-into-hk-w1-west-us"></a><span data-ttu-id="17423-735">Steg 2: Kör följande när du har loggat in hk-w1-Väst-oss i region Väst</span><span class="sxs-lookup"><span data-stu-id="17423-735">Step 2: Execute the following in the west region after logging into hk-w1-west-us</span></span>
1. <span data-ttu-id="17423-736">Köra $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="17423-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
2. <span data-ttu-id="17423-737">Kör följande kommandon för CQL:</span><span class="sxs-lookup"><span data-stu-id="17423-737">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="17423-738">Skapa KEYSPACE customers_ks med replikering = {'class': 'NetworkToplogyStrategy', 'WESTUS': 3, EASTUS: 3};   ANVÄNDA customers_ks;   Skapa tabell Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Infoga i Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   Infoga i Customers(customer_id, firstname, lastname) värden (2, ”Jane', 'Berg”).   Välj * från kunder.</span><span class="sxs-lookup"><span data-stu-id="17423-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="17423-739">Du bör se en skärm som liknar den nedan:</span><span class="sxs-lookup"><span data-stu-id="17423-739">You should see a display like the one below:</span></span>

| <span data-ttu-id="17423-740">customer_id</span><span class="sxs-lookup"><span data-stu-id="17423-740">customer_id</span></span> | <span data-ttu-id="17423-741">Förnamn</span><span class="sxs-lookup"><span data-stu-id="17423-741">firstname</span></span> | <span data-ttu-id="17423-742">Efternamn</span><span class="sxs-lookup"><span data-stu-id="17423-742">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="17423-743">1</span><span class="sxs-lookup"><span data-stu-id="17423-743">1</span></span> |<span data-ttu-id="17423-744">John</span><span class="sxs-lookup"><span data-stu-id="17423-744">John</span></span> |<span data-ttu-id="17423-745">Berg</span><span class="sxs-lookup"><span data-stu-id="17423-745">Doe</span></span> |
| <span data-ttu-id="17423-746">2</span><span class="sxs-lookup"><span data-stu-id="17423-746">2</span></span> |<span data-ttu-id="17423-747">Jane</span><span class="sxs-lookup"><span data-stu-id="17423-747">Jane</span></span> |<span data-ttu-id="17423-748">Berg</span><span class="sxs-lookup"><span data-stu-id="17423-748">Doe</span></span> |

### <a name="step-3-execute-the-following-in-the-east-region-after-logging-into-hk-w1-east-us"></a><span data-ttu-id="17423-749">Steg 3: Kör du följande i region Öst när du har loggat in hk-w1-Öst-oss:</span><span class="sxs-lookup"><span data-stu-id="17423-749">Step 3: Execute the following in the east region after logging into hk-w1-east-us:</span></span>
1. <span data-ttu-id="17423-750">Köra $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="17423-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span></span>
2. <span data-ttu-id="17423-751">Kör följande kommandon för CQL:</span><span class="sxs-lookup"><span data-stu-id="17423-751">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="17423-752">ANVÄNDA customers_ks;   Skapa tabell Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Infoga i Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   Infoga i Customers(customer_id, firstname, lastname) värden (2, ”Jane', 'Berg”).   Välj * från kunder.</span><span class="sxs-lookup"><span data-stu-id="17423-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="17423-753">Du bör se samma skärm som visas för regionen Väst:</span><span class="sxs-lookup"><span data-stu-id="17423-753">You should see the same display as seen for the West region:</span></span>

| <span data-ttu-id="17423-754">customer_id</span><span class="sxs-lookup"><span data-stu-id="17423-754">customer_id</span></span> | <span data-ttu-id="17423-755">Förnamn</span><span class="sxs-lookup"><span data-stu-id="17423-755">firstname</span></span> | <span data-ttu-id="17423-756">Efternamn</span><span class="sxs-lookup"><span data-stu-id="17423-756">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="17423-757">1</span><span class="sxs-lookup"><span data-stu-id="17423-757">1</span></span> |<span data-ttu-id="17423-758">John</span><span class="sxs-lookup"><span data-stu-id="17423-758">John</span></span> |<span data-ttu-id="17423-759">Berg</span><span class="sxs-lookup"><span data-stu-id="17423-759">Doe</span></span> |
| <span data-ttu-id="17423-760">2</span><span class="sxs-lookup"><span data-stu-id="17423-760">2</span></span> |<span data-ttu-id="17423-761">Jane</span><span class="sxs-lookup"><span data-stu-id="17423-761">Jane</span></span> |<span data-ttu-id="17423-762">Berg</span><span class="sxs-lookup"><span data-stu-id="17423-762">Doe</span></span> |

<span data-ttu-id="17423-763">Köra några fler infogningar och se att de replikeras till Väst-oss ingår i klustret.</span><span class="sxs-lookup"><span data-stu-id="17423-763">Execute a few more inserts and see that those get replicated to west-us part of the cluster.</span></span>

## <a name="test-cassandra-cluster-from-nodejs"></a><span data-ttu-id="17423-764">Cassandra Testklustret från Node.js</span><span class="sxs-lookup"><span data-stu-id="17423-764">Test Cassandra Cluster from Node.js</span></span>
<span data-ttu-id="17423-765">Använder en Linux virtuella datorer som skapats i ”web” tjänstnivån tidigare, vi ska köra en enkel Node.js-skript för att läsa tidigare infogade data</span><span class="sxs-lookup"><span data-stu-id="17423-765">Using one of the Linux VMs crated in the "web" tier previously, we will execute a simple Node.js script to read the previously inserted data</span></span>

<span data-ttu-id="17423-766">**Steg 1: Installera Node.js och Cassandra-klienten**</span><span class="sxs-lookup"><span data-stu-id="17423-766">**Step 1: Install Node.js and Cassandra Client**</span></span>

1. <span data-ttu-id="17423-767">Installera Node.js och npm</span><span class="sxs-lookup"><span data-stu-id="17423-767">Install Node.js and npm</span></span>
2. <span data-ttu-id="17423-768">Installera nod paketet ”cassandra-klient” med hjälp av npm</span><span class="sxs-lookup"><span data-stu-id="17423-768">Install node package "cassandra-client" using npm</span></span>
3. <span data-ttu-id="17423-769">Kör följande skript i Kommandotolken shell som visar json-strängen för hämtade data:</span><span class="sxs-lookup"><span data-stu-id="17423-769">Execute the following script at the shell prompt which displays the json string of the retrieved data:</span></span>
   
        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };
   
        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed to create Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }
   
        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed to create column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }
   
        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);
   
           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }
   
        //update will also insert the record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }
   
        //read the two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }
   
        //exectue the code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)

## <a name="conclusion"></a><span data-ttu-id="17423-770">Slutsats</span><span class="sxs-lookup"><span data-stu-id="17423-770">Conclusion</span></span>
<span data-ttu-id="17423-771">Microsoft Azure är en flexibel plattform som tillåter körning av både Microsoft samt programvara med öppen källkod som visas av den här övningen.</span><span class="sxs-lookup"><span data-stu-id="17423-771">Microsoft Azure is a flexible platform that allows the running of both Microsoft as well as open source software as demonstrated by this exercise.</span></span> <span data-ttu-id="17423-772">Hög tillgänglighet Cassandra kluster kan distribueras på ett enda datacenter genom att sprida klusternoder över flera feldomäner.</span><span class="sxs-lookup"><span data-stu-id="17423-772">Highly available Cassandra clusters can be deployed on a single data center through the spreading of the cluster nodes across multiple fault domains.</span></span> <span data-ttu-id="17423-773">Cassandra kluster kan också distribueras över flera Azure geografiskt avlägsna regioner för katastrofåterställning bevis system.</span><span class="sxs-lookup"><span data-stu-id="17423-773">Cassandra clusters can also be deployed across multiple geographically distant Azure regions for disaster proof systems.</span></span> <span data-ttu-id="17423-774">Azure och Cassandra aktiverar tillsammans konstruktionen av skalbara, hög tillgänglighet och katastrofåterställning återställningsbara molntjänster behövs dagens internet skalas tjänster.</span><span class="sxs-lookup"><span data-stu-id="17423-774">Azure and Cassandra together enables the construction of highly scalable, highly available and disaster recoverable cloud services needed by today's internet scale services.</span></span>  

## <a name="references"></a><span data-ttu-id="17423-775">Referenser</span><span class="sxs-lookup"><span data-stu-id="17423-775">References</span></span>
* [<span data-ttu-id="17423-776">http://cassandra.apache.org</span><span class="sxs-lookup"><span data-stu-id="17423-776">http://cassandra.apache.org</span></span>](http://cassandra.apache.org)
* [<span data-ttu-id="17423-777">http://www.datastax.com</span><span class="sxs-lookup"><span data-stu-id="17423-777">http://www.datastax.com</span></span>](http://www.datastax.com)
* [<span data-ttu-id="17423-778">http://www.nodejs.org</span><span class="sxs-lookup"><span data-stu-id="17423-778">http://www.nodejs.org</span></span>](http://www.nodejs.org)

