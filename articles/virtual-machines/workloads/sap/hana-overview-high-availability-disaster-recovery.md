---
title: "aaaHigh tillgänglighet och katastrofåterställning återställning av SAP HANA i Azure (stora instanser) | Microsoft Docs"
description: "Upprätta hög tillgänglighet och planera för katastrofåterställning för SAP HANA i Azure (stora instanser)."
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 0c0967f54cf29bbb275eb7cda9d36608488add9e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-large-instances-high-availability-and-disaster-recovery-on-azure"></a><span data-ttu-id="0c3ea-103">SAP HANA (stora instanser) hög tillgänglighet och katastrofåterställning recovery på Azure</span><span class="sxs-lookup"><span data-stu-id="0c3ea-103">SAP HANA (large instances) high availability and disaster recovery on Azure</span></span> 

<span data-ttu-id="0c3ea-104">Hög tillgänglighet och katastrofåterställning är viktiga aspekter av din verksamhetskritiska SAP HANA i Azure (stora instanser) servrar.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-104">High availability and disaster recovery are important aspects of running your mission-critical SAP HANA on Azure (large instances) servers.</span></span> <span data-ttu-id="0c3ea-105">Det är viktigt toowork med SAP, din systemintegreraren, eller Microsoft tooproperly systemarkitekter och implementera hello strategi för åt höger hög-tillgänglighet/katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-105">It's important toowork with SAP, your system integrator, or Microsoft tooproperly architect and implement hello right high-availability/disaster-recovery strategy.</span></span> <span data-ttu-id="0c3ea-106">Det är också viktigt tooconsider hello återställningspunktmål och mål, som är specifika tooyour miljö.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-106">It is also important tooconsider hello recovery point objective and recovery time objective, which are specific tooyour environment.</span></span>

## <a name="high-availability"></a><span data-ttu-id="0c3ea-107">Hög tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="0c3ea-107">High availability</span></span>

<span data-ttu-id="0c3ea-108">Microsoft stöder SAP HANA hög tillgänglighet metoder ”out-of-hello rutan” bland annat:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-108">Microsoft supports SAP HANA high-availability methods "out of hello box," which include:</span></span>

- <span data-ttu-id="0c3ea-109">**Storage-replikering:** hello storage-system kan tooreplicate alla tooanother plats (inom, eller separat från hello samma datacenter).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-109">**Storage replication:** hello storage system's ability tooreplicate all data tooanother location (within, or separate from, hello same datacenter).</span></span> <span data-ttu-id="0c3ea-110">SAP HANA fungerar oberoende av den här metoden.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-110">SAP HANA operates independently of this method.</span></span>
- <span data-ttu-id="0c3ea-111">**HANA system replikering:** hello replikering av alla data i SAP HANA tooa separat SAP HANA-system.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-111">**HANA system replication:** hello replication of all data in SAP HANA tooa separate SAP HANA system.</span></span> <span data-ttu-id="0c3ea-112">mål för hello minimeras via datareplikering med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-112">hello recovery time objective is minimized through data replication at regular intervals.</span></span> <span data-ttu-id="0c3ea-113">SAP HANA stöder asynkrona, synkron i minnet och synkront läge (rekommenderas endast för SAP HANA system som är inom hello samma datacenter eller mindre än 100 KM från varandra).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-113">SAP HANA supports asynchronous, synchronous in-memory, and synchronous modes (recommended only for SAP HANA systems that are within hello same datacenter or less than 100 KM apart).</span></span> <span data-ttu-id="0c3ea-114">I hello aktuella designen av HANA stora instans stämplar kan HANA system replikering användas för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-114">In hello current design of HANA large-instance stamps, HANA system replication can be used for high availability only.</span></span>
- <span data-ttu-id="0c3ea-115">**Värd för automatisk redundans:** en lokal fel återställningspunkt lösning toouse som en alternativ toosystem replikering.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-115">**Host auto-failover:** A local fault-recovery solution toouse as an alternative toosystem replication.</span></span> <span data-ttu-id="0c3ea-116">När hello huvudnoden blir otillgänglig, en eller flera vänteläge SAP HANA-noder som är konfigurerade i skalbar läge och SAP HANA växlar automatiskt tooanother nod.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-116">When hello master node becomes unavailable, one or more standby SAP HANA nodes are configured in scale-out mode and SAP HANA automatically fails over tooanother node.</span></span>

<span data-ttu-id="0c3ea-117">Mer information om hög tillgänglighet för SAP HANA finns hello följande SAP-information:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-117">For more information on SAP HANA high availability, see hello following SAP information:</span></span>

- [<span data-ttu-id="0c3ea-118">Vitboken för SAP HANA hög tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="0c3ea-118">SAP HANA High-Availability Whitepaper</span></span>](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html)
- [<span data-ttu-id="0c3ea-119">SAP HANA Administrationsguide</span><span class="sxs-lookup"><span data-stu-id="0c3ea-119">SAP HANA Administration Guide</span></span>](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf)
- [<span data-ttu-id="0c3ea-120">SAP Academy videon på SAP HANA System-replikering</span><span class="sxs-lookup"><span data-stu-id="0c3ea-120">SAP Academy Video on SAP HANA System Replication</span></span>](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication)
- [<span data-ttu-id="0c3ea-121">SAP stöd Obs #1999880 – vanliga frågor och svar på SAP HANA System-replikering</span><span class="sxs-lookup"><span data-stu-id="0c3ea-121">SAP Support Note #1999880 – FAQ on SAP HANA System Replication</span></span>](https://bcs.wdf.sap.corp/sap/support/notes/1999880)
- <span data-ttu-id="0c3ea-122">[SAP stöd Obs #2165547 – SAP HANA säkerhetskopiering och återställning i SAP HANA-systemmiljön replikering](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-122">[SAP Support Note #2165547 – SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span></span>
- <span data-ttu-id="0c3ea-123">[SAP stöd Obs #1984882 – med SAP HANA System replikering för maskinvara Exchange med minsta/noll avbrottstid](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-123">[SAP Support Note #1984882 – Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span></span>

## <a name="disaster-recovery"></a><span data-ttu-id="0c3ea-124">Haveriberedskap</span><span class="sxs-lookup"><span data-stu-id="0c3ea-124">Disaster recovery</span></span>

<span data-ttu-id="0c3ea-125">SAP HANA i Azure (stora instanser) erbjuds i två Azure-regioner i en geopolitiska region.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-125">SAP HANA on Azure (large instances) is offered in two Azure regions in a geopolitical region.</span></span> <span data-ttu-id="0c3ea-126">Är en direkt nätverksanslutning för att replikera data vid katastrofåterställning mellan hello två stora instans stämplar för två olika regioner.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-126">Between hello two large-instance stamps of two different regions is a direct network connectivity for replicating data during disaster recovery.</span></span> <span data-ttu-id="0c3ea-127">hello replikeras hello data lagringsinfrastruktur baserat.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-127">hello replication of hello data is storage-infrastructure based.</span></span> <span data-ttu-id="0c3ea-128">hello replikering görs inte som standard.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-128">hello replication is not done by default.</span></span> <span data-ttu-id="0c3ea-129">Den är klar för hello kundkonfigurationer som sorterade hello katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-129">It is done for hello customer configurations that ordered hello disaster recovery.</span></span> <span data-ttu-id="0c3ea-130">HANA system replikering kan inte användas för katastrofåterställning i hello aktuella designen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-130">In hello current design, HANA system replication can't be used for disaster recovery.</span></span>

<span data-ttu-id="0c3ea-131">Dock tootake nytta av hello katastrofåterställning, behöver du toostart toodesign hello network connectivity toohello två olika Azure-regioner.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-131">However, tootake advantage of hello disaster recovery, you need toostart toodesign hello network connectivity toohello two different Azure regions.</span></span> <span data-ttu-id="0c3ea-132">toodo så du behöver ett Azure ExpressRoute-kretsen anslutningen från lokala i dina viktigaste Azure-regionen och en annan krets anslutning från lokala tooyour katastrofåterställning region.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-132">toodo so, you need an Azure ExpressRoute circuit connection from on-premises in your main Azure region and another circuit connection from on-premises tooyour disaster-recovery region.</span></span> <span data-ttu-id="0c3ea-133">Det här måttet bör ge en situation där en fullständig Azure-region, inklusive en Microsoft enterprise edge router (MSEE) plats, har ett problem.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-133">This measure would cover a situation in which a complete Azure region, including a Microsoft enterprise edge router (MSEE) location, has an issue.</span></span>

<span data-ttu-id="0c3ea-134">Du kan ansluta alla virtuella Azure-nätverk som ansluter tooSAP HANA i Azure (stora instanser) i ett hello regioner tooboth av dessa ExpressRoute-kretsar som en andra åtgärd.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-134">As a second measure, you can connect all Azure virtual networks that connect tooSAP HANA on Azure (large instances) in one of hello regions tooboth of those ExpressRoute circuits.</span></span> <span data-ttu-id="0c3ea-135">Det här måttet adresser fall där endast en av platserna som hello MSEE som ansluter din lokala plats med Azure kan lämna avgift.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-135">This measure addresses a case where only one of hello MSEE locations that connects your on-premises location with Azure goes off duty.</span></span>

<span data-ttu-id="0c3ea-136">hello visar följande bild hello optimal konfiguration för katastrofåterställning:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-136">hello following figure shows hello optimal configuration for disaster recovery:</span></span>

![Bästa konfigurationen för katastrofåterställning](./media/hana-overview-high-availability-disaster-recovery/image1-optimal-configuration.png)

<span data-ttu-id="0c3ea-138">hello är optimala fallet för en katastrofåterställning konfigurationen av hello nätverket toohave två ExpressRoute-kretsar från lokala toohello två olika Azure-regioner.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-138">hello optimal case for a disaster-recovery configuration of hello network is toohave two ExpressRoute circuits from on-premises toohello two different Azure regions.</span></span> <span data-ttu-id="0c3ea-139">En krets går tooregion #1, kör en instans för produktion.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-139">One circuit goes tooregion #1, running a production instance.</span></span> <span data-ttu-id="0c3ea-140">hello andra ExpressRoute-krets går tooregion #2, kör vissa icke-produktion HANA instanser.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-140">hello second ExpressRoute circuit goes tooregion #2, running some non-production HANA instances.</span></span> <span data-ttu-id="0c3ea-141">(Detta är viktigt om en hel Azure-region, inklusive hello MSEE och stora instans stämpel stängs av hello rutnät.)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-141">(This is important if an entire Azure region, including hello MSEE and large-instance stamp, goes off hello grid.)</span></span>

<span data-ttu-id="0c3ea-142">Som en andra åtgärd hello olika virtuella nätverk är anslutna toohello olika ExpressRoute-kretsar som är anslutna tooSAP HANA i Azure (stora instanser).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-142">As a second measure, hello various virtual networks are connected toohello various ExpressRoute circuits that are connected tooSAP HANA on Azure (large instances).</span></span> <span data-ttu-id="0c3ea-143">Du kan kringgå hello plats där en MSEE misslyckas eller så kan du sänka hello mål för återställningspunkt för katastrofåterställning, diskussion senare.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-143">You can bypass hello location where an MSEE is failing, or you can lower hello recovery point objective for disaster recovery, as we discuss later.</span></span>

<span data-ttu-id="0c3ea-144">hello nästa kraven för en katastrofåterställning installation är:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-144">hello next requirements for a disaster-recovery setup are:</span></span>

- <span data-ttu-id="0c3ea-145">På Azure (stora instanser) SKU: er av hello samma storlek som din produktion SKU: er och distribuera dem i hello katastrofåterställning region måste du sortera SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-145">You must order SAP HANA on Azure (large instances) SKUs of hello same size as your production SKUs and deploy them in hello disaster-recovery region.</span></span> <span data-ttu-id="0c3ea-146">Dessa instanser kan vara används toorun test, sandbox eller QA HANA instanser.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-146">These instances can be used toorun test, sandbox, or QA HANA instances.</span></span>
- <span data-ttu-id="0c3ea-147">Du måste sortera en profil för katastrofåterställning för varje din SAP HANA på Azure (stora instanser) SKU: er som du vill toorecover i hello återställningsplats, om det behövs.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-147">You must order a disaster-recovery profile for each of your SAP HANA on Azure (large instances) SKUs that you want toorecover in hello disaster-recovery site, if necessary.</span></span> <span data-ttu-id="0c3ea-148">Den här åtgärden leder toohello fördelning av lagringsvolymer som hello målet för hello lagringsreplikering från din produktionsregion till hello katastrofåterställning region.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-148">This action leads toohello allocation of storage volumes, which are hello target of hello storage replication from your production region into hello disaster-recovery region.</span></span>

<span data-ttu-id="0c3ea-149">När du uppfyller hello föregående krav är ditt ansvar toostart hello storage-replikering.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-149">After you meet hello preceding requirements, it is your responsibility toostart hello storage replication.</span></span> <span data-ttu-id="0c3ea-150">I hello lagringsinfrastruktur som används för SAP HANA i Azure (stora instanser), är hello basen för storage-replikering lagring ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-150">In hello storage infrastructure used for SAP HANA on Azure (large instances), hello basis of storage replication is storage snapshots.</span></span> <span data-ttu-id="0c3ea-151">toostart hello katastrofåterställning replikering, behöver du tooperform:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-151">toostart hello disaster-recovery replication, you need tooperform:</span></span>

- <span data-ttu-id="0c3ea-152">En ögonblicksbild av startenheter LUN, enligt beskrivningen ovan.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-152">A snapshot of your boot LUN, as described earlier.</span></span>
- <span data-ttu-id="0c3ea-153">En ögonblicksbild av dina HANA-relaterade volymer, som tidigare beskrivits.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-153">A snapshot of your HANA-related volumes, as described earlier.</span></span>

<span data-ttu-id="0c3ea-154">När du kör dessa ögonblicksbilder, dirigeras en första replik av hello volymer på hello volymer som är associerade med din profil för katastrofåterställning i hello katastrofåterställning region.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-154">After you execute these snapshots, an initial replica of hello volumes is seeded on hello volumes that are associated with your disaster-recovery profile in hello disaster-recovery region.</span></span>

<span data-ttu-id="0c3ea-155">Därefter hello senaste lagring ögonblicksbild används varje timme tooreplicate hello går som utvecklar på hello lagringsvolymer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-155">Subsequently, hello most recent storage snapshot is used every hour tooreplicate hello deltas that develop on hello storage volumes.</span></span>

<span data-ttu-id="0c3ea-156">hello mål för återställningspunkt som uppnås med den här konfigurationen är 60 minuter för too90.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-156">hello recovery point objective that's achieved with this configuration is from 60 too90 minutes.</span></span> <span data-ttu-id="0c3ea-157">tooachieve återställning av en bättre återställningspunktmål i hello katastrofåterställning fallet kopiera hello HANA säkerhetskopieringar av transaktionsloggen från SAP HANA på Azure (stora instanser) toohello andra Azure-region.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-157">tooachieve a better recovery point objective in hello disaster-recovery case, copy hello HANA transaction log backups from SAP HANA on Azure (large instances) toohello other Azure region.</span></span> <span data-ttu-id="0c3ea-158">tooachieve denna återställningspunktmål hello följande:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-158">tooachieve this recovery point objective, do hello following:</span></span>

1. <span data-ttu-id="0c3ea-159">Logga så ofta som möjligt för eller hana/log/säkerhetskopiering säkerhetskopierar hello HANA transaktion.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-159">Back up hello HANA transaction log as frequently as possible too/hana/log/backup.</span></span>
2. <span data-ttu-id="0c3ea-160">Kopiera hello säkerhetskopieringar av transaktionsloggen när de är klar tooan Azure virtuell dator (VM), som är i ett virtuellt nätverk som har anslutit toohello SAP HANA på Azure (stora instanser)-server.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-160">Copy hello transaction log backups when they are finished tooan Azure virtual machine (VM), which is in a virtual network that's connected toohello SAP HANA on Azure (large instances) server.</span></span>
3. <span data-ttu-id="0c3ea-161">Kopiera hello säkerhetskopiering tooa virtuell dator som är i ett virtuellt nätverk i hello katastrofåterställning region från den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-161">From that VM, copy hello backup tooa VM that's in a virtual network in hello disaster-recovery region.</span></span>
4. <span data-ttu-id="0c3ea-162">Behåll hello transaktion säkerhetskopior i regionen i hello VM.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-162">Keep hello transaction log backups in that region in hello VM.</span></span>

<span data-ttu-id="0c3ea-163">Vid katastrofåterställning, när hello katastrofåterställning profil har distribuerats på en faktiska server, kopierar hello säkerhetskopieringar av transaktionsloggen från hello VM toohello SAP HANA i Azure (stora instanser) som är nu hello primära servern i hello katastrofåterställning region, och återställa dessa säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-163">In case of disaster, after hello disaster-recovery profile has been deployed on an actual server, copy hello transaction log backups from hello VM toohello SAP HANA on Azure (large instances) that is now hello primary server in hello disaster-recovery region, and restore those backups.</span></span> <span data-ttu-id="0c3ea-164">Denna återställning är möjlig eftersom hello HANA på hello katastrofåterställning diskar är som en HANA ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-164">This recovery is possible because hello state of HANA on hello disaster-recovery disks is that of a HANA snapshot.</span></span> <span data-ttu-id="0c3ea-165">Detta är hello förskjutningen för ytterligare återställningar av säkerhetskopieringar av transaktionsloggen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-165">This is hello offset point for further restorations of transaction log backups.</span></span>

## <a name="backup-and-restore"></a><span data-ttu-id="0c3ea-166">Säkerhetskopiering och återställning</span><span class="sxs-lookup"><span data-stu-id="0c3ea-166">Backup and restore</span></span>

<span data-ttu-id="0c3ea-167">Kontrollera hello de viktigaste aspekterna toooperating databaserna hello databas kan skyddas från olika katastrofer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-167">One of hello most important aspects toooperating databases is making sure hello database can be protected from various catastrophic events.</span></span> <span data-ttu-id="0c3ea-168">Dessa händelser kan orsakas av något från naturkatastrof toosimple användarfel.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-168">These events can be caused by anything from natural disasters toosimple user errors.</span></span>

<span data-ttu-id="0c3ea-169">Säkerhetskopiera en databas med hello möjlighet toorestore den tooany punkt i tiden (som innan någon bort kritiska data), kan återställningen tooa tillstånd som är så nära som möjligt toohello sätt innan hello avbrott inträffade.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-169">Backing up a database, with hello ability toorestore it tooany point in time (such as before somebody deleted critical data), allows restoration tooa state that is as close as possible toohello way it was before hello disruption occurred.</span></span>

<span data-ttu-id="0c3ea-170">Två typer av säkerhetskopior måste utföras för bästa resultat:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-170">Two types of backups must be performed for best results:</span></span>

- <span data-ttu-id="0c3ea-171">Säkerhetskopior av databasen</span><span class="sxs-lookup"><span data-stu-id="0c3ea-171">Database backups</span></span>
- <span data-ttu-id="0c3ea-172">Säkerhetskopieringar av transaktionsloggen</span><span class="sxs-lookup"><span data-stu-id="0c3ea-172">Transaction log backups</span></span>

<span data-ttu-id="0c3ea-173">Dessutom toofull databassäkerhetskopieringar utförs på en på programnivå, du kan vara ännu mer omfattande genom att utföra säkerhetskopieringar med lagring ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-173">In addition toofull database backups performed at an application-level, you can be even more thorough by performing backups with storage snapshots.</span></span> <span data-ttu-id="0c3ea-174">Utför säkerhetskopior är också viktigt för att återställa databasen hello (och tooempty hello loggar från redan genomförda transaktioner).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-174">Performing log backups is also important for restoring hello database (and tooempty hello logs from already committed transactions).</span></span>

<span data-ttu-id="0c3ea-175">SAP HANA i Azure (stora instanser) erbjuder två alternativ för säkerhetskopiering och återställning:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-175">SAP HANA on Azure (large instances) offers two backup and restore options:</span></span>

- <span data-ttu-id="0c3ea-176">Göra det själv (DIY).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-176">Do it yourself (DIY).</span></span> <span data-ttu-id="0c3ea-177">När du beräknar tooensure tillräckligt mycket ledigt diskutrymme, utföra fullständiga säkerhetskopieringar för databasen och loggfiler med disk säkerhetskopieringsmetoder (toothose diskar).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-177">After you calculate tooensure enough disk space, perform full database and log backups by using disk backup methods (toothose disks).</span></span> <span data-ttu-id="0c3ea-178">Över tiden, hello säkerhetskopior är kopierade tooan Azure storage-konto (när du har skapat ett Azure-baserad filserver med praktiskt taget obegränsade storage) eller Använd ett Azure Backup-valv eller Azure kall lagring.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-178">Over time, hello backups are copied tooan Azure storage account (after you set up an Azure-based file server with virtually unlimited storage), or use an Azure Backup vault or Azure cold storage.</span></span> <span data-ttu-id="0c3ea-179">Ett annat alternativ är toouse ett tredje parts data protection verktyg, till exempel Commvault toostore hello säkerhetskopieringar när de har kopierats tooa storage-konto.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-179">Another option is toouse a third-party data protection tool, such as Commvault, toostore hello backups after they are copied tooa storage account.</span></span> <span data-ttu-id="0c3ea-180">hello själv alternativet kan också krävas för data som behöver toobe lagras under längre perioder för kompatibilitet och granskning.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-180">hello DIY backup option might also be necessary for data that needs toobe stored for longer periods for compliancy and auditing purposes.</span></span>
- <span data-ttu-id="0c3ea-181">Använd hello säkerhetskopiering och återställning av funktioner som hello underliggande infrastruktur för SAP HANA i Azure (stora instanser) tillhandahåller.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-181">Use hello backup and restore functionality that hello underlying infrastructure of SAP HANA on Azure (large instances) provides.</span></span> <span data-ttu-id="0c3ea-182">Det här alternativet uppfyller hello behovet av säkerhetskopieringar och det gör manuella säkerhetskopieringar nästan föråldrade (utom där säkerhetskopiering av data krävs för efterlevnad).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-182">This option fulfills hello need for backups, and it makes manual backups nearly obsolete (except where data backups are required for compliance purposes).</span></span> <span data-ttu-id="0c3ea-183">hello resten av det här avsnittet adresser hello säkerhetskopiering och återställning av funktioner som erbjuds med HANA (stora instanser).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-183">hello rest of this section addresses hello backup and restore functionality that's offered with HANA (large instances).</span></span>

> [!NOTE]
> <span data-ttu-id="0c3ea-184">hello ögonblicksbild teknik som används av hello underliggande infrastruktur HANA (stora instanser) har ett beroende på SAP HANA ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-184">hello snapshot technology that is used by hello underlying infrastructure of HANA (large instances) has a dependency on SAP HANA snapshots.</span></span> <span data-ttu-id="0c3ea-185">SAP HANA ögonblicksbilder fungerar inte tillsammans med SAP HANA Multitenant databasen behållare.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-185">SAP HANA snapshots do not work in conjunction with SAP HANA Multitenant Database Containers.</span></span> <span data-ttu-id="0c3ea-186">Den här metoden för säkerhetskopiering måste därför använda toodeploy SAP HANA Multitenant databasen behållare.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-186">As a result, this method of backup cannot be used toodeploy SAP HANA Multitenant Database Containers.</span></span>

### <a name="using-storage-snapshots-of-sap-hana-on-azure-large-instances"></a><span data-ttu-id="0c3ea-187">Med hjälp av ögonblicksbilder för lagring av SAP HANA i Azure (stora instanser)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-187">Using storage snapshots of SAP HANA on Azure (large instances)</span></span>

<span data-ttu-id="0c3ea-188">hello lagringsinfrastruktur underliggande SAP HANA i Azure (stora instanser) stöder hello begreppet en ögonblicksbild för lagring av volymer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-188">hello storage infrastructure underlying SAP HANA on Azure (large instances) supports hello notion of a storage snapshot of volumes.</span></span> <span data-ttu-id="0c3ea-189">Både säkerhetskopiering och återställning av en viss volym stöds, med hello följande överväganden:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-189">Both backup and restoration of a particular volume are supported, with hello following considerations:</span></span>

- <span data-ttu-id="0c3ea-190">I stället för säkerhetskopiering av databaser vidtas ögonblicksbilder av lagring regelbundet.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-190">Instead of database backups, storage volume snapshots are taken on a frequent basis.</span></span>
- <span data-ttu-id="0c3ea-191">hello lagring ögonblicksbild initierar en SAP HANA-ögonblicksbild innan hello lagring ögonblicksbild körs.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-191">hello storage snapshot initiates an SAP HANA snapshot before it executes hello storage snapshot.</span></span> <span data-ttu-id="0c3ea-192">SAP HANA ögonblicksbilden är hello installationsprogrammet punkt för eventuell loggen återställningar efter återställning av hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-192">This SAP HANA snapshot is hello setup point for eventual log restorations after recovery of hello storage snapshot.</span></span>
- <span data-ttu-id="0c3ea-193">Vid hello punkt där hello lagring ögonblicksbild har körts, tas hello SAP HANA ögonblicksbild bort.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-193">At hello point where hello storage snapshot is executed successfully, hello SAP HANA snapshot is deleted.</span></span>
- <span data-ttu-id="0c3ea-194">Säkerhetskopior av tas ofta och lagras i hello loggvolym för säkerhetskopiering eller i Azure.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-194">Log backups are taken frequently and stored in hello log backup volume or in Azure.</span></span>
- <span data-ttu-id="0c3ea-195">Om hello databas måste återställas tooa vissa punkt i tiden, en förfrågan görs tooMicrosoft Azure-supporten (produktion avbrott) eller SAP HANA på Azure-tjänsthantering toorestore tooa vissa lagring ögonblicksbild (till exempel en planerad återställning av ett begränsat system tooits ursprungliga tillstånd).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-195">If hello database must be restored tooa certain point in time, a request is made tooMicrosoft Azure Support (production outage) or SAP HANA on Azure Service Management toorestore tooa certain storage snapshot (for example, a planned restoration of a sandbox system tooits original state).</span></span>
- <span data-ttu-id="0c3ea-196">hello SAP HANA ögonblicksbild som ingår i hello lagring ögonblicksbild är en offset för att tillämpa säkerhetskopior som har körts och lagrade när hello lagring ögonblicksbilden togs.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-196">hello SAP HANA snapshot that's included in hello storage snapshot is an offset point for applying log backups that have been executed and stored after hello storage snapshot was taken.</span></span>
- <span data-ttu-id="0c3ea-197">Dessa säkerhetskopior kommer toorestore hello databasen tillbaka tooa vissa peka i tid.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-197">These log backups are taken toorestore hello database back tooa certain point in time.</span></span>

<span data-ttu-id="0c3ea-198">Säkerhetskopiering för att ange hello\_namn skapas en ögonblicksbild av hello följande volymer:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-198">Specifying hello backup\_name creates a snapshot of hello following volumes:</span></span>

- <span data-ttu-id="0c3ea-199">Hana-data</span><span class="sxs-lookup"><span data-stu-id="0c3ea-199">hana/data</span></span>
- <span data-ttu-id="0c3ea-200">Hana/logg</span><span class="sxs-lookup"><span data-stu-id="0c3ea-200">hana/log</span></span>
- <span data-ttu-id="0c3ea-201">Hana eller in\_säkerhetskopiering (monterade som säkerhetskopia hana/loggfiler)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-201">hana/log\_backup (mounted as backup into hana/log)</span></span>
- <span data-ttu-id="0c3ea-202">Hana/delat</span><span class="sxs-lookup"><span data-stu-id="0c3ea-202">hana/shared</span></span>

### <a name="storage-snapshot-considerations"></a><span data-ttu-id="0c3ea-203">Överväganden för ögonblicksbild av lagring</span><span class="sxs-lookup"><span data-stu-id="0c3ea-203">Storage snapshot considerations</span></span>

>[!NOTE]
><span data-ttu-id="0c3ea-204">Lagring ögonblicksbilderna _inte_ tillhandahålls utan kostnad, eftersom ytterligare lagringsutrymme måste allokeras.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-204">Storage snapshots are _not_ provided free of charge, because additional storage space must be allocated.</span></span>

<span data-ttu-id="0c3ea-205">hello specifika säkerhetsnivån lagring ögonblicksbilder för SAP HANA i Azure (stora instanser) inkluderar:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-205">hello specific mechanics of storage snapshots for SAP HANA on Azure (large instances) include:</span></span>

- <span data-ttu-id="0c3ea-206">En särskilda lagrings-ögonblicksbild (vid hello tidpunkt när den tas) använder mycket lite lagringsutrymme.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-206">A specific storage snapshot (at hello point in time when it is taken) consumes very little storage.</span></span>
- <span data-ttu-id="0c3ea-207">Hello ögonblicksbild måste toostore hello ursprungliga blockera innehåll som data innehållsändringar och hello innehållet i filer som ändras på hello lagringsvolym SAP HANA-data.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-207">As data content changes and hello content in SAP HANA data files change on hello storage volume, hello snapshot needs toostore hello original block content.</span></span>
- <span data-ttu-id="0c3ea-208">hello lagring ögonblicksbild ökar i storlek.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-208">hello storage snapshot increases in size.</span></span> <span data-ttu-id="0c3ea-209">hello längre hello ögonblicksbild finns, blir hello större hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-209">hello longer hello snapshot exists, hello larger hello storage snapshot becomes.</span></span>
- <span data-ttu-id="0c3ea-210">Hej flera ändringar toohello SAP HANA-databasvolymen över hello livslängden för en ögonblicksbild av lagring, blir hello större hello förbrukningen av diskutrymme i hello lagring ögonblicksbilden.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-210">hello more changes made toohello SAP HANA database volume over hello lifetime of a storage snapshot, hello larger hello space consumption of hello storage snapshot becomes.</span></span>

<span data-ttu-id="0c3ea-211">SAP HANA i Azure (stora instanser) levereras med fast Volymstorlekar för hello SAP HANA data och loggfilen volym.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-211">SAP HANA on Azure (large instances) comes with fixed volume sizes for hello SAP HANA data and log volume.</span></span> <span data-ttu-id="0c3ea-212">Utför ögonblicksbilder av volymerna eats i utrymmet på volymen så att det är ditt ansvar tooschedule lagring ögonblicksbilder (inom hello SAP HANA på Azure [stora instanser] process).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-212">Performing snapshots of those volumes eats into your volume space, so it is your responsibility tooschedule storage snapshots (within hello SAP HANA on Azure [large instances] process).</span></span>

<span data-ttu-id="0c3ea-213">hello innehåller följande avsnitt information för att utföra dessa ögonblicksbilder, inklusive allmänna rekommendationer:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-213">hello following sections provide information for performing these snapshots, including general recommendations:</span></span>

- <span data-ttu-id="0c3ea-214">Även om hello maskinvara kan klara 255 ögonblicksbilder per volym, rekommenderar vi att du hålla betydligt lägre än detta antal.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-214">Though hello hardware can sustain 255 snapshots per volume, we highly recommend that you stay well below this number.</span></span>
- <span data-ttu-id="0c3ea-215">Innan du utför lagring av ögonblicksbilder, övervaka och hålla reda på ledigt utrymme.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-215">Before you perform storage snapshots, monitor and keep track of free space.</span></span>
- <span data-ttu-id="0c3ea-216">Lägre hello antal lagring ögonblicksbilderna baserat på ledigt utrymme.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-216">Lower hello number of storage snapshots based on free space.</span></span> <span data-ttu-id="0c3ea-217">Du kan behöva toolower hello antal ögonblicksbilder som du behåller eller så kanske måste tooextend hello volymer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-217">You might need toolower hello number of snapshots that you keep, or you might need tooextend hello volumes.</span></span> <span data-ttu-id="0c3ea-218">(Du kan ordna ytterligare lagringsutrymme i enheter som 1 TB.)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-218">(You can order additional storage in 1-TB units.)</span></span>
- <span data-ttu-id="0c3ea-219">Vi rekommenderar att du inte utför alla ögonblicksbilder för lagring under aktiviteter, till exempel data flyttas till SAP HANA med migrering Systemverktyg (R3load eller genom att återställa databaser för SAP HANA från säkerhetskopior).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-219">During activities such as moving data into SAP HANA with system migration tools (with R3load, or by restoring SAP HANA databases from backups), we highly recommended that you not perform any storage snapshots.</span></span> <span data-ttu-id="0c3ea-220">(Om en system-migrering görs på ett nytt SAP HANA-system, lagring ögonblicksbilder inte behöver toobe utförs.)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-220">(If a system migration is being done on a new SAP HANA system, storage snapshots would not need toobe performed.)</span></span>
- <span data-ttu-id="0c3ea-221">Under större omorganisering av SAP HANA tabeller bör lagring ögonblicksbilder undvikas om möjligt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-221">During larger reorganizations of SAP HANA tables, storage snapshots should be avoided if possible.</span></span>
- <span data-ttu-id="0c3ea-222">Lagring ögonblicksbilder är en nödvändig tooengaging hello katastrofåterställning funktionerna för SAP HANA i Azure (stora instanser).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-222">Storage snapshots are a prerequisite tooengaging hello disaster-recovery capabilities of SAP HANA on Azure (large instances).</span></span>

### <a name="setting-up-storage-snapshots"></a><span data-ttu-id="0c3ea-223">Konfigurera lagring ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="0c3ea-223">Setting up storage snapshots</span></span>

1. <span data-ttu-id="0c3ea-224">Kontrollera att Perl är installerat i hello Linux-operativsystem på hello HANA (stora instanser) server.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-224">Make sure that Perl is installed in hello Linux operating system on hello HANA (large instances) server.</span></span>
2. <span data-ttu-id="0c3ea-225">Ändra/etc/ssh/ssh\_config tooadd hello rad _Macintosh hmac-sha1_.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-225">Modify /etc/ssh/ssh\_config tooadd hello line _MACs hmac-sha1_.</span></span>
3. <span data-ttu-id="0c3ea-226">Skapa en SAP HANA säkerhetskopiering användarkonto på hello huvudnoden för varje SAP HANA-instans som du kör (om tillämpligt).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-226">Create an SAP HANA backup user account on hello master node for each SAP HANA instance you are running (if applicable).</span></span>
4. <span data-ttu-id="0c3ea-227">hello SAP HANA HDB klienten måste installeras på alla servrar för SAP HANA (stora instanser).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-227">hello SAP HANA HDB client must be installed on all SAP HANA (large instances) servers.</span></span>
5. <span data-ttu-id="0c3ea-228">En offentlig nyckel måste skapas tooaccess hello underliggande lagringsinfrastruktur som styr skapa ögonblicksbilden för på hello första SAP HANA (stora instanser) server för varje region.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-228">On hello first SAP HANA (large instances) server of each region, a public key must be created tooaccess hello underlying storage infrastructure that controls snapshot creation.</span></span>
6. <span data-ttu-id="0c3ea-229">Kopiera hello skript azure\_hana\_backup.pl från/skript toohello finns i **hdbsql** av hello SAP HANA-installationen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-229">Copy hello script azure\_hana\_backup.pl from /scripts toohello location of **hdbsql** of hello SAP HANA installation.</span></span>
7. <span data-ttu-id="0c3ea-230">Kopiera hello HANABackupDetails.txt filen från/skript toohello samma plats som hello Perl-skript.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-230">Copy hello HANABackupDetails.txt file from /scripts toohello same location as hello Perl script.</span></span>
8. <span data-ttu-id="0c3ea-231">Ändra hello HANABackupDetails.txt filen efter behov för hello lämpliga kundens specifikationer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-231">Modify hello HANABackupDetails.txt file as necessary for hello appropriate customer specifications.</span></span>

### <a name="step-1-install-sap-hana-hdbclient"></a><span data-ttu-id="0c3ea-232">Steg 1: Installera SAP HANA HDBClient</span><span class="sxs-lookup"><span data-stu-id="0c3ea-232">Step 1: Install SAP HANA HDBClient</span></span>

<span data-ttu-id="0c3ea-233">hello Linux är installerade på SAP HANA i Azure (stora instanser) innehåller hello mappar och skript nödvändiga tooexecute SAP HANA lagring ögonblicksbilder för säkerhetskopiering och katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-233">hello Linux installed on SAP HANA on Azure (large instances) includes hello folders and scripts necessary tooexecute SAP HANA storage snapshots for backup and disaster-recovery purposes.</span></span> <span data-ttu-id="0c3ea-234">Men är det ditt ansvar tooinstall SAP HANA HDBclient medan du installerar SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-234">However, it is your responsibility tooinstall SAP HANA HDBclient while you are installing SAP HANA.</span></span> <span data-ttu-id="0c3ea-235">(Microsoft installerar varken hello HDBclient eller SAP HANA.)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-235">(Microsoft installs neither hello HDBclient nor SAP HANA.)</span></span>

### <a name="step-2-change-etcsshsshconfig"></a><span data-ttu-id="0c3ea-236">Steg 2: Ändra/etc/ssh/ssh\_config</span><span class="sxs-lookup"><span data-stu-id="0c3ea-236">Step 2: Change /etc/ssh/ssh\_config</span></span>

<span data-ttu-id="0c3ea-237">Ändra/etc/ssh/ssh\_config genom att lägga till _Macintosh hmac-sha1_ rad som visas här:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-237">Change /etc/ssh/ssh\_config by adding _MACs hmac-sha1_ line as shown here:</span></span>
```
#   RhostsRSAAuthentication no
#   RSAAuthentication yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/identity
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   Port 22
Protocol 2
#   Cipher 3des
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160
MACs hmac-sha1
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
```

### <a name="step-3-create-a-public-key"></a><span data-ttu-id="0c3ea-238">Steg 3: Skapa en offentlig nyckel</span><span class="sxs-lookup"><span data-stu-id="0c3ea-238">Step 3: Create a public key</span></span>

<span data-ttu-id="0c3ea-239">Den första SAP HANA på Azure (stora instanser)-server i varje Azure-region, skapa en infrastruktur för offentliga nycklar toobe används tooaccess hello lagring så att du kan skapa ögonblicksbilder på hello.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-239">On hello first SAP HANA on Azure (large instances) server in each Azure region, create a public key toobe used tooaccess hello storage infrastructure so that you can create snapshots.</span></span> <span data-ttu-id="0c3ea-240">hello offentliga nyckeln garanterar att ett lösenord inte är obligatoriska toosign i toohello lagring och inte bevaras lösenordsinformation.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-240">hello public key ensures that a password is not required toosign in toohello storage and that password credentials are not maintained.</span></span> <span data-ttu-id="0c3ea-241">I Linux på hello SAP HANA (stora instanser) server, kör du hello efter kommandot toogenerate hello offentlig nyckel:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-241">In Linux on hello SAP HANA (large instances) server, execute hello following command toogenerate hello public key:</span></span>
```
  ssh-keygen –t dsa –b 1024
```
<span data-ttu-id="0c3ea-242">hello ny plats är _/root/.ssh/id\_dsa.pub.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-242">hello new location is _/root/.ssh/id\_dsa.pub.</span></span> <span data-ttu-id="0c3ea-243">Ange inte en verklig lösenfras, eller så kommer du att nödvändiga tooenter hello lösenfras varje gång du loggar in.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-243">Do not enter an actual passphrase, or else you will be required tooenter hello passphrase each time you sign in.</span></span> <span data-ttu-id="0c3ea-244">Utan på **RETUR** två gånger tooremove hello ange lösenfras krav för att logga in.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-244">Instead, press **Enter** twice tooremove hello enter passphrase requirement for signing in.</span></span>

<span data-ttu-id="0c3ea-245">Kontrollera att den offentliga nyckeln hello korrigerades som förväntat genom att ändra mappar too/root/.ssh/ och sedan köra hello toomake **ls** kommando.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-245">Check toomake sure that hello public key was corrected as expected by changing folders too/root/.ssh/ and then executing hello **ls** command.</span></span> <span data-ttu-id="0c3ea-246">Om hello nyckeln finns kan du kopiera den genom att köra följande kommando hello:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-246">If hello key is present, you can copy it by running hello following command:</span></span>

![Offentliga nyckeln kopieras genom att köra det här kommandot](./media/hana-overview-high-availability-disaster-recovery/image2-public-key.png)

<span data-ttu-id="0c3ea-248">Nu kontakta SAP HANA på Azure-tjänsthantering och ange hello nyckel.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-248">At this point, contact SAP HANA on Azure Service Management and provide hello key.</span></span> <span data-ttu-id="0c3ea-249">hello representant använder hello offentliga nyckel tooregister i hello underliggande lagringsinfrastruktur.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-249">hello service representative uses hello public key tooregister it in hello underlying storage infrastructure.</span></span>

### <a name="step-4-create-an-sap-hana-user-account"></a><span data-ttu-id="0c3ea-250">Steg 4: Skapa ett användarkonto för SAP HANA</span><span class="sxs-lookup"><span data-stu-id="0c3ea-250">Step 4: Create an SAP HANA user account</span></span>

<span data-ttu-id="0c3ea-251">Skapa ett användarkonto för SAP HANA SAP HANA Studio för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-251">Create an SAP HANA user account within SAP HANA Studio for backup purposes.</span></span> <span data-ttu-id="0c3ea-252">Det här kontot måste ha följande behörigheter hello: _säkerhetskopiering Admin_ och _katalog viktigt_.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-252">This account must have hello following privileges: _Backup Admin_ and _Catalog Read_.</span></span> <span data-ttu-id="0c3ea-253">I det här exemplet hello användarnamn SCADMIN skapas.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-253">In this example, hello username SCADMIN is created.</span></span>

![Skapa en användare i HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image3-creating-user.png)

### <a name="step-5-authorize-hello-sap-hana-user-account"></a><span data-ttu-id="0c3ea-255">Steg 5: Ge hello SAP HANA-användarkonto</span><span class="sxs-lookup"><span data-stu-id="0c3ea-255">Step 5: Authorize hello SAP HANA user account</span></span>

<span data-ttu-id="0c3ea-256">Auktorisera hello SAP HANA-användarkonto (toobe används av hello skript utan tillstånd varje gång hello skript körs).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-256">Authorize hello SAP HANA user account (toobe used by hello scripts without requiring authorization every time hello script is run).</span></span> <span data-ttu-id="0c3ea-257">hello SAP HANA-kommandot `hdbuserstore` kan hello skapas en SAP HANA användarnyckel, vilken lagras på en eller flera SAP HANA-noder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-257">hello SAP HANA command `hdbuserstore` allows hello creation of an SAP HANA user key, which is stored on one or more SAP HANA nodes.</span></span> <span data-ttu-id="0c3ea-258">hello användarnyckel kan också hello användaren tooaccess SAP HANA utan toomanage lösenord från inom hello scripting process som beskrivs senare.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-258">hello user key also allows hello user tooaccess SAP HANA without having toomanage passwords from within hello scripting process that's discussed later.</span></span>

>[!IMPORTANT]
><span data-ttu-id="0c3ea-259">Kör hello följande kommando som `_root_`.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-259">Run hello following command as `_root_`.</span></span> <span data-ttu-id="0c3ea-260">Annars fungerar hello skriptet inte korrekt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-260">Otherwise, hello script cannot work properly.</span></span>

<span data-ttu-id="0c3ea-261">Ange hello `hdbuserstore` kommandot på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-261">Enter hello `hdbuserstore` command as follows:</span></span>

![Ange hello hdbuserstore kommando](./media/hana-overview-high-availability-disaster-recovery/image4-hdbuserstore-command.png)

<span data-ttu-id="0c3ea-263">I följande exempel, där hello användare SCADMIN01 och hello värdnamnet är lhanad01 kan hello är hello-kommandot:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-263">In hello following example, where hello user is SCADMIN01 and hello hostname is lhanad01, hello command is:</span></span>
```
hdbuserstore set SCADMIN01 lhanad01:30115 <backup username> <password>
```
<span data-ttu-id="0c3ea-264">Hantera alla skript från en enskild server för skalbar HANA instanser.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-264">Manage all scripting from a single server for scale-out HANA instances.</span></span> <span data-ttu-id="0c3ea-265">I det här exemplet måste hello SAP HANA nyckeln SCADMIN01 ändras för varje värd på ett sätt som visar hello-värd som är relaterade toohello nyckel.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-265">In this example, hello SAP HANA key SCADMIN01 must be altered for each host in a way that reflects hello host that is related toohello key.</span></span> <span data-ttu-id="0c3ea-266">Det vill säga hello SAP HANA säkerhetskopiering konto ändras med hello instans antalet hello HANA DB **lhanad**.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-266">That is, hello SAP HANA backup account is amended with hello instance number of hello HANA DB, **lhanad**.</span></span> <span data-ttu-id="0c3ea-267">hello nyckel måste ha administrativ behörighet på hello-värd som den är tilldelad till och hello skalbar säkerhetskopiering användaren måste ha åtkomst rättigheter tooall SAP HANA instanser.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-267">hello key must have administrative privileges on hello host it is assigned to, and hello backup user for scale-out must have access rights tooall SAP HANA instances.</span></span>
```
hdbuserstore set SCADMIN01 lhanad:30015 SCADMIN <password>
hdbuserstore set SCADMIN02 lhanad:30115 SCADMIN <password>
hdbuserstore set SCADMIN03 lhanad:30215 SCADMIN <password>
```

### <a name="step-6-copy-items-from-hello-scripts-folder"></a><span data-ttu-id="0c3ea-268">Steg 6: Kopiera objekt från hello/skript-mappen</span><span class="sxs-lookup"><span data-stu-id="0c3ea-268">Step 6: Copy items from hello /scripts folder</span></span>

<span data-ttu-id="0c3ea-269">Kopiera hello följande objekt från hello/scripts mapp (ingår på hello guld avbildning av hello-installation) toohello arbetskatalog för **hdbsql**.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-269">Copy hello following items from hello /scripts folder (included on hello gold image of hello installation) toohello working directory for **hdbsql**.</span></span> <span data-ttu-id="0c3ea-270">Katalogen för den aktuella HANA installationer är /hana/shared/D01/exe/linuxx86\_64/hdb.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-270">For current HANA installations, this directory is /hana/shared/D01/exe/linuxx86\_64/hdb.</span></span>
```
azure\_hana\_backup.pl
testHANAConnection.pl
testStorageSnapshotConnection.pl
removeTestStorageSnapshot.pl
HANABackupCustomerDetails.txt
```
<span data-ttu-id="0c3ea-271">Kopiera följande objekt om de kör skalbar hello eller OLAP:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-271">Copy hello following items if they are running scale-out or OLAP:</span></span>
```
azure\_hana\_backup\_bw.pl
testHANAConnectionBW.pl
testStorageSnapshotConnectionBW.pl
removeTestStorageSnapshotBW.pl
HANABackupCustomerDetailsBW.txt
```
<span data-ttu-id="0c3ea-272">Hej HANABackupCustomerDetails.txt filen kan ändras på följande sätt för distribution av skala upp.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-272">hello HANABackupCustomerDetails.txt file is modifiable as follows for a scale-up deployment.</span></span> <span data-ttu-id="0c3ea-273">Det är hello kontroll- och fil för hello-skript som körs hello storage snapshots.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-273">It is hello control and configuration file for hello script that runs hello storage snapshots.</span></span> <span data-ttu-id="0c3ea-274">Du bör ha fått hello _namn på säkerhetskopia_ och _lagring IP-adress_ från SAP HANA på Azure-tjänsthantering när dina instanser har distribuerats.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-274">You should have received hello _Storage Backup Name_ and _Storage IP Address_ from SAP HANA on Azure Service Management when your instances were deployed.</span></span> <span data-ttu-id="0c3ea-275">Du kan inte ändra hello sekvens ordning eller avstånd på någon av hello variabler eller hello skript körs inte korrekt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-275">You cannot modify hello sequence, ordering, or spacing of any of hello variables, or hello script does not run properly.</span></span>

<span data-ttu-id="0c3ea-276">Hello konfigurationsfilen skulle se ut för en distribution av skala upp:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-276">For a scale-up deployment, hello configuration file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Created by customer using hdbuserstore
HANA Backup Name: SCADMIND01
```
<span data-ttu-id="0c3ea-277">För en skalbar konfiguration ser hello HANABackupCustomerDetailsBW.txt filen ut som:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-277">For a scale-out configuration, hello HANABackupCustomerDetailsBW.txt file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Node IP addresses, instance numbers, and HANA backup name
#provided by customer.  HANA backup name created using
#hdbuserstore utility.
Node 1 IP Address: 10.254.15.21
Node 1 HANA instance number: 01
Node 1 HANA Backup Name: SCADMIN01
Node 2 IP Address: 10.254.15.22
Node 2 HANA instance number: 02
Node 2 HANA Backup Name: SCADMIN02
Node 3 IP Address: 10.254.15.23
Node 3 HANA instance number: 03
Node 3 HANA Backup Name: SCADMIN03
Node 4 IP Address: 10.254.15.24
Node 4 HANA instance number: 04
Node 4 HANA Backup Name: SCADMIN04
Node 5 IP Address: 10.254.15.25
Node 5 HANA instance number: 05
Node 5 HANA Backup Name: SCADMIN05
Node 6 IP Address: 10.254.15.26
Node 6 HANA instance number: 06
Node 6 HANA Backup Name: SCADMIN06
Node 7 IP Address: 10.254.15.27
Node 7 HANA instance number: 07
Node 7 HANA Backup Name: SCADMIN07
Node 8 IP Address: 10.254.15.28
Node 8 HANA instance number: 08
Node 8 HANA Backup Name: SCADMIN08
```
>[!NOTE]
><span data-ttu-id="0c3ea-278">Endast nod 1 information används för närvarande i hello faktiska HANA lagring ögonblicksbild skript.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-278">Currently, only Node 1 details are used in hello actual HANA storage snapshot script.</span></span> <span data-ttu-id="0c3ea-279">Vi rekommenderar att du testar åtkomst tooor från alla HANA noder så att om hello säkerhetskopiering huvudnoden någonsin ändras du redan har kontrollerat att en annan nod kan ske dess genom att ändra hello information i noden 1.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-279">We recommend that you test access tooor from all HANA nodes so that, if hello master backup node ever changes, you have already ensured that any other node can take its place by modifying hello details in Node 1.</span></span>

<span data-ttu-id="0c3ea-280">toocheck för hello rätt konfigurationer i konfigurationsfilen för hello eller korrekt anslutning toohello HANA instanser köra något av hello följande skript:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-280">toocheck for hello correct configurations in hello configuration file or proper connectivity toohello HANA instances, run either of hello following scripts:</span></span>
- <span data-ttu-id="0c3ea-281">För en skala upp-konfiguration (oberoende på SAP arbetsbelastningen):</span><span class="sxs-lookup"><span data-stu-id="0c3ea-281">For a scale-up configuration (independent on SAP workload):</span></span>

 ```
testHANAConnection.pl
```
- <span data-ttu-id="0c3ea-282">För en skalbar konfiguration:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-282">For a scale-out configuration:</span></span>

 ```
testHANAConnectionBW.pl
```

<span data-ttu-id="0c3ea-283">Kontrollera hello master HANA instansen har tooall krävs HANA servrar.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-283">Ensure that hello master HANA instance has access tooall required HANA servers.</span></span> <span data-ttu-id="0c3ea-284">Det finns inga parametrar toohello skript, men du måste slutföra hello lämpliga HANABackupCustomerDetails / HANABackupCustomerDetailsBW file för hello skriptet toorun korrekt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-284">There are no parameters toohello script, but you must complete hello appropriate HANABackupCustomerDetails/ HANABackupCustomerDetailsBW file for hello script toorun properly.</span></span> <span data-ttu-id="0c3ea-285">Eftersom endast hello shell-kommando felkoder returneras, går det inte för hello skript tooerror kontrollera varje instans.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-285">Because only hello shell command error codes are returned, it is not possible for hello script tooerror-check every instance.</span></span> <span data-ttu-id="0c3ea-286">Trots detta ger hello skriptet vissa kommentarer för du toodouble-kontrollen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-286">Even so, hello script does provide some helpful comments for you toodouble-check.</span></span>

<span data-ttu-id="0c3ea-287">toorun hello skript:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-287">toorun hello script:</span></span>
```
 ./testHANAConnection.pl
```
 <span data-ttu-id="0c3ea-288">Om hello har hämtas hello status för hello HANA instans, visas ett meddelande om att hello HANA anslutning har upprättats.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-288">If hello script successfully obtains hello status of hello HANA instance, it displays a message that hello HANA connection was successful.</span></span>

<span data-ttu-id="0c3ea-289">Det finns också andra typen av skript kan du använda toocheck hello master HANA instans serverns möjlighet toosign i toohello lagring.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-289">Additionally, there is a second type of script you can use toocheck hello master HANA instance server's ability toosign in toohello storage.</span></span> <span data-ttu-id="0c3ea-290">Innan du kan köra hello azure\_hana\_säkerhetskopiering (\_bw) .pl skript, måste du köra hello nästa skript.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-290">Before you execute hello azure\_hana\_backup(\_bw).pl script, you must execute hello next script.</span></span> <span data-ttu-id="0c3ea-291">Om en volym som innehåller inga ögonblicksbilder, är det omöjligt toodetermine om hello volym är helt enkelt tom eller om det är ett ssh fel tooobtain hello ögonblicksbild information.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-291">If a volume contains no snapshots, it is impossible toodetermine whether hello volume is simply empty or there is an ssh failure tooobtain hello snapshot details.</span></span> <span data-ttu-id="0c3ea-292">Därför körs hello skriptet två steg:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-292">For this reason, hello script executes two steps:</span></span>

- <span data-ttu-id="0c3ea-293">Verifierar hello lagring konsolen är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-293">It verifies that hello storage console is accessible.</span></span>
- <span data-ttu-id="0c3ea-294">En test- eller dummy, ögonblicksbild för varje volym skapas av HANA instans.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-294">It creates a test, or dummy, snapshot for each volume by HANA instance.</span></span>

<span data-ttu-id="0c3ea-295">Därför ingår hello HANA instans som ett argument.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-295">For this reason, hello HANA instance is included as an argument.</span></span> <span data-ttu-id="0c3ea-296">Igen, det är inte möjligt tooprovide fel söker efter hello lagringsanslutning, men hello skript innehåller användbara tips om hello körningen misslyckas.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-296">Again, it is not possible tooprovide error checking for hello storage connection, but hello script provides helpful hints if hello execution fails.</span></span>

<span data-ttu-id="0c3ea-297">hello skript körs som:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-297">hello script is run as:</span></span>
```
 ./testStorageSnapshotConnection.pl <hana instance>
```
<span data-ttu-id="0c3ea-298">Eller den körs som:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-298">Or it is run as:</span></span>
```
./testStorageSnapshotConnectionBW.pl <hana instance>
```
<span data-ttu-id="0c3ea-299">hello-skriptet visar också ett meddelande om att du är kan toosign i korrekt tooyour distribuerat storage-klient som är organiserat efter hello logiska enhetsnummer (LUN) som används av hello server-instanser som du äger.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-299">hello script also displays a message that you are able toosign in appropriately tooyour deployed storage tenant, which is organized around hello logical unit numbers (LUNs) that are used by hello server instances you own.</span></span>

<span data-ttu-id="0c3ea-300">Innan du kör hello första lagring ögonblicksbild säkerhetskopiering, kör du hello nästa skript toomake till att hello-konfigurationen är korrekt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-300">Before you execute hello first storage snapshot-based backups, run hello next scripts toomake sure that hello configuration is correct.</span></span>

<span data-ttu-id="0c3ea-301">När du har kört dessa skript kan du ta bort hello ögonblicksbilder genom att köra:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-301">After running these scripts, you can delete hello snapshots by executing:</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```
<span data-ttu-id="0c3ea-302">Eller</span><span class="sxs-lookup"><span data-stu-id="0c3ea-302">Or</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```

### <a name="step-7-perform-on-demand-snapshots"></a><span data-ttu-id="0c3ea-303">Steg 7: Utföra ögonblicksbilder på begäran</span><span class="sxs-lookup"><span data-stu-id="0c3ea-303">Step 7: Perform on-demand snapshots</span></span>

<span data-ttu-id="0c3ea-304">Utföra ögonblicksbilder på begäran (samt schemalägga regelbundna ögonblicksbilder med hjälp av cron) som beskrivs här.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-304">Perform on-demand snapshots (as well as schedule regular snapshots by using cron) as described here.</span></span>

<span data-ttu-id="0c3ea-305">Kör hello följande skript för skala upp konfigurationer:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-305">For scale-up configurations, execute hello following script:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="0c3ea-306">Kör hello följande skript för skalbara konfigurationer:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-306">For scale-out configurations, execute hello following script:</span></span>
```
./azure_hana_backup_bw.pl lhanad01 customer 20
```
<span data-ttu-id="0c3ea-307">hello skalbar skriptet gör vissa ytterligare kontrollerar toomake till att alla HANA servrar kan nås och alla HANA instanser returnerar rätt status för hello-instansen innan du fortsätter med att skapa ögonblicksbilder SAP HANA eller lagring.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-307">hello scale-out script does some additional checking toomake sure that all HANA servers can be accessed, and all HANA instances return appropriate status of hello instance before proceeding with creating SAP HANA or storage snapshots.</span></span>

<span data-ttu-id="0c3ea-308">hello följande argument är obligatoriska:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-308">hello following arguments are required:</span></span>

- <span data-ttu-id="0c3ea-309">hello HANA instans kräver säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-309">hello HANA instance requiring backup.</span></span>
- <span data-ttu-id="0c3ea-310">hello ögonblicksbild prefix för hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-310">hello snapshot prefix for hello storage snapshot.</span></span>
- <span data-ttu-id="0c3ea-311">hello antalet ögonblicksbilder toobe för hello specifikt prefix.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-311">hello number of snapshots toobe kept for hello specific prefix.</span></span>

```
./azure_hana_backup.pl lhanad01 customer 20
```

<span data-ttu-id="0c3ea-312">hello köra hello skriptet skapar hello lagring ögonblicksbild i dessa tre skilda faser:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-312">hello execution of hello script creates hello storage snapshot in these three distinct phases:</span></span>

- <span data-ttu-id="0c3ea-313">Köra en HANA ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-313">Execute a HANA snapshot.</span></span>
- <span data-ttu-id="0c3ea-314">Köra en ögonblicksbild för lagring.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-314">Execute a storage snapshot.</span></span>
- <span data-ttu-id="0c3ea-315">Ta bort hello HANA ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-315">Remove hello HANA snapshot.</span></span>

<span data-ttu-id="0c3ea-316">Kör hello skriptet genom att anropa från hello HDB körbara mapp som den kopierades till.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-316">Execute hello script by calling it from hello HDB executable folder that it was copied to.</span></span> <span data-ttu-id="0c3ea-317">Det säkerhetskopierar hello minst följande volymer, men den också säkerhetskopierar alla volymer som har hello explicit SAP HANA-instansnamn i hello volymnamn.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-317">It backs up at least hello following volumes, but it also backs up any volume that has hello explicit SAP HANA instance name in hello volume name.</span></span>
```
hana_data_<hana instance>_prod_t020_vol
hana_log_<hana instance>_prod_t020_vol
hana_log_backup_<hana instance>_prod_t020_vol
hana_shared_<hana instance>_prod_t020_vol
```
<span data-ttu-id="0c3ea-318">hello kvarhållningsperiod är strikt administreras med hello antal ögonblicksbilder som skickas som en parameter när du kör hello-skript (till exempel 20 såg tidigare).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-318">hello retention period is strictly administered, with hello number of snapshots submitted as a parameter when you execute hello script (such as 20, shown previously).</span></span> <span data-ttu-id="0c3ea-319">Så är hello tidsperiod en funktion av hello tidsperiod körning och hello antalet ögonblicksbilder i hello anrop av hello skript.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-319">So hello amount of time is a function of hello period of execution and hello number of snapshots in hello call of hello script.</span></span> <span data-ttu-id="0c3ea-320">Om hello antal ögonblicksbilder som hålls överskrider hello-nummer som namnges som en parameter i hello anrop av hello skript, hello äldsta lagring ögonblicksbild av den här etiketten (i vårt fall tidigare _anpassade_) tas bort innan en ny ögonblicksbild köra.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-320">If hello number of snapshots that are kept exceeds hello number that are named as a parameter in hello call of hello script, hello oldest storage snapshot of this label (in our previous case, _custom_) is deleted before a new snapshot is executed.</span></span> <span data-ttu-id="0c3ea-321">Detta innebär hello nummer som hello sista parametern för anropet hello är hello tal som du kan använda toocontrol hello antalet ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-321">This means hello number you give as hello last parameter of hello call is hello number you can use toocontrol hello number of snapshots.</span></span>

>[!NOTE]
><span data-ttu-id="0c3ea-322">När du ändrar hello etikett startas hello räknat igen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-322">As soon as you change hello label, hello counting starts again.</span></span>

<span data-ttu-id="0c3ea-323">Du måste tooinclude hello HANA med instansnamn som tillhandahålls av SAP HANA på Azure-tjänsthantering som ett argument om de skapar ögonblicksbilder i miljöer med flera noder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-323">You need tooinclude hello HANA instance name that's provided by SAP HANA on Azure Service Management as an argument if they are creating snapshots in multi-node environments.</span></span> <span data-ttu-id="0c3ea-324">Hello hello SAP HANA på enheten i Azure (stora instanser) är tillräckligt i nod-miljöer, men rekommenderas fortfarande hello HANA instansnamn.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-324">In single-node environments, hello name of hello SAP HANA on Azure (large instances) unit is sufficient, but hello HANA instance name is still recommended.</span></span>

<span data-ttu-id="0c3ea-325">Dessutom kan du kan säkerhetskopiera Start volumes\LUNs med hjälp av hello samma skript.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-325">Additionally, you can back up boot volumes\LUNs by using hello same script.</span></span> <span data-ttu-id="0c3ea-326">Du måste säkerhetskopiera startvolymen minst en gång när du först kör HANA, även om vi rekommenderar ett veckoschema eller nattetid schema för säkerhetskopiering för att starta i cron.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-326">You must back up your boot volume at least once when you first run HANA, although we recommend a weekly or nightly backup schedule for booting in cron.</span></span> <span data-ttu-id="0c3ea-327">Snarare än att lägga till en SAP HANA-instansnamn, infoga _Start_ som hello argumentet i hello skript på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-327">Rather than add an SAP HANA instance name, insert _boot_ as hello argument into hello script as follows:</span></span>
```
./azure_hana_backup boot customer 20
```
<span data-ttu-id="0c3ea-328">hello är samma bevarandeprincip tillhandahållet toohello startvolymen samt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-328">hello same retention policy is afforded toohello boot volume as well.</span></span> <span data-ttu-id="0c3ea-329">Använda ögonblicksbilder på begäran, enligt beskrivningen tidigare för specialfall, som under en uppgradering av SAP förbättring av paketet (EHP) eller när du behöver toocreate en ögonblicksbild av olika.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-329">Use on-demand snapshots, as described previously, for special cases only, such as during an SAP enhancement package (EHP) upgrade, or when you need toocreate a distinct storage snapshot.</span></span>

<span data-ttu-id="0c3ea-330">Vi rekommenderar att du tooperform schemalagda lagring ögonblicksbilder med hjälp av cron och vi rekommenderar att du använder hello samma skript för alla säkerhetskopiering och katastrofåterställning behov (ändra hello skript indata toomatch hello olika begärt säkerhetskopieringstiden).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-330">We encourage you tooperform scheduled storage snapshots using cron, and we recommend that you use hello same script for all backups and disaster-recovery needs (modifying hello script inputs toomatch hello various requested backup times).</span></span> <span data-ttu-id="0c3ea-331">Dessa är alla schemalagda annorlunda i cron beroende på deras körningstid: varje timme, 12 timmar, varje dag eller varje vecka.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-331">These are all scheduled differently in cron depending on their execution time: hourly, 12-hour, daily, or weekly.</span></span> <span data-ttu-id="0c3ea-332">hello cron schema är utformad toocreate lagring ögonblicksbilder som matchar hello diskuterats tidigare kvarhållning etiketter för långsiktig extern säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-332">hello cron schedule is designed toocreate storage snapshots that match hello previously discussed retention labeling for long-term off-site backup.</span></span> <span data-ttu-id="0c3ea-333">hello skriptet innehåller kommandon tooback upp alla produktionsvolymer, beroende på deras begärda frekvens (data och loggfiler säkerhetskopieras varje timme, medan hello startvolymen säkerhetskopieras varje dag).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-333">hello script includes commands tooback up all production volumes, depending on their requested frequency (data and log files are backed up hourly, whereas hello boot volume is backed up daily).</span></span>

<span data-ttu-id="0c3ea-334">hello poster i hello följande cron skript körs varje timme vid hello tionde minut, var 12: e timme på hello tionde minut, och varje dag på hello tionde minut.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-334">hello entries in hello following cron script run every hour at hello tenth minute, every 12 hours at hello tenth minute, and daily at hello tenth minute.</span></span> <span data-ttu-id="0c3ea-335">hello cron jobb skapas så att endast en SAP HANA lagring ögonblicksbild äger rum under en viss timme så att hello per timme och dag inte säkerhetskopieras vid hello samma tid (12:10:00).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-335">hello cron jobs are created in such a way that only one SAP HANA storage snapshot takes place during any particular hour, so that hello hourly and daily backups do not occur at hello same time (12:10 AM).</span></span> <span data-ttu-id="0c3ea-336">toohelp optimera din ögonblicksbilder skapas och replikering, SAP HANA på Azure-tjänsthantering visar hello rekommenderas tills du toorun säkerhetskopiorna.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-336">toohelp optimize your snapshot creation and replication, SAP HANA on Azure Service Management provides hello recommended time for you toorun your backups.</span></span>

<span data-ttu-id="0c3ea-337">hello standard cron schemaläggning i /etc/crontab är följande:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-337">hello default cron scheduling in /etc/crontab is as follows:</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 14
```
<span data-ttu-id="0c3ea-338">I hello föregående cron anvisningarna få hello HANA volymer (utan startvolymen) en varje timme ögonblicksbild med hello etiketten.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-338">In hello previous cron instructions, hello HANA volumes (without boot volume) get an hourly snapshot with hello label.</span></span> <span data-ttu-id="0c3ea-339">Dessa ögonblicksbilder bevaras 66.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-339">Of these snapshots, 66 are retained.</span></span> <span data-ttu-id="0c3ea-340">Dessutom bevaras 14 ögonblicksbilder med hello 12-timmarsperiod etiketten.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-340">Additionally, 14 snapshots with hello 12-hour label are retained.</span></span> <span data-ttu-id="0c3ea-341">Du hämta eventuellt timvis ögonblicksbilder för tre dagar, plus 12-timmarsperiod ögonblicksbilder för en annan fyra dagar, vilket ger dig en hela veckan ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-341">You potentially get hourly snapshots for three days, plus 12-hour snapshots for another four days, which gives you an entire week of snapshots.</span></span>

<span data-ttu-id="0c3ea-342">Schemalägga inom cron kan vara svårt, eftersom bara ett skript ska köras när som helst viss om hello skript ut av flera minuter.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-342">Scheduling within cron can be tricky, because only one script should be executed at any particular time, unless hello scripts are staggered by several minutes.</span></span> <span data-ttu-id="0c3ea-343">Om du vill daglig säkerhetskopiering för långsiktig kvarhållning kan en ögonblicksbild sparas tillsammans med en 12-timmarsperiod ögonblicksbild (med en kvarhållning antal sju varje) eller hello timvis ögonblicksbild är successiva tootake plats 10 minuter senare.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-343">If you want daily backups for long-term retention, either a daily snapshot is kept along with a 12-hour snapshot (with a retention count of seven each), or hello hourly snapshot is staggered tootake place 10 minutes later.</span></span> <span data-ttu-id="0c3ea-344">Endast en ögonblicksbild sparas i hello produktionsvolym.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-344">Only one daily snapshot is kept in hello production volume.</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 7
10 0 * * * ./azure_hana_backup.pl lhanad01 daily 7
```
<span data-ttu-id="0c3ea-345">hello frekvenser som listas här är bara exempel.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-345">hello frequencies listed here are only examples.</span></span> <span data-ttu-id="0c3ea-346">tooderive din optimala antalet ögonblicksbilder, Använd hello följande kriterier:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-346">tooderive your optimum number of snapshots, use hello following criteria:</span></span>

- <span data-ttu-id="0c3ea-347">Krav i mål för återställning i tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-347">Requirements in recovery time objective for point-in-time recovery.</span></span>
- <span data-ttu-id="0c3ea-348">Användning av diskutrymme.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-348">Space usage.</span></span>
- <span data-ttu-id="0c3ea-349">Krav på att återställas peka mål och mål för eventuell återställning.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-349">Requirements in recovery point objective and recovery time objective for potential disaster recovery.</span></span>
- <span data-ttu-id="0c3ea-350">Eventuell körningen av HANA fullständiga databassäkerhetskopieringar mot diskar.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-350">Eventual execution of HANA full database backups against disks.</span></span> <span data-ttu-id="0c3ea-351">När en fullständig säkerhetskopiering av databasen mot diskar, eller _backint_ gränssnitt är utföra hello lagring ögonblicksbilder går inte att köra.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-351">Whenever a full database backup against disks, or _backint_ interface, is performed, hello execution of storage snapshots fails.</span></span> <span data-ttu-id="0c3ea-352">Om du planerar tooexecute fullständiga databassäkerhetskopieringar ovanpå lagring ögonblicksbilder, kontrollera att hello körningen av lagring ögonblicksbilder är inaktiverad under den här tiden.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-352">If you plan tooexecute full database backups on top of storage snapshots, make sure that hello execution of storage snapshots is disabled during this time.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="0c3ea-353">hello användningen av lagringsutrymme ögonblicksbilder för SAP HANA säkerhetskopior är endast giltig när hello ögonblicksbilder utförs tillsammans med SAP HANA säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-353">hello use of storage snapshots for SAP HANA backups is valid only when hello snapshots are performed in conjunction with SAP HANA log backups.</span></span> <span data-ttu-id="0c3ea-354">Dessa loggar säkerhetskopieringar behöver toobe kan toocover hello tidsperioder mellan hello storage snapshots.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-354">These log backups need toobe able toocover hello time periods between hello storage snapshots.</span></span> <span data-ttu-id="0c3ea-355">Om du har angett ett åtagande toousers för en punkt-in-time-återställning på 30 dagar, behöver du hello följande:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-355">If you've set a commitment toousers of a point-in-time recovery of 30 days, you need hello following:</span></span>

- <span data-ttu-id="0c3ea-356">Möjlighet tooaccess en ögonblicksbild av lagring som är 30 dagar gamla.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-356">Ability tooaccess a storage snapshot that is 30 days old.</span></span>
- <span data-ttu-id="0c3ea-357">Sammanhängande loggsäkerhetskopior över hello senaste 30 dagarna.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-357">Contiguous log backups over hello last 30 days.</span></span>

<span data-ttu-id="0c3ea-358">Skapa en ögonblicksbild av hello säkerhetskopiering loggvolym samt i hello antal säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-358">In hello range of log backups, create a snapshot of hello backup log volume as well.</span></span> <span data-ttu-id="0c3ea-359">Dock vara säker på att tooperform regelbundna säkerhetskopieringar så att du kan:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-359">However, be sure tooperform regular log backups so that you can:</span></span>

- <span data-ttu-id="0c3ea-360">Behöva hello sammanhängande loggsäkerhetskopior tooperform i tidpunkt återställningar.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-360">Have hello contiguous log backups needed tooperform point-in-time recoveries.</span></span>
- <span data-ttu-id="0c3ea-361">Förhindra att hello SAP HANA loggvolym slut på utrymme.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-361">Prevent hello SAP HANA log volume from running out of space.</span></span>

<span data-ttu-id="0c3ea-362">En av hello sista stegen är tooschedule SAP HANA säkerhetskopieringsloggar i SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-362">One of hello last steps is tooschedule SAP HANA backup logs in SAP HANA Studio.</span></span> <span data-ttu-id="0c3ea-363">hello SAP HANA säkerhetskopiering mål loggmålet är hello som skapats speciellt hana eller in\_säkerhetskopieringar volym med hello monteringspunkt för /hana/log/backups.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-363">hello SAP HANA backup log target destination is hello specially created hana/log\_backups volume with hello mount point of /hana/log/backups.</span></span>

![Schemalägga SAP HANA säkerhetskopieringsloggar i SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image5-schedule-backup.png)

<span data-ttu-id="0c3ea-365">Du kan välja säkerhetskopior som är oftare än var 15: e minut.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-365">You can choose backups that are more frequent than every 15 minutes.</span></span> <span data-ttu-id="0c3ea-366">Vissa användare även utföra säkerhetskopior av varje minut, men vi inte rekommenderar kommer _över_ 15 minuter.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-366">Some users even perform log backups every minute, although we do not recommend going _over_ 15 minutes.</span></span>

<span data-ttu-id="0c3ea-367">hello sista steget är ett filbaserat tooperform säkerhetskopiering (efter hello installationen av SAP HANA) toocreate en enda säkerhetskopiering posten som måste finnas inom hello säkerhetskopieringskatalogen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-367">hello final step is tooperform a file-based backup (after hello initial installation of SAP HANA) toocreate a single backup entry that must exist within hello backup catalog.</span></span> <span data-ttu-id="0c3ea-368">Annars kan inte SAP HANA initiera de angivna säkerhetskopiorna.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-368">Otherwise SAP HANA cannot initiate your specified log backups.</span></span>

![Skapa en filbaserad säkerhetskopiering toocreate en enda säkerhetskopiering transaktion](./media/hana-overview-high-availability-disaster-recovery/image6-make-backup.png)

### <a name="monitoring-hello-number-and-size-of-snapshots-on-hello-disk-volume"></a><span data-ttu-id="0c3ea-370">Övervaka hello antal och storlek för ögonblicksbilder på diskvolymen hello</span><span class="sxs-lookup"><span data-stu-id="0c3ea-370">Monitoring hello number and size of snapshots on hello disk volume</span></span>

<span data-ttu-id="0c3ea-371">Du kan övervaka hello antalet ögonblicksbilder och förbrukning av hello lagring av ögonblicksbilder på en viss lagringsvolym.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-371">On a particular storage volume, you can monitor hello number of snapshots and hello storage consumption of snapshots.</span></span> <span data-ttu-id="0c3ea-372">Hej `ls` kommandot visas inte hello ögonblicksbild katalogen eller filer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-372">hello `ls` command doesn't show hello snapshot directory or files.</span></span> <span data-ttu-id="0c3ea-373">Dock hello Linux OS-kommandot `du` gör med hello följande kommandon:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-373">However, hello Linux OS command `du` does, with hello following commands:</span></span>

- <span data-ttu-id="0c3ea-374">`du –sh .snapshot`innehåller alla ögonblicksbilder i hello ögonblicksbild katalog totalt.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-374">`du –sh .snapshot` provides a total of all snapshots within hello snapshot directory.</span></span>
- <span data-ttu-id="0c3ea-375">`du –sh --max-depth=1`Listar alla ögonblicksbilder som sparats hello .snapshot mapp och hello storleken på varje ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-375">`du –sh --max-depth=1` lists all snapshots that are saved in hello .snapshot folder and hello size of each snapshot.</span></span>
- <span data-ttu-id="0c3ea-376">`du –hc`ger hello totala storlek som används av alla ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-376">`du –hc` provides hello total size used by all snapshots.</span></span>

<span data-ttu-id="0c3ea-377">Använd dessa kommandon toomake till att hello ögonblicksbilder som tas och lagras inte som förbrukar all hello lagring på hello volymer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-377">Use these commands toomake sure that hello snapshots that are taken and stored are not consuming all hello storage on hello volumes.</span></span>

### <a name="reducing-hello-number-of-snapshots-on-a-server"></a><span data-ttu-id="0c3ea-378">Minska hello antalet ögonblicksbilder på en server</span><span class="sxs-lookup"><span data-stu-id="0c3ea-378">Reducing hello number of snapshots on a server</span></span>

<span data-ttu-id="0c3ea-379">Du kan minska hello antal vissa etiketter ögonblicksbilder som du lagrar som beskrivits tidigare.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-379">As explained earlier, you can reduce hello number of certain labels of snapshots that you store.</span></span> <span data-ttu-id="0c3ea-380">hello sista två parametrar av hello kommandot tooinitiate en ögonblicksbild är en etikett och hello antal ögonblicksbilder som du vill tooretain.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-380">hello last two parameters of hello command tooinitiate a snapshot are a label and hello number of snapshots you want tooretain.</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="0c3ea-381">I föregående exempel hello hello ögonblicksbild etiketten är _kunden_ och hello antalet ögonblicksbilder med den här etiketten toobe behålls är _20_.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-381">In hello previous example, hello snapshot label is _customer_ and hello number of snapshots with this label toobe retained is _20_.</span></span> <span data-ttu-id="0c3ea-382">Du kanske vill tooreduce hello antalet lagrade ögonblicksbilder som du svarar toodisk förbrukningen av diskutrymme.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-382">As you respond toodisk space consumption, you might want tooreduce hello number of stored snapshots.</span></span> <span data-ttu-id="0c3ea-383">hello enkelt tooreduce hello antalet ögonblicksbilder är toorun hello skriptet med hello sista parametern set too5:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-383">hello easy way tooreduce hello number of snapshots is toorun hello script with hello last parameter set too5:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 5
```
<span data-ttu-id="0c3ea-384">På grund av pågående hello-skript med den här inställningen, hello antalet ögonblicksbilder, inklusive hello ny lagring som en ögonblicksbild, är _5_.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-384">As a result of running hello script with this setting, hello number of snapshots, including hello new storage snapshot, is _5_.</span></span>

 >[!NOTE]
 > <span data-ttu-id="0c3ea-385">Det här skriptet minskar hello antalet ögonblicksbilder endast om hello senaste tidigare ögonblicksbild är mer än en timme gamla.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-385">This script reduces hello number of snapshots only if hello most recent previous snapshot is more than one hour old.</span></span> <span data-ttu-id="0c3ea-386">hello skriptet tar inte bort ögonblicksbilderna som är mindre än en timme gamla.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-386">hello script does not delete snapshots that are less than one hour old.</span></span>

<span data-ttu-id="0c3ea-387">Dessa begränsningar är relaterade toohello valfria katastrofåterställning funktionerna som erbjuds.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-387">These restrictions are related toohello optional disaster-recovery functionality offered.</span></span>

<span data-ttu-id="0c3ea-388">Om du inte längre vill toomaintain en uppsättning ögonblicksbilder med detta prefix kan du köra hello skriptet med _0_ som hello kvarhållning number tooremove alla ögonblicksbilder som matchar det prefixet.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-388">If you no longer want toomaintain a set of snapshots with that prefix, you can execute hello script with _0_ as hello retention number tooremove all snapshots matching that prefix.</span></span> <span data-ttu-id="0c3ea-389">Ta bort alla ögonblicksbilder kan dock påverka hello funktionerna för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-389">However, removing all snapshots can affect hello capabilities of disaster recovery.</span></span>

### <a name="recovering-toohello-most-recent-hana-snapshot"></a><span data-ttu-id="0c3ea-390">Återställer toohello senaste HANA ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="0c3ea-390">Recovering toohello most recent HANA snapshot</span></span>

<span data-ttu-id="0c3ea-391">I hello händelse kan du uppleva en hello process för att återställa från en ögonblicksbild för lagring och produktion nedåt scenariot initieras som en kundincident med SAP HANA på Azure-tjänsthantering.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-391">In hello event that you experience a production-down scenario, hello process of recovering from a storage snapshot can be initiated as a customer incident with SAP HANA on Azure Service Management.</span></span> <span data-ttu-id="0c3ea-392">Ett oväntat scenario kan vara en hög angelägenhetsgrad fråga om data har tagits bort i produktion system och hello endast sätt tooretrieve hello data är toorestore hello produktionsdatabas.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-392">Such an unexpected scenario might be a high-urgency matter if data was deleted in a production system and hello only way tooretrieve hello data is toorestore hello production database.</span></span>

<span data-ttu-id="0c3ea-393">På hello däremot punkten i tidsåterställningen kan vara låg angelägenhetsgrad och planerade för dagar i förväg.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-393">On hello other hand, a point-in-time recovery could be low urgency and planned for days in advance.</span></span> <span data-ttu-id="0c3ea-394">Du kan planera återställningen med SAP HANA på Azure-tjänsthantering i stället för att ett problem med hög prioritet.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-394">You can plan this recovery with SAP HANA on Azure Service Management instead of raising a high-priority issue.</span></span> <span data-ttu-id="0c3ea-395">Exempelvis kan du planera tootry en uppgradering av hello SAP-program genom att använda ett nytt paket för förbättring, och du sedan behöver toorevert tillbaka tooa ögonblicksbild som representerar hello tillstånd innan hello EHP uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-395">For example, you might be planning tootry an upgrade of hello SAP software by applying a new enhancement package, and you then need toorevert back tooa snapshot that represents hello state before hello EHP upgrade.</span></span>

<span data-ttu-id="0c3ea-396">Innan du skickar hello begäran måste toodo vissa förberedelser.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-396">Before you issue hello request, you need toodo some preparation.</span></span> <span data-ttu-id="0c3ea-397">SAP HANA på Azure Service Management-teamet kan sedan hantera hello begäran och ange hello återställa volymer.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-397">SAP HANA on Azure Service Management team can then handle hello request and provide hello restored volumes.</span></span> <span data-ttu-id="0c3ea-398">Därefter, är det upp tooyou toorestore hello HANA-databas utifrån hello ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-398">Afterward, it is up tooyou toorestore hello HANA database based on hello snapshots.</span></span> <span data-ttu-id="0c3ea-399">Här är hur tooprepare för hello begäran:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-399">Here is how tooprepare for hello request:</span></span>

>[!NOTE]
><span data-ttu-id="0c3ea-400">Användargränssnittet kan skilja sig från hello följande skärmdumpar, beroende på hello SAP HANA-versionen som du använder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-400">Your user interface might vary from hello following screenshots, depending on hello SAP HANA release you are using.</span></span>

1. <span data-ttu-id="0c3ea-401">Bestäm vilken ögonblicksbild toorestore.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-401">Decide which snapshot toorestore.</span></span> <span data-ttu-id="0c3ea-402">Endast hello hana/datavolym skulle återställas om du inte uppmanas annars.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-402">Only hello hana/data volume would be restored unless you are instructed otherwise.</span></span>

2. <span data-ttu-id="0c3ea-403">Stäng hello HANA instans.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-403">Shut down hello HANA instance.</span></span>

 ![Stäng hello HANA instans](./media/hana-overview-high-availability-disaster-recovery/image7-shutdown-hana.png)

3. <span data-ttu-id="0c3ea-405">Demontera hello datavolymer på varje nod för HANA-databas.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-405">Unmount hello data volumes on each HANA database node.</span></span> <span data-ttu-id="0c3ea-406">hello återställningen av hello ögonblicksbild misslyckas om hello datavolymer inte är frånkopplade.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-406">hello restoration of hello snapshot fails if hello data volumes are not unmounted.</span></span>

 ![Demontera hello datavolymer på varje nod för HANA-databas](./media/hana-overview-high-availability-disaster-recovery/image8-unmount-data-volumes.png)

4. <span data-ttu-id="0c3ea-408">Öppna ett Azure-supporten begäran tooinstruct hello återställning av en specifik ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-408">Open an Azure support request tooinstruct hello restoration of a specific snapshot.</span></span>

 - <span data-ttu-id="0c3ea-409">Vid återställning av hello: SAP HANA på Azure-tjänsthantering be tooattend en konferenssamtal tooensure som inga data är att gå vilse.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-409">During hello restoration: SAP HANA on Azure Service Management might ask you tooattend a conference call tooensure that no data is getting lost.</span></span>

 - <span data-ttu-id="0c3ea-410">Efter återställningen hello: SAP HANA på Azure-tjänsthantering meddelar dig när hello lagring ögonblicksbild har återställts.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-410">After hello restoration: SAP HANA on Azure Service Management notifies you when hello storage snapshot has been restored.</span></span>

5. <span data-ttu-id="0c3ea-411">Montera alla datavolymer när hello återställningsprocessen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-411">After hello restoration process is complete, remount all data volumes.</span></span>

 ![Montera alla datavolymer](./media/hana-overview-high-availability-disaster-recovery/image9-remount-data-volumes.png)

6. <span data-ttu-id="0c3ea-413">Välj återställningsalternativ SAP HANA Studio, om de inte automatiskt kommer när du återansluter tooHANA DB via SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-413">Select recovery options within SAP HANA Studio, if they do not automatically come up when you reconnect tooHANA DB through SAP HANA Studio.</span></span> <span data-ttu-id="0c3ea-414">hello visar följande exempel en återställning toohello senaste HANA ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-414">hello following example shows a restoration toohello last HANA snapshot.</span></span> <span data-ttu-id="0c3ea-415">En ögonblicksbild av lagring bäddar in en HANA ögonblicksbild och om du återställer toohello senaste lagring ögonblicksbild ska hello senaste HANA ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-415">A storage snapshot embeds one HANA snapshot, and if you are restoring toohello most recent storage snapshot, it should be hello most recent HANA snapshot.</span></span> <span data-ttu-id="0c3ea-416">(Om du återställer tooolder lagring ögonblicksbilder, måste toolocate hello HANA ögonblicksbilden baserat på hello hello lagring ögonblicksbilder togs.)</span><span class="sxs-lookup"><span data-stu-id="0c3ea-416">(If you are restoring tooolder storage snapshots, you need toolocate hello HANA snapshot based on hello time hello storage snapshot was taken.)</span></span>

 ![Välj alternativ för Återställ SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image10-recover-options-a.png)

7. <span data-ttu-id="0c3ea-418">Välj **Återställ hello tooa specifika data säkerhetskopierings- eller databasögonblicksbilden**.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-418">Select **Recover hello database tooa specific data backup or storage snapshot**.</span></span>

 ![Hej ”ange typ av återställning” fönster](./media/hana-overview-high-availability-disaster-recovery/image11-recover-options-b.png)

8. <span data-ttu-id="0c3ea-420">Välj **ange säkerhetskopiering utan katalog**.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-420">Select **Specify backup without catalog**.</span></span>

 ![Hej ”ange Säkerhetskopians plats”-fönstret](./media/hana-overview-high-availability-disaster-recovery/image12-recover-options-c.png)

9. <span data-ttu-id="0c3ea-422">I hello **måltypen** väljer **ögonblicksbild**.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-422">In hello **Destination Type** list, select **Snapshot**.</span></span>

 ![Hej ”ange hello säkerhetskopiering tooRecover” fönster](./media/hana-overview-high-availability-disaster-recovery/image13-recover-options-d.png)

10. <span data-ttu-id="0c3ea-424">Klicka på **Slutför** toostart hello återställningsprocessen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-424">Click **Finish** toostart hello recovery process.</span></span>

 ![Klicka på ”Slutför” toostart hello-återställningen](./media/hana-overview-high-availability-disaster-recovery/image14-recover-options-e.png)

11. <span data-ttu-id="0c3ea-426">hello HANA-databas har återställts och återställas toohello HANA ögonblicksbild som ingår i hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-426">hello HANA database is restored and recovered toohello HANA snapshot that's included in hello storage snapshot.</span></span>

 ![HANA-databas har återställts och återställda toohello HANA ögonblicksbild](./media/hana-overview-high-availability-disaster-recovery/image15-recover-options-f.png)

### <a name="recovering-toohello-most-recent-state"></a><span data-ttu-id="0c3ea-428">Återställer toohello senaste status</span><span class="sxs-lookup"><span data-stu-id="0c3ea-428">Recovering toohello most recent state</span></span>

<span data-ttu-id="0c3ea-429">hello återställer följande process hello HANA ögonblicksbild som ingår i hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-429">hello following process restores hello HANA snapshot that is included in hello storage snapshot.</span></span> <span data-ttu-id="0c3ea-430">Den sedan återställer hello loggen säkerhetskopieringar toohello senaste transaktionstillstånd av hello-databasen innan du återställer hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-430">It then restores hello transaction log backups toohello most recent state of hello database before restoring hello storage snapshot.</span></span>

>[!IMPORTANT]
><span data-ttu-id="0c3ea-431">Innan du fortsätter, kontrollera att du har en fullständig och sammanhängande kedja av säkerhetskopieringar av transaktionsloggen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-431">Before you proceed, make sure that you have a complete and contiguous chain of transaction log backups.</span></span> <span data-ttu-id="0c3ea-432">Du kan inte återställa hello aktuell status för hello databas utan dessa säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-432">Without these backups, you cannot restore hello current state of hello database.</span></span>

1. <span data-ttu-id="0c3ea-433">Slutför steg 1 – 6 för hello föregående procedur i ”återställa toohello senaste HANA ögonblicksbild”.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-433">Complete steps 1-6 of hello preceding procedure in "Recovering toohello most recent HANA snapshot."</span></span>

2. <span data-ttu-id="0c3ea-434">Välj **återställa hello tooits senaste databastillståndet**.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-434">Select **Recover hello database tooits most recent state**.</span></span>

 ![Välj ”återställa hello tooits senaste databastillståndet”](./media/hana-overview-high-availability-disaster-recovery/image16-recover-database-a.png)

3. <span data-ttu-id="0c3ea-436">Ange hello platsen för hello säkerhetskopior senaste HANA.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-436">Specify hello location of hello most recent HANA log backups.</span></span> <span data-ttu-id="0c3ea-437">hello placering måste toocontain alla HANA säkerhetskopieringar av transaktionsloggen från hello HANA ögonblicksbild toohello senaste tillstånd.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-437">hello location needs toocontain all HANA transaction log backups from hello HANA snapshot toohello most recent state.</span></span>

 ![Ange hello platsen för hello senaste HANA loggsäkerhetskopior](./media/hana-overview-high-availability-disaster-recovery/image17-recover-database-b.png)

4. <span data-ttu-id="0c3ea-439">Välj en säkerhetskopia som utgångspunkt från vilken toorecover hello-databas.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-439">Select a backup as a base from which toorecover hello database.</span></span> <span data-ttu-id="0c3ea-440">I vårt exempel är hello HANA ögonblicksbild som ingick i hello lagring ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-440">In our example, this is hello HANA snapshot that was included in hello storage snapshot.</span></span> <span data-ttu-id="0c3ea-441">(Endast en ögonblicksbild finns i följande skärmbild hello).</span><span class="sxs-lookup"><span data-stu-id="0c3ea-441">(Only one snapshot is listed in hello following screenshot.)</span></span>

 ![Välj en säkerhetskopia som utgångspunkt från vilken toorecover hello-databas](./media/hana-overview-high-availability-disaster-recovery/image18-recover-database-c.png)

5. <span data-ttu-id="0c3ea-443">Rensa hello **Använd Delta säkerhetskopieringar** kryssrutan om går inte finns mellan hello hello HANA ögonblicksbilder och hello senaste tillstånd.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-443">Clear hello **Use Delta Backups** check box if deltas do not exist between hello time of hello HANA snapshot and hello most recent state.</span></span>

 ![Rensa hello ”Använd Delta säkerhetskopieringar” kryssrutan om det finns inga går](./media/hana-overview-high-availability-disaster-recovery/image19-recover-database-d.png)

6. <span data-ttu-id="0c3ea-445">Klicka på Sammanfattning hello-skärmen **Slutför** toostart hello återställningen.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-445">On hello summary screen, click **Finish** toostart hello restoration procedure.</span></span>

 ![Klicka på ”Slutför” på hello översiktsskärm](./media/hana-overview-high-availability-disaster-recovery/image20-recover-database-e.png)

### <a name="recovering-tooanother-point-in-time"></a><span data-ttu-id="0c3ea-447">Återställer tooanother tidpunkt</span><span class="sxs-lookup"><span data-stu-id="0c3ea-447">Recovering tooanother point in time</span></span>
<span data-ttu-id="0c3ea-448">toorecover tooa tidpunkt mellan hello HANA ögonblicksbild (ingår i hello lagring ögonblicksbild) och som är senare än hello HANA ögonblicksbild point-in-time-återställning, hello följande:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-448">toorecover tooa point in time between hello HANA snapshot (included in hello storage snapshot) and one that is later than hello HANA snapshot point-in-time recovery, do hello following:</span></span>

1. <span data-ttu-id="0c3ea-449">Kontrollera att du har alla säkerhetskopieringar av transaktionsloggen från hello HANA ögonblicksbild toohello tid toorecover.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-449">Make sure that you have all transaction log backups from hello HANA snapshot toohello time you want toorecover.</span></span>
2. <span data-ttu-id="0c3ea-450">Börja hello under ”toohello senaste återställningsläge”.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-450">Begin hello procedure under "Recovering toohello most recent state."</span></span>
3. <span data-ttu-id="0c3ea-451">I steg 2 i hello proceduren i hello **ange återställningstyp** väljer **Återställ hello databasen toohello följande punkten i**anger hello punkt i tiden och slutföra steg 3-6.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-451">In step 2 of hello procedure, in hello **Specify Recovery Type** window, select **Recover hello database toohello following point in time**, specify hello point in time, and then complete steps 3-6.</span></span>

## <a name="monitoring-hello-execution-of-snapshots"></a><span data-ttu-id="0c3ea-452">Övervaka hello körningen av ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="0c3ea-452">Monitoring hello execution of snapshots</span></span>

<span data-ttu-id="0c3ea-453">Du måste toomonitor hello körningen av lagring ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-453">You need toomonitor hello execution of storage snapshots.</span></span> <span data-ttu-id="0c3ea-454">hello-skript som kör en ögonblicksbild av lagring skriver tooa utdatafilen och sparar sedan toohello samma plats som hello Perl-skript.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-454">hello script that executes a storage snapshot writes output tooa file and then saves it toohello same location as hello Perl scripts.</span></span> <span data-ttu-id="0c3ea-455">En separat fil skrivs för varje ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-455">A separate file is written for each snapshot.</span></span> <span data-ttu-id="0c3ea-456">hello utdata från varje fil visar hello olika faser som hello ögonblicksbild skriptet körs:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-456">hello output of each file clearly shows hello various phases that hello snapshot script executes:</span></span>

- <span data-ttu-id="0c3ea-457">Hitta hello volymer som behöver toocreate en ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="0c3ea-457">Finding hello volumes that need toocreate a snapshot</span></span>
- <span data-ttu-id="0c3ea-458">Hitta hello-ögonblicksbilder tas från dessa volymer</span><span class="sxs-lookup"><span data-stu-id="0c3ea-458">Finding hello snapshots taken from these volumes</span></span>
- <span data-ttu-id="0c3ea-459">Ta bort eventuell befintlig ögonblicksbilder toomatch hello antal ögonblicksbilder som du har angett</span><span class="sxs-lookup"><span data-stu-id="0c3ea-459">Deleting eventual existing snapshots toomatch hello number of snapshots you specified</span></span>
- <span data-ttu-id="0c3ea-460">Skapa en ögonblicksbild av HANA</span><span class="sxs-lookup"><span data-stu-id="0c3ea-460">Creating a HANA snapshot</span></span>
- <span data-ttu-id="0c3ea-461">Att skapa en ögonblicksbild för lagring av hello över hello volymer</span><span class="sxs-lookup"><span data-stu-id="0c3ea-461">Creating hello storage snapshot over hello volumes</span></span>
- <span data-ttu-id="0c3ea-462">Du tar bort hello HANA ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="0c3ea-462">Deleting hello HANA snapshot</span></span>
- <span data-ttu-id="0c3ea-463">Byta namn på hello senaste ögonblicksbilden för**.0**</span><span class="sxs-lookup"><span data-stu-id="0c3ea-463">Renaming hello most recent snapshot too**.0**</span></span>

<span data-ttu-id="0c3ea-464">hello viktigaste delen av hello skript är:</span><span class="sxs-lookup"><span data-stu-id="0c3ea-464">hello most important part of hello script is this:</span></span>
```
**********************Creating HANA snapshot**********************
Creating hello HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data create snapshot"" ...
HANA snapshot created successfully.
**********************Creating Storage snapshot**********************
Taking snapshot hourly.recent for hana_data_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_backup_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_shared_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for sapmnt_lhanad01_t020_vol ...
Snapshot created successfully.
**********************Deleting HANA snapshot**********************
Deleting hello HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data drop snapshot"" ...
HANA snapshot deletion successfully.
```
<span data-ttu-id="0c3ea-465">Från det här exemplet kan du se hur hello skript poster hello skapandet av hello HANA ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-465">You can see from this sample how hello script records hello creation of hello HANA snapshot.</span></span> <span data-ttu-id="0c3ea-466">Hello skalbar om initieras den här processen på hello huvudnod.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-466">In hello scale-out case, this process is initiated on hello master node.</span></span> <span data-ttu-id="0c3ea-467">hello huvudnoden initierar hello synkron hello att ögonblicksbilder skapas på varje hello arbetsnoderna.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-467">hello master node initiates hello synchronous creation of hello snapshots on each of hello worker nodes.</span></span> <span data-ttu-id="0c3ea-468">Sedan tas hello lagring ögonblicksbilden.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-468">Then hello storage snapshot is taken.</span></span> <span data-ttu-id="0c3ea-469">Efter hello har körts hello lagring ögonblicksbilder, tas hello HANA ögonblicksbild bort.</span><span class="sxs-lookup"><span data-stu-id="0c3ea-469">After hello successful execution of hello storage snapshots, hello HANA snapshot is deleted.</span></span>
