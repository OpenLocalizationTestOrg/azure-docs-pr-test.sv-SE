---
title: "SAP HANA Azure Backup på filnivå | Microsoft Docs"
description: "Det finns två huvudsakliga säkerhetskopiering möjligheter för SAP HANA på Azure virtual machines, den här artikeln beskriver SAP HANA Azure Backup på filnivå"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 5db0ceb1648b5afa278e1cbe1c42fce8033bfdc1
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="79709-103">SAP HANA Azure Backup på filnivå</span><span class="sxs-lookup"><span data-stu-id="79709-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="79709-104">Introduktion</span><span class="sxs-lookup"><span data-stu-id="79709-104">Introduction</span></span>

<span data-ttu-id="79709-105">Detta är en del av en serie i tre delar av relaterade artiklar på SAP HANA-säkerhetskopia.</span><span class="sxs-lookup"><span data-stu-id="79709-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="79709-106">[Säkerhetskopiering guide för SAP HANA på Azure Virtual Machines](./sap-hana-backup-guide.md) innehåller en översikt och information om att komma igång och [SAP HANA säkerhetskopiering baserat på lagring ögonblicksbilder](./sap-hana-backup-storage-snapshots.md) omfattar det ögonblicksbild-baserad säkerhetskopiering lagringsalternativet.</span><span class="sxs-lookup"><span data-stu-id="79709-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="79709-107">Tittar på Azure VM-storlekar, kan en se att en GS5 tillåter 64 anslutna diskar.</span><span class="sxs-lookup"><span data-stu-id="79709-107">Looking at the Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="79709-108">För stora SAP HANA vidtagit ett stort antal diskar redan för data och loggfiler, eventuellt i kombination med programvarubaserad RAID för disken i/o-genomflöde.</span><span class="sxs-lookup"><span data-stu-id="79709-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="79709-109">Frågan sedan är var du vill lagra SAP HANA säkerhetskopierade filer, vilket kan fylla diskarna bifogade data över tid?</span><span class="sxs-lookup"><span data-stu-id="79709-109">The question then is where to store SAP HANA backup files, which could fill up the attached data disks over time?</span></span> <span data-ttu-id="79709-110">Se [storlekar för virtuella Linux-datorer i Azure](../../linux/sizes.md) för tabellerna i Azure VM-storlek.</span><span class="sxs-lookup"><span data-stu-id="79709-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for the Azure VM size tables.</span></span>

<span data-ttu-id="79709-111">Det finns ingen säkerhetskopiering SAP HANA-integrering med Azure Backup-tjänsten just nu.</span><span class="sxs-lookup"><span data-stu-id="79709-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="79709-112">Det vanliga sättet att hantera säkerhetskopiering/återställning på filnivå är med en filbaserad säkerhetskopia via SAP HANA Studio eller via SAP HANA SQL-instruktioner.</span><span class="sxs-lookup"><span data-stu-id="79709-112">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="79709-113">Se [System vyer referens och SAP HANA SQL](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) för mer information.</span><span class="sxs-lookup"><span data-stu-id="79709-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![Den här bilden visar dialogrutan säkerhetskopiering menyalternativets i SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="79709-115">Den här bilden visar dialogrutan säkerhetskopiering menyalternativets i SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="79709-115">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="79709-116">När du väljer typen &quot;filen&quot; ett måste ange en sökväg i filsystemet där SAP HANA skriver de säkerhetskopiera filerna.</span><span class="sxs-lookup"><span data-stu-id="79709-116">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="79709-117">Återställningen fungerar på samma sätt.</span><span class="sxs-lookup"><span data-stu-id="79709-117">Restore works the same way.</span></span>

<span data-ttu-id="79709-118">Det här alternativet låter enkel och direkt framåt, finns men det några överväganden.</span><span class="sxs-lookup"><span data-stu-id="79709-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="79709-119">Som tidigare nämnts, har en begränsning av antalet datadiskar som kan bifogas en Azure VM.</span><span class="sxs-lookup"><span data-stu-id="79709-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="79709-120">Det kanske inte kapacitet att lagra säkerhetskopiorna för SAP HANA på filsystem för den virtuella datorn, beroende på storleken på databas och disk genomströmning krav, som kan handla om programvara RAID med striping över flera diskar.</span><span class="sxs-lookup"><span data-stu-id="79709-120">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="79709-121">Olika alternativ för att flytta dessa säkerhetskopior, och hantera filen storlek restriktioner och prestanda vid hantering av terabyte data, tillhandahålls nedan.</span><span class="sxs-lookup"><span data-stu-id="79709-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="79709-122">Ett annat alternativ som ger större frihet om total kapacitet är Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="79709-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="79709-123">Även om en enda blob är också begränsad till 1 TB, är den totala kapaciteten för en enda blob-behållare för närvarande 500 TB.</span><span class="sxs-lookup"><span data-stu-id="79709-123">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="79709-124">Dessutom kan den ger kunder möjlighet att välja s.k. &quot;kall&quot; blob-lagring, som har en kostnad.</span><span class="sxs-lookup"><span data-stu-id="79709-124">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="79709-125">Se [Azure Blob Storage: frekvent och kall lagringsnivåer](../../../storage/blobs/storage-blob-storage-tiers.md) för ytterligare information om kall blob-lagring.</span><span class="sxs-lookup"><span data-stu-id="79709-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="79709-126">Använd ett geo-replikerade storage-konto för ytterligare säkerhet för SAP HANA säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="79709-126">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="79709-127">Se [Azure Storage-replikering](../../../storage/common/storage-redundancy.md) mer information om replikering av lagringskonton.</span><span class="sxs-lookup"><span data-stu-id="79709-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="79709-128">En kunde placera dedikerade virtuella hårddiskar för SAP HANA säkerhetskopieringar i en dedikerad backup storage-konto som är georeplikerad.</span><span class="sxs-lookup"><span data-stu-id="79709-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="79709-129">Annars en gick att kopiera de virtuella hårddiskar som behåller SAP HANA-säkerhetskopior till ett geo-replikerade lagringskonto eller till ett lagringskonto som är i en annan region.</span><span class="sxs-lookup"><span data-stu-id="79709-129">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="79709-130">Azure backup-agenten</span><span class="sxs-lookup"><span data-stu-id="79709-130">Azure backup agent</span></span>

<span data-ttu-id="79709-131">Azure-säkerhetskopiering ger möjlighet att inte bara säkerhetskopiera fullständig virtuella datorer, men filer och kataloger via backup-agenten som måste installeras på gästoperativsystemet.</span><span class="sxs-lookup"><span data-stu-id="79709-131">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="79709-132">Men från och med December 2016 agenten bara stöds på Windows (se [säkerhetskopiera en Windows Server eller klient till Azure med hjälp av Resource Manager-distributionsmodellen](../../../backup/backup-configure-vault.md)).</span><span class="sxs-lookup"><span data-stu-id="79709-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="79709-133">En lösning är att först kopiera SAP HANA säkerhetskopieringsfiler till en virtuell Windows-dator i Azure (till exempel via SAMBA-resurs) och sedan använda Azure backup-agenten därifrån.</span><span class="sxs-lookup"><span data-stu-id="79709-133">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="79709-134">Det är tekniskt möjligt, skulle den lägger till komplexitet och långsammare säkerhetskopieringen eller återställningen ganska lite på grund av att kopiera mellan Linux och Windows-VM.</span><span class="sxs-lookup"><span data-stu-id="79709-134">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="79709-135">Det rekommenderas inte att följa den här metoden.</span><span class="sxs-lookup"><span data-stu-id="79709-135">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="79709-136">Information om verktyget Azure blobxfer</span><span class="sxs-lookup"><span data-stu-id="79709-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="79709-137">Om du vill lagra kataloger och filer på Azure-lagring kan en använda CLI eller PowerShell eller utveckla ett verktyg med någon av de [Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="79709-137">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="79709-138">Det finns också en färdiga att använda verktyget AzCopy, för att kopiera data till Azure storage, men det är bara Windows (se [överföra data med kommandoradsverktyget Azcopy](../../../storage/common/storage-use-azcopy.md)).</span><span class="sxs-lookup"><span data-stu-id="79709-138">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="79709-139">Därför användes blobxfer för att kopiera säkerhetskopieringsfilerna för SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="79709-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="79709-140">Det är öppen källkod som används av många kunder i produktionsmiljöer och finns på [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="79709-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="79709-141">Det här verktyget går det att kopiera data direkt till Azure blob storage eller Azure-filresursen.</span><span class="sxs-lookup"><span data-stu-id="79709-141">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="79709-142">Den erbjuder också ett antal användbara funktioner, till exempel md5-hash eller automatisk parallellitet när du kopierar en katalog med flera filer.</span><span class="sxs-lookup"><span data-stu-id="79709-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="79709-143">SAP HANA säkerhetskopieringsprestanda</span><span class="sxs-lookup"><span data-stu-id="79709-143">SAP HANA backup performance</span></span>

![Den här skärmbilden har konsolen SAP HANA säkerhetskopiering i SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="79709-145">Den här skärmbilden har konsolen SAP HANA säkerhetskopiering i SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="79709-145">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="79709-146">Det tog ungefär 42 minuter för att utföra säkerhetskopieringen 230 GB på en enda Azure standardlagring disk som är ansluten till HANA VM XFS-filsystemet.</span><span class="sxs-lookup"><span data-stu-id="79709-146">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![Den här skärmbilden har YaST på den Virtuella testdatorn i SAP HANA](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="79709-148">Den här skärmbilden har YaST på den Virtuella testdatorn i SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="79709-148">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="79709-149">En kan se 1 TB enskild disk för SAP HANA-säkerhetskopiering som tidigare nämnts.</span><span class="sxs-lookup"><span data-stu-id="79709-149">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="79709-150">Det tog ungefär 42 minuter till säkerhetskopiering 230 GB.</span><span class="sxs-lookup"><span data-stu-id="79709-150">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="79709-151">Dessutom fem 200 GB diskar har anslutits och programvara RAID md0 skapats med striping ovanpå diskarna fem Azure data.</span><span class="sxs-lookup"><span data-stu-id="79709-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![Upprepa samma säkerhetskopia på programvara anslutna RAID med striping över fem Azure standardlagring datadiskar](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="79709-153">Upprepa samma säkerhetskopia på programvara koppla RAID med striping över fem Azure standardlagring datadiskar tas säkerhetskopieringstiden 42 minuter till 10 minuter.</span><span class="sxs-lookup"><span data-stu-id="79709-153">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="79709-154">Diskarna bifogades utan att cachelagra till den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="79709-154">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="79709-155">Det är därför uppenbara hur viktigt disk genomströmning för skrivning är för tid för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="79709-155">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="79709-156">Något gick sedan växla till Azure premium-lagring till ytterligare skynda på processen för optimala prestanda.</span><span class="sxs-lookup"><span data-stu-id="79709-156">One could then switch to Azure premium storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="79709-157">I allmänhet ska Azure premium-lagring användas för produktionssystem.</span><span class="sxs-lookup"><span data-stu-id="79709-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="79709-158">Kopiera SAP HANA säkerhetskopieringsfiler till Azure blob storage</span><span class="sxs-lookup"><span data-stu-id="79709-158">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="79709-159">Från och med December 2016 är det bästa alternativet att snabbt lagra säkerhetskopiorna för SAP HANA Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="79709-159">As of December 2016, the best option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="79709-160">En enda blob-behållare är begränsad till 500 TB tillräckligt för de flesta SAP HANA-system, körs i en GS5 virtuell dator på Azure för att hålla tillräckligt SAP HANA-säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="79709-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="79709-161">Kunderna kan välja mellan &quot;varm&quot; och &quot;kalla&quot; blob-lagring (se [Azure Blob Storage: frekvent och kall lagringsnivåer](../../../storage/blobs/storage-blob-storage-tiers.md)).</span><span class="sxs-lookup"><span data-stu-id="79709-161">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="79709-162">Med verktyget blobxfer är det lätt att kopiera de säkerhetskopiera filerna för SAP HANA direkt till Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="79709-162">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![Här ser en filerna för en fullständig säkerhetskopia för SAP HANA](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="79709-164">Här ser en filerna för en fullständig säkerhetskopia för SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="79709-164">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="79709-165">Det finns fyra filer och den största som har ungefär 230 GB.</span><span class="sxs-lookup"><span data-stu-id="79709-165">There are four files and the biggest one has roughly 230 GB.</span></span>

![Det tog ungefär 3000 sekunder att kopiera 230 GB till Azure standardlagring konto blob-behållare](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="79709-167">Inte använder md5-hash i det första testet, som det tog ungefär 3000 sekunder att kopiera 230 GB till Azure standardlagring konto blob-behållare.</span><span class="sxs-lookup"><span data-stu-id="79709-167">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![I den här skärmbilden kan en se hur den ser ut på Azure portal](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="79709-169">I den här skärmbilden kan en se hur den ser ut på Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="79709-169">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="79709-170">En blobbbehållare med namnet &quot;sap-hana-säkerhetskopior&quot; har skapats och innehåller fyra blobar som representerar de säkerhetskopiera filerna för SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="79709-170">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="79709-171">En av dem har en storlek på ungefär 230 GB.</span><span class="sxs-lookup"><span data-stu-id="79709-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="79709-172">Konsolen HANA Studio backup går det att begränsa den maximala filstorleken på HANA säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="79709-172">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="79709-173">I exempel-miljö bättre prestanda genom att göra det möjligt att ha flera mindre säkerhetskopierade filer i stället för en stor 230 GB-fil.</span><span class="sxs-lookup"><span data-stu-id="79709-173">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![Storleksgräns för säkerhetskopian på HANA på klientsidan & #39, t förbättra ange tid för säkerhetskopiering](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="79709-175">Ange storleksgränsen säkerhetskopian på HANA på klientsidan & #39, t förbättra tid för säkerhetskopiering eftersom filerna skrivs i tur och ordning som visas i bilden.</span><span class="sxs-lookup"><span data-stu-id="79709-175">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="79709-176">Maximal filstorlek har angetts till 60 GB så säkerhetskopian skapas fyra stora datafiler i stället för 230 GB enskild fil.</span><span class="sxs-lookup"><span data-stu-id="79709-176">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span>

![Om du vill testa parallellitet i verktyget blobxfer angavs sedan den maximala filstorleken för HANA säkerhetskopieringar till 15 GB](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="79709-178">Om du vill testa parallellitet i verktyget blobxfer angavs sedan den maximala filstorleken för HANA säkerhetskopieringar till 15 GB, vilket resulterade i 19 säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="79709-178">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="79709-179">Den här konfigurationen tas tiden för blobxfer att kopiera 230 GB till Azure blob storage från 3000 sekunder till 875 sekunder.</span><span class="sxs-lookup"><span data-stu-id="79709-179">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="79709-180">Detta beror på högst 60 MB per sekund för att skriva en Azure blob.</span><span class="sxs-lookup"><span data-stu-id="79709-180">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="79709-181">Parallellitet via flera BLOB löser flaskhals, men det finns en nackdelen: öka prestanda i blobxfer-verktyget för att kopiera alla dessa HANA säkerhetskopieringsfiler till Azure blob storage placerar belastningen på både HANA VM och nätverk.</span><span class="sxs-lookup"><span data-stu-id="79709-181">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="79709-182">HANA systemet blir påverkas.</span><span class="sxs-lookup"><span data-stu-id="79709-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="79709-183">BLOB-kopia av dedikerade Azure diskar i säkerhetskopieringsprogrammet RAID</span><span class="sxs-lookup"><span data-stu-id="79709-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="79709-184">Till skillnad från disksäkerhetskopiering manuell VM data i den här metoden en loggar säkerhetskopiera alla datadiskar på en virtuell dator för att spara hela SAP installationen, inklusive HANA data HANA inte filer och konfigurationsfiler.</span><span class="sxs-lookup"><span data-stu-id="79709-184">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="79709-185">I stället är idé att har särskilda programvarubaserad RAID med striping över flera Azure data virtuella hårddiskar för lagring av en fullständig säkerhetskopia för SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="79709-185">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="79709-186">En kopieras endast de diskar som har SAP HANA-säkerhetskopia.</span><span class="sxs-lookup"><span data-stu-id="79709-186">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="79709-187">De enkelt kan sparas i ett dedikerat HANA backup storage-konto, eller anslutna till en dedikerad &quot;säkerhetskopiera management VM&quot; för vidare bearbetning.</span><span class="sxs-lookup"><span data-stu-id="79709-187">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![Alla virtuella hårddiskar som har kopierats med hjälp av den ** start-azurestorageblobcopy ** PowerShell-kommando](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="79709-189">När säkerhetskopieringen till den lokala programvarubaserad RAID slutfördes alla virtuella hårddiskar som har kopierats med hjälp av den **start azurestorageblobcopy** PowerShell-kommando (finns [Start AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span><span class="sxs-lookup"><span data-stu-id="79709-189">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="79709-190">Eftersom det påverkar endast dedikerade filsystemet för att behålla de säkerhetskopiera filerna, finns det inga frågor om konsekvens för SAP HANA-data eller loggfil fil på disken.</span><span class="sxs-lookup"><span data-stu-id="79709-190">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="79709-191">En fördel med det här kommandot är att det fungerar samtidigt som den virtuella datorn fortfarande är online.</span><span class="sxs-lookup"><span data-stu-id="79709-191">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="79709-192">Om du vill vara säker på att det finns ingen process skrivs säkerhetskopiering stripe-uppsättningen, bör du demontera innan blob-kopia och montera den igen efteråt.</span><span class="sxs-lookup"><span data-stu-id="79709-192">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="79709-193">En kan också använda ett lämpligt sätt att &quot;låsa&quot; filsystemet.</span><span class="sxs-lookup"><span data-stu-id="79709-193">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="79709-194">Till exempel via xfs\_Lås för XFS filsystem.</span><span class="sxs-lookup"><span data-stu-id="79709-194">For example, via xfs\_freeze for the XFS file system.</span></span>

![Den här skärmbilden visar en lista över blobbar i behållaren virtuella hårddiskar på Azure portal](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="79709-196">Den här skärmbilden visar en lista över blobbar i den &quot;virtuella hårddiskar&quot; behållare på Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="79709-196">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="79709-197">Skärmbilden visar de virtuella hårddiskarna fem som var kopplat till SAP HANA-server VM som fungerar som programvarubaserad RAID att hålla SAP HANA säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="79709-197">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="79709-198">Den visar även de fem kopiorna som togs via kommandot Kopiera blob.</span><span class="sxs-lookup"><span data-stu-id="79709-198">It also shows the five copies, which were taken via the blob copy command.</span></span>

![I testsyfte kan var kopior av programvaran för säkerhetskopiering RAID-diskar för SAP HANA kopplat till app-servern VM](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="79709-200">I testsyfte kan bifogades kopior av SAP HANA säkerhetskopieringsprogrammet RAID-diskar till app-servern VM.</span><span class="sxs-lookup"><span data-stu-id="79709-200">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![App-serverns Virtuella stängdes för att ansluta disken kopieras](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="79709-202">App-serverns Virtuella stängdes att ansluta disken kopieras.</span><span class="sxs-lookup"><span data-stu-id="79709-202">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="79709-203">När du har startat den virtuella datorn, diskar och RAID upptäcktes på rätt sätt (monterade via UUID).</span><span class="sxs-lookup"><span data-stu-id="79709-203">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="79709-204">Endast monteringspunkten saknades som har skapats via YaST partitioneraren.</span><span class="sxs-lookup"><span data-stu-id="79709-204">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="79709-205">SAP HANA säkerhetskopian kopior blev därefter visas på OS-nivå.</span><span class="sxs-lookup"><span data-stu-id="79709-205">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="79709-206">Kopiera SAP HANA säkerhetskopieringsfiler till NFS-resurs</span><span class="sxs-lookup"><span data-stu-id="79709-206">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="79709-207">Om du vill minska den potentiella påverkan på SAP HANA-system från ett prestandaproblem eller disk space perspektiv, en överväga att lagra säkerhetskopiorna för SAP HANA på en NFS-resurs.</span><span class="sxs-lookup"><span data-stu-id="79709-207">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="79709-208">Tekniskt sett fungerar, men innebär det med hjälp av en andra virtuell Azure-dator som värd för NFS-resursen.</span><span class="sxs-lookup"><span data-stu-id="79709-208">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="79709-209">Det får inte vara en mindre VM-storlek på grund av Virtuella nätverkets bandbredd.</span><span class="sxs-lookup"><span data-stu-id="79709-209">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="79709-210">Det skulle vara klokt sedan för att stänga av det här &quot;säkerhetskopiera VM&quot; och bara ta dig köra SAP HANA-säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="79709-210">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="79709-211">Skriva på en NFS resursen placerar belastningen i nätverket och påverkar SAP HANA-systemet, men bara hantera efteråt de säkerhetskopiera filerna på den &quot;säkerhetskopiera VM&quot; inte skulle påverka systemets SAP HANA alls.</span><span class="sxs-lookup"><span data-stu-id="79709-211">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![En NFS-resurs från en annan virtuell dator i Azure har monterats till SAP HANA-servern VM](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="79709-213">Om du vill verifiera NFS användningsfall har en NFS-resurs från en annan virtuell dator i Azure monterade till SAP HANA-servern VM.</span><span class="sxs-lookup"><span data-stu-id="79709-213">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="79709-214">Det fanns ingen särskild NFS justera tillämpas.</span><span class="sxs-lookup"><span data-stu-id="79709-214">There was no special NFS tuning applied.</span></span>

![Det tog 1 timme och 46 minuter att utföra säkerhetskopieringen direkt](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="79709-216">NFS-resurs har en snabb stripe-uppsättning, t.ex. en på SAP HANA-servern.</span><span class="sxs-lookup"><span data-stu-id="79709-216">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="79709-217">Det tog dock 1 timme och 46 minuter för att utföra säkerhetskopieringen direkt på NFS-resursens i stället för tio minuter, om värdet är att skriva till en lokal stripe.</span><span class="sxs-lookup"><span data-stu-id="79709-217">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![Alternativt inte mycket snabbare på 1 timme och 43 minuter](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="79709-219">Med alternativet att göra en säkerhetskopia till en lokal stripe-uppsättning och kopiera till NFS-resurs på OS-nivå (en enkel **cp - avr** kommando) inte mycket snabbare.</span><span class="sxs-lookup"><span data-stu-id="79709-219">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="79709-220">Det tog 1 timme och 43 minuter.</span><span class="sxs-lookup"><span data-stu-id="79709-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="79709-221">Så här fungerar det, men prestanda inte bra för säkerhetskopiering 230 GB.</span><span class="sxs-lookup"><span data-stu-id="79709-221">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="79709-222">Det ser ut ännu större för flera terabyte.</span><span class="sxs-lookup"><span data-stu-id="79709-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-file-service"></a><span data-ttu-id="79709-223">Kopiera SAP HANA säkerhetskopieringsfiler till tjänsten Azure file</span><span class="sxs-lookup"><span data-stu-id="79709-223">Copy SAP HANA backup files to Azure file service</span></span>

<span data-ttu-id="79709-224">Det är möjligt att montera en Azure-filresursen i en Azure Linux-dator.</span><span class="sxs-lookup"><span data-stu-id="79709-224">It is possible to mount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="79709-225">Artikeln [använda Azure File storage med Linux](../../../storage/files/storage-how-to-use-files-linux.md) innehåller information om hur du gör.</span><span class="sxs-lookup"><span data-stu-id="79709-225">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="79709-226">Tänk på att det finns för närvarande en 5 TB kvotgräns för en Azure-filresursen och begränsningar för filstorleken på 1 TB per fil.</span><span class="sxs-lookup"><span data-stu-id="79709-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="79709-227">Se [Azure Storage skalbarhets- och prestandamål](../../../storage/common/storage-scalability-targets.md) information om Lagringsgränser.</span><span class="sxs-lookup"><span data-stu-id="79709-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="79709-228">Testerna har visas dock som SAP HANA säkerhetskopiering inte &#39; t just nu arbetar direkt med den här typen av CIFS monteringspunkt.</span><span class="sxs-lookup"><span data-stu-id="79709-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="79709-229">Anges också i [SAP Obs 1820529](https://launchpad.support.sap.com/#/notes/1820529) som CIFS rekommenderas inte.</span><span class="sxs-lookup"><span data-stu-id="79709-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![Den här bilden visar ett fel i dialogrutan säkerhetskopiering i SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="79709-231">Den här bilden visar ett fel i dialogrutan säkerhetskopiering i SAP HANA Studio när du försöker säkerhetskopiera direkt till en monterad CIFS Azure-filresursen.</span><span class="sxs-lookup"><span data-stu-id="79709-231">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="79709-232">Ett har att göra en standard SAP HANA-säkerhetskopia i ett VM-filsystem först och sedan kopiera säkerhetskopieringsfilerna därifrån till tjänsten Azure file.</span><span class="sxs-lookup"><span data-stu-id="79709-232">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![Den här bilden visar det tog ungefär 929 sekunder för att kopiera 19 SAP HANA-säkerhetskopior](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="79709-234">Den här bilden visar att det tog ungefär 929 sekunder för att kopiera 19 SAP HANA säkerhetskopieringsfiler med en total storlek på ungefär 230 GB till Azure-filresursen.</span><span class="sxs-lookup"><span data-stu-id="79709-234">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![Källan katalogstrukturen på SAP HANA VM har kopierats till Azure-filresursen](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="79709-236">I den här skärmbilden en kan se att källan katalogstrukturen på SAP HANA VM har kopierats till Azure-filresursen: en katalog (hana\_säkerhetskopiering\_fsl\_15 gb) och 19 enskilda säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="79709-236">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="79709-237">Lagra säkerhetskopior för SAP HANA på Azure-filer kan vara ett intressanta alternativ i framtiden när säkerhetskopiorna för SAP HANA stöder den direkt.</span><span class="sxs-lookup"><span data-stu-id="79709-237">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="79709-238">Eller när det blir möjligt att montera Azure-filer via NFS och den största kvoten är avsevärt högre än 5 TB.</span><span class="sxs-lookup"><span data-stu-id="79709-238">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="79709-239">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="79709-239">Next steps</span></span>
* <span data-ttu-id="79709-240">[Säkerhetskopiering guide för SAP HANA på Azure Virtual Machines](sap-hana-backup-guide.md) ger en översikt och information om att komma igång.</span><span class="sxs-lookup"><span data-stu-id="79709-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="79709-241">[SAP HANA säkerhetskopiering baserat på lagring ögonblicksbilder](sap-hana-backup-storage-snapshots.md) beskriver det ögonblicksbild-baserad säkerhetskopiering lagringsalternativet.</span><span class="sxs-lookup"><span data-stu-id="79709-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="79709-242">Information om hur du upprättar och planera för katastrofåterställning för SAP HANA i Azure (stora instanser) med hög tillgänglighet finns [SAP HANA (stora instanser) hög tillgänglighet och katastrofåterställning recovery på Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="79709-242">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
