---
title: "aaaAdd övervakning och diagnostik tooan virtuell Azure-dator | Microsoft Docs"
description: "Använda en Azure resource manager-mall toocreate en ny virtuell dator för Windows Azure-diagnostik-tillägget."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="0b0f3-103">Använd övervakning och diagnostik med en virtuell Windows-dator och Azure Resource Manager-mallar</span><span class="sxs-lookup"><span data-stu-id="0b0f3-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="0b0f3-104">hello Azure Diagnostics tillägget innehåller hello övervakning och diagnostik-funktioner på en Windows-baserade virtuella Azure-datorn.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="0b0f3-105">Du kan aktivera dessa funktioner på hello virtuella datorn genom att inkludera hello-tillägget som en del av hello azure resource manager-mall.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="0b0f3-106">Se [redigera Azure Resource Manager-mallar med VM-tillägg](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) mer information om inklusive alla tillägg som en del av en mall för virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="0b0f3-107">Den här artikeln beskriver hur du kan lägga till hello Azure Diagnostics tillägget tooa windows virtuell Datormall.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="0b0f3-108">Lägg till hello Azure Diagnostics tillägget toohello VM resursdefinitionen</span><span class="sxs-lookup"><span data-stu-id="0b0f3-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="0b0f3-109">tooenable hello diagnostik tillägg på en Windows-dator måste tooadd hello-tillägget som en VM-resurs i hello Resource manager-mall.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="0b0f3-110">För en enkel Resource Manager baserat virtuella lägga till hello-tillägget configuration toohello *resurser* matris för hello virtuell dator:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="0b0f3-111">En annan vanliga konventionen är lägga till hello tilläggets konfiguration hello resurser rotnoden i hello mall istället för att definiera under hello den virtuella datorns resurser noden.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="0b0f3-112">Med den här metoden har tooexplicitly ange en hierarkisk relation mellan hello-tillägget och hello virtuell dator med hello *namn* och *typen* värden.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="0b0f3-113">Exempel:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="0b0f3-114">hello tillägget alltid är associerad med hello virtuell dator kan du antingen direkt definiera under hello virtuella datorns resursnoden direkt eller definiera på hello basnivån och använda hello hierarkiska naming convention tooassociate med hello virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="0b0f3-115">För virtuella datorer hello-tillägg-konfiguration har angetts i hello *extensionProfile* -egenskapen för hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="0b0f3-116">hello *publisher* egenskapen med värdet hello **Microsoft.Azure.Diagnostics** och hello *typen* egenskapen med värdet hello **IaaSDiagnostics** identifiera hello Azure Diagnostics tillägg.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="0b0f3-117">Hej värdet för hello *namn* egenskapen kan ha använt toorefer toohello tillägget hello resursgruppen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="0b0f3-118">Om du anger specifikt för**Microsoft.Insights.VMDiagnosticsSettings** kommer det att toobe som enkelt kan identifieras av Azure portal säkerställt hello som hello övervakning diagram visas korrekt i hello Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="0b0f3-119">Hej *typeHandlerVersion* anger hello version hello-tillägget som toouse.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="0b0f3-120">Ange *autoUpgradeMinorVersion* lägre version för**SANT** garanterar att du får hello senaste lägre version av hello-tillägg som är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="0b0f3-121">Vi rekommenderar att du alltid anger *autoUpgradeMinorVersion* tooalways vara **SANT** så att du alltid får toouse hello senaste tillgängliga diagnostik tillägg med alla hello nya funktioner och programfel korrigeringar.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="0b0f3-122">Hej *inställningar* element innehåller konfigurationer egenskaper för hello-tillägg som kan ange och läsa tillbaka från hello-tillägg (ibland hänvisade tooas offentliga konfiguration).</span><span class="sxs-lookup"><span data-stu-id="0b0f3-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="0b0f3-123">Hej *xmlcfg* egenskap innehåller XML-baserad konfiguration för hello diagnostik loggar prestandaräknare etc hello diagnostik agent kommer att samlas in.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="0b0f3-124">Se [diagnostik Konfigurationsschemat](https://msdn.microsoft.com/library/azure/dn782207.aspx) för mer information om hello XML-schema sig själv.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="0b0f3-125">Ett vanligt är toostore hello faktiska xml-konfigurationen som en variabel i hello Azure Resource Manager-mall och sedan Sammanfoga och base64 koda dem tooset hello värde för *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="0b0f3-126">Avsnittet hello på [diagnostik configuration variabler](#diagnostics-configuration-variables) toounderstand mer om hur toostore hello xml i variabler.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="0b0f3-127">Hej *storageAccount* egenskapen anger hello namnet på hello storage-konto toowhich diagnostikdata överförs.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="0b0f3-128">Hej egenskaper i *protectedSettings* (ibland hänvisade tooas privata konfiguration) kan ställas in men går inte att läsa efter ett anges.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="0b0f3-129">Hej lässkyddad uppbyggnad *protectedSettings* kan användas för att lagra hemligheter som hello lagringskontonyckel där hello diagnostikdata ska skrivas.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="0b0f3-130">Ange diagnostiklagringskonto som parametrar</span><span class="sxs-lookup"><span data-stu-id="0b0f3-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="0b0f3-131">hello diagnostik tillägget json fragment ovan förutsätter att två parametrar *existingdiagnosticsStorageAccountName* och *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostik Storage-konto där diagnostikdata ska lagras.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="0b0f3-132">Att ange hello diagnostiklagringskonto som en parameter gör det enkelt toochange hello diagnostiklagringskonto mellan olika miljöer t.ex. du kanske toouse en annan diagnostiklagringskonto för testning och en för din Produktionsdistribution.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="0b0f3-133">Det är bästa praxis toospecify en diagnostiklagringskonto i en annan resursgrupp än hello resursgruppen för hello virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="0b0f3-134">Toobe en distributionsenhet med sin egen livstid kan betraktas som en resursgrupp, en virtuell dator kan distribueras och omdistribueras som nya konfigurationer uppdateringar görs den tooit men du kanske vill lagra hello diagnostikdata i hello toocontinue samma lagringskonto i dessa distributioner på virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="0b0f3-135">Med hello storage-konto i en annan resurs aktiverar hello storage-konto tooaccept data från olika distribution av virtuella datorer som gör det enkelt tootroubleshoot hello problem mellan olika versioner.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="0b0f3-136">Om du skapar en mall för virtuell dator av windows från Visual Studio hello standardkontot för lagring kan anges hello toouse samma lagringskonto där hello virtuella datorns virtuella Hårddisk har överförts.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="0b0f3-137">Detta är toosimplify installationen av hello VM.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="0b0f3-138">Du bör ändra faktorerna hello mallen toouse ett annat lagringskonto som kan skickas som en parameter.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="0b0f3-139">Variabler för diagnostik-konfiguration</span><span class="sxs-lookup"><span data-stu-id="0b0f3-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="0b0f3-140">hello diagnostik tillägget json fragment ovan definierar en *accountid* variabeln toosimplify komma hello lagringskontonyckel för hello diagnostik lagring:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="0b0f3-141">Hej *xmlcfg* egenskapen för hello diagnostik tillägg har definierats med flera variabler som sammanfogas tillsammans.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="0b0f3-142">hello värdena för dessa variabler finns i xml så att de behöver toobe (escaped) korrekt när hello json variabler.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="0b0f3-143">hello nedan beskrivs hello diagnostik xml-konfigurationsfilen som samlar in standard system nivån prestandaräknare tillsammans med vissa windows-händelseloggar och diagnostik infrastruktur loggar.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="0b0f3-144">Det har undantaget och formaterats korrekt så att hello konfiguration kan direkt klistras in i hello variabler avsnitt i mallen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="0b0f3-145">Se hello [diagnostik Konfigurationsschemat](https://msdn.microsoft.com/library/azure/dn782207.aspx) en mer mänsklig läsbar exempel på hello konfigurations-xml.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="0b0f3-146">hello mått definition xml-nod i hello ovan konfiguration är ett viktigt konfigurationselement som definierar hur hello prestandaräknare definierats tidigare i hello xml i *PerformanceCounter* noden kommer att slås samman och lagras.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="0b0f3-147">De här måtten enheten hello övervakning diagram och aviseringar i hello Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="0b0f3-148">Hej **mått** nod med hello *resourceID* och **MetricAggregation** måste inkluderas i hello diagnostik konfigurationen för den virtuella datorn om du vill toosee hello VM övervakningsdata i hello Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="0b0f3-149">hello följande är ett exempel på hello xml för definitioner av mått:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="0b0f3-150">Hej *resourceID* attributet identifierar hello virtuell dator i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="0b0f3-151">Se till att toouse hello subscription() och resourceGroup() fungerar så att hello mallen uppdateras automatiskt dessa värden baserat på hello-prenumeration och resurs-grupp som du distribuerar till.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="0b0f3-152">Om du skapar flera virtuella datorer i en slinga så har du toopopulate hello *resourceID* värde med en copyIndex() funktionen toocorrectly skilja mellan varje enskild virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="0b0f3-153">Hej *xmlCfg* värdet kan vara uppdaterade toosupport detta på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="0b0f3-154">Hej MetricAggregation värdet för *PT1H* och *PT1M* anger en sammanställning över en minut och en sammanställning över en timme.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="0b0f3-155">WADMetrics tabeller i lagring</span><span class="sxs-lookup"><span data-stu-id="0b0f3-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="0b0f3-156">hello mått configuration ovan skapar tabeller i din diagnostiklagringskonto med hello följande namngivningsregler:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="0b0f3-157">**WADMetrics** : Standard prefix för alla WADMetrics tabeller</span><span class="sxs-lookup"><span data-stu-id="0b0f3-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="0b0f3-158">**PT1H** eller **PT1M** : innebär det att hello tabellen innehåller sammanställda data över 1 timme eller 1 minut</span><span class="sxs-lookup"><span data-stu-id="0b0f3-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="0b0f3-159">**P10D** : innebär det att hello tabellen innehåller data för 10 dagar från när hello tabellen startat datainsamling</span><span class="sxs-lookup"><span data-stu-id="0b0f3-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="0b0f3-160">**V2S** : strängkonstant</span><span class="sxs-lookup"><span data-stu-id="0b0f3-160">**V2S** : String constant</span></span>
* <span data-ttu-id="0b0f3-161">**ÅÅÅÅMMDD** : hello startdatum på vilka hello tabell datainsamling</span><span class="sxs-lookup"><span data-stu-id="0b0f3-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="0b0f3-162">Exempel: *WADMetricsPT1HP10DV2S20151108* innehåller mått data visar det sammanlagda resultatet för 10 dagar från 2015-11-Nov i timmen</span><span class="sxs-lookup"><span data-stu-id="0b0f3-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="0b0f3-163">Varje tabell WADMetrics innehåller hello följande kolumner:</span><span class="sxs-lookup"><span data-stu-id="0b0f3-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="0b0f3-164">**PartitionKey**: hello partitionkey konstrueras utifrån hello *resourceID* värdet toouniquely identifiera hello Virtuella datorresursen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="0b0f3-165">för t.ex.: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="0b0f3-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="0b0f3-166">**RowKey** : sätt hello format <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="0b0f3-167">hello fallande skalstreck beräkningen är max tid tick minus hello tiden för hello början av hello aggregering period.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="0b0f3-168">T.ex.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-168">E.g.</span></span> <span data-ttu-id="0b0f3-169">Om hello provtagningsperiod startat 10 Nov 2015 och 00:00Hrs UTC sedan hello beräkningen är: DateTime.MaxValue.Ticks - (nya DateTime(2015,11,10,0,0,0,DateTimeKind.Utc). Ticks).</span><span class="sxs-lookup"><span data-stu-id="0b0f3-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="0b0f3-170">För hello minne tillgängliga byte prestandaräknaren hello radnyckel ser ut som: 2519551871999999999__:005CMemory:005CAvailable:0020 byte</span><span class="sxs-lookup"><span data-stu-id="0b0f3-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="0b0f3-171">**CounterName** : hello namn för hello prestandaräknare.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="0b0f3-172">Detta matchar hello *counterSpecifier* definieras i hello xml-konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="0b0f3-173">**Maximal** : hello maximivärdet för prestandaräknaren för hello under hello aggregering.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="0b0f3-174">**Minsta** : hello lägsta värdet för prestandaräknaren för hello under hello aggregering.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="0b0f3-175">**Totalt antal** : hello summan av alla värden för hello prestandaräknare rapporterat under hello aggregering period.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="0b0f3-176">**Antal** : hello Totalt antal värden som rapporterats för hello prestandaräknaren.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="0b0f3-177">**Genomsnittlig** : hello medelvärde (totalt/antal) för prestandaräknaren för hello under hello aggregering.</span><span class="sxs-lookup"><span data-stu-id="0b0f3-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0b0f3-178">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="0b0f3-178">Next Steps</span></span>
* <span data-ttu-id="0b0f3-179">En fullständig exempelmall för en virtuell dator i Windows med diagnostik tillägg finns [201 och vm-övervakning-diagnostik-tillägg](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="0b0f3-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="0b0f3-180">Distribuera hello resource manager mallen med hjälp av [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) eller [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="0b0f3-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="0b0f3-181">Lär dig mer om [redigera Azure Resource Manager-mallar](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="0b0f3-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

