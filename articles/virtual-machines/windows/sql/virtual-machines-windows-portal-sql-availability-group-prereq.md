---
title: "Grupper tillgänglighet för SQL Server - virtuella datorer i Azure - förutsättningar för | Microsoft Docs"
description: "Den här kursen visar hur du konfigurerar kraven för att skapa en SQL Server Always On availability group på virtuella Azure-datorer."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: c492db4c-3faa-4645-849f-5a1a663be55a
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/09/2017
ms.author: mikeray
ms.openlocfilehash: 3d508877928e033f24dae62c1042745ea7250033
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="complete-the-prerequisites-for-creating-always-on-availability-groups-on-azure-virtual-machines"></a><span data-ttu-id="13a52-103">Uppfylla förutsättningar för att skapa Always On-Tillgänglighetsgrupper på virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="13a52-103">Complete the prerequisites for creating Always On availability groups on Azure virtual machines</span></span>

<span data-ttu-id="13a52-104">Den här kursen visar hur du utför de nödvändiga förutsättningarna för att skapa en [SQL Server Always On-tillgänglighetsgruppen på virtuella Azure-datorer (VM)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="13a52-104">This tutorial shows how to complete the prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span></span> <span data-ttu-id="13a52-105">När du är klar kraven har en domänkontrollant, två virtuella SQL Server-datorer och ett vittnesserver i en enskild resursgrupp.</span><span class="sxs-lookup"><span data-stu-id="13a52-105">When you've finished the prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span></span>

<span data-ttu-id="13a52-106">**Tid uppskattning**: Det kan ta ett par timmar att slutföra förutsättningarna.</span><span class="sxs-lookup"><span data-stu-id="13a52-106">**Time estimate**: It might take a couple of hours to complete the prerequisites.</span></span> <span data-ttu-id="13a52-107">Mycket av den här tiden går åt för att skapa virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-107">Much of this time is spent creating virtual machines.</span></span>

<span data-ttu-id="13a52-108">Följande diagram illustrerar hur du skapar under kursen.</span><span class="sxs-lookup"><span data-stu-id="13a52-108">The following diagram illustrates what you build in the tutorial.</span></span>

![Tillgänglighetsgruppen](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/00-EndstateSampleNoELB.png)

## <a name="review-availability-group-documentation"></a><span data-ttu-id="13a52-110">Läs dokumentationen om tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="13a52-110">Review availability group documentation</span></span>

<span data-ttu-id="13a52-111">Den här kursen förutsätter att du har en grundläggande förståelse för SQL Server Always On-Tillgänglighetsgrupper.</span><span class="sxs-lookup"><span data-stu-id="13a52-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span></span> <span data-ttu-id="13a52-112">Om du inte är bekant med den här tekniken finns [översikt över alltid på Tillgänglighetsgrupper (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span><span class="sxs-lookup"><span data-stu-id="13a52-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span></span>


## <a name="create-an-azure-account"></a><span data-ttu-id="13a52-113">Skapa ett Azure-konto</span><span class="sxs-lookup"><span data-stu-id="13a52-113">Create an Azure account</span></span>
<span data-ttu-id="13a52-114">Du behöver ett Azure-konto.</span><span class="sxs-lookup"><span data-stu-id="13a52-114">You need an Azure account.</span></span> <span data-ttu-id="13a52-115">Du kan [öppna ett kostnadsfritt Azure-konto](/pricing/free-trial/?WT.mc_id=A261C142F) eller [aktivera Visual Studio-prenumerantförmåner](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="13a52-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span></span>

## <a name="create-a-resource-group"></a><span data-ttu-id="13a52-116">Skapa en resursgrupp</span><span class="sxs-lookup"><span data-stu-id="13a52-116">Create a resource group</span></span>
1. <span data-ttu-id="13a52-117">Logga in på [Azure Portal](http://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="13a52-117">Sign in to the [Azure portal](http://portal.azure.com).</span></span>
2. <span data-ttu-id="13a52-118">Klicka på  **+**  att skapa ett nytt objekt i portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-118">Click **+** to create a new object in the portal.</span></span>

   ![Nytt objekt](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-portalplus.png)

3. <span data-ttu-id="13a52-120">Typen **resursgruppen** i den **Marketplace** sökfönstret.</span><span class="sxs-lookup"><span data-stu-id="13a52-120">Type **resource group** in the **Marketplace** search window.</span></span>

   ![Resursgrupp](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroupsymbol.png)
4. <span data-ttu-id="13a52-122">Klicka på **resursgruppen**.</span><span class="sxs-lookup"><span data-stu-id="13a52-122">Click **Resource group**.</span></span>
5. <span data-ttu-id="13a52-123">Klicka på **Skapa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-123">Click **Create**.</span></span>
6. <span data-ttu-id="13a52-124">På den **resursgruppen** bladet under **resursgruppens namn**, Skriv ett namn för resursgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-124">On the **Resource group** blade, under **Resource group name**, type a name for the resource group.</span></span> <span data-ttu-id="13a52-125">Skriv till exempel **sql-hög tillgänglighet-rg**.</span><span class="sxs-lookup"><span data-stu-id="13a52-125">For example, type **sql-ha-rg**.</span></span>
7. <span data-ttu-id="13a52-126">Kontrollera att prenumerationen är Azure-prenumeration som du vill skapa tillgänglighetsgruppen i om du har flera Azure-prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="13a52-126">If you have multiple Azure subscriptions, verify that the subscription is the Azure subscription that you want to create the availability group in.</span></span>
8. <span data-ttu-id="13a52-127">Välj en plats.</span><span class="sxs-lookup"><span data-stu-id="13a52-127">Select a location.</span></span> <span data-ttu-id="13a52-128">Platsen är Azure-regionen där du vill skapa tillgänglighetsgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-128">The location is the Azure region where you want to create the availability group.</span></span> <span data-ttu-id="13a52-129">Den här självstudiekursen kommer vi att skapa alla resurser i en Azure-plats.</span><span class="sxs-lookup"><span data-stu-id="13a52-129">For this tutorial, we're going to build all resources in one Azure location.</span></span>
9. <span data-ttu-id="13a52-130">Kontrollera att **fäst på instrumentpanelen** är markerad.</span><span class="sxs-lookup"><span data-stu-id="13a52-130">Verify that **Pin to dashboard** is checked.</span></span> <span data-ttu-id="13a52-131">Den här valfria inställningen placeras en genväg för resursgruppen på instrumentpanelen för Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-131">This optional setting places a shortcut for the resource group on the Azure portal dashboard.</span></span>

   ![Resursgrupp](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroup.png)

10. <span data-ttu-id="13a52-133">Klicka på **skapa** att skapa resursgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-133">Click **Create** to create the resource group.</span></span>

<span data-ttu-id="13a52-134">Azure skapar resursgruppen och PIN-koder som en genväg till resursgruppen i portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-134">Azure creates the resource group and pins a shortcut to the resource group in the portal.</span></span>

## <a name="create-the-network-and-subnets"></a><span data-ttu-id="13a52-135">Skapa nätverk och undernät</span><span class="sxs-lookup"><span data-stu-id="13a52-135">Create the network and subnets</span></span>
<span data-ttu-id="13a52-136">Nästa steg är att skapa nätverk och undernät i Azure-resursgrupp.</span><span class="sxs-lookup"><span data-stu-id="13a52-136">The next step is to create the networks and subnets in the Azure resource group.</span></span>

<span data-ttu-id="13a52-137">Lösningen använder ett virtuellt nätverk med två undernät.</span><span class="sxs-lookup"><span data-stu-id="13a52-137">The solution uses one virtual network with two subnets.</span></span> <span data-ttu-id="13a52-138">Den [översikt över virtuella nätverk](../../../virtual-network/virtual-networks-overview.md) innehåller mer information om nätverk i Azure.</span><span class="sxs-lookup"><span data-stu-id="13a52-138">The [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span></span>

<span data-ttu-id="13a52-139">För att skapa det virtuella nätverket:</span><span class="sxs-lookup"><span data-stu-id="13a52-139">To create the virtual network:</span></span>

1. <span data-ttu-id="13a52-140">I Azure-portalen i resursgruppen, klickar du på **+ Lägg till**.</span><span class="sxs-lookup"><span data-stu-id="13a52-140">In the Azure portal, in your resource group, click **+ Add**.</span></span> <span data-ttu-id="13a52-141">Azure öppnas den **allt** bladet.</span><span class="sxs-lookup"><span data-stu-id="13a52-141">Azure opens the **Everything** blade.</span></span>

   ![Nytt objekt](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/02-newiteminrg.png)
2. <span data-ttu-id="13a52-143">Sök efter **virtuellt nätverk**.</span><span class="sxs-lookup"><span data-stu-id="13a52-143">Search for **virtual network**.</span></span>

     ![Sökningen virtuellt nätverk](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/04-findvirtualnetwork.png)
3. <span data-ttu-id="13a52-145">Klicka på **för virtuella nätverk**.</span><span class="sxs-lookup"><span data-stu-id="13a52-145">Click **Virtual network**.</span></span>
4. <span data-ttu-id="13a52-146">På den **för virtuella nätverk** bladet, klickar du på den **Resource Manager** distributionsmodell och klicka sedan på **skapa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-146">On the **Virtual network** blade, click the **Resource Manager** deployment model, and then click **Create**.</span></span>

    <span data-ttu-id="13a52-147">I följande tabell visas inställningarna för det virtuella nätverket:</span><span class="sxs-lookup"><span data-stu-id="13a52-147">The following table shows the settings for the virtual network:</span></span>

   | <span data-ttu-id="13a52-148">**Fält**</span><span class="sxs-lookup"><span data-stu-id="13a52-148">**Field**</span></span> | <span data-ttu-id="13a52-149">Värde</span><span class="sxs-lookup"><span data-stu-id="13a52-149">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="13a52-150">**Namn**</span><span class="sxs-lookup"><span data-stu-id="13a52-150">**Name**</span></span> |<span data-ttu-id="13a52-151">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="13a52-151">autoHAVNET</span></span> |
   | <span data-ttu-id="13a52-152">**Adressutrymme**</span><span class="sxs-lookup"><span data-stu-id="13a52-152">**Address space**</span></span> |<span data-ttu-id="13a52-153">10.33.0.0/24</span><span class="sxs-lookup"><span data-stu-id="13a52-153">10.33.0.0/24</span></span> |
   | <span data-ttu-id="13a52-154">**Namn på undernät**</span><span class="sxs-lookup"><span data-stu-id="13a52-154">**Subnet name**</span></span> |<span data-ttu-id="13a52-155">Admin</span><span class="sxs-lookup"><span data-stu-id="13a52-155">Admin</span></span> |
   | <span data-ttu-id="13a52-156">**Adressintervall för undernätet**</span><span class="sxs-lookup"><span data-stu-id="13a52-156">**Subnet address range**</span></span> |<span data-ttu-id="13a52-157">10.33.0.0/29</span><span class="sxs-lookup"><span data-stu-id="13a52-157">10.33.0.0/29</span></span> |
   | <span data-ttu-id="13a52-158">**Prenumeration**</span><span class="sxs-lookup"><span data-stu-id="13a52-158">**Subscription**</span></span> |<span data-ttu-id="13a52-159">Ange den prenumeration som du tänker använda.</span><span class="sxs-lookup"><span data-stu-id="13a52-159">Specify the subscription that you intend to use.</span></span> <span data-ttu-id="13a52-160">**Prenumerationen** är tom om du bara har en prenumeration.</span><span class="sxs-lookup"><span data-stu-id="13a52-160">**Subscription** is blank if you only have one subscription.</span></span> |
   | <span data-ttu-id="13a52-161">**Resursgrupp**</span><span class="sxs-lookup"><span data-stu-id="13a52-161">**Resource group**</span></span> |<span data-ttu-id="13a52-162">Välj **använda befintliga** och välj namnet på resursgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-162">Choose **Use existing** and pick the name of the resource group.</span></span> |
   | <span data-ttu-id="13a52-163">**Plats**</span><span class="sxs-lookup"><span data-stu-id="13a52-163">**Location**</span></span> |<span data-ttu-id="13a52-164">Ange platsen för Azure.</span><span class="sxs-lookup"><span data-stu-id="13a52-164">Specify the Azure location.</span></span> |

   <span data-ttu-id="13a52-165">Adress adressutrymmet och undernätsegenskaperna adressintervallet kan skilja sig från tabellen.</span><span class="sxs-lookup"><span data-stu-id="13a52-165">Your address space and subnet address range might be different from the table.</span></span> <span data-ttu-id="13a52-166">Beroende på din prenumeration föreslår portalen en tillgängliga adressutrymmet och motsvarande adressintervallet i undernätet.</span><span class="sxs-lookup"><span data-stu-id="13a52-166">Depending on your subscription, the portal suggests an available address space and corresponding subnet address range.</span></span> <span data-ttu-id="13a52-167">Om det finns inte tillräckligt med adressutrymme Använd en annan prenumeration.</span><span class="sxs-lookup"><span data-stu-id="13a52-167">If no sufficient address space is available, use a different subscription.</span></span>

   <span data-ttu-id="13a52-168">I exemplet används undernätnamnet **Admin**. Det här undernätet är för domänkontrollanter.</span><span class="sxs-lookup"><span data-stu-id="13a52-168">The example uses the subnet name **Admin**. This subnet is for the domain controllers.</span></span>

5. <span data-ttu-id="13a52-169">Klicka på **Skapa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-169">Click **Create**.</span></span>

   ![Konfigurera det virtuella nätverket](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/06-configurevirtualnetwork.png)

<span data-ttu-id="13a52-171">Azure återgår till portalens instrumentpanel och meddelar dig när det nya nätverket har skapats.</span><span class="sxs-lookup"><span data-stu-id="13a52-171">Azure returns you to the portal dashboard and notifies you when the new network is created.</span></span>

### <a name="create-a-second-subnet"></a><span data-ttu-id="13a52-172">Skapa ett andra undernät</span><span class="sxs-lookup"><span data-stu-id="13a52-172">Create a second subnet</span></span>
<span data-ttu-id="13a52-173">Nytt virtuellt nätverk har ett undernät, med namnet **Admin**. Domänkontrollanter använder det här undernätet.</span><span class="sxs-lookup"><span data-stu-id="13a52-173">The new virtual network has one subnet, named **Admin**. The domain controllers use this subnet.</span></span> <span data-ttu-id="13a52-174">Använda SQL Server-datorer ett andra undernät med namnet **SQL**.</span><span class="sxs-lookup"><span data-stu-id="13a52-174">The SQL Server VMs use a second subnet named **SQL**.</span></span> <span data-ttu-id="13a52-175">Konfigurera det här undernätet:</span><span class="sxs-lookup"><span data-stu-id="13a52-175">To configure this subnet:</span></span>

1. <span data-ttu-id="13a52-176">På instrumentpanelen, klickar du på den resursgrupp som du skapade **SQL-hög tillgänglighet-RG**.</span><span class="sxs-lookup"><span data-stu-id="13a52-176">On your dashboard, click the resource group that you created, **SQL-HA-RG**.</span></span> <span data-ttu-id="13a52-177">Leta upp nätverket i resursgruppen under **resurser**.</span><span class="sxs-lookup"><span data-stu-id="13a52-177">Locate the network in the resource group under **Resources**.</span></span>

    <span data-ttu-id="13a52-178">Om **SQL-hög tillgänglighet-RG** inte visas, hitta genom att klicka på **resursgrupper** och filtrering av resursgruppens namn.</span><span class="sxs-lookup"><span data-stu-id="13a52-178">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by the resource group name.</span></span>
2. <span data-ttu-id="13a52-179">Klicka på **autoHAVNET** i listan över resurser.</span><span class="sxs-lookup"><span data-stu-id="13a52-179">Click **autoHAVNET** on the list of resources.</span></span> <span data-ttu-id="13a52-180">Azure öppnas bladet nätverket konfiguration.</span><span class="sxs-lookup"><span data-stu-id="13a52-180">Azure opens the network configuration blade.</span></span>
3. <span data-ttu-id="13a52-181">På den **autoHAVNET** virtuellt nätverksblad under **inställningar** , klickar du på **undernät**.</span><span class="sxs-lookup"><span data-stu-id="13a52-181">On the **autoHAVNET** virtual network blade, under **Settings** , click **Subnets**.</span></span>

    <span data-ttu-id="13a52-182">Observera att det undernät som du redan skapat.</span><span class="sxs-lookup"><span data-stu-id="13a52-182">Note the subnet that you already created.</span></span>

   ![Konfigurera det virtuella nätverket](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/07-addsubnet.png)
5. <span data-ttu-id="13a52-184">Skapa en andra undernät.</span><span class="sxs-lookup"><span data-stu-id="13a52-184">Create a second subnet.</span></span> <span data-ttu-id="13a52-185">Klicka på **+ undernät**.</span><span class="sxs-lookup"><span data-stu-id="13a52-185">Click **+ Subnet**.</span></span>
6. <span data-ttu-id="13a52-186">På den **Lägg till undernät** bladet konfigurera undernätet genom att skriva **sqlsubnet** under **namn**.</span><span class="sxs-lookup"><span data-stu-id="13a52-186">On the **Add subnet** blade, configure the subnet by typing **sqlsubnet** under **Name**.</span></span> <span data-ttu-id="13a52-187">Azure automatiskt anger en giltig **adressintervall**.</span><span class="sxs-lookup"><span data-stu-id="13a52-187">Azure automatically specifies a valid **Address range**.</span></span> <span data-ttu-id="13a52-188">Kontrollera att detta adressintervall har minst 10 adresser i den.</span><span class="sxs-lookup"><span data-stu-id="13a52-188">Verify that this address range has at least 10 addresses in it.</span></span> <span data-ttu-id="13a52-189">Du kan behöva flera adresser i en produktionsmiljö.</span><span class="sxs-lookup"><span data-stu-id="13a52-189">In a production environment, you might require more addresses.</span></span>
7. <span data-ttu-id="13a52-190">Klicka på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-190">Click **OK**.</span></span>

    ![Konfigurera det virtuella nätverket](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/08-configuresubnet.png)

<span data-ttu-id="13a52-192">I följande tabell sammanfattas inställningarna för nätverk:</span><span class="sxs-lookup"><span data-stu-id="13a52-192">The following table summarizes the network configuration settings:</span></span>

| <span data-ttu-id="13a52-193">**Fält**</span><span class="sxs-lookup"><span data-stu-id="13a52-193">**Field**</span></span> | <span data-ttu-id="13a52-194">Värde</span><span class="sxs-lookup"><span data-stu-id="13a52-194">Value</span></span> |
| --- | --- |
| <span data-ttu-id="13a52-195">**Namn**</span><span class="sxs-lookup"><span data-stu-id="13a52-195">**Name**</span></span> |<span data-ttu-id="13a52-196">**autoHAVNET**</span><span class="sxs-lookup"><span data-stu-id="13a52-196">**autoHAVNET**</span></span> |
| <span data-ttu-id="13a52-197">**Adressutrymme**</span><span class="sxs-lookup"><span data-stu-id="13a52-197">**Address space**</span></span> |<span data-ttu-id="13a52-198">Detta värde beror på tillgängliga adressutrymmen i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="13a52-198">This value depends on the available address spaces in your subscription.</span></span> <span data-ttu-id="13a52-199">Ett vanligt värde är 10.0.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="13a52-199">A typical value is 10.0.0.0/16.</span></span> |
| <span data-ttu-id="13a52-200">**Namn på undernät**</span><span class="sxs-lookup"><span data-stu-id="13a52-200">**Subnet name**</span></span> |<span data-ttu-id="13a52-201">**Admin**</span><span class="sxs-lookup"><span data-stu-id="13a52-201">**admin**</span></span> |
| <span data-ttu-id="13a52-202">**Adressintervall för undernätet**</span><span class="sxs-lookup"><span data-stu-id="13a52-202">**Subnet address range**</span></span> |<span data-ttu-id="13a52-203">Detta värde beror på tillgängliga adressintervallen i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="13a52-203">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="13a52-204">Ett vanligt värde är 10.0.0.0/24.</span><span class="sxs-lookup"><span data-stu-id="13a52-204">A typical value is 10.0.0.0/24.</span></span> |
| <span data-ttu-id="13a52-205">**Namn på undernät**</span><span class="sxs-lookup"><span data-stu-id="13a52-205">**Subnet name**</span></span> |<span data-ttu-id="13a52-206">**sqlsubnet**</span><span class="sxs-lookup"><span data-stu-id="13a52-206">**sqlsubnet**</span></span> |
| <span data-ttu-id="13a52-207">**Adressintervall för undernätet**</span><span class="sxs-lookup"><span data-stu-id="13a52-207">**Subnet address range**</span></span> |<span data-ttu-id="13a52-208">Detta värde beror på tillgängliga adressintervallen i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="13a52-208">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="13a52-209">Ett vanligt värde är 10.0.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="13a52-209">A typical value is 10.0.1.0/24.</span></span> |
| <span data-ttu-id="13a52-210">**Prenumeration**</span><span class="sxs-lookup"><span data-stu-id="13a52-210">**Subscription**</span></span> |<span data-ttu-id="13a52-211">Ange den prenumeration som du tänker använda.</span><span class="sxs-lookup"><span data-stu-id="13a52-211">Specify the subscription that you intend to use.</span></span> |
| <span data-ttu-id="13a52-212">**Resursgrupp**</span><span class="sxs-lookup"><span data-stu-id="13a52-212">**Resource Group**</span></span> |<span data-ttu-id="13a52-213">**SQL-HÖG TILLGÄNGLIGHET-RG**</span><span class="sxs-lookup"><span data-stu-id="13a52-213">**SQL-HA-RG**</span></span> |
| <span data-ttu-id="13a52-214">**Plats**</span><span class="sxs-lookup"><span data-stu-id="13a52-214">**Location**</span></span> |<span data-ttu-id="13a52-215">Ange samma plats som du valde för resursgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-215">Specify the same location that you chose for the resource group.</span></span> |

## <a name="create-availability-sets"></a><span data-ttu-id="13a52-216">Skapa tillgänglighetsuppsättningar</span><span class="sxs-lookup"><span data-stu-id="13a52-216">Create availability sets</span></span>

<span data-ttu-id="13a52-217">Innan du skapar virtuella datorer måste du skapa tillgänglighetsuppsättningar.</span><span class="sxs-lookup"><span data-stu-id="13a52-217">Before you create virtual machines, you need to create availability sets.</span></span> <span data-ttu-id="13a52-218">Tillgänglighetsuppsättningar minska avbrottstiden för planerat eller oplanerat underhållshändelser.</span><span class="sxs-lookup"><span data-stu-id="13a52-218">Availability sets reduce the downtime for planned or unplanned maintenance events.</span></span> <span data-ttu-id="13a52-219">En Azure tillgänglighetsuppsättning är en logisk grupp med resurser som Azure placerar fysiska feldomäner och update-domäner.</span><span class="sxs-lookup"><span data-stu-id="13a52-219">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span></span> <span data-ttu-id="13a52-220">En feldomän säkerställer att medlemmarna i tillgänglighetsuppsättningen separat power och nätverksresurser.</span><span class="sxs-lookup"><span data-stu-id="13a52-220">A fault domain ensures that the members of the availability set have separate power and network resources.</span></span> <span data-ttu-id="13a52-221">En uppdateringsdomän säkerställer att medlemmar i tillgänglighetsuppsättningen inte återspeglas för underhåll på samma gång.</span><span class="sxs-lookup"><span data-stu-id="13a52-221">An update domain ensures that members of the availability set aren't brought down for maintenance at the same time.</span></span> <span data-ttu-id="13a52-222">Mer information finns i [hantera tillgängligheten för virtuella datorer](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="13a52-222">For more information, see [Manage the availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="13a52-223">Du behöver två tillgänglighetsuppsättningar.</span><span class="sxs-lookup"><span data-stu-id="13a52-223">You need two availability sets.</span></span> <span data-ttu-id="13a52-224">En är för domänkontrollanter.</span><span class="sxs-lookup"><span data-stu-id="13a52-224">One is for the domain controllers.</span></span> <span data-ttu-id="13a52-225">Andra är för SQL Server-datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-225">The second is for the SQL Server VMs.</span></span>

<span data-ttu-id="13a52-226">Om du vill skapa en tillgänglighetsuppsättning, gå till resursgruppen och klicka **Lägg till**.</span><span class="sxs-lookup"><span data-stu-id="13a52-226">To create an availability set, go to the resource group and click **Add**.</span></span> <span data-ttu-id="13a52-227">Filtrera resultaten genom att skriva **tillgänglighetsuppsättning**.</span><span class="sxs-lookup"><span data-stu-id="13a52-227">Filter the results by typing **availability set**.</span></span> <span data-ttu-id="13a52-228">Klicka på **Tillgänglighetsuppsättning** i resultaten och klickar sedan på **skapa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-228">Click **Availability Set** in the results, and then click **Create**.</span></span>

<span data-ttu-id="13a52-229">Konfigurera två tillgänglighetsuppsättningar enligt parametrarna i följande tabell:</span><span class="sxs-lookup"><span data-stu-id="13a52-229">Configure two availability sets according to the parameters in the following table:</span></span>

| <span data-ttu-id="13a52-230">**Fält**</span><span class="sxs-lookup"><span data-stu-id="13a52-230">**Field**</span></span> | <span data-ttu-id="13a52-231">Domain controller tillgänglighetsuppsättning</span><span class="sxs-lookup"><span data-stu-id="13a52-231">Domain controller availability set</span></span> | <span data-ttu-id="13a52-232">Tillgänglighetsuppsättningen för SQL Server</span><span class="sxs-lookup"><span data-stu-id="13a52-232">SQL Server availability set</span></span> |
| --- | --- | --- |
| <span data-ttu-id="13a52-233">**Namn**</span><span class="sxs-lookup"><span data-stu-id="13a52-233">**Name**</span></span> |<span data-ttu-id="13a52-234">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="13a52-234">adavailabilityset</span></span> |<span data-ttu-id="13a52-235">sqlavailabilityset</span><span class="sxs-lookup"><span data-stu-id="13a52-235">sqlavailabilityset</span></span> |
| <span data-ttu-id="13a52-236">**Resursgrupp**</span><span class="sxs-lookup"><span data-stu-id="13a52-236">**Resource group**</span></span> |<span data-ttu-id="13a52-237">SQL-HÖG TILLGÄNGLIGHET-RG</span><span class="sxs-lookup"><span data-stu-id="13a52-237">SQL-HA-RG</span></span> |<span data-ttu-id="13a52-238">SQL-HÖG TILLGÄNGLIGHET-RG</span><span class="sxs-lookup"><span data-stu-id="13a52-238">SQL-HA-RG</span></span> |
| <span data-ttu-id="13a52-239">**Feldomäner**</span><span class="sxs-lookup"><span data-stu-id="13a52-239">**Fault domains**</span></span> |<span data-ttu-id="13a52-240">3</span><span class="sxs-lookup"><span data-stu-id="13a52-240">3</span></span> |<span data-ttu-id="13a52-241">3</span><span class="sxs-lookup"><span data-stu-id="13a52-241">3</span></span> |
| <span data-ttu-id="13a52-242">**Uppdatera domäner**</span><span class="sxs-lookup"><span data-stu-id="13a52-242">**Update domains**</span></span> |<span data-ttu-id="13a52-243">5</span><span class="sxs-lookup"><span data-stu-id="13a52-243">5</span></span> |<span data-ttu-id="13a52-244">3</span><span class="sxs-lookup"><span data-stu-id="13a52-244">3</span></span> |

<span data-ttu-id="13a52-245">När du har skapat tillgänglighetsuppsättningarna tillbaka till resursgruppen i Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-245">After you create the availability sets, return to the resource group in the Azure portal.</span></span>

## <a name="create-domain-controllers"></a><span data-ttu-id="13a52-246">Skapa domänkontrollanter</span><span class="sxs-lookup"><span data-stu-id="13a52-246">Create domain controllers</span></span>
<span data-ttu-id="13a52-247">När du har skapat nätverket, undernät, tillgänglighetsuppsättningar och en Internetriktade belastningsutjämnare, är du redo att skapa de virtuella datorerna för domänkontrollanter.</span><span class="sxs-lookup"><span data-stu-id="13a52-247">After you've created the network, subnets, availability sets, and an Internet-facing load balancer, you're ready to create the virtual machines for the domain controllers.</span></span>

### <a name="create-virtual-machines-for-the-domain-controllers"></a><span data-ttu-id="13a52-248">Skapa virtuella datorer för domänkontrollanter</span><span class="sxs-lookup"><span data-stu-id="13a52-248">Create virtual machines for the domain controllers</span></span>
<span data-ttu-id="13a52-249">Om du vill skapa och konfigurera domänkontrollanterna kan återgå till den **SQL-hög tillgänglighet-RG** resursgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-249">To create and configure the domain controllers, return to the **SQL-HA-RG** resource group.</span></span>

1. <span data-ttu-id="13a52-250">Klicka på **Lägg till**.</span><span class="sxs-lookup"><span data-stu-id="13a52-250">Click **Add**.</span></span> <span data-ttu-id="13a52-251">Den **allt** blad öppnas.</span><span class="sxs-lookup"><span data-stu-id="13a52-251">The **Everything** blade opens.</span></span>
2. <span data-ttu-id="13a52-252">Typen **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="13a52-252">Type **Windows Server 2016 Datacenter**.</span></span>
3. <span data-ttu-id="13a52-253">Klicka på **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="13a52-253">Click **Windows Server 2016 Datacenter**.</span></span> <span data-ttu-id="13a52-254">I den **Windows Server 2016 Datacenter** bladet, kontrollera att distributionsmodellen är **Resource Manager**, och klicka sedan på **skapa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-254">In the **Windows Server 2016 Datacenter** blade, verify that the deployment model is **Resource Manager**, and then click **Create**.</span></span> <span data-ttu-id="13a52-255">Azure öppnas den **Skapa virtuell dator** bladet.</span><span class="sxs-lookup"><span data-stu-id="13a52-255">Azure opens the **Create virtual machine** blade.</span></span>

<span data-ttu-id="13a52-256">Upprepa föregående steg för att skapa två virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-256">Repeat the preceding steps to create two virtual machines.</span></span> <span data-ttu-id="13a52-257">Namn på två virtuella datorer:</span><span class="sxs-lookup"><span data-stu-id="13a52-257">Name the two virtual machines:</span></span>

* <span data-ttu-id="13a52-258">AD-primära-dc</span><span class="sxs-lookup"><span data-stu-id="13a52-258">ad-primary-dc</span></span>
* <span data-ttu-id="13a52-259">AD-sekundär-dc</span><span class="sxs-lookup"><span data-stu-id="13a52-259">ad-secondary-dc</span></span>

  > [!NOTE]
  > <span data-ttu-id="13a52-260">Den **ad-sekundär-dc** virtuella datorn är valfritt att tillhandahålla hög tillgänglighet för Active Directory Domain Services.</span><span class="sxs-lookup"><span data-stu-id="13a52-260">The **ad-secondary-dc** virtual machine is optional, to provide high availability for Active Directory Domain Services.</span></span>
  >
  >

<span data-ttu-id="13a52-261">I följande tabell visas inställningarna för dessa två datorer:</span><span class="sxs-lookup"><span data-stu-id="13a52-261">The following table shows the settings for these two machines:</span></span>

| <span data-ttu-id="13a52-262">**Fält**</span><span class="sxs-lookup"><span data-stu-id="13a52-262">**Field**</span></span> | <span data-ttu-id="13a52-263">Värde</span><span class="sxs-lookup"><span data-stu-id="13a52-263">Value</span></span> |
| --- | --- |
| <span data-ttu-id="13a52-264">**Namn**</span><span class="sxs-lookup"><span data-stu-id="13a52-264">**Name**</span></span> |<span data-ttu-id="13a52-265">Första domänkontrollant: *ad primär domänkontrollant*.</span><span class="sxs-lookup"><span data-stu-id="13a52-265">First domain controller: *ad-primary-dc*.</span></span></br><span data-ttu-id="13a52-266">Andra domänkontrollanten *ad-sekundär-dc*.</span><span class="sxs-lookup"><span data-stu-id="13a52-266">Second domain controller *ad-secondary-dc*.</span></span> |
| <span data-ttu-id="13a52-267">**Typ av virtuell datordisk**</span><span class="sxs-lookup"><span data-stu-id="13a52-267">**VM disk type**</span></span> |<span data-ttu-id="13a52-268">SSD</span><span class="sxs-lookup"><span data-stu-id="13a52-268">SSD</span></span> |
| <span data-ttu-id="13a52-269">**Användarnamn**</span><span class="sxs-lookup"><span data-stu-id="13a52-269">**User name**</span></span> |<span data-ttu-id="13a52-270">DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="13a52-270">DomainAdmin</span></span> |
| <span data-ttu-id="13a52-271">**Lösenord**</span><span class="sxs-lookup"><span data-stu-id="13a52-271">**Password**</span></span> |<span data-ttu-id="13a52-272">Contoso! 0000</span><span class="sxs-lookup"><span data-stu-id="13a52-272">Contoso!0000</span></span> |
| <span data-ttu-id="13a52-273">**Prenumeration**</span><span class="sxs-lookup"><span data-stu-id="13a52-273">**Subscription**</span></span> |<span data-ttu-id="13a52-274">*Din prenumeration*</span><span class="sxs-lookup"><span data-stu-id="13a52-274">*Your subscription*</span></span> |
| <span data-ttu-id="13a52-275">**Resursgrupp**</span><span class="sxs-lookup"><span data-stu-id="13a52-275">**Resource group**</span></span> |<span data-ttu-id="13a52-276">SQL-HÖG TILLGÄNGLIGHET-RG</span><span class="sxs-lookup"><span data-stu-id="13a52-276">SQL-HA-RG</span></span> |
| <span data-ttu-id="13a52-277">**Plats**</span><span class="sxs-lookup"><span data-stu-id="13a52-277">**Location**</span></span> |<span data-ttu-id="13a52-278">*Din plats*</span><span class="sxs-lookup"><span data-stu-id="13a52-278">*Your location*</span></span> |
| <span data-ttu-id="13a52-279">**Storlek**</span><span class="sxs-lookup"><span data-stu-id="13a52-279">**Size**</span></span> |<span data-ttu-id="13a52-280">DS1_V2</span><span class="sxs-lookup"><span data-stu-id="13a52-280">DS1_V2</span></span> |
| <span data-ttu-id="13a52-281">**Storage**</span><span class="sxs-lookup"><span data-stu-id="13a52-281">**Storage**</span></span> | <span data-ttu-id="13a52-282">**Använda hanterade diskar** - **Ja**</span><span class="sxs-lookup"><span data-stu-id="13a52-282">**Use managed disks** - **Yes**</span></span> |
| <span data-ttu-id="13a52-283">**Virtuellt nätverk**</span><span class="sxs-lookup"><span data-stu-id="13a52-283">**Virtual network**</span></span> |<span data-ttu-id="13a52-284">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="13a52-284">autoHAVNET</span></span> |
| <span data-ttu-id="13a52-285">**Undernät**</span><span class="sxs-lookup"><span data-stu-id="13a52-285">**Subnet**</span></span> |<span data-ttu-id="13a52-286">Admin</span><span class="sxs-lookup"><span data-stu-id="13a52-286">admin</span></span> |
| <span data-ttu-id="13a52-287">**Offentlig IP-adress**</span><span class="sxs-lookup"><span data-stu-id="13a52-287">**Public IP address**</span></span> |<span data-ttu-id="13a52-288">*Samma namn som den virtuella datorn*</span><span class="sxs-lookup"><span data-stu-id="13a52-288">*Same name as the VM*</span></span> |
| <span data-ttu-id="13a52-289">**Nätverkssäkerhetsgrupp**</span><span class="sxs-lookup"><span data-stu-id="13a52-289">**Network security group**</span></span> |<span data-ttu-id="13a52-290">*Samma namn som den virtuella datorn*</span><span class="sxs-lookup"><span data-stu-id="13a52-290">*Same name as the VM*</span></span> |
| <span data-ttu-id="13a52-291">**Tillgänglighetsuppsättning**</span><span class="sxs-lookup"><span data-stu-id="13a52-291">**Availability set**</span></span> |<span data-ttu-id="13a52-292">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="13a52-292">adavailabilityset</span></span> </br><span data-ttu-id="13a52-293">**Fault domäner**: 2</span><span class="sxs-lookup"><span data-stu-id="13a52-293">**Fault domains**:2</span></span></br><span data-ttu-id="13a52-294">**Uppdatera domäner**: 2</span><span class="sxs-lookup"><span data-stu-id="13a52-294">**Update domains**:2</span></span>|
| <span data-ttu-id="13a52-295">**Diagnostik**</span><span class="sxs-lookup"><span data-stu-id="13a52-295">**Diagnostics**</span></span> |<span data-ttu-id="13a52-296">Enabled</span><span class="sxs-lookup"><span data-stu-id="13a52-296">Enabled</span></span> |
| <span data-ttu-id="13a52-297">**Diagnostiklagringskonto**</span><span class="sxs-lookup"><span data-stu-id="13a52-297">**Diagnostics storage account**</span></span> |<span data-ttu-id="13a52-298">*Skapas automatiskt*</span><span class="sxs-lookup"><span data-stu-id="13a52-298">*Automatically created*</span></span> |

   >[!IMPORTANT]
   ><span data-ttu-id="13a52-299">Du kan bara placera en virtuell dator i en tillgänglighetsuppsättning när du skapar den.</span><span class="sxs-lookup"><span data-stu-id="13a52-299">You can only place a VM in an availability set when you create it.</span></span> <span data-ttu-id="13a52-300">Du kan inte ändra tillgänglighetsuppsättning när en virtuell dator skapas.</span><span class="sxs-lookup"><span data-stu-id="13a52-300">You can't change the availability set after a VM is created.</span></span> <span data-ttu-id="13a52-301">Se [hantera tillgängligheten för virtuella datorer](../manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="13a52-301">See [Manage the availability of virtual machines](../manage-availability.md).</span></span>

<span data-ttu-id="13a52-302">Azure skapar de virtuella datorerna.</span><span class="sxs-lookup"><span data-stu-id="13a52-302">Azure creates the virtual machines.</span></span>

<span data-ttu-id="13a52-303">När de virtuella datorerna har skapats kan konfigurera en domänkontrollant.</span><span class="sxs-lookup"><span data-stu-id="13a52-303">After the virtual machines are created, configure the domain controller.</span></span>

### <a name="configure-the-domain-controller"></a><span data-ttu-id="13a52-304">Konfigurera en domänkontrollant</span><span class="sxs-lookup"><span data-stu-id="13a52-304">Configure the domain controller</span></span>
<span data-ttu-id="13a52-305">I följande steg ska du konfigurera den **ad primär domänkontrollant** maskin som en domänkontrollant för corp.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="13a52-305">In the following steps, configure the **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="13a52-306">I portalen, öppna den **SQL-hög tillgänglighet-RG** resurs gruppen och välj den **ad primär domänkontrollant** datorn.</span><span class="sxs-lookup"><span data-stu-id="13a52-306">In the portal, open the **SQL-HA-RG** resource group and select the **ad-primary-dc** machine.</span></span> <span data-ttu-id="13a52-307">På den **ad primär domänkontrollant** bladet, klickar du på **Anslut** att öppna en RDP-fil för fjärråtkomst till skrivbordet.</span><span class="sxs-lookup"><span data-stu-id="13a52-307">On the **ad-primary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>

    ![Ansluta till en virtuell dator](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/20-connectrdp.png)
2. <span data-ttu-id="13a52-309">Logga in med ditt konfigurerade administratörskonto (**\DomainAdmin**) och lösenord (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="13a52-309">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="13a52-310">Som standard den **Serverhanteraren** instrumentpanelen ska visas.</span><span class="sxs-lookup"><span data-stu-id="13a52-310">By default, the **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="13a52-311">Klicka på den **Lägg till roller och funktioner** länk på instrumentpanelen.</span><span class="sxs-lookup"><span data-stu-id="13a52-311">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Lägg till roller](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
5. <span data-ttu-id="13a52-313">Välj **nästa** tills du kommer till den **serverroller** avsnitt.</span><span class="sxs-lookup"><span data-stu-id="13a52-313">Select **Next** until you get to the **Server Roles** section.</span></span>
6. <span data-ttu-id="13a52-314">Välj den **Active Directory Domain Services** och **DNS-Server** roller.</span><span class="sxs-lookup"><span data-stu-id="13a52-314">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="13a52-315">När du uppmanas att lägga till eventuella ytterligare funktioner som krävs av rollerna.</span><span class="sxs-lookup"><span data-stu-id="13a52-315">When you're prompted, add any additional features that are required by these roles.</span></span>

   > [!NOTE]
   > <span data-ttu-id="13a52-316">Windows varnar dig om att det finns ingen statisk IP-adress.</span><span class="sxs-lookup"><span data-stu-id="13a52-316">Windows warns you that there is no static IP address.</span></span> <span data-ttu-id="13a52-317">Om du testar konfigurationen klickar du på **Fortsätt**.</span><span class="sxs-lookup"><span data-stu-id="13a52-317">If you're testing the configuration, click **Continue**.</span></span> <span data-ttu-id="13a52-318">Ange IP-adress till statisk i Azure-portalen för produktion scenarier eller [använda PowerShell för att ange statiska IP-adressen för den domain controller datorn](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="13a52-318">For production scenarios, set the IP address to static in the Azure portal, or [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   >
   >

    ![Lägg till roller dialogrutan](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/23-addroles.png)
7. <span data-ttu-id="13a52-320">Klicka på **nästa** tills du når den **bekräftelse** avsnitt.</span><span class="sxs-lookup"><span data-stu-id="13a52-320">Click **Next** until you reach the **Confirmation** section.</span></span> <span data-ttu-id="13a52-321">Välj den **starta om målservern automatiskt om det behövs** kryssrutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-321">Select the **Restart the destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="13a52-322">Klicka på **Installera**.</span><span class="sxs-lookup"><span data-stu-id="13a52-322">Click **Install**.</span></span>
9. <span data-ttu-id="13a52-323">När funktionerna är klar installerar du tillbaka till den **Serverhanteraren** instrumentpanelen.</span><span class="sxs-lookup"><span data-stu-id="13a52-323">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="13a52-324">Välj den nya **AD DS** alternativet i den vänstra rutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-324">Select the new **AD DS** option on the left-hand pane.</span></span>
11. <span data-ttu-id="13a52-325">Klicka på den **mer** länk på den gula varning-fältet.</span><span class="sxs-lookup"><span data-stu-id="13a52-325">Click the **More** link on the yellow warning bar.</span></span>

    ![Dialogrutan för AD DS på den virtuella datorn DNS-Server](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/24-addsmore.png)
12. <span data-ttu-id="13a52-327">I den **åtgärd** kolumnen i den **alla Server aktivitetsinformation** dialogrutan klickar du på **befordra servern till en domänkontrollant**.</span><span class="sxs-lookup"><span data-stu-id="13a52-327">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
13. <span data-ttu-id="13a52-328">I den **konfigurationsguiden Active Directory Domain Services**, använder du följande värden:</span><span class="sxs-lookup"><span data-stu-id="13a52-328">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span></span>

    | <span data-ttu-id="13a52-329">**Sidan**</span><span class="sxs-lookup"><span data-stu-id="13a52-329">**Page**</span></span> | <span data-ttu-id="13a52-330">Inställning</span><span class="sxs-lookup"><span data-stu-id="13a52-330">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="13a52-331">**Distributionskonfiguration**</span><span class="sxs-lookup"><span data-stu-id="13a52-331">**Deployment Configuration**</span></span> |<span data-ttu-id="13a52-332">**Lägg till en ny skog**</span><span class="sxs-lookup"><span data-stu-id="13a52-332">**Add a new forest**</span></span><br/> <span data-ttu-id="13a52-333">**Rotdomännamn** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="13a52-333">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="13a52-334">**Alternativ för domänkontrollant**</span><span class="sxs-lookup"><span data-stu-id="13a52-334">**Domain Controller Options**</span></span> |<span data-ttu-id="13a52-335">**DSRM-lösenordet** = Contoso! 0000</span><span class="sxs-lookup"><span data-stu-id="13a52-335">**DSRM Password** = Contoso!0000</span></span><br/><span data-ttu-id="13a52-336">**Bekräfta lösenord** = Contoso! 0000</span><span class="sxs-lookup"><span data-stu-id="13a52-336">**Confirm Password** = Contoso!0000</span></span> |
14. <span data-ttu-id="13a52-337">Klicka på **nästa** gå igenom andra sidor i guiden.</span><span class="sxs-lookup"><span data-stu-id="13a52-337">Click **Next** to go through the other pages in the wizard.</span></span> <span data-ttu-id="13a52-338">På den **Kravkontroll** kontrollerar du att du ser följande meddelande: **alla kravkontroller har lyckats**.</span><span class="sxs-lookup"><span data-stu-id="13a52-338">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="13a52-339">Du kan granska alla meddelanden, men det är möjligt att fortsätta med installationen.</span><span class="sxs-lookup"><span data-stu-id="13a52-339">You can review any applicable warning messages, but it's possible to continue with the installation.</span></span>
15. <span data-ttu-id="13a52-340">Klicka på **Installera**.</span><span class="sxs-lookup"><span data-stu-id="13a52-340">Click **Install**.</span></span> <span data-ttu-id="13a52-341">Den **ad primär domänkontrollant** virtuella datorn startar om automatiskt.</span><span class="sxs-lookup"><span data-stu-id="13a52-341">The **ad-primary-dc** virtual machine automatically reboots.</span></span>

### <a name="note-the-ip-address-of-the-primary-domain-controller"></a><span data-ttu-id="13a52-342">Observera IP-adressen för den primära domänkontrollanten</span><span class="sxs-lookup"><span data-stu-id="13a52-342">Note the IP address of the primary domain controller</span></span>

<span data-ttu-id="13a52-343">Använd den primära domänkontrollanten för DNS.</span><span class="sxs-lookup"><span data-stu-id="13a52-343">Use the primary domain controller for DNS.</span></span> <span data-ttu-id="13a52-344">Observera controller IP-adressen för primär domän.</span><span class="sxs-lookup"><span data-stu-id="13a52-344">Note the primary domain controller IP address.</span></span>

<span data-ttu-id="13a52-345">Ett sätt att hämta domänkontrollant IP-adressen för primär domän är via Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-345">One way to get the primary domain controller IP address is through the Azure portal.</span></span>

1. <span data-ttu-id="13a52-346">Öppna resursgruppen på Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-346">On the Azure portal, open the resource group.</span></span>

2. <span data-ttu-id="13a52-347">Klicka på den primära domänkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="13a52-347">Click the primary domain controller.</span></span>

3. <span data-ttu-id="13a52-348">Klicka på bladet primär domän controller **nätverksgränssnitt**.</span><span class="sxs-lookup"><span data-stu-id="13a52-348">On the primary domain controller blade, click **Network interfaces**.</span></span>

![Nätverksgränssnitt](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/25-primarydcip.png)

<span data-ttu-id="13a52-350">Observera den privata IP-adressen för den här servern.</span><span class="sxs-lookup"><span data-stu-id="13a52-350">Note the private IP address for this server.</span></span>

### <a name="configure-the-virtual-network-dns"></a><span data-ttu-id="13a52-351">Konfigurera det virtuella nätverket DNS</span><span class="sxs-lookup"><span data-stu-id="13a52-351">Configure the virtual network DNS</span></span>
<span data-ttu-id="13a52-352">När du skapar den första domänkontrollanten och aktivera DNS på den första servern, konfigurera det virtuella nätverket för att använda den här servern för DNS.</span><span class="sxs-lookup"><span data-stu-id="13a52-352">After you create the first domain controller and enable DNS on the first server, configure the virtual network to use this server for DNS.</span></span>

1. <span data-ttu-id="13a52-353">Klicka på det virtuella nätverket i Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="13a52-353">In the Azure portal, click on the virtual network.</span></span>

2. <span data-ttu-id="13a52-354">Under **inställningar**, klickar du på **DNS-Server**.</span><span class="sxs-lookup"><span data-stu-id="13a52-354">Under **Settings**, click **DNS Server**.</span></span>

3. <span data-ttu-id="13a52-355">Klicka på **anpassade**, och Skriv privata IP-adressen för den primära domänkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="13a52-355">Click **Custom**, and type the private IP address of the primary domain controller.</span></span>

4. <span data-ttu-id="13a52-356">Klicka på **Spara**.</span><span class="sxs-lookup"><span data-stu-id="13a52-356">Click **Save**.</span></span>

### <a name="configure-the-second-domain-controller"></a><span data-ttu-id="13a52-357">Konfigurera andra domänkontrollanter</span><span class="sxs-lookup"><span data-stu-id="13a52-357">Configure the second domain controller</span></span>
<span data-ttu-id="13a52-358">Du kan konfigurera andra domänkontrollanten när den primära domänkontrollanten startar om.</span><span class="sxs-lookup"><span data-stu-id="13a52-358">After the primary domain controller reboots, you can configure the second domain controller.</span></span> <span data-ttu-id="13a52-359">Det här valfria steget är för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="13a52-359">This optional step is for high availability.</span></span> <span data-ttu-id="13a52-360">Följ dessa steg för att konfigurera andra domänkontrollanten:</span><span class="sxs-lookup"><span data-stu-id="13a52-360">Follow these steps to configure the second domain controller:</span></span>

1. <span data-ttu-id="13a52-361">I portalen, öppna den **SQL-hög tillgänglighet-RG** resurs gruppen och välj den **ad-sekundär-dc** datorn.</span><span class="sxs-lookup"><span data-stu-id="13a52-361">In the portal, open the **SQL-HA-RG** resource group and select the **ad-secondary-dc** machine.</span></span> <span data-ttu-id="13a52-362">På den **ad-sekundär-dc** bladet, klickar du på **Anslut** att öppna en RDP-fil för fjärråtkomst till skrivbordet.</span><span class="sxs-lookup"><span data-stu-id="13a52-362">On the **ad-secondary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="13a52-363">Logga in på den virtuella datorn med hjälp av ditt konfigurerade administratörskonto (**BUILTIN\DomainAdmin**) och lösenord (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="13a52-363">Sign in to the VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="13a52-364">Ändra önskad DNS-serveradress till adressen för domänkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="13a52-364">Change the preferred DNS server address to the address of the domain controller.</span></span>
4. <span data-ttu-id="13a52-365">I **nätverks- och delningscenter**, klickar du på nätverksgränssnittet.</span><span class="sxs-lookup"><span data-stu-id="13a52-365">In **Network and Sharing Center**, click the network interface.</span></span>
   <span data-ttu-id="13a52-366">![Nätverksgränssnitt](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span><span class="sxs-lookup"><span data-stu-id="13a52-366">![Network interface](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span></span>

5. <span data-ttu-id="13a52-367">Klicka på **Egenskaper**.</span><span class="sxs-lookup"><span data-stu-id="13a52-367">Click **Properties**.</span></span>
6. <span data-ttu-id="13a52-368">Välj **Internet Protocol Version 4 (TCP/IPv4)** och på **egenskaper**.</span><span class="sxs-lookup"><span data-stu-id="13a52-368">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
7. <span data-ttu-id="13a52-369">Välj **Använd följande DNS-serveradresser** och ange adressen till den primära domänkontrollanten i **önskad DNS-server**.</span><span class="sxs-lookup"><span data-stu-id="13a52-369">Select **Use the following DNS server addresses** and specify the address of the primary domain controller in **Preferred DNS server**.</span></span>
8. <span data-ttu-id="13a52-370">Klicka på **OK**, och sedan **Stäng** att genomföra ändringarna.</span><span class="sxs-lookup"><span data-stu-id="13a52-370">Click **OK**, and then **Close** to commit the changes.</span></span> <span data-ttu-id="13a52-371">Du är nu kunna ansluta till den virtuella datorn till **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="13a52-371">You are now able to join the VM to **corp.contoso.com**.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="13a52-372">Om du förlorar anslutningen till din Fjärrskrivbord när du har ändrat inställningen för DNS-gå till Azure-portalen och starta om den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="13a52-372">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span></span>

9. <span data-ttu-id="13a52-373">Fjärrskrivbord till den sekundära domänkontrollanten öppna **instrumentpanelen Serverhanteraren**.</span><span class="sxs-lookup"><span data-stu-id="13a52-373">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span></span>
10. <span data-ttu-id="13a52-374">Klicka på den **Lägg till roller och funktioner** länk på instrumentpanelen.</span><span class="sxs-lookup"><span data-stu-id="13a52-374">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Lägg till roller](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
11. <span data-ttu-id="13a52-376">Välj **nästa** tills du kommer till den **serverroller** avsnitt.</span><span class="sxs-lookup"><span data-stu-id="13a52-376">Select **Next** until you get to the **Server Roles** section.</span></span>
12. <span data-ttu-id="13a52-377">Välj den **Active Directory Domain Services** och **DNS-Server** roller.</span><span class="sxs-lookup"><span data-stu-id="13a52-377">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="13a52-378">När du uppmanas att lägga till eventuella ytterligare funktioner som krävs av rollerna.</span><span class="sxs-lookup"><span data-stu-id="13a52-378">When you're prompted, add any additional features that are required by these roles.</span></span>
13. <span data-ttu-id="13a52-379">När funktionerna är klar installerar du tillbaka till den **Serverhanteraren** instrumentpanelen.</span><span class="sxs-lookup"><span data-stu-id="13a52-379">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
14. <span data-ttu-id="13a52-380">Välj den nya **AD DS** alternativet i den vänstra rutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-380">Select the new **AD DS** option on the left-hand pane.</span></span>
15. <span data-ttu-id="13a52-381">Klicka på den **mer** länk på den gula varning-fältet.</span><span class="sxs-lookup"><span data-stu-id="13a52-381">Click the **More** link on the yellow warning bar.</span></span>
16. <span data-ttu-id="13a52-382">I den **åtgärd** kolumnen i den **alla Server aktivitetsinformation** dialogrutan klickar du på **befordra servern till en domänkontrollant**.</span><span class="sxs-lookup"><span data-stu-id="13a52-382">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
17. <span data-ttu-id="13a52-383">Under **distributionskonfigurationen**väljer **lägger till en domänkontrollant i en befintlig domän**.</span><span class="sxs-lookup"><span data-stu-id="13a52-383">Under **Deployment Configuration**, select **Add a domain controller to an existing domain**.</span></span>
   <span data-ttu-id="13a52-384">![Distributionskonfiguration](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span><span class="sxs-lookup"><span data-stu-id="13a52-384">![Deployment configuration](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span></span>
18. <span data-ttu-id="13a52-385">Klicka på **Välj**.</span><span class="sxs-lookup"><span data-stu-id="13a52-385">Click **Select**.</span></span>
19. <span data-ttu-id="13a52-386">Ansluta med hjälp av administratörskontot (**CORP. Contoso.COM\domainadmin**) och lösenord (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="13a52-386">Connect by using the administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span></span>
20. <span data-ttu-id="13a52-387">I **Välj en domän från skogen**, klickar du på din domän och klicka sedan på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-387">In **Select a domain from the forest**, click your domain, and then click **OK**.</span></span>
21. <span data-ttu-id="13a52-388">I **alternativ för domänkontrollant**, Använd standardvärdena och ange DSRM-lösenordet.</span><span class="sxs-lookup"><span data-stu-id="13a52-388">In **Domain Controller Options**, use the default values and set a DSRM password.</span></span>

   >[!NOTE]
   ><span data-ttu-id="13a52-389">Den **DNS-alternativ** sida kan varna dig att det inte går att skapa en delegering för den här DNS-servern.</span><span class="sxs-lookup"><span data-stu-id="13a52-389">The **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span></span> <span data-ttu-id="13a52-390">Du kan ignorera den här varningen i icke-produktionsmiljöer.</span><span class="sxs-lookup"><span data-stu-id="13a52-390">You can ignore this warning in non-production environments.</span></span>
22. <span data-ttu-id="13a52-391">Klicka på **nästa** tills dialogrutan når den **krav** kontrollera.</span><span class="sxs-lookup"><span data-stu-id="13a52-391">Click **Next** until the dialog reaches the **Prerequisites** check.</span></span> <span data-ttu-id="13a52-392">Klicka på **Installera**.</span><span class="sxs-lookup"><span data-stu-id="13a52-392">Then click **Install**.</span></span>

<span data-ttu-id="13a52-393">Starta om servern när servern har slutförts ändringar i konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="13a52-393">After the server finishes the configuration changes, restart the server.</span></span>

### <a name="add-the-private-ip-address-to-the-second-domain-controller-to-the-vpn-dns-server"></a><span data-ttu-id="13a52-394">Lägga till privata IP-adressen till den andra domänkontrollanten till VPN-DNS-Server</span><span class="sxs-lookup"><span data-stu-id="13a52-394">Add the Private IP Address to the second domain controller to the VPN DNS Server</span></span>

<span data-ttu-id="13a52-395">Ändra DNS-servern med IP-adressen för den sekundära domänkontrollanten i Azure-portalen under virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="13a52-395">In the Azure portal, under virtual network, change the DNS Server to include the IP address of the secondary domain controller.</span></span> <span data-ttu-id="13a52-396">Detta gör att DNS-tjänsten redundans.</span><span class="sxs-lookup"><span data-stu-id="13a52-396">This allows the DNS service redundancy.</span></span>

### <span data-ttu-id="13a52-397"><a name=DomainAccounts></a>Konfigurera domänkontona</span><span class="sxs-lookup"><span data-stu-id="13a52-397"><a name=DomainAccounts></a> Configure the domain accounts</span></span>

<span data-ttu-id="13a52-398">I nästa steg ska konfigurera du Active Directory-konton.</span><span class="sxs-lookup"><span data-stu-id="13a52-398">In the next steps, you configure the Active Directory accounts.</span></span> <span data-ttu-id="13a52-399">I följande tabell visas kontona:</span><span class="sxs-lookup"><span data-stu-id="13a52-399">The following table shows the accounts:</span></span>

| |<span data-ttu-id="13a52-400">Kontot för installation</span><span class="sxs-lookup"><span data-stu-id="13a52-400">Installation account</span></span><br/> |<span data-ttu-id="13a52-401">SQLServer-0</span><span class="sxs-lookup"><span data-stu-id="13a52-401">sqlserver-0</span></span> <br/><span data-ttu-id="13a52-402">Konto för SQL Server och SQL Agent-tjänsten</span><span class="sxs-lookup"><span data-stu-id="13a52-402">SQL Server and SQL Agent Service account</span></span> |<span data-ttu-id="13a52-403">SQLServer-1</span><span class="sxs-lookup"><span data-stu-id="13a52-403">sqlserver-1</span></span><br/><span data-ttu-id="13a52-404">Konto för SQL Server och SQL Agent-tjänsten</span><span class="sxs-lookup"><span data-stu-id="13a52-404">SQL Server and SQL Agent Service account</span></span>
| --- | --- | --- | ---
|<span data-ttu-id="13a52-405">**Förnamn**</span><span class="sxs-lookup"><span data-stu-id="13a52-405">**First Name**</span></span> |<span data-ttu-id="13a52-406">Installera</span><span class="sxs-lookup"><span data-stu-id="13a52-406">Install</span></span> |<span data-ttu-id="13a52-407">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="13a52-407">SQLSvc1</span></span> | <span data-ttu-id="13a52-408">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="13a52-408">SQLSvc2</span></span>
|<span data-ttu-id="13a52-409">**Användare SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="13a52-409">**User SamAccountName**</span></span> |<span data-ttu-id="13a52-410">Installera</span><span class="sxs-lookup"><span data-stu-id="13a52-410">Install</span></span> |<span data-ttu-id="13a52-411">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="13a52-411">SQLSvc1</span></span> | <span data-ttu-id="13a52-412">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="13a52-412">SQLSvc2</span></span>

<span data-ttu-id="13a52-413">Använd följande steg för att skapa varje konto.</span><span class="sxs-lookup"><span data-stu-id="13a52-413">Use the following steps to create each account.</span></span>

1. <span data-ttu-id="13a52-414">Logga in på den **ad primär domänkontrollant** datorn.</span><span class="sxs-lookup"><span data-stu-id="13a52-414">Sign in to the **ad-primary-dc** machine.</span></span>
2. <span data-ttu-id="13a52-415">I **Serverhanteraren**väljer **verktyg**, och klicka sedan på **Active Directory Administrationscenter**.</span><span class="sxs-lookup"><span data-stu-id="13a52-415">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span></span>   
3. <span data-ttu-id="13a52-416">Välj **corp (lokal)** i den vänstra rutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-416">Select **corp (local)** from the left pane.</span></span>
4. <span data-ttu-id="13a52-417">Till höger **uppgifter** väljer **ny**, och klicka sedan på **användaren**.</span><span class="sxs-lookup"><span data-stu-id="13a52-417">On the right **Tasks** pane, select **New**, and then click **User**.</span></span>
   <span data-ttu-id="13a52-418">![Active Directory Administrationscenter](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span><span class="sxs-lookup"><span data-stu-id="13a52-418">![Active Directory Administrative Center](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span></span>

   >[!TIP]
   ><span data-ttu-id="13a52-419">Ange ett komplext lösenord för varje konto.</span><span class="sxs-lookup"><span data-stu-id="13a52-419">Set a complex password for each account.</span></span><br/> <span data-ttu-id="13a52-420">För icke-produktionsmiljöer, ange användarkontot som ska aldrig går ut.</span><span class="sxs-lookup"><span data-stu-id="13a52-420">For non-production environments, set the user account to never expire.</span></span>

5. <span data-ttu-id="13a52-421">Klicka på **OK** att skapa användaren.</span><span class="sxs-lookup"><span data-stu-id="13a52-421">Click **OK** to create the user.</span></span>
6. <span data-ttu-id="13a52-422">Upprepa föregående steg för var och en av tre konton.</span><span class="sxs-lookup"><span data-stu-id="13a52-422">Repeat the preceding steps for each of the three accounts.</span></span>

### <a name="grant-the-required-permissions-to-the-installation-account"></a><span data-ttu-id="13a52-423">Bevilja behörighet till kontot för installation av</span><span class="sxs-lookup"><span data-stu-id="13a52-423">Grant the required permissions to the installation account</span></span>
1. <span data-ttu-id="13a52-424">I den **Active Directory Administrationscenter**väljer **corp (lokal)** i den vänstra rutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-424">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span></span> <span data-ttu-id="13a52-425">I den högra **uppgifter** rutan klickar du på **egenskaper**.</span><span class="sxs-lookup"><span data-stu-id="13a52-425">Then in the right-hand **Tasks** pane, click **Properties**.</span></span>

    ![Egenskaper för CORP-användare](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/31-addcproperties.png)
2. <span data-ttu-id="13a52-427">Välj **tillägg**, och klicka sedan på den **Avancerat** knappen på den **säkerhet** fliken.</span><span class="sxs-lookup"><span data-stu-id="13a52-427">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span></span>
3. <span data-ttu-id="13a52-428">I den **avancerade säkerhetsinställningar för corp** dialogrutan klickar du på **Lägg till**.</span><span class="sxs-lookup"><span data-stu-id="13a52-428">In the **Advanced Security Settings for corp** dialog, click **Add**.</span></span>
4. <span data-ttu-id="13a52-429">Klicka på **Välj en huvudansvarig**, söka efter **CORP\Install**, och klicka sedan på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-429">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
5. <span data-ttu-id="13a52-430">Välj den **läsa alla egenskaper** kryssrutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-430">Select the **Read all properties** check box.</span></span>

6. <span data-ttu-id="13a52-431">Välj den **skapa datorobjekt** kryssrutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-431">Select the **Create Computer objects** check box.</span></span>

     ![Corp användarbehörighet](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/33-addpermissions.png)
7. <span data-ttu-id="13a52-433">Klicka på **OK**, och klicka sedan på **OK** igen.</span><span class="sxs-lookup"><span data-stu-id="13a52-433">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="13a52-434">Stäng den **corp** egenskapsfönstret.</span><span class="sxs-lookup"><span data-stu-id="13a52-434">Close the **corp** properties window.</span></span>

<span data-ttu-id="13a52-435">Nu när du har konfigurerat Active Directory och användarobjekt, skapa två virtuella SQL Server-datorer och en vittnesserver som VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-435">Now that you've finished configuring Active Directory and the user objects, create two SQL Server VMs and a witness server VM.</span></span> <span data-ttu-id="13a52-436">Ansluta alla tre till domänen.</span><span class="sxs-lookup"><span data-stu-id="13a52-436">Then join all three to the domain.</span></span>

## <a name="create-sql-server-vms"></a><span data-ttu-id="13a52-437">Skapa virtuella SQL Server-datorer</span><span class="sxs-lookup"><span data-stu-id="13a52-437">Create SQL Server VMs</span></span>

<span data-ttu-id="13a52-438">Skapa tre ytterligare virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-438">Create three additional virtual machines.</span></span> <span data-ttu-id="13a52-439">Lösningen kräver två virtuella datorer med SQL Server-instanser.</span><span class="sxs-lookup"><span data-stu-id="13a52-439">The solution requires two virtual machines with SQL Server instances.</span></span> <span data-ttu-id="13a52-440">En tredje virtuell dator fungerar som ett vittne.</span><span class="sxs-lookup"><span data-stu-id="13a52-440">A third virtual machine will function as a witness.</span></span> <span data-ttu-id="13a52-441">Windows Server 2016 kan använda en [molnet vittne](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), men adressöverensstämmelse tidigare operativsystem för det här dokumentet använder en virtuell dator för ett vittne.</span><span class="sxs-lookup"><span data-stu-id="13a52-441">Windows Server 2016 can use a [cloud witness](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), however for consistency with previous operating systems this document uses a virtual machine for a witness.</span></span>  

<span data-ttu-id="13a52-442">Överväg följande beslut deisign innan du fortsätter.</span><span class="sxs-lookup"><span data-stu-id="13a52-442">Before you proceed consider the following deisign decisions.</span></span>

* <span data-ttu-id="13a52-443">**Lagring – Azure hanterade diskar**</span><span class="sxs-lookup"><span data-stu-id="13a52-443">**Storage - Azure Managed Disks**</span></span>

   <span data-ttu-id="13a52-444">Använd Azure hanterade diskar för lagring för virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="13a52-444">For the virtual machine storage, use Azure Managed Disks.</span></span> <span data-ttu-id="13a52-445">Microsoft rekommenderar hanterade diskar för virtuella datorer för SQL Server.</span><span class="sxs-lookup"><span data-stu-id="13a52-445">Microsoft recommends Managed Disks for SQL Server virtual machines.</span></span> <span data-ttu-id="13a52-446">Managed Disks hanterar lagring i bakgrunden.</span><span class="sxs-lookup"><span data-stu-id="13a52-446">Managed Disks handles storage behind the scenes.</span></span> <span data-ttu-id="13a52-447">När virtuella datorer med Managed Disks finns i samma tillgänglighetsuppsättning, distribuerar Azure dessutom lagringsresurser för att tillhandahålla rätt redundans.</span><span class="sxs-lookup"><span data-stu-id="13a52-447">In addition, when virtual machines with Managed Disks are in the same availability set, Azure distributes the storage resources to provide appropriate redundancy.</span></span> <span data-ttu-id="13a52-448">Mer information finns i [Översikt över Azure Managed Disks](../managed-disks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="13a52-448">For additional information, see [Azure Managed Disks Overview](../managed-disks-overview.md).</span></span> <span data-ttu-id="13a52-449">Närmare information om hanterade diskar i en tillgänglighetsuppsättning, se [använda hanterade diskar för virtuella datorer i en tillgänglighetsuppsättning](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="13a52-449">For specifics about managed disks in an availability set, see [Use Managed Disks for VMs in an availability set](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span></span>

* <span data-ttu-id="13a52-450">**Nätverk - privata IP-adresser i produktion**</span><span class="sxs-lookup"><span data-stu-id="13a52-450">**Network - Private IP addresses in production**</span></span>

   <span data-ttu-id="13a52-451">Den här kursen använder offentliga IP-adresser för de virtuella datorerna.</span><span class="sxs-lookup"><span data-stu-id="13a52-451">For the virtual machines, this tutorial uses public IP addresses.</span></span> <span data-ttu-id="13a52-452">Detta gör att fjärranslutning direkt till den virtuella datorn via internet - det underlättar konfigurationssteg.</span><span class="sxs-lookup"><span data-stu-id="13a52-452">This enables remote connection directly to the virtual machine over the internet - it makes configuration steps easier.</span></span> <span data-ttu-id="13a52-453">Microsoft rekommenderar endast privata IP-adresser i produktionsmiljöer, för att minska sårbarhet av SQL Server-instansen Virtuella datorresursen.</span><span class="sxs-lookup"><span data-stu-id="13a52-453">In production environments, Microsoft recommends only private IP addresses in order to reduce the vulnerability footprint of the SQL Server instance VM resource.</span></span>

### <a name="create-and-configure-the-sql-server-vms"></a><span data-ttu-id="13a52-454">Skapa och konfigurera SQL Server-datorer</span><span class="sxs-lookup"><span data-stu-id="13a52-454">Create and configure the SQL Server VMs</span></span>
<span data-ttu-id="13a52-455">Skapa därefter tre virtuella datorer – två virtuella SQL Server-datorer och en virtuell dator för en ny klusternod.</span><span class="sxs-lookup"><span data-stu-id="13a52-455">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span></span> <span data-ttu-id="13a52-456">Om du vill skapa var och en av de virtuella datorerna, gå tillbaka till den **SQL-hög tillgänglighet-RG** resursgrupp, klickar du på **Lägg till**, Sök efter lämplig galleriobjektet, klicka på **virtuella**, och klicka sedan på **från galleriet**.</span><span class="sxs-lookup"><span data-stu-id="13a52-456">To create each of the VMs, go back to the **SQL-HA-RG** resource group, click **Add**, search for the appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span></span> <span data-ttu-id="13a52-457">Använd informationen i följande tabell för att skapa de virtuella datorerna:</span><span class="sxs-lookup"><span data-stu-id="13a52-457">Use the information in the following table to help you create the VMs:</span></span>


| <span data-ttu-id="13a52-458">Sidan</span><span class="sxs-lookup"><span data-stu-id="13a52-458">Page</span></span> | <span data-ttu-id="13a52-459">VM1</span><span class="sxs-lookup"><span data-stu-id="13a52-459">VM1</span></span> | <span data-ttu-id="13a52-460">VM2</span><span class="sxs-lookup"><span data-stu-id="13a52-460">VM2</span></span> | <span data-ttu-id="13a52-461">VM3</span><span class="sxs-lookup"><span data-stu-id="13a52-461">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="13a52-462">Välj lämplig galleriobjektet</span><span class="sxs-lookup"><span data-stu-id="13a52-462">Select the appropriate gallery item</span></span> |<span data-ttu-id="13a52-463">**Windows Server 2016 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="13a52-463">**Windows Server 2016 Datacenter**</span></span> |<span data-ttu-id="13a52-464">**SQL Server 2016 SP1 Enterprise på Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="13a52-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |<span data-ttu-id="13a52-465">**SQL Server 2016 SP1 Enterprise på Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="13a52-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |
| <span data-ttu-id="13a52-466">Konfiguration av virtuell dator **grunderna**</span><span class="sxs-lookup"><span data-stu-id="13a52-466">Virtual machine configuration **Basics**</span></span> |<span data-ttu-id="13a52-467">**Namnet** = klustret fsw</span><span class="sxs-lookup"><span data-stu-id="13a52-467">**Name** = cluster-fsw</span></span><br/><span data-ttu-id="13a52-468">**Användarnamnet** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="13a52-468">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="13a52-469">**Lösenordet** = Contoso! 0000</span><span class="sxs-lookup"><span data-stu-id="13a52-469">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="13a52-470">**Prenumerationen** = din prenumeration</span><span class="sxs-lookup"><span data-stu-id="13a52-470">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="13a52-471">**Resursgruppen** = SQL-hög tillgänglighet-RG</span><span class="sxs-lookup"><span data-stu-id="13a52-471">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="13a52-472">**Plats** = azure-plats</span><span class="sxs-lookup"><span data-stu-id="13a52-472">**Location** = Your azure location</span></span> |<span data-ttu-id="13a52-473">**Namnet** = sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="13a52-473">**Name** = sqlserver-0</span></span><br/><span data-ttu-id="13a52-474">**Användarnamnet** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="13a52-474">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="13a52-475">**Lösenordet** = Contoso! 0000</span><span class="sxs-lookup"><span data-stu-id="13a52-475">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="13a52-476">**Prenumerationen** = din prenumeration</span><span class="sxs-lookup"><span data-stu-id="13a52-476">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="13a52-477">**Resursgruppen** = SQL-hög tillgänglighet-RG</span><span class="sxs-lookup"><span data-stu-id="13a52-477">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="13a52-478">**Plats** = azure-plats</span><span class="sxs-lookup"><span data-stu-id="13a52-478">**Location** = Your azure location</span></span> |<span data-ttu-id="13a52-479">**Namnet** = sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="13a52-479">**Name** = sqlserver-1</span></span><br/><span data-ttu-id="13a52-480">**Användarnamnet** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="13a52-480">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="13a52-481">**Lösenordet** = Contoso! 0000</span><span class="sxs-lookup"><span data-stu-id="13a52-481">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="13a52-482">**Prenumerationen** = din prenumeration</span><span class="sxs-lookup"><span data-stu-id="13a52-482">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="13a52-483">**Resursgruppen** = SQL-hög tillgänglighet-RG</span><span class="sxs-lookup"><span data-stu-id="13a52-483">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="13a52-484">**Plats** = azure-plats</span><span class="sxs-lookup"><span data-stu-id="13a52-484">**Location** = Your azure location</span></span> |
| <span data-ttu-id="13a52-485">Konfiguration av virtuell dator **storlek**</span><span class="sxs-lookup"><span data-stu-id="13a52-485">Virtual machine configuration **Size**</span></span> |<span data-ttu-id="13a52-486">**STORLEK** = DS1\_V2 (1 kärna, 3.5 GB)</span><span class="sxs-lookup"><span data-stu-id="13a52-486">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span></span> |<span data-ttu-id="13a52-487">**STORLEK** = DS2\_V2 (2 kärnor, 7 GB)</span><span class="sxs-lookup"><span data-stu-id="13a52-487">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span></br><span data-ttu-id="13a52-488">Storleken måste ha stöd för SSD-lagring (stöd för Premium-diskar.</span><span class="sxs-lookup"><span data-stu-id="13a52-488">The size must support SSD storage (Premium disk support.</span></span> <span data-ttu-id="13a52-489">))</span><span class="sxs-lookup"><span data-stu-id="13a52-489">))</span></span> |<span data-ttu-id="13a52-490">**STORLEK** = DS2\_V2 (2 kärnor, 7 GB)</span><span class="sxs-lookup"><span data-stu-id="13a52-490">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |
| <span data-ttu-id="13a52-491">Konfiguration av virtuell dator **inställningar**</span><span class="sxs-lookup"><span data-stu-id="13a52-491">Virtual machine configuration **Settings**</span></span> |<span data-ttu-id="13a52-492">**Lagring**: Använd hanterade diskar.</span><span class="sxs-lookup"><span data-stu-id="13a52-492">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="13a52-493">**Virtuellt nätverk** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="13a52-493">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="13a52-494">**Undernät** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="13a52-494">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="13a52-495">**Offentliga IP-adressen** skapas automatiskt.</span><span class="sxs-lookup"><span data-stu-id="13a52-495">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="13a52-496">**Nätverkssäkerhetsgruppen** = None</span><span class="sxs-lookup"><span data-stu-id="13a52-496">**Network security group** = None</span></span><br/><span data-ttu-id="13a52-497">**Övervaka diagnostik** = aktiverat</span><span class="sxs-lookup"><span data-stu-id="13a52-497">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="13a52-498">**Diagnostiklagringskonto** = Använd en automatiskt genererad storage-konto</span><span class="sxs-lookup"><span data-stu-id="13a52-498">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="13a52-499">**Tillgänglighetsuppsättningen** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="13a52-499">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="13a52-500">**Lagring**: Använd hanterade diskar.</span><span class="sxs-lookup"><span data-stu-id="13a52-500">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="13a52-501">**Virtuellt nätverk** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="13a52-501">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="13a52-502">**Undernät** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="13a52-502">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="13a52-503">**Offentliga IP-adressen** skapas automatiskt.</span><span class="sxs-lookup"><span data-stu-id="13a52-503">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="13a52-504">**Nätverkssäkerhetsgruppen** = None</span><span class="sxs-lookup"><span data-stu-id="13a52-504">**Network security group** = None</span></span><br/><span data-ttu-id="13a52-505">**Övervaka diagnostik** = aktiverat</span><span class="sxs-lookup"><span data-stu-id="13a52-505">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="13a52-506">**Diagnostiklagringskonto** = Använd en automatiskt genererad storage-konto</span><span class="sxs-lookup"><span data-stu-id="13a52-506">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="13a52-507">**Tillgänglighetsuppsättningen** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="13a52-507">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="13a52-508">**Lagring**: Använd hanterade diskar.</span><span class="sxs-lookup"><span data-stu-id="13a52-508">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="13a52-509">**Virtuellt nätverk** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="13a52-509">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="13a52-510">**Undernät** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="13a52-510">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="13a52-511">**Offentliga IP-adressen** skapas automatiskt.</span><span class="sxs-lookup"><span data-stu-id="13a52-511">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="13a52-512">**Nätverkssäkerhetsgruppen** = None</span><span class="sxs-lookup"><span data-stu-id="13a52-512">**Network security group** = None</span></span><br/><span data-ttu-id="13a52-513">**Övervaka diagnostik** = aktiverat</span><span class="sxs-lookup"><span data-stu-id="13a52-513">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="13a52-514">**Diagnostiklagringskonto** = Använd en automatiskt genererad storage-konto</span><span class="sxs-lookup"><span data-stu-id="13a52-514">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="13a52-515">**Tillgänglighetsuppsättningen** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="13a52-515">**Availability set** = sqlAvailabilitySet</span></span><br/> |
| <span data-ttu-id="13a52-516">Konfiguration av virtuell dator **SQL Server-inställningar**</span><span class="sxs-lookup"><span data-stu-id="13a52-516">Virtual machine configuration **SQL Server settings**</span></span> |<span data-ttu-id="13a52-517">Inte tillämpligt</span><span class="sxs-lookup"><span data-stu-id="13a52-517">Not applicable</span></span> |<span data-ttu-id="13a52-518">**SQL-anslutningen** = privat (inom Virtual Network)</span><span class="sxs-lookup"><span data-stu-id="13a52-518">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="13a52-519">**Port** = 1433</span><span class="sxs-lookup"><span data-stu-id="13a52-519">**Port** = 1433</span></span><br/><span data-ttu-id="13a52-520">**SQL-autentisering** = inaktivera</span><span class="sxs-lookup"><span data-stu-id="13a52-520">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="13a52-521">**Lagringskonfigurationen** = Allmänt</span><span class="sxs-lookup"><span data-stu-id="13a52-521">**Storage configuration** = General</span></span><br/><span data-ttu-id="13a52-522">**Automatisk uppdatering** = söndag 2:00</span><span class="sxs-lookup"><span data-stu-id="13a52-522">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="13a52-523">**Automatisk säkerhetskopiering** = inaktiverad</span><span class="sxs-lookup"><span data-stu-id="13a52-523">**Automated backup** = Disabled</span></span></br><span data-ttu-id="13a52-524">**Azure Key Vault-integrering** = inaktiverad</span><span class="sxs-lookup"><span data-stu-id="13a52-524">**Azure Key Vault integration** = Disabled</span></span> |<span data-ttu-id="13a52-525">**SQL-anslutningen** = privat (inom Virtual Network)</span><span class="sxs-lookup"><span data-stu-id="13a52-525">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="13a52-526">**Port** = 1433</span><span class="sxs-lookup"><span data-stu-id="13a52-526">**Port** = 1433</span></span><br/><span data-ttu-id="13a52-527">**SQL-autentisering** = inaktivera</span><span class="sxs-lookup"><span data-stu-id="13a52-527">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="13a52-528">**Lagringskonfigurationen** = Allmänt</span><span class="sxs-lookup"><span data-stu-id="13a52-528">**Storage configuration** = General</span></span><br/><span data-ttu-id="13a52-529">**Automatisk uppdatering** = söndag 2:00</span><span class="sxs-lookup"><span data-stu-id="13a52-529">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="13a52-530">**Automatisk säkerhetskopiering** = inaktiverad</span><span class="sxs-lookup"><span data-stu-id="13a52-530">**Automated backup** = Disabled</span></span></br><span data-ttu-id="13a52-531">**Azure Key Vault-integrering** = inaktiverad</span><span class="sxs-lookup"><span data-stu-id="13a52-531">**Azure Key Vault integration** = Disabled</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="13a52-532">Datorstorlekar som föreslås här är avsedda för att testa Tillgänglighetsgrupper i virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-532">The machine sizes suggested here are meant for testing availability groups in Azure VMs.</span></span> <span data-ttu-id="13a52-533">För bästa prestanda på produktionsarbetsbelastningar finns rekommendationer för SQL Server-datorstorlekar och konfigurationen i [prestandarelaterade Metodtips för SQL Server på virtuella Azure-datorer](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="13a52-533">For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
>
>

<span data-ttu-id="13a52-534">När de tre virtuella datorerna är helt etablerad, måste du koppla dem till den **corp.contoso.com** domän och bevilja CORP\Install administratörsbehörighet till datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-534">After the three VMs are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span></span>

### <span data-ttu-id="13a52-535"><a name="joinDomain"></a>Anslut servrarna till domänen</span><span class="sxs-lookup"><span data-stu-id="13a52-535"><a name="joinDomain"></a>Join the servers to the domain</span></span>

<span data-ttu-id="13a52-536">Du är nu kunna ansluta till de virtuella datorerna till **corp.contoso.com**. Gör följande för både SQL Server-datorer och vittne för servern:</span><span class="sxs-lookup"><span data-stu-id="13a52-536">You're now able to join the VMs to **corp.contoso.com**. Do the following for both the SQL Server VMs and the file share witness server:</span></span>

1. <span data-ttu-id="13a52-537">Fjärransluta till den virtuella datorn med **BUILTIN\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="13a52-537">Remotely connect to the virtual machine with **BUILTIN\DomainAdmin**.</span></span>
2. <span data-ttu-id="13a52-538">I **Serverhanteraren**, klickar du på **lokal Server**.</span><span class="sxs-lookup"><span data-stu-id="13a52-538">In **Server Manager**, click **Local Server**.</span></span>
3. <span data-ttu-id="13a52-539">Klicka på den **arbetsgrupp** länk.</span><span class="sxs-lookup"><span data-stu-id="13a52-539">Click the **WORKGROUP** link.</span></span>
4. <span data-ttu-id="13a52-540">I den **datornamn** klickar du på **ändra**.</span><span class="sxs-lookup"><span data-stu-id="13a52-540">In the **Computer Name** section, click **Change**.</span></span>
5. <span data-ttu-id="13a52-541">Välj den **domän** kryssrutan och ange **corp.contoso.com** i textrutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-541">Select the **Domain** check box and type **corp.contoso.com** in the text box.</span></span> <span data-ttu-id="13a52-542">Klicka på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-542">Click **OK**.</span></span>
6. <span data-ttu-id="13a52-543">I den **Windows-säkerhet** popup dialogrutan Ange autentiseringsuppgifter för standardkontot för administratör (**CORP\DomainAdmin**) och lösenordet (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="13a52-543">In the **Windows Security** popup dialog, specify the credentials for the default domain administrator account (**CORP\DomainAdmin**) and the password (**Contoso!0000**).</span></span>
7. <span data-ttu-id="13a52-544">När meddelandet ”Välkommen till domänen corp.contoso.com”, klickar du på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-544">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span></span>
8. <span data-ttu-id="13a52-545">Klicka på **Stäng**, och klicka sedan på **starta om nu** i dialogrutan popup-fönster.</span><span class="sxs-lookup"><span data-stu-id="13a52-545">Click **Close**, and then click **Restart Now** in the popup dialog.</span></span>

### <a name="add-the-corpinstall-user-as-an-administrator-on-each-cluster-vm"></a><span data-ttu-id="13a52-546">Lägg till Corp\Install användaren som administratör på varje kluster VM</span><span class="sxs-lookup"><span data-stu-id="13a52-546">Add the Corp\Install user as an administrator on each cluster VM</span></span>

<span data-ttu-id="13a52-547">Varje virtuell dator startar om som en medlem i domänen och lägga till **CORP\Install** som medlem i gruppen lokala administratörer.</span><span class="sxs-lookup"><span data-stu-id="13a52-547">After each virtual machine restarts as a member of the domain, add **CORP\Install** as a member of the local administrators group.</span></span>

1. <span data-ttu-id="13a52-548">Vänta tills den virtuella datorn har startats om och sedan starta RDP-filen igen från den primära domänkontrollanten för att logga in på **sqlserver-0** med hjälp av den **CORP\DomainAdmin** konto.</span><span class="sxs-lookup"><span data-stu-id="13a52-548">Wait until the VM is restarted, then launch the RDP file again from the primary domain controller to sign in to **sqlserver-0** by using the **CORP\DomainAdmin** account.</span></span>
   >[!TIP]
   ><span data-ttu-id="13a52-549">Kontrollera att du loggar in med domänadministratörskontot.</span><span class="sxs-lookup"><span data-stu-id="13a52-549">Make sure that you sign in with the domain administrator account.</span></span> <span data-ttu-id="13a52-550">I de föregående stegen använde du SKAPAT i kontot.</span><span class="sxs-lookup"><span data-stu-id="13a52-550">In the previous steps, you were using the BUILT IN administrator account.</span></span> <span data-ttu-id="13a52-551">Nu när servern är i domänen, kan du använda domänkonto.</span><span class="sxs-lookup"><span data-stu-id="13a52-551">Now that the server is in the domain, use the domain account.</span></span> <span data-ttu-id="13a52-552">Ange i RDP-session *domän*\\*användarnamn*.</span><span class="sxs-lookup"><span data-stu-id="13a52-552">In your RDP session, specify *DOMAIN*\\*username*.</span></span>

2. <span data-ttu-id="13a52-553">I **Serverhanteraren**väljer **verktyg**, och klicka sedan på **Datorhantering**.</span><span class="sxs-lookup"><span data-stu-id="13a52-553">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span></span>
3. <span data-ttu-id="13a52-554">I den **Datorhantering** fönstret expanderar **lokala användare och grupper**, och välj sedan **grupper**.</span><span class="sxs-lookup"><span data-stu-id="13a52-554">In the **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span></span>
4. <span data-ttu-id="13a52-555">Dubbelklicka på den **administratörer** grupp.</span><span class="sxs-lookup"><span data-stu-id="13a52-555">Double-click the **Administrators** group.</span></span>
5. <span data-ttu-id="13a52-556">I den **egenskaper för administratörer** dialogrutan klickar du på den **Lägg till** knappen.</span><span class="sxs-lookup"><span data-stu-id="13a52-556">In the **Administrators Properties** dialog, click the **Add** button.</span></span>
6. <span data-ttu-id="13a52-557">Ange användaren **CORP\Install**, och klicka sedan på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-557">Enter the user **CORP\Install**, and then click **OK**.</span></span>
7. <span data-ttu-id="13a52-558">Klicka på **OK** att stänga den **Administratörsegenskaper** dialogrutan.</span><span class="sxs-lookup"><span data-stu-id="13a52-558">Click **OK** to close the **Administrator Properties** dialog.</span></span>
8. <span data-ttu-id="13a52-559">Upprepa föregående steg på **sqlserver-1** och **klustret fsw**.</span><span class="sxs-lookup"><span data-stu-id="13a52-559">Repeat the previous steps on **sqlserver-1** and **cluster-fsw**.</span></span>

### <span data-ttu-id="13a52-560"><a name="setServiceAccount"></a>Ange SQL Server-tjänstkonton</span><span class="sxs-lookup"><span data-stu-id="13a52-560"><a name="setServiceAccount"></a>Set the SQL Server service accounts</span></span>

<span data-ttu-id="13a52-561">Ange SQL Server-tjänstkontot på varje SQL Server-VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-561">On each SQL Server VM, set the SQL Server service account.</span></span> <span data-ttu-id="13a52-562">Använd de konton som du skapade när du [konfigurerats-domänkonton](#DomainAccounts).</span><span class="sxs-lookup"><span data-stu-id="13a52-562">Use the accounts that you created when you [configured the domain accounts](#DomainAccounts).</span></span>

1. <span data-ttu-id="13a52-563">Öppna **SQL Server Configuration Manager**.</span><span class="sxs-lookup"><span data-stu-id="13a52-563">Open **SQL Server Configuration Manager**.</span></span>
2. <span data-ttu-id="13a52-564">Högerklicka på SQL Server-tjänsten och klicka sedan på **egenskaper**.</span><span class="sxs-lookup"><span data-stu-id="13a52-564">Right-click the SQL Server service, and then click **Properties**.</span></span>
3. <span data-ttu-id="13a52-565">Ange konto och lösenord.</span><span class="sxs-lookup"><span data-stu-id="13a52-565">Set the account and password.</span></span>
4. <span data-ttu-id="13a52-566">Upprepa dessa steg på den andra SQL Server-VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-566">Repeat these steps on the other SQL Server VM.</span></span>  

<span data-ttu-id="13a52-567">Varje virtuell dator med SQL Server måste köras som ett domänkonto för SQL Server-Tillgänglighetsgrupper.</span><span class="sxs-lookup"><span data-stu-id="13a52-567">For SQL Server availability groups, each SQL Server VM needs to run as a domain account.</span></span>

### <a name="create-a-sign-in-on-each-sql-server-vm-for-the-installation-account"></a><span data-ttu-id="13a52-568">Skapa en inloggning på varje SQL Server-VM för kontot för installation av</span><span class="sxs-lookup"><span data-stu-id="13a52-568">Create a sign-in on each SQL Server VM for the installation account</span></span>

<span data-ttu-id="13a52-569">Använda kontot för installation av (CORP\install) för att konfigurera tillgänglighetsgruppen.</span><span class="sxs-lookup"><span data-stu-id="13a52-569">Use the installation account (CORP\install) to configure the availability group.</span></span> <span data-ttu-id="13a52-570">Det här kontot måste vara medlem i den **sysadmin** fasta serverrollen på varje SQL Server-VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-570">This account needs to be a member of the **sysadmin** fixed server role on each SQL Server VM.</span></span> <span data-ttu-id="13a52-571">Följande steg skapar en inloggning för kontot för installation:</span><span class="sxs-lookup"><span data-stu-id="13a52-571">The following steps create a sign-in for the installation account:</span></span>

1. <span data-ttu-id="13a52-572">Ansluta till servern via Remote Desktop Protocol (RDP) med hjälp av den  *\<MachineName\>\DomainAdmin* konto.</span><span class="sxs-lookup"><span data-stu-id="13a52-572">Connect to the server through the Remote Desktop Protocol (RDP) by using the *\<MachineName\>\DomainAdmin* account.</span></span>

1. <span data-ttu-id="13a52-573">Öppna SQL Server Management Studio och Anslut till den lokala instansen av SQL Server.</span><span class="sxs-lookup"><span data-stu-id="13a52-573">Open SQL Server Management Studio and connect to the local instance of SQL Server.</span></span>

1. <span data-ttu-id="13a52-574">I **Object Explorer**, klickar du på **säkerhet**.</span><span class="sxs-lookup"><span data-stu-id="13a52-574">In **Object Explorer**, click **Security**.</span></span>

1. <span data-ttu-id="13a52-575">Högerklicka på **inloggningar**.</span><span class="sxs-lookup"><span data-stu-id="13a52-575">Right-click **Logins**.</span></span> <span data-ttu-id="13a52-576">Klicka på **ny inloggning**.</span><span class="sxs-lookup"><span data-stu-id="13a52-576">Click **New Login**.</span></span>

1. <span data-ttu-id="13a52-577">I **inloggning - ny**, klickar du på **Sök**.</span><span class="sxs-lookup"><span data-stu-id="13a52-577">In **Login - New**, click **Search**.</span></span>

1. <span data-ttu-id="13a52-578">Klicka på **platser**.</span><span class="sxs-lookup"><span data-stu-id="13a52-578">Click **Locations**.</span></span>

1. <span data-ttu-id="13a52-579">Ange autentiseringsuppgifter som domänadministratör nätverk.</span><span class="sxs-lookup"><span data-stu-id="13a52-579">Enter the domain administrator network credentials.</span></span>

1. <span data-ttu-id="13a52-580">Använda kontot för installation.</span><span class="sxs-lookup"><span data-stu-id="13a52-580">Use the installation account.</span></span>

1. <span data-ttu-id="13a52-581">Ange inloggning ska vara medlem i den **sysadmin** fasta serverrollen.</span><span class="sxs-lookup"><span data-stu-id="13a52-581">Set the sign-in to be a member of the **sysadmin** fixed server role.</span></span>

1. <span data-ttu-id="13a52-582">Klicka på **OK**.</span><span class="sxs-lookup"><span data-stu-id="13a52-582">Click **OK**.</span></span>

<span data-ttu-id="13a52-583">Upprepa föregående steg på den andra SQL Server-VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-583">Repeat the preceding steps on the other SQL Server VM.</span></span>

## <a name="add-failover-clustering-features-to-both-sql-server-vms"></a><span data-ttu-id="13a52-584">Lägg till funktioner för redundanskluster i både SQL Server-datorer</span><span class="sxs-lookup"><span data-stu-id="13a52-584">Add Failover Clustering features to both SQL Server VMs</span></span>

<span data-ttu-id="13a52-585">Om du vill lägga till funktioner för redundanskluster, gör du följande på både SQL Server-datorer:</span><span class="sxs-lookup"><span data-stu-id="13a52-585">To add Failover Clustering features, do the following on both SQL Server VMs:</span></span>

1. <span data-ttu-id="13a52-586">Ansluta till SQL Server-dator via Remote Desktop Protocol (RDP) med hjälp av *CORP\install* konto.</span><span class="sxs-lookup"><span data-stu-id="13a52-586">Connect to the SQL Server virtual machine through the Remote Desktop Protocol (RDP) by using the *CORP\install* account.</span></span> <span data-ttu-id="13a52-587">Öppna **instrumentpanelen Serverhanteraren**.</span><span class="sxs-lookup"><span data-stu-id="13a52-587">Open **Server Manager Dashboard**.</span></span>
2. <span data-ttu-id="13a52-588">Klicka på den **Lägg till roller och funktioner** länk på instrumentpanelen.</span><span class="sxs-lookup"><span data-stu-id="13a52-588">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Lägg till roller](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
3. <span data-ttu-id="13a52-590">Välj **nästa** tills du kommer till den **serverfunktioner** avsnitt.</span><span class="sxs-lookup"><span data-stu-id="13a52-590">Select **Next** until you get to the **Server Features** section.</span></span>
4. <span data-ttu-id="13a52-591">I **funktioner**väljer **redundanskluster**.</span><span class="sxs-lookup"><span data-stu-id="13a52-591">In **Features**, select **Failover Clustering**.</span></span>
5. <span data-ttu-id="13a52-592">Lägg till eventuella ytterligare funktioner som krävs.</span><span class="sxs-lookup"><span data-stu-id="13a52-592">Add any additional required features.</span></span>
6. <span data-ttu-id="13a52-593">Klicka på **installera** att lägga till funktionerna.</span><span class="sxs-lookup"><span data-stu-id="13a52-593">Click **Install** to add the features.</span></span>

<span data-ttu-id="13a52-594">Upprepa steg på den andra SQL Server-VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-594">Repeat the steps on the other SQL Server VM.</span></span>

## <a name="a-nameendpoint-firewall-configure-the-firewall-on-each-sql-server-vm"></a><span data-ttu-id="13a52-595"><a name="endpoint-firewall">Konfigurera brandväggen på varje virtuell dator med SQL Server</span><span class="sxs-lookup"><span data-stu-id="13a52-595"><a name="endpoint-firewall"> Configure the firewall on each SQL Server VM</span></span>

<span data-ttu-id="13a52-596">Lösningen kräver följande TCP-portar vara öppna i brandväggen:</span><span class="sxs-lookup"><span data-stu-id="13a52-596">The solution requires the following TCP ports to be open in the firewall:</span></span>

- <span data-ttu-id="13a52-597">**SQLServer VM**:</span><span class="sxs-lookup"><span data-stu-id="13a52-597">**SQL Server VM**:</span></span><br/>
   <span data-ttu-id="13a52-598">Port 1433 för en standardinstans av SQL Server.</span><span class="sxs-lookup"><span data-stu-id="13a52-598">Port 1433 for a default instance of SQL Server.</span></span>
- <span data-ttu-id="13a52-599">**Azure belastningsutjämningsavsökning:**</span><span class="sxs-lookup"><span data-stu-id="13a52-599">**Azure load balancer probe:**</span></span><br/>
   <span data-ttu-id="13a52-600">Alla tillgängliga portar.</span><span class="sxs-lookup"><span data-stu-id="13a52-600">Any available port.</span></span> <span data-ttu-id="13a52-601">Exemplen använder ofta 59999.</span><span class="sxs-lookup"><span data-stu-id="13a52-601">Examples frequently use 59999.</span></span>
- <span data-ttu-id="13a52-602">**Slutpunkten för databasspegling:**</span><span class="sxs-lookup"><span data-stu-id="13a52-602">**Database mirroring endpoint:**</span></span> <br/>
   <span data-ttu-id="13a52-603">Alla tillgängliga portar.</span><span class="sxs-lookup"><span data-stu-id="13a52-603">Any available port.</span></span> <span data-ttu-id="13a52-604">Exemplen använder ofta 5022.</span><span class="sxs-lookup"><span data-stu-id="13a52-604">Examples frequently use 5022.</span></span>

<span data-ttu-id="13a52-605">Vilka brandväggsportar måste vara öppna på både SQL Server-datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-605">The firewall ports need to be open on both SQL Server VMs.</span></span>

<span data-ttu-id="13a52-606">Metoden för att öppna portarna beror på brandvägg som du använder.</span><span class="sxs-lookup"><span data-stu-id="13a52-606">The method of opening the ports depends on the firewall solution that you use.</span></span> <span data-ttu-id="13a52-607">I nästa avsnitt beskrivs hur du öppnar portar i Windows-brandväggen.</span><span class="sxs-lookup"><span data-stu-id="13a52-607">The next section explains how to open the ports in Windows Firewall.</span></span> <span data-ttu-id="13a52-608">Öppna portarna som krävs på alla virtuella din SQL Server-datorer.</span><span class="sxs-lookup"><span data-stu-id="13a52-608">Open the required ports on each of your SQL Server VMs.</span></span>

### <a name="open-a-tcp-port-in-the-firewall"></a><span data-ttu-id="13a52-609">Öppna en TCP-port i brandväggen</span><span class="sxs-lookup"><span data-stu-id="13a52-609">Open a TCP port in the firewall</span></span>

1. <span data-ttu-id="13a52-610">På den första SQL-servern **starta** skärmen, starta **Windows-brandväggen med avancerad säkerhet**.</span><span class="sxs-lookup"><span data-stu-id="13a52-610">On the first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span></span>
2. <span data-ttu-id="13a52-611">I den vänstra rutan, Välj **regler för inkommande trafik**.</span><span class="sxs-lookup"><span data-stu-id="13a52-611">On the left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="13a52-612">I den högra rutan, klickar du på **ny regel**.</span><span class="sxs-lookup"><span data-stu-id="13a52-612">On the right pane, click **New Rule**.</span></span>
3. <span data-ttu-id="13a52-613">För **regeltyp**, Välj **Port**.</span><span class="sxs-lookup"><span data-stu-id="13a52-613">For **Rule Type**, choose **Port**.</span></span>
4. <span data-ttu-id="13a52-614">Port, ange **TCP** och ange rätt portnummer.</span><span class="sxs-lookup"><span data-stu-id="13a52-614">For the port, specify **TCP** and type the appropriate port numbers.</span></span> <span data-ttu-id="13a52-615">Se följande exempel:</span><span class="sxs-lookup"><span data-stu-id="13a52-615">See the following example:</span></span>

   ![SQL-brandvägg](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/35-tcpports.png)

5. <span data-ttu-id="13a52-617">Klicka på **Nästa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-617">Click **Next**.</span></span>
6. <span data-ttu-id="13a52-618">På den **åtgärd** behåller **tillåter anslutningen** markerad och klicka sedan på **nästa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-618">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span></span>
7. <span data-ttu-id="13a52-619">På den **profil** , accepterar du standardinställningarna och klicka sedan på **nästa**.</span><span class="sxs-lookup"><span data-stu-id="13a52-619">On the **Profile** page, accept the default settings, and then click **Next**.</span></span>
8. <span data-ttu-id="13a52-620">På den **namn** anger du ett namn för regeln (exempelvis **Azure LB avsökning**) i den **namn** textrutan och klicka sedan på **Slutför**.</span><span class="sxs-lookup"><span data-stu-id="13a52-620">On the **Name** page, specify a rule name (such as **Azure LB Probe**) in the **Name** text box, and then click **Finish**.</span></span>

<span data-ttu-id="13a52-621">Upprepa dessa steg på den andra SQL Server-VM.</span><span class="sxs-lookup"><span data-stu-id="13a52-621">Repeat these steps on the second SQL Server VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="13a52-622">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="13a52-622">Next steps</span></span>

* [<span data-ttu-id="13a52-623">Skapa en SQL Server Always On availability group på virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="13a52-623">Create a SQL Server Always On availability group on Azure virtual machines</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md)
