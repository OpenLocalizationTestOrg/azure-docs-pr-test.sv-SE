---
title: "aaaTroubleshoot Autoskala med Virtual Machine-Skalningsuppsättningar | Microsoft Docs"
description: "Felsöka Autoskala med virtuella datorer. Förstå vanliga problem och hur tooresolve dem."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: 4c9a70992348d87fb43646421a90a027bf400a17
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="57025-104">Felsöka Autoskala med virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="57025-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="57025-105">**Problemet** – du har skapat en autoskalning infrastruktur i Azure Resource Manager med Skalningsuppsättningar – till exempel genom att distribuera en mall så här: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss bottle Autoskala – du har din definierade regler för skala och passar utmärkt, förutom att oavsett hur mycket belastning du spärra hello virtuella datorer är det inte Autoskala.</span><span class="sxs-lookup"><span data-stu-id="57025-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on hello VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="57025-106">Felsökningssteg</span><span class="sxs-lookup"><span data-stu-id="57025-106">Troubleshooting steps</span></span>
<span data-ttu-id="57025-107">Vissa saker tooconsider omfattar:</span><span class="sxs-lookup"><span data-stu-id="57025-107">Some things tooconsider include:</span></span>

* <span data-ttu-id="57025-108">Hur många kärnor finns varje virtuell dator, och du läser in varje core? hello Azure Quickstart exempelmall ovan har ett do_work.php skript som läser in en enda kärna.</span><span class="sxs-lookup"><span data-stu-id="57025-108">How many cores does each VM have, and are you loading each core? hello example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="57025-109">Om du använder en virtuell dator som är större än en enda kärna VM-storlek som Standard_A1 eller D1 sedan du skulle behöva toorun den här inläsningen flera gånger.</span><span class="sxs-lookup"><span data-stu-id="57025-109">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need toorun this load multiple times.</span></span> <span data-ttu-id="57025-110">Kontrollera hur många kärnor dina virtuella datorer genom att granska [storlekar för Windows-datorer i Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="57025-110">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="57025-111">Hur många virtuella datorer i VM Scale Set hello allt arbete på var och en?</span><span class="sxs-lookup"><span data-stu-id="57025-111">How many VMs in hello VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="57025-112">En skalbar händelse bara sker när hello Genomsnittlig CPU över **alla** hello virtuella datorer i en skaluppsättning överskrider hello tröskelvärde med tiden för hello interna definieras i hello Autoskala regler.</span><span class="sxs-lookup"><span data-stu-id="57025-112">A scale out event will only take place when hello average CPU across **all** hello VMs in a scale set exceeds hello threshold value, over hello time internal defined in hello autoscale rules.</span></span>
* <span data-ttu-id="57025-113">Missade du skala händelser?</span><span class="sxs-lookup"><span data-stu-id="57025-113">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="57025-114">Kontrollera hello granskningsloggar i hello Azure-portalen för skala händelser.</span><span class="sxs-lookup"><span data-stu-id="57025-114">Check hello audit logs in hello Azure portal for scale events.</span></span> <span data-ttu-id="57025-115">Kanske det fanns en skala upp och en skala ned som har missats.</span><span class="sxs-lookup"><span data-stu-id="57025-115">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="57025-116">Du kan filtrera efter ”skala”...</span><span class="sxs-lookup"><span data-stu-id="57025-116">You can filter by “Scale”..</span></span>
  
    ![Granskningsloggar][audit]
* <span data-ttu-id="57025-118">Är din skala i och skalbar tröskelvärden tillräckligt?</span><span class="sxs-lookup"><span data-stu-id="57025-118">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="57025-119">Anta att du anger en regel tooscale ut när Genomsnittlig CPU är större än 50% under 5 minuter och tooscale i när Genomsnittlig CPU är mindre än 50%.</span><span class="sxs-lookup"><span data-stu-id="57025-119">Suppose you set a rule tooscale out when average CPU is greater than 50% over 5 minutes, and tooscale in when average CPU is less than 50%.</span></span> <span data-ttu-id="57025-120">Detta innebär att ”flapping” problem när processoranvändningen är Stäng toothis tröskelvärde med skalningsåtgärder hello ständigt öka och minska storleken på hello uppsättning.</span><span class="sxs-lookup"><span data-stu-id="57025-120">This would cause a “flapping” problem when CPU usage is close toothis threshold, with scale actions constantly increasing and decreasing hello size of hello set.</span></span> <span data-ttu-id="57025-121">Därför försöker hello Autoskala tjänsten tooprevent ”växlar”, som kan visas som inte skalning.</span><span class="sxs-lookup"><span data-stu-id="57025-121">Because of this, hello autoscale service tries tooprevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="57025-122">Därför kontrollera din skalbar och tröskelvärden för skalan är tillräckligt olika tooallow Frigör utrymme mellan skalning.</span><span class="sxs-lookup"><span data-stu-id="57025-122">Therefore make sure your scale-out and scale-in thresholds are sufficiently different tooallow some space in between scaling.</span></span>
* <span data-ttu-id="57025-123">Du skriva en egen JSON-mall?</span><span class="sxs-lookup"><span data-stu-id="57025-123">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="57025-124">Det är enkelt toomake misstag, så börja med en mall som hello ovanpå som bevisas toowork och göra små inkrementella ändringar.</span><span class="sxs-lookup"><span data-stu-id="57025-124">It is easy toomake mistakes, so start with a template like hello one above which is proven toowork, and make small incremental changes.</span></span> 
* <span data-ttu-id="57025-125">Kan du manuellt skala in eller ut?</span><span class="sxs-lookup"><span data-stu-id="57025-125">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="57025-126">Försök att omdistribuera hello VM Scale Set resurs med en annan ”kapacitet” inställningen toochange hello antal virtuella datorer manuellt.</span><span class="sxs-lookup"><span data-stu-id="57025-126">Try redeploying hello VM Scale Set resource with a different “capacity” setting toochange hello number of VMs manually.</span></span> <span data-ttu-id="57025-127">Ett exempel mallen toodo som det här är: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – du kan behöva tooedit hello mallen toomake att den har hello samma datorn storlek som Scale Set använder.</span><span class="sxs-lookup"><span data-stu-id="57025-127">An example template toodo this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need tooedit hello template toomake sure it has hello same machine size as your Scale Set is using.</span></span> <span data-ttu-id="57025-128">Om du kan ändra hello antal virtuella datorer manuellt, vet hello problemet är isolerad tooautoscale.</span><span class="sxs-lookup"><span data-stu-id="57025-128">If you can successfully change hello number of VMs manually, then you know hello problem is isolated tooautoscale.</span></span>
* <span data-ttu-id="57025-129">Kontrollera din Microsoft.Compute/virtualMachineScaleSet och Microsoft.Insights resurser i hello [resursutforskaren i Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="57025-129">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in hello [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="57025-130">Detta är ett nödvändigt felsökningsverktyg som visar hello för dina Azure Resource Manager-resurser.</span><span class="sxs-lookup"><span data-stu-id="57025-130">This is an indispensable troubleshooting tool which shows you hello state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="57025-131">Klicka på din prenumeration och titta på hello resursgrupp som du felsöker.</span><span class="sxs-lookup"><span data-stu-id="57025-131">Click on your subscription and look at hello Resource Group you are troubleshooting.</span></span> <span data-ttu-id="57025-132">Titta på hello VM Scale Set du skapade under hello Compute-resursprovidern och kontrollera hello instansvyn som visar hello tillståndet för en distribution.</span><span class="sxs-lookup"><span data-stu-id="57025-132">Under hello Compute resource provider look at hello VM Scale Set you created and check hello Instance View, which shows you hello state of a deployment.</span></span> <span data-ttu-id="57025-133">Kontrollera också hello instansvyn för virtuella datorer i hello Skaluppsättning.</span><span class="sxs-lookup"><span data-stu-id="57025-133">Also check hello instance view of VMs in hello VM Scale Set.</span></span> <span data-ttu-id="57025-134">Sedan gå till hello Microsoft.Insights resursprovidern och kontrollera hello Autoskala regler ser bra ut.</span><span class="sxs-lookup"><span data-stu-id="57025-134">Then go into hello Microsoft.Insights resource provider and check hello autoscale rules look good.</span></span>
* <span data-ttu-id="57025-135">Hello diagnostiska tillägg fungerar och är avger prestandadata?</span><span class="sxs-lookup"><span data-stu-id="57025-135">Is hello Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="57025-136">**Uppdatering:** Azure autoskalningsfunktionen har förbättrat toouse värdbaserad mått pipelinen som kräver inte längre en diagnostik tillägget toobe installerad.</span><span class="sxs-lookup"><span data-stu-id="57025-136">**Update:** Azure autoscale has been enhanced toouse a host based metrics pipeline which no longer requires a diagnostics extension toobe installed.</span></span> <span data-ttu-id="57025-137">Det innebär att hello nästa några stycken inte längre användas om du skapar ett autoskalning program med hjälp av hello ny pipeline.</span><span class="sxs-lookup"><span data-stu-id="57025-137">This means hello next few paragraphs no longer apply if you create an autoscaling application using hello new pipeline.</span></span> <span data-ttu-id="57025-138">Ett exempel på Azure-mallar som har varit konverterade toouse hello värden pipeline är: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="57025-138">An example of Azure templates which have been converted toouse hello host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="57025-139">Med hjälp av värdbaserad mätvärden för Autoskala är bättre för hello följande orsaker:</span><span class="sxs-lookup"><span data-stu-id="57025-139">Using host based metrics for autoscale is better for hello following reasons:</span></span>
  
  * <span data-ttu-id="57025-140">Färre rörliga delar som inga diagnostik tillägg måste toobe installerad.</span><span class="sxs-lookup"><span data-stu-id="57025-140">Fewer moving parts as no diagnostics extensions need toobe installed.</span></span>
  * <span data-ttu-id="57025-141">Enklare mallar.</span><span class="sxs-lookup"><span data-stu-id="57025-141">Simpler templates.</span></span> <span data-ttu-id="57025-142">Lägg bara till insikter Autoskala regler tooan befintlig skaluppsättning för mallen.</span><span class="sxs-lookup"><span data-stu-id="57025-142">Just add insights autoscale rules tooan existing scale set template.</span></span>
  * <span data-ttu-id="57025-143">Mer tillförlitlig rapportering och snabbare start av nya virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="57025-143">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="57025-144">hello skulle endast orsaker som du använder ett tillägg för diagnostiska tookeep vara om du behöver minne diagnostik reporting/skalning.</span><span class="sxs-lookup"><span data-stu-id="57025-144">hello only reasons you might want tookeep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="57025-145">Värdbaserad mått rapporterar inte minne.</span><span class="sxs-lookup"><span data-stu-id="57025-145">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="57025-146">Med detta i åtanke bara följa hello resten av den här artikeln om du fortfarande använder diagnostiska tillägg för din autoskalning.</span><span class="sxs-lookup"><span data-stu-id="57025-146">With that in mind, only follow hello rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="57025-147">Autoskala i Azure Resource Manager kan arbeta (men har inte längre att) med hjälp av en VM-tillägget som kallas hello diagnostik tillägg.</span><span class="sxs-lookup"><span data-stu-id="57025-147">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called hello Diagnostics Extension.</span></span> <span data-ttu-id="57025-148">Den avger prestanda data tooa storage-konto du definierar i hello mallen.</span><span class="sxs-lookup"><span data-stu-id="57025-148">It emits performance data tooa storage account you define in hello template.</span></span> <span data-ttu-id="57025-149">Informationen sammanställs sedan av hello Azure-Monitor-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="57025-149">This data is then aggregated by hello Azure Monitor service.</span></span>
    
    <span data-ttu-id="57025-150">Om hello Insights-tjänsten inte kan läsa data från hello VMs, ska toosend du ett e-postmeddelande – till exempel om hello VMs ned, så kontrollera din e-post (hello något du angav när du skapar hello Azure-konto).</span><span class="sxs-lookup"><span data-stu-id="57025-150">If hello Insights service can’t read data from hello VMs, it is supposed toosend you an email – for example if hello VMs were down, so check your email (hello one you specified when creating hello Azure account).</span></span>
    
    <span data-ttu-id="57025-151">Du kan också gå och titta på hello data själv.</span><span class="sxs-lookup"><span data-stu-id="57025-151">You can also go and look at hello data yourself.</span></span> <span data-ttu-id="57025-152">Titta på hello Azure storage-konto med en cloud explorer.</span><span class="sxs-lookup"><span data-stu-id="57025-152">Look at hello Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="57025-153">Till exempel använder hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), logga in och välj hello du använder Azure-prenumeration och hello diagnostiklagringskonto namn som refereras i hello diagnostik resurstilläggsdefinitionen i distributionen mall...</span><span class="sxs-lookup"><span data-stu-id="57025-153">For example using hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick hello Azure subscription you’re using, and hello Diagnostics storage account name referenced in hello Diagnostics extension definition in your deployment template..</span></span>
    
    ![Cloud Explorer][explorer]
    
    <span data-ttu-id="57025-155">Här visas flera tabeller där hello data från varje virtuell dator lagras.</span><span class="sxs-lookup"><span data-stu-id="57025-155">Here you will see a bunch of tables where hello data from each VM is being stored.</span></span> <span data-ttu-id="57025-156">Tar Linux- och hello CPU måttet som ett exempel kan titta på hello senaste rader.</span><span class="sxs-lookup"><span data-stu-id="57025-156">Taking Linux and hello CPU metric as an example, look at hello most recent rows.</span></span> <span data-ttu-id="57025-157">hello Visual Studio cloud explorer stöder ett frågespråk så att du kan köra en fråga som ”tidsstämpel gt datetime'2016-02-02T21:20:00Z'” toomake till att du får hello senaste händelser (antar tid är i UTC).</span><span class="sxs-lookup"><span data-stu-id="57025-157">hello Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” toomake sure you get hello most recent events (assume time is in UTC).</span></span> <span data-ttu-id="57025-158">Skalas hello data som du ser i det motsvarar toohello regler som du ställer in?</span><span class="sxs-lookup"><span data-stu-id="57025-158">Does hello data you see in there correspond toohello scale rules you set up?</span></span> <span data-ttu-id="57025-159">I hello exemplet nedan igång hello CPU för datorn 20 öka too100% över hello sista 5 minuter...</span><span class="sxs-lookup"><span data-stu-id="57025-159">In hello example below, hello CPU for machine 20 started increasing too100% over hello last 5 minutes..</span></span>
    
    ![Storage-tabeller][tables]
    
    <span data-ttu-id="57025-161">Om hello data inte är det, sedan innebär den hello problemet är med hello diagnostiska tillägg som körs i hello virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="57025-161">If hello data is not there, then it implies hello problem is with hello diagnostic extension running in hello VMs.</span></span> <span data-ttu-id="57025-162">Om hello data är det, innebär det att det finns problem med din skalningsregler eller hello Insights-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="57025-162">If hello data is there, it implies there is either a problem with your scale rules, or with hello Insights service.</span></span> <span data-ttu-id="57025-163">Kontrollera [Azure Status](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="57025-163">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="57025-164">När du har genom stegen, om du fortfarande har problem med Autoskala du försöka hello-forum [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), eller [stackspill](http://stackoverflow.com/questions/tagged/azure), eller logga kundsupport.</span><span class="sxs-lookup"><span data-stu-id="57025-164">Once you’ve been through these steps, if you are still having autoscale problems you could try hello forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="57025-165">Vara förberedda tooshare hello mall och en vy över hello prestandadata.</span><span class="sxs-lookup"><span data-stu-id="57025-165">Be prepared tooshare hello template and a view of hello performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
