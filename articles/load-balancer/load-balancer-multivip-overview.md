---
title: "Flera VIP: er för Azure belastningsutjämnare | Microsoft Docs"
description: "Översikt över flera VIP: er på Azure belastningsutjämnare"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: d9e88b859020be2a96a57a01e5624052ed134b64
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="0432f-103">Flera virtuella ip-adresser för Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="0432f-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="0432f-104">Azure belastningsutjämnare kan du läsa in Utjämna tjänster på flera portar, flera IP-adresser eller båda.</span><span class="sxs-lookup"><span data-stu-id="0432f-104">Azure Load Balancer allows you to load balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="0432f-105">Du kan använda belastning offentliga och interna belastningsutjämnare definitioner för att läsa in saldo flödar över en uppsättning virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="0432f-105">You can use public and internal load balancer definitions to load balance flows across a set of VMs.</span></span>

<span data-ttu-id="0432f-106">Den här artikeln beskriver grunderna i den här möjligheten, viktiga begrepp och begränsningar.</span><span class="sxs-lookup"><span data-stu-id="0432f-106">This article describes the fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="0432f-107">Om du endast vill exponera tjänster på en IP-adress, kan du hitta förenklad instruktioner för [offentliga](load-balancer-get-started-internet-portal.md) eller [interna](load-balancer-get-started-ilb-arm-portal.md) läsa in belastningsutjämning konfigurationer.</span><span class="sxs-lookup"><span data-stu-id="0432f-107">If you only intend to expose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="0432f-108">Lägga till flera VIP: er är inkrementell till en enskild VIP-konfiguration.</span><span class="sxs-lookup"><span data-stu-id="0432f-108">Adding Multiple VIPs is incremental to a single VIP configuration.</span></span> <span data-ttu-id="0432f-109">Du kan expandera en förenklad konfiguration när som helst med hjälp av begrepp i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="0432f-109">Using the concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="0432f-110">När du definierar en Azure belastningsutjämnare ansluten en frontend och backend-konfiguration med regler.</span><span class="sxs-lookup"><span data-stu-id="0432f-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="0432f-111">Hälsoavsökningen som refereras av regeln används för att avgöra hur nya flöden skickas till en nod i serverdelspoolen.</span><span class="sxs-lookup"><span data-stu-id="0432f-111">The health probe referenced by the rule is used to determine how new flows are sent to a node in the backend pool.</span></span> <span data-ttu-id="0432f-112">Klientdelen definieras av en virtuell IP (VIP), vilket är ett 3-tuppel som består av en IP-adress (offentlig eller intern), en transportprotokollet (UDP eller TCP) och ett portnummer.</span><span class="sxs-lookup"><span data-stu-id="0432f-112">The frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="0432f-113">En DIP är en IP-adress på ett Azure virtuella nätverkskort som är anslutet till en virtuell dator i serverdelspoolen.</span><span class="sxs-lookup"><span data-stu-id="0432f-113">A DIP is an IP address on an Azure virtual NIC attached to a VM in the backend pool.</span></span>

<span data-ttu-id="0432f-114">Följande tabell innehåller några exempel klientdel konfigurationer:</span><span class="sxs-lookup"><span data-stu-id="0432f-114">The following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="0432f-115">VIP</span><span class="sxs-lookup"><span data-stu-id="0432f-115">VIP</span></span> | <span data-ttu-id="0432f-116">IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-116">IP address</span></span> | <span data-ttu-id="0432f-117">Protokollet</span><span class="sxs-lookup"><span data-stu-id="0432f-117">protocol</span></span> | <span data-ttu-id="0432f-118">port</span><span class="sxs-lookup"><span data-stu-id="0432f-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="0432f-119">1</span><span class="sxs-lookup"><span data-stu-id="0432f-119">1</span></span> |<span data-ttu-id="0432f-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-120">65.52.0.1</span></span> |<span data-ttu-id="0432f-121">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-121">TCP</span></span> |<span data-ttu-id="0432f-122">80</span><span class="sxs-lookup"><span data-stu-id="0432f-122">80</span></span> |
| <span data-ttu-id="0432f-123">2</span><span class="sxs-lookup"><span data-stu-id="0432f-123">2</span></span> |<span data-ttu-id="0432f-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-124">65.52.0.1</span></span> |<span data-ttu-id="0432f-125">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-125">TCP</span></span> |<span data-ttu-id="0432f-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="0432f-126">*8080*</span></span> |
| <span data-ttu-id="0432f-127">3</span><span class="sxs-lookup"><span data-stu-id="0432f-127">3</span></span> |<span data-ttu-id="0432f-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-128">65.52.0.1</span></span> |<span data-ttu-id="0432f-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="0432f-129">*UDP*</span></span> |<span data-ttu-id="0432f-130">80</span><span class="sxs-lookup"><span data-stu-id="0432f-130">80</span></span> |
| <span data-ttu-id="0432f-131">4</span><span class="sxs-lookup"><span data-stu-id="0432f-131">4</span></span> |<span data-ttu-id="0432f-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="0432f-132">*65.52.0.2*</span></span> |<span data-ttu-id="0432f-133">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-133">TCP</span></span> |<span data-ttu-id="0432f-134">80</span><span class="sxs-lookup"><span data-stu-id="0432f-134">80</span></span> |

<span data-ttu-id="0432f-135">Tabellen visar fyra olika frontends.</span><span class="sxs-lookup"><span data-stu-id="0432f-135">The table shows four different frontends.</span></span> <span data-ttu-id="0432f-136">Frontends #1, #2 och #3 är en enskild VIP med flera regler.</span><span class="sxs-lookup"><span data-stu-id="0432f-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="0432f-137">Samma IP-adress används men port eller protokoll är olika för varje klientdel.</span><span class="sxs-lookup"><span data-stu-id="0432f-137">The same IP address is used but the port or protocol is different for each frontend.</span></span> <span data-ttu-id="0432f-138">Frontends #1 och #4 är ett exempel på flera VIP: er, där samma frontend-protokoll och port återanvänds över flera VIP: er.</span><span class="sxs-lookup"><span data-stu-id="0432f-138">Frontends #1 and #4 are an example of Multiple VIPs, where the same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="0432f-139">Azure belastningsutjämnare ger flexibilitet för att definiera regler för belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="0432f-139">Azure Load Balancer provides flexibility in defining the load balancing rules.</span></span> <span data-ttu-id="0432f-140">En regel förklarar hur en adress och port på klientdelen mappas till mål-adress och port på serverdelen.</span><span class="sxs-lookup"><span data-stu-id="0432f-140">A rule declares how an address and port on the frontend is mapped to the destination address and port on the backend.</span></span> <span data-ttu-id="0432f-141">Huruvida backend portar återanvänds över regler beror på vilken typ av regeln.</span><span class="sxs-lookup"><span data-stu-id="0432f-141">Whether or not backend ports are reused across rules depends on the type of the rule.</span></span> <span data-ttu-id="0432f-142">Varje regel har specifika krav som kan påverka konfiguration och avsökning design av värd.</span><span class="sxs-lookup"><span data-stu-id="0432f-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="0432f-143">Det finns två typer av regler:</span><span class="sxs-lookup"><span data-stu-id="0432f-143">There are two types of rules:</span></span>

1. <span data-ttu-id="0432f-144">Standardregeln med återanvändning inga backend-port</span><span class="sxs-lookup"><span data-stu-id="0432f-144">The default rule with no backend port reuse</span></span>
2. <span data-ttu-id="0432f-145">Flytande IP regeln där återanvänds backend-portar</span><span class="sxs-lookup"><span data-stu-id="0432f-145">The Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="0432f-146">Azure belastningsutjämnare kan du blanda både regeltyper på samma belastningsutjämningskonfigurationen.</span><span class="sxs-lookup"><span data-stu-id="0432f-146">Azure Load Balancer allows you to mix both rule types on the same load balancer configuration.</span></span> <span data-ttu-id="0432f-147">Belastningsutjämnaren kan använda dem samtidigt för en viss virtuell dator eller en kombination, så länge du följer villkor för regeln.</span><span class="sxs-lookup"><span data-stu-id="0432f-147">The load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by the constraints of the rule.</span></span> <span data-ttu-id="0432f-148">Vilken typ av du väljer beror på kraven i ditt program och komplexitet stöder denna konfiguration.</span><span class="sxs-lookup"><span data-stu-id="0432f-148">Which rule type you choose depends on the requirements of your application and the complexity of supporting that configuration.</span></span> <span data-ttu-id="0432f-149">Du bör utvärdera vilka regeltyper lämpar sig bäst för ditt scenario.</span><span class="sxs-lookup"><span data-stu-id="0432f-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="0432f-150">Vi utforska dessa scenarier ytterligare genom att börja med standardbeteendet.</span><span class="sxs-lookup"><span data-stu-id="0432f-150">We explore these scenarios further by starting with the default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="0432f-151">Regeltyp #1: ingen backend port återanvändning</span><span class="sxs-lookup"><span data-stu-id="0432f-151">Rule type #1: No backend port reuse</span></span>

![MultiVIP-bild](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="0432f-153">I det här scenariot konfigureras klientdel VIP enligt följande:</span><span class="sxs-lookup"><span data-stu-id="0432f-153">In this scenario, the frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="0432f-154">VIP</span><span class="sxs-lookup"><span data-stu-id="0432f-154">VIP</span></span> | <span data-ttu-id="0432f-155">IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-155">IP address</span></span> | <span data-ttu-id="0432f-156">Protokollet</span><span class="sxs-lookup"><span data-stu-id="0432f-156">protocol</span></span> | <span data-ttu-id="0432f-157">port</span><span class="sxs-lookup"><span data-stu-id="0432f-157">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-159">1</span><span class="sxs-lookup"><span data-stu-id="0432f-159">1</span></span> |<span data-ttu-id="0432f-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-160">65.52.0.1</span></span> |<span data-ttu-id="0432f-161">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-161">TCP</span></span> |<span data-ttu-id="0432f-162">80</span><span class="sxs-lookup"><span data-stu-id="0432f-162">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-164">2</span><span class="sxs-lookup"><span data-stu-id="0432f-164">2</span></span> |<span data-ttu-id="0432f-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="0432f-165">*65.52.0.2*</span></span> |<span data-ttu-id="0432f-166">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-166">TCP</span></span> |<span data-ttu-id="0432f-167">80</span><span class="sxs-lookup"><span data-stu-id="0432f-167">80</span></span> |

<span data-ttu-id="0432f-168">DIP är målet för inkommande flödet.</span><span class="sxs-lookup"><span data-stu-id="0432f-168">The DIP is the destination of the inbound flow.</span></span> <span data-ttu-id="0432f-169">I serverdelspoolen visar varje virtuell dator till önskade-tjänsten på en unik port på en DIP.</span><span class="sxs-lookup"><span data-stu-id="0432f-169">In the backend pool, each VM exposes the desired service on a unique port on a DIP.</span></span> <span data-ttu-id="0432f-170">Den här tjänsten är associerad med klientdel via en regeldefinition av.</span><span class="sxs-lookup"><span data-stu-id="0432f-170">This service is associated with the frontend through a rule definition.</span></span>

<span data-ttu-id="0432f-171">Vi definierar två regler:</span><span class="sxs-lookup"><span data-stu-id="0432f-171">We define two rules:</span></span>

| <span data-ttu-id="0432f-172">Regel</span><span class="sxs-lookup"><span data-stu-id="0432f-172">Rule</span></span> | <span data-ttu-id="0432f-173">Mappa klientdel</span><span class="sxs-lookup"><span data-stu-id="0432f-173">Map frontend</span></span> | <span data-ttu-id="0432f-174">Till backend-adresspool</span><span class="sxs-lookup"><span data-stu-id="0432f-174">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0432f-175">1</span><span class="sxs-lookup"><span data-stu-id="0432f-175">1</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="0432f-177">VIP1:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="0432f-179">DIP1:80,</span></span> ![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="0432f-181">DIP2:80</span></span> |
| <span data-ttu-id="0432f-182">2</span><span class="sxs-lookup"><span data-stu-id="0432f-182">2</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="0432f-184">VIP2:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="0432f-186">DIP1:81,</span></span> ![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="0432f-188">DIP2:81</span></span> |

<span data-ttu-id="0432f-189">Fullständig mappningen i Azure belastningsutjämnare är nu på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="0432f-189">The complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="0432f-190">Regel</span><span class="sxs-lookup"><span data-stu-id="0432f-190">Rule</span></span> | <span data-ttu-id="0432f-191">VIP-IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-191">VIP IP address</span></span> | <span data-ttu-id="0432f-192">Protokollet</span><span class="sxs-lookup"><span data-stu-id="0432f-192">protocol</span></span> | <span data-ttu-id="0432f-193">port</span><span class="sxs-lookup"><span data-stu-id="0432f-193">port</span></span> | <span data-ttu-id="0432f-194">Mål</span><span class="sxs-lookup"><span data-stu-id="0432f-194">Destination</span></span> | <span data-ttu-id="0432f-195">port</span><span class="sxs-lookup"><span data-stu-id="0432f-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-197">1</span><span class="sxs-lookup"><span data-stu-id="0432f-197">1</span></span> |<span data-ttu-id="0432f-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-198">65.52.0.1</span></span> |<span data-ttu-id="0432f-199">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-199">TCP</span></span> |<span data-ttu-id="0432f-200">80</span><span class="sxs-lookup"><span data-stu-id="0432f-200">80</span></span> |<span data-ttu-id="0432f-201">DIP IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-201">DIP IP Address</span></span> |<span data-ttu-id="0432f-202">80</span><span class="sxs-lookup"><span data-stu-id="0432f-202">80</span></span> |
| ![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-204">2</span><span class="sxs-lookup"><span data-stu-id="0432f-204">2</span></span> |<span data-ttu-id="0432f-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="0432f-205">65.52.0.2</span></span> |<span data-ttu-id="0432f-206">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-206">TCP</span></span> |<span data-ttu-id="0432f-207">80</span><span class="sxs-lookup"><span data-stu-id="0432f-207">80</span></span> |<span data-ttu-id="0432f-208">DIP IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-208">DIP IP Address</span></span> |<span data-ttu-id="0432f-209">81</span><span class="sxs-lookup"><span data-stu-id="0432f-209">81</span></span> |

<span data-ttu-id="0432f-210">Varje regel måste generera ett flöde med en unik kombination av IP-adress och målport.</span><span class="sxs-lookup"><span data-stu-id="0432f-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="0432f-211">Genom att variera flödet målporten kan flera regler leverera flöden till samma DIP på olika portar.</span><span class="sxs-lookup"><span data-stu-id="0432f-211">By varying the destination port of the flow, multiple rules can deliver flows to the same DIP on different ports.</span></span>

<span data-ttu-id="0432f-212">Hälsoavsökningar alltid skickas vidare till DIP-ADRESSEN för en virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="0432f-212">Health probes are always directed to the DIP of a VM.</span></span> <span data-ttu-id="0432f-213">Du måste se till att du att din avsökning visar hälsotillståndet för den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="0432f-213">You must ensure you that your probe reflects the health of the VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="0432f-214">Regeltyp #2: återanvändning av backend-port med hjälp av flytande IP</span><span class="sxs-lookup"><span data-stu-id="0432f-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="0432f-215">Azure belastningsutjämnare ger flexibilitet att återanvända klientdelsport över flera VIP: er oavsett regeltypen används.</span><span class="sxs-lookup"><span data-stu-id="0432f-215">Azure Load Balancer provides the flexibility to reuse the frontend port across multiple VIPs regardless of the rule type used.</span></span> <span data-ttu-id="0432f-216">Dessutom kan vissa Programscenarier föredrar eller kräver samma port som ska användas av flera programinstanser på en enda virtuell dator i serverdelspoolen.</span><span class="sxs-lookup"><span data-stu-id="0432f-216">Additionally, some application scenarios prefer or require the same port to be used by multiple application instances on a single VM in the backend pool.</span></span> <span data-ttu-id="0432f-217">Vanliga exempel port återanvändning av omfattar kluster för hög tillgänglighet, virtuella installationer och exponera flera TLS slutpunkter utan omkryptering.</span><span class="sxs-lookup"><span data-stu-id="0432f-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="0432f-218">Om du vill återanvända serverporten över flera regler måste du aktivera flytande IP i Regeldefinitionen.</span><span class="sxs-lookup"><span data-stu-id="0432f-218">If you want to reuse the backend port across multiple rules, you must enable Floating IP in the rule definition.</span></span>

<span data-ttu-id="0432f-219">Flytande IP är en del av känt som direkt Server returnera (DSR).</span><span class="sxs-lookup"><span data-stu-id="0432f-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="0432f-220">DSR består av två delar: en flödet topologi och en IP-mappning schemat.</span><span class="sxs-lookup"><span data-stu-id="0432f-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="0432f-221">På en plattformsnivå körs alltid Azure belastningsutjämnare i en topologi för flödet av DSR oavsett om flytande IP är aktiverat eller inte.</span><span class="sxs-lookup"><span data-stu-id="0432f-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="0432f-222">Det innebär att den utgående delen av ett flöde alltid korrekt skrivits om för att gå direkt till ursprunget.</span><span class="sxs-lookup"><span data-stu-id="0432f-222">This means that the outbound part of a flow is always correctly rewritten to flow directly back to the origin.</span></span>

<span data-ttu-id="0432f-223">Med regeltypen standard exponerar Azure en traditionell IP-adress mappning schema för användarvänlighet för belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="0432f-223">With the default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="0432f-224">Aktivera flytande IP ändrar IP-adress mappning schemat så att ytterligare flexibilitet som beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="0432f-224">Enabling Floating IP changes the IP address mapping scheme to allow for additional flexibility as explained below.</span></span>

<span data-ttu-id="0432f-225">Följande diagram illustrerar den här konfigurationen:</span><span class="sxs-lookup"><span data-stu-id="0432f-225">The following diagram illustrates this configuration:</span></span>

![MultiVIP-bild](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="0432f-227">I det här scenariot har varje virtuell dator i serverdelspoolen tre nätverksgränssnitt:</span><span class="sxs-lookup"><span data-stu-id="0432f-227">For this scenario, every VM in the backend pool has three network interfaces:</span></span>

* <span data-ttu-id="0432f-228">DIP: ett virtuellt nätverkskort som är kopplade till den virtuella datorn (IP-konfiguration av Azures NIC resurs)</span><span class="sxs-lookup"><span data-stu-id="0432f-228">DIP: a Virtual NIC associated with the VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="0432f-229">VIP1: en loopback-gränssnittet i gästoperativsystemet som är konfigurerade med IP-adressen för VIP1</span><span class="sxs-lookup"><span data-stu-id="0432f-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="0432f-230">VIP2: en loopback-gränssnittet i gästoperativsystemet som är konfigurerade med IP-adressen för VIP2</span><span class="sxs-lookup"><span data-stu-id="0432f-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0432f-231">Konfigurationen av de logiska gränssnitt utförs i gästoperativsystemet.</span><span class="sxs-lookup"><span data-stu-id="0432f-231">The configuration of the logical interfaces is performed within the guest OS.</span></span> <span data-ttu-id="0432f-232">Den här konfigurationen är inte utföras eller som hanteras av Azure.</span><span class="sxs-lookup"><span data-stu-id="0432f-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="0432f-233">Reglerna fungerar inte utan den här konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="0432f-233">Without this configuration, the rules will not function.</span></span> <span data-ttu-id="0432f-234">Hälsotillstånd avsökningen definitionerna använder DIP-ADRESSEN för den virtuella datorn i stället för det logiska VIP.</span><span class="sxs-lookup"><span data-stu-id="0432f-234">Health probe definitions use the DIP of the VM rather than the logical VIP.</span></span> <span data-ttu-id="0432f-235">Din tjänst måste därför ange avsökningen svar på en DIP-port som återspeglar status för tjänsten finns på logiska VIP.</span><span class="sxs-lookup"><span data-stu-id="0432f-235">Therefore, your service must provide probe responses on a DIP port that reflect the status of the service offered on the logical VIP.</span></span>

<span data-ttu-id="0432f-236">Antar vi att samma konfiguration för klientdel som i det föregående scenariot:</span><span class="sxs-lookup"><span data-stu-id="0432f-236">Let's assume the same frontend configuration as in the previous scenario:</span></span>

| <span data-ttu-id="0432f-237">VIP</span><span class="sxs-lookup"><span data-stu-id="0432f-237">VIP</span></span> | <span data-ttu-id="0432f-238">IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-238">IP address</span></span> | <span data-ttu-id="0432f-239">Protokollet</span><span class="sxs-lookup"><span data-stu-id="0432f-239">protocol</span></span> | <span data-ttu-id="0432f-240">port</span><span class="sxs-lookup"><span data-stu-id="0432f-240">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-242">1</span><span class="sxs-lookup"><span data-stu-id="0432f-242">1</span></span> |<span data-ttu-id="0432f-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-243">65.52.0.1</span></span> |<span data-ttu-id="0432f-244">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-244">TCP</span></span> |<span data-ttu-id="0432f-245">80</span><span class="sxs-lookup"><span data-stu-id="0432f-245">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-247">2</span><span class="sxs-lookup"><span data-stu-id="0432f-247">2</span></span> |<span data-ttu-id="0432f-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="0432f-248">*65.52.0.2*</span></span> |<span data-ttu-id="0432f-249">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-249">TCP</span></span> |<span data-ttu-id="0432f-250">80</span><span class="sxs-lookup"><span data-stu-id="0432f-250">80</span></span> |

<span data-ttu-id="0432f-251">Vi definierar två regler:</span><span class="sxs-lookup"><span data-stu-id="0432f-251">We define two rules:</span></span>

| <span data-ttu-id="0432f-252">Regel</span><span class="sxs-lookup"><span data-stu-id="0432f-252">Rule</span></span> | <span data-ttu-id="0432f-253">Mappa klientdel</span><span class="sxs-lookup"><span data-stu-id="0432f-253">Map frontend</span></span> | <span data-ttu-id="0432f-254">Till backend-adresspool</span><span class="sxs-lookup"><span data-stu-id="0432f-254">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0432f-255">1</span><span class="sxs-lookup"><span data-stu-id="0432f-255">1</span></span> |![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="0432f-257">VIP1:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-259">VIP1:80 (i VM1 och VM2)</span><span class="sxs-lookup"><span data-stu-id="0432f-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="0432f-260">2</span><span class="sxs-lookup"><span data-stu-id="0432f-260">2</span></span> |![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="0432f-262">VIP2:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-264">VIP2:80 (i VM1 och VM2)</span><span class="sxs-lookup"><span data-stu-id="0432f-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="0432f-265">Följande tabell visar slutförd mappningen i belastningsutjämnaren:</span><span class="sxs-lookup"><span data-stu-id="0432f-265">The following table shows the complete mapping in the load balancer:</span></span>

| <span data-ttu-id="0432f-266">Regel</span><span class="sxs-lookup"><span data-stu-id="0432f-266">Rule</span></span> | <span data-ttu-id="0432f-267">VIP-IP-adress</span><span class="sxs-lookup"><span data-stu-id="0432f-267">VIP IP address</span></span> | <span data-ttu-id="0432f-268">Protokollet</span><span class="sxs-lookup"><span data-stu-id="0432f-268">protocol</span></span> | <span data-ttu-id="0432f-269">port</span><span class="sxs-lookup"><span data-stu-id="0432f-269">port</span></span> | <span data-ttu-id="0432f-270">Mål</span><span class="sxs-lookup"><span data-stu-id="0432f-270">Destination</span></span> | <span data-ttu-id="0432f-271">port</span><span class="sxs-lookup"><span data-stu-id="0432f-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="0432f-273">1</span><span class="sxs-lookup"><span data-stu-id="0432f-273">1</span></span> |<span data-ttu-id="0432f-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="0432f-274">65.52.0.1</span></span> |<span data-ttu-id="0432f-275">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-275">TCP</span></span> |<span data-ttu-id="0432f-276">80</span><span class="sxs-lookup"><span data-stu-id="0432f-276">80</span></span> |<span data-ttu-id="0432f-277">samma som VIP (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="0432f-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="0432f-278">samma som VIP (80)</span><span class="sxs-lookup"><span data-stu-id="0432f-278">same as VIP (80)</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="0432f-280">2</span><span class="sxs-lookup"><span data-stu-id="0432f-280">2</span></span> |<span data-ttu-id="0432f-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="0432f-281">65.52.0.2</span></span> |<span data-ttu-id="0432f-282">TCP</span><span class="sxs-lookup"><span data-stu-id="0432f-282">TCP</span></span> |<span data-ttu-id="0432f-283">80</span><span class="sxs-lookup"><span data-stu-id="0432f-283">80</span></span> |<span data-ttu-id="0432f-284">samma som VIP (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="0432f-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="0432f-285">samma som VIP (80)</span><span class="sxs-lookup"><span data-stu-id="0432f-285">same as VIP (80)</span></span> |

<span data-ttu-id="0432f-286">Målet inkommande flödet är VIP-adressen på loopback-gränssnittet på den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="0432f-286">The destination of the inbound flow is the VIP address on the loopback interface in the VM.</span></span> <span data-ttu-id="0432f-287">Varje regel måste generera ett flöde med en unik kombination av IP-adress och målport.</span><span class="sxs-lookup"><span data-stu-id="0432f-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="0432f-288">Genom att variera den IP-adressen i flöde går port återanvändning på samma virtuella dator.</span><span class="sxs-lookup"><span data-stu-id="0432f-288">By varying the destination IP address of the flow, port reuse is possible on the same VM.</span></span> <span data-ttu-id="0432f-289">Tjänsten är exponerad för belastningsutjämnaren genom att binda till VIP IP-adressen och porten för respektive loopback-gränssnittet.</span><span class="sxs-lookup"><span data-stu-id="0432f-289">Your service is exposed to the load balancer by binding it to the VIP’s IP address and port of the respective loopback interface.</span></span>

<span data-ttu-id="0432f-290">Observera att det här exemplet inte ändrar målporten.</span><span class="sxs-lookup"><span data-stu-id="0432f-290">Notice that this example does not change the destination port.</span></span> <span data-ttu-id="0432f-291">Även om det är ett flytande IP-scenario stöder Azure belastningsutjämnare också definiera en regel för att skriva om backend-målport och skiljer den från klientdel målport.</span><span class="sxs-lookup"><span data-stu-id="0432f-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule to rewrite the backend destination port and to make it different from the frontend destination port.</span></span>

<span data-ttu-id="0432f-292">Regeltyp flytande IP är grunden för flera belastningsutjämnare configuration belastningsmönster.</span><span class="sxs-lookup"><span data-stu-id="0432f-292">The Floating IP rule type is the foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="0432f-293">Ett exempel som är tillgänglig för närvarande är den [SQL AlwaysOn med flera lyssnare](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) konfiguration.</span><span class="sxs-lookup"><span data-stu-id="0432f-293">One example that is currently available is the [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="0432f-294">Över tiden, kommer vi dokumentera flera av dessa scenarier.</span><span class="sxs-lookup"><span data-stu-id="0432f-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="0432f-295">Begränsningar</span><span class="sxs-lookup"><span data-stu-id="0432f-295">Limitations</span></span>

* <span data-ttu-id="0432f-296">Konfigurationer med flera VIP stöds bara med IaaS-VM.</span><span class="sxs-lookup"><span data-stu-id="0432f-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="0432f-297">Programmet måste använda DIP för utgående flöden med flytande IP-regel.</span><span class="sxs-lookup"><span data-stu-id="0432f-297">With the Floating IP rule, your application must use the DIP for outbound flows.</span></span> <span data-ttu-id="0432f-298">Om ditt program Binder till VIP-adressen konfigurerad på loopback-gränssnittet i gästoperativsystemet, sedan SNAT går inte att skriva om utgående flödet och flödet misslyckas.</span><span class="sxs-lookup"><span data-stu-id="0432f-298">If your application binds to the VIP address configured on the loopback interface in the guest OS, then SNAT is not available to rewrite the outbound flow and the flow fails.</span></span>
* <span data-ttu-id="0432f-299">Offentliga IP-adresser påverka faktureringen.</span><span class="sxs-lookup"><span data-stu-id="0432f-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="0432f-300">Mer information finns i [priser för IP-adress](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="0432f-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="0432f-301">Prenumerationsbegränsningar gäller.</span><span class="sxs-lookup"><span data-stu-id="0432f-301">Subscription limits apply.</span></span> <span data-ttu-id="0432f-302">Mer information finns i [gränser](../azure-subscription-service-limits.md#networking-limits) mer information.</span><span class="sxs-lookup"><span data-stu-id="0432f-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
