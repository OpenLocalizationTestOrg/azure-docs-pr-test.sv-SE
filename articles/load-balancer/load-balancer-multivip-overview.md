---
title: "aaaMultiple VIP för belastningsutjämnaren i Azure | Microsoft Docs"
description: "Översikt över flera VIP: er på Azure belastningsutjämnare"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: e186e1248e7d187e7efd0668dc3244465ce3e156
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="9cbfc-103">Flera virtuella ip-adresser för Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="9cbfc-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="9cbfc-104">Azure belastningsutjämnare kan utjämna tooload tjänster på flera portar, flera IP-adresser eller båda.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-104">Azure Load Balancer allows you tooload balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="9cbfc-105">Du kan använda belastning offentliga och interna belastningsutjämnare definitioner tooload saldo flödar över en uppsättning virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-105">You can use public and internal load balancer definitions tooload balance flows across a set of VMs.</span></span>

<span data-ttu-id="9cbfc-106">Den här artikeln beskriver hello grunderna i den här möjligheten, viktiga begrepp och begränsningar.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-106">This article describes hello fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="9cbfc-107">Om du avser endast tooexpose tjänster en IP-adress, kan du hitta förenklad instruktioner för [offentliga](load-balancer-get-started-internet-portal.md) eller [interna](load-balancer-get-started-ilb-arm-portal.md) läsa in belastningsutjämning konfigurationer.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-107">If you only intend tooexpose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="9cbfc-108">Lägga till flera VIP: er är inkrementell tooa enskild VIP-konfiguration.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-108">Adding Multiple VIPs is incremental tooa single VIP configuration.</span></span> <span data-ttu-id="9cbfc-109">Du kan expandera en förenklad konfiguration när som helst med hello begrepp i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-109">Using hello concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="9cbfc-110">När du definierar en Azure belastningsutjämnare ansluten en frontend och backend-konfiguration med regler.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="9cbfc-111">Hej hälsoavsökningen som hello regeln är används toodetermine hur nya flöden skickas tooa nod i hello serverdelspool.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-111">hello health probe referenced by hello rule is used toodetermine how new flows are sent tooa node in hello backend pool.</span></span> <span data-ttu-id="9cbfc-112">hello klientdel definieras av en virtuell IP (VIP), vilket är ett 3-tuppel som består av en IP-adress (offentlig eller intern), en transportprotokollet (UDP eller TCP) och ett portnummer.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-112">hello frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="9cbfc-113">En DIP är en IP-adress på en virtuell NIC som Azure ansluten tooa VM i hello serverdelspool.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-113">A DIP is an IP address on an Azure virtual NIC attached tooa VM in hello backend pool.</span></span>

<span data-ttu-id="9cbfc-114">hello följande tabell innehåller några exempel klientdel konfigurationer:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-114">hello following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="9cbfc-115">VIP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-115">VIP</span></span> | <span data-ttu-id="9cbfc-116">IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-116">IP address</span></span> | <span data-ttu-id="9cbfc-117">Protokollet</span><span class="sxs-lookup"><span data-stu-id="9cbfc-117">protocol</span></span> | <span data-ttu-id="9cbfc-118">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="9cbfc-119">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-119">1</span></span> |<span data-ttu-id="9cbfc-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-120">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-121">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-121">TCP</span></span> |<span data-ttu-id="9cbfc-122">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-122">80</span></span> |
| <span data-ttu-id="9cbfc-123">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-123">2</span></span> |<span data-ttu-id="9cbfc-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-124">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-125">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-125">TCP</span></span> |<span data-ttu-id="9cbfc-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="9cbfc-126">*8080*</span></span> |
| <span data-ttu-id="9cbfc-127">3</span><span class="sxs-lookup"><span data-stu-id="9cbfc-127">3</span></span> |<span data-ttu-id="9cbfc-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-128">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="9cbfc-129">*UDP*</span></span> |<span data-ttu-id="9cbfc-130">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-130">80</span></span> |
| <span data-ttu-id="9cbfc-131">4</span><span class="sxs-lookup"><span data-stu-id="9cbfc-131">4</span></span> |<span data-ttu-id="9cbfc-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="9cbfc-132">*65.52.0.2*</span></span> |<span data-ttu-id="9cbfc-133">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-133">TCP</span></span> |<span data-ttu-id="9cbfc-134">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-134">80</span></span> |

<span data-ttu-id="9cbfc-135">hello tabell visar fyra olika frontends.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-135">hello table shows four different frontends.</span></span> <span data-ttu-id="9cbfc-136">Frontends #1, #2 och #3 är en enskild VIP med flera regler.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="9cbfc-137">hello samma IP-adress används men hello port eller protokoll är olika för varje klientdel.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-137">hello same IP address is used but hello port or protocol is different for each frontend.</span></span> <span data-ttu-id="9cbfc-138">Frontends #1 och #4 är ett exempel på flera VIP: er, där hello samma frontend-protokoll och port återanvänds över flera VIP: er.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-138">Frontends #1 and #4 are an example of Multiple VIPs, where hello same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="9cbfc-139">Azure belastningsutjämnare ger flexibilitet för att definiera hello regler för belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-139">Azure Load Balancer provides flexibility in defining hello load balancing rules.</span></span> <span data-ttu-id="9cbfc-140">En regel förklarar hur en adress och port på hello klientdel är mappade toohello mål-adress och port på hello backend.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-140">A rule declares how an address and port on hello frontend is mapped toohello destination address and port on hello backend.</span></span> <span data-ttu-id="9cbfc-141">Huruvida backend portar återanvänds över regler beror på hello typ av hello regel.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-141">Whether or not backend ports are reused across rules depends on hello type of hello rule.</span></span> <span data-ttu-id="9cbfc-142">Varje regel har specifika krav som kan påverka konfiguration och avsökning design av värd.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="9cbfc-143">Det finns två typer av regler:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-143">There are two types of rules:</span></span>

1. <span data-ttu-id="9cbfc-144">återanvända hello standardregel med ingen backend-port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-144">hello default rule with no backend port reuse</span></span>
2. <span data-ttu-id="9cbfc-145">hello flytande IP regeln där återanvänds backend-portar</span><span class="sxs-lookup"><span data-stu-id="9cbfc-145">hello Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="9cbfc-146">Azure belastningsutjämnare kan du toomix både regeltyper på hello samma konfiguration av belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-146">Azure Load Balancer allows you toomix both rule types on hello same load balancer configuration.</span></span> <span data-ttu-id="9cbfc-147">hello belastningsutjämnare kan använda dem samtidigt för en viss virtuell dator eller en kombination, så länge du följer hello begränsningarna för hello regeln.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-147">hello load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by hello constraints of hello rule.</span></span> <span data-ttu-id="9cbfc-148">Vilken typ av du väljer beror på hello kraven för dina program och hello komplexitet stöder denna konfiguration.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-148">Which rule type you choose depends on hello requirements of your application and hello complexity of supporting that configuration.</span></span> <span data-ttu-id="9cbfc-149">Du bör utvärdera vilka regeltyper lämpar sig bäst för ditt scenario.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="9cbfc-150">Vi utforska dessa scenarier ytterligare genom att börja med hello standardbeteendet.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-150">We explore these scenarios further by starting with hello default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="9cbfc-151">Regeltyp #1: ingen backend port återanvändning</span><span class="sxs-lookup"><span data-stu-id="9cbfc-151">Rule type #1: No backend port reuse</span></span>

![MultiVIP-bild](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="9cbfc-153">I det här scenariot hello klientdel VIP konfigureras enligt följande:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-153">In this scenario, hello frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="9cbfc-154">VIP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-154">VIP</span></span> | <span data-ttu-id="9cbfc-155">IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-155">IP address</span></span> | <span data-ttu-id="9cbfc-156">Protokollet</span><span class="sxs-lookup"><span data-stu-id="9cbfc-156">protocol</span></span> | <span data-ttu-id="9cbfc-157">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-157">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-159">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-159">1</span></span> |<span data-ttu-id="9cbfc-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-160">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-161">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-161">TCP</span></span> |<span data-ttu-id="9cbfc-162">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-162">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-164">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-164">2</span></span> |<span data-ttu-id="9cbfc-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="9cbfc-165">*65.52.0.2*</span></span> |<span data-ttu-id="9cbfc-166">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-166">TCP</span></span> |<span data-ttu-id="9cbfc-167">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-167">80</span></span> |

<span data-ttu-id="9cbfc-168">hello DIP är hello målet hello inkommande flödet.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-168">hello DIP is hello destination of hello inbound flow.</span></span> <span data-ttu-id="9cbfc-169">Varje virtuell dator visar hello desired-tjänsten på en unik port på en DIP i hello serverdelspool.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-169">In hello backend pool, each VM exposes hello desired service on a unique port on a DIP.</span></span> <span data-ttu-id="9cbfc-170">Den här tjänsten är associerad med hello klientdel via en regeldefinition av.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-170">This service is associated with hello frontend through a rule definition.</span></span>

<span data-ttu-id="9cbfc-171">Vi definierar två regler:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-171">We define two rules:</span></span>

| <span data-ttu-id="9cbfc-172">Regel</span><span class="sxs-lookup"><span data-stu-id="9cbfc-172">Rule</span></span> | <span data-ttu-id="9cbfc-173">Mappa klientdel</span><span class="sxs-lookup"><span data-stu-id="9cbfc-173">Map frontend</span></span> | <span data-ttu-id="9cbfc-174">toobackend pool</span><span class="sxs-lookup"><span data-stu-id="9cbfc-174">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9cbfc-175">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-175">1</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-177">VIP1:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="9cbfc-179">DIP1:80,</span></span> ![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-181">DIP2:80</span></span> |
| <span data-ttu-id="9cbfc-182">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-182">2</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-184">VIP2:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="9cbfc-186">DIP1:81,</span></span> ![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="9cbfc-188">DIP2:81</span></span> |

<span data-ttu-id="9cbfc-189">hello fullständig mappning i Azure belastningsutjämnare är nu på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-189">hello complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="9cbfc-190">Regel</span><span class="sxs-lookup"><span data-stu-id="9cbfc-190">Rule</span></span> | <span data-ttu-id="9cbfc-191">VIP-IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-191">VIP IP address</span></span> | <span data-ttu-id="9cbfc-192">Protokollet</span><span class="sxs-lookup"><span data-stu-id="9cbfc-192">protocol</span></span> | <span data-ttu-id="9cbfc-193">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-193">port</span></span> | <span data-ttu-id="9cbfc-194">Mål</span><span class="sxs-lookup"><span data-stu-id="9cbfc-194">Destination</span></span> | <span data-ttu-id="9cbfc-195">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-197">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-197">1</span></span> |<span data-ttu-id="9cbfc-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-198">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-199">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-199">TCP</span></span> |<span data-ttu-id="9cbfc-200">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-200">80</span></span> |<span data-ttu-id="9cbfc-201">DIP IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-201">DIP IP Address</span></span> |<span data-ttu-id="9cbfc-202">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-202">80</span></span> |
| ![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-204">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-204">2</span></span> |<span data-ttu-id="9cbfc-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-205">65.52.0.2</span></span> |<span data-ttu-id="9cbfc-206">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-206">TCP</span></span> |<span data-ttu-id="9cbfc-207">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-207">80</span></span> |<span data-ttu-id="9cbfc-208">DIP IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-208">DIP IP Address</span></span> |<span data-ttu-id="9cbfc-209">81</span><span class="sxs-lookup"><span data-stu-id="9cbfc-209">81</span></span> |

<span data-ttu-id="9cbfc-210">Varje regel måste generera ett flöde med en unik kombination av IP-adress och målport.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="9cbfc-211">Genom att variera hello målporten hello flödet, kan flera regler flöden toohello leverera samma DIP på olika portar.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-211">By varying hello destination port of hello flow, multiple rules can deliver flows toohello same DIP on different ports.</span></span>

<span data-ttu-id="9cbfc-212">Hälsoavsökningar är alltid dirigerad toohello DIP av en virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-212">Health probes are always directed toohello DIP of a VM.</span></span> <span data-ttu-id="9cbfc-213">Du måste se till att du att din avsökningen återspeglar hello hälsotillstånd hello VM.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-213">You must ensure you that your probe reflects hello health of hello VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="9cbfc-214">Regeltyp #2: återanvändning av backend-port med hjälp av flytande IP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="9cbfc-215">Azure belastningsutjämnare ger hello flexibilitet tooreuse hello klientdelsport över flera VIP: er oavsett hello regeltyp används.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-215">Azure Load Balancer provides hello flexibility tooreuse hello frontend port across multiple VIPs regardless of hello rule type used.</span></span> <span data-ttu-id="9cbfc-216">Dessutom kan vissa Programscenarier föredrar eller kräver hello samma port toobe som används av flera programinstanser på en enda virtuell dator i serverdelspoolen hello.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-216">Additionally, some application scenarios prefer or require hello same port toobe used by multiple application instances on a single VM in hello backend pool.</span></span> <span data-ttu-id="9cbfc-217">Vanliga exempel port återanvändning av omfattar kluster för hög tillgänglighet, virtuella installationer och exponera flera TLS slutpunkter utan omkryptering.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="9cbfc-218">Om du vill tooreuse hello serverdelsport över flera regler måste du aktivera flytande IP i hello Regeldefinitionen.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-218">If you want tooreuse hello backend port across multiple rules, you must enable Floating IP in hello rule definition.</span></span>

<span data-ttu-id="9cbfc-219">Flytande IP är en del av känt som direkt Server returnera (DSR).</span><span class="sxs-lookup"><span data-stu-id="9cbfc-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="9cbfc-220">DSR består av två delar: en flödet topologi och en IP-mappning schemat.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="9cbfc-221">På en plattformsnivå körs alltid Azure belastningsutjämnare i en topologi för flödet av DSR oavsett om flytande IP är aktiverat eller inte.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="9cbfc-222">Det innebär att hello utgående en del av ett flöde alltid korrekt omskrivet tooflow direkt tillbaka toohello ursprung.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-222">This means that hello outbound part of a flow is always correctly rewritten tooflow directly back toohello origin.</span></span>

<span data-ttu-id="9cbfc-223">Med regeltypen för hello standard exponerar Azure en traditionell IP-adress mappning schema för användarvänlighet för belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-223">With hello default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="9cbfc-224">Aktivera flytande IP ändrar hello adressmappning schemat tooallow för ytterligare flexibilitet som beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-224">Enabling Floating IP changes hello IP address mapping scheme tooallow for additional flexibility as explained below.</span></span>

<span data-ttu-id="9cbfc-225">hello följande diagram visar den här konfigurationen:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-225">hello following diagram illustrates this configuration:</span></span>

![MultiVIP-bild](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="9cbfc-227">I det här scenariot har varje virtuell dator i serverdelspoolen hello tre nätverksgränssnitt:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-227">For this scenario, every VM in hello backend pool has three network interfaces:</span></span>

* <span data-ttu-id="9cbfc-228">DIP: ett virtuellt nätverkskort som är associerade med hello VM (IP-konfiguration av Azures NIC resurs)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-228">DIP: a Virtual NIC associated with hello VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="9cbfc-229">VIP1: en loopback-gränssnittet i gästoperativsystemet som är konfigurerade med IP-adressen för VIP1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="9cbfc-230">VIP2: en loopback-gränssnittet i gästoperativsystemet som är konfigurerade med IP-adressen för VIP2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9cbfc-231">hello konfigurationen av hello logiska gränssnitt utförs inom hello gästoperativsystemet.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-231">hello configuration of hello logical interfaces is performed within hello guest OS.</span></span> <span data-ttu-id="9cbfc-232">Den här konfigurationen är inte utföras eller som hanteras av Azure.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="9cbfc-233">Utan den här konfigurationen fungerar inte hello regler.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-233">Without this configuration, hello rules will not function.</span></span> <span data-ttu-id="9cbfc-234">Hälsotillstånd avsökningen definitioner använda hello DIP av hello VM i stället för hello logiska VIP.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-234">Health probe definitions use hello DIP of hello VM rather than hello logical VIP.</span></span> <span data-ttu-id="9cbfc-235">Din tjänst måste därför ange avsökningen svar på en DIP-port som visar hello status för hello-tjänst som erbjuds för hello logiska VIP.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-235">Therefore, your service must provide probe responses on a DIP port that reflect hello status of hello service offered on hello logical VIP.</span></span>

<span data-ttu-id="9cbfc-236">Vi antar hello samma frontend-konfiguration som tidigare hello:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-236">Let's assume hello same frontend configuration as in hello previous scenario:</span></span>

| <span data-ttu-id="9cbfc-237">VIP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-237">VIP</span></span> | <span data-ttu-id="9cbfc-238">IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-238">IP address</span></span> | <span data-ttu-id="9cbfc-239">Protokollet</span><span class="sxs-lookup"><span data-stu-id="9cbfc-239">protocol</span></span> | <span data-ttu-id="9cbfc-240">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-240">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-242">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-242">1</span></span> |<span data-ttu-id="9cbfc-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-243">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-244">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-244">TCP</span></span> |<span data-ttu-id="9cbfc-245">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-245">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-247">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-247">2</span></span> |<span data-ttu-id="9cbfc-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="9cbfc-248">*65.52.0.2*</span></span> |<span data-ttu-id="9cbfc-249">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-249">TCP</span></span> |<span data-ttu-id="9cbfc-250">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-250">80</span></span> |

<span data-ttu-id="9cbfc-251">Vi definierar två regler:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-251">We define two rules:</span></span>

| <span data-ttu-id="9cbfc-252">Regel</span><span class="sxs-lookup"><span data-stu-id="9cbfc-252">Rule</span></span> | <span data-ttu-id="9cbfc-253">Mappa klientdel</span><span class="sxs-lookup"><span data-stu-id="9cbfc-253">Map frontend</span></span> | <span data-ttu-id="9cbfc-254">toobackend pool</span><span class="sxs-lookup"><span data-stu-id="9cbfc-254">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9cbfc-255">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-255">1</span></span> |![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-257">VIP1:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-259">VIP1:80 (i VM1 och VM2)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="9cbfc-260">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-260">2</span></span> |![Regeln](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-262">VIP2:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-264">VIP2:80 (i VM1 och VM2)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="9cbfc-265">hello följande tabell visar hello fullständig mappning i hello belastningsutjämnare:</span><span class="sxs-lookup"><span data-stu-id="9cbfc-265">hello following table shows hello complete mapping in hello load balancer:</span></span>

| <span data-ttu-id="9cbfc-266">Regel</span><span class="sxs-lookup"><span data-stu-id="9cbfc-266">Rule</span></span> | <span data-ttu-id="9cbfc-267">VIP-IP-adress</span><span class="sxs-lookup"><span data-stu-id="9cbfc-267">VIP IP address</span></span> | <span data-ttu-id="9cbfc-268">Protokollet</span><span class="sxs-lookup"><span data-stu-id="9cbfc-268">protocol</span></span> | <span data-ttu-id="9cbfc-269">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-269">port</span></span> | <span data-ttu-id="9cbfc-270">Mål</span><span class="sxs-lookup"><span data-stu-id="9cbfc-270">Destination</span></span> | <span data-ttu-id="9cbfc-271">port</span><span class="sxs-lookup"><span data-stu-id="9cbfc-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="9cbfc-273">1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-273">1</span></span> |<span data-ttu-id="9cbfc-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="9cbfc-274">65.52.0.1</span></span> |<span data-ttu-id="9cbfc-275">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-275">TCP</span></span> |<span data-ttu-id="9cbfc-276">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-276">80</span></span> |<span data-ttu-id="9cbfc-277">samma som VIP (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="9cbfc-278">samma som VIP (80)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-278">same as VIP (80)</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="9cbfc-280">2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-280">2</span></span> |<span data-ttu-id="9cbfc-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="9cbfc-281">65.52.0.2</span></span> |<span data-ttu-id="9cbfc-282">TCP</span><span class="sxs-lookup"><span data-stu-id="9cbfc-282">TCP</span></span> |<span data-ttu-id="9cbfc-283">80</span><span class="sxs-lookup"><span data-stu-id="9cbfc-283">80</span></span> |<span data-ttu-id="9cbfc-284">samma som VIP (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="9cbfc-285">samma som VIP (80)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-285">same as VIP (80)</span></span> |

<span data-ttu-id="9cbfc-286">hello mål av hello inkommande flödet är hello VIP-adressen på hello loopback-gränssnittet i hello VM.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-286">hello destination of hello inbound flow is hello VIP address on hello loopback interface in hello VM.</span></span> <span data-ttu-id="9cbfc-287">Varje regel måste generera ett flöde med en unik kombination av IP-adress och målport.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="9cbfc-288">Genom att variera hello målets IP-adress i hello flöde, port återanvändning är möjligt på hello samma virtuella dator.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-288">By varying hello destination IP address of hello flow, port reuse is possible on hello same VM.</span></span> <span data-ttu-id="9cbfc-289">Tjänsten är utsatta toohello belastningsutjämnaren genom att binda den toohello VIPS IP-adressen och porten för hello respektive loopback-gränssnitt.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-289">Your service is exposed toohello load balancer by binding it toohello VIP’s IP address and port of hello respective loopback interface.</span></span>

<span data-ttu-id="9cbfc-290">Observera att det här exemplet inte ändrar hello målport.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-290">Notice that this example does not change hello destination port.</span></span> <span data-ttu-id="9cbfc-291">Även om det är ett flytande IP-scenario stöder Azure belastningsutjämnare också definiera ett mål för regel toorewrite hello serverdelsport och toomake den skiljer sig från hello frontend-målport.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule toorewrite hello backend destination port and toomake it different from hello frontend destination port.</span></span>

<span data-ttu-id="9cbfc-292">hello regeltyp flytande IP är hello grunden för flera belastningsutjämnare configuration belastningsmönster.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-292">hello Floating IP rule type is hello foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="9cbfc-293">Ett exempel som är tillgänglig för närvarande är hello [SQL AlwaysOn med flera lyssnare](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) konfiguration.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-293">One example that is currently available is hello [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="9cbfc-294">Över tiden, kommer vi dokumentera flera av dessa scenarier.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="9cbfc-295">Begränsningar</span><span class="sxs-lookup"><span data-stu-id="9cbfc-295">Limitations</span></span>

* <span data-ttu-id="9cbfc-296">Konfigurationer med flera VIP stöds bara med IaaS-VM.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="9cbfc-297">Programmet måste använda hello DIP för utgående flöden med hello flytande IP-regel.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-297">With hello Floating IP rule, your application must use hello DIP for outbound flows.</span></span> <span data-ttu-id="9cbfc-298">Om programmet Binder toohello VIP-adressen konfigurerad på hello loopback-gränssnittet i hello gäst-OS, sedan SNAT är inte tillgängliga toorewrite hello utgående flödet och hello flödet misslyckas.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-298">If your application binds toohello VIP address configured on hello loopback interface in hello guest OS, then SNAT is not available toorewrite hello outbound flow and hello flow fails.</span></span>
* <span data-ttu-id="9cbfc-299">Offentliga IP-adresser påverka faktureringen.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="9cbfc-300">Mer information finns i [priser för IP-adress](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="9cbfc-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="9cbfc-301">Prenumerationsbegränsningar gäller.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-301">Subscription limits apply.</span></span> <span data-ttu-id="9cbfc-302">Mer information finns i [gränser](../azure-subscription-service-limits.md#networking-limits) mer information.</span><span class="sxs-lookup"><span data-stu-id="9cbfc-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
