---
title: "aaaLoad belastningsutjämnaren anpassade avsökningar och övervakning hälsostatus | Microsoft Docs"
description: "Lär dig hur toouse anpassade avsökningar för Azure belastningsutjämnare toomonitor instanser bakom belastningsutjämnaren"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="48e9d-103">Förstå avsökningar av belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="48e9d-103">Understand load balancer probes</span></span>

<span data-ttu-id="48e9d-104">Azure belastningsutjämnare erbjuder hello kapaciteten toomonitor hello hälsotillståndet för server-instanser med avsökningar.</span><span class="sxs-lookup"><span data-stu-id="48e9d-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="48e9d-105">När en avsökning misslyckas toorespond belastningsutjämnaren slutar att skicka nya anslutningar toohello ohälsosamt instansen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="48e9d-106">hello befintliga anslutningar påverkas inte och nya anslutningar skickas toohealthy instanser.</span><span class="sxs-lookup"><span data-stu-id="48e9d-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="48e9d-107">Molntjänstroller (arbetsroller och webbroller) kan du använda gästagent för avsökning övervakning.</span><span class="sxs-lookup"><span data-stu-id="48e9d-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="48e9d-108">Anpassade TCP eller HTTP-avsökningar måste konfigureras när du använder virtuella datorer bakom belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="48e9d-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="48e9d-109">Förstå avsökningen antal och timeout</span><span class="sxs-lookup"><span data-stu-id="48e9d-109">Understand probe count and timeout</span></span>

<span data-ttu-id="48e9d-110">Avsökningen beteende beror på:</span><span class="sxs-lookup"><span data-stu-id="48e9d-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="48e9d-111">hello antalet lyckade avsökningar som gör att en instans toobe etiketter som upp.</span><span class="sxs-lookup"><span data-stu-id="48e9d-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="48e9d-112">hello antal misslyckade avsökningar som orsakar en instans toobe etiketter som inaktiv.</span><span class="sxs-lookup"><span data-stu-id="48e9d-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="48e9d-113">hello timeout och frekvens värdet i SuccessFailCount avgöra om en instans är bekräftade toobe körs eller inte körs.</span><span class="sxs-lookup"><span data-stu-id="48e9d-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="48e9d-114">I hello Azure-portalen, är hello timeout värdet tootwo gånger hello hello frekvens.</span><span class="sxs-lookup"><span data-stu-id="48e9d-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="48e9d-115">hello avsökningen konfigurationen av alla instanser för belastningsutjämning för en slutpunkt (det vill säga en belastningsutjämnad uppsättning) måste vara hello samma.</span><span class="sxs-lookup"><span data-stu-id="48e9d-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="48e9d-116">Det innebär att du inte kan ha en annan avsökningen konfiguration för varje instans av serverroll eller virtuell dator i hello samma värdtjänsten för en viss slutpunkt-kombination.</span><span class="sxs-lookup"><span data-stu-id="48e9d-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="48e9d-117">Varje instans måste till exempel ha identiska lokala portar och timeout.</span><span class="sxs-lookup"><span data-stu-id="48e9d-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="48e9d-118">En belastningsutjämnare avsökning använder hello IP-adressen 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="48e9d-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="48e9d-119">Den här offentliga IP-adressen underlättar kommunikationen toointernal plattform resurser för hello bring-your-äger-IP-scenariot Azure virtuella.</span><span class="sxs-lookup"><span data-stu-id="48e9d-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="48e9d-120">hello virtuella offentliga IP-adressen 168.63.129.16 används i alla regioner och ändras inte.</span><span class="sxs-lookup"><span data-stu-id="48e9d-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="48e9d-121">Vi rekommenderar att du IP-adressen i alla lokala Brandväggsprinciper.</span><span class="sxs-lookup"><span data-stu-id="48e9d-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="48e9d-122">Det bör inte anses en säkerhetsrisk eftersom endast hello intern Azure-plattformen kan styra ett meddelande från den adressen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="48e9d-123">Om du inte gör detta är oväntade resultat i en mängd olika scenarier som konfigurerar hello samma IP-adressintervall för 168.63.129.16 och har dubblerats IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="48e9d-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="48e9d-124">Lär dig mer om hello typer av avsökningar</span><span class="sxs-lookup"><span data-stu-id="48e9d-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="48e9d-125">Gästen agent avsökning</span><span class="sxs-lookup"><span data-stu-id="48e9d-125">Guest agent probe</span></span>

<span data-ttu-id="48e9d-126">Den här avsökningen är endast tillgängligt för Azure-molntjänster.</span><span class="sxs-lookup"><span data-stu-id="48e9d-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="48e9d-127">Belastningsutjämnare använder hello gästagenten i hello virtuella datorn, lyssnar och svarar med ett HTTP-200 OK svar endast när hello-instansen är i tillståndet för hello Ready (det vill säga inte i ett annat tillstånd, till exempel upptagen återvinning eller stoppar).</span><span class="sxs-lookup"><span data-stu-id="48e9d-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="48e9d-128">Mer information finns i [konfigurera hello tjänstdefinitionsfilen (csdef) för hälsoavsökningar](https://msdn.microsoft.com/library/azure/ee758710.aspx) eller [komma igång med en Internetriktade belastningsutjämnare för molntjänster](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="48e9d-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="48e9d-129">Vad gör en gäst agent avsökning Markera en instans som ohälsosamt?</span><span class="sxs-lookup"><span data-stu-id="48e9d-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="48e9d-130">Om hello gästagenten misslyckas toorespond med HTTP 200 OK hello hello belastningen belastningsutjämnaren märken instans som inte svarar och stoppar skickar trafik toothat instans.</span><span class="sxs-lookup"><span data-stu-id="48e9d-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="48e9d-131">hello belastningsutjämnaren fortsätter tooping hello-instans.</span><span class="sxs-lookup"><span data-stu-id="48e9d-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="48e9d-132">Om hello gästagenten svarar med en HTTP-200, skickar hello belastningsutjämnaren trafik toothat instans igen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="48e9d-133">När du använder en webbroll körs hello webbplats koden i w3wp.exe som inte övervakas av hello Azure-strukturen eller gästagenten.</span><span class="sxs-lookup"><span data-stu-id="48e9d-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="48e9d-134">Detta innebär att fel i w3wp.exe (till exempel HTTP 500-svar) inte är rapporterat toohello gästagenten och hello belastningsutjämnaren träder inte i den instansen av rotationen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="48e9d-135">Anpassade HTTP-avsökningen</span><span class="sxs-lookup"><span data-stu-id="48e9d-135">HTTP custom probe</span></span>

<span data-ttu-id="48e9d-136">hello anpassade HTTP-belastningsutjämnaren avsökningen åsidosätter hello standard gäst agent avsökningen, vilket innebär att du kan skapa egna anpassade logik toodetermine hello hälsotillstånd hello rollinstans.</span><span class="sxs-lookup"><span data-stu-id="48e9d-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="48e9d-137">hello belastningsutjämnaren avsökningar slutpunkten var 15: e sekund som standard.</span><span class="sxs-lookup"><span data-stu-id="48e9d-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="48e9d-138">hello instans anses toobe i hello belastningen belastningsutjämnaren rotation om svarar den med en HTTP-200 inom tidsgränsen för hello (31 sekunder som standard).</span><span class="sxs-lookup"><span data-stu-id="48e9d-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="48e9d-139">Detta kan vara användbart om du vill tooimplement egna logik tooremove instanser från belastningen belastningsutjämnaren rotation.</span><span class="sxs-lookup"><span data-stu-id="48e9d-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="48e9d-140">Du kan till exempel bestämma tooremove en instans om det är mer än 90% CPU och returnerar status-200.</span><span class="sxs-lookup"><span data-stu-id="48e9d-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="48e9d-141">Om du har web-roller som använder w3wp.exe detta betyder också att du får automatisk övervakning av din webbplats, eftersom fel i webbplats koden returnerar en icke-200 status toohello belastningsutjämningsavsökning.</span><span class="sxs-lookup"><span data-stu-id="48e9d-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="48e9d-142">anpassade hello HTTP-avsökningen stöder relativa sökvägar och HTTP-protokollet.</span><span class="sxs-lookup"><span data-stu-id="48e9d-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="48e9d-143">HTTPS stöds inte.</span><span class="sxs-lookup"><span data-stu-id="48e9d-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="48e9d-144">Vad gör en anpassad HTTP-avsökningen Markera en instans som ohälsosamt?</span><span class="sxs-lookup"><span data-stu-id="48e9d-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="48e9d-145">hello http-programmet returnerar ett HTTP-svarskoden än 200 (till exempel 403, 404 och 500).</span><span class="sxs-lookup"><span data-stu-id="48e9d-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="48e9d-146">Det här är en positiv bekräftelse som programmet hello instans ska tas bort från tjänsten direkt.</span><span class="sxs-lookup"><span data-stu-id="48e9d-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="48e9d-147">hello HTTP-servern svarar inte på alla efter hello tidsgränsen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="48e9d-148">Beroende på hello timeout-värde som anges detta kan innebära att flera avsökningen begär gå obehandlade innan hello avsökningen hämtar markerad som inte körs (det vill säga innan SuccessFailCount avsökningar skickas).</span><span class="sxs-lookup"><span data-stu-id="48e9d-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="48e9d-149">hello servern stängs hello anslutning via en TCP-återställning.</span><span class="sxs-lookup"><span data-stu-id="48e9d-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="48e9d-150">Anpassade TCP-avsökning</span><span class="sxs-lookup"><span data-stu-id="48e9d-150">TCP custom probe</span></span>

<span data-ttu-id="48e9d-151">TCP-avsökningar initiera en anslutning genom att utföra en trevägs handskakning med hello definierats port.</span><span class="sxs-lookup"><span data-stu-id="48e9d-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="48e9d-152">Vad gör en anpassad TCP-avsökning Markera en instans som ohälsosamt?</span><span class="sxs-lookup"><span data-stu-id="48e9d-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="48e9d-153">hello TCP-servern svarar inte på alla efter hello tidsgränsen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="48e9d-154">När hello avsökning har markerats som inte kör beror på hello antal misslyckade avsökningen begäranden som har konfigurerade toogo obehandlade innan du markerar hello avsökningen som inte körs.</span><span class="sxs-lookup"><span data-stu-id="48e9d-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="48e9d-155">hello avsökningen tar emot en TCP Återställ från hälsningspaket rollinstansen.</span><span class="sxs-lookup"><span data-stu-id="48e9d-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="48e9d-156">Mer information om hur du konfigurerar en HTTP-hälsoavsökningen eller en TCP-avsökning finns [komma igång med att skapa en Internetriktade belastningsutjämnare i Resource Manager med hjälp av PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="48e9d-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="48e9d-157">Lägga till Felfri instanser till belastningen belastningsutjämnaren rotation</span><span class="sxs-lookup"><span data-stu-id="48e9d-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="48e9d-158">TCP- och HTTP-avsökningar betraktas felfritt och markera hello rollinstans som felfri när:</span><span class="sxs-lookup"><span data-stu-id="48e9d-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="48e9d-159">hello belastningsutjämnaren hämtar en positivt avsökningen hello första gången hello VM startar.</span><span class="sxs-lookup"><span data-stu-id="48e9d-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="48e9d-160">hello talet SuccessFailCount (beskrivs ovan) anger hello värdet för lyckad avsökningar som är nödvändiga toomark hello rollinstans som felfritt.</span><span class="sxs-lookup"><span data-stu-id="48e9d-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="48e9d-161">Om en rollinstans har tagits bort, måste hello antal lyckades, efterföljande avsökningar lika med eller överstiger hello värdet för SuccessFailCount toomark hello-rollinstans som körs.</span><span class="sxs-lookup"><span data-stu-id="48e9d-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="48e9d-162">Om hello hälsotillståndet för en rollinstans fluktuerar, väntar hello belastningsutjämnaren längre innan du sätter hälsningspaket rollinstansen tillbaka i hello felfritt tillstånd.</span><span class="sxs-lookup"><span data-stu-id="48e9d-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="48e9d-163">Detta görs via principen tooprotect hello användar- och hello infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="48e9d-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="48e9d-164">Använd logganalys för belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="48e9d-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="48e9d-165">Du kan använda [logga analytics för belastningsutjämnaren](load-balancer-monitor-log.md) toocheck hello avsökningen hälsa status och avsökning antal.</span><span class="sxs-lookup"><span data-stu-id="48e9d-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="48e9d-166">Loggning kan användas med Power BI eller Azure-åtgärdsinformationen tooprovide statistik om hälsostatus för belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="48e9d-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>
