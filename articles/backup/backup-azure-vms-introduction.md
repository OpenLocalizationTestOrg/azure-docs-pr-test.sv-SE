---
title: "Planera din infrastruktur för VM-säkerhetskopiering i Azure | Microsoft Docs"
description: "Viktiga överväganden när du planerar att säkerhetskopiera virtuella datorer i Azure"
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: "Säkerhetskopiera virtuella datorer, säkerhetskopiera virtuella datorer"
ms.assetid: 19d2cf82-1f60-43e1-b089-9238042887a9
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/18/2017
ms.author: markgal;trinadhk
ms.openlocfilehash: 0c930c7413b24a811707c3a1ff3d7d70585bc528
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="plan-your-vm-backup-infrastructure-in-azure"></a><span data-ttu-id="7f65f-104">Planera din infrastruktur för VM-säkerhetskopiering i Azure</span><span class="sxs-lookup"><span data-stu-id="7f65f-104">Plan your VM backup infrastructure in Azure</span></span>
<span data-ttu-id="7f65f-105">Den här artikeln innehåller prestanda och resursen förslag på hur du planerar din infrastruktur för säkerhetskopiering av VM.</span><span class="sxs-lookup"><span data-stu-id="7f65f-105">This article provides performance and resource suggestions to help you plan your VM backup infrastructure.</span></span> <span data-ttu-id="7f65f-106">Den definierar även viktiga aspekter av säkerhetskopieringstjänsten; dessa aspekter kan vara avgörande för att fastställa din arkitektur kapacitetsplanering och schemaläggning.</span><span class="sxs-lookup"><span data-stu-id="7f65f-106">It also defines key aspects of the Backup service; these aspects can be critical in determining your architecture, capacity planning, and scheduling.</span></span> <span data-ttu-id="7f65f-107">Om du har [förbereda din miljö](backup-azure-vms-prepare.md), planering är nästa steg innan du börjar [att säkerhetskopiera virtuella datorer](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="7f65f-107">If you've [prepared your environment](backup-azure-vms-prepare.md), planning is the next step before you begin [to back up VMs](backup-azure-vms.md).</span></span> <span data-ttu-id="7f65f-108">Om du behöver mer information om virtuella Azure-datorer finns i [virtuella datorer dokumentationen](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="7f65f-108">If you need more information about Azure virtual machines, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="how-does-azure-back-up-virtual-machines"></a><span data-ttu-id="7f65f-109">Hur fungerar Azure säkerhetskopiera virtuella datorer?</span><span class="sxs-lookup"><span data-stu-id="7f65f-109">How does Azure back up virtual machines?</span></span>
<span data-ttu-id="7f65f-110">När tjänsten Azure Backup initierar en säkerhetskopiering på den schemalagda tiden, utlöser reservanknytning för att ta en ögonblicksbild i tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-110">When the Azure Backup service initiates a backup job at the scheduled time, it triggers the backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="7f65f-111">Azure Backup-tjänsten används den _VMSnapshot_ tillägget i Windows, och _VMSnapshotLinux_ tillägget Linux.</span><span class="sxs-lookup"><span data-stu-id="7f65f-111">The Azure Backup service uses the _VMSnapshot_ extension in Windows, and the _VMSnapshotLinux_ extension in Linux.</span></span> <span data-ttu-id="7f65f-112">Tillägget installeras under den första säkerhetskopieringen.</span><span class="sxs-lookup"><span data-stu-id="7f65f-112">The extension is installed during the first VM backup.</span></span> <span data-ttu-id="7f65f-113">Om du vill installera tillägget måste du köra den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="7f65f-113">To install the extension, the VM must be running.</span></span> <span data-ttu-id="7f65f-114">Om inte den virtuella datorn körs, tar en ögonblicksbild av det underliggande lagringsutrymmet i Backup-tjänsten (eftersom inga program skrivningar inträffar när den virtuella datorn stoppas).</span><span class="sxs-lookup"><span data-stu-id="7f65f-114">If the VM is not running, the Backup service takes a snapshot of the underlying storage (since no application writes occur while the VM is stopped).</span></span>

<span data-ttu-id="7f65f-115">När en ögonblicksbild av virtuella Windows-datorer, samordnar Backup-tjänsten med Volume Shadow Copy Service (VSS) att hämta en programkonsekvent ögonblicksbild av den virtuella datorns diskar.</span><span class="sxs-lookup"><span data-stu-id="7f65f-115">When taking a snapshot of Windows VMs, the Backup service coordinates with the Volume Shadow Copy Service (VSS) to get a consistent snapshot of the virtual machine's disks.</span></span> <span data-ttu-id="7f65f-116">Om du säkerhetskopierar virtuella Linux-datorer, kan du skriva egna skript för att säkerställa konsekvens när en VM-ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="7f65f-116">If you're backing up Linux VMs, you can write your own custom scripts to ensure consistency when taking a VM snapshot.</span></span> <span data-ttu-id="7f65f-117">Information om att aktivera dessa skript finns senare i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="7f65f-117">Details on invoking these scripts are provided later in this article.</span></span>

<span data-ttu-id="7f65f-118">När Azure Backup-tjänsten tar ögonblicksbilden kan överföra data till valvet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-118">Once the Azure Backup service takes the snapshot, the data is transferred to the vault.</span></span> <span data-ttu-id="7f65f-119">För att maximera effektiviteten, tjänsten identifierar och överför endast block av data som har ändrats sedan den tidigare säkerhetskopian.</span><span class="sxs-lookup"><span data-stu-id="7f65f-119">To maximize efficiency, the service identifies and transfers only the blocks of data that have changed since the previous backup.</span></span>

![Arkitektur för virtuell dator i Azure-säkerhetskopiering](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

<span data-ttu-id="7f65f-121">När dataöverföringen har slutförts ögonblicksbilden tas bort och skapa en återställningspunkt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-121">When the data transfer is complete, the snapshot is removed and a recovery point is created.</span></span>

> [!NOTE]
> 1. <span data-ttu-id="7f65f-122">Under säkerhetskopieringen innehåller Azure Backup inte den tillfälliga disk som är ansluten till den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="7f65f-122">During the backup process, Azure Backup doesn't include the temporary disk attached to the virtual machine.</span></span> <span data-ttu-id="7f65f-123">Mer information finns i bloggen på [tillfällig lagring](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="7f65f-123">For more information, see the blog on [temporary storage](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span></span>
> 2. <span data-ttu-id="7f65f-124">Eftersom Azure Backup tar en ögonblicksbild lagringsnivå och överför denna ögonblicksbild till valvet, ändras inte lagringskontonycklarna tills jobbet har slutförts.</span><span class="sxs-lookup"><span data-stu-id="7f65f-124">Since Azure Backup takes a storage-level snapshot and transfers that snapshot to vault, do not change the storage account keys until the backup job finishes.</span></span>
> 3. <span data-ttu-id="7f65f-125">För premium virtuella datorer kan kopiera vi ögonblicksbilden till storage-konto.</span><span class="sxs-lookup"><span data-stu-id="7f65f-125">For premium VMs, we copy the snapshot to storage account.</span></span> <span data-ttu-id="7f65f-126">Detta är att se till att Azure Backup-tjänsten hämtar tillräcklig IOPS för att överföra data till valvet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-126">This is to make sure that Azure Backup service gets sufficient IOPS for transferring data to vault.</span></span> <span data-ttu-id="7f65f-127">Den här ytterligare en kopia av lagring debiteras enligt den virtuella datorn allokerade storleken.</span><span class="sxs-lookup"><span data-stu-id="7f65f-127">This additional copy of storage is charged as per the VM allocated size.</span></span> 
>

### <a name="data-consistency"></a><span data-ttu-id="7f65f-128">Datakonsekvens</span><span class="sxs-lookup"><span data-stu-id="7f65f-128">Data consistency</span></span>
<span data-ttu-id="7f65f-129">Säkerhetskopiera och återställa företag kritiska data komplicerade av att affärskritiska data måste säkerhetskopieras när de program som ger data körs.</span><span class="sxs-lookup"><span data-stu-id="7f65f-129">Backing up and restoring business critical data is complicated by the fact that business critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="7f65f-130">För att lösa det Azure Backup har stöd för programkonsekvent säkerhetskopiering för både Windows- och Linux virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="7f65f-130">To address this, Azure Backup supports application-consistent backups for both Windows and Linux VMs</span></span>
#### <a name="windows-vm"></a><span data-ttu-id="7f65f-131">Windows VM</span><span class="sxs-lookup"><span data-stu-id="7f65f-131">Windows VM</span></span>
<span data-ttu-id="7f65f-132">Azure Backup tar Fullständig VSS-säkerhetskopiering på virtuella Windows-datorer (Läs mer om [Fullständig VSS-säkerhetskopiering](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span><span class="sxs-lookup"><span data-stu-id="7f65f-132">Azure Backup takes VSS full backups on Windows VMs (read more about [VSS full backup](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span></span> <span data-ttu-id="7f65f-133">Följande registernyckel måste anges för den virtuella datorn om du vill aktivera VSS-säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="7f65f-133">To enable VSS copy backups, the following registry key needs to be set on the VM.</span></span>

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```

#### <a name="linux-vms"></a><span data-ttu-id="7f65f-134">Virtuella Linux-datorer</span><span class="sxs-lookup"><span data-stu-id="7f65f-134">Linux VMs</span></span>
<span data-ttu-id="7f65f-135">Azure Backup är ett ramverk för skript.</span><span class="sxs-lookup"><span data-stu-id="7f65f-135">Azure Backup provides a scripting framework.</span></span> <span data-ttu-id="7f65f-136">För att garantera programmets konsekvens när du säkerhetskopierar virtuella Linux-datorer, skapa skript före och efter skript som styr säkerhetskopiering arbetsflödet och miljö.</span><span class="sxs-lookup"><span data-stu-id="7f65f-136">To ensure application consistency when backing up Linux VMs, create custom pre-scripts and post-scripts that control the backup workflow and environment.</span></span> <span data-ttu-id="7f65f-137">Azure-säkerhetskopiering anropar skriptet före innan VM-ögonblicksbild och anropar efter skriptet när jobbet för VM-ögonblicksbild har slutförts.</span><span class="sxs-lookup"><span data-stu-id="7f65f-137">Azure Backup invokes the pre-script before taking the VM snapshot and invokes the post-script once the VM snapshot job completes.</span></span> <span data-ttu-id="7f65f-138">Mer information finns i [programmet konsekvent VM säkerhetskopior med hjälp av skript före och efter skriptet](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="7f65f-138">For more details, see [application consistent VM backups using pre-script and post-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span>
> [!NOTE]
> <span data-ttu-id="7f65f-139">Azure-säkerhetskopiering endast anropar den customer skrivna före och efter skript.</span><span class="sxs-lookup"><span data-stu-id="7f65f-139">Azure Backup only invokes the customer-written pre- and post-scripts.</span></span> <span data-ttu-id="7f65f-140">Om skript före och efter skript köras, markerar Azure Backup återställningspunkten som programmet konsekvent.</span><span class="sxs-lookup"><span data-stu-id="7f65f-140">If the pre-script and post-scripts execute successfully, Azure Backup marks the recovery point as application consistent.</span></span> <span data-ttu-id="7f65f-141">Kunden är slutgiltigt ansvariga för konsekvens för programmet när du använder anpassade skript.</span><span class="sxs-lookup"><span data-stu-id="7f65f-141">However, the customer is ultimately responsible for the application consistency when using custom scripts.</span></span>
>


<span data-ttu-id="7f65f-142">Den här tabellen beskrivs typerna av konsekvens och de villkor som de sker under Azure VM säkerhetskopiera och återställa.</span><span class="sxs-lookup"><span data-stu-id="7f65f-142">This table explains the types of consistency and the conditions that they occur under during Azure VM backup and restore procedures.</span></span>

| <span data-ttu-id="7f65f-143">Konsekvens</span><span class="sxs-lookup"><span data-stu-id="7f65f-143">Consistency</span></span> | <span data-ttu-id="7f65f-144">VSS-baserade</span><span class="sxs-lookup"><span data-stu-id="7f65f-144">VSS-based</span></span> | <span data-ttu-id="7f65f-145">Förklaring och information</span><span class="sxs-lookup"><span data-stu-id="7f65f-145">Explanation and details</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7f65f-146">Programkonsekvens</span><span class="sxs-lookup"><span data-stu-id="7f65f-146">Application consistency</span></span> |<span data-ttu-id="7f65f-147">Ja för Windows</span><span class="sxs-lookup"><span data-stu-id="7f65f-147">Yes for Windows</span></span>|<span data-ttu-id="7f65f-148">Programkonsekvens är idealisk för arbetsbelastningar som det säkerställer att:</span><span class="sxs-lookup"><span data-stu-id="7f65f-148">Application consistency is ideal for workloads as it ensures that:</span></span><ol><li> <span data-ttu-id="7f65f-149">Den virtuella datorn *startar*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-149">The VM *boots up*.</span></span> <li><span data-ttu-id="7f65f-150">Det finns *inte är skadad*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-150">There is *no corruption*.</span></span> <li><span data-ttu-id="7f65f-151">Det finns *ingen dataförlust*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-151">There is *no data loss*.</span></span><li> <span data-ttu-id="7f65f-152">Data är konsekventa till program som använder data, genom att programmet vid tidpunkten för säkerhetskopiering – med hjälp av VSS eller före/post skript.</span><span class="sxs-lookup"><span data-stu-id="7f65f-152">The data is consistent to the application that uses the data, by involving the application at the time of backup--using VSS or pre/post script.</span></span></ol> <li><span data-ttu-id="7f65f-153">*Virtuella Windows-datorer*-mest Microsoft-arbetsbelastningar har VSS-skrivare som gör belastningsspecifikt åtgärder som rör datakonsekvens.</span><span class="sxs-lookup"><span data-stu-id="7f65f-153">*Windows VMs*- Most Microsoft workloads have VSS writers that do workload-specific actions related to data consistency.</span></span> <span data-ttu-id="7f65f-154">Till exempel har Microsoft SQL Server en VSS-skrivare som garanterar att skrivningar till transaktionsloggfilen och databasen utförs korrekt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-154">For example, Microsoft SQL Server has a VSS writer that ensures that the writes to the transaction log file and the database are done correctly.</span></span> <span data-ttu-id="7f65f-155">För Virtuella för Windows Azure-säkerhetskopior om du vill skapa en programkonsekvent återställningspunkt måste säkerhetskopiering tillägget anropa VSS-arbetsflöde och slutför den innan VM-ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="7f65f-155">For Azure Windows VM backups, to create an application-consistent recovery point, the backup extension must invoke the VSS workflow and complete it before taking the VM snapshot.</span></span> <span data-ttu-id="7f65f-156">För en Azure VM-ögonblicksbild vara korrekt VSS-skrivare för alla Virtuella Azure-program måste du slutföra samt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-156">For the Azure VM snapshot to be accurate, the VSS writers of all Azure VM applications must complete as well.</span></span> <span data-ttu-id="7f65f-157">(Läs den [grunderna i VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) och fördjupa dig djupare i information om [hur det fungerar](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span><span class="sxs-lookup"><span data-stu-id="7f65f-157">(Learn the [basics of VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) and dive deep into the details of [how it works](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span></span> </li> <li> <span data-ttu-id="7f65f-158">*Virtuella Linux-datorer*-kunder kan köra [anpassat skript för före och efter skript för att garantera programmets konsekvens](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="7f65f-158">*Linux VMs*- Customers can execute [custom pre-script and post-script to ensure application consistency](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span> </li> |
| <span data-ttu-id="7f65f-159">Filsystemskonsekvens</span><span class="sxs-lookup"><span data-stu-id="7f65f-159">File-system consistency</span></span> |<span data-ttu-id="7f65f-160">Ja – för Windows-baserade datorer</span><span class="sxs-lookup"><span data-stu-id="7f65f-160">Yes - for Windows-based computers</span></span> |<span data-ttu-id="7f65f-161">Det finns två scenarier där återställningspunkt kan vara *konsekvent filsystemet*:</span><span class="sxs-lookup"><span data-stu-id="7f65f-161">There are two scenarios where the recovery point can be *file-system consistent*:</span></span><ul><li><span data-ttu-id="7f65f-162">Säkerhetskopior av virtuella Linux-datorer i Azure, utan Förproduktion-script/efter-script eller om Förproduktion-script/efter-script misslyckades.</span><span class="sxs-lookup"><span data-stu-id="7f65f-162">Backups of Linux VMs in Azure, without pre-script/post-script or if pre-script/post-script failed.</span></span> <li><span data-ttu-id="7f65f-163">VSS-fel vid säkerhetskopiering för virtuella Windows-datorer i Azure.</span><span class="sxs-lookup"><span data-stu-id="7f65f-163">VSS failure during backup for Windows VMs in Azure.</span></span></li></ul> <span data-ttu-id="7f65f-164">I båda dessa fall är det bäst att göra så att:</span><span class="sxs-lookup"><span data-stu-id="7f65f-164">In both these cases, the best that can be done is to ensure that:</span></span> <ol><li> <span data-ttu-id="7f65f-165">Den virtuella datorn *startar*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-165">The VM *boots up*.</span></span> <li><span data-ttu-id="7f65f-166">Det finns *inte är skadad*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-166">There is *no corruption*.</span></span><li><span data-ttu-id="7f65f-167">Det finns *ingen dataförlust*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-167">There is *no data loss*.</span></span></ol> <span data-ttu-id="7f65f-168">Program måste implementera sina egna ”korrigering av” mekanism för återställda data.</span><span class="sxs-lookup"><span data-stu-id="7f65f-168">Applications need to implement their own "fix-up" mechanism on the restored data.</span></span> |
| <span data-ttu-id="7f65f-169">Kraschkonsekvens</span><span class="sxs-lookup"><span data-stu-id="7f65f-169">Crash consistency</span></span> |<span data-ttu-id="7f65f-170">Nej</span><span class="sxs-lookup"><span data-stu-id="7f65f-170">No</span></span> |<span data-ttu-id="7f65f-171">Den här situationen är detsamma som en virtuell dator som har en ”krasch” (via antingen en mjuk eller hård reset).</span><span class="sxs-lookup"><span data-stu-id="7f65f-171">This situation is equivalent to a virtual machine experiencing a "crash" (through either a soft or hard reset).</span></span> <span data-ttu-id="7f65f-172">Kraschkonsekvens inträffar oftast när den virtuella Azure-datorn är avstängd vid tidpunkten för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-172">Crash consistency typically happens when the Azure virtual machine is shut down at the time of backup.</span></span> <span data-ttu-id="7f65f-173">En kraschkonsekvent återställningspunkt ger inga garantier runt konsekvenskontroll av data på lagringsmedium--ur operativsystemet eller programmet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-173">A crash-consistent recovery point provides no guarantees around the consistency of the data on the storage medium--either from the perspective of the operating system or the application.</span></span> <span data-ttu-id="7f65f-174">Endast de data som finns på disken redan vid tidpunkten för säkerhetskopieringen fångas och säkerhetskopieras.</span><span class="sxs-lookup"><span data-stu-id="7f65f-174">Only the data that already exists on the disk at the time of backup is captured and backed up.</span></span> <br/> <br/> <span data-ttu-id="7f65f-175">Det finns inga garantier, vanligtvis, operativsystemet startas, följt av disk-kontrollerar proceduren som chkdsk, åtgärda eventuella skador fel.</span><span class="sxs-lookup"><span data-stu-id="7f65f-175">While there are no guarantees, usually, the operating system boots, followed by disk-checking procedure, like chkdsk, to fix any corruption errors.</span></span> <span data-ttu-id="7f65f-176">Alla data i minnet eller skrivningar som inte har överförts till disken går förlorade.</span><span class="sxs-lookup"><span data-stu-id="7f65f-176">Any in-memory data or writes that have not been transferred to the disk are lost.</span></span> <span data-ttu-id="7f65f-177">Programmet följer vanligen med sin egen verifiering om återställning av data som behöver göras.</span><span class="sxs-lookup"><span data-stu-id="7f65f-177">The application typically follows with its own verification mechanism in case data rollback needs to be done.</span></span> <br><br><span data-ttu-id="7f65f-178">Exempelvis om transaktionsloggen har poster som inte finns i databasen gör sedan databasprogrammet en återställning tills data är konsekventa.</span><span class="sxs-lookup"><span data-stu-id="7f65f-178">As an example, if the transaction log has entries that are not present in the database, then the database software does a rollback until the data is consistent.</span></span> <span data-ttu-id="7f65f-179">När data sprids över flera virtuella diskar (till exempel volymer), ger inga garantier för data i en kraschkonsekvent återställningspunkt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-179">When data is spread across multiple virtual disks (like spanned volumes), a crash-consistent recovery point provides no guarantees for the correctness of the data.</span></span> |

## <a name="performance-and-resource-utilization"></a><span data-ttu-id="7f65f-180">Prestanda och Resursanvändning</span><span class="sxs-lookup"><span data-stu-id="7f65f-180">Performance and resource utilization</span></span>
<span data-ttu-id="7f65f-181">Som säkerhetskopieringsprogram som är distribuerade på plats bör du planera för kapacitet och resursanvändningen behov när du säkerhetskopierar virtuella datorer i Azure.</span><span class="sxs-lookup"><span data-stu-id="7f65f-181">Like backup software that is deployed on-premises, you should plan for capacity and resource utilization needs when backing up VMs in Azure.</span></span> <span data-ttu-id="7f65f-182">Den [Azure Storage begränsar](../azure-subscription-service-limits.md#storage-limits) definiera hur du struktur distribueringar av Virtuella datorer för att få högsta prestanda med minimal påverkan på arbetsbelastningar som körs.</span><span class="sxs-lookup"><span data-stu-id="7f65f-182">The [Azure Storage limits](../azure-subscription-service-limits.md#storage-limits) define how to structure VM deployments to get maximum performance with minimum impact to running workloads.</span></span>

<span data-ttu-id="7f65f-183">När du planerar prestanda vid säkerhetskopiering kan du vara uppmärksam på följande begränsningar i Azure Storage:</span><span class="sxs-lookup"><span data-stu-id="7f65f-183">Pay attention to the following Azure Storage limits when planning backup performance:</span></span>

* <span data-ttu-id="7f65f-184">Maximalt antal utgående per lagringskonto</span><span class="sxs-lookup"><span data-stu-id="7f65f-184">Max egress per storage account</span></span>
* <span data-ttu-id="7f65f-185">Totalt antal förfrågningar per lagringskonto</span><span class="sxs-lookup"><span data-stu-id="7f65f-185">Total request rate per storage account</span></span>

### <a name="storage-account-limits"></a><span data-ttu-id="7f65f-186">Lagringskontogränser</span><span class="sxs-lookup"><span data-stu-id="7f65f-186">Storage account limits</span></span>
<span data-ttu-id="7f65f-187">Säkerhetskopierade data kopieras från ett lagringskonto, lägger till i/o-åtgärder per sekund (IOPS) och utgående trafik (eller genomströmning) mätvärden för lagringskontot.</span><span class="sxs-lookup"><span data-stu-id="7f65f-187">Backup data copied from a storage account, adds to the input/output operations per second (IOPS) and egress (or throughput) metrics of the storage account.</span></span> <span data-ttu-id="7f65f-188">På samma gång förbrukar virtuella datorer också IOPS och genomflöde.</span><span class="sxs-lookup"><span data-stu-id="7f65f-188">At the same time, virtual machines are also consuming IOPS and throughput.</span></span> <span data-ttu-id="7f65f-189">Målet är att säkerställa säkerhetskopierings- och trafik för virtuella datorer som inte överskrider din lagringskontogränser.</span><span class="sxs-lookup"><span data-stu-id="7f65f-189">The goal is to ensure Backup and virtual machine traffic don't exceed your storage account limits.</span></span>

### <a name="number-of-disks"></a><span data-ttu-id="7f65f-190">Antal diskar</span><span class="sxs-lookup"><span data-stu-id="7f65f-190">Number of disks</span></span>
<span data-ttu-id="7f65f-191">Säkerhetskopieringen försöker slutföra ett säkerhetskopieringsjobb så snabbt som möjligt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-191">The backup process tries to complete a backup job as quickly as possible.</span></span> <span data-ttu-id="7f65f-192">På så sätt kan förbrukar den så många resurser som möjligt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-192">In doing so, it consumes as many resources as it can.</span></span> <span data-ttu-id="7f65f-193">Men alla i/o-åtgärder begränsas av den *mål genomströmning för enda Blob*, som har högst 60 MB per sekund.</span><span class="sxs-lookup"><span data-stu-id="7f65f-193">However, all I/O operations are limited by the *Target Throughput for Single Blob*, which has a limit of 60 MB per second.</span></span> <span data-ttu-id="7f65f-194">Säkerhetskopieringen försöker säkerhetskopiera var och en av de Virtuella diskar i ett försök att maximera hastigheten *parallellt*.</span><span class="sxs-lookup"><span data-stu-id="7f65f-194">In an attempt to maximize its speed, the backup process tries to back up each of the VM's disks *in parallel*.</span></span> <span data-ttu-id="7f65f-195">Om en virtuell dator har fyra diskar, försöker tjänsten att säkerhetskopiera alla fyra diskar parallellt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-195">If a VM has four disks, the service attempts to back up all four disks in parallel.</span></span> <span data-ttu-id="7f65f-196">Den **antal diskar** säkerhetskopieras, är den viktigaste faktorn för att fastställa säkerhetskopiering lagringstrafik för kontot.</span><span class="sxs-lookup"><span data-stu-id="7f65f-196">The **number of disks** being backed up, is the most important factor in determining storage account backup traffic.</span></span>

### <a name="backup-schedule"></a><span data-ttu-id="7f65f-197">Schemat för säkerhetskopiering</span><span class="sxs-lookup"><span data-stu-id="7f65f-197">Backup schedule</span></span>
<span data-ttu-id="7f65f-198">Ytterligare en faktor som påverkar prestanda är den **Säkerhetskopieringsschemat**.</span><span class="sxs-lookup"><span data-stu-id="7f65f-198">An additional factor that impacts performance is the **backup schedule**.</span></span> <span data-ttu-id="7f65f-199">Om du konfigurerar principerna så att alla virtuella datorer säkerhetskopieras samtidigt, har du schemalagt en trafik har fastnat.</span><span class="sxs-lookup"><span data-stu-id="7f65f-199">If you configure the policies so all VMs are backed up at the same time, you have scheduled a traffic jam.</span></span> <span data-ttu-id="7f65f-200">Säkerhetskopieringen försöker att säkerhetskopiera alla diskar parallellt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-200">The backup process attempts to back up all disks in parallel.</span></span> <span data-ttu-id="7f65f-201">För att minska säkerhetskopiering trafiken från ett lagringskonto kan du säkerhetskopiera olika virtuella datorer vid olika tidpunkter på dagen, utan överlappande.</span><span class="sxs-lookup"><span data-stu-id="7f65f-201">To reduce the backup traffic from a storage account, back up different VMs at different time of the day, with no overlap.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="7f65f-202">Kapacitetsplanering</span><span class="sxs-lookup"><span data-stu-id="7f65f-202">Capacity planning</span></span>
<span data-ttu-id="7f65f-203">Kombinera faktorerna som tidigare måste du planera för lagringsbehov för användning av kontot.</span><span class="sxs-lookup"><span data-stu-id="7f65f-203">Putting the previous factors together, you need to plan for the storage account usage needs.</span></span> <span data-ttu-id="7f65f-204">Hämta den [VM säkerhetskopiering kapacitetsplanering Excel-kalkylblad](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) att se effekten av disk- och alternativ för schemat för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-204">Download the [VM backup capacity planning Excel spreadsheet](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) to see the impact of your disk and backup schedule choices.</span></span>

### <a name="backup-throughput"></a><span data-ttu-id="7f65f-205">Säkerhetskopiering genomflöde</span><span class="sxs-lookup"><span data-stu-id="7f65f-205">Backup throughput</span></span>
<span data-ttu-id="7f65f-206">För varje disk som ska säkerhetskopieras, Azure Backup läser block på disken och lagrar bara de ändrade data (inkrementell säkerhetskopiering).</span><span class="sxs-lookup"><span data-stu-id="7f65f-206">For each disk being backed up, Azure Backup reads the blocks on the disk and stores only the changed data (incremental backup).</span></span> <span data-ttu-id="7f65f-207">I följande tabell visas genomsnittsvärden för säkerhetskopiering service genomflöde.</span><span class="sxs-lookup"><span data-stu-id="7f65f-207">The following table shows the average Backup service throughput values.</span></span> <span data-ttu-id="7f65f-208">Med följande data kan beräkna du hur lång tid som behövs för att säkerhetskopiera en disk för en given storlek.</span><span class="sxs-lookup"><span data-stu-id="7f65f-208">Using the following data, you can estimate the amount of time needed to back up a disk of a given size.</span></span>

| <span data-ttu-id="7f65f-209">Säkerhetskopieringen</span><span class="sxs-lookup"><span data-stu-id="7f65f-209">Backup operation</span></span> | <span data-ttu-id="7f65f-210">Bästa genomflöde</span><span class="sxs-lookup"><span data-stu-id="7f65f-210">Best-case throughput</span></span> |
| --- | --- |
| <span data-ttu-id="7f65f-211">Den första säkerhetskopieringen</span><span class="sxs-lookup"><span data-stu-id="7f65f-211">Initial backup</span></span> |<span data-ttu-id="7f65f-212">160 Mbit/s</span><span class="sxs-lookup"><span data-stu-id="7f65f-212">160 Mbps</span></span> |
| <span data-ttu-id="7f65f-213">Inkrementell säkerhetskopiering (DR)</span><span class="sxs-lookup"><span data-stu-id="7f65f-213">Incremental backup (DR)</span></span> |<span data-ttu-id="7f65f-214">640 Mbit/s</span><span class="sxs-lookup"><span data-stu-id="7f65f-214">640 Mbps</span></span> <br><br> <span data-ttu-id="7f65f-215">Genomströmning sjunker om de ändrade data (som behöver säkerhetskopieras) är utspridda över disken.</span><span class="sxs-lookup"><span data-stu-id="7f65f-215">Throughput drops significantly if the changed data (that needs to be backed up) is dispersed across the disk.</span></span>|

## <a name="total-vm-backup-time"></a><span data-ttu-id="7f65f-216">Total tid för säkerhetskopiering av VM</span><span class="sxs-lookup"><span data-stu-id="7f65f-216">Total VM backup time</span></span>
<span data-ttu-id="7f65f-217">När säkerhetskopieringen oftast används till att läsa och kopiera data, andra åtgärder att bidra till den totala tiden som krävs för att säkerhetskopiera en virtuell dator:</span><span class="sxs-lookup"><span data-stu-id="7f65f-217">While most of the backup time is spent reading and copying data, other operations contribute to the total time needed to back up a VM:</span></span>

* <span data-ttu-id="7f65f-218">Tid som krävs för att [installera eller uppdatera säkerhetskopiering tillägget](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="7f65f-218">Time needed to [install or update the backup extension](backup-azure-vms.md).</span></span>
* <span data-ttu-id="7f65f-219">Snapshot-tid, vilket är den tid det tar att utlösa en ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="7f65f-219">Snapshot time, which is the time taken to trigger a snapshot.</span></span> <span data-ttu-id="7f65f-220">Ögonblicksbilder utlöses nära schemalagd tid för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-220">Snapshots are triggered close to the scheduled backup time.</span></span>
* <span data-ttu-id="7f65f-221">Kötid.</span><span class="sxs-lookup"><span data-stu-id="7f65f-221">Queue wait time.</span></span> <span data-ttu-id="7f65f-222">Eftersom Backup-tjänsten bearbetar säkerhetskopior från flera kunder, kanske kopiera säkerhetskopierade data från ögonblicksbilden till säkerhetskopiering eller Recovery Services-valvet inte startar omedelbart.</span><span class="sxs-lookup"><span data-stu-id="7f65f-222">Since the Backup service is processing backups from multiple customers, copying backup data from snapshot to the backup or Recovery Services vault might not start immediately.</span></span> <span data-ttu-id="7f65f-223">Läsa i tidpunkter för belastning, Väntetid kan sträcka ut på grund av hur många säkerhetskopior som bearbetas av upp till åtta timmar.</span><span class="sxs-lookup"><span data-stu-id="7f65f-223">In times of peak load, the wait can stretch up to eight hours due to the number of backups being processed.</span></span> <span data-ttu-id="7f65f-224">Total tid för VM-säkerhetskopiering är dock mindre än 24 timmar för principer för daglig säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-224">However, the total VM backup time is less than 24 hours for daily backup policies.</span></span>
* <span data-ttu-id="7f65f-225">Dataöverföringstid, tid som krävs för säkerhetskopieringstjänsten för att beräkna inkrementella ändringar från tidigare säkerhetskopia och överför ändringarna till valvet lagring.</span><span class="sxs-lookup"><span data-stu-id="7f65f-225">Data transfer time, time needed for backup service to compute the incremental changes from previous backup and transfer those changes to vault storage.</span></span>

### <a name="why-am-i-observing-longer12-hours-backup-time"></a><span data-ttu-id="7f65f-226">Varför jag sett longer(>12 hours) Säkerhetskopiera tid?</span><span class="sxs-lookup"><span data-stu-id="7f65f-226">Why am I observing longer(>12 hours) backup time?</span></span>
<span data-ttu-id="7f65f-227">Säkerhetskopiering består av två faser: ta ögonblicksbilder och överföra ögonblicksbilder till valvet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-227">Backup consists of two phases: taking snapshots and transferring the snapshots to the vault.</span></span> <span data-ttu-id="7f65f-228">Backup-tjänsten optimerar för lagring.</span><span class="sxs-lookup"><span data-stu-id="7f65f-228">The Backup service optimizes for storage.</span></span> <span data-ttu-id="7f65f-229">När du överför ögonblicksbilddata till ett valv, överför tjänsten endast inkrementella ändringar från tidigare ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="7f65f-229">When transferring the snapshot data to a vault, the service only transfers incremental changes from the previous snapshot.</span></span>  <span data-ttu-id="7f65f-230">För att fastställa inkrementella ändringar beräknar tjänsten kontrollsumma för blocken.</span><span class="sxs-lookup"><span data-stu-id="7f65f-230">To determine the incremental changes, the service computes the checksum of the blocks.</span></span> <span data-ttu-id="7f65f-231">Om ett block ändras identifieras blocket som ett block ska skickas till valvet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-231">If a block is changed, the block is identified as a block to be sent to the vault.</span></span> <span data-ttu-id="7f65f-232">Sedan ytterligare service flyttar till var och en av de identifiera blocken vill minimera att överföra data.</span><span class="sxs-lookup"><span data-stu-id="7f65f-232">Then the service drills further into each of the identified blocks, looking for opportunities to minimize the data to transfer.</span></span> <span data-ttu-id="7f65f-233">Efter utvärdering av alla ändrade block tjänsten slår samman ändringar och skickar dem till valvet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-233">After evaluating all changed blocks, the service coalesces the changes and sends them to the vault.</span></span> <span data-ttu-id="7f65f-234">I vissa äldre program är liten, fragmenterade skrivningar inte optimalt för lagring.</span><span class="sxs-lookup"><span data-stu-id="7f65f-234">In some legacy applications, small, fragmented writes are not optimal for storage.</span></span> <span data-ttu-id="7f65f-235">Om ögonblicksbilden innehåller många små, fragmenterade skrivningar, använder tjänsten extra tid för bearbetning av data som skrivits av programmen.</span><span class="sxs-lookup"><span data-stu-id="7f65f-235">If the snapshot contains many small, fragmented writes, the service spends additional time processing the data written by the applications.</span></span> <span data-ttu-id="7f65f-236">Den rekommenderade skrivning från Azure, för program som körs på den virtuella datorn är minst 8 KB.</span><span class="sxs-lookup"><span data-stu-id="7f65f-236">The recommended application write block from Azure, for applications running inside the VM, is a minimum of 8 KB.</span></span> <span data-ttu-id="7f65f-237">Om programmet använder ett block med mindre än 8 KB, påverkas Säkerhetskopieringens prestanda.</span><span class="sxs-lookup"><span data-stu-id="7f65f-237">If your application uses a block of less than 8 KB, backup performance is effected.</span></span> <span data-ttu-id="7f65f-238">Hjälp med att aktivera tillämpningsprogrammet för att förbättra prestanda vid säkerhetskopiering, se [justera program för optimala prestanda med Azure storage](../storage/common/storage-premium-storage-performance.md).</span><span class="sxs-lookup"><span data-stu-id="7f65f-238">For help with tuning your application to improve backup performance, see [Tuning applications for optimal performance with Azure storage](../storage/common/storage-premium-storage-performance.md).</span></span> <span data-ttu-id="7f65f-239">Men artikel om säkerhetskopieringsprestanda används Premium storage exempel, gäller riktlinjer som för standardlagring diskar.</span><span class="sxs-lookup"><span data-stu-id="7f65f-239">Though the article on backup performance uses Premium storage examples, the guidance is applicable for Standard storage disks.</span></span>

## <a name="total-restore-time"></a><span data-ttu-id="7f65f-240">Totalt antal återställningstid</span><span class="sxs-lookup"><span data-stu-id="7f65f-240">Total restore time</span></span>
<span data-ttu-id="7f65f-241">En återställningsåtgärd består av två huvudsakliga sub aktiviteter: kopiera data från valvet till det valda kunden storage-kontot och skapa den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="7f65f-241">A restore operation consists of two main sub tasks: Copying data back from the vault to the chosen customer storage account, and creating the virtual machine.</span></span> <span data-ttu-id="7f65f-242">Kopiera data från valvet beror på där säkerhetskopiorna lagras internt i Azure och där kunden storage-konto lagras.</span><span class="sxs-lookup"><span data-stu-id="7f65f-242">Copying data back from the vault depends on where the backups are stored internally in Azure, and where the customer storage account is stored.</span></span> <span data-ttu-id="7f65f-243">Åtgången tid för att kopiera data beror på:</span><span class="sxs-lookup"><span data-stu-id="7f65f-243">Time taken to copy data depends upon:</span></span>
* <span data-ttu-id="7f65f-244">Kötid - eftersom tjänsten bearbetar återställningsjobb från flera kunder samtidigt, restore-begäranden är placeras i en kö.</span><span class="sxs-lookup"><span data-stu-id="7f65f-244">Queue wait time - Since the service processes restore jobs from multiple customers at the same time, restore requests are put in a queue.</span></span>
* <span data-ttu-id="7f65f-245">Kopiera data tid - Data kopieras från valvet till kunden storage-konto.</span><span class="sxs-lookup"><span data-stu-id="7f65f-245">Data copy time - Data is copied from the vault to the customer storage account.</span></span> <span data-ttu-id="7f65f-246">Återställa tiden beror på IOPS och genomströmning Azure Backup-tjänsten hämtar för det valda kunden storage-kontot.</span><span class="sxs-lookup"><span data-stu-id="7f65f-246">Restore time depends on IOPS and throughput Azure Backup service gets on the selected customer storage account.</span></span> <span data-ttu-id="7f65f-247">Välj ett lagringskonto som inte lästs in med andra program skrivningar och läsningar för att minska den kopiera tiden under återställningsprocessen.</span><span class="sxs-lookup"><span data-stu-id="7f65f-247">To reduce the copying time during the restore process, select a storage account not loaded with other application writes and reads.</span></span>

## <a name="best-practices"></a><span data-ttu-id="7f65f-248">Bästa praxis</span><span class="sxs-lookup"><span data-stu-id="7f65f-248">Best practices</span></span>
<span data-ttu-id="7f65f-249">Vi rekommenderar följande dessa metoder när du konfigurerar säkerhetskopieringar för virtuella datorer:</span><span class="sxs-lookup"><span data-stu-id="7f65f-249">We suggest following these practices while configuring backups for virtual machines:</span></span>

* <span data-ttu-id="7f65f-250">Inte schemalägga fler än 10 klassiska virtuella datorer från samma Molntjänsten att säkerhetskopiera på samma gång.</span><span class="sxs-lookup"><span data-stu-id="7f65f-250">Don't schedule more than 10 classic VMs from the same cloud service to back up at the same time.</span></span> <span data-ttu-id="7f65f-251">Om du vill säkerhetskopiera flera virtuella datorer från samma molntjänst är en fristående säkerhetskopiering av en timme.</span><span class="sxs-lookup"><span data-stu-id="7f65f-251">If you want to back up multiple VMs from same cloud service, stagger the backup start times by an hour.</span></span>
* <span data-ttu-id="7f65f-252">Schemalägg inte fler än 40 VMs att säkerhetskopiera på samma gång.</span><span class="sxs-lookup"><span data-stu-id="7f65f-252">Do not schedule more than 40 VMs to back up at the same time.</span></span>
* <span data-ttu-id="7f65f-253">Schemalägga VM säkerhetskopior vid låg belastning.</span><span class="sxs-lookup"><span data-stu-id="7f65f-253">Schedule VM backups during non-peak hours.</span></span> <span data-ttu-id="7f65f-254">Det här sättet Backup-tjänsten använder IOPS för att överföra data från customer storage-konto till valvet.</span><span class="sxs-lookup"><span data-stu-id="7f65f-254">This way the Backup service uses IOPS for transferring data from the customer storage account to the vault.</span></span>
* <span data-ttu-id="7f65f-255">Se till att en principen tillämpas på virtuella datorer som är fördelade på olika lagringskonton.</span><span class="sxs-lookup"><span data-stu-id="7f65f-255">Make sure that a policy is applied on VMs spread across different storage accounts.</span></span> <span data-ttu-id="7f65f-256">Vi rekommenderar högst 20 totala diskar från en enda lagringskonto skyddas av samma schemat för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-256">We suggest no more than 20 total disks from a single storage account be protected by the same backup schedule.</span></span> <span data-ttu-id="7f65f-257">Om du har större än 20 diskar i ett lagringskonto kan sprida dessa virtuella datorer över flera principer för att hämta nödvändiga IOPS under fasen överföring av säkerhetskopieringen.</span><span class="sxs-lookup"><span data-stu-id="7f65f-257">If you have greater than 20 disks in a storage account, spread those VMs across multiple policies to get the required IOPS during the transfer phase of the backup process.</span></span>
* <span data-ttu-id="7f65f-258">Återställ inte en virtuell dator som körs på Premium-lagring till samma lagringskonto.</span><span class="sxs-lookup"><span data-stu-id="7f65f-258">Do not restore a VM running on Premium storage to same storage account.</span></span> <span data-ttu-id="7f65f-259">Om åtgärden återställningsprocessen sammanfaller med säkerhetskopieringen, minskar antalet IOPS som är tillgängliga för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-259">If the restore operation process coincides with the backup operation, it reduces the available IOPS for backup.</span></span>
* <span data-ttu-id="7f65f-260">Se till att lagringskontot att värdar premiumdiskar har minst 50% ledigt utrymme för mellanlagring ögonblicksbild för en lyckad säkerhetskopia för Premium VM-säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-260">For Premium VM backup, ensure that storage account that hosts premium disks has atleast 50% free space for staging snapshot for a successful backup.</span></span> 
* <span data-ttu-id="7f65f-261">Kontrollera att python-version på virtuella Linux-datorer aktiverad för säkerhetskopiering är 2.7</span><span class="sxs-lookup"><span data-stu-id="7f65f-261">Make sure that python version on Linux VMs enabled for backup is 2.7</span></span>

## <a name="data-encryption"></a><span data-ttu-id="7f65f-262">Datakryptering</span><span class="sxs-lookup"><span data-stu-id="7f65f-262">Data encryption</span></span>
<span data-ttu-id="7f65f-263">Azure-säkerhetskopiering Kryptera inte data som en del av säkerhetskopieringen.</span><span class="sxs-lookup"><span data-stu-id="7f65f-263">Azure Backup does not encrypt data as a part of the backup process.</span></span> <span data-ttu-id="7f65f-264">Men du kan kryptera data i den virtuella datorn och säkerhetskopiera skyddade data sömlöst (Läs mer om [säkerhetskopiering av krypterade data](backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="7f65f-264">However, you can encrypt data within the VM and back up the protected data seamlessly (read more about [backup of encrypted data](backup-azure-vms-encryption.md)).</span></span>

## <a name="calculating-the-cost-of-protected-instances"></a><span data-ttu-id="7f65f-265">Beräkna kostnaden för skyddade instanser</span><span class="sxs-lookup"><span data-stu-id="7f65f-265">Calculating the cost of protected instances</span></span>
<span data-ttu-id="7f65f-266">Virtuella Azure-datorer som säkerhetskopieras via Azure Backup är föremål för [priser för Azure Backup](https://azure.microsoft.com/pricing/details/backup/).</span><span class="sxs-lookup"><span data-stu-id="7f65f-266">Azure virtual machines that are backed up through Azure Backup are subject to [Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/).</span></span> <span data-ttu-id="7f65f-267">Skyddade instanser beräkningen baseras på den *faktiska* storlek för den virtuella datorn, vilket är summan av alla data i den virtuella datorn och exklusive ”resurs-disk”.</span><span class="sxs-lookup"><span data-stu-id="7f65f-267">The Protected Instances calculation is based on the *actual* size of the virtual machine, which is the sum of all the data in the virtual machine--excluding the “resource disk.”</span></span>

<span data-ttu-id="7f65f-268">Priser för säkerhetskopiering av virtuella datorer är *inte* baserat på den maximala storleken som stöds för varje datadisk som är ansluten till den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="7f65f-268">Pricing for backing up VMs is *not* based on the maximum supported size for each data disk attached to the virtual machine.</span></span> <span data-ttu-id="7f65f-269">Priser baseras på faktiska data som lagras i datadisk.</span><span class="sxs-lookup"><span data-stu-id="7f65f-269">Pricing is based on the actual data stored in the data disk.</span></span> <span data-ttu-id="7f65f-270">Växeln lagring för säkerhetskopiering är på samma sätt, baserat på mängden data som lagras i Azure Backup, vilket är summan av den faktiska data i varje återställningspunkt.</span><span class="sxs-lookup"><span data-stu-id="7f65f-270">Similarly, the backup storage bill is based on the amount of data that is stored in Azure Backup, which is the sum of the actual data in each recovery point.</span></span>

<span data-ttu-id="7f65f-271">Till exempel ta en Standard A2-storlek virtuell dator med två ytterligare hårddiskar med en maximal storlek på 1 TB.</span><span class="sxs-lookup"><span data-stu-id="7f65f-271">For example, take an A2 Standard-sized virtual machine that has two additional data disks with a maximum size of 1 TB each.</span></span> <span data-ttu-id="7f65f-272">Följande tabell innehåller de faktiska data som lagras på var och en av dessa diskar:</span><span class="sxs-lookup"><span data-stu-id="7f65f-272">The following table gives the actual data stored on each of these disks:</span></span>

| <span data-ttu-id="7f65f-273">Disktyp</span><span class="sxs-lookup"><span data-stu-id="7f65f-273">Disk type</span></span> | <span data-ttu-id="7f65f-274">Maxstorlek</span><span class="sxs-lookup"><span data-stu-id="7f65f-274">Max size</span></span> | <span data-ttu-id="7f65f-275">Faktiska data finns</span><span class="sxs-lookup"><span data-stu-id="7f65f-275">Actual data present</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7f65f-276">Operativsystemdisk</span><span class="sxs-lookup"><span data-stu-id="7f65f-276">Operating system disk</span></span> |<span data-ttu-id="7f65f-277">1 023 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-277">1023 GB</span></span> |<span data-ttu-id="7f65f-278">17 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-278">17 GB</span></span> |
| <span data-ttu-id="7f65f-279">Lokal disk / resurs disk</span><span class="sxs-lookup"><span data-stu-id="7f65f-279">Local disk / Resource disk</span></span> |<span data-ttu-id="7f65f-280">135 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-280">135 GB</span></span> |<span data-ttu-id="7f65f-281">5 GB (ingår inte för säkerhetskopiering)</span><span class="sxs-lookup"><span data-stu-id="7f65f-281">5 GB (not included for backup)</span></span> |
| <span data-ttu-id="7f65f-282">Datadisk 1</span><span class="sxs-lookup"><span data-stu-id="7f65f-282">Data disk 1</span></span> |<span data-ttu-id="7f65f-283">1 023 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-283">1023 GB</span></span> |<span data-ttu-id="7f65f-284">30 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-284">30 GB</span></span> |
| <span data-ttu-id="7f65f-285">Datadisk 2</span><span class="sxs-lookup"><span data-stu-id="7f65f-285">Data disk 2</span></span> |<span data-ttu-id="7f65f-286">1 023 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-286">1023 GB</span></span> |<span data-ttu-id="7f65f-287">0 GB</span><span class="sxs-lookup"><span data-stu-id="7f65f-287">0 GB</span></span> |

<span data-ttu-id="7f65f-288">Den *faktiska* storleken på den virtuella datorn är i det här fallet 17 GB + 30 GB + 0 GB = 47 GB.</span><span class="sxs-lookup"><span data-stu-id="7f65f-288">The *actual* size of the virtual machine in this case is 17 GB + 30 GB + 0 GB = 47 GB.</span></span> <span data-ttu-id="7f65f-289">Den här skyddade instansstorleken (47 GB) blir till grund för den månatliga fakturan.</span><span class="sxs-lookup"><span data-stu-id="7f65f-289">This Protected Instance size (47 GB) becomes the basis for the monthly bill.</span></span> <span data-ttu-id="7f65f-290">När mängden data i den virtuella datorn växer används skyddade instansstorleken för fakturering ändringar därefter.</span><span class="sxs-lookup"><span data-stu-id="7f65f-290">As the amount of data in the virtual machine grows, the Protected Instance size used for billing changes accordingly.</span></span>

<span data-ttu-id="7f65f-291">Faktureringen startar inte förrän den första lycka säkerhetskopieringen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="7f65f-291">Billing does not start until the first successful backup completes.</span></span> <span data-ttu-id="7f65f-292">Nu inleds faktureringen för både lagring och skyddade instanser.</span><span class="sxs-lookup"><span data-stu-id="7f65f-292">At this point, the billing for both Storage and Protected Instances begins.</span></span> <span data-ttu-id="7f65f-293">Fakturering fortsätter så länge det finns *någon säkerhetskopierade data lagras i ett valv* för den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="7f65f-293">Billing continues as long as there is *any backup data stored in a vault* for the virtual machine.</span></span> <span data-ttu-id="7f65f-294">Om du stoppar skydd på den virtuella datorn, men säkerhetskopierade data för virtuella datorer finns i ett valv, fortsätter fakturering.</span><span class="sxs-lookup"><span data-stu-id="7f65f-294">If you stop protection on the virtual machine, but virtual machine backup data exists in a vault, billing continues.</span></span>

<span data-ttu-id="7f65f-295">Faktureringen för en angiven virtuell dator slutar endast om skyddet har stoppats *och* alla säkerhetskopierade data tas bort.</span><span class="sxs-lookup"><span data-stu-id="7f65f-295">Billing for a specified virtual machine stops only if the protection is stopped *and* all backup data is deleted.</span></span> <span data-ttu-id="7f65f-296">När skydd stanna och det finns inga aktiva jobb för säkerhetskopiering, storleken på den senaste lyckade säkerhetskopieringen blir skyddade-instansstorleken används för varje månad.</span><span class="sxs-lookup"><span data-stu-id="7f65f-296">When protection stops and there are no active backup jobs, the size of the last successful VM backup becomes the Protected Instance size used for the monthly bill.</span></span>

## <a name="questions"></a><span data-ttu-id="7f65f-297">Frågor?</span><span class="sxs-lookup"><span data-stu-id="7f65f-297">Questions?</span></span>
<span data-ttu-id="7f65f-298">Om du har frågor eller om du saknar en funktion är du välkommen att [lämna feedback](http://aka.ms/azurebackup_feedback).</span><span class="sxs-lookup"><span data-stu-id="7f65f-298">If you have questions, or if there is any feature that you would like to see included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="7f65f-299">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="7f65f-299">Next steps</span></span>
* [<span data-ttu-id="7f65f-300">Säkerhetskopiera virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="7f65f-300">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="7f65f-301">Hantera säkerhetskopiering av virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="7f65f-301">Manage virtual machine backup</span></span>](backup-azure-manage-vms.md)
* [<span data-ttu-id="7f65f-302">Återställa virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="7f65f-302">Restore virtual machines</span></span>](backup-azure-restore-vms.md)
* [<span data-ttu-id="7f65f-303">Felsökning av problem med backup VM</span><span class="sxs-lookup"><span data-stu-id="7f65f-303">Troubleshoot VM backup issues</span></span>](backup-azure-vms-troubleshoot.md)
