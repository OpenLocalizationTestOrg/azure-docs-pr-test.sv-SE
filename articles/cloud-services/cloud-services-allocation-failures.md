---
title: "aaaTroubleshooting Molntjänsten Allokeringsfel | Microsoft Docs"
description: "Felsök allokeringsfel när du distribuerar Cloud Services i Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="e1bca-103">Felsök allokeringsfel när du distribuerar Cloud Services i Azure</span><span class="sxs-lookup"><span data-stu-id="e1bca-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="e1bca-104">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="e1bca-104">Summary</span></span>
<span data-ttu-id="e1bca-105">När du distribuerar instanser tooa Molntjänsten eller lägga till nya webb eller arbetare rollinstanser allokerar Microsoft Azure beräkningsresurser.</span><span class="sxs-lookup"><span data-stu-id="e1bca-105">When you deploy instances tooa Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="e1bca-106">Ibland kan du få felmeddelanden när du utför dessa åtgärder innan du når hello Azure-prenumerationsbegränsningar.</span><span class="sxs-lookup"><span data-stu-id="e1bca-106">You may occasionally receive errors when performing these operations even before you reach hello Azure subscription limits.</span></span> <span data-ttu-id="e1bca-107">Den här artikeln förklarar hello orsakerna till vissa av hello vanliga Allokeringsfel och föreslår möjliga reparation.</span><span class="sxs-lookup"><span data-stu-id="e1bca-107">This article explains hello causes of some of hello common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="e1bca-108">hello informationen kan också vara användbar när du planerar distributionen av hello-tjänster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-108">hello information may also be useful when you plan hello deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="e1bca-109">Bakgrund – hur allokering fungerar</span><span class="sxs-lookup"><span data-stu-id="e1bca-109">Background – How allocation works</span></span>
<span data-ttu-id="e1bca-110">hello-servrar i Azure-Datacenter partitioneras i kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-110">hello servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="e1bca-111">En ny molnet allokering tjänstbegäran görs i flera kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="e1bca-112">När hello första instansen är distribuerade tooa molntjänst (i Förproduktion eller produktion), som molntjänst hämtar Fäst tooa klustret.</span><span class="sxs-lookup"><span data-stu-id="e1bca-112">When hello first instance is deployed tooa cloud service(in either staging or production), that cloud service gets pinned tooa cluster.</span></span> <span data-ttu-id="e1bca-113">Någon ytterligare distributioner för hello Molntjänsten sker i hello samma kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-113">Any further deployments for hello cloud service will happen in hello same cluster.</span></span> <span data-ttu-id="e1bca-114">I den här artikeln ska vi refererar toothis som ”Fäst tooa cluster”.</span><span class="sxs-lookup"><span data-stu-id="e1bca-114">In this article, we'll refer toothis as "pinned tooa cluster".</span></span> <span data-ttu-id="e1bca-115">Diagram 1 nedan illustrerar hello skiftläget för en normal allokering som görs i flera kluster; Diagram 2 visar hello fallet för en allokering som Fäst tooCluster 2 eftersom som är där hello befintliga Cloud Service CS_1 finns.</span><span class="sxs-lookup"><span data-stu-id="e1bca-115">Diagram 1 below illustrates hello case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates hello case of an allocation that's pinned tooCluster 2 because that's where hello existing Cloud Service CS_1 is hosted.</span></span>

![Allokering av Diagram](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="e1bca-117">Varför Allokeringsfel händer</span><span class="sxs-lookup"><span data-stu-id="e1bca-117">Why allocation failure happens</span></span>
<span data-ttu-id="e1bca-118">När en begäran om minnesallokering är fäst tooa klustret, finns det en högre risken för felaktiga toofind lediga resurser eftersom hello tillgängliga resurspool är begränsad tooa kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-118">When an allocation request is pinned tooa cluster, there's a higher chance of failing toofind free resources since hello available resource pool is limited tooa cluster.</span></span> <span data-ttu-id="e1bca-119">Dessutom misslyckas din begäran även om hello klustret har fri resurs om din begäran om minnesallokering är fäst tooa kluster men hello typ av resurs som du har begärt stöds inte av klustret.</span><span class="sxs-lookup"><span data-stu-id="e1bca-119">Furthermore, if your allocation request is pinned tooa cluster but hello type of resource you requested is not supported by that cluster, your request will fail even if hello cluster has free resource.</span></span> <span data-ttu-id="e1bca-120">Bild 3 nedan visar hello fall där en fast allokering misslyckas eftersom hello endast candidate klustret inte har lediga resurser.</span><span class="sxs-lookup"><span data-stu-id="e1bca-120">Diagram 3 below illustrates hello case where a pinned allocation fails because hello only candidate cluster does not have free resources.</span></span> <span data-ttu-id="e1bca-121">Diagram 4 illustrerar hello fall där en fast allokering misslyckas eftersom hello endast kandidat kluster inte stöder hello begärda VM-storlek, även om hello klustret har frigöra resurser.</span><span class="sxs-lookup"><span data-stu-id="e1bca-121">Diagram 4 illustrates hello case where a pinned allocation fails because hello only candidate cluster does not support hello requested VM size, even though hello cluster has free resources.</span></span>

![Fäst Allokeringsfel](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="e1bca-123">Felsök tilldelningsproblem för molntjänster</span><span class="sxs-lookup"><span data-stu-id="e1bca-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="e1bca-124">Felmeddelande</span><span class="sxs-lookup"><span data-stu-id="e1bca-124">Error Message</span></span>
<span data-ttu-id="e1bca-125">Du kan se hello följande felmeddelande:</span><span class="sxs-lookup"><span data-stu-id="e1bca-125">You may see hello following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a><span data-ttu-id="e1bca-126">Vanliga problem</span><span class="sxs-lookup"><span data-stu-id="e1bca-126">Common Issues</span></span>
<span data-ttu-id="e1bca-127">Här följer hello vanliga allokering scenarier som orsakar en allokering begäran toobe Fäst tooa kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-127">Here are hello common allocation scenarios that cause an allocation request toobe pinned tooa single cluster.</span></span>

* <span data-ttu-id="e1bca-128">Distribuerar tooStaging fack - en molnbaserad tjänst har en distribution på antingen platsen, sedan hello hela molntjänst är fäst tooa specifikt kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-128">Deploying tooStaging Slot - If a cloud service has a deployment in either slot, then hello entire cloud service is pinned tooa specific cluster.</span></span>  <span data-ttu-id="e1bca-129">Det innebär att om en distribution som redan finns i hello produktionsplatsen sedan en ny fristående distribution kan endast allokeras i samma kluster som hello produktionsplatsen hello.</span><span class="sxs-lookup"><span data-stu-id="e1bca-129">This means that if a deployment already exists in hello production slot, then a new staging deployment can only be allocated in hello same cluster as hello production slot.</span></span> <span data-ttu-id="e1bca-130">Om klustret hello närmar sig kapacitetsgränsen, kan hello förfrågan misslyckas.</span><span class="sxs-lookup"><span data-stu-id="e1bca-130">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="e1bca-131">Skalning – att lägga till nya instanser tooan befintlig molntjänst måste tilldelas i hello samma kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-131">Scaling - Adding new instances tooan existing cloud service must allocate in hello same cluster.</span></span>  <span data-ttu-id="e1bca-132">Liten skala begäranden kan vanligen allokeras, men inte alltid.</span><span class="sxs-lookup"><span data-stu-id="e1bca-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="e1bca-133">Om klustret hello närmar sig kapacitetsgränsen, kan hello förfrågan misslyckas.</span><span class="sxs-lookup"><span data-stu-id="e1bca-133">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="e1bca-134">Tillhörighetsgrupp - en ny distribution tooan tom molntjänst kan allokeras av hello fabric i ett kluster i den regionen, såvida inte hello molntjänst är fäst tooan tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="e1bca-134">Affinity Group - A new deployment tooan empty cloud service can be allocated by hello fabric in any cluster in that region, unless hello cloud service is pinned tooan affinity group.</span></span> <span data-ttu-id="e1bca-135">Distributioner toohello samma tillhörighetsgrupp görs på hello samma kluster.</span><span class="sxs-lookup"><span data-stu-id="e1bca-135">Deployments toohello same affinity group will be attempted on hello same cluster.</span></span> <span data-ttu-id="e1bca-136">Om klustret hello närmar sig kapacitetsgränsen, kan hello förfrågan misslyckas.</span><span class="sxs-lookup"><span data-stu-id="e1bca-136">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="e1bca-137">Tillhörighetsgruppen vNet - äldre virtuella nätverk har bundet tooaffinity grupper i stället för regioner och molntjänster i dessa virtuella nätverk är fäst toohello tillhörighetsgrupp klustret.</span><span class="sxs-lookup"><span data-stu-id="e1bca-137">Affinity Group vNet - Older Virtual Networks were tied tooaffinity groups instead of regions, and cloud services in these Virtual Networks would be pinned toohello affinity group cluster.</span></span> <span data-ttu-id="e1bca-138">Distributioner toothis typen av virtuellt nätverk görs på hello Fäst klustret.</span><span class="sxs-lookup"><span data-stu-id="e1bca-138">Deployments toothis type of virtual network will be attempted on hello pinned cluster.</span></span> <span data-ttu-id="e1bca-139">Om klustret hello närmar sig kapacitetsgränsen, kan hello förfrågan misslyckas.</span><span class="sxs-lookup"><span data-stu-id="e1bca-139">If hello cluster is nearing capacity, hello request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="e1bca-140">Lösningar</span><span class="sxs-lookup"><span data-stu-id="e1bca-140">Solutions</span></span>
1. <span data-ttu-id="e1bca-141">Omdistributionen tooa ny molntjänst - den här lösningen är sannolikt toobe mest framgångsrika som tillåter hello plattform toochoose från alla kluster i den regionen.</span><span class="sxs-lookup"><span data-stu-id="e1bca-141">Redeploy tooa new cloud service - This solution is likely toobe most successful as it allows hello platform toochoose from all clusters in that region.</span></span>

   * <span data-ttu-id="e1bca-142">Distribuera hello arbetsbelastning tooa ny molntjänst</span><span class="sxs-lookup"><span data-stu-id="e1bca-142">Deploy hello workload tooa new cloud service</span></span>  
   * <span data-ttu-id="e1bca-143">Uppdatera hello CNAME-post eller en post toopoint trafik toohello ny molntjänst</span><span class="sxs-lookup"><span data-stu-id="e1bca-143">Update hello CNAME or A record toopoint traffic toohello new cloud service</span></span>
   * <span data-ttu-id="e1bca-144">När noll-trafik skickas toohello gamla platsen, kan du ta bort hello gamla Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="e1bca-144">Once zero traffic is going toohello old site, you can delete hello old cloud service.</span></span> <span data-ttu-id="e1bca-145">Den här lösningen ska innebära ett driftstopp.</span><span class="sxs-lookup"><span data-stu-id="e1bca-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="e1bca-146">Ta bort produktion och mellanlagring platser – den här lösningen kommer att behålla din befintliga DNS-namn, men gör driftstopp tooyour program.</span><span class="sxs-lookup"><span data-stu-id="e1bca-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime tooyour application.</span></span>

   * <span data-ttu-id="e1bca-147">Ta bort hello produktions- och mellanlagring fack för en befintlig molntjänst så att hello molntjänst är tomt, och sedan</span><span class="sxs-lookup"><span data-stu-id="e1bca-147">Delete hello production and staging slots of an existing cloud service so that hello cloud service is empty, and then</span></span>
   * <span data-ttu-id="e1bca-148">Skapa en ny distribution i hello befintlig molntjänst.</span><span class="sxs-lookup"><span data-stu-id="e1bca-148">Create a new deployment in hello existing cloud service.</span></span> <span data-ttu-id="e1bca-149">Tooallocation på alla kluster i hello region försök igen.</span><span class="sxs-lookup"><span data-stu-id="e1bca-149">This will re-attempt tooallocation on all clusters in hello region.</span></span> <span data-ttu-id="e1bca-150">Kontrollera hello Molntjänsten inte bundet tooan tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="e1bca-150">Ensure hello cloud service is not tied tooan affinity group.</span></span>
3. <span data-ttu-id="e1bca-151">Reserverad IP - den här lösningen kommer att behålla din befintliga IP-adress, men gör driftstopp tooyour program.</span><span class="sxs-lookup"><span data-stu-id="e1bca-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime tooyour application.</span></span>  

   * <span data-ttu-id="e1bca-152">Skapa en ReservedIP för den befintliga distributionen med Powershell</span><span class="sxs-lookup"><span data-stu-id="e1bca-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="e1bca-153">Följ #2 ovan och gör att toospecify hello nya ReservedIP i hello tjänsten CSCFG.</span><span class="sxs-lookup"><span data-stu-id="e1bca-153">Follow #2 from above, making sure toospecify hello new ReservedIP in hello service's CSCFG.</span></span>
4. <span data-ttu-id="e1bca-154">Ta bort tillhörighetsgruppen för nya distributioner - Tillhörighetsgrupper rekommenderas inte längre.</span><span class="sxs-lookup"><span data-stu-id="e1bca-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="e1bca-155">Följ stegen för #1 ovan toodeploy en ny molntjänst.</span><span class="sxs-lookup"><span data-stu-id="e1bca-155">Follow steps for #1 above toodeploy a new cloud service.</span></span> <span data-ttu-id="e1bca-156">Kontrollera att Molntjänsten inte har en tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="e1bca-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="e1bca-157">Konvertera tooa regionalt virtuellt nätverk – Se [hur toomigrate från Tillhörighetsgrupper tooa regionalt virtuellt nätverk (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="e1bca-157">Convert tooa Regional Virtual Network - See [How toomigrate from Affinity Groups tooa Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
