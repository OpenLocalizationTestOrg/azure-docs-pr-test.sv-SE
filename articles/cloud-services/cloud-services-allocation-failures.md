---
title: "Felsök problem med Cloud Service tilldelning | Microsoft Docs"
description: "Felsök allokeringsfel när du distribuerar Cloud Services i Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: 3379b6d9bea874abecae7e56d30cfb15e6b0c2fc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="fe8de-103">Felsök allokeringsfel när du distribuerar Cloud Services i Azure</span><span class="sxs-lookup"><span data-stu-id="fe8de-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="fe8de-104">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="fe8de-104">Summary</span></span>
<span data-ttu-id="fe8de-105">När du distribuera instanser till en molnbaserad tjänst eller lägga till nya webb eller arbetare rollinstanser allokerar Microsoft Azure beräkningsresurser.</span><span class="sxs-lookup"><span data-stu-id="fe8de-105">When you deploy instances to a Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="fe8de-106">Ibland kan du få felmeddelanden när du utför dessa åtgärder innan du når Azure-prenumerationsbegränsningar.</span><span class="sxs-lookup"><span data-stu-id="fe8de-106">You may occasionally receive errors when performing these operations even before you reach the Azure subscription limits.</span></span> <span data-ttu-id="fe8de-107">Den här artikeln förklarar orsakerna till några vanliga Allokeringsfel och föreslår möjliga reparation.</span><span class="sxs-lookup"><span data-stu-id="fe8de-107">This article explains the causes of some of the common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="fe8de-108">Informationen kan också vara användbart när du planerar distributionen av dina tjänster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-108">The information may also be useful when you plan the deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="fe8de-109">Bakgrund – hur allokering fungerar</span><span class="sxs-lookup"><span data-stu-id="fe8de-109">Background – How allocation works</span></span>
<span data-ttu-id="fe8de-110">Servrarna i Azure-Datacenter partitioneras i kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-110">The servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="fe8de-111">En ny molnet allokering tjänstbegäran görs i flera kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="fe8de-112">När den första instansen har distribuerats till en tjänst i molnet (i Förproduktion eller produktion), som molntjänst hämtar fäst på ett kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-112">When the first instance is deployed to a cloud service(in either staging or production), that cloud service gets pinned to a cluster.</span></span> <span data-ttu-id="fe8de-113">Alla ytterligare distributioner för Molntjänsten sker i samma kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-113">Any further deployments for the cloud service will happen in the same cluster.</span></span> <span data-ttu-id="fe8de-114">I den här artikeln ska vi refererar till den här som ”fäst på ett kluster”.</span><span class="sxs-lookup"><span data-stu-id="fe8de-114">In this article, we'll refer to this as "pinned to a cluster".</span></span> <span data-ttu-id="fe8de-115">Diagram 1 nedan illustrerar skiftläget för en normal allokering som görs i flera kluster; Figur 2 visar i fallet med en allokering som har fäst på klustret 2 eftersom det är där den befintliga Cloud Service CS_1 finns.</span><span class="sxs-lookup"><span data-stu-id="fe8de-115">Diagram 1 below illustrates the case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates the case of an allocation that's pinned to Cluster 2 because that's where the existing Cloud Service CS_1 is hosted.</span></span>

![Allokering av Diagram](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="fe8de-117">Varför Allokeringsfel händer</span><span class="sxs-lookup"><span data-stu-id="fe8de-117">Why allocation failure happens</span></span>
<span data-ttu-id="fe8de-118">När en begäran om minnesallokering är fäst på ett kluster, finns en högre risk för att hitta lediga resurser eftersom tillgängliga resurspoolen är begränsad till ett kluster inte.</span><span class="sxs-lookup"><span data-stu-id="fe8de-118">When an allocation request is pinned to a cluster, there's a higher chance of failing to find free resources since the available resource pool is limited to a cluster.</span></span> <span data-ttu-id="fe8de-119">Dessutom misslyckas din begäran även om klustret har fri resurs om din begäran om minnesallokering är fäst på ett kluster men typ av resurs som du har begärt stöds inte av klustret.</span><span class="sxs-lookup"><span data-stu-id="fe8de-119">Furthermore, if your allocation request is pinned to a cluster but the type of resource you requested is not supported by that cluster, your request will fail even if the cluster has free resource.</span></span> <span data-ttu-id="fe8de-120">Bild 3 nedan visar de fall där en fast allokering misslyckas eftersom endast candidate klustret inte har lediga resurser.</span><span class="sxs-lookup"><span data-stu-id="fe8de-120">Diagram 3 below illustrates the case where a pinned allocation fails because the only candidate cluster does not have free resources.</span></span> <span data-ttu-id="fe8de-121">Bild 4 visar de fall där en fast allokering misslyckas eftersom endast kandidat kluster inte stöder den begärda VM-storleken, även om klustret har lediga resurser.</span><span class="sxs-lookup"><span data-stu-id="fe8de-121">Diagram 4 illustrates the case where a pinned allocation fails because the only candidate cluster does not support the requested VM size, even though the cluster has free resources.</span></span>

![Fäst Allokeringsfel](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="fe8de-123">Felsök tilldelningsproblem för molntjänster</span><span class="sxs-lookup"><span data-stu-id="fe8de-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="fe8de-124">Felmeddelande</span><span class="sxs-lookup"><span data-stu-id="fe8de-124">Error Message</span></span>
<span data-ttu-id="fe8de-125">Du kan se följande felmeddelande:</span><span class="sxs-lookup"><span data-stu-id="fe8de-125">You may see the following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable to satisfy constraints in request. The requested new service deployment is bound to an Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains the new deployment to specific Azure resources. Please retry later or try reducing the VM size or number of role instances. Alternatively, if possible, remove the aforementioned constraints or try deploying to a different region."

### <a name="common-issues"></a><span data-ttu-id="fe8de-126">Vanliga problem</span><span class="sxs-lookup"><span data-stu-id="fe8de-126">Common Issues</span></span>
<span data-ttu-id="fe8de-127">Här följer vanliga scenarier för allokering som gör en begäran om minnesallokering till fäst på ett enda kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-127">Here are the common allocation scenarios that cause an allocation request to be pinned to a single cluster.</span></span>

* <span data-ttu-id="fe8de-128">Distribuerar till Förproduktion fack - en molnbaserad tjänst har en distribution på antingen platsen, är sedan hela Molntjänsten fäst på ett specifikt kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-128">Deploying to Staging Slot - If a cloud service has a deployment in either slot, then the entire cloud service is pinned to a specific cluster.</span></span>  <span data-ttu-id="fe8de-129">Det innebär att om en distribution som redan finns på produktionsplatsen sedan en ny fristående distribution kan endast allokeras i samma kluster som produktionsplatsen.</span><span class="sxs-lookup"><span data-stu-id="fe8de-129">This means that if a deployment already exists in the production slot, then a new staging deployment can only be allocated in the same cluster as the production slot.</span></span> <span data-ttu-id="fe8de-130">Om klustret närmar sig kapacitetsgränsen, misslyckas begäran.</span><span class="sxs-lookup"><span data-stu-id="fe8de-130">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fe8de-131">Skalning – att lägga till nya instanser i en befintlig molntjänst måste tilldelas i samma kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-131">Scaling - Adding new instances to an existing cloud service must allocate in the same cluster.</span></span>  <span data-ttu-id="fe8de-132">Liten skala begäranden kan vanligen allokeras, men inte alltid.</span><span class="sxs-lookup"><span data-stu-id="fe8de-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="fe8de-133">Om klustret närmar sig kapacitetsgränsen, misslyckas begäran.</span><span class="sxs-lookup"><span data-stu-id="fe8de-133">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fe8de-134">Tillhörighetsgruppen - en ny distribution till en tom molntjänst kan allokeras av infrastrukturresurser i ett kluster i den regionen om Molntjänsten är fäst på en tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="fe8de-134">Affinity Group - A new deployment to an empty cloud service can be allocated by the fabric in any cluster in that region, unless the cloud service is pinned to an affinity group.</span></span> <span data-ttu-id="fe8de-135">Distributioner till samma tillhörighetsgrupp görs på samma kluster.</span><span class="sxs-lookup"><span data-stu-id="fe8de-135">Deployments to the same affinity group will be attempted on the same cluster.</span></span> <span data-ttu-id="fe8de-136">Om klustret närmar sig kapacitetsgränsen, misslyckas begäran.</span><span class="sxs-lookup"><span data-stu-id="fe8de-136">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fe8de-137">Tillhörighetsgruppen vNet - äldre virtuella nätverk har knutna till tillhörighetsgrupper i stället för regioner och molntjänster i dessa virtuella nätverk skulle fäst på klustret tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="fe8de-137">Affinity Group vNet - Older Virtual Networks were tied to affinity groups instead of regions, and cloud services in these Virtual Networks would be pinned to the affinity group cluster.</span></span> <span data-ttu-id="fe8de-138">Distributioner till den här typen av virtuellt nätverk görs på Fäst klustret.</span><span class="sxs-lookup"><span data-stu-id="fe8de-138">Deployments to this type of virtual network will be attempted on the pinned cluster.</span></span> <span data-ttu-id="fe8de-139">Om klustret närmar sig kapacitetsgränsen, misslyckas begäran.</span><span class="sxs-lookup"><span data-stu-id="fe8de-139">If the cluster is nearing capacity, the request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="fe8de-140">Lösningar</span><span class="sxs-lookup"><span data-stu-id="fe8de-140">Solutions</span></span>
1. <span data-ttu-id="fe8de-141">Distribuera till en ny molntjänst – den här lösningen är troligt att de mest framgångsrika som tillåter plattform att välja mellan alla kluster i den regionen.</span><span class="sxs-lookup"><span data-stu-id="fe8de-141">Redeploy to a new cloud service - This solution is likely to be most successful as it allows the platform to choose from all clusters in that region.</span></span>

   * <span data-ttu-id="fe8de-142">Distribuera arbetsbelastningen till en ny molntjänst</span><span class="sxs-lookup"><span data-stu-id="fe8de-142">Deploy the workload to a new cloud service</span></span>  
   * <span data-ttu-id="fe8de-143">Uppdatera CNAME eller en post pekar på ny molntjänst</span><span class="sxs-lookup"><span data-stu-id="fe8de-143">Update the CNAME or A record to point traffic to the new cloud service</span></span>
   * <span data-ttu-id="fe8de-144">När noll trafik ska den gamla platsen, kan du ta bort gamla Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="fe8de-144">Once zero traffic is going to the old site, you can delete the old cloud service.</span></span> <span data-ttu-id="fe8de-145">Den här lösningen ska innebära ett driftstopp.</span><span class="sxs-lookup"><span data-stu-id="fe8de-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="fe8de-146">Ta bort produktion och mellanlagring platser – den här lösningen kommer att behålla din befintliga DNS-namn, men orsakar driftstopp för ditt program.</span><span class="sxs-lookup"><span data-stu-id="fe8de-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime to your application.</span></span>

   * <span data-ttu-id="fe8de-147">Ta bort produktions- och mellanlagring fack för en befintlig molntjänst så att Molntjänsten är tomt, och sedan</span><span class="sxs-lookup"><span data-stu-id="fe8de-147">Delete the production and staging slots of an existing cloud service so that the cloud service is empty, and then</span></span>
   * <span data-ttu-id="fe8de-148">Skapa en ny distribution i en befintlig molntjänst.</span><span class="sxs-lookup"><span data-stu-id="fe8de-148">Create a new deployment in the existing cloud service.</span></span> <span data-ttu-id="fe8de-149">Detta försöker igen allokering på alla kluster i region.</span><span class="sxs-lookup"><span data-stu-id="fe8de-149">This will re-attempt to allocation on all clusters in the region.</span></span> <span data-ttu-id="fe8de-150">Kontrollera att Molntjänsten inte är kopplad till en tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="fe8de-150">Ensure the cloud service is not tied to an affinity group.</span></span>
3. <span data-ttu-id="fe8de-151">Reserverad IP - den här lösningen kommer att behålla din befintliga IP-adress, men orsakar driftstopp för ditt program.</span><span class="sxs-lookup"><span data-stu-id="fe8de-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime to your application.</span></span>  

   * <span data-ttu-id="fe8de-152">Skapa en ReservedIP för den befintliga distributionen med Powershell</span><span class="sxs-lookup"><span data-stu-id="fe8de-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="fe8de-153">Följ #2 ovan och se till att ange den nya ReservedIP i tjänstens CSCFG.</span><span class="sxs-lookup"><span data-stu-id="fe8de-153">Follow #2 from above, making sure to specify the new ReservedIP in the service's CSCFG.</span></span>
4. <span data-ttu-id="fe8de-154">Ta bort tillhörighetsgruppen för nya distributioner - Tillhörighetsgrupper rekommenderas inte längre.</span><span class="sxs-lookup"><span data-stu-id="fe8de-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="fe8de-155">Följ stegen för #1 ovan för att distribuera en ny molntjänst.</span><span class="sxs-lookup"><span data-stu-id="fe8de-155">Follow steps for #1 above to deploy a new cloud service.</span></span> <span data-ttu-id="fe8de-156">Kontrollera att Molntjänsten inte har en tillhörighetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="fe8de-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="fe8de-157">Konvertera till ett regionalt virtuellt nätverk – Se [hur du migrerar från Tillhörighetsgrupper till ett regionalt virtuellt nätverk (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="fe8de-157">Convert to a Regional Virtual Network - See [How to migrate from Affinity Groups to a Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
