---
title: "aaaHandle Molntjänsten Livscykelhändelser | Microsoft Docs"
description: "Lär dig hur hello livscykel metoder för en tjänst i molnet roll kan användas i .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: cc0ccc5f055b965202b6e081a6ab72ad5d39b034
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="customize-hello-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="9ae11-103">Anpassa hello livscykeln för en webb- eller Arbetarroll roll i .NET</span><span class="sxs-lookup"><span data-stu-id="9ae11-103">Customize hello Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="9ae11-104">När du skapar en arbetsroll kan du utöka hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) klassen som innehåller metoder du toooverride som du kan svara toolifecycle händelser.</span><span class="sxs-lookup"><span data-stu-id="9ae11-104">When you create a worker role, you extend hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you toooverride that let you respond toolifecycle events.</span></span> <span data-ttu-id="9ae11-105">Den här klassen är valfritt, för webbroller så måste du använda den toorespond toolifecycle händelser.</span><span class="sxs-lookup"><span data-stu-id="9ae11-105">For web roles this class is optional, so you must use it toorespond toolifecycle events.</span></span>

## <a name="extend-hello-roleentrypoint-class"></a><span data-ttu-id="9ae11-106">Utöka hello RoleEntryPoint klass</span><span class="sxs-lookup"><span data-stu-id="9ae11-106">Extend hello RoleEntryPoint class</span></span>
<span data-ttu-id="9ae11-107">Hej [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) klassen innehåller metoder som anropas av Azure när den **startar**, **kör**, eller **stoppar** rollen webb eller arbetare.</span><span class="sxs-lookup"><span data-stu-id="9ae11-107">hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="9ae11-108">Alternativt kan du åsidosätta dessa metoder toomanage roll initiering, roll avstängning sekvenser eller hello körning tråd hello roll.</span><span class="sxs-lookup"><span data-stu-id="9ae11-108">You can optionally override these methods toomanage role initialization, role shutdown sequences, or hello execution thread of hello role.</span></span> 

<span data-ttu-id="9ae11-109">När du utökar **RoleEntryPoint**, bör du vara medveten om hello följande beteendena hos hello metoder:</span><span class="sxs-lookup"><span data-stu-id="9ae11-109">When extending **RoleEntryPoint**, you should be aware of hello following behaviors of hello methods:</span></span>

* <span data-ttu-id="9ae11-110">Hej [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) och [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) metoder returnerar ett booleskt värde så att det är möjligt tooreturn **FALSKT** från dessa metoder.</span><span class="sxs-lookup"><span data-stu-id="9ae11-110">hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible tooreturn **false** from these methods.</span></span>
  
   <span data-ttu-id="9ae11-111">Om din kod returnerar **FALSKT**hello rollen processen avslutas plötsligt, utan att köra alla stängas ned har på plats.</span><span class="sxs-lookup"><span data-stu-id="9ae11-111">If your code returns **false**, hello role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="9ae11-112">I allmänhet bör du undvika returnerar **FALSKT** från hello **OnStart** metod.</span><span class="sxs-lookup"><span data-stu-id="9ae11-112">In general, you should avoid returning **false** from hello **OnStart** method.</span></span>
* <span data-ttu-id="9ae11-113">Någon utan felhantering undantag inom en överlagring av en **RoleEntryPoint** metoden behandlas som ett ohanterat undantag.</span><span class="sxs-lookup"><span data-stu-id="9ae11-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="9ae11-114">Om ett undantag uppstår inom någon av hello livscykel metoder, Azure höjer hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) händelse, och sedan hello processen avslutas.</span><span class="sxs-lookup"><span data-stu-id="9ae11-114">If an exception occurs within one of hello lifecycle methods, Azure will raise hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then hello process is terminated.</span></span> <span data-ttu-id="9ae11-115">När din roll har varit offline, startas av Azure.</span><span class="sxs-lookup"><span data-stu-id="9ae11-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="9ae11-116">När ett ohanterat undantag inträffar, hello [stoppar](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) händelsen utlöses inte och hello **OnStop** -metoden inte anropas.</span><span class="sxs-lookup"><span data-stu-id="9ae11-116">When an unhandled exception occurs, hello [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and hello **OnStop** method is not called.</span></span>

<span data-ttu-id="9ae11-117">Om din roll inte startar eller återvinning mellan hello initierar, upptagen och stoppa tillstånd kan koden utlöser ett ohanterat undantag i en av hello Livscykelhändelser varje gång hello roll startar om.</span><span class="sxs-lookup"><span data-stu-id="9ae11-117">If your role does not start, or is recycling between hello initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of hello lifecycle events each time hello role restarts.</span></span> <span data-ttu-id="9ae11-118">I det här fallet använder hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) händelse toodetermine hello orsaken till hello undantag och hantera korrekt.</span><span class="sxs-lookup"><span data-stu-id="9ae11-118">In this case, use hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event toodetermine hello cause of hello exception and handle it appropriately.</span></span> <span data-ttu-id="9ae11-119">Din roll kan också returnera från hello [kör](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) metod, vilket gör hello rollen toorestart.</span><span class="sxs-lookup"><span data-stu-id="9ae11-119">Your role may also be returning from hello [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes hello role toorestart.</span></span> <span data-ttu-id="9ae11-120">Mer information om distributionstillstånd finns [vanliga problem som orsakar roller tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="9ae11-120">For more information about deployment states, see [Common Issues Which Cause Roles tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="9ae11-121">Om du använder hello **Azure Tools för Microsoft Visual Studio** toodevelop programmet hello rollen projektmallar Utöka automatiskt hello **RoleEntryPoint** klass, i hello *WebRole.cs* och *WorkerRole.cs* filer.</span><span class="sxs-lookup"><span data-stu-id="9ae11-121">If you are using hello **Azure Tools for Microsoft Visual Studio** toodevelop your application, hello role project templates automatically extend hello **RoleEntryPoint** class for you, in hello *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="9ae11-122">OnStart-metoden</span><span class="sxs-lookup"><span data-stu-id="9ae11-122">OnStart method</span></span>
<span data-ttu-id="9ae11-123">Hej **OnStart** metoden anropas när din rollinstans är online med Azure.</span><span class="sxs-lookup"><span data-stu-id="9ae11-123">hello **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="9ae11-124">Medan hello OnStart koden körs hello-rollinstans som har markerats som **upptagen** och inga externa trafiken kommer att dirigerad tooit som hello belastningsutjämnaren.</span><span class="sxs-lookup"><span data-stu-id="9ae11-124">While hello OnStart code is executing, hello role instance is marked as **Busy** and no external traffic will be directed tooit by hello load balancer.</span></span> <span data-ttu-id="9ae11-125">Du kan åsidosätta den här metoden tooperform initieringsarbete, till exempel implementera händelsehanterare och starta [Azure Diagnostics](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="9ae11-125">You can override this method tooperform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="9ae11-126">Om **OnStart** returnerar **SANT**, hello-instansen har initierats och Azure anropar hello **RoleEntryPoint.Run** metod.</span><span class="sxs-lookup"><span data-stu-id="9ae11-126">If **OnStart** returns **true**, hello instance is successfully initialized and Azure calls hello **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="9ae11-127">Om **OnStart** returnerar **FALSKT**, hello rollen omedelbart, avslutar utan att köra alla planerad avstängning sekvenser.</span><span class="sxs-lookup"><span data-stu-id="9ae11-127">If **OnStart** returns **false**, hello role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="9ae11-128">Hej följande exempel visas hur toooverride hello **OnStart** metod.</span><span class="sxs-lookup"><span data-stu-id="9ae11-128">hello following code example shows how toooverride hello **OnStart** method.</span></span> <span data-ttu-id="9ae11-129">Den här metoden konfigurerar och startar en diagnostikövervakare när hälsningspaket rollinstansen startar och ställer in en överföring av loggning av data tooa storage-konto:</span><span class="sxs-lookup"><span data-stu-id="9ae11-129">This method configures and starts a diagnostic monitor when hello role instance starts and sets up a transfer of logging data tooa storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="9ae11-130">OnStop-metoden</span><span class="sxs-lookup"><span data-stu-id="9ae11-130">OnStop method</span></span>
<span data-ttu-id="9ae11-131">Hej **OnStop** metoden anropas när en rollinstans har varit offline i Azure och hello processen avslutas.</span><span class="sxs-lookup"><span data-stu-id="9ae11-131">hello **OnStop** method is called after a role instance has been taken offline by Azure and before hello process exits.</span></span> <span data-ttu-id="9ae11-132">Du kan åsidosätta den här metoden toocall koden som krävs för din roll instans toocleanly stängas av.</span><span class="sxs-lookup"><span data-stu-id="9ae11-132">You can override this method toocall code required for your role instance toocleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9ae11-133">Kod som körs i hello **OnStop** metoden har en begränsad tid toofinish när den anropas av andra orsaker än användarinitierad avstängning.</span><span class="sxs-lookup"><span data-stu-id="9ae11-133">Code running in hello **OnStop** method has a limited time toofinish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="9ae11-134">Efter den här tiden hello processen avslutas, så måste du se till att koden i hello **OnStop** metod kan köra snabbt eller körs inte toocompletion kan tolerera.</span><span class="sxs-lookup"><span data-stu-id="9ae11-134">After this time elapses, hello process is terminated, so you must make sure that code in hello **OnStop** method can run quickly or tolerates not running toocompletion.</span></span> <span data-ttu-id="9ae11-135">Hej **OnStop** metoden anropas efter hello **stoppar** händelsen inträffar.</span><span class="sxs-lookup"><span data-stu-id="9ae11-135">hello **OnStop** method is called after hello **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="9ae11-136">Metoden Kör</span><span class="sxs-lookup"><span data-stu-id="9ae11-136">Run method</span></span>
<span data-ttu-id="9ae11-137">Du kan åsidosätta hello **kör** metoden tooimplement en tidskrävande tråd för din rollinstans.</span><span class="sxs-lookup"><span data-stu-id="9ae11-137">You can override hello **Run** method tooimplement a long-running thread for your role instance.</span></span>

<span data-ttu-id="9ae11-138">Åsidosätta hello **kör** metoden är inte obligatoriska; hello standardimplementering startar en tråd som alltid i viloläge.</span><span class="sxs-lookup"><span data-stu-id="9ae11-138">Overriding hello **Run** method is not required; hello default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="9ae11-139">Om du åsidosätta hello **kör** metoden koden ska blockera på obestämd tid.</span><span class="sxs-lookup"><span data-stu-id="9ae11-139">If you do override hello **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="9ae11-140">Om hello **kör** metoden returnerar hello rollen återanvänds automatiskt smidigt; med andra ord genererar Azure hello **stoppar** händelse och anrop hello **OnStop** metoden så att stänga-sekvenser kan köras innan hello rollen tas offline.</span><span class="sxs-lookup"><span data-stu-id="9ae11-140">If hello **Run** method returns, hello role is automatically gracefully recycled; in other words, Azure raises hello **Stopping** event and calls hello **OnStop** method so that your shutdown sequences may be executed before hello role is taken offline.</span></span>

### <a name="implementing-hello-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="9ae11-141">Implementera hello ASP.NET livscykel metoder för en webbroll</span><span class="sxs-lookup"><span data-stu-id="9ae11-141">Implementing hello ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="9ae11-142">Du kan använda hello ASP.NET livscykel metoder, förutom toothose som tillhandahålls av hello **RoleEntryPoint** class, toomanage initiering och avstängning sekvenser för en webbroll.</span><span class="sxs-lookup"><span data-stu-id="9ae11-142">You can use hello ASP.NET lifecycle methods, in addition toothose provided by hello **RoleEntryPoint** class, toomanage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="9ae11-143">Detta kan vara användbart för kompatibilitet om du portera tooAzure för en befintlig ASP.NET-program.</span><span class="sxs-lookup"><span data-stu-id="9ae11-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application tooAzure.</span></span> <span data-ttu-id="9ae11-144">hello ASP.NET livscykel metoder anropas från inom hello **RoleEntryPoint** metoder.</span><span class="sxs-lookup"><span data-stu-id="9ae11-144">hello ASP.NET lifecycle methods are called from within hello **RoleEntryPoint** methods.</span></span> <span data-ttu-id="9ae11-145">Hej **programmet\_starta** metoden anropas efter hello **RoleEntryPoint.OnStart** metod har avslutats.</span><span class="sxs-lookup"><span data-stu-id="9ae11-145">hello **Application\_Start** method is called after hello **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="9ae11-146">Hej **programmet\_End** metoden anropas innan hello **RoleEntryPoint.OnStop** metoden anropas.</span><span class="sxs-lookup"><span data-stu-id="9ae11-146">hello **Application\_End** method is called before hello **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9ae11-147">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="9ae11-147">Next steps</span></span>
<span data-ttu-id="9ae11-148">Lär dig hur för[skapa ett paket för cloud service](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="9ae11-148">Learn how too[create a cloud service package](cloud-services-model-and-package.md).</span></span>

