---
title: "Så här uppdaterar du en tjänst i molnet | Microsoft Docs"
description: "Lär dig hur du uppdaterar molntjänster i Azure. Lär dig hur en uppdatering på en tjänst i molnet fortsätter att säkerställa tillgänglighet."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 2ba9676ed2afce7f18446642527971f5001b5ca7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-update-a-cloud-service"></a><span data-ttu-id="d4d82-104">Så här uppdaterar du en tjänst i molnet</span><span class="sxs-lookup"><span data-stu-id="d4d82-104">How to update a cloud service</span></span>

<span data-ttu-id="d4d82-105">Uppdatera en tjänst i molnet, inklusive dess roller och ett operativsystem, är tre steg.</span><span class="sxs-lookup"><span data-stu-id="d4d82-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="d4d82-106">Först måste binärfilerna och konfigurationsfiler för ny molntjänst eller OS-version laddas upp.</span><span class="sxs-lookup"><span data-stu-id="d4d82-106">First, the binaries and configuration files for the new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="d4d82-107">Därefter reserverar Azure beräknings- och nätverksresurser för Molntjänsten baserat på kraven för den nya cloud service-versionen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-107">Next, Azure reserves compute and network resources for the cloud service based on the requirements of the new cloud service version.</span></span> <span data-ttu-id="d4d82-108">Slutligen utför Azure uppgraderingen för att uppdatera inkrementellt klienten till den nya versionen eller operativsystem, samtidigt som din tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="d4d82-108">Finally, Azure performs a rolling upgrade to incrementally update the tenant to the new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="d4d82-109">Den här artikeln beskriver information om det sista steget – uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-109">This article discusses the details of this last step – the rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="d4d82-110">Uppdatera en Azure-tjänst</span><span class="sxs-lookup"><span data-stu-id="d4d82-110">Update an Azure Service</span></span>
<span data-ttu-id="d4d82-111">Azure ordnar dina rollinstanser i logiska grupper kallas uppgraderingsdomäner (UD).</span><span class="sxs-lookup"><span data-stu-id="d4d82-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="d4d82-112">Uppgraderingsdomäner (UD) är en logisk uppsättning rollinstanser som uppdateras som en grupp.</span><span class="sxs-lookup"><span data-stu-id="d4d82-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="d4d82-113">Azure-uppdateringar en cloud service en UD samtidigt, vilket ger instanser i andra UDs fortsätta trafik.</span><span class="sxs-lookup"><span data-stu-id="d4d82-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs to continue serving traffic.</span></span>

<span data-ttu-id="d4d82-114">Standardantalet uppgraderingsdomäner är 5.</span><span class="sxs-lookup"><span data-stu-id="d4d82-114">The default number of upgrade domains is 5.</span></span> <span data-ttu-id="d4d82-115">Du kan ange ett annat antal uppgraderingsdomäner genom att inkludera attributet upgradeDomainCount i definitionsfilen för tjänstens (.csdef).</span><span class="sxs-lookup"><span data-stu-id="d4d82-115">You can specify a different number of upgrade domains by including the upgradeDomainCount attribute in the service’s definition file (.csdef).</span></span> <span data-ttu-id="d4d82-116">Läs mer om attributet upgradeDomainCount [WebRole schemat](https://msdn.microsoft.com/library/azure/gg557553.aspx) eller [WorkerRole schemat](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4d82-116">For more information about the upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="d4d82-117">När du utför en uppdatering på plats av en eller flera roller i din service uppdaterar Azure uppsättningar av rollinstanser enligt uppgraderingsdomän de tillhör.</span><span class="sxs-lookup"><span data-stu-id="d4d82-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according to the upgrade domain to which they belong.</span></span> <span data-ttu-id="d4d82-118">Azure-uppdateringar för instanser i en viss uppgradera domän – stoppar dem, uppdatera dem, gör dem tillbaka online – flyttar till nästa domän.</span><span class="sxs-lookup"><span data-stu-id="d4d82-118">Azure updates all of the instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto the next domain.</span></span> <span data-ttu-id="d4d82-119">Genom att stoppa endast de objektinstanser som körs i den aktuella uppgraderingsdomänen säkerställer Azure att en uppdatering görs med minsta möjliga påverkan på tjänsten som körs.</span><span class="sxs-lookup"><span data-stu-id="d4d82-119">By stopping only the instances running in the current upgrade domain, Azure makes sure that an update occurs with the least possible impact to the running service.</span></span> <span data-ttu-id="d4d82-120">Mer information finns i [hur uppdateringen fortsätter](#howanupgradeproceeds) senare i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="d4d82-120">For more information, see [How the update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="d4d82-121">När villkoren **uppdatera** och **uppgradera** ha något annan betydelse i kontexten Azure, de kan användas synonymt för processer och beskrivningar av funktionerna i det här dokumentet.</span><span class="sxs-lookup"><span data-stu-id="d4d82-121">While the terms **update** and **upgrade** have slightly different meaning in the context Azure, they can be used interchangeably for the processes and descriptions of the features in this document.</span></span>
>
>

<span data-ttu-id="d4d82-122">Din tjänst måste definiera minst två instanser av en roll för den rollen som ska uppdateras på plats utan driftavbrott.</span><span class="sxs-lookup"><span data-stu-id="d4d82-122">Your service must define at least two instances of a role for that role to be updated in-place without downtime.</span></span> <span data-ttu-id="d4d82-123">Om tjänsten består av endast en instans av en roll, blir tjänsten otillgänglig tills uppdateringen på plats har slutförts.</span><span class="sxs-lookup"><span data-stu-id="d4d82-123">If the service consists of only one instance of one role, your service will be unavailable until the in-place update has finished.</span></span>

<span data-ttu-id="d4d82-124">Det här avsnittet innehåller följande information om Azure-uppdateringar:</span><span class="sxs-lookup"><span data-stu-id="d4d82-124">This topic covers the following information about Azure updates:</span></span>

* [<span data-ttu-id="d4d82-125">Tillåtna-tjänsten ändras under en uppdatering</span><span class="sxs-lookup"><span data-stu-id="d4d82-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="d4d82-126">Hur en uppgradering pågår</span><span class="sxs-lookup"><span data-stu-id="d4d82-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="d4d82-127">Återställning av en uppdatering</span><span class="sxs-lookup"><span data-stu-id="d4d82-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="d4d82-128">Initierar flera mutating åtgärder på ett pågående distribution</span><span class="sxs-lookup"><span data-stu-id="d4d82-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="d4d82-129">Distributionen av roller uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="d4d82-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="d4d82-130">Tillåtna-tjänsten ändras under en uppdatering</span><span class="sxs-lookup"><span data-stu-id="d4d82-130">Allowed service changes during an update</span></span>
<span data-ttu-id="d4d82-131">I följande tabell visas tillåtna ändringar i en tjänst under en uppdatering:</span><span class="sxs-lookup"><span data-stu-id="d4d82-131">The following table shows the allowed changes to a service during an update:</span></span>

| <span data-ttu-id="d4d82-132">Ändringar tillåts till värd, tjänster och roller</span><span class="sxs-lookup"><span data-stu-id="d4d82-132">Changes permitted to hosting, services, and roles</span></span> | <span data-ttu-id="d4d82-133">Uppdatering på plats</span><span class="sxs-lookup"><span data-stu-id="d4d82-133">In-place update</span></span> | <span data-ttu-id="d4d82-134">Stegvis (VIP swap)</span><span class="sxs-lookup"><span data-stu-id="d4d82-134">Staged (VIP swap)</span></span> | <span data-ttu-id="d4d82-135">Ta bort och omdistribuera</span><span class="sxs-lookup"><span data-stu-id="d4d82-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="d4d82-136">Operativsystemversion</span><span class="sxs-lookup"><span data-stu-id="d4d82-136">Operating system version</span></span> |<span data-ttu-id="d4d82-137">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-137">Yes</span></span> |<span data-ttu-id="d4d82-138">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-138">Yes</span></span> |<span data-ttu-id="d4d82-139">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-139">Yes</span></span> |
| <span data-ttu-id="d4d82-140">.NET-förtroendenivåer</span><span class="sxs-lookup"><span data-stu-id="d4d82-140">.NET trust level</span></span> |<span data-ttu-id="d4d82-141">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-141">Yes</span></span> |<span data-ttu-id="d4d82-142">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-142">Yes</span></span> |<span data-ttu-id="d4d82-143">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-143">Yes</span></span> |
| <span data-ttu-id="d4d82-144">Storlek på virtuell dator<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="d4d82-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="d4d82-145">Ja<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="d4d82-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="d4d82-146">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-146">Yes</span></span> |<span data-ttu-id="d4d82-147">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-147">Yes</span></span> |
| <span data-ttu-id="d4d82-148">Inställningar för lokal lagring</span><span class="sxs-lookup"><span data-stu-id="d4d82-148">Local storage settings</span></span> |<span data-ttu-id="d4d82-149">Öka endast<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="d4d82-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="d4d82-150">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-150">Yes</span></span> |<span data-ttu-id="d4d82-151">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-151">Yes</span></span> |
| <span data-ttu-id="d4d82-152">Lägg till eller ta bort roller i en tjänst</span><span class="sxs-lookup"><span data-stu-id="d4d82-152">Add or remove roles in a service</span></span> |<span data-ttu-id="d4d82-153">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-153">Yes</span></span> |<span data-ttu-id="d4d82-154">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-154">Yes</span></span> |<span data-ttu-id="d4d82-155">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-155">Yes</span></span> |
| <span data-ttu-id="d4d82-156">Antal instanser av en viss roll</span><span class="sxs-lookup"><span data-stu-id="d4d82-156">Number of instances of a particular role</span></span> |<span data-ttu-id="d4d82-157">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-157">Yes</span></span> |<span data-ttu-id="d4d82-158">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-158">Yes</span></span> |<span data-ttu-id="d4d82-159">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-159">Yes</span></span> |
| <span data-ttu-id="d4d82-160">Antalet eller typen av slutpunkter för en tjänst</span><span class="sxs-lookup"><span data-stu-id="d4d82-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="d4d82-161">Ja<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="d4d82-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="d4d82-162">Nej</span><span class="sxs-lookup"><span data-stu-id="d4d82-162">No</span></span> |<span data-ttu-id="d4d82-163">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-163">Yes</span></span> |
| <span data-ttu-id="d4d82-164">Namn och värden för konfigurationsinställningar</span><span class="sxs-lookup"><span data-stu-id="d4d82-164">Names and values of configuration settings</span></span> |<span data-ttu-id="d4d82-165">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-165">Yes</span></span> |<span data-ttu-id="d4d82-166">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-166">Yes</span></span> |<span data-ttu-id="d4d82-167">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-167">Yes</span></span> |
| <span data-ttu-id="d4d82-168">Värden (men inte namn) för konfigurationsinställningar</span><span class="sxs-lookup"><span data-stu-id="d4d82-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="d4d82-169">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-169">Yes</span></span> |<span data-ttu-id="d4d82-170">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-170">Yes</span></span> |<span data-ttu-id="d4d82-171">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-171">Yes</span></span> |
| <span data-ttu-id="d4d82-172">Lägga till nya certifikat</span><span class="sxs-lookup"><span data-stu-id="d4d82-172">Add new certificates</span></span> |<span data-ttu-id="d4d82-173">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-173">Yes</span></span> |<span data-ttu-id="d4d82-174">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-174">Yes</span></span> |<span data-ttu-id="d4d82-175">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-175">Yes</span></span> |
| <span data-ttu-id="d4d82-176">Ändra befintliga certifikat</span><span class="sxs-lookup"><span data-stu-id="d4d82-176">Change existing certificates</span></span> |<span data-ttu-id="d4d82-177">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-177">Yes</span></span> |<span data-ttu-id="d4d82-178">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-178">Yes</span></span> |<span data-ttu-id="d4d82-179">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-179">Yes</span></span> |
| <span data-ttu-id="d4d82-180">Distribuera nya kod</span><span class="sxs-lookup"><span data-stu-id="d4d82-180">Deploy new code</span></span> |<span data-ttu-id="d4d82-181">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-181">Yes</span></span> |<span data-ttu-id="d4d82-182">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-182">Yes</span></span> |<span data-ttu-id="d4d82-183">Ja</span><span class="sxs-lookup"><span data-stu-id="d4d82-183">Yes</span></span> |

<span data-ttu-id="d4d82-184"><sup>1</sup> storlek ändras begränsas till delmängden av storlekar som finns tillgängliga för Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-184"><sup>1</sup> Size change limited to the subset of sizes available for the cloud service.</span></span>

<span data-ttu-id="d4d82-185"><sup>2</sup> kräver Azure SDK 1.5 eller senare versioner.</span><span class="sxs-lookup"><span data-stu-id="d4d82-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="d4d82-186">Lokala data går förlorade om du ändrar storlek på virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="d4d82-186">Changing the virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="d4d82-187">Följande objekt stöds inte under en uppdatering:</span><span class="sxs-lookup"><span data-stu-id="d4d82-187">The following items are not supported during an update:</span></span>

* <span data-ttu-id="d4d82-188">Ändra namnet på en roll.</span><span class="sxs-lookup"><span data-stu-id="d4d82-188">Changing the name of a role.</span></span> <span data-ttu-id="d4d82-189">Ta bort och Lägg sedan till rollen med det nya namnet.</span><span class="sxs-lookup"><span data-stu-id="d4d82-189">Remove and then add the role with the new name.</span></span>
* <span data-ttu-id="d4d82-190">Ändra antalet uppgraderingen domän.</span><span class="sxs-lookup"><span data-stu-id="d4d82-190">Changing of the Upgrade Domain count.</span></span>
* <span data-ttu-id="d4d82-191">Minska storleken på de lokala resurserna.</span><span class="sxs-lookup"><span data-stu-id="d4d82-191">Decreasing the size of the local resources.</span></span>

<span data-ttu-id="d4d82-192">Om du gör andra uppdateringar i definition av din tjänst, till exempel minska storleken på lokal resurs, måste du utföra en VIP-växling uppdatering i stället.</span><span class="sxs-lookup"><span data-stu-id="d4d82-192">If you are making other updates to your service's definition, such as decreasing the size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="d4d82-193">Mer information finns i [växla distribution](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4d82-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="d4d82-194">Hur en uppgradering pågår</span><span class="sxs-lookup"><span data-stu-id="d4d82-194">How an upgrade proceeds</span></span>
<span data-ttu-id="d4d82-195">Du kan välja om du vill uppdatera alla roller i din tjänst eller en roll i tjänsten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-195">You can decide whether you want to update all of the roles in your service or a single role in the service.</span></span> <span data-ttu-id="d4d82-196">I båda fallen är alla instanser av varje roll som uppgraderas och som hör till den första uppgraderingsdomänen Stoppad, uppgraderas och online igen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-196">In either case, all instances of each role that is being upgraded and belong to the first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="d4d82-197">När de är tillbaka online är instanserna i den andra uppgraderingsdomänen stoppad uppgraderas och online igen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-197">Once they are back online, the instances in the second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="d4d82-198">En tjänst i molnet kan ha högst en uppgradering aktiva samtidigt.</span><span class="sxs-lookup"><span data-stu-id="d4d82-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="d4d82-199">Uppgraderingen utförs alltid mot den senaste versionen av Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-199">The upgrade is always performed against the latest version of the cloud service.</span></span>

<span data-ttu-id="d4d82-200">Följande diagram illustrerar hur uppgraderingen fortsätter om du uppgraderar alla roller i tjänsten:</span><span class="sxs-lookup"><span data-stu-id="d4d82-200">The following diagram illustrates how the upgrade proceeds if you are upgrading all of the roles in the service:</span></span>

<span data-ttu-id="d4d82-201">![Uppgradera tjänsten](media/cloud-services-update-azure-service/IC345879.png "uppgradera tjänsten")</span><span class="sxs-lookup"><span data-stu-id="d4d82-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="d4d82-202">Den här nästa diagram illustrerar hur uppdateringen fortsätter om du uppgraderar bara en enda roll:</span><span class="sxs-lookup"><span data-stu-id="d4d82-202">This next diagram illustrates how the update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="d4d82-203">![Uppgradera rollen](media/cloud-services-update-azure-service/IC345880.png "uppgradera roll")</span><span class="sxs-lookup"><span data-stu-id="d4d82-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="d4d82-204">Under en automatisk uppdatering utvärderar med jämna mellanrum hälsotillståndet för Molntjänsten att bestämma när det är säkert att stega igenom nästa UD i Azure-Infrastrukturkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-204">During an automatic update, the Azure Fabric Controller periodically evaluates the health of the cloud service to determine when it’s safe to walk the next UD.</span></span> <span data-ttu-id="d4d82-205">Hälsotillstånd utvärderingen utförs på grundval av per roll och anser endast instanser i den senaste versionen (d.v.s. instanser från UDs har redan gått).</span><span class="sxs-lookup"><span data-stu-id="d4d82-205">This health evaluation is performed on a per-role basis and considers only instances in the latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="d4d82-206">Den verifierar att ett minsta antal rollinstanser för varje roll har uppnått ett tillfredsställande avslutat tillstånd.</span><span class="sxs-lookup"><span data-stu-id="d4d82-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="d4d82-207">Rollen instans Start Timeout</span><span class="sxs-lookup"><span data-stu-id="d4d82-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="d4d82-208">I Infrastrukturkontrollanten väntar 30 minuter för varje rollinstans skulle nå ett startat tillstånd.</span><span class="sxs-lookup"><span data-stu-id="d4d82-208">The Fabric Controller will wait 30 minutes for each role instance to reach a Started state.</span></span> <span data-ttu-id="d4d82-209">Om det ska gå att timeout-varaktighet, fortsätter i Infrastrukturkontrollanten går till nästa rollinstans.</span><span class="sxs-lookup"><span data-stu-id="d4d82-209">If the timeout duration elapses, the Fabric Controller will continue walking to the next role instance.</span></span>

### <a name="impact-to-drive-data-during-cloud-service-upgrades"></a><span data-ttu-id="d4d82-210">Påverkan på data från enheter under Molntjänsten uppgraderas</span><span class="sxs-lookup"><span data-stu-id="d4d82-210">Impact to drive data during Cloud Service upgrades</span></span>

<span data-ttu-id="d4d82-211">När du uppgraderar en tjänst från en enda instans till flera instanser kommer din tjänst medan uppgraderingen utförs på grund av sättet uppgraderingar av Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="d4d82-211">When upgrading a service from a single instance to multiple instances your service will be brought down while the upgrade is performed due to the way Azure upgrades services.</span></span> <span data-ttu-id="d4d82-212">Servicenivåavtal garanterande tjänsttillgänglighet för tjänsten gäller bara för tjänster som har distribuerats med mer än en instans.</span><span class="sxs-lookup"><span data-stu-id="d4d82-212">The service level agreement guaranteeing service availability only applies to services that are deployed with more than one instance.</span></span> <span data-ttu-id="d4d82-213">I följande lista beskrivs hur data på varje enhet påverkas av uppgraderingsscenario varje Azure-tjänsten:</span><span class="sxs-lookup"><span data-stu-id="d4d82-213">The following list describes how the data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="d4d82-214">Scenario</span><span class="sxs-lookup"><span data-stu-id="d4d82-214">Scenario</span></span>|<span data-ttu-id="d4d82-215">C-enheten</span><span class="sxs-lookup"><span data-stu-id="d4d82-215">C Drive</span></span>|<span data-ttu-id="d4d82-216">Enhet D</span><span class="sxs-lookup"><span data-stu-id="d4d82-216">D Drive</span></span>|<span data-ttu-id="d4d82-217">E-enheten</span><span class="sxs-lookup"><span data-stu-id="d4d82-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="d4d82-218">VM-omstart</span><span class="sxs-lookup"><span data-stu-id="d4d82-218">VM reboot</span></span>|<span data-ttu-id="d4d82-219">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-219">Preserved</span></span>|<span data-ttu-id="d4d82-220">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-220">Preserved</span></span>|<span data-ttu-id="d4d82-221">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-221">Preserved</span></span>|
|<span data-ttu-id="d4d82-222">Portalen omstart</span><span class="sxs-lookup"><span data-stu-id="d4d82-222">Portal reboot</span></span>|<span data-ttu-id="d4d82-223">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-223">Preserved</span></span>|<span data-ttu-id="d4d82-224">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-224">Preserved</span></span>|<span data-ttu-id="d4d82-225">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-225">Destroyed</span></span>|
|<span data-ttu-id="d4d82-226">Portalen avbildningsåterställning</span><span class="sxs-lookup"><span data-stu-id="d4d82-226">Portal reimage</span></span>|<span data-ttu-id="d4d82-227">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-227">Preserved</span></span>|<span data-ttu-id="d4d82-228">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-228">Destroyed</span></span>|<span data-ttu-id="d4d82-229">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-229">Destroyed</span></span>|
|<span data-ttu-id="d4d82-230">Uppgradering på plats</span><span class="sxs-lookup"><span data-stu-id="d4d82-230">In-Place Upgrade</span></span>|<span data-ttu-id="d4d82-231">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-231">Preserved</span></span>|<span data-ttu-id="d4d82-232">Bevaras</span><span class="sxs-lookup"><span data-stu-id="d4d82-232">Preserved</span></span>|<span data-ttu-id="d4d82-233">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-233">Destroyed</span></span>|
|<span data-ttu-id="d4d82-234">Noden migrering</span><span class="sxs-lookup"><span data-stu-id="d4d82-234">Node migration</span></span>|<span data-ttu-id="d4d82-235">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-235">Destroyed</span></span>|<span data-ttu-id="d4d82-236">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-236">Destroyed</span></span>|<span data-ttu-id="d4d82-237">Förstörs</span><span class="sxs-lookup"><span data-stu-id="d4d82-237">Destroyed</span></span>|

<span data-ttu-id="d4d82-238">Observera att, i listan ovan E:-enheten representerar rollens rotenhet och får inte vara hårdkodade.</span><span class="sxs-lookup"><span data-stu-id="d4d82-238">Note that, in the above list, the E: drive represents the role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="d4d82-239">Använd i stället de **RoleRoot %** miljövariabeln för att representera enheten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-239">Instead, use the **%RoleRoot%** environment variable to represent the drive.</span></span>

<span data-ttu-id="d4d82-240">Distribuera en ny tjänst för flera instanser till testservern för att minimera avbrottstiden när du uppgraderar en single instance-tjänst, och utföra en VIP-växling.</span><span class="sxs-lookup"><span data-stu-id="d4d82-240">To minimize the downtime when upgrading a single-instance service, deploy a new multi-instance service to the staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="d4d82-241">Återställning av en uppdatering</span><span class="sxs-lookup"><span data-stu-id="d4d82-241">Rollback of an update</span></span>
<span data-ttu-id="d4d82-242">Azure tillhandahåller flexibilitet för att hantera tjänster under en uppdatering genom att du kan initiera ytterligare åtgärder för en tjänst när inledande uppdateringsbegäran har godkänts av Azure-Infrastrukturkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after the initial update request is accepted by the Azure Fabric Controller.</span></span> <span data-ttu-id="d4d82-243">En återställning kan endast utföras när en uppdatering (konfigurationsändring) eller uppgraderingen finns i den **pågår** tillstånd för distributionen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-243">A rollback can only be performed when an update (configuration change) or upgrade is in the **in progress** state on the deployment.</span></span> <span data-ttu-id="d4d82-244">En uppdatering eller uppgradering av anses vara pågående så länge det finns minst en instans av tjänsten som ännu inte har uppdaterats till den nya versionen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-244">An update or upgrade is considered to be in-progress as long as there is at least one instance of the service which has not yet been updated to the new version.</span></span> <span data-ttu-id="d4d82-245">Om du vill testa om en återställning är tillåtet att kontrollera värdet för flaggan RollbackAllowed som returneras av [hämta distribution](https://msdn.microsoft.com/library/azure/ee460804.aspx) och [hämta egenskaper för moln](https://msdn.microsoft.com/library/azure/ee460806.aspx) åtgärder, har angetts till true.</span><span class="sxs-lookup"><span data-stu-id="d4d82-245">To test whether a rollback is allowed, check the value of the RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set to true.</span></span>

> [!NOTE]
> <span data-ttu-id="d4d82-246">Det finns ingen anledning att anropa Rollback i en **lokalt** uppdatera eller uppgradera eftersom VIP-växling uppgraderingar inkluderar ersätta en hel körs instans av din tjänst med en annan.</span><span class="sxs-lookup"><span data-stu-id="d4d82-246">It only makes sense to call Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="d4d82-247">Återställning av en pågående uppdatering har följande effekter för distributionen:</span><span class="sxs-lookup"><span data-stu-id="d4d82-247">Rollback of an in-progress update has the following effects on the deployment:</span></span>

* <span data-ttu-id="d4d82-248">Alla rollinstanser som ännu inte har uppdaterats eller uppgraderas till den nya versionen inte uppdateras eller uppgraderas eftersom dessa instanser körs redan Målversionen av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="d4d82-248">Any role instances which had not yet been updated or upgraded to the new version are not updated or upgraded, because those instances are already running the target version of the service.</span></span>
* <span data-ttu-id="d4d82-249">Alla rollinstanser som redan har uppdaterats eller uppgraderas till den nya versionen av service-paket (\*.cspkg) fil eller konfigurationen för tjänsten (\*.cscfg)-fil (eller båda) återställs till den förberedande versionen av filerna.</span><span class="sxs-lookup"><span data-stu-id="d4d82-249">Any role instances which had already been updated or upgraded to the new version of the service package (\*.cspkg) file or the service configuration (\*.cscfg) file (or both files) are reverted to the pre-upgrade version of these files.</span></span>

<span data-ttu-id="d4d82-250">Detta är funktionellt tillhandahålls av följande funktioner:</span><span class="sxs-lookup"><span data-stu-id="d4d82-250">This functionally is provided by the following features:</span></span>

* <span data-ttu-id="d4d82-251">Den [återställning uppdatera eller uppgradera](https://msdn.microsoft.com/library/azure/hh403977.aspx) åtgärd som kan anropas på en uppdatering för configuration (utlöses genom att anropa [ändra distributionskonfiguration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) eller en uppgradering (utlöses genom att anropa [ Uppgradera distributionen](https://msdn.microsoft.com/library/azure/ee460793.aspx)) så länge det finns minst en instans i tjänsten som ännu inte har uppdaterats till den nya versionen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-251">The [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in the service which has not yet been updated to the new version.</span></span>
* <span data-ttu-id="d4d82-252">Elementet låst och elementet RollbackAllowed returneras som en del av texten för svar på de [hämta distribution](https://msdn.microsoft.com/library/azure/ee460804.aspx) och [hämta egenskaper för moln](https://msdn.microsoft.com/library/azure/ee460806.aspx) åtgärder:</span><span class="sxs-lookup"><span data-stu-id="d4d82-252">The Locked element and the RollbackAllowed element, which are returned as part of the response body of the [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="d4d82-253">Elementet låst kan du identifiera när en mutating åtgärden kan anropas på en viss distribution.</span><span class="sxs-lookup"><span data-stu-id="d4d82-253">The Locked element allows you to detect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="d4d82-254">RollbackAllowed-elementet kan du identifiera när den [återställning uppdatering eller uppgradera](https://msdn.microsoft.com/library/azure/hh403977.aspx) åtgärden kan anropas på en viss distribution.</span><span class="sxs-lookup"><span data-stu-id="d4d82-254">The RollbackAllowed element allows you to detect when the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="d4d82-255">Du behöver inte kontrollera både låst och RollbackAllowed-element för att kunna utföra en återställning.</span><span class="sxs-lookup"><span data-stu-id="d4d82-255">In order to perform a rollback, you do not have to check both the Locked and the RollbackAllowed elements.</span></span> <span data-ttu-id="d4d82-256">Det tillräckligt för att bekräfta att RollbackAllowed har angetts till true.</span><span class="sxs-lookup"><span data-stu-id="d4d82-256">It suffices to confirm that RollbackAllowed is set to true.</span></span> <span data-ttu-id="d4d82-257">Dessa element returneras bara om de här metoderna anropas med begärandehuvudet inställd på ”x-ms-version: 2011-10-01” eller en senare version.</span><span class="sxs-lookup"><span data-stu-id="d4d82-257">These elements are only returned if these methods are invoked by using the request header set to “x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="d4d82-258">Mer information om versionshantering huvuden finns [Management Versionhantering](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4d82-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="d4d82-259">Det finns vissa situationer där en återställning av en uppdatering eller uppgradering stöds inte, de är följande:</span><span class="sxs-lookup"><span data-stu-id="d4d82-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="d4d82-260">Minskad lokala resurser - om uppdateringen ökar lokala resurser för en roll Azure-plattformen tillåter inte att återställa.</span><span class="sxs-lookup"><span data-stu-id="d4d82-260">Reduction in local resources - If the update increases the local resources for a role the Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="d4d82-261">Kvotgränsen - har om uppdateringen har en skala ned åtgärden som du kanske inte längre tillräcklig beräkning kvot för att slutföra åtgärden för återställning.</span><span class="sxs-lookup"><span data-stu-id="d4d82-261">Quota limitations - If the update was a scale down operation you may no longer have sufficient compute quota to complete the rollback operation.</span></span> <span data-ttu-id="d4d82-262">Varje Azure-prenumeration har en kvot som är associerade med den som anger maximalt antal kärnor som kan användas av alla värdbaserade tjänster som hör till prenumerationen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-262">Each Azure subscription has a quota associated with it that specifies the maximum number of cores which can be consumed by all hosted services that belong to that subscription.</span></span> <span data-ttu-id="d4d82-263">Om en återställning av en viss uppdatering får din prenumeration via kvoten sedan som aktiveras en återställning inte.</span><span class="sxs-lookup"><span data-stu-id="d4d82-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="d4d82-264">Konkurrenstillstånd – om den första uppdateringen har slutförts, en återställning är inte möjlig.</span><span class="sxs-lookup"><span data-stu-id="d4d82-264">Race condition - If the initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="d4d82-265">Är ett exempel på när återställningen av en uppdatering kan vara användbar om du använder den [Uppgraderingsdistribution](https://msdn.microsoft.com/library/azure/ee460793.aspx) åtgärden i manuellt läge för att styra den hastighet med vilken en större uppgradering på plats till din Azure-värdtjänsten är distribuerat.</span><span class="sxs-lookup"><span data-stu-id="d4d82-265">An example of when the rollback of an update might be useful is if you are using the [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode to control the rate at which a major in-place upgrade to your Azure hosted service is rolled out.</span></span>

<span data-ttu-id="d4d82-266">Under den här fasen av uppgraderingen av du anropa [Uppgraderingsdistribution](https://msdn.microsoft.com/library/azure/ee460793.aspx) i manuellt läge och börjar gå uppgraderingsdomäner.</span><span class="sxs-lookup"><span data-stu-id="d4d82-266">During the rollout of the upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin to walk upgrade domains.</span></span> <span data-ttu-id="d4d82-267">Om någon gång när du övervakar uppgraderingen måste du observera vissa rollinstanser i de första uppgraderingsdomäner som du undersöker inte har svarar, kan du anropa den [återställning uppdatering eller uppgradera](https://msdn.microsoft.com/library/azure/hh403977.aspx) åtgärd avseende distributionen, vilket leder till orörda instanser som inte hade har uppgraderats och rollback-instanser som har uppgraderats till tidigare servicepaket och konfiguration.</span><span class="sxs-lookup"><span data-stu-id="d4d82-267">If at some point, as you monitor the upgrade, you note some role instances in the first upgrade domains that you examine have become unresponsive, you can call the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on the deployment, which will leave untouched the instances which had not yet been upgraded and rollback instances which had been upgraded to the previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="d4d82-268">Initierar flera mutating åtgärder på ett pågående distribution</span><span class="sxs-lookup"><span data-stu-id="d4d82-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="d4d82-269">I vissa fall kanske du vill initiera flera samtidiga mutating åtgärder på ett pågående distribution.</span><span class="sxs-lookup"><span data-stu-id="d4d82-269">In some cases you may want to initiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="d4d82-270">Exempelvis kan du utföra en uppdatering av tjänsten, och även uppdateringen samlas över din tjänst du vill ändra vissa, t.ex. använda en annan uppdatering för att kunna återställa uppdateringen igen, eller ta bort distributionen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want to make some change, e.g. to roll the update back, apply a different update, or even delete the deployment.</span></span> <span data-ttu-id="d4d82-271">Är ett ärende där detta kan vara nödvändigt om en Serviceuppgradering av innehåller buggy koden som orsakar en uppgraderade rollinstansen kraschar upprepade gånger.</span><span class="sxs-lookup"><span data-stu-id="d4d82-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance to repeatedly crash.</span></span> <span data-ttu-id="d4d82-272">I det här fallet är Azure-Infrastrukturkontrollanten inte fortsätta vid tillämpning av uppgradera eftersom ett otillräckligt antal instanser i den uppgraderade domänen är felfria.</span><span class="sxs-lookup"><span data-stu-id="d4d82-272">In this case, the Azure Fabric Controller will not be able to make progress in applying that upgrade because an insufficient number of instances in the upgraded domain are healthy.</span></span> <span data-ttu-id="d4d82-273">Det här tillståndet kallas en *fastnat distribution*.</span><span class="sxs-lookup"><span data-stu-id="d4d82-273">This state is referred to as a *stuck deployment*.</span></span> <span data-ttu-id="d4d82-274">Du kan få loss distributionen genom att återställa uppdateringen eller använda en ny uppdatering över övre misslyckas en.</span><span class="sxs-lookup"><span data-stu-id="d4d82-274">You can unstick the deployment by rolling back the update or applying a fresh update over top of the failing one.</span></span>

<span data-ttu-id="d4d82-275">När den ursprungliga begäranden att uppdatera eller uppgradera tjänsten har tagits emot av Azure-Infrastrukturkontrollanten, kan du starta efterföljande mutera åtgärder.</span><span class="sxs-lookup"><span data-stu-id="d4d82-275">Once the initial request to update or upgrade the service has been received by the Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="d4d82-276">Det vill säga att du inte behöver vänta tills den första åtgärden har slutförts innan du kan starta en annan mutating åtgärd.</span><span class="sxs-lookup"><span data-stu-id="d4d82-276">That is, you do not have to wait for the initial operation to complete before you can start another mutating operation.</span></span>

<span data-ttu-id="d4d82-277">Initierar en andra uppdateringsåtgärd medan den första uppdateringen pågår utför liknar ångring.</span><span class="sxs-lookup"><span data-stu-id="d4d82-277">Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation.</span></span> <span data-ttu-id="d4d82-278">Om den andra uppdateringen är i automatiskt läge, uppgraderas den första uppgraderingsdomänen omedelbart, kan leda till instanser från flera uppgraderingsdomäner är offline vid samma tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="d4d82-278">If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time.</span></span>

<span data-ttu-id="d4d82-279">Åtgärderna mutating är följande: [ändra distributionskonfiguration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Uppgraderingsdistribution](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Distributionsstatus](https://msdn.microsoft.com/library/azure/ee460808.aspx), [ta bort distributionen ](https://msdn.microsoft.com/library/azure/ee460815.aspx), och [återställning uppdatering eller uppgradering av](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4d82-279">The mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="d4d82-280">Två åtgärder [hämta distribution](https://msdn.microsoft.com/library/azure/ee460804.aspx) och [hämta egenskaper för moln](https://msdn.microsoft.com/library/azure/ee460806.aspx), returnera flaggan låst som kan granskas för att avgöra om en mutating åtgärden kan anropas på en viss distribution.</span><span class="sxs-lookup"><span data-stu-id="d4d82-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return the Locked flag which can be examined to determine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="d4d82-281">För att kunna anropa den version av dessa metoder som returnerar flaggan låst, måste du ange huvudet i begäran till ”x-ms-version: 2011-10-01” eller en senare.</span><span class="sxs-lookup"><span data-stu-id="d4d82-281">In order to call the version of these methods which returns the Locked flag, you must set request header to “x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="d4d82-282">Mer information om versionshantering huvuden finns [Management Versionhantering](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4d82-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="d4d82-283">Distributionen av roller uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="d4d82-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="d4d82-284">Azure fördelar instanser av en roll jämnt över ett antal uppgraderingsdomäner som kan konfigureras som en del av tjänstdefinitionsfilen (.csdef).</span><span class="sxs-lookup"><span data-stu-id="d4d82-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of the service definition (.csdef) file.</span></span> <span data-ttu-id="d4d82-285">Max antal uppgraderingsdomäner är 20 och standardvärdet är 5.</span><span class="sxs-lookup"><span data-stu-id="d4d82-285">The max number of upgrade domains is 20 and the default is 5.</span></span> <span data-ttu-id="d4d82-286">Mer information om hur du ändrar tjänstdefinitionsfilen finns [Azure Service Definition schemat (.csdef-fil)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="d4d82-286">For more information about how to modify the service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="d4d82-287">Till exempel om din roll har tio instanser kan innehåller som standard varje uppgraderingsdomänen två instanser.</span><span class="sxs-lookup"><span data-stu-id="d4d82-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="d4d82-288">Om din roll har 14 instanser, fyra uppgradera domänerna innehåller tre instanser och en femte domän innehåller två.</span><span class="sxs-lookup"><span data-stu-id="d4d82-288">If your role has 14 instances, then four of the upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="d4d82-289">Uppgraderingsdomäner identifieras med ett Nollbaserat index: den första uppgraderingsdomänen har ett ID 0 och andra uppgraderingsdomänen har ID 1 och så vidare.</span><span class="sxs-lookup"><span data-stu-id="d4d82-289">Upgrade domains are identified with a zero-based index: the first upgrade domain has an ID of 0, and the second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="d4d82-290">Följande diagram illustrerar hur en tjänst än innehåller två roller ska distribueras när tjänsten definierar två uppgraderingsdomäner.</span><span class="sxs-lookup"><span data-stu-id="d4d82-290">The following diagram illustrates how a service than contains two roles are distributed when the service defines two upgrade domains.</span></span> <span data-ttu-id="d4d82-291">Tjänsten körs åtta instanser av webbrollen och nio instanser av worker-rollen.</span><span class="sxs-lookup"><span data-stu-id="d4d82-291">The service is running eight instances of the web role and nine instances of the worker role.</span></span>

<span data-ttu-id="d4d82-292">![Distribution av Uppgraderingsdomäner](media/cloud-services-update-azure-service/IC345533.png "Distribution av Uppgraderingsdomäner")</span><span class="sxs-lookup"><span data-stu-id="d4d82-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="d4d82-293">Observera att Azure styr hur instanser fördelade över uppgraderingsdomäner.</span><span class="sxs-lookup"><span data-stu-id="d4d82-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="d4d82-294">Det går inte att ange vilka instanser som är allokerade till vilken domän.</span><span class="sxs-lookup"><span data-stu-id="d4d82-294">It's not possible to specify which instances are allocated to which domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="d4d82-295">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="d4d82-295">Next steps</span></span>
[<span data-ttu-id="d4d82-296">Så här hanterar du molntjänster</span><span class="sxs-lookup"><span data-stu-id="d4d82-296">How to Manage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="d4d82-297">Så här övervakar du molntjänster</span><span class="sxs-lookup"><span data-stu-id="d4d82-297">How to Monitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="d4d82-298">Så här konfigurerar du molntjänster</span><span class="sxs-lookup"><span data-stu-id="d4d82-298">How to Configure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
