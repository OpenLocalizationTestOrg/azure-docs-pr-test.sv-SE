---
title: "aaaHow tooupdate en molnbaserad tjänst | Microsoft Docs"
description: "Lär dig hur tooupdate cloud services i Azure. Lär dig hur en uppdatering på en tjänst i molnet fortsätter tooensure tillgänglighet."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 7e4c8bd46e51a555b4309ea8927d120e8efcf0ea
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooupdate-a-cloud-service"></a><span data-ttu-id="b03d2-104">Hur tooupdate en tjänst i molnet</span><span class="sxs-lookup"><span data-stu-id="b03d2-104">How tooupdate a cloud service</span></span>

<span data-ttu-id="b03d2-105">Uppdatera en tjänst i molnet, inklusive dess roller och ett operativsystem, är tre steg.</span><span class="sxs-lookup"><span data-stu-id="b03d2-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="b03d2-106">Först hello binärfiler och konfigurationsfiler för hello ny molntjänst eller OS-version måste överföras.</span><span class="sxs-lookup"><span data-stu-id="b03d2-106">First, hello binaries and configuration files for hello new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="b03d2-107">Därefter reserverar Azure beräknings- och nätverksresurser för hello Molntjänsten baserat på hello krav hello nya cloud service-versionen.</span><span class="sxs-lookup"><span data-stu-id="b03d2-107">Next, Azure reserves compute and network resources for hello cloud service based on hello requirements of hello new cloud service version.</span></span> <span data-ttu-id="b03d2-108">Slutligen utför Azure en löpande uppgradering tooincrementally hello klient toohello ny Uppdateringsversion eller operativsystem, samtidigt som din tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="b03d2-108">Finally, Azure performs a rolling upgrade tooincrementally update hello tenant toohello new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="b03d2-109">Den här artikeln beskrivs hello information om det sista steget – hello löpande uppgradering.</span><span class="sxs-lookup"><span data-stu-id="b03d2-109">This article discusses hello details of this last step – hello rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="b03d2-110">Uppdatera en Azure-tjänst</span><span class="sxs-lookup"><span data-stu-id="b03d2-110">Update an Azure Service</span></span>
<span data-ttu-id="b03d2-111">Azure ordnar dina rollinstanser i logiska grupper kallas uppgraderingsdomäner (UD).</span><span class="sxs-lookup"><span data-stu-id="b03d2-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="b03d2-112">Uppgraderingsdomäner (UD) är en logisk uppsättning rollinstanser som uppdateras som en grupp.</span><span class="sxs-lookup"><span data-stu-id="b03d2-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="b03d2-113">Azure-uppdateringar en cloud service en UD samtidigt, vilket ger instanser i andra UDs toocontinue trafik.</span><span class="sxs-lookup"><span data-stu-id="b03d2-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs toocontinue serving traffic.</span></span>

<span data-ttu-id="b03d2-114">hello Standardantal uppgraderingsdomäner är 5.</span><span class="sxs-lookup"><span data-stu-id="b03d2-114">hello default number of upgrade domains is 5.</span></span> <span data-ttu-id="b03d2-115">Du kan ange ett annat antal uppgraderingsdomäner genom att inkludera hello upgradeDomainCount attribut i definitionsfilen för hello-tjänsten (.csdef).</span><span class="sxs-lookup"><span data-stu-id="b03d2-115">You can specify a different number of upgrade domains by including hello upgradeDomainCount attribute in hello service’s definition file (.csdef).</span></span> <span data-ttu-id="b03d2-116">Läs mer om hello upgradeDomainCount attributet [WebRole schemat](https://msdn.microsoft.com/library/azure/gg557553.aspx) eller [WorkerRole schemat](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="b03d2-116">For more information about hello upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="b03d2-117">När du utför en uppdatering på plats av en eller flera roller i din service uppdaterar Azure uppsättningar av rollinstanser enligt toohello uppgraderingsdomänen toowhich de tillhör.</span><span class="sxs-lookup"><span data-stu-id="b03d2-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according toohello upgrade domain toowhich they belong.</span></span> <span data-ttu-id="b03d2-118">Azure-uppdateringar för hello instanser i en viss uppgradera domän – stoppar dem, uppdatera dem, gör dem tillbaka online – flyttar till nästa hello-domän.</span><span class="sxs-lookup"><span data-stu-id="b03d2-118">Azure updates all of hello instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto hello next domain.</span></span> <span data-ttu-id="b03d2-119">Genom att stoppa endast hello-instanser som körs i hello aktuell uppgraderingsdomän, Azure ser till att det sker en uppdatering med hello minsta möjliga påverkan toohello som kör tjänsten.</span><span class="sxs-lookup"><span data-stu-id="b03d2-119">By stopping only hello instances running in hello current upgrade domain, Azure makes sure that an update occurs with hello least possible impact toohello running service.</span></span> <span data-ttu-id="b03d2-120">Mer information finns i [hur hello uppdateringen fortsätter](#howanupgradeproceeds) senare i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="b03d2-120">For more information, see [How hello update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="b03d2-121">När villkoren hello **uppdatera** och **uppgradera** ha något annan betydelse i kontexten hello Azure, de kan användas synonymt för hello processer och beskrivningar av hello funktioner i det här dokumentet.</span><span class="sxs-lookup"><span data-stu-id="b03d2-121">While hello terms **update** and **upgrade** have slightly different meaning in hello context Azure, they can be used interchangeably for hello processes and descriptions of hello features in this document.</span></span>
>
>

<span data-ttu-id="b03d2-122">Din tjänst måste definiera minst två instanser av en roll för att rollen toobe uppdateras på plats utan driftavbrott.</span><span class="sxs-lookup"><span data-stu-id="b03d2-122">Your service must define at least two instances of a role for that role toobe updated in-place without downtime.</span></span> <span data-ttu-id="b03d2-123">Om tjänsten hello består av endast en instans av en roll, blir tjänsten otillgänglig tills hello på plats är klar.</span><span class="sxs-lookup"><span data-stu-id="b03d2-123">If hello service consists of only one instance of one role, your service will be unavailable until hello in-place update has finished.</span></span>

<span data-ttu-id="b03d2-124">Det här avsnittet innehåller följande information om Azure uppdateringar hello:</span><span class="sxs-lookup"><span data-stu-id="b03d2-124">This topic covers hello following information about Azure updates:</span></span>

* [<span data-ttu-id="b03d2-125">Tillåtna-tjänsten ändras under en uppdatering</span><span class="sxs-lookup"><span data-stu-id="b03d2-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="b03d2-126">Hur en uppgradering pågår</span><span class="sxs-lookup"><span data-stu-id="b03d2-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="b03d2-127">Återställning av en uppdatering</span><span class="sxs-lookup"><span data-stu-id="b03d2-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="b03d2-128">Initierar flera mutating åtgärder på ett pågående distribution</span><span class="sxs-lookup"><span data-stu-id="b03d2-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="b03d2-129">Distributionen av roller uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="b03d2-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="b03d2-130">Tillåtna-tjänsten ändras under en uppdatering</span><span class="sxs-lookup"><span data-stu-id="b03d2-130">Allowed service changes during an update</span></span>
<span data-ttu-id="b03d2-131">hello följande tabell visar hello tillåtna ändringar tooa tjänsten under en uppdatering:</span><span class="sxs-lookup"><span data-stu-id="b03d2-131">hello following table shows hello allowed changes tooa service during an update:</span></span>

| <span data-ttu-id="b03d2-132">Ändringar tillåts toohosting, tjänster och roller</span><span class="sxs-lookup"><span data-stu-id="b03d2-132">Changes permitted toohosting, services, and roles</span></span> | <span data-ttu-id="b03d2-133">Uppdatering på plats</span><span class="sxs-lookup"><span data-stu-id="b03d2-133">In-place update</span></span> | <span data-ttu-id="b03d2-134">Stegvis (VIP swap)</span><span class="sxs-lookup"><span data-stu-id="b03d2-134">Staged (VIP swap)</span></span> | <span data-ttu-id="b03d2-135">Ta bort och omdistribuera</span><span class="sxs-lookup"><span data-stu-id="b03d2-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b03d2-136">Operativsystemversion</span><span class="sxs-lookup"><span data-stu-id="b03d2-136">Operating system version</span></span> |<span data-ttu-id="b03d2-137">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-137">Yes</span></span> |<span data-ttu-id="b03d2-138">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-138">Yes</span></span> |<span data-ttu-id="b03d2-139">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-139">Yes</span></span> |
| <span data-ttu-id="b03d2-140">.NET-förtroendenivåer</span><span class="sxs-lookup"><span data-stu-id="b03d2-140">.NET trust level</span></span> |<span data-ttu-id="b03d2-141">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-141">Yes</span></span> |<span data-ttu-id="b03d2-142">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-142">Yes</span></span> |<span data-ttu-id="b03d2-143">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-143">Yes</span></span> |
| <span data-ttu-id="b03d2-144">Storlek på virtuell dator<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="b03d2-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="b03d2-145">Ja<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b03d2-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="b03d2-146">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-146">Yes</span></span> |<span data-ttu-id="b03d2-147">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-147">Yes</span></span> |
| <span data-ttu-id="b03d2-148">Inställningar för lokal lagring</span><span class="sxs-lookup"><span data-stu-id="b03d2-148">Local storage settings</span></span> |<span data-ttu-id="b03d2-149">Öka endast<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b03d2-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="b03d2-150">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-150">Yes</span></span> |<span data-ttu-id="b03d2-151">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-151">Yes</span></span> |
| <span data-ttu-id="b03d2-152">Lägg till eller ta bort roller i en tjänst</span><span class="sxs-lookup"><span data-stu-id="b03d2-152">Add or remove roles in a service</span></span> |<span data-ttu-id="b03d2-153">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-153">Yes</span></span> |<span data-ttu-id="b03d2-154">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-154">Yes</span></span> |<span data-ttu-id="b03d2-155">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-155">Yes</span></span> |
| <span data-ttu-id="b03d2-156">Antal instanser av en viss roll</span><span class="sxs-lookup"><span data-stu-id="b03d2-156">Number of instances of a particular role</span></span> |<span data-ttu-id="b03d2-157">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-157">Yes</span></span> |<span data-ttu-id="b03d2-158">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-158">Yes</span></span> |<span data-ttu-id="b03d2-159">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-159">Yes</span></span> |
| <span data-ttu-id="b03d2-160">Antalet eller typen av slutpunkter för en tjänst</span><span class="sxs-lookup"><span data-stu-id="b03d2-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="b03d2-161">Ja<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b03d2-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="b03d2-162">Nej</span><span class="sxs-lookup"><span data-stu-id="b03d2-162">No</span></span> |<span data-ttu-id="b03d2-163">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-163">Yes</span></span> |
| <span data-ttu-id="b03d2-164">Namn och värden för konfigurationsinställningar</span><span class="sxs-lookup"><span data-stu-id="b03d2-164">Names and values of configuration settings</span></span> |<span data-ttu-id="b03d2-165">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-165">Yes</span></span> |<span data-ttu-id="b03d2-166">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-166">Yes</span></span> |<span data-ttu-id="b03d2-167">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-167">Yes</span></span> |
| <span data-ttu-id="b03d2-168">Värden (men inte namn) för konfigurationsinställningar</span><span class="sxs-lookup"><span data-stu-id="b03d2-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="b03d2-169">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-169">Yes</span></span> |<span data-ttu-id="b03d2-170">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-170">Yes</span></span> |<span data-ttu-id="b03d2-171">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-171">Yes</span></span> |
| <span data-ttu-id="b03d2-172">Lägga till nya certifikat</span><span class="sxs-lookup"><span data-stu-id="b03d2-172">Add new certificates</span></span> |<span data-ttu-id="b03d2-173">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-173">Yes</span></span> |<span data-ttu-id="b03d2-174">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-174">Yes</span></span> |<span data-ttu-id="b03d2-175">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-175">Yes</span></span> |
| <span data-ttu-id="b03d2-176">Ändra befintliga certifikat</span><span class="sxs-lookup"><span data-stu-id="b03d2-176">Change existing certificates</span></span> |<span data-ttu-id="b03d2-177">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-177">Yes</span></span> |<span data-ttu-id="b03d2-178">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-178">Yes</span></span> |<span data-ttu-id="b03d2-179">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-179">Yes</span></span> |
| <span data-ttu-id="b03d2-180">Distribuera nya kod</span><span class="sxs-lookup"><span data-stu-id="b03d2-180">Deploy new code</span></span> |<span data-ttu-id="b03d2-181">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-181">Yes</span></span> |<span data-ttu-id="b03d2-182">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-182">Yes</span></span> |<span data-ttu-id="b03d2-183">Ja</span><span class="sxs-lookup"><span data-stu-id="b03d2-183">Yes</span></span> |

<span data-ttu-id="b03d2-184"><sup>1</sup> storlek ändras begränsad toohello delmängd av storlekar som finns tillgängliga för hello-Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="b03d2-184"><sup>1</sup> Size change limited toohello subset of sizes available for hello cloud service.</span></span>

<span data-ttu-id="b03d2-185"><sup>2</sup> kräver Azure SDK 1.5 eller senare versioner.</span><span class="sxs-lookup"><span data-stu-id="b03d2-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="b03d2-186">Ändra storlek på virtuell dator hello förstör lokala data.</span><span class="sxs-lookup"><span data-stu-id="b03d2-186">Changing hello virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="b03d2-187">följande objekt hello stöds inte under en uppdatering:</span><span class="sxs-lookup"><span data-stu-id="b03d2-187">hello following items are not supported during an update:</span></span>

* <span data-ttu-id="b03d2-188">Ändra hello namnet på en roll.</span><span class="sxs-lookup"><span data-stu-id="b03d2-188">Changing hello name of a role.</span></span> <span data-ttu-id="b03d2-189">Ta bort och Lägg sedan till hello-serverrollen med hello nytt namn.</span><span class="sxs-lookup"><span data-stu-id="b03d2-189">Remove and then add hello role with hello new name.</span></span>
* <span data-ttu-id="b03d2-190">Ändring av hello uppgradera antal.</span><span class="sxs-lookup"><span data-stu-id="b03d2-190">Changing of hello Upgrade Domain count.</span></span>
* <span data-ttu-id="b03d2-191">Minska hello storleken på hello lokala resurser.</span><span class="sxs-lookup"><span data-stu-id="b03d2-191">Decreasing hello size of hello local resources.</span></span>

<span data-ttu-id="b03d2-192">Om du gör andra uppdateringar tooyour service definition, till exempel minska hello storleken på lokal resurs, måste du utföra en VIP-växling uppdatering i stället.</span><span class="sxs-lookup"><span data-stu-id="b03d2-192">If you are making other updates tooyour service's definition, such as decreasing hello size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="b03d2-193">Mer information finns i [växla distribution](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="b03d2-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="b03d2-194">Hur en uppgradering pågår</span><span class="sxs-lookup"><span data-stu-id="b03d2-194">How an upgrade proceeds</span></span>
<span data-ttu-id="b03d2-195">Du kan bestämma om du vill tooupdate alla hello roller i din tjänst eller en roll i hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="b03d2-195">You can decide whether you want tooupdate all of hello roles in your service or a single role in hello service.</span></span> <span data-ttu-id="b03d2-196">I båda fallen är alla instanser av varje roll som uppgraderas och tillhör toohello första uppgraderingsdomänen Stoppad, uppgraderas och online igen.</span><span class="sxs-lookup"><span data-stu-id="b03d2-196">In either case, all instances of each role that is being upgraded and belong toohello first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="b03d2-197">När de är tillbaka online är hello instanser i hello andra uppgraderingsdomänen Stoppad, uppgraderas och online igen.</span><span class="sxs-lookup"><span data-stu-id="b03d2-197">Once they are back online, hello instances in hello second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="b03d2-198">En tjänst i molnet kan ha högst en uppgradering aktiva samtidigt.</span><span class="sxs-lookup"><span data-stu-id="b03d2-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="b03d2-199">hello uppgraderingen utförs alltid mot hello senaste versionen av hello-Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="b03d2-199">hello upgrade is always performed against hello latest version of hello cloud service.</span></span>

<span data-ttu-id="b03d2-200">hello följande diagram illustrerar hur hello uppgraderingen fortsätter om du uppgraderar alla hello roller i hello-tjänsten:</span><span class="sxs-lookup"><span data-stu-id="b03d2-200">hello following diagram illustrates how hello upgrade proceeds if you are upgrading all of hello roles in hello service:</span></span>

<span data-ttu-id="b03d2-201">![Uppgradera tjänsten](media/cloud-services-update-azure-service/IC345879.png "uppgradera tjänsten")</span><span class="sxs-lookup"><span data-stu-id="b03d2-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="b03d2-202">Den här nästa diagram illustrerar hur hello uppdatering fortsätter när du uppgraderar bara en enda roll:</span><span class="sxs-lookup"><span data-stu-id="b03d2-202">This next diagram illustrates how hello update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="b03d2-203">![Uppgradera rollen](media/cloud-services-update-azure-service/IC345880.png "uppgradera roll")</span><span class="sxs-lookup"><span data-stu-id="b03d2-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="b03d2-204">Under en automatisk uppdatering utvärderar hello Azure-Infrastrukturkontrollanten med jämna mellanrum hello hälsotillstånd hello cloud service toodetermine när säker toowalk hello nästa UD.</span><span class="sxs-lookup"><span data-stu-id="b03d2-204">During an automatic update, hello Azure Fabric Controller periodically evaluates hello health of hello cloud service toodetermine when it’s safe toowalk hello next UD.</span></span> <span data-ttu-id="b03d2-205">Hälsotillstånd utvärderingen utförs på grundval av per roll och anser endast instanser i hello senaste versionen (d.v.s. instanser från UDs har redan gått).</span><span class="sxs-lookup"><span data-stu-id="b03d2-205">This health evaluation is performed on a per-role basis and considers only instances in hello latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="b03d2-206">Den verifierar att ett minsta antal rollinstanser för varje roll har uppnått ett tillfredsställande avslutat tillstånd.</span><span class="sxs-lookup"><span data-stu-id="b03d2-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="b03d2-207">Rollen instans Start Timeout</span><span class="sxs-lookup"><span data-stu-id="b03d2-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="b03d2-208">Hej Infrastrukturkontrollanten väntar 30 minuter för varje roll instans tooreach tillståndet igång.</span><span class="sxs-lookup"><span data-stu-id="b03d2-208">hello Fabric Controller will wait 30 minutes for each role instance tooreach a Started state.</span></span> <span data-ttu-id="b03d2-209">Om det ska gå att hello timeout-varaktighet, fortsätter hello Infrastrukturkontrollanten går toohello nästa rollinstans.</span><span class="sxs-lookup"><span data-stu-id="b03d2-209">If hello timeout duration elapses, hello Fabric Controller will continue walking toohello next role instance.</span></span>

### <a name="impact-toodrive-data-during-cloud-service-upgrades"></a><span data-ttu-id="b03d2-210">Påverkan toodrive data under Molntjänsten uppgraderingar</span><span class="sxs-lookup"><span data-stu-id="b03d2-210">Impact toodrive data during Cloud Service upgrades</span></span>

<span data-ttu-id="b03d2-211">När du uppgraderar en tjänst från en enda instans toomultiple instanser kommer din tjänst medan hello uppgraderingen utförs på grund av toohello sätt Azure uppgraderar tjänster.</span><span class="sxs-lookup"><span data-stu-id="b03d2-211">When upgrading a service from a single instance toomultiple instances your service will be brought down while hello upgrade is performed due toohello way Azure upgrades services.</span></span> <span data-ttu-id="b03d2-212">hello servicenivåavtal garanterande service tjänsttillgänglighet gäller endast tooservices som distribueras med mer än en instans.</span><span class="sxs-lookup"><span data-stu-id="b03d2-212">hello service level agreement guaranteeing service availability only applies tooservices that are deployed with more than one instance.</span></span> <span data-ttu-id="b03d2-213">hello följande lista beskrivs hur hello data på varje enhet påverkas av uppgraderingsscenario varje Azure-tjänsten:</span><span class="sxs-lookup"><span data-stu-id="b03d2-213">hello following list describes how hello data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="b03d2-214">Scenario</span><span class="sxs-lookup"><span data-stu-id="b03d2-214">Scenario</span></span>|<span data-ttu-id="b03d2-215">C-enheten</span><span class="sxs-lookup"><span data-stu-id="b03d2-215">C Drive</span></span>|<span data-ttu-id="b03d2-216">Enhet D</span><span class="sxs-lookup"><span data-stu-id="b03d2-216">D Drive</span></span>|<span data-ttu-id="b03d2-217">E-enheten</span><span class="sxs-lookup"><span data-stu-id="b03d2-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="b03d2-218">VM-omstart</span><span class="sxs-lookup"><span data-stu-id="b03d2-218">VM reboot</span></span>|<span data-ttu-id="b03d2-219">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-219">Preserved</span></span>|<span data-ttu-id="b03d2-220">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-220">Preserved</span></span>|<span data-ttu-id="b03d2-221">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-221">Preserved</span></span>|
|<span data-ttu-id="b03d2-222">Portalen omstart</span><span class="sxs-lookup"><span data-stu-id="b03d2-222">Portal reboot</span></span>|<span data-ttu-id="b03d2-223">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-223">Preserved</span></span>|<span data-ttu-id="b03d2-224">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-224">Preserved</span></span>|<span data-ttu-id="b03d2-225">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-225">Destroyed</span></span>|
|<span data-ttu-id="b03d2-226">Portalen avbildningsåterställning</span><span class="sxs-lookup"><span data-stu-id="b03d2-226">Portal reimage</span></span>|<span data-ttu-id="b03d2-227">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-227">Preserved</span></span>|<span data-ttu-id="b03d2-228">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-228">Destroyed</span></span>|<span data-ttu-id="b03d2-229">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-229">Destroyed</span></span>|
|<span data-ttu-id="b03d2-230">Uppgradering på plats</span><span class="sxs-lookup"><span data-stu-id="b03d2-230">In-Place Upgrade</span></span>|<span data-ttu-id="b03d2-231">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-231">Preserved</span></span>|<span data-ttu-id="b03d2-232">Bevaras</span><span class="sxs-lookup"><span data-stu-id="b03d2-232">Preserved</span></span>|<span data-ttu-id="b03d2-233">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-233">Destroyed</span></span>|
|<span data-ttu-id="b03d2-234">Noden migrering</span><span class="sxs-lookup"><span data-stu-id="b03d2-234">Node migration</span></span>|<span data-ttu-id="b03d2-235">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-235">Destroyed</span></span>|<span data-ttu-id="b03d2-236">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-236">Destroyed</span></span>|<span data-ttu-id="b03d2-237">Förstörs</span><span class="sxs-lookup"><span data-stu-id="b03d2-237">Destroyed</span></span>|

<span data-ttu-id="b03d2-238">Observera att, i hello ovanför listan hello E:-enheten representerar hello rollen rotenhet och får inte vara hårdkodade.</span><span class="sxs-lookup"><span data-stu-id="b03d2-238">Note that, in hello above list, hello E: drive represents hello role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="b03d2-239">Använd i stället hello **RoleRoot %** miljö variabeln toorepresent hello enhet.</span><span class="sxs-lookup"><span data-stu-id="b03d2-239">Instead, use hello **%RoleRoot%** environment variable toorepresent hello drive.</span></span>

<span data-ttu-id="b03d2-240">toominimize hello avbrottstid när du uppgraderar en eninstanskategori tjänst distribuera en ny flera instanser toohello fristående server och utföra en VIP-växling.</span><span class="sxs-lookup"><span data-stu-id="b03d2-240">toominimize hello downtime when upgrading a single-instance service, deploy a new multi-instance service toohello staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="b03d2-241">Återställning av en uppdatering</span><span class="sxs-lookup"><span data-stu-id="b03d2-241">Rollback of an update</span></span>
<span data-ttu-id="b03d2-242">Azure tillhandahåller flexibilitet för att hantera tjänster under en uppdatering genom att du kan initiera ytterligare åtgärder för en tjänst när hello inledande uppdateringsbegäran har godkänts av hello Azure-Infrastrukturkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="b03d2-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after hello initial update request is accepted by hello Azure Fabric Controller.</span></span> <span data-ttu-id="b03d2-243">En återställning kan endast utföras när en uppdatering (konfigurationsändring) eller uppgraderingen är i hello **pågår** tillstånd hello-distribution.</span><span class="sxs-lookup"><span data-stu-id="b03d2-243">A rollback can only be performed when an update (configuration change) or upgrade is in hello **in progress** state on hello deployment.</span></span> <span data-ttu-id="b03d2-244">En uppdatering eller uppgradering av anses toobe pågående så länge det finns minst en instans av hello-tjänsten som ännu inte har uppdaterats toohello ny version.</span><span class="sxs-lookup"><span data-stu-id="b03d2-244">An update or upgrade is considered toobe in-progress as long as there is at least one instance of hello service which has not yet been updated toohello new version.</span></span> <span data-ttu-id="b03d2-245">tootest om en återställning tillåts, kontrollera hello värdet av hello RollbackAllowed flagga som returneras av [hämta distribution](https://msdn.microsoft.com/library/azure/ee460804.aspx) och [hämta egenskaper för moln](https://msdn.microsoft.com/library/azure/ee460806.aspx) åtgärder, anges tootrue.</span><span class="sxs-lookup"><span data-stu-id="b03d2-245">tootest whether a rollback is allowed, check hello value of hello RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set tootrue.</span></span>

> [!NOTE]
> <span data-ttu-id="b03d2-246">Den gör bara meningsfullt toocall återställning på en **lokalt** uppdatera eller uppgradera eftersom VIP-växling uppgraderingar inkluderar ersätta en hel körs instans av din tjänst med en annan.</span><span class="sxs-lookup"><span data-stu-id="b03d2-246">It only makes sense toocall Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="b03d2-247">Återställning av en pågående uppdatering har följande effekter på hello distribution hello:</span><span class="sxs-lookup"><span data-stu-id="b03d2-247">Rollback of an in-progress update has hello following effects on hello deployment:</span></span>

* <span data-ttu-id="b03d2-248">Alla rollinstanser som inte hade ännu har uppdaterats eller uppgraderade toohello ny version är inte uppdaterade eller uppgraderas eftersom dessa instanser körs redan hello Målversionen av hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="b03d2-248">Any role instances which had not yet been updated or upgraded toohello new version are not updated or upgraded, because those instances are already running hello target version of hello service.</span></span>
* <span data-ttu-id="b03d2-249">Någon roll instanser som redan har uppdaterats eller uppgraderade toohello ny version av hello-tjänsten (\*.cspkg) fil eller hello tjänstkonfiguration (\*.cscfg) är återställts toohello förberedande version av filen (eller båda) de här filerna.</span><span class="sxs-lookup"><span data-stu-id="b03d2-249">Any role instances which had already been updated or upgraded toohello new version of hello service package (\*.cspkg) file or hello service configuration (\*.cscfg) file (or both files) are reverted toohello pre-upgrade version of these files.</span></span>

<span data-ttu-id="b03d2-250">Detta är funktionellt tillhandahålls av hello följande funktioner:</span><span class="sxs-lookup"><span data-stu-id="b03d2-250">This functionally is provided by hello following features:</span></span>

* <span data-ttu-id="b03d2-251">Hej [återställning uppdatera eller uppgradera](https://msdn.microsoft.com/library/azure/hh403977.aspx) åtgärd som kan anropas på en uppdatering för configuration (utlöses genom att anropa [ändra distributionskonfiguration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) eller en uppgradering (utlöses genom att anropa [ Uppgradera distributionen](https://msdn.microsoft.com/library/azure/ee460793.aspx)) så länge det finns minst en instans i hello tjänsten som ännu inte har uppdaterats toohello ny version.</span><span class="sxs-lookup"><span data-stu-id="b03d2-251">hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in hello service which has not yet been updated toohello new version.</span></span>
* <span data-ttu-id="b03d2-252">Hej låst och hello RollbackAllowed element, som returneras som en del av hello svarstexten av hello [hämta distribution](https://msdn.microsoft.com/library/azure/ee460804.aspx) och [hämta egenskaper för moln](https://msdn.microsoft.com/library/azure/ee460806.aspx) åtgärder:</span><span class="sxs-lookup"><span data-stu-id="b03d2-252">hello Locked element and hello RollbackAllowed element, which are returned as part of hello response body of hello [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="b03d2-253">hello låst-elementet kan toodetect när en mutating åtgärden kan anropas på en viss distribution.</span><span class="sxs-lookup"><span data-stu-id="b03d2-253">hello Locked element allows you toodetect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="b03d2-254">Hej RollbackAllowed-elementet kan du toodetect när hello [återställning uppdatering eller uppgradera](https://msdn.microsoft.com/library/azure/hh403977.aspx) åtgärden kan anropas på en viss distribution.</span><span class="sxs-lookup"><span data-stu-id="b03d2-254">hello RollbackAllowed element allows you toodetect when hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="b03d2-255">I ordning tooperform en återställning har inte toocheck både hello låst och hello RollbackAllowed element.</span><span class="sxs-lookup"><span data-stu-id="b03d2-255">In order tooperform a rollback, you do not have toocheck both hello Locked and hello RollbackAllowed elements.</span></span> <span data-ttu-id="b03d2-256">Det tillräckligt tooconfirm RollbackAllowed anges tootrue.</span><span class="sxs-lookup"><span data-stu-id="b03d2-256">It suffices tooconfirm that RollbackAllowed is set tootrue.</span></span> <span data-ttu-id="b03d2-257">Dessa element returneras bara om de här metoderna anropas med hello begärandehuvudet inställt för ”x-ms-version: 2011-10-01” eller en senare version.</span><span class="sxs-lookup"><span data-stu-id="b03d2-257">These elements are only returned if these methods are invoked by using hello request header set too“x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="b03d2-258">Mer information om versionshantering huvuden finns [Management Versionhantering](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="b03d2-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="b03d2-259">Det finns vissa situationer där en återställning av en uppdatering eller uppgradering stöds inte, de är följande:</span><span class="sxs-lookup"><span data-stu-id="b03d2-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="b03d2-260">Minskad lokala resurser - tillåter om hello uppdateringen ökar hello lokala resurser för en roll hello Azure-plattformen inte att återställa.</span><span class="sxs-lookup"><span data-stu-id="b03d2-260">Reduction in local resources - If hello update increases hello local resources for a role hello Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="b03d2-261">Kvotgränsen - ha om hello uppdatering var en skala ned åtgärden som du kanske inte längre tillräckligt beräkning kvoten toocomplete hello återställningsåtgärd.</span><span class="sxs-lookup"><span data-stu-id="b03d2-261">Quota limitations - If hello update was a scale down operation you may no longer have sufficient compute quota toocomplete hello rollback operation.</span></span> <span data-ttu-id="b03d2-262">Varje Azure-prenumeration har en kvot som är associerade med den som anger hello högsta antalet kärnor som kan användas av alla värdbaserade tjänster som tillhör toothat prenumeration.</span><span class="sxs-lookup"><span data-stu-id="b03d2-262">Each Azure subscription has a quota associated with it that specifies hello maximum number of cores which can be consumed by all hosted services that belong toothat subscription.</span></span> <span data-ttu-id="b03d2-263">Om en återställning av en viss uppdatering får din prenumeration via kvoten sedan som aktiveras en återställning inte.</span><span class="sxs-lookup"><span data-stu-id="b03d2-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="b03d2-264">Konkurrenstillstånd - om hello ursprungliga uppdateringen har slutförts, en återställning är inte möjlig.</span><span class="sxs-lookup"><span data-stu-id="b03d2-264">Race condition - If hello initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="b03d2-265">Är ett exempel på när hello återställningen av en uppdatering kan vara användbar om du använder hello [Uppgraderingsdistribution](https://msdn.microsoft.com/library/azure/ee460793.aspx) åtgärd i manuellt läge toocontrol hello hastighet med vilken en större på plats uppgradera tooyour Azure-värdtjänsten är distribuerat.</span><span class="sxs-lookup"><span data-stu-id="b03d2-265">An example of when hello rollback of an update might be useful is if you are using hello [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode toocontrol hello rate at which a major in-place upgrade tooyour Azure hosted service is rolled out.</span></span>

<span data-ttu-id="b03d2-266">Under hello distributionen av hello uppgraderingen av du anropa [Uppgraderingsdistribution](https://msdn.microsoft.com/library/azure/ee460793.aspx) i manuellt läge och börja toowalk uppgraderingsdomäner.</span><span class="sxs-lookup"><span data-stu-id="b03d2-266">During hello rollout of hello upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin toowalk upgrade domains.</span></span> <span data-ttu-id="b03d2-267">Om du någon gång när du övervakar hello uppgraderingen kan du Observera att vissa rollinstanser i hello första uppgradera domäner som du undersöker inte har svarar du anropa hello [återställning uppdatering eller uppgradera](https://msdn.microsoft.com/library/azure/hh403977.aspx) åtgärden hello-distribution som lämnar orörd hello-instanser som inte hade har uppgraderats och rollback-instanser som hade uppgraderat toohello tidigare servicepaket och konfiguration.</span><span class="sxs-lookup"><span data-stu-id="b03d2-267">If at some point, as you monitor hello upgrade, you note some role instances in hello first upgrade domains that you examine have become unresponsive, you can call hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on hello deployment, which will leave untouched hello instances which had not yet been upgraded and rollback instances which had been upgraded toohello previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="b03d2-268">Initierar flera mutating åtgärder på ett pågående distribution</span><span class="sxs-lookup"><span data-stu-id="b03d2-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="b03d2-269">I vissa fall kanske du vill tooinitiate flera samtidiga mutating åtgärder på ett pågående distribution.</span><span class="sxs-lookup"><span data-stu-id="b03d2-269">In some cases you may want tooinitiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="b03d2-270">Exempelvis kan du utföra en uppdatering på tjänsten och medan uppdateringen samlas över din tjänst du vill toomake har ändrats, t.ex. tooroll hello uppdateringen igen, använda en annan uppdatering eller ta bort hello-distribution.</span><span class="sxs-lookup"><span data-stu-id="b03d2-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want toomake some change, e.g. tooroll hello update back, apply a different update, or even delete hello deployment.</span></span> <span data-ttu-id="b03d2-271">Om en Serviceuppgradering av innehåller buggy koden som orsakar en uppgraderad rollen instans toorepeatedly krasch är ett ärende där du kan behöva.</span><span class="sxs-lookup"><span data-stu-id="b03d2-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance toorepeatedly crash.</span></span> <span data-ttu-id="b03d2-272">I det här fallet hello Azure-Infrastrukturkontrollanten inte kan toomake förlopp vid tillämpning av uppgradera eftersom ett otillräckligt antal instanser i hello uppgraderade domän är felfria.</span><span class="sxs-lookup"><span data-stu-id="b03d2-272">In this case, hello Azure Fabric Controller will not be able toomake progress in applying that upgrade because an insufficient number of instances in hello upgraded domain are healthy.</span></span> <span data-ttu-id="b03d2-273">Det här tillståndet är refererad tooas en *fastnat distribution*.</span><span class="sxs-lookup"><span data-stu-id="b03d2-273">This state is referred tooas a *stuck deployment*.</span></span> <span data-ttu-id="b03d2-274">Du kan få loss hello distributionen genom att återställa hello uppdatering eller använda en ny uppdatering över överkant hello misslyckas en.</span><span class="sxs-lookup"><span data-stu-id="b03d2-274">You can unstick hello deployment by rolling back hello update or applying a fresh update over top of hello failing one.</span></span>

<span data-ttu-id="b03d2-275">När hello första begäran tooupdate eller uppgradering hello-tjänsten har tagits emot av hello Azure-Infrastrukturkontrollanten, kan du börja efterföljande mutera åtgärder.</span><span class="sxs-lookup"><span data-stu-id="b03d2-275">Once hello initial request tooupdate or upgrade hello service has been received by hello Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="b03d2-276">Det vill säga har du inte toowait för hello inledande åtgärden toocomplete innan du kan starta en annan mutating åtgärd.</span><span class="sxs-lookup"><span data-stu-id="b03d2-276">That is, you do not have toowait for hello initial operation toocomplete before you can start another mutating operation.</span></span>

<span data-ttu-id="b03d2-277">Initierar en andra uppdateringsåtgärd medan hello första uppdateringen pågår utför liknande toohello rollback-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="b03d2-277">Initiating a second update operation while hello first update is ongoing will perform similar toohello rollback operation.</span></span> <span data-ttu-id="b03d2-278">Om hello andra uppdateringen i automatiskt läge hello första uppgraderingsdomänen uppgraderas omedelbart, eventuellt inledande tooinstances från flera uppgraderingsdomäner är offline på hello samma punkt i tid.</span><span class="sxs-lookup"><span data-stu-id="b03d2-278">If hello second update is in automatic mode, hello first upgrade domain will be upgraded immediately, possibly leading tooinstances from multiple upgrade domains being offline at hello same point in time.</span></span>

<span data-ttu-id="b03d2-279">hello mutera operations är följande: [ändra distributionskonfiguration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Uppgraderingsdistribution](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Distributionsstatus](https://msdn.microsoft.com/library/azure/ee460808.aspx), [ta bort Distribution](https://msdn.microsoft.com/library/azure/ee460815.aspx), och [återställning uppdatering eller uppgradering av](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="b03d2-279">hello mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="b03d2-280">Två åtgärder [hämta distribution](https://msdn.microsoft.com/library/azure/ee460804.aspx) och [hämta egenskaper för moln](https://msdn.microsoft.com/library/azure/ee460806.aspx), returnera hello låst flagga som kan vara undersökas toodetermine om en mutating åtgärden kan anropas på en viss distribution.</span><span class="sxs-lookup"><span data-stu-id="b03d2-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return hello Locked flag which can be examined toodetermine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="b03d2-281">I ordning toocall hello versionen av dessa metoder som returnerar hello låst flaggan, måste du ange huvudet i begäran för ”x-ms-version: 2011-10-01” eller en senare.</span><span class="sxs-lookup"><span data-stu-id="b03d2-281">In order toocall hello version of these methods which returns hello Locked flag, you must set request header too“x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="b03d2-282">Mer information om versionshantering huvuden finns [Management Versionhantering](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="b03d2-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="b03d2-283">Distributionen av roller uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="b03d2-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="b03d2-284">Azure fördelar instanser av en roll jämnt över ett antal uppgraderingsdomäner som kan konfigureras som en del av hello tjänstdefinitionsfilen (.csdef).</span><span class="sxs-lookup"><span data-stu-id="b03d2-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of hello service definition (.csdef) file.</span></span> <span data-ttu-id="b03d2-285">Hej max antal uppgraderingsdomäner är 20 hello standardvärdet är 5.</span><span class="sxs-lookup"><span data-stu-id="b03d2-285">hello max number of upgrade domains is 20 and hello default is 5.</span></span> <span data-ttu-id="b03d2-286">Läs mer om hur toomodify hello tjänstdefinitionsfilen [Azure Service Definition schemat (.csdef-fil)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="b03d2-286">For more information about how toomodify hello service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="b03d2-287">Till exempel om din roll har tio instanser kan innehåller som standard varje uppgraderingsdomänen två instanser.</span><span class="sxs-lookup"><span data-stu-id="b03d2-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="b03d2-288">Om din roll har 14 instanser fyra hello uppgraderingsdomäner innehåller tre instanser och en femte domän innehåller två.</span><span class="sxs-lookup"><span data-stu-id="b03d2-288">If your role has 14 instances, then four of hello upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="b03d2-289">Uppgraderingsdomäner identifieras med ett Nollbaserat index: hello första uppgraderingsdomänen har ett ID 0 och hello andra uppgraderingsdomänen har ID 1 och så vidare.</span><span class="sxs-lookup"><span data-stu-id="b03d2-289">Upgrade domains are identified with a zero-based index: hello first upgrade domain has an ID of 0, and hello second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="b03d2-290">hello följande diagram illustrerar hur en tjänst än innehåller två roller ska distribueras när hello service definierar två uppgraderingsdomäner.</span><span class="sxs-lookup"><span data-stu-id="b03d2-290">hello following diagram illustrates how a service than contains two roles are distributed when hello service defines two upgrade domains.</span></span> <span data-ttu-id="b03d2-291">hello-tjänsten körs åtta instanser av hello-webbroll och nio instanser av hello worker-rollen.</span><span class="sxs-lookup"><span data-stu-id="b03d2-291">hello service is running eight instances of hello web role and nine instances of hello worker role.</span></span>

<span data-ttu-id="b03d2-292">![Distribution av Uppgraderingsdomäner](media/cloud-services-update-azure-service/IC345533.png "Distribution av Uppgraderingsdomäner")</span><span class="sxs-lookup"><span data-stu-id="b03d2-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="b03d2-293">Observera att Azure styr hur instanser fördelade över uppgraderingsdomäner.</span><span class="sxs-lookup"><span data-stu-id="b03d2-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="b03d2-294">Det är inte möjligt toospecify vilka instanser som är allokerade toowhich domän.</span><span class="sxs-lookup"><span data-stu-id="b03d2-294">It's not possible toospecify which instances are allocated toowhich domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="b03d2-295">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="b03d2-295">Next steps</span></span>
[<span data-ttu-id="b03d2-296">Hur tooManage Cloud Services</span><span class="sxs-lookup"><span data-stu-id="b03d2-296">How tooManage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="b03d2-297">Hur tooMonitor Cloud Services</span><span class="sxs-lookup"><span data-stu-id="b03d2-297">How tooMonitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="b03d2-298">Hur tooConfigure Cloud Services</span><span class="sxs-lookup"><span data-stu-id="b03d2-298">How tooConfigure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
