---
title: "Felsöka Cloud Services med Programinsikter | Microsoft Docs"
description: "Lär dig hur du felsöker problem med cloud service med hjälp av Application Insights för bearbetning av data från Azure-diagnostik."
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/23/2017
ms.author: saurabh
ms.openlocfilehash: 4001ca908ff00b1a40829d687589080e9b07b18a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="5208e-103">Felsöka molntjänster med hjälp av Application Insights</span><span class="sxs-lookup"><span data-stu-id="5208e-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="5208e-104">Med [Azure SDK 2.8](https://azure.microsoft.com/downloads/) och tillägg för Azure-diagnostik 1.5, du kan skicka data i Azure-diagnostik för din molntjänst direkt till Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5208e-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5, you can send Azure Diagnostics data for your Cloud Service directly to Application Insights.</span></span> <span data-ttu-id="5208e-105">Loggarna samlas in av Azure-diagnostik&mdash;inklusive programloggarna, Windows-händelseloggar, ETW-loggar och prestandaräknare&mdash;kan skickas till Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5208e-105">The logs collected by Azure Diagnostics&mdash;including application logs, Windows Event Logs, ETW Logs, and performance counters&mdash;can be sent to Application Insights.</span></span> <span data-ttu-id="5208e-106">Sedan kan du visualisera informationen i Användargränssnittet för Application Insights-portalen.</span><span class="sxs-lookup"><span data-stu-id="5208e-106">You can then visualize this information in the Application Insights portal UI.</span></span> <span data-ttu-id="5208e-107">Du kan sedan använda Application Insights SDK för att få insikter om mått och loggar som kommer från ditt program samt system och data för infrastruktur-nivå som kommer från Azure-diagnostik.</span><span class="sxs-lookup"><span data-stu-id="5208e-107">You can then use the Application Insights SDK to get insights into metrics and logs that come from your application, as well as the system and infrastructure-level data that comes from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-to-send-data-to-application-insights"></a><span data-ttu-id="5208e-108">Konfigurera Azure-diagnostik för att skicka data till Application Insights</span><span class="sxs-lookup"><span data-stu-id="5208e-108">Configure Azure Diagnostics to send data to Application Insights</span></span>
<span data-ttu-id="5208e-109">Följ dessa steg för att konfigurera ditt molntjänstprojekt Azure Diagnostics data ska skickas till Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5208e-109">Follow these steps to set up your cloud service project to send Azure Diagnostics data to Application Insights.</span></span>

1. <span data-ttu-id="5208e-110">Högerklicka på en roll i Visual Studio Solution Explorer och markera **egenskaper** att öppna designern roll.</span><span class="sxs-lookup"><span data-stu-id="5208e-110">In Visual Studio Solution Explorer, right-click a role and select **Properties** to open the Role designer.</span></span>

    ![Solution Explorer rollegenskaper][1]

2. <span data-ttu-id="5208e-112">I den **diagnostik** avsnitt av rollen designer väljer den **skicka diagnostikdata till Application Insights** alternativet.</span><span class="sxs-lookup"><span data-stu-id="5208e-112">In the **Diagnostics** section of the Role designer, select the **Send diagnostics data to Application Insights** option.</span></span>

    ![Rollen designer skicka diagnostikdata till application insights][2]

3. <span data-ttu-id="5208e-114">I dialogrutan som öppnas väljer du Application Insights-resursen som du vill skicka data till Azure-diagnostik.</span><span class="sxs-lookup"><span data-stu-id="5208e-114">In the dialog box that pops up, select the Application Insights resource that you want to send the Azure diagnostics data to.</span></span> <span data-ttu-id="5208e-115">Dialogrutan kan du välja en befintlig Application Insights-resurs från prenumerationen eller manuellt ange en instrumentation nyckel för Application Insights-resurs.</span><span class="sxs-lookup"><span data-stu-id="5208e-115">The dialog box allows you to select an existing Application Insights resource from your subscription or to manually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="5208e-116">Mer information om hur du skapar en Application Insights-resursen finns [skapar en ny Application Insights-resurs](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="5208e-116">For more information on creating an Application Insights resource, see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md).</span></span>

    ![Välj application insights-resurs][3]

    <span data-ttu-id="5208e-118">När du har lagt till Application Insights-resursen instrumentation nyckeln för den här resursen lagras som en konfigurationsinställning för tjänst med namnet **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="5208e-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="5208e-119">Du kan ändra Konfigurationsinställningen för varje tjänstkonfiguration eller miljö.</span><span class="sxs-lookup"><span data-stu-id="5208e-119">You can change this configuration setting for each service configuration or environment.</span></span> <span data-ttu-id="5208e-120">Om du vill göra det, Välj en annan konfiguration från den **tjänstkonfiguration** listan och ange en ny instrumentation nyckel för denna konfiguration.</span><span class="sxs-lookup"><span data-stu-id="5208e-120">To do so, select a different configuration from the **Service Configuration** list and specify a new instrumentation key for that configuration.</span></span>

    ![Välj tjänstkonfiguration][4]

    <span data-ttu-id="5208e-122">Den **APPINSIGHTS_INSTRUMENTATIONKEY** Konfigurationsinställningen används av Visual Studio för att konfigurera diagnostik-tillägget med lämpliga resursinformationen Application Insights vid publicering.</span><span class="sxs-lookup"><span data-stu-id="5208e-122">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="5208e-123">Konfigurationsinställningen är ett bekvämt sätt att definiera olika instrumentation nycklar för olika konfigurationer.</span><span class="sxs-lookup"><span data-stu-id="5208e-123">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="5208e-124">Visual Studio kommer översätta inställningen och infoga i diagnostik tilläggets offentliga konfiguration under publiceringsprocessen.</span><span class="sxs-lookup"><span data-stu-id="5208e-124">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration during the publish process.</span></span> <span data-ttu-id="5208e-125">Paketet utdata från Visual Studio innehåller också offentliga konfiguration XML med lämplig Application Insights instrumentation nyckel för att förenkla konfigureringen av tillägget diagnostik med PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5208e-125">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key.</span></span> <span data-ttu-id="5208e-126">Offentliga config-filer som skapas i mappen tillägg och följer mönstret *PaaSDiagnostics.&lt; RoleName&gt;. PubConfig.xml*.</span><span class="sxs-lookup"><span data-stu-id="5208e-126">The public config files are created in the Extensions folder and follow the pattern *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span></span> <span data-ttu-id="5208e-127">PowerShell-baserade distributioner kan använda det här mönstret för att mappa varje konfiguration till en roll.</span><span class="sxs-lookup"><span data-stu-id="5208e-127">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span></span>

4) <span data-ttu-id="5208e-128">För att konfigurera Azure-diagnostik för att skicka alla prestandaräknare och Felnivån loggar som samlas in av Azure-diagnostik agenten till Application Insights, aktivera den **skicka diagnostikdata till Application Insights** alternativet.</span><span class="sxs-lookup"><span data-stu-id="5208e-128">To configure Azure diagnostics to send all performance counters and error-level logs collected by the Azure diagnostics agent to Application Insights, enable the **Send diagnostics data to Application Insights** option.</span></span> 

    <span data-ttu-id="5208e-129">Om du vill konfigurera ytterligare vilka data skickas till Application Insights, måste du manuellt redigera den *diagnostics.wadcfgx* fil för varje roll.</span><span class="sxs-lookup"><span data-stu-id="5208e-129">If you want to further configure what data is sent to Application Insights, you must manually edit the *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="5208e-130">Se [konfigurera Azure-diagnostik att skicka data till Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) att lära dig mer om att manuellt uppdatera konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="5208e-130">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span></span>

<span data-ttu-id="5208e-131">När Molntjänsten är konfigurerad för att skicka Azure-diagnostikdata till application insights, kan du distribuera den till Azure normalt, kontrollera att tillägget för Azure-diagnostik är aktiverat.</span><span class="sxs-lookup"><span data-stu-id="5208e-131">When the cloud service is configured to send Azure diagnostics data to application insights, you can deploy it to Azure normally, making sure the Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="5208e-132">Mer information finns i [publicering av en tjänst i molnet med hjälp av Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="5208e-132">For more information, see  [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="5208e-133">Visa data i Azure-diagnostik i Application Insights</span><span class="sxs-lookup"><span data-stu-id="5208e-133">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="5208e-134">Azure diagnostisk telemetri visas i Application Insights-resurs som konfigurerats för Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="5208e-134">The Azure diagnostic telemetry shows up in the Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="5208e-135">Azure diagnostics logga typer karta till Application Insights begrepp på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="5208e-135">Azure diagnostics log types map to Application Insights concepts in these ways:</span></span>

* <span data-ttu-id="5208e-136">Prestandaräknare visas som anpassade mått i Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5208e-136">Performance counters are displayed as Custom Metrics in Application Insights.</span></span>
* <span data-ttu-id="5208e-137">Windows-händelseloggar visas som spårningar och anpassade händelser i Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5208e-137">Windows Event Logs are shown as Traces and Custom Events in Application Insights.</span></span>
* <span data-ttu-id="5208e-138">Program loggar, ETW-loggar och diagnostik infrastruktur loggar visas som spåren i Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5208e-138">Application logs, ETW logs, and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="5208e-139">Om du vill visa data i Azure-diagnostik i Application Insights gör du något av följande:</span><span class="sxs-lookup"><span data-stu-id="5208e-139">To view Azure diagnostics data in Application Insights, do one of the following:</span></span>

* <span data-ttu-id="5208e-140">Använd [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) visualisera alla anpassade prestandaräknare eller ett antal olika typer av händelser i händelseloggen i Windows.</span><span class="sxs-lookup"><span data-stu-id="5208e-140">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of Windows Event Log events.</span></span>

    ![Anpassade mått i Metrics Explorer][5]

* <span data-ttu-id="5208e-142">Använd [Sök](../application-insights/app-insights-diagnostic-search.md) att söka i spårningsloggar som skickas av Azure-diagnostik.</span><span class="sxs-lookup"><span data-stu-id="5208e-142">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the  trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="5208e-143">Till exempel om ett ohanterat undantag har orsakat rollen till krascher och återanvänd, information om undantaget visas i den *programmet* kanal för *Windows-händelseloggen*.</span><span class="sxs-lookup"><span data-stu-id="5208e-143">For example, if an unhandled exception has caused the role to crash and recycle, information about the exception shows up in the *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="5208e-144">Du kan använda Sök för att titta i händelseloggen i Windows-fel och få fullständig stackspårningen för undantaget för att hitta orsaken till problemet.</span><span class="sxs-lookup"><span data-stu-id="5208e-144">You can use search to look at the Windows Event Log error and get the full stack trace for the exception to help find the cause of the issue.</span></span>

    ![Sök spårningar][6]

## <a name="next-steps"></a><span data-ttu-id="5208e-146">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="5208e-146">Next Steps</span></span>
* <span data-ttu-id="5208e-147">[Lägg till Application Insights SDK i din molntjänst](../application-insights/app-insights-cloudservices.md) att skicka information om begäranden, undantag, beroenden och eventuella anpassade telemetri från ditt program.</span><span class="sxs-lookup"><span data-stu-id="5208e-147">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="5208e-148">När den kombineras med Azure-diagnostik data den här informationen kan du få en fullständig överblick över dina program och system i samma Application Insights-resurs.</span><span class="sxs-lookup"><span data-stu-id="5208e-148">When combined with the Azure Diagnostics data, this information you can get a complete view of your application and system, all in the same Application Insight resource.</span></span>  

<!--Image references-->
[1]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png
