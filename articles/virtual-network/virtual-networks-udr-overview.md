---
title: "aaaUser användardefinierade vägar och IP-vidarebefordran i Azure | Microsoft Docs"
description: "Lär dig hur tooconfigure användardefinierade vägar (UDR) och IP-vidarebefordran tooforward trafik toonetwork virtuella installationer i Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="ed69a-103">Användardefinierade vägar och IP-vidarebefordran</span><span class="sxs-lookup"><span data-stu-id="ed69a-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="ed69a-104">När du lägger till virtuella datorer (VM) tooa virtuella nätverk (VNet) i Azure, ser du att hello är kan toocommunicate med varandra över hello nätverk automatiskt.</span><span class="sxs-lookup"><span data-stu-id="ed69a-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="ed69a-105">Du behöver inte toospecify en gateway, även om hello virtuella datorer i olika undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="ed69a-106">hello samma sak gäller för kommunikation från hello VMs toohello offentliga Internet och även tooyour lokala nätverk när en hybridanslutning från Azure tooyour eget datacenter finns.</span><span class="sxs-lookup"><span data-stu-id="ed69a-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="ed69a-107">Det här flödet av kommunikation är möjligt eftersom Azure använder en uppsättning system vägar toodefine hur IP-trafiken flödar.</span><span class="sxs-lookup"><span data-stu-id="ed69a-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="ed69a-108">Systemvägar kontrollerar hello kommunikationsflödet i hello följande scenarier:</span><span class="sxs-lookup"><span data-stu-id="ed69a-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="ed69a-109">Inifrån hello i samma undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-109">From within hello same subnet.</span></span>
* <span data-ttu-id="ed69a-110">Från ett undernät tooanother inom ett VNet.</span><span class="sxs-lookup"><span data-stu-id="ed69a-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="ed69a-111">Från virtuella datorer toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="ed69a-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="ed69a-112">Från ett VNet tooanother virtuella nätverk via en VPN-gateway.</span><span class="sxs-lookup"><span data-stu-id="ed69a-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="ed69a-113">Från ett VNet tooanother virtuella nätverk via VNet-Peering (Service länkning).</span><span class="sxs-lookup"><span data-stu-id="ed69a-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="ed69a-114">Från ett VNet tooyour lokalt nätverk via en VPN-gateway.</span><span class="sxs-lookup"><span data-stu-id="ed69a-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="ed69a-115">hello bilden nedan visar en enkel installation med ett VNet, två undernät och ett fåtal virtuella datorer tillsammans med hello systemvägar som låter IP-trafik tooflow.</span><span class="sxs-lookup"><span data-stu-id="ed69a-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Systemvägar i Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="ed69a-117">Även om hello användningen av systemvägar förenklar trafik automatiskt för din distribution, finns det fall där du vill toocontrol hello routning av paket via en virtuell installation.</span><span class="sxs-lookup"><span data-stu-id="ed69a-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="ed69a-118">Du kan därför genom att skapa användardefinierade vägar som anger hello next hop för paket som flödar tooa undernätverk toogo tooyour virtuell installation i stället och aktivera IP-vidarebefordring för hello VM som körs som hello virtuell installation.</span><span class="sxs-lookup"><span data-stu-id="ed69a-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="ed69a-119">hello bilden nedan visar ett exempel på användardefinierade vägar och IP-vidarebefordring tooforce paket skickas tooone undernät från en annan toogo via en virtuell installation på ett tredje undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Systemvägar i Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="ed69a-121">Användardefinierade vägar är tillämpade tootraffic lämnar ett undernät från alla resurser (t.ex. nätverksgränssnitt ansluten tooVMs) i hello undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="ed69a-122">Du kan inte skapa vägar toospecify hur trafik försätts i ett undernät från hello Internet, t.ex.</span><span class="sxs-lookup"><span data-stu-id="ed69a-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="ed69a-123">hello-enheten som du vidarebefordrar trafik toocannot finnas i hello samma undernät där hello trafiken kommer från.</span><span class="sxs-lookup"><span data-stu-id="ed69a-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="ed69a-124">Skapa alltid ett separat undernät för dina installationer.</span><span class="sxs-lookup"><span data-stu-id="ed69a-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="ed69a-125">Routeresurs</span><span class="sxs-lookup"><span data-stu-id="ed69a-125">Route resource</span></span>
<span data-ttu-id="ed69a-126">Paketen dirigeras över ett TCP/IP-nätverk baserat på en routingtabell som definierats vid varje nod i hello fysiska nätverk.</span><span class="sxs-lookup"><span data-stu-id="ed69a-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="ed69a-127">En routingtabell är en samling individuella vägare används toodecide där tooforward paket utifrån hello mål IP-adress.</span><span class="sxs-lookup"><span data-stu-id="ed69a-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="ed69a-128">En väg består av hello följande:</span><span class="sxs-lookup"><span data-stu-id="ed69a-128">A route consists of hello following:</span></span>

| <span data-ttu-id="ed69a-129">Egenskap</span><span class="sxs-lookup"><span data-stu-id="ed69a-129">Property</span></span> | <span data-ttu-id="ed69a-130">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="ed69a-130">Description</span></span> | <span data-ttu-id="ed69a-131">Villkor</span><span class="sxs-lookup"><span data-stu-id="ed69a-131">Constraints</span></span> | <span data-ttu-id="ed69a-132">Överväganden</span><span class="sxs-lookup"><span data-stu-id="ed69a-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ed69a-133">Adressprefix</span><span class="sxs-lookup"><span data-stu-id="ed69a-133">Address Prefix</span></span> |<span data-ttu-id="ed69a-134">hello CIDR toowhich hello målvägen gäller till exempel 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="ed69a-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="ed69a-135">Måste vara ett giltigt CIDR-intervall som representerar adresser på hello offentliga Internet, Azure-nätverk eller lokala datacenter.</span><span class="sxs-lookup"><span data-stu-id="ed69a-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="ed69a-136">Se till att hello **adressprefixet** innehåller inte hello-adress för hello **för nästa hopp**, annars hamnar dina paket i en evig loop från källan hello toohello nexthop utan att någonsin nå hello mål.</span><span class="sxs-lookup"><span data-stu-id="ed69a-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="ed69a-137">Nexthop-typ</span><span class="sxs-lookup"><span data-stu-id="ed69a-137">Next hop type</span></span> |<span data-ttu-id="ed69a-138">hello typ av Azure-hop hello paketet ska skickas till.</span><span class="sxs-lookup"><span data-stu-id="ed69a-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="ed69a-139">Måste vara något av följande värden hello:</span><span class="sxs-lookup"><span data-stu-id="ed69a-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="ed69a-140">**Virtuellt nätverk**.</span><span class="sxs-lookup"><span data-stu-id="ed69a-140">**Virtual Network**.</span></span> <span data-ttu-id="ed69a-141">Representerar hello lokala virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="ed69a-141">Represents hello local virtual network.</span></span> <span data-ttu-id="ed69a-142">Till exempel om du har två undernät, 10.1.0.0/16 och 10.2.0.0/16 i hello samma virtuella nätverk måste hello vägen för varje undernät i vägtabellen hello nexthop-värdet för *virtuellt nätverk*.</span><span class="sxs-lookup"><span data-stu-id="ed69a-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="ed69a-143">**Virtuell nätverksgateway**.</span><span class="sxs-lookup"><span data-stu-id="ed69a-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="ed69a-144">Representerar en Azure S2S VPN-gateway.</span><span class="sxs-lookup"><span data-stu-id="ed69a-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="ed69a-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="ed69a-145">**Internet**.</span></span> <span data-ttu-id="ed69a-146">Representerar hello Internet standardgateway som tillhandahålls av hello Azure-infrastrukturen.</span><span class="sxs-lookup"><span data-stu-id="ed69a-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="ed69a-147">**Virtuell installation**.</span><span class="sxs-lookup"><span data-stu-id="ed69a-147">**Virtual Appliance**.</span></span> <span data-ttu-id="ed69a-148">Representerar en virtuell installation som du har lagt till tooyour virtuella Azure-nätverket.</span><span class="sxs-lookup"><span data-stu-id="ed69a-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="ed69a-149">**Ingen**.</span><span class="sxs-lookup"><span data-stu-id="ed69a-149">**None**.</span></span> <span data-ttu-id="ed69a-150">Representerar ett svart hål.</span><span class="sxs-lookup"><span data-stu-id="ed69a-150">Represents a black hole.</span></span> <span data-ttu-id="ed69a-151">Paket som vidarebefordras tooa svart hål vidarebefordras inte alls.</span><span class="sxs-lookup"><span data-stu-id="ed69a-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="ed69a-152">Överväg att använda **virtuell installation** toodirect trafik tooa VM eller Azure belastningsutjämnare interna IP-adress.</span><span class="sxs-lookup"><span data-stu-id="ed69a-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="ed69a-153">Den här typen kan hello specificering av en IP-adress som beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="ed69a-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="ed69a-154">Överväg att använda en **ingen** skriver toostop paket från flödet tooa givet mål.</span><span class="sxs-lookup"><span data-stu-id="ed69a-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="ed69a-155">Nexthop-adress</span><span class="sxs-lookup"><span data-stu-id="ed69a-155">Next hop address</span></span> |<span data-ttu-id="ed69a-156">hello nästa hoppadress innehåller hello IP-adressen som paket ska vidarebefordras till.</span><span class="sxs-lookup"><span data-stu-id="ed69a-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="ed69a-157">Nexthop-värden tillåts bara i vägar där hello nästa hopptyp är *virtuell installation*.</span><span class="sxs-lookup"><span data-stu-id="ed69a-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="ed69a-158">Måste vara en IP-adress som kan nås i hello virtuellt nätverk där hello användardefinierad väg används, utan att gå via en **virtuell nätverksgateway**.</span><span class="sxs-lookup"><span data-stu-id="ed69a-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="ed69a-159">hello IP-adress har toobe på hello samma virtuella nätverk där den används, eller på ett peered virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="ed69a-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="ed69a-160">Om hello IP-adressen representerar en virtuell dator, kontrollera att du aktiverar [IP-vidarebefordring](#IP-forwarding) i Azure för hello VM.</span><span class="sxs-lookup"><span data-stu-id="ed69a-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="ed69a-161">Om hello IP-adress representerar hello interna IP-adressen för Azure belastningsutjämnare, kontrollera att du har en matchande regel för varje port för belastningsutjämning vill tooload saldo.</span><span class="sxs-lookup"><span data-stu-id="ed69a-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="ed69a-162">Vissa hello ”NextHopType” värden har olika namn i Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="ed69a-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="ed69a-163">Virtuellt nätverk är VnetLocal</span><span class="sxs-lookup"><span data-stu-id="ed69a-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="ed69a-164">Virtuell nätverksgateway är VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="ed69a-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="ed69a-165">Virtuell tillämpning är VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="ed69a-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="ed69a-166">Internet är Internet</span><span class="sxs-lookup"><span data-stu-id="ed69a-166">Internet is Internet</span></span>
* <span data-ttu-id="ed69a-167">Ingen är Ingen</span><span class="sxs-lookup"><span data-stu-id="ed69a-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="ed69a-168">Systemvägar</span><span class="sxs-lookup"><span data-stu-id="ed69a-168">System routes</span></span>
<span data-ttu-id="ed69a-169">Varje undernät som skapats i ett virtuellt nätverk ansluts automatiskt till en routingtabell som innehåller hello följande regler för systemvägar:</span><span class="sxs-lookup"><span data-stu-id="ed69a-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="ed69a-170">**Lokal VNet-regel**: Den här regeln skapas automatiskt för varje undernät i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="ed69a-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="ed69a-171">Det anger att det finns en direktlänk mellan hello virtuella datorer i hello VNet och det inte finns något mellanliggande nexthop.</span><span class="sxs-lookup"><span data-stu-id="ed69a-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="ed69a-172">**Lokal regel**: den här regeln gäller tooall trafik toohello lokala adressintervallet och använder VPN-gateway som hello nästa hopp-mål.</span><span class="sxs-lookup"><span data-stu-id="ed69a-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="ed69a-173">**Regel för Internet**: den här regeln hanterar all trafik toohello offentliga Internet (adress prefixet 0.0.0.0/0) och använder hello infrastrukturens internet-gateway som hello nästa hopp för all trafik toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="ed69a-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="ed69a-174">Användardefinierade vägar</span><span class="sxs-lookup"><span data-stu-id="ed69a-174">User-defined routes</span></span>
<span data-ttu-id="ed69a-175">I de flesta miljöer behöver du bara hello systemvägarna som definierats av Azure.</span><span class="sxs-lookup"><span data-stu-id="ed69a-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="ed69a-176">Du kan dock behöver toocreate en routingtabell och lägga till en eller flera vägar i vissa fall, som:</span><span class="sxs-lookup"><span data-stu-id="ed69a-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="ed69a-177">Tvingad tunneltrafik toohello Internet via ditt lokala nätverk.</span><span class="sxs-lookup"><span data-stu-id="ed69a-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="ed69a-178">Använda virtuella installationer i din Azure-miljö.</span><span class="sxs-lookup"><span data-stu-id="ed69a-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="ed69a-179">I ovanstående hello scenarier, du har toocreate en routingtabell och lägga till användardefinierade vägar tooit.</span><span class="sxs-lookup"><span data-stu-id="ed69a-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="ed69a-180">Du kan ha flera vägtabeller och hello samma routingtabell kan vara associerade tooone eller flera undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="ed69a-181">Och varje undernät kan bara vara associerad tooa enda vägtabell.</span><span class="sxs-lookup"><span data-stu-id="ed69a-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="ed69a-182">Alla virtuella datorer och molntjänster i ett undernät kan du använda hello flödet tabellen associerad toothat undernätet.</span><span class="sxs-lookup"><span data-stu-id="ed69a-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="ed69a-183">Undernät förlitar sig på systemvägar tills en routingtabell är associerade toohello undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="ed69a-184">När det finns en koppling, så sköts routningen baserat på längsta prefix-matchning (LPM) bland användardefinierade vägar och systemvägar.</span><span class="sxs-lookup"><span data-stu-id="ed69a-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="ed69a-185">Om det finns baserat fler än en väg med samma LPM matchar sedan väljs en väg hello på dess ursprung i hello följande ordning:</span><span class="sxs-lookup"><span data-stu-id="ed69a-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="ed69a-186">Användardefinierad väg</span><span class="sxs-lookup"><span data-stu-id="ed69a-186">User defined route</span></span>
2. <span data-ttu-id="ed69a-187">BGP-väg (när ExpressRoute används)</span><span class="sxs-lookup"><span data-stu-id="ed69a-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="ed69a-188">Systemväg</span><span class="sxs-lookup"><span data-stu-id="ed69a-188">System route</span></span>

<span data-ttu-id="ed69a-189">toolearn hur toocreate användardefinierade vägar finns [hur tooCreate vägar och aktiverar IP-vidarebefordran i Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="ed69a-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ed69a-190">Användardefinierade vägar är endast tillämpade tooAzure virtuella datorer och molntjänster.</span><span class="sxs-lookup"><span data-stu-id="ed69a-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="ed69a-191">Till exempel om du vill tooadd en virtuell brandväggsinstallation mellan ditt lokala nätverk och Azure, behöver toocreate en användardefinierad väg för dina Azure-routningstabeller som vidarebefordrar all trafik toohello lokal adressutrymme toohello virtuella installation.</span><span class="sxs-lookup"><span data-stu-id="ed69a-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="ed69a-192">Du kan också lägga till en användardefinierad väg (UDR) toohello GatewaySubnet tooforward all trafik från lokala tooAzure via hello virtuell installation.</span><span class="sxs-lookup"><span data-stu-id="ed69a-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="ed69a-193">Det här är ett nytt tillägg.</span><span class="sxs-lookup"><span data-stu-id="ed69a-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="ed69a-194">BGP-vägar</span><span class="sxs-lookup"><span data-stu-id="ed69a-194">BGP routes</span></span>
<span data-ttu-id="ed69a-195">Om du har en ExpressRoute-anslutning mellan ditt lokala nätverk och Azure, kan du aktivera toopropagate BGP-vägar från ditt lokala nätverk tooAzure.</span><span class="sxs-lookup"><span data-stu-id="ed69a-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="ed69a-196">BGP-vägarna används i hello samma sätt som systemvägar och användaren definierats vägar i varje Azure-undernät.</span><span class="sxs-lookup"><span data-stu-id="ed69a-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="ed69a-197">Mer information finns i [Introduktion till ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="ed69a-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ed69a-198">Du kan konfigurera din Azure-miljön toouse Tvingad tunneltrafik via ditt lokala nätverk genom att skapa en användardefinierad väg för undernätet 0.0.0.0/0 som använder hello VPN-gateway som hello nästa hopp.</span><span class="sxs-lookup"><span data-stu-id="ed69a-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="ed69a-199">Det fungerar dock bara om du använder en VPN-gateway, inte ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ed69a-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="ed69a-200">Tvingad tunneling med ExpressRoute konfigureras via BGP.</span><span class="sxs-lookup"><span data-stu-id="ed69a-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="ed69a-201">IP-vidarebefordran</span><span class="sxs-lookup"><span data-stu-id="ed69a-201">IP forwarding</span></span>
<span data-ttu-id="ed69a-202">Som beskrivs ovan, en hello huvudsakliga skälen toocreate är en användardefinierad väg tooforward trafik tooa virtuell installation.</span><span class="sxs-lookup"><span data-stu-id="ed69a-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="ed69a-203">En virtuell installation finns inget mer än en virtuell dator som kör ett program som används för toohandle nätverkstrafik på något sätt, till exempel en brandvägg eller NAT-enhet.</span><span class="sxs-lookup"><span data-stu-id="ed69a-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="ed69a-204">Den här virtuella installations VM måste vara kan tooreceive inkommande trafik som är adresserad inte tooitself.</span><span class="sxs-lookup"><span data-stu-id="ed69a-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="ed69a-205">tooallow en tooreceive VM-trafik adresserad tooother mål, måste du aktivera IP-vidarebefordring för hello VM.</span><span class="sxs-lookup"><span data-stu-id="ed69a-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="ed69a-206">Det här är en Azure-inställning, inte en inställning i hello gästoperativsystemet.</span><span class="sxs-lookup"><span data-stu-id="ed69a-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ed69a-207">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="ed69a-207">Next steps</span></span>
* <span data-ttu-id="ed69a-208">Lär dig hur för[skapar vägar i Resource Manager-modellen hello](virtual-network-create-udr-arm-template.md) och kopplar dem till toosubnets.</span><span class="sxs-lookup"><span data-stu-id="ed69a-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="ed69a-209">Lär dig hur för[skapar vägar i hello klassiska distributionsmodellen](virtual-network-create-udr-classic-ps.md) och kopplar dem till toosubnets.</span><span class="sxs-lookup"><span data-stu-id="ed69a-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>

