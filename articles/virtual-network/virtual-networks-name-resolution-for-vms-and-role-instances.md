---
title: "Lösning för virtuella datorer och Rollinstanser"
description: "Namn på lösning scenarier för Azure IaaS hybridlösningar mellan olika cloud services, Active Directory och använder egna DNS-server "
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 479cf8cf358d0b242d8ce030d8639b493e4767d8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a><span data-ttu-id="71a6b-103">Name Resolution for VMs and Role Instances (Namnmatchning för virtuella datorer och rollinstanser)</span><span class="sxs-lookup"><span data-stu-id="71a6b-103">Name Resolution for VMs and Role Instances</span></span>
<span data-ttu-id="71a6b-104">Beroende på hur du använder Azure som värd för IaaS och PaaS hybridlösningar, kan du behöva tillåta virtuella datorer och rollinstanser som du skapar för att kommunicera med varandra.</span><span class="sxs-lookup"><span data-stu-id="71a6b-104">Depending on how you use Azure to host IaaS, PaaS, and hybrid solutions, you may need to allow the VMs and role instances that you create to communicate with each other.</span></span> <span data-ttu-id="71a6b-105">Även om den här kommunikationen kan göras med hjälp av IP-adresser, är det mycket enklare att använda namn som enkelt kan registreras och ändras inte.</span><span class="sxs-lookup"><span data-stu-id="71a6b-105">Although this communication can be done by using IP addresses, it is much simpler to use names that can be easily remembered and do not change.</span></span> 

<span data-ttu-id="71a6b-106">När rollinstanser och virtuella datorer finns i Azure måste matcha domännamn och interna IP-adresser, kan de använda ett av två sätt:</span><span class="sxs-lookup"><span data-stu-id="71a6b-106">When role instances and VMs hosted in Azure need to resolve domain names to internal IP addresses, they can use one of two methods:</span></span>

* [<span data-ttu-id="71a6b-107">Azure-tillhandahållna namnmatchning</span><span class="sxs-lookup"><span data-stu-id="71a6b-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* <span data-ttu-id="71a6b-108">[Namnmatchning med hjälp av DNS-servern](#name-resolution-using-your-own-dns-server) (som kan vidarebefordra frågor till Azure-tillhandahållna DNS-servrar)</span><span class="sxs-lookup"><span data-stu-id="71a6b-108">[Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server) (which may forward queries to the Azure-provided DNS servers)</span></span> 

<span data-ttu-id="71a6b-109">Typ av namnmatchning som du använder beror på hur dina virtuella datorer och rollinstanser måste kommunicera med varandra.</span><span class="sxs-lookup"><span data-stu-id="71a6b-109">The type of name resolution you use depends on how your VMs and role instances need to communicate with each other.</span></span>

<span data-ttu-id="71a6b-110">**Följande tabell visar scenarier och motsvarande name resolution lösningar:**</span><span class="sxs-lookup"><span data-stu-id="71a6b-110">**The following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="71a6b-111">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="71a6b-111">**Scenario**</span></span> | <span data-ttu-id="71a6b-112">**Lösning**</span><span class="sxs-lookup"><span data-stu-id="71a6b-112">**Solution**</span></span> | <span data-ttu-id="71a6b-113">**Suffix**</span><span class="sxs-lookup"><span data-stu-id="71a6b-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="71a6b-114">Namnmatchning mellan rollinstanser eller virtuella datorer finns i samma molntjänst eller virtuellt nätverk</span><span class="sxs-lookup"><span data-stu-id="71a6b-114">Name resolution between role instances or VMs located in the same cloud service or virtual network</span></span> |[<span data-ttu-id="71a6b-115">Azure-tillhandahållna namnmatchning</span><span class="sxs-lookup"><span data-stu-id="71a6b-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="71a6b-116">värdnamn eller fullständigt domännamn</span><span class="sxs-lookup"><span data-stu-id="71a6b-116">hostname or FQDN</span></span> |
| <span data-ttu-id="71a6b-117">Namnmatchning mellan rollinstanser eller virtuella datorer finns i olika virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="71a6b-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="71a6b-118">Kundhanterad DNS-servrar som vidarebefordrar frågor mellan vnet för matchning av Azure (DNS-proxy).</span><span class="sxs-lookup"><span data-stu-id="71a6b-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="71a6b-119">Se [namnmatchning med hjälp av DNS-servern](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="71a6b-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="71a6b-120">Endast FQDN</span><span class="sxs-lookup"><span data-stu-id="71a6b-120">FQDN only</span></span> |
| <span data-ttu-id="71a6b-121">Matchning av lokal dator- och namn från rollinstanser eller virtuella datorer i Azure</span><span class="sxs-lookup"><span data-stu-id="71a6b-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="71a6b-122">Kundhanterad DNS-servrar (t.ex. lokala domänkontrollant, lokala skrivskyddade domänkontrollanten eller en sekundär DNS synkroniseras med zonöverföringar).</span><span class="sxs-lookup"><span data-stu-id="71a6b-122">Customer-managed DNS servers (e.g. on-premises domain controller, local read-only domain controller or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="71a6b-123">Se [namnmatchning med hjälp av DNS-servern](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="71a6b-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="71a6b-124">Endast FQDN</span><span class="sxs-lookup"><span data-stu-id="71a6b-124">FQDN only</span></span> |
| <span data-ttu-id="71a6b-125">Lösning med Azure värdnamn från lokala datorer</span><span class="sxs-lookup"><span data-stu-id="71a6b-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="71a6b-126">Vidarebefordra frågor till en kundhanterad DNS-proxyserver i motsvarande vnet proxyserverns vidarebefordrar frågor till Azure för matchning.</span><span class="sxs-lookup"><span data-stu-id="71a6b-126">Forward queries to a customer-managed DNS proxy server in the corresponding vnet, the proxy server forwards queries to Azure for resolution.</span></span> <span data-ttu-id="71a6b-127">Se [namnmatchning med hjälp av DNS-servern](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="71a6b-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="71a6b-128">Endast FQDN</span><span class="sxs-lookup"><span data-stu-id="71a6b-128">FQDN only</span></span> |
| <span data-ttu-id="71a6b-129">Omvänd DNS för interna IP-adresser</span><span class="sxs-lookup"><span data-stu-id="71a6b-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="71a6b-130">Namnmatchning med hjälp av DNS-servern</span><span class="sxs-lookup"><span data-stu-id="71a6b-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="71a6b-131">Saknas</span><span class="sxs-lookup"><span data-stu-id="71a6b-131">n/a</span></span> |
| <span data-ttu-id="71a6b-132">Namnmatchning mellan VM: ar eller rollinstanser som finns i olika molntjänster, inte i ett virtuellt nätverk</span><span class="sxs-lookup"><span data-stu-id="71a6b-132">Name resolution between VMs or role instances located in different cloud services, not in a virtual network</span></span> |<span data-ttu-id="71a6b-133">Inte tillämpligt.</span><span class="sxs-lookup"><span data-stu-id="71a6b-133">Not applicable.</span></span> <span data-ttu-id="71a6b-134">Anslutningen mellan virtuella datorer och rollinstanser i olika molntjänster kan inte användas utanför ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="71a6b-134">Connectivity between VMs and role instances in different cloud services is not supported outside a virtual network.</span></span> |<span data-ttu-id="71a6b-135">Saknas</span><span class="sxs-lookup"><span data-stu-id="71a6b-135">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="71a6b-136">Azure-tillhandahållna namnmatchning</span><span class="sxs-lookup"><span data-stu-id="71a6b-136">Azure-provided name resolution</span></span>
<span data-ttu-id="71a6b-137">Tillsammans med upplösning på offentliga DNS-namn erbjuder Azure intern namnmatchning för virtuella datorer och rollinstanser som finns i samma virtuella nätverk eller tjänst i molnet.</span><span class="sxs-lookup"><span data-stu-id="71a6b-137">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within the same virtual network or cloud service.</span></span>  <span data-ttu-id="71a6b-138">Virtuella datorer/instanser i en molntjänst delar samma DNS-suffixet (så att enbart värdnamnet räcker) men i annat moln för klassiska virtuella nätverk tjänster har olika DNS-suffix så FQDN krävs för att matcha namn mellan olika molntjänster.</span><span class="sxs-lookup"><span data-stu-id="71a6b-138">VMs/instances in a cloud service share the same DNS suffix (so the hostname alone is sufficient) but in classic virtual networks different cloud services have different DNS suffixes so the FQDN is needed to resolve names between different cloud services.</span></span>  <span data-ttu-id="71a6b-139">DNS-suffix är konsekvent på det virtuella nätverket (så att FQDN inte behövs) och DNS-namn kan tilldelas till både nätverkskort och virtuella datorer i virtuella nätverk i Resource Manager-distributionsmodellen.</span><span class="sxs-lookup"><span data-stu-id="71a6b-139">In virtual networks in the Resource Manager deployment model, the DNS suffix is consistent across the virtual network (so the FQDN is not needed) and DNS names can be assigned to both NICs and VMs.</span></span> <span data-ttu-id="71a6b-140">Även om Azure-tillhandahållna namnmatchning inte kräver någon konfiguration, är det inte det bästa valet för alla distributionsscenarier, som visas i tabellen ovan.</span><span class="sxs-lookup"><span data-stu-id="71a6b-140">Although Azure-provided name resolution does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the table above.</span></span>

> [!NOTE]
> <span data-ttu-id="71a6b-141">Du kan också använda interna IP-adresserna för rollinstanser utifrån rollen namnet och instansen med hjälp av Azure Service Management REST API för webb- och arbetsroller roller.</span><span class="sxs-lookup"><span data-stu-id="71a6b-141">In the case of web and worker roles, you can also access the internal IP addresses of role instances based on the role name and instance number using the Azure Service Management REST API.</span></span> <span data-ttu-id="71a6b-142">Mer information finns i [Service Management REST API-referens](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span><span class="sxs-lookup"><span data-stu-id="71a6b-142">For more information, see [Service Management REST API Reference](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span></span>
> 
> 

### <a name="features-and-considerations"></a><span data-ttu-id="71a6b-143">Funktioner och överväganden</span><span class="sxs-lookup"><span data-stu-id="71a6b-143">Features and Considerations</span></span>
<span data-ttu-id="71a6b-144">**Funktioner:**</span><span class="sxs-lookup"><span data-stu-id="71a6b-144">**Features:**</span></span>

* <span data-ttu-id="71a6b-145">Användarvänlighet: ingen konfiguration krävs för att kunna använda Azure-tillhandahållna namnmatchning.</span><span class="sxs-lookup"><span data-stu-id="71a6b-145">Ease of use: No configuration is required in order to use Azure-provided name resolution.</span></span>
* <span data-ttu-id="71a6b-146">Azure-tillhandahållna namnmatchningstjänst har hög tillgänglighet, vilket sparar dig behovet av att skapa och hantera kluster DNS-servrar.</span><span class="sxs-lookup"><span data-stu-id="71a6b-146">The Azure-provided name resolution service is highly available, saving you the need to create and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="71a6b-147">Kan användas tillsammans med DNS-servrar för att matcha både lokalt och Azure värdnamn.</span><span class="sxs-lookup"><span data-stu-id="71a6b-147">Can be used in conjunction with your own DNS servers to resolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="71a6b-148">Namnmatchning tillhandahålls mellan rollen instanser/virtuella datorer i samma molntjänst utan behov av ett FQDN.</span><span class="sxs-lookup"><span data-stu-id="71a6b-148">Name resolution is provided between role instances/VMs within the same cloud service without need for a FQDN.</span></span>
* <span data-ttu-id="71a6b-149">Namnmatchning tillhandahålls mellan virtuella datorer i virtuella nätverk som använder Resource Manager distributionsmodellen, utan behov av FQDN.</span><span class="sxs-lookup"><span data-stu-id="71a6b-149">Name resolution is provided between VMs in virtual networks that use the Resource Manager deployment model, without need for the FQDN.</span></span> <span data-ttu-id="71a6b-150">Virtuella nätverk i den klassiska distributionsmodellen kräver FQDN vid namnmatchning i olika molntjänster.</span><span class="sxs-lookup"><span data-stu-id="71a6b-150">Virtual networks in the classic deployment model require the FQDN when resolving names in different cloud services.</span></span> 
* <span data-ttu-id="71a6b-151">Du kan använda värdnamn som bäst beskriver dina distributioner i stället för att arbeta med automatiskt genererat namn.</span><span class="sxs-lookup"><span data-stu-id="71a6b-151">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<span data-ttu-id="71a6b-152">**Att tänka på:**</span><span class="sxs-lookup"><span data-stu-id="71a6b-152">**Considerations:**</span></span>

* <span data-ttu-id="71a6b-153">Skapa Azure DNS-suffix kan inte ändras.</span><span class="sxs-lookup"><span data-stu-id="71a6b-153">The Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="71a6b-154">Du kan registrera dina egna poster manuellt.</span><span class="sxs-lookup"><span data-stu-id="71a6b-154">You cannot manually register your own records.</span></span>
* <span data-ttu-id="71a6b-155">WINS och NetBIOS stöds inte.</span><span class="sxs-lookup"><span data-stu-id="71a6b-155">WINS and NetBIOS are not supported.</span></span> <span data-ttu-id="71a6b-156">(Du kan inte se dina virtuella datorer i Utforskaren i Windows.)</span><span class="sxs-lookup"><span data-stu-id="71a6b-156">(You cannot see your VMs in Windows Explorer.)</span></span>
* <span data-ttu-id="71a6b-157">Värdnamn måste vara DNS-kompatibel (måste de använda endast 0-9, a – z och '-', och får inte inledas eller avslutas med en '-'.</span><span class="sxs-lookup"><span data-stu-id="71a6b-157">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="71a6b-158">Avsnittet RFC 3696 2.)</span><span class="sxs-lookup"><span data-stu-id="71a6b-158">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="71a6b-159">DNS-frågorna begränsas för varje virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="71a6b-159">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="71a6b-160">Detta bör inte påverka de flesta program.</span><span class="sxs-lookup"><span data-stu-id="71a6b-160">This shouldn't impact most applications.</span></span>  <span data-ttu-id="71a6b-161">Om begäran begränsning observeras, kontrollerar du att cachelagring på klientsidan är aktiverad.</span><span class="sxs-lookup"><span data-stu-id="71a6b-161">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="71a6b-162">Mer information finns i [få ut mesta möjliga av Azure-tillhandahållna namnmatchning](#Getting-the-most-from-Azure-provided-name-resolution).</span><span class="sxs-lookup"><span data-stu-id="71a6b-162">For more details, see [Getting the most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>
* <span data-ttu-id="71a6b-163">Endast virtuella datorer i de första 180 molntjänsterna har registrerats för varje virtuellt nätverk i en klassiska distributionsmodellen.</span><span class="sxs-lookup"><span data-stu-id="71a6b-163">Only VMs in the first 180 cloud services are registered for each virtual network in a classic deployment model.</span></span> <span data-ttu-id="71a6b-164">Detta gäller inte för virtuella nätverk i Resource Manager distributionsmodellerna.</span><span class="sxs-lookup"><span data-stu-id="71a6b-164">This does not apply to virtual networks in Resource Manager deployment models.</span></span>

### <a name="getting-the-most-from-azure-provided-name-resolution"></a><span data-ttu-id="71a6b-165">Få ut mesta möjliga av Azure-tillhandahållna namnmatchning</span><span class="sxs-lookup"><span data-stu-id="71a6b-165">Getting the most from Azure-provided name resolution</span></span>
<span data-ttu-id="71a6b-166">**Klientcachelagring:**</span><span class="sxs-lookup"><span data-stu-id="71a6b-166">**Client-side Caching:**</span></span>

<span data-ttu-id="71a6b-167">Inte alla DNS-fråga måste skickas över nätverket.</span><span class="sxs-lookup"><span data-stu-id="71a6b-167">Not every DNS query needs to be sent across the network.</span></span>  <span data-ttu-id="71a6b-168">Klientcachelagring hjälper minskar svarstider och förbättrar återhämtning i nätverket signaler genom att lösa återkommande DNS-frågor från en lokal cache.</span><span class="sxs-lookup"><span data-stu-id="71a6b-168">Client-side caching helps reduce latency and improve resilience to network blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="71a6b-169">DNS-poster innehåller en Time-To-Live (TTL) som gör att cacheminnet för att lagra posten så länge som möjligt utan att påverka poster dokumentens så klientcachelagring lämpar sig för de flesta situationer.</span><span class="sxs-lookup"><span data-stu-id="71a6b-169">DNS records contain a Time-To-Live (TTL) which allows the cache to store the record for as long as possible without impacting record freshness, so client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="71a6b-170">Standard Windows DNS-klienten har en inbyggd DNS-cache.</span><span class="sxs-lookup"><span data-stu-id="71a6b-170">The default Windows DNS Client has a DNS cache built-in.</span></span>  <span data-ttu-id="71a6b-171">Vissa Linux distributioner som inte inkluderar cachelagring som standard, rekommenderas att en läggs till varje Linux VM (när du har kontrollerat att det inte är ett lokalt cacheminne redan).</span><span class="sxs-lookup"><span data-stu-id="71a6b-171">Some Linux distros do not include caching by default, it is recommended that one be added to each Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="71a6b-172">Det finns ett antal olika DNS-cachelagring paket tillgängliga, t.ex. dnsmasq, följer du stegen för att installera dnsmasq på de vanligaste distributioner:</span><span class="sxs-lookup"><span data-stu-id="71a6b-172">There are a number of different DNS caching packages available, e.g. dnsmasq, here are the steps to install dnsmasq on the most common distros:</span></span>

* <span data-ttu-id="71a6b-173">**Ubuntu (använder resolvconf)**:</span><span class="sxs-lookup"><span data-stu-id="71a6b-173">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="71a6b-174">installerar du bara dnsmasq paketet (”sudo lgh get installera dnsmasq”).</span><span class="sxs-lookup"><span data-stu-id="71a6b-174">just install the dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="71a6b-175">**SUSE (använder netconf)**:</span><span class="sxs-lookup"><span data-stu-id="71a6b-175">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="71a6b-176">installera dnsmasq paketet (”sudo zypper installera dnsmasq”)</span><span class="sxs-lookup"><span data-stu-id="71a6b-176">install the dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="71a6b-177">Aktivera tjänsten dnsmasq (”systemctl aktivera dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="71a6b-177">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="71a6b-178">Starta tjänsten dnsmasq (”systemctl start dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="71a6b-178">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="71a6b-179">Redigera ”/ etc/sysconfig/nätverk/config” och ändra NETCONFIG_DNS_FORWARDER = ”” till ”dnsmasq”</span><span class="sxs-lookup"><span data-stu-id="71a6b-179">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”</span></span>
  * <span data-ttu-id="71a6b-180">Uppdatera resolv.conf (”netconfig uppdatering”) för att ställa in cachen som den lokala DNS-matchning</span><span class="sxs-lookup"><span data-stu-id="71a6b-180">update resolv.conf ("netconfig update") to set the cache as the local DNS resolver</span></span>
* <span data-ttu-id="71a6b-181">**OpenLogic (använder NetworkManager)**:</span><span class="sxs-lookup"><span data-stu-id="71a6b-181">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="71a6b-182">installera dnsmasq paketet (”sudo yum installera dnsmasq”)</span><span class="sxs-lookup"><span data-stu-id="71a6b-182">install the dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="71a6b-183">Aktivera tjänsten dnsmasq (”systemctl aktivera dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="71a6b-183">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="71a6b-184">Starta tjänsten dnsmasq (”systemctl start dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="71a6b-184">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="71a6b-185">Lägg till ”lägga domän-namnservrar 127.0.0.1”; till ”/etc/dhclient-eth0.conf”</span><span class="sxs-lookup"><span data-stu-id="71a6b-185">add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="71a6b-186">Starta om nätverkstjänsten (”tjänsten network omstart”) för att ställa in cachen som den lokala DNS-matchning</span><span class="sxs-lookup"><span data-stu-id="71a6b-186">restart the network service (“service network restart”) to set the cache as the local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="71a6b-187">Paketet 'dnsmasq' är endast ett av de många DNS-cacheminnet för Linux.</span><span class="sxs-lookup"><span data-stu-id="71a6b-187">The 'dnsmasq' package is only one of the many DNS caches available for Linux.</span></span>  <span data-ttu-id="71a6b-188">Innan du använder den, kontrollera dess lämplighet för dina specifika behov och att ingen annan cache är installerad.</span><span class="sxs-lookup"><span data-stu-id="71a6b-188">Before using it, please check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<span data-ttu-id="71a6b-189">**Klientsidans återförsök:**</span><span class="sxs-lookup"><span data-stu-id="71a6b-189">**Client-side Retries:**</span></span>

<span data-ttu-id="71a6b-190">DNS är främst ett UDP-protokoll.</span><span class="sxs-lookup"><span data-stu-id="71a6b-190">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="71a6b-191">Eftersom UDP-protokollet inte garantera meddelandeleverans, hanteras logik i själva DNS-protokollet.</span><span class="sxs-lookup"><span data-stu-id="71a6b-191">As the UDP protocol doesn't guarantee message delivery, retry logic is handled in the DNS protocol itself.</span></span>  <span data-ttu-id="71a6b-192">Varje DNS-klient (operativsystemet) kan ha olika logik beroende på skapare-inställningar:</span><span class="sxs-lookup"><span data-stu-id="71a6b-192">Each DNS client (operating system) can exhibit different retry logic depending on the creators preference:</span></span>

* <span data-ttu-id="71a6b-193">Windows-operativsystem försök igen efter 1 sekund och sedan igen efter en annan 2, 4 och en annan 4 sekunder.</span><span class="sxs-lookup"><span data-stu-id="71a6b-193">Windows operating systems retry after 1 second and then again after another 2, 4 and another 4 seconds.</span></span> 
* <span data-ttu-id="71a6b-194">Standard Linux installationsprogrammet återförsöken efter 5 sekunder.</span><span class="sxs-lookup"><span data-stu-id="71a6b-194">The default Linux setup retries after 5 seconds.</span></span>  <span data-ttu-id="71a6b-195">Det rekommenderas att ändra den här att försöka 5 gånger på 1 sekunders intervall.</span><span class="sxs-lookup"><span data-stu-id="71a6b-195">It is recommended to change this to retry 5 times at 1 second intervals.</span></span>  

<span data-ttu-id="71a6b-196">Kontrollera de aktuella inställningarna på en Linux-VM ”cat /etc/resolv.conf' och titta på raden” alternativ ”, t.ex.:</span><span class="sxs-lookup"><span data-stu-id="71a6b-196">To check the current settings on a Linux VM, 'cat /etc/resolv.conf' and look at the 'options' line, e.g.:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="71a6b-197">Filen resolv.conf är vanligtvis automatiskt genererade och bör inte redigeras.</span><span class="sxs-lookup"><span data-stu-id="71a6b-197">The resolv.conf file is usually auto-generated and should not be edited.</span></span>  <span data-ttu-id="71a6b-198">De specifika stegen för att lägga till raden ”alternativ” varierar beroende på distro:</span><span class="sxs-lookup"><span data-stu-id="71a6b-198">The specific steps for adding the 'options' line vary by distro:</span></span>

* <span data-ttu-id="71a6b-199">**Ubuntu** (använder resolvconf):</span><span class="sxs-lookup"><span data-stu-id="71a6b-199">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="71a6b-200">Lägg till rad alternativ för ' / etc/resolveconf/resolv.conf.d/head'</span><span class="sxs-lookup"><span data-stu-id="71a6b-200">add the options line to '/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="71a6b-201">Kör resolvconf -u att uppdatera</span><span class="sxs-lookup"><span data-stu-id="71a6b-201">run 'resolvconf -u' to update</span></span>
* <span data-ttu-id="71a6b-202">**SUSE** (använder netconf):</span><span class="sxs-lookup"><span data-stu-id="71a6b-202">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="71a6b-203">Lägg till 'timeout:1 försök: 5' till NETCONFIG_DNS_RESOLVER_OPTIONS = ”” parametern i ”/ etc/sysconfig/nätverk/config”</span><span class="sxs-lookup"><span data-stu-id="71a6b-203">add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="71a6b-204">Kör netconfig-uppdateringen att uppdatera</span><span class="sxs-lookup"><span data-stu-id="71a6b-204">run 'netconfig update' to update</span></span>
* <span data-ttu-id="71a6b-205">**OpenLogic** (använder NetworkManager):</span><span class="sxs-lookup"><span data-stu-id="71a6b-205">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="71a6b-206">lägga till 'echo ”alternativ timeout:1 försök: 5”' ' / etc/NetworkManager/dispatcher.d/11-dhclient'</span><span class="sxs-lookup"><span data-stu-id="71a6b-206">add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="71a6b-207">Kör 'tjänsten network omstart' att uppdatera</span><span class="sxs-lookup"><span data-stu-id="71a6b-207">run 'service network restart' to update</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="71a6b-208">Namnmatchning med hjälp av DNS-servern</span><span class="sxs-lookup"><span data-stu-id="71a6b-208">Name resolution using your own DNS server</span></span>
<span data-ttu-id="71a6b-209">Det finns ett antal olika situationer där din namnmatchningen kan gå utöver funktionerna som tillhandahålls av Azure, till exempel när via Active Directory-domäner eller när du behöver DNS-matchning mellan virtuella nätverk (vnet).</span><span class="sxs-lookup"><span data-stu-id="71a6b-209">There are a number of situations where your name resolution needs may go beyond the features provided by Azure, for example when using Active Directory domains or when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="71a6b-210">Azure tillhandahåller möjligheten att använda DNS-servrarna så att den täcker dessa scenarier.</span><span class="sxs-lookup"><span data-stu-id="71a6b-210">To cover these scenarios, Azure provides the ability for you to use your own DNS servers.</span></span>  

<span data-ttu-id="71a6b-211">DNS-servrar inom ett virtuellt nätverk kan vidarebefordra DNS-frågor till Azures rekursiv matchare att matcha värdnamn i det virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="71a6b-211">DNS servers within a virtual network can forward DNS queries to Azure's recursive resolvers to resolve hostnames within that virtual network.</span></span>  <span data-ttu-id="71a6b-212">En domänkontrollanten (DC) körs i Azure kan svara på DNS-frågor för dess domäner och vidarebefordra alla frågor till Azure.</span><span class="sxs-lookup"><span data-stu-id="71a6b-212">For example, a Domain Controller (DC) running in Azure can respond to DNS queries for its domains and forward all other queries to Azure.</span></span>  <span data-ttu-id="71a6b-213">Detta gör att virtuella datorer att se både lokala resurser (via DC) och Azure-tillhandahållna värdnamn (via vidarebefordrare).</span><span class="sxs-lookup"><span data-stu-id="71a6b-213">This allows VMs to see both your on-premises resources (via the DC) and Azure-provided hostnames (via the forwarder).</span></span>  <span data-ttu-id="71a6b-214">Åtkomst till Azures rekursiv matchare anges via den virtuella IP-Adressen 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="71a6b-214">Access to Azure's recursive resolvers is provided via the virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="71a6b-215">DNS-vidarebefordran även gör bland vnet DNS-matchning och att dina lokala datorer att matcha värdnamn för Azure-tillhandahållna.</span><span class="sxs-lookup"><span data-stu-id="71a6b-215">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premises machines to resolve Azure-provided hostnames.</span></span>  <span data-ttu-id="71a6b-216">För att matcha värdnamnet för en virtuell dator, DNS-server VM måste finnas i samma virtuella nätverk och konfigureras för att vidarebefordra hostname frågor till Azure.</span><span class="sxs-lookup"><span data-stu-id="71a6b-216">In order to resolve a VM's hostname, the DNS server VM must reside in the same virtual network and be configured to forward hostname queries to Azure.</span></span>  <span data-ttu-id="71a6b-217">Som DNS-suffix skiljer sig åt i varje virtuellt nätverk, kan du använda villkorlig vidarebefordringsregler för att skicka DNS-frågor till rätt vnet för matchning.</span><span class="sxs-lookup"><span data-stu-id="71a6b-217">As the DNS suffix is different in each vnet, you can use conditional forwarding rules to send DNS queries to the correct vnet for resolution.</span></span>  <span data-ttu-id="71a6b-218">Följande bild visar två vnet och ett lokalt nätverk gör bland vnet DNS-matchning med den här metoden.</span><span class="sxs-lookup"><span data-stu-id="71a6b-218">The following image shows two vnets and an on-premises network doing inter-vnet DNS resolution using this method.</span></span>  <span data-ttu-id="71a6b-219">Ett exempel DNS-vidarebefordrare som är tillgängliga i den [Azure Quickstart mallgalleriet](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) och [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span><span class="sxs-lookup"><span data-stu-id="71a6b-219">An example DNS forwarder is available in the [Azure Quickstart Templates gallery](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) and [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span></span>

![Bland vnet DNS](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

<span data-ttu-id="71a6b-221">När du använder Azure-tillhandahållna namnmatchning, en intern DNS-suffix (*. internal.cloudapp.net) har angetts för varje virtuell dator med hjälp av DHCP.</span><span class="sxs-lookup"><span data-stu-id="71a6b-221">When using Azure-provided name resolution, an Internal DNS suffix (*.internal.cloudapp.net) is provided to each VM using DHCP.</span></span>  <span data-ttu-id="71a6b-222">Detta gör värdnamnsmatchning hostname posterna visas i zonen internal.cloudapp.net.</span><span class="sxs-lookup"><span data-stu-id="71a6b-222">This enables hostname resolution as the hostname records are in the internal.cloudapp.net zone.</span></span>  <span data-ttu-id="71a6b-223">När du använder din egen lösning för name resolution anges IDN-suffix till virtuella datorer eftersom den stör andra DNS-arkitekturer (t.ex. domänanslutna scenarier).</span><span class="sxs-lookup"><span data-stu-id="71a6b-223">When using your own name resolution solution, the IDNS suffix is not supplied to VMs because it interferes with other DNS architectures (like domain-joined scenarios).</span></span>  <span data-ttu-id="71a6b-224">Vi ger i stället en icke-fungerande platshållare (reddog.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="71a6b-224">Instead we provide a non-functioning placeholder (reddog.microsoft.com).</span></span>  

<span data-ttu-id="71a6b-225">Om det behövs, kan interna DNS-suffix fastställas med hjälp av PowerShell eller API:</span><span class="sxs-lookup"><span data-stu-id="71a6b-225">If needed, the Internal DNS suffix can be determined using PowerShell or the API:</span></span>

* <span data-ttu-id="71a6b-226">För virtuella nätverk i Resource Manager distributionsmodellerna suffixet är tillgängliga via den [nätverkskort](https://msdn.microsoft.com/library/azure/mt163668.aspx) resurs eller via den [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="71a6b-226">For virtual networks in Resource Manager deployment models, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or via the [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span></span>    
* <span data-ttu-id="71a6b-227">I klassiska distributionsmodeller suffixet är tillgängliga via den [hämta distribution API](https://msdn.microsoft.com/library/azure/ee460804.aspx) anropa eller via den [Get-AzureVM-Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="71a6b-227">In classic deployment models, the suffix is available via the [Get Deployment API](https://msdn.microsoft.com/library/azure/ee460804.aspx) call or via the [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span></span>

<span data-ttu-id="71a6b-228">Om vidarebefordran av frågor till Azure inte passar dina behov, behöver du ange DNS-lösningen.</span><span class="sxs-lookup"><span data-stu-id="71a6b-228">If forwarding queries to Azure doesn't suit your needs, you will need to provide your own DNS solution.</span></span>  <span data-ttu-id="71a6b-229">DNS-lösningen behöver du:</span><span class="sxs-lookup"><span data-stu-id="71a6b-229">Your DNS solution will need to:</span></span>

* <span data-ttu-id="71a6b-230">Ange lämpliga värdnamnsmatchning, t.ex. [DDNS](virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="71a6b-230">Provide appropriate hostname resolution, e.g. via [DDNS](virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="71a6b-231">Tänk på att om du använder DDNS som du kan behöva inaktivera DNS-posten rensning som Azures DHCP-lån är mycket lång och rensning kan ta bort DNS-poster för tidigt.</span><span class="sxs-lookup"><span data-stu-id="71a6b-231">Note, if using DDNS you may need to disable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="71a6b-232">Ange lämpliga rekursiv matchning så att matchning av extern domännamn.</span><span class="sxs-lookup"><span data-stu-id="71a6b-232">Provide appropriate recursive resolution to allow resolution of external domain names.</span></span>
* <span data-ttu-id="71a6b-233">Vara tillgänglig (TCP och UDP-port 53) från klienterna den fungerar och att kunna få åtkomst till internet.</span><span class="sxs-lookup"><span data-stu-id="71a6b-233">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the internet.</span></span>
* <span data-ttu-id="71a6b-234">Skyddas mot åtkomst från internet, till att minska hot med externa agenter.</span><span class="sxs-lookup"><span data-stu-id="71a6b-234">Be secured against access from the internet, to mitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="71a6b-235">För bästa prestanda när du använder Azure virtuella datorer som DNS-servrar, IPv6 bör inaktiveras och en [offentlig IP på instansnivå](virtual-networks-instance-level-public-ip.md) ska tilldelas varje virtuell dator för DNS-server.</span><span class="sxs-lookup"><span data-stu-id="71a6b-235">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](virtual-networks-instance-level-public-ip.md) should be assigned to each DNS server VM.</span></span>  <span data-ttu-id="71a6b-236">Om du väljer att använda Windows Server som DNS-servern, [i den här artikeln](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) ger ytterligare prestandaanalys och optimeringar.</span><span class="sxs-lookup"><span data-stu-id="71a6b-236">If you choose to use Windows Server as your DNS server, [this article](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) provides additional performance analysis and optimizations.</span></span>
> 
> 

### <a name="specifying-dns-servers"></a><span data-ttu-id="71a6b-237">Ange DNS-servrar</span><span class="sxs-lookup"><span data-stu-id="71a6b-237">Specifying DNS servers</span></span>
<span data-ttu-id="71a6b-238">När du använder DNS-servrar, tillhandahåller Azure möjligheten att ange flera DNS-servrar per virtuellt nätverk eller per gränssnitt (Resource Manager) / molntjänst (klassisk).</span><span class="sxs-lookup"><span data-stu-id="71a6b-238">When using your own DNS servers, Azure provides the ability to specify multiple DNS servers per virtual network or per network interface (Resource Manager) / cloud service (classic).</span></span>  <span data-ttu-id="71a6b-239">DNS-servrar som angetts för ett moln service/nätverksgränssnitt får företräde över dem som anges för det virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="71a6b-239">DNS servers specified for a cloud service/network interface get precedence over those specified for the virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="71a6b-240">Nätverk anslutningsegenskaper, t.ex. DNS-server IP-adresser, inte bör redigeras direkt i virtuella Windows-datorer som de kan hämta raderas under läka när det virtuella nätverkskortet ersätts.</span><span class="sxs-lookup"><span data-stu-id="71a6b-240">Network connection properties, such as DNS server IPs, should not be edited directly within Windows VMs as they may get erased during service heal when the virtual network adaptor gets replaced.</span></span> 
> 
> 

<span data-ttu-id="71a6b-241">När du använder Resource Manager-distributionsmodellen, DNS-servrar kan anges i portalen API-mallar ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) eller PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [ NIC](https://msdn.microsoft.com/library/mt619370.aspx)).</span><span class="sxs-lookup"><span data-stu-id="71a6b-241">When using the Resource Manager deployment model, DNS servers can be specified in the Portal, API/Templates ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) or PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span></span>

<span data-ttu-id="71a6b-242">När du använder den klassiska distributionsmodellen, DNS-servrar för det virtuella nätverket kan anges i portalen eller [den *nätverkskonfigurationen* filen](https://msdn.microsoft.com/library/azure/jj157100).</span><span class="sxs-lookup"><span data-stu-id="71a6b-242">When using the classic deployment model, DNS servers for the virtual network can be specified in the Portal or [the *Network Configuration* file](https://msdn.microsoft.com/library/azure/jj157100).</span></span>  <span data-ttu-id="71a6b-243">För molntjänster, DNS-servrar har angetts [den *tjänstkonfiguration* filen](https://msdn.microsoft.com/library/azure/ee758710) eller i PowerShell ([ny AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span><span class="sxs-lookup"><span data-stu-id="71a6b-243">For cloud services, the DNS servers are specified via [the *Service Configuration* file](https://msdn.microsoft.com/library/azure/ee758710) or in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span></span>

> [!NOTE]
> <span data-ttu-id="71a6b-244">Om du ändrar DNS-inställningarna för en virtuell nätverk/virtuell dator som redan har distribuerats, måste du starta om varje berörda VM för att ändringarna ska börja gälla.</span><span class="sxs-lookup"><span data-stu-id="71a6b-244">If you change the DNS settings for a virtual network/virtual machine that is already deployed, you need to restart each affected VM for the changes to take effect.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="71a6b-245">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="71a6b-245">Next steps</span></span>
<span data-ttu-id="71a6b-246">Resource Manager-modellen:</span><span class="sxs-lookup"><span data-stu-id="71a6b-246">Resource Manager deployment model:</span></span>

* [<span data-ttu-id="71a6b-247">Skapa eller uppdatera ett virtuellt nätverk</span><span class="sxs-lookup"><span data-stu-id="71a6b-247">Create or update a virtual network</span></span>](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [<span data-ttu-id="71a6b-248">Skapa eller uppdatera ett nätverkskort</span><span class="sxs-lookup"><span data-stu-id="71a6b-248">Create or update a network interface card</span></span>](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [<span data-ttu-id="71a6b-249">Ny AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="71a6b-249">New-AzureRmVirtualNetwork</span></span>](https://msdn.microsoft.com/library/mt603657.aspx)
* [<span data-ttu-id="71a6b-250">Ny AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="71a6b-250">New-AzureRmNetworkInterface</span></span>](https://msdn.microsoft.com/library/mt619370.aspx)

<span data-ttu-id="71a6b-251">Klassiska distributionsmodellen:</span><span class="sxs-lookup"><span data-stu-id="71a6b-251">Classic deployment model:</span></span>

* [<span data-ttu-id="71a6b-252">Konfigurationsschemat för Azure-tjänst</span><span class="sxs-lookup"><span data-stu-id="71a6b-252">Azure Service Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/ee758710)
* [<span data-ttu-id="71a6b-253">Konfigurationsschemat för virtuellt nätverk</span><span class="sxs-lookup"><span data-stu-id="71a6b-253">Virtual Network Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/jj157100)
* [<span data-ttu-id="71a6b-254">Konfigurera ett virtuellt nätverk med hjälp av en konfigurationsfil för nätverk</span><span class="sxs-lookup"><span data-stu-id="71a6b-254">Configure a Virtual Network by Using a Network Configuration File</span></span>](virtual-networks-using-network-configuration-file.md) 

