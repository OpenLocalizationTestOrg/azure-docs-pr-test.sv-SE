---
title: "Så här kontrollerar du inkommande trafik till en Apptjänst-miljö"
description: "Lär dig mer om hur du konfigurerar Nätverkssäkerhetsregler för att styra inkommande trafik till en Apptjänst-miljö."
services: app-service
documentationcenter: 
author: ccompy
manager: erikre
editor: 
ms.assetid: 4cc82439-8791-48a4-9485-de6d8e1d1a08
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/11/2017
ms.author: stefsch
ms.openlocfilehash: ee0a2248a1cd5d76f87b280de05410b94f96c8af
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-control-inbound-traffic-to-an-app-service-environment"></a><span data-ttu-id="48f21-103">Så här kontrollerar du inkommande trafik till en Apptjänst-miljö</span><span class="sxs-lookup"><span data-stu-id="48f21-103">How To Control Inbound Traffic to an App Service Environment</span></span>
## <a name="overview"></a><span data-ttu-id="48f21-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="48f21-104">Overview</span></span>
<span data-ttu-id="48f21-105">En Apptjänst-miljö kan skapas i **antingen** ett virtuellt nätverk i Azure Resource Manager **eller** klassiska distributionsmodellen [virtuellt nätverk][virtualnetwork].</span><span class="sxs-lookup"><span data-stu-id="48f21-105">An App Service Environment can be created in **either** an Azure Resource Manager virtual network, **or** a classic deployment model [virtual network][virtualnetwork].</span></span>  <span data-ttu-id="48f21-106">Ett nytt virtuellt nätverk och ett nytt undernät kan definieras när en Apptjänst-miljö skapas.</span><span class="sxs-lookup"><span data-stu-id="48f21-106">A new virtual network and new subnet can be defined at the time an App Service Environment is created.</span></span>  <span data-ttu-id="48f21-107">Alternativt kan en Apptjänst-miljö skapas i ett befintligt virtuellt nätverk och befintlig undernät.</span><span class="sxs-lookup"><span data-stu-id="48f21-107">Alternatively, an App Service Environment can be created in a pre-existing virtual network and pre-existing subnet.</span></span>  <span data-ttu-id="48f21-108">Med en ändring som gjorts i juni 2016 distribueras ASEs också till virtuella nätverk som använder offentliga-adressintervall eller RFC1918 adressutrymmen (dvs.</span><span class="sxs-lookup"><span data-stu-id="48f21-108">With a change made in June 2016, ASEs can also be deployed into virtual networks that use either public address ranges, or RFC1918 address spaces (i.e.</span></span> <span data-ttu-id="48f21-109">privata adresser).</span><span class="sxs-lookup"><span data-stu-id="48f21-109">private addresses).</span></span>  <span data-ttu-id="48f21-110">Mer information om hur du skapar en Apptjänst-miljö finns [så här skapar du en Apptjänst-miljö][HowToCreateAnAppServiceEnvironment].</span><span class="sxs-lookup"><span data-stu-id="48f21-110">For more details on creating an App Service Environment see [How To Create an App Service Environment][HowToCreateAnAppServiceEnvironment].</span></span>

<span data-ttu-id="48f21-111">En Apptjänst-miljö måste alltid skapas i ett undernät eftersom ett undernät ger en nätverksgräns som kan användas för att låsa inkommande trafik bakom överordnade enheter och tjänster så att HTTP och HTTPS-trafik tillåts endast från specifika överordnade IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="48f21-111">An App Service Environment must always be created within a subnet because a subnet provides a network boundary which can be used to lock down inbound traffic behind upstream devices and services such that HTTP and HTTPS traffic is only accepted from specific upstream IP addresses.</span></span>

<span data-ttu-id="48f21-112">Inkommande och utgående nätverkstrafik på ett undernät kontrolleras med en [nätverkssäkerhetsgruppen][NetworkSecurityGroups].</span><span class="sxs-lookup"><span data-stu-id="48f21-112">Inbound and outbound network traffic on a subnet is controlled using a [network security group][NetworkSecurityGroups].</span></span> <span data-ttu-id="48f21-113">Kontrollera inkommande trafik kräver skapar Nätverkssäkerhetsregler i en nätverkssäkerhetsgrupp och sedan tilldela nätverkssäkerheten gruppen undernät som innehåller Apptjänst-miljön.</span><span class="sxs-lookup"><span data-stu-id="48f21-113">Controlling inbound traffic requires creating network security rules in a network security group, and then assigning the network security group the subnet containing the App Service Environment.</span></span>

<span data-ttu-id="48f21-114">När en nätverkssäkerhetsgrupp tilldelas till ett undernät, inkommande trafik till appar i Apptjänst-miljön tillåtet/blockeras baserat på Tillåt och neka regler som definierats i nätverkssäkerhetsgruppen.</span><span class="sxs-lookup"><span data-stu-id="48f21-114">Once a network security group is assigned to a subnet, inbound traffic to apps in the App Service Environment is allowed/blocked based on the allow and deny rules defined in the network security group.</span></span>

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="inbound-network-ports-used-in-an-app-service-environment"></a><span data-ttu-id="48f21-115">Inkommande nätverksportar som används i en Apptjänst-miljö</span><span class="sxs-lookup"><span data-stu-id="48f21-115">Inbound Network Ports Used in an App Service Environment</span></span>
<span data-ttu-id="48f21-116">Innan du låsa inkommande nätverkstrafik med en säkerhetsgrupp för nätverk är det viktigt att veta uppsättning obligatoriska och valfria nätverksportar som används av en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-116">Before locking down inbound network traffic with a network security group, it is important to know the set of required and optional network ports used by an App Service Environment.</span></span>  <span data-ttu-id="48f21-117">Stänger av misstag av trafik till vissa portar kan resultera i förlust av funktioner i en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-117">Accidentally closing off traffic to some ports can result in loss of functionality in an App Service Environment.</span></span>

<span data-ttu-id="48f21-118">Följande är en lista över portar som används av en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-118">The following is a list of ports used by an App Service Environment.</span></span> <span data-ttu-id="48f21-119">Alla portar **TCP**, såvida inte annat anges tydligt:</span><span class="sxs-lookup"><span data-stu-id="48f21-119">All ports are **TCP**, unless otherwise clearly noted:</span></span>

* <span data-ttu-id="48f21-120">454: **krävs port** används av Azure-infrastrukturen för att hantera och underhålla Apptjänstmiljöer via SSL.</span><span class="sxs-lookup"><span data-stu-id="48f21-120">454:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="48f21-121">Inte blockera trafik till den här porten.</span><span class="sxs-lookup"><span data-stu-id="48f21-121">Do not block traffic to this port.</span></span>  <span data-ttu-id="48f21-122">Den här porten är alltid bunden till en ASE offentliga VIP.</span><span class="sxs-lookup"><span data-stu-id="48f21-122">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="48f21-123">455: **krävs port** används av Azure-infrastrukturen för att hantera och underhålla Apptjänstmiljöer via SSL.</span><span class="sxs-lookup"><span data-stu-id="48f21-123">455:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="48f21-124">Inte blockera trafik till den här porten.</span><span class="sxs-lookup"><span data-stu-id="48f21-124">Do not block traffic to this port.</span></span>  <span data-ttu-id="48f21-125">Den här porten är alltid bunden till en ASE offentliga VIP.</span><span class="sxs-lookup"><span data-stu-id="48f21-125">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="48f21-126">80: standardport för inkommande HTTP-trafik till appar som körs i App Service-planer i en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-126">80:  Default port for inbound HTTP traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="48f21-127">Den här porten är bunden till ILB-adressen för ASE på en ILB-aktiverade ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-127">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="48f21-128">443: standardport för inkommande SSL-trafik till appar som körs i App Service-planer i en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-128">443: Default port for inbound SSL traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="48f21-129">Den här porten är bunden till ILB-adressen för ASE på en ILB-aktiverade ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-129">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="48f21-130">21: kontrollkanal för FTP.</span><span class="sxs-lookup"><span data-stu-id="48f21-130">21:  Control channel for FTP.</span></span>  <span data-ttu-id="48f21-131">Den här porten blockeras på ett säkert sätt om FTP inte används.</span><span class="sxs-lookup"><span data-stu-id="48f21-131">This port can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="48f21-132">Den här porten kan vara kopplat till ILB-adress på en ILB-aktiverade ASE för en ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-132">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="48f21-133">990: kontrollkanal för FTPS.</span><span class="sxs-lookup"><span data-stu-id="48f21-133">990:  Control channel for FTPS.</span></span>  <span data-ttu-id="48f21-134">Den här porten blockeras på ett säkert sätt om FTPS inte används.</span><span class="sxs-lookup"><span data-stu-id="48f21-134">This port can be safely blocked if FTPS is not being used.</span></span>  <span data-ttu-id="48f21-135">Den här porten kan vara kopplat till ILB-adress på en ILB-aktiverade ASE för en ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-135">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="48f21-136">10001 10020: datakanaler för FTP.</span><span class="sxs-lookup"><span data-stu-id="48f21-136">10001-10020: Data channels for FTP.</span></span>  <span data-ttu-id="48f21-137">Precis som med kontrollkanalen, blockeras portarna på ett säkert sätt om FTP inte används.</span><span class="sxs-lookup"><span data-stu-id="48f21-137">As with the control channel, these ports can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="48f21-138">Den här porten kan vara kopplat till den ASE ILB-adress på en ILB-aktiverade ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-138">On an ILB-enabled ASE, this port can be bound to the ASE's ILB address.</span></span>
* <span data-ttu-id="48f21-139">4016: används för fjärrfelsökning med Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="48f21-139">4016: Used for remote debugging with Visual Studio 2012.</span></span>  <span data-ttu-id="48f21-140">Den här porten blockeras på ett säkert sätt om funktionen inte används.</span><span class="sxs-lookup"><span data-stu-id="48f21-140">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="48f21-141">Den här porten är bunden till ILB-adressen för ASE på en ILB-aktiverade ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-141">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="48f21-142">4018: används för fjärrfelsökning med Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="48f21-142">4018: Used for remote debugging with Visual Studio 2013.</span></span>  <span data-ttu-id="48f21-143">Den här porten blockeras på ett säkert sätt om funktionen inte används.</span><span class="sxs-lookup"><span data-stu-id="48f21-143">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="48f21-144">Den här porten är bunden till ILB-adressen för ASE på en ILB-aktiverade ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-144">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="48f21-145">4020: används för fjärrfelsökning med Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="48f21-145">4020: Used for remote debugging with Visual Studio 2015.</span></span>  <span data-ttu-id="48f21-146">Den här porten blockeras på ett säkert sätt om funktionen inte används.</span><span class="sxs-lookup"><span data-stu-id="48f21-146">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="48f21-147">Den här porten är bunden till ILB-adressen för ASE på en ILB-aktiverade ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-147">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>

## <a name="outbound-connectivity-and-dns-requirements"></a><span data-ttu-id="48f21-148">Utgående anslutning och DNS-krav</span><span class="sxs-lookup"><span data-stu-id="48f21-148">Outbound Connectivity and DNS Requirements</span></span>
<span data-ttu-id="48f21-149">För en Apptjänstmiljö ska fungera korrekt kräver också utgående åtkomst till olika slutpunkter.</span><span class="sxs-lookup"><span data-stu-id="48f21-149">For an App Service Environment to function properly, it also requires outbound access to various endpoints.</span></span> <span data-ttu-id="48f21-150">En fullständig lista över de externa slutpunkter som används av en ASE finns i avsnittet ”krävs nätverksanslutning” i den [nätverkskonfigurationen för ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) artikel.</span><span class="sxs-lookup"><span data-stu-id="48f21-150">A full list of the external endpoints used by an ASE is in the "Required Network Connectivity" section of the [Network Configuration for ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) article.</span></span>

<span data-ttu-id="48f21-151">Apptjänstmiljöer kräver ett giltigt DNS-infrastruktur konfigurerad för det virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="48f21-151">App Service Environments require a valid DNS infrastructure configured for the virtual network.</span></span>  <span data-ttu-id="48f21-152">Om DNS-konfigurationen har ändrats efter en Apptjänst-miljö har skapats av någon anledning, kan utvecklare tvinga en Apptjänst-miljö för den nya DNS-konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="48f21-152">If for any reason the DNS configuration is changed after an App Service Environment has been created, developers can force an App Service Environment to pick up the new DNS configuration.</span></span>  <span data-ttu-id="48f21-153">Utlöser en rullande miljö omstart med hjälp av ikonen ”Restart” som finns längst upp på bladet hantering av Apptjänst-miljö i det [Azure-portalen] [ NewPortal] kommer miljö för att hämta den nya DNS-konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="48f21-153">Triggering a rolling environment reboot using the "Restart" icon located at the top of the App Service Environment management blade in the [Azure portal][NewPortal] will cause the environment to pick up the new DNS configuration.</span></span>

<span data-ttu-id="48f21-154">Vi rekommenderar också att alla anpassade DNS-servrar för det virtuella nätverket konfigureras i förväg innan du skapar en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-154">It is also recommended that any custom DNS servers on the vnet be setup ahead of time prior to creating an App Service Environment.</span></span>  <span data-ttu-id="48f21-155">Om DNS-konfiguration för ett virtuellt nätverk har ändrats medan en Apptjänst-miljö skapas, vilket leder till att Apptjänstmiljö skapa processen misslyckas.</span><span class="sxs-lookup"><span data-stu-id="48f21-155">If a virtual network's DNS configuration is changed while an App Service Environment is being created, that will result in the App Service Environment creation process failing.</span></span>  <span data-ttu-id="48f21-156">I en liknande vein om en anpassad DNS-server finns på den andra änden av en VPN-gateway och DNS-servern är felaktig eller inte tillgänglig, misslyckas Apptjänst-miljö skapas också.</span><span class="sxs-lookup"><span data-stu-id="48f21-156">In a similar vein, if a custom DNS server exists on the other end of a VPN gateway, and the DNS server is unreachable or unavailable, the App Service Environment creation process will also fail.</span></span>

## <a name="creating-a-network-security-group"></a><span data-ttu-id="48f21-157">Skapa en Nätverkssäkerhetsgrupp</span><span class="sxs-lookup"><span data-stu-id="48f21-157">Creating a Network Security Group</span></span>
<span data-ttu-id="48f21-158">Mer information om hur nätverkssäkerhet grupper arbetar finns följande [information][NetworkSecurityGroups].</span><span class="sxs-lookup"><span data-stu-id="48f21-158">For full details on how network security groups work see the following [information][NetworkSecurityGroups].</span></span>  <span data-ttu-id="48f21-159">Azure Service Management som exemplet nedan vidrör på visar för nätverkssäkerhetsgrupper med fokus på Konfigurera och tillämpa en nätverkssäkerhetsgrupp till ett undernät som innehåller en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-159">The Azure Service Management example below touches on highlights of network security groups, with a focus on configuring and applying a network security group to a subnet that contains an App Service Environment.</span></span>

<span data-ttu-id="48f21-160">**Obs:** nätverkssäkerhetsgrupper kan konfigureras med grafiskt den [Azure Portal](https://portal.azure.com) eller via Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="48f21-160">**Note:** Network security groups can be configured graphically using the [Azure Portal](https://portal.azure.com) or through Azure PowerShell.</span></span>

<span data-ttu-id="48f21-161">Nätverkssäkerhetsgrupper skapas först som en fristående enhet som är associerad med en prenumeration.</span><span class="sxs-lookup"><span data-stu-id="48f21-161">Network security groups are first created as a standalone entity associated with a subscription.</span></span> <span data-ttu-id="48f21-162">Se till att nätverkssäkerhetsgruppen skapas i samma region som Apptjänst-miljön eftersom nätverkssäkerhetsgrupper skapas i en Azure-region.</span><span class="sxs-lookup"><span data-stu-id="48f21-162">Since network security groups are created in an Azure region, ensure that the network security group is created in the same region as the App Service Environment.</span></span>

<span data-ttu-id="48f21-163">Följande visar hur du skapar en nätverkssäkerhetsgrupp:</span><span class="sxs-lookup"><span data-stu-id="48f21-163">The following demonstrates creating a network security group:</span></span>

    New-AzureNetworkSecurityGroup -Name "testNSGexample" -Location "South Central US" -Label "Example network security group for an app service environment"

<span data-ttu-id="48f21-164">När du har skapat en nätverkssäkerhetsgrupp läggs en eller flera Nätverkssäkerhetsregler till den.</span><span class="sxs-lookup"><span data-stu-id="48f21-164">Once a network security group is created, one or more network security rules are added to it.</span></span>  <span data-ttu-id="48f21-165">Eftersom uppsättningen regler kan förändras över tid, rekommenderas att sprida ut numrering schemat som används för prioriteter för att göra det enkelt att infoga ytterligare regler över tid.</span><span class="sxs-lookup"><span data-stu-id="48f21-165">Since the set of rules may change over time, it is recommended to space out the numbering scheme used for rule priorities to make it easy to insert additional rules over time.</span></span>

<span data-ttu-id="48f21-166">Exemplet nedan visar en regel som uttryckligen beviljar åtkomst till management-portar som krävs av Azure-infrastrukturen att hantera och underhålla en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-166">The example below shows a rule that explicitly grants access to the management ports needed by the Azure infrastructure to manage and maintain an App Service Environment.</span></span>  <span data-ttu-id="48f21-167">Observera att alla hantering av trafik som flödar över SSL och skyddas av klientcertifikat, så att även om portarna är öppna de är tillgängligt som en annan entitet än Azure hanteringsinfrastruktur.</span><span class="sxs-lookup"><span data-stu-id="48f21-167">Note that all management traffic flows over SSL and is secured by client certificates, so even though the ports are opened they are inaccessible by any entity other than Azure management infrastructure.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "ALLOW AzureMngmt" -Type Inbound -Priority 100 -Action Allow -SourceAddressPrefix 'INTERNET'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '454-455' -Protocol TCP


<span data-ttu-id="48f21-168">När låsa åtkomst till port 80 och 443 ”dölja” en Apptjänst-miljö bakom överordnade enheter eller tjänster behöver du känna till överordnade IP-adressen.</span><span class="sxs-lookup"><span data-stu-id="48f21-168">When locking down access to port 80 and 443 to "hide" an App Service Environment behind upstream devices or services, you will need to know the upstream IP address.</span></span>  <span data-ttu-id="48f21-169">Till exempel om du använder en brandvägg för webbaserade program (Brandvägg) på Brandvägg har sin egen IP-adress (eller adresserna) som används när proxyanslutning trafik till en underordnad Apptjänstmiljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-169">For example, if you are using a web application firewall (WAF), the WAF will have its own IP address (or addresses) which it uses when proxying traffic to a downstream App Service Environment.</span></span>  <span data-ttu-id="48f21-170">Du måste använda den här IP-adressen på den *SourceAddressPrefix* parametern för en nätverkssäkerhetsregeln.</span><span class="sxs-lookup"><span data-stu-id="48f21-170">You will need to use this IP address in the *SourceAddressPrefix* parameter of a network security rule.</span></span>

<span data-ttu-id="48f21-171">Inkommande trafik från en specifik överordnade IP-adress är uttryckligen tillåtet i exemplet nedan.</span><span class="sxs-lookup"><span data-stu-id="48f21-171">In the example below, inbound traffic from a specific upstream IP address is explicitly allowed.</span></span>  <span data-ttu-id="48f21-172">Adressen *1.2.3.4* används som platshållare för IP-adressen för en överordnad Brandvägg.</span><span class="sxs-lookup"><span data-stu-id="48f21-172">The address *1.2.3.4* is used as a placeholder for the IP address of an upstream WAF.</span></span>  <span data-ttu-id="48f21-173">Ändra värdet så att den matchar den adress som används av din överordnade enhet eller tjänst.</span><span class="sxs-lookup"><span data-stu-id="48f21-173">Change the value to match the address used by your upstream device or service.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTP" -Type Inbound -Priority 200 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '80' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTPS" -Type Inbound -Priority 300 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '443' -Protocol TCP

<span data-ttu-id="48f21-174">Eventuellt FTP-stöd kan följande regler användas som en mall för att bevilja åtkomst till FTP-kontrollen porten och data channel-portar.</span><span class="sxs-lookup"><span data-stu-id="48f21-174">If FTP support is desired, the following rules can be used as a template to grant access to the FTP control port and data channel ports.</span></span>  <span data-ttu-id="48f21-175">Eftersom FTP är ett tillståndskänslig protokoll, kan du kanske inte skicka FTP-trafik via en traditionell HTTP/HTTPS brandvägg eller proxyserver enhet.</span><span class="sxs-lookup"><span data-stu-id="48f21-175">Since FTP is a stateful protocol, you may not be able to route FTP traffic through a traditional HTTP/HTTPS firewall or proxy device.</span></span>  <span data-ttu-id="48f21-176">I det här fallet måste du ange den *SourceAddressPrefix* till ett annat värde - till exempel IP-adressintervall utvecklare eller distribution datorer som kör på vilken FTP-klienter.</span><span class="sxs-lookup"><span data-stu-id="48f21-176">In this case you will need to set the *SourceAddressPrefix* to a different value - for example the IP address range of developer or deployment machines on which FTP clients are running.</span></span> 

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPCtrl" -Type Inbound -Priority 400 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '21' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPDataRange" -Type Inbound -Priority 500 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '10001-10020' -Protocol TCP

<span data-ttu-id="48f21-177">(**Obs:** portintervall för datakanal kan ändras i förhandsversionen.)</span><span class="sxs-lookup"><span data-stu-id="48f21-177">(**Note:**  the data channel port range may change during the preview period.)</span></span>

<span data-ttu-id="48f21-178">Om fjärrfelsökning med Visual Studio används visar följande regler hur du bevilja åtkomst.</span><span class="sxs-lookup"><span data-stu-id="48f21-178">If remote debugging with Visual Studio is used, the following rules demonstrate how to grant access.</span></span>  <span data-ttu-id="48f21-179">Det finns en separat regel för varje version av Visual Studio som stöds eftersom varje version använder en annan port för fjärrfelsökning.</span><span class="sxs-lookup"><span data-stu-id="48f21-179">There is a separate rule for each supported version of Visual Studio since each version uses a different port for remote debugging.</span></span>  <span data-ttu-id="48f21-180">Precis som med FTP-åtkomst kan remote felsökning inte trafiken korrekt via en traditionell Brandvägg eller proxyserver enhet.</span><span class="sxs-lookup"><span data-stu-id="48f21-180">As with FTP access, remote debugging traffic may not flow properly through a traditional WAF or proxy device.</span></span>  <span data-ttu-id="48f21-181">Den *SourceAddressPrefix* kan anges i stället till IP-adressintervall developer-datorer som kör Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="48f21-181">The *SourceAddressPrefix* can instead be set to the IP address range of developer machines running Visual Studio.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2012" -Type Inbound -Priority 600 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4016' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2013" -Type Inbound -Priority 700 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4018' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2015" -Type Inbound -Priority 800 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4020' -Protocol TCP

## <a name="assigning-a-network-security-group-to-a-subnet"></a><span data-ttu-id="48f21-182">Tilldela en Nätverkssäkerhetsgrupp till ett undernät</span><span class="sxs-lookup"><span data-stu-id="48f21-182">Assigning a Network Security Group to a Subnet</span></span>
<span data-ttu-id="48f21-183">En nätverkssäkerhetsgrupp har en standardsäkerhetsregel som nekar åtkomst till alla externa trafiken.</span><span class="sxs-lookup"><span data-stu-id="48f21-183">A network security group has a default security rule which denies access to all external traffic.</span></span>  <span data-ttu-id="48f21-184">Resultatet från att kombinera Nätverkssäkerhetsregler som beskrivs ovan och standardsäkerhetsregel som blockerar inkommande trafik, är att endast trafik från käll-adressintervallen som är associerade med en *Tillåt* åtgärden kommer att kunna skicka trafik till appar som körs i en Apptjänst-miljö.</span><span class="sxs-lookup"><span data-stu-id="48f21-184">The result from combining the network security rules described above, and the default security rule blocking inbound traffic, is that only traffic from source address ranges associated with an *Allow* action will be able to send traffic to apps running in an App Service Environment.</span></span>

<span data-ttu-id="48f21-185">När en nätverkssäkerhetsgrupp fylls med säkerhetsregler måste den tilldelas det undernät som innehåller Apptjänst-miljön.</span><span class="sxs-lookup"><span data-stu-id="48f21-185">After a network security group is populated with security rules, it needs to be assigned to the subnet containing the App Service Environment.</span></span>  <span data-ttu-id="48f21-186">Kommandot tilldelningen referenser både namnet på det virtuella nätverket där Apptjänst-miljön finns, samt namnet på det undernät där Apptjänst-miljön har skapats.</span><span class="sxs-lookup"><span data-stu-id="48f21-186">The assignment command references both the name of the virtual network where the App Service Environment resides, as well as the name of the subnet where the App Service Environment was created.</span></span>  

<span data-ttu-id="48f21-187">Exemplet nedan visar en nätverkssäkerhetsgrupp som tilldelas till ett undernät och virtuella nätverk:</span><span class="sxs-lookup"><span data-stu-id="48f21-187">The example below shows a network security group being assigned to a subnet and virtual network:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityGroupToSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

<span data-ttu-id="48f21-188">När grupptilldelningen network security lyckas (tilldelningen är en långvariga åtgärder och kan ta några minuter att slutföra) bara inkommande trafik matchar *Tillåt* regler ska komma åt appar i Apptjänst-miljön.</span><span class="sxs-lookup"><span data-stu-id="48f21-188">Once the network security group assignment succeeds (the assignment is a long-running operations and can take a few minutes to complete), only inbound traffic matching *Allow* rules will successfully reach apps in the App Service Environment.</span></span>

<span data-ttu-id="48f21-189">I följande exempel visas hur du tar bort och därför dis-associerar nätverkssäkerhetsgruppen från undernätet för fullständighetens skull:</span><span class="sxs-lookup"><span data-stu-id="48f21-189">For completeness the following example shows how to remove and thus dis-associate the network security group from the subnet:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Remove-AzureNetworkSecurityGroupFromSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

## <a name="special-considerations-for-explicit-ip-ssl"></a><span data-ttu-id="48f21-190">Speciella överväganden vid Explicit IP-SSL</span><span class="sxs-lookup"><span data-stu-id="48f21-190">Special Considerations for Explicit IP-SSL</span></span>
<span data-ttu-id="48f21-191">Om en app har konfigurerats med en explicit SSL-IP-adress (tillämpliga *endast* till ASEs som har en offentlig VIP), istället för att använda standard IP-adressen för Apptjänst-miljön, både HTTP och HTTPS-trafik flödar till undernätet via en annan uppsättning andra portar än portarna 80 och 443.</span><span class="sxs-lookup"><span data-stu-id="48f21-191">If an app is configured with an explicit IP-SSL address (applicable *only* to ASEs that have a public VIP), instead of using the default IP address of the App Service Environment, both HTTP and HTTPS traffic flows into the subnet over a different set of ports other than ports 80 and 443.</span></span>

<span data-ttu-id="48f21-192">Enskilda paret med portar som används av varje SSL-IP-adress kan hittas i portalens användargränssnitt från den Apptjänstmiljö UX informationsbladet.</span><span class="sxs-lookup"><span data-stu-id="48f21-192">The individual pair of ports used by each IP-SSL address can be found in the portal user interface from the App Service Environment's details UX blade.</span></span>  <span data-ttu-id="48f21-193">Välj ”alla inställningar”--> ”IP-adresser”.</span><span class="sxs-lookup"><span data-stu-id="48f21-193">Select "All settings" --> "IP addresses".</span></span>  <span data-ttu-id="48f21-194">”IP-adresser” bladet visar en tabell med alla uttryckligen konfigurerade SSL-IP-adresser för Apptjänst-miljön, tillsammans med särskilda port-par som används för att dirigera HTTP och HTTPS-trafik som är associerade med varje SSL-IP-adress.</span><span class="sxs-lookup"><span data-stu-id="48f21-194">The "IP addresses" blade shows a table of all explicitly configured IP-SSL addresses for the App Service Environment, along with the special port pair that is used to route HTTP and HTTPS traffic associated with each IP-SSL address.</span></span>  <span data-ttu-id="48f21-195">Det är här porten två som ska användas för parametrarna DestinationPortRange när du konfigurerar regler i en nätverkssäkerhetsgrupp.</span><span class="sxs-lookup"><span data-stu-id="48f21-195">It is this port pair that needs to be used for the DestinationPortRange parameters when configuring rules in a network security group.</span></span>

<span data-ttu-id="48f21-196">När en app på en ASE är konfigurerad för att använda IP-SSL, visas inte externa kunder och behöver inte bry dig om särskilda port par mappningen.</span><span class="sxs-lookup"><span data-stu-id="48f21-196">When an app on an ASE is configured to use IP-SSL, external customers will not see and do not need to worry about the special port pair mapping.</span></span>  <span data-ttu-id="48f21-197">Trafik till apparna flödar normalt till den konfigurerade SSL-IP-adressen.</span><span class="sxs-lookup"><span data-stu-id="48f21-197">Traffic to the apps will flow normally to the configured IP-SSL address.</span></span>  <span data-ttu-id="48f21-198">Översättning till särskilda port paret sker automatiskt internt under den sista delen av dirigera trafiken till undernätet som innehåller ASE.</span><span class="sxs-lookup"><span data-stu-id="48f21-198">The translation to the special port pair automatically happens internally during the final leg of routing traffic into the subnet containing the ASE.</span></span> 

## <a name="getting-started"></a><span data-ttu-id="48f21-199">Komma igång</span><span class="sxs-lookup"><span data-stu-id="48f21-199">Getting started</span></span>
<span data-ttu-id="48f21-200">Kom igång med Apptjänstmiljöer finns [introduktion till Apptjänst-miljö][IntroToAppServiceEnvironment]</span><span class="sxs-lookup"><span data-stu-id="48f21-200">To get started with App Service Environments, see [Introduction to App Service Environment][IntroToAppServiceEnvironment]</span></span>

<span data-ttu-id="48f21-201">Alla artiklar och hur-att datorns för Apptjänstmiljöer finns tillgängliga i den [viktigt för Programtjänstmiljöer](../app-service/app-service-app-service-environments-readme.md).</span><span class="sxs-lookup"><span data-stu-id="48f21-201">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="48f21-202">Mer information kring appar som ansluter till backend-resursen på ett säkert sätt från en Apptjänst-miljö finns [säker anslutning till serverdelsresurser från en Apptjänst-miljö][SecurelyConnecttoBackend]</span><span class="sxs-lookup"><span data-stu-id="48f21-202">For details around apps securely connecting to backend resource from an App Service Environment, see [Securely connecting to Backend resources from an App Service Environment][SecurelyConnecttoBackend]</span></span>

<span data-ttu-id="48f21-203">Mer information om plattformen Azure App Service finns [Azure App Service][AzureAppService].</span><span class="sxs-lookup"><span data-stu-id="48f21-203">For more information about the Azure App Service platform, see [Azure App Service][AzureAppService].</span></span>

[!INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]

[!INCLUDE [app-service-web-try-app-service](../../includes/app-service-web-try-app-service.md)]

<!-- LINKS -->
[virtualnetwork]: https://azure.microsoft.com/documentation/articles/virtual-networks-faq/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[SecurelyConnecttoBackend]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-securely-connecting-to-backend-resources/
[NewPortal]:  https://portal.azure.com  

<!-- IMAGES -->

