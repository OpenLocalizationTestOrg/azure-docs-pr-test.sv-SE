---
title: Automatiskt skala compute-noder i en Azure Batch-pool | Microsoft Docs
description: "Aktivera automatisk skalning på poolen moln att dynamiskt justera antalet beräkningsnoder i poolen."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f0e49cd8a64a48c53f5b6104703164a597c797f0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="02ee7-103">Skapa en automatisk skalning formel för att skala beräkningsnoder i en Batch-pool</span><span class="sxs-lookup"><span data-stu-id="02ee7-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="02ee7-104">Azure Batch skala automatiskt poolerna baserat på parametrarna som du definierar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="02ee7-105">Automatisk skalning Batch lägger till dynamiskt noder i en pool som aktiviteten krav och tar bort compute-noder som de minska.</span><span class="sxs-lookup"><span data-stu-id="02ee7-105">With automatic scaling, Batch dynamically adds nodes to a pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="02ee7-106">Du kan spara både tid och pengar genom att automatiskt justera antalet datornoderna används av Batch-program.</span><span class="sxs-lookup"><span data-stu-id="02ee7-106">You can save both time and money by automatically adjusting the number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="02ee7-107">Du aktiverar automatisk skalning på en pool av datornoderna genom att associera med en *Autoskala formeln* som du definierar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="02ee7-108">Batch-tjänsten använder Autoskala formel för att bestämma antalet compute-noder som behövs för att köra din arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-108">The Batch service uses the autoscale formula to determine the number of compute nodes that are needed to execute your workload.</span></span> <span data-ttu-id="02ee7-109">Compute-noder kan vara dedikerade noder eller [låg prioritet noder](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="02ee7-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="02ee7-110">Batch svarar tjänsten mått data som samlas in regelbundet.</span><span class="sxs-lookup"><span data-stu-id="02ee7-110">Batch responds to service metrics data that is collected periodically.</span></span> <span data-ttu-id="02ee7-111">Med den här mätvärdesdata kan justerar Batch antalet beräkningsnoder i poolen baserat på din formel och en konfigurerbar intervall.</span><span class="sxs-lookup"><span data-stu-id="02ee7-111">Using this metrics data, Batch adjusts the number of compute nodes in the pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="02ee7-112">Du kan aktivera automatisk skalning när poolen har skapats, eller på en befintlig adresspool.</span><span class="sxs-lookup"><span data-stu-id="02ee7-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="02ee7-113">Du kan även ändra en befintlig formel på en pool som har konfigurerats för autoskalning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="02ee7-114">Batch gör det möjligt att utvärdera dina formler innan du tilldelar dem till pooler och övervaka statusen för automatisk skalning körs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-114">Batch enables you to evaluate your formulas before assigning them to pools and to monitor the status of automatic scaling runs.</span></span>

<span data-ttu-id="02ee7-115">Den här artikeln beskrivs de olika enheter som utgör ditt Autoskala formler, inklusive variabler, operatorer, funktioner och funktioner.</span><span class="sxs-lookup"><span data-stu-id="02ee7-115">This article discusses the various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="02ee7-116">Diskuterar vi hur du skaffar olika beräknings-resurs- och mått i Batch.</span><span class="sxs-lookup"><span data-stu-id="02ee7-116">We discuss how to obtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="02ee7-117">Du kan använda de här måtten för att justera antalet för din pool-noder baserat på resursen användnings- och status.</span><span class="sxs-lookup"><span data-stu-id="02ee7-117">You can use these metrics to adjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="02ee7-118">Sedan beskrivs hur du skapar en formel och aktiverar automatisk skalning på en pool med hjälp av både .NET-API: erna och Batch REST.</span><span class="sxs-lookup"><span data-stu-id="02ee7-118">We then describe how to construct a formula and enable automatic scaling on a pool by using both the Batch REST and .NET APIs.</span></span> <span data-ttu-id="02ee7-119">Slutligen vi med några formler.</span><span class="sxs-lookup"><span data-stu-id="02ee7-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="02ee7-120">När du skapar ett Batch-konto kan du ange den [kontokonfigurationen](batch-api-basics.md#account), som bestämmer om pooler tilldelas i en prenumeration på tjänsten Batch (standard) eller i din prenumeration för användaren.</span><span class="sxs-lookup"><span data-stu-id="02ee7-120">When you create a Batch account, you can specify the [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (the default), or in your user subscription.</span></span> <span data-ttu-id="02ee7-121">Om du har skapat Batch-kontot med standardkonfiguration för Batch-tjänsten sedan är ditt konto begränsad till ett maximalt antal kärnor som kan användas för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-121">If you created your Batch account with the default Batch Service configuration, then your account is limited to a maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="02ee7-122">Batch-tjänsten skalas datornoderna bara upp till core gränsen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-122">The Batch service scales compute nodes only up to that core limit.</span></span> <span data-ttu-id="02ee7-123">Därför nå Batch-tjänsten inte målet antalet compute-noder som anges av en Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-123">For this reason, the Batch service may not reach the target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="02ee7-124">Se [kvoter och gränser för Azure Batch-tjänsten](batch-quota-limit.md) information för att visa och öka kvoter för ditt konto.</span><span class="sxs-lookup"><span data-stu-id="02ee7-124">See [Quotas and limits for the Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="02ee7-125">Om du har skapat ditt konto med användarens prenumeration konfigurationen delar ditt konto i kärnkvot för prenumerationen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-125">If you created your account with the User Subscription configuration, then your account shares in the core quota for the subscription.</span></span> <span data-ttu-id="02ee7-126">Mer information finns i [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) (Gränser för virtuella datorer) i [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md) (Prenumerations- och tjänstgränser, kvoter och begränsningar i Azure).</span><span class="sxs-lookup"><span data-stu-id="02ee7-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="02ee7-127">Automatisk skalning formler</span><span class="sxs-lookup"><span data-stu-id="02ee7-127">Automatic scaling formulas</span></span>
<span data-ttu-id="02ee7-128">En automatisk skalning formeln är ett strängvärde som du definierar som innehåller en eller flera instruktioner.</span><span class="sxs-lookup"><span data-stu-id="02ee7-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="02ee7-129">Autoskala formeln är tilldelad till en pool [autoScaleFormula] [ rest_autoscaleformula] element (Batch REST) eller [CloudPool.AutoScaleFormula] [ net_cloudpool_autoscaleformula] Egenskapen (Batch .NET).</span><span class="sxs-lookup"><span data-stu-id="02ee7-129">The autoscale formula is assigned to a pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="02ee7-130">Batch-tjänsten använder din formel för att fastställa målet antalet beräkningsnoder i poolen för nästa intervall för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-130">The Batch service uses your formula to determine the target number of compute nodes in the pool for the next interval of processing.</span></span> <span data-ttu-id="02ee7-131">Formeln strängen får inte överskrida 8 KB, kan innehålla upp till 100 rapporter som är avgränsade med semikolon och kan innehålla radbrytningar och kommentarer.</span><span class="sxs-lookup"><span data-stu-id="02ee7-131">The formula string cannot exceed 8 KB, can include up to 100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="02ee7-132">Du kan se automatisk skalning formler som en Batch Autoskala ”språk”.</span><span class="sxs-lookup"><span data-stu-id="02ee7-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="02ee7-133">Formeln satser är kostnadsfri utformad uttryck som kan innehålla både tjänsten användardefinierade variabler (variabler som definieras av Batch-tjänsten) och användardefinierade variabler (variabler som du definierar).</span><span class="sxs-lookup"><span data-stu-id="02ee7-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by the Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="02ee7-134">De kan utföra olika åtgärder på dessa värden med hjälp av inbyggda typer, operatorer och funktioner.</span><span class="sxs-lookup"><span data-stu-id="02ee7-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="02ee7-135">En instruktion kan till exempel ha följande format:</span><span class="sxs-lookup"><span data-stu-id="02ee7-135">For example, a statement might take the following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="02ee7-136">Formler innehåller vanligtvis flera instruktioner som utför åtgärder på värden som hämtas i tidigare rapporter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="02ee7-137">Till exempel först vi hämta ett värde för `variable1`, överför den till en funktion för att fylla i `variable2`:</span><span class="sxs-lookup"><span data-stu-id="02ee7-137">For example, first we obtain a value for `variable1`, then pass it to a function to populate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="02ee7-138">Med de här uttrycken i din Autoskala formel för att få fram ett mål som antal compute-noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-138">Include these statements in your autoscale formula to arrive at a target number of compute nodes.</span></span> <span data-ttu-id="02ee7-139">Dedikerad noder och låg prioritet noder har sina egna Målinställningar så att du kan definiera ett mål för varje nod.</span><span class="sxs-lookup"><span data-stu-id="02ee7-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="02ee7-140">En Autoskala formel kan innehålla ett målvärde för dedikerade noder, ett målvärde för låg prioritet noder eller båda.</span><span class="sxs-lookup"><span data-stu-id="02ee7-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="02ee7-141">Antalet noder som mål kan vara högre, lägre eller samma som det aktuella antalet noder av typen i poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-141">The target number of nodes may be higher, lower, or the same as the current number of nodes of that type in the pool.</span></span> <span data-ttu-id="02ee7-142">Batch utvärderar en pool Autoskala formel med ett specifikt intervall (se [autoskalning intervall](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="02ee7-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="02ee7-143">Batch justerar antalet mål för varje typ av noden i poolen till det tal som Autoskala formeln anger vid tiden för utvärderingen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-143">Batch adjusts the target number of each type of node in the pool to the number that your autoscale formula specifies at the time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="02ee7-144">Autoskala formeln</span><span class="sxs-lookup"><span data-stu-id="02ee7-144">Sample autoscale formula</span></span>

<span data-ttu-id="02ee7-145">Här är ett exempel på en formel för Autoskala som kan justeras för att fungera för de flesta scenarier.</span><span class="sxs-lookup"><span data-stu-id="02ee7-145">Here is an example of an autoscale formula that can be adjusted to work for most scenarios.</span></span> <span data-ttu-id="02ee7-146">Variablerna `startingNumberOfVMs` och `maxNumberofVMs` i exempel formeln kan justeras efter dina behov.</span><span class="sxs-lookup"><span data-stu-id="02ee7-146">The variables `startingNumberOfVMs` and `maxNumberofVMs` in the example formula can be adjusted to your needs.</span></span> <span data-ttu-id="02ee7-147">Den här formeln skalas dedikerade noder, men kan ändras om du vill tillämpa skala låg prioritet noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-147">This formula scales dedicated nodes, but can be modified to apply to scale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="02ee7-148">Med den här formeln Autoskala skapas poolen med en enda virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="02ee7-148">With this autoscale formula, the pool is initially created with a single VM.</span></span> <span data-ttu-id="02ee7-149">Den `$PendingTasks` mått definierar antalet aktiviteter som körs eller står i kö.</span><span class="sxs-lookup"><span data-stu-id="02ee7-149">The `$PendingTasks` metric defines the number of tasks that are running or queued.</span></span> <span data-ttu-id="02ee7-150">Formeln söker efter det genomsnittliga antalet väntande uppgifter i de senaste 180 sekunder och anger den `$TargetDedicatedNodes` variabeln därefter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-150">The formula finds the average number of pending tasks in the last 180 seconds and sets the `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="02ee7-151">Formeln säkerställer att målet antalet dedicerade noder aldrig överstiger 25 virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="02ee7-151">The formula ensures that the target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="02ee7-152">När nya aktiviteter skickas växer poolen automatiskt.</span><span class="sxs-lookup"><span data-stu-id="02ee7-152">As new tasks are submitted, the pool automatically grows.</span></span> <span data-ttu-id="02ee7-153">Som slutförda uppgifter, virtuella datorer blir ledigt i taget och autoskalning formeln krymper poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-153">As tasks complete, VMs become free one by one and the autoscaling formula shrinks the pool.</span></span>

## <a name="variables"></a><span data-ttu-id="02ee7-154">Variabler</span><span class="sxs-lookup"><span data-stu-id="02ee7-154">Variables</span></span>
<span data-ttu-id="02ee7-155">Du kan använda båda **tjänst definierade** och **användardefinierade** variabler i Autoskala formlerna.</span><span class="sxs-lookup"><span data-stu-id="02ee7-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="02ee7-156">Tjänst-definierade variabler är inbyggda i Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-156">The service-defined variables are built in to the Batch service.</span></span> <span data-ttu-id="02ee7-157">Några variabler som definieras av tjänsten är skrivskyddad och vissa är skrivskyddad.</span><span class="sxs-lookup"><span data-stu-id="02ee7-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="02ee7-158">Användardefinierade variabler är variabler som du definierar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="02ee7-159">I exemplet formeln som visas i föregående avsnitt, `$TargetDedicatedNodes` och `$PendingTasks` är variabler som definieras av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-159">In the example formula shown in the previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="02ee7-160">Variabler `startingNumberOfVMs` och `maxNumberofVMs` är användardefinierade variabler.</span><span class="sxs-lookup"><span data-stu-id="02ee7-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="02ee7-161">Tjänst-definierade variabler föregås alltid av ett dollartecken ($).</span><span class="sxs-lookup"><span data-stu-id="02ee7-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="02ee7-162">För användardefinierade variabler är ett dollartecken valfritt.</span><span class="sxs-lookup"><span data-stu-id="02ee7-162">For user-defined variables, the dollar sign is optional.</span></span>
>
>

<span data-ttu-id="02ee7-163">Följande tabeller visar både läs-och skrivbara och skrivskyddade variabler som definieras av Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-163">The following tables show both read-write and read-only variables that are defined by the Batch service.</span></span>

<span data-ttu-id="02ee7-164">Du kan hämta och ange värdena för variablerna tjänst definierade hantera antal compute-noder i en pool:</span><span class="sxs-lookup"><span data-stu-id="02ee7-164">You can get and set the values of these service-defined variables to manage the number of compute nodes in a pool:</span></span>

| <span data-ttu-id="02ee7-165">Läsa / skriva-tjänst-definierade variabler</span><span class="sxs-lookup"><span data-stu-id="02ee7-165">Read-write service-defined variables</span></span> | <span data-ttu-id="02ee7-166">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="02ee7-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="02ee7-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="02ee7-168">Mål antalet dedicerade compute-noder för poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-168">The target number of dedicated compute nodes for the pool.</span></span> <span data-ttu-id="02ee7-169">Antalet dedicerade noder har angetts som mål eftersom en pool inte kan alltid kan uppnå önskat antal noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-169">The number of dedicated nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="02ee7-170">Till exempel om mål antalet dedicerade noder har ändrats av en Autoskala utvärdering innan poolen har nått det ursprungliga målet kan sedan poolen inte nå målet.</span><span class="sxs-lookup"><span data-stu-id="02ee7-170">For example, if the target number of dedicated nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <br /><br /> <span data-ttu-id="02ee7-171">En pool i ett konto som har skapats med konfigurationen av Batch-tjänsten kan inte uppnå målet om målet är längre än en nod eller core batchkonton.</span><span class="sxs-lookup"><span data-stu-id="02ee7-171">A pool in an account created with the Batch Service configuration may not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="02ee7-172">En pool i ett konto som har skapats med användarens prenumeration konfigurationen kan inte uppnå målet om målet överskrider kvoten delade kärnor för prenumerationen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-172">A pool in an account created with the User Subscription configuration may not achieve its target if the target exceeds the shared core quota for the subscription.</span></span>|
| <span data-ttu-id="02ee7-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="02ee7-174">Mål för antalet låg prioritet compute-noder för poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-174">The target number of low-priority compute nodes for the pool.</span></span> <span data-ttu-id="02ee7-175">Antalet noder med låg prioritet har angetts som mål eftersom en pool inte kan alltid kan uppnå önskat antal noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-175">The number of low-priority nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="02ee7-176">Till exempel om mål antalet noder för låg prioritet ändras av en Autoskala utvärdering innan poolen har nått det ursprungliga målet, kan sedan poolen inte nå målet.</span><span class="sxs-lookup"><span data-stu-id="02ee7-176">For example, if the target number of low-priority nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <span data-ttu-id="02ee7-177">En pool kan också inte uppnå målet om målet är längre än en nod eller core batchkonton.</span><span class="sxs-lookup"><span data-stu-id="02ee7-177">A pool may also not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="02ee7-178">Mer information på låg prioritet datornoder finns [använda VM med låg prioritet med Batch (förhandsgranskning)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="02ee7-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="02ee7-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="02ee7-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="02ee7-180">Vad som händer när datornoderna tas bort från poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-180">The action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="02ee7-181">Möjliga värden:</span><span class="sxs-lookup"><span data-stu-id="02ee7-181">Possible values are:</span></span><ul><li><span data-ttu-id="02ee7-182">**meddelanden**--avslutar aktiviteter omedelbart och placerar dem på jobbkön så att de schemaläggs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-182">**requeue**--Terminates tasks immediately and puts them back on the job queue so that they are rescheduled.</span></span><li><span data-ttu-id="02ee7-183">**Avsluta**--avslutar aktiviteter omedelbart och tar bort dem från jobbkön.</span><span class="sxs-lookup"><span data-stu-id="02ee7-183">**terminate**--Terminates tasks immediately and removes them from the job queue.</span></span><li><span data-ttu-id="02ee7-184">**taskcompletion**--väntar för pågående aktiviteter för att avsluta och sedan tar bort noden från poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-184">**taskcompletion**--Waits for currently running tasks to finish and then removes the node from the pool.</span></span><li><span data-ttu-id="02ee7-185">**retaineddata**--väntar på att alla lokala uppgift behålls data på noden som ska rensas innan du tar bort noden från poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-185">**retaineddata**--Waits for all the local task-retained data on the node to be cleaned up before removing the node from the pool.</span></span></ul> |

<span data-ttu-id="02ee7-186">Du kan hämta värdet för dessa variabler som definieras av tjänsten för justeringar som baseras på mått för Batch-tjänsten:</span><span class="sxs-lookup"><span data-stu-id="02ee7-186">You can get the value of these service-defined variables to make adjustments that are based on metrics from the Batch service:</span></span>

| <span data-ttu-id="02ee7-187">Skrivskyddade tjänst definierade variabler</span><span class="sxs-lookup"><span data-stu-id="02ee7-187">Read-only service-defined variables</span></span> | <span data-ttu-id="02ee7-188">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="02ee7-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="02ee7-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="02ee7-189">$CPUPercent</span></span> |<span data-ttu-id="02ee7-190">Den genomsnittliga procentandelen av CPU-användning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-190">The average percentage of CPU usage.</span></span> |
| <span data-ttu-id="02ee7-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="02ee7-191">$WallClockSeconds</span></span> |<span data-ttu-id="02ee7-192">Antal sekunder som används.</span><span class="sxs-lookup"><span data-stu-id="02ee7-192">The number of seconds consumed.</span></span> |
| <span data-ttu-id="02ee7-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-193">$MemoryBytes</span></span> |<span data-ttu-id="02ee7-194">Genomsnittligt antal megabyte som används.</span><span class="sxs-lookup"><span data-stu-id="02ee7-194">The average number of megabytes used.</span></span> |
| <span data-ttu-id="02ee7-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-195">$DiskBytes</span></span> |<span data-ttu-id="02ee7-196">Genomsnittligt antal gigabyte som används på de lokala diskarna.</span><span class="sxs-lookup"><span data-stu-id="02ee7-196">The average number of gigabytes used on the local disks.</span></span> |
| <span data-ttu-id="02ee7-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-197">$DiskReadBytes</span></span> |<span data-ttu-id="02ee7-198">Antal lästa byte.</span><span class="sxs-lookup"><span data-stu-id="02ee7-198">The number of bytes read.</span></span> |
| <span data-ttu-id="02ee7-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-199">$DiskWriteBytes</span></span> |<span data-ttu-id="02ee7-200">Antalet skrivna byte.</span><span class="sxs-lookup"><span data-stu-id="02ee7-200">The number of bytes written.</span></span> |
| <span data-ttu-id="02ee7-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="02ee7-201">$DiskReadOps</span></span> |<span data-ttu-id="02ee7-202">Antal lästa diskåtgärder som utförs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-202">The count of read disk operations performed.</span></span> |
| <span data-ttu-id="02ee7-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="02ee7-203">$DiskWriteOps</span></span> |<span data-ttu-id="02ee7-204">Antal skrivåtgärder på disken utförs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-204">The count of write disk operations performed.</span></span> |
| <span data-ttu-id="02ee7-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-205">$NetworkInBytes</span></span> |<span data-ttu-id="02ee7-206">Antal inkommande byte.</span><span class="sxs-lookup"><span data-stu-id="02ee7-206">The number of inbound bytes.</span></span> |
| <span data-ttu-id="02ee7-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-207">$NetworkOutBytes</span></span> |<span data-ttu-id="02ee7-208">Antal utgående byte.</span><span class="sxs-lookup"><span data-stu-id="02ee7-208">The number of outbound bytes.</span></span> |
| <span data-ttu-id="02ee7-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="02ee7-209">$SampleNodeCount</span></span> |<span data-ttu-id="02ee7-210">Antal compute-noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-210">The count of compute nodes.</span></span> |
| <span data-ttu-id="02ee7-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-211">$ActiveTasks</span></span> |<span data-ttu-id="02ee7-212">Antal aktiviteter som är redo att köra men ännu inte körs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-212">The number of tasks that are ready to execute but are not yet executing.</span></span> <span data-ttu-id="02ee7-213">Antalet $ActiveTasks innehåller alla aktiviteter som är aktiv och vars förutsättningar är uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="02ee7-213">The $ActiveTasks count includes all tasks that are in the active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="02ee7-214">Alla uppgifter som är aktiv men vars beroenden är inte uppfyllda undantas från antalet $ActiveTasks.</span><span class="sxs-lookup"><span data-stu-id="02ee7-214">Any tasks that are in the active state but whose dependencies have not been satisfied are excluded from the $ActiveTasks count.</span></span>|
| <span data-ttu-id="02ee7-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-215">$RunningTasks</span></span> |<span data-ttu-id="02ee7-216">Antal aktiviteter körs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-216">The number of tasks in a running state.</span></span> |
| <span data-ttu-id="02ee7-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-217">$PendingTasks</span></span> |<span data-ttu-id="02ee7-218">Summan av $ActiveTasks och $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="02ee7-218">The sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="02ee7-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-219">$SucceededTasks</span></span> |<span data-ttu-id="02ee7-220">Antal åtgärder som har slutförts.</span><span class="sxs-lookup"><span data-stu-id="02ee7-220">The number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="02ee7-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-221">$FailedTasks</span></span> |<span data-ttu-id="02ee7-222">Antal aktiviteter som har misslyckats.</span><span class="sxs-lookup"><span data-stu-id="02ee7-222">The number of tasks that failed.</span></span> |
| <span data-ttu-id="02ee7-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="02ee7-224">Aktuellt antal dedikerade compute-noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-224">The current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="02ee7-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="02ee7-226">Det aktuella antalet låg prioritet compute-noder, inklusive alla noder som är försenat.</span><span class="sxs-lookup"><span data-stu-id="02ee7-226">The current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="02ee7-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="02ee7-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="02ee7-228">Antalet noder i poolen som är i tillståndet försenat.</span><span class="sxs-lookup"><span data-stu-id="02ee7-228">The number of nodes in the pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="02ee7-229">Skrivskyddad, tjänst-definierade variabler som visas i föregående tabell är *objekt* som tillhandahåller olika metoder för att komma åt data som är associerade med varje.</span><span class="sxs-lookup"><span data-stu-id="02ee7-229">The read-only, service-defined variables that are shown in the previous table are *objects* that provide various methods to access data associated with each.</span></span> <span data-ttu-id="02ee7-230">Mer information finns i [Hämta exempeldata](#getsampledata) senare i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="02ee7-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="02ee7-231">Typer</span><span class="sxs-lookup"><span data-stu-id="02ee7-231">Types</span></span>
<span data-ttu-id="02ee7-232">Dessa typer stöds i en formel:</span><span class="sxs-lookup"><span data-stu-id="02ee7-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="02ee7-233">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-233">double</span></span>
* <span data-ttu-id="02ee7-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-234">doubleVec</span></span>
* <span data-ttu-id="02ee7-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="02ee7-235">doubleVecList</span></span>
* <span data-ttu-id="02ee7-236">Sträng</span><span class="sxs-lookup"><span data-stu-id="02ee7-236">string</span></span>
* <span data-ttu-id="02ee7-237">tidsstämpel--tidsstämpel är en sammansatt struktur som innehåller följande medlemmar:</span><span class="sxs-lookup"><span data-stu-id="02ee7-237">timestamp--timestamp is a compound structure that contains the following members:</span></span>

  * <span data-ttu-id="02ee7-238">År</span><span class="sxs-lookup"><span data-stu-id="02ee7-238">year</span></span>
  * <span data-ttu-id="02ee7-239">månaden (1-12)</span><span class="sxs-lookup"><span data-stu-id="02ee7-239">month (1-12)</span></span>
  * <span data-ttu-id="02ee7-240">dag (1-31)</span><span class="sxs-lookup"><span data-stu-id="02ee7-240">day (1-31)</span></span>
  * <span data-ttu-id="02ee7-241">veckodag (i formatet för tal, till exempel 1 för måndag)</span><span class="sxs-lookup"><span data-stu-id="02ee7-241">weekday (in the format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="02ee7-242">timme (i 24-timmarsformat format, till exempel 13 innebär 1 PM)</span><span class="sxs-lookup"><span data-stu-id="02ee7-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="02ee7-243">minuter (00-59)</span><span class="sxs-lookup"><span data-stu-id="02ee7-243">minute (00-59)</span></span>
  * <span data-ttu-id="02ee7-244">andra (00-59)</span><span class="sxs-lookup"><span data-stu-id="02ee7-244">second (00-59)</span></span>
* <span data-ttu-id="02ee7-245">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-245">timeinterval</span></span>

  * <span data-ttu-id="02ee7-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="02ee7-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="02ee7-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="02ee7-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="02ee7-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="02ee7-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="02ee7-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="02ee7-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="02ee7-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="02ee7-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="02ee7-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="02ee7-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="02ee7-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="02ee7-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="02ee7-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="02ee7-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="02ee7-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="02ee7-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="02ee7-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="02ee7-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="02ee7-256">Åtgärder</span><span class="sxs-lookup"><span data-stu-id="02ee7-256">Operations</span></span>
<span data-ttu-id="02ee7-257">Dessa åtgärder är tillåtna för de typer som anges i föregående avsnitt.</span><span class="sxs-lookup"><span data-stu-id="02ee7-257">These operations are allowed on the types that are listed in the previous section.</span></span>

| <span data-ttu-id="02ee7-258">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="02ee7-258">Operation</span></span> | <span data-ttu-id="02ee7-259">Stöds operatorer</span><span class="sxs-lookup"><span data-stu-id="02ee7-259">Supported operators</span></span> | <span data-ttu-id="02ee7-260">Typ av resultat</span><span class="sxs-lookup"><span data-stu-id="02ee7-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="02ee7-261">dubbla *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-261">double *operator* double</span></span> |<span data-ttu-id="02ee7-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="02ee7-262">+, -, *, /</span></span> |<span data-ttu-id="02ee7-263">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-263">double</span></span> |
| <span data-ttu-id="02ee7-264">dubbla *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="02ee7-265">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-265">timeinterval</span></span> |
| <span data-ttu-id="02ee7-266">doubleVec *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-266">doubleVec *operator* double</span></span> |<span data-ttu-id="02ee7-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="02ee7-267">+, -, *, /</span></span> |<span data-ttu-id="02ee7-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-268">doubleVec</span></span> |
| <span data-ttu-id="02ee7-269">doubleVec *operatorn* doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="02ee7-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="02ee7-270">+, -, *, /</span></span> |<span data-ttu-id="02ee7-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-271">doubleVec</span></span> |
| <span data-ttu-id="02ee7-272">TimeInterval *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-272">timeinterval *operator* double</span></span> |<span data-ttu-id="02ee7-273">*, /</span><span class="sxs-lookup"><span data-stu-id="02ee7-273">*, /</span></span> |<span data-ttu-id="02ee7-274">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-274">timeinterval</span></span> |
| <span data-ttu-id="02ee7-275">TimeInterval *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="02ee7-276">+, -</span><span class="sxs-lookup"><span data-stu-id="02ee7-276">+, -</span></span> |<span data-ttu-id="02ee7-277">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-277">timeinterval</span></span> |
| <span data-ttu-id="02ee7-278">TimeInterval *operatorn* tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="02ee7-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="02ee7-279">tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="02ee7-279">timestamp</span></span> |
| <span data-ttu-id="02ee7-280">tidsstämpel *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="02ee7-281">tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="02ee7-281">timestamp</span></span> |
| <span data-ttu-id="02ee7-282">tidsstämpel *operatorn* tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="02ee7-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="02ee7-283">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-283">timeinterval</span></span> |
| <span data-ttu-id="02ee7-284">*operatorn*dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-284">*operator*double</span></span> |<span data-ttu-id="02ee7-285">-, !</span><span class="sxs-lookup"><span data-stu-id="02ee7-285">-, !</span></span> |<span data-ttu-id="02ee7-286">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-286">double</span></span> |
| <span data-ttu-id="02ee7-287">*operatorn*timeinterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="02ee7-288">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-288">timeinterval</span></span> |
| <span data-ttu-id="02ee7-289">dubbla *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-289">double *operator* double</span></span> |<span data-ttu-id="02ee7-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="02ee7-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="02ee7-291">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-291">double</span></span> |
| <span data-ttu-id="02ee7-292">strängen *operatorn* sträng</span><span class="sxs-lookup"><span data-stu-id="02ee7-292">string *operator* string</span></span> |<span data-ttu-id="02ee7-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="02ee7-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="02ee7-294">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-294">double</span></span> |
| <span data-ttu-id="02ee7-295">tidsstämpel *operatorn* tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="02ee7-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="02ee7-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="02ee7-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="02ee7-297">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-297">double</span></span> |
| <span data-ttu-id="02ee7-298">TimeInterval *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="02ee7-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="02ee7-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="02ee7-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="02ee7-300">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-300">double</span></span> |
| <span data-ttu-id="02ee7-301">dubbla *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-301">double *operator* double</span></span> |<span data-ttu-id="02ee7-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="02ee7-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="02ee7-303">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-303">double</span></span> |

<span data-ttu-id="02ee7-304">När du testar ett double med en ternär operator (`double ? statement1 : statement2`) inte är noll är **SANT**, och noll är **FALSKT**.</span><span class="sxs-lookup"><span data-stu-id="02ee7-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="02ee7-305">Funktioner</span><span class="sxs-lookup"><span data-stu-id="02ee7-305">Functions</span></span>
<span data-ttu-id="02ee7-306">De här fördefinierade **funktioner** är tillgängliga som du kan använda för att definiera en automatisk skalning formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-306">These predefined **functions** are available for you to use in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="02ee7-307">Funktionen</span><span class="sxs-lookup"><span data-stu-id="02ee7-307">Function</span></span> | <span data-ttu-id="02ee7-308">Returtyp</span><span class="sxs-lookup"><span data-stu-id="02ee7-308">Return type</span></span> | <span data-ttu-id="02ee7-309">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="02ee7-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="02ee7-310">AVG(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-310">avg(doubleVecList)</span></span> |<span data-ttu-id="02ee7-311">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-311">double</span></span> |<span data-ttu-id="02ee7-312">Returnerar medelvärdet för alla värden i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-312">Returns the average value for all values in the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-313">Len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-313">len(doubleVecList)</span></span> |<span data-ttu-id="02ee7-314">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-314">double</span></span> |<span data-ttu-id="02ee7-315">Returnerar längden på vektorn som skapas från doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-315">Returns the length of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-316">LG(Double)</span><span class="sxs-lookup"><span data-stu-id="02ee7-316">lg(double)</span></span> |<span data-ttu-id="02ee7-317">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-317">double</span></span> |<span data-ttu-id="02ee7-318">Returnerar loggen bas 2 i double.</span><span class="sxs-lookup"><span data-stu-id="02ee7-318">Returns the log base 2 of the double.</span></span> |
| <span data-ttu-id="02ee7-319">LG(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-319">lg(doubleVecList)</span></span> |<span data-ttu-id="02ee7-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-320">doubleVec</span></span> |<span data-ttu-id="02ee7-321">Returnerar component-wise loggen bas 2 i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-321">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="02ee7-322">En vec(double) måste uttryckligen skickades för parametern.</span><span class="sxs-lookup"><span data-stu-id="02ee7-322">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="02ee7-323">I annat fall antas den dubbla lg(double)-versionen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-323">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="02ee7-324">LN(Double)</span><span class="sxs-lookup"><span data-stu-id="02ee7-324">ln(double)</span></span> |<span data-ttu-id="02ee7-325">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-325">double</span></span> |<span data-ttu-id="02ee7-326">Returnerar dubbla naturlig log.</span><span class="sxs-lookup"><span data-stu-id="02ee7-326">Returns the natural log of the double.</span></span> |
| <span data-ttu-id="02ee7-327">LN(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-327">ln(doubleVecList)</span></span> |<span data-ttu-id="02ee7-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-328">doubleVec</span></span> |<span data-ttu-id="02ee7-329">Returnerar component-wise loggen bas 2 i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-329">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="02ee7-330">En vec(double) måste uttryckligen skickades för parametern.</span><span class="sxs-lookup"><span data-stu-id="02ee7-330">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="02ee7-331">I annat fall antas den dubbla lg(double)-versionen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-331">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="02ee7-332">log(Double)</span><span class="sxs-lookup"><span data-stu-id="02ee7-332">log(double)</span></span> |<span data-ttu-id="02ee7-333">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-333">double</span></span> |<span data-ttu-id="02ee7-334">Returnerar loggen bas 10 av dubbla.</span><span class="sxs-lookup"><span data-stu-id="02ee7-334">Returns the log base 10 of the double.</span></span> |
| <span data-ttu-id="02ee7-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-335">log(doubleVecList)</span></span> |<span data-ttu-id="02ee7-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="02ee7-336">doubleVec</span></span> |<span data-ttu-id="02ee7-337">Returnerar component-wise loggen bas 10 av doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-337">Returns the component-wise log base 10 of the doubleVecList.</span></span> <span data-ttu-id="02ee7-338">En vec(double) måste uttryckligen skickades för den enda dubbla parametern.</span><span class="sxs-lookup"><span data-stu-id="02ee7-338">A vec(double) must be explicitly passed for the single double parameter.</span></span> <span data-ttu-id="02ee7-339">I annat fall antas den dubbla log(double)-versionen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-339">Otherwise, the double log(double) version is assumed.</span></span> |
| <span data-ttu-id="02ee7-340">Max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-340">max(doubleVecList)</span></span> |<span data-ttu-id="02ee7-341">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-341">double</span></span> |<span data-ttu-id="02ee7-342">Returnerar det största värdet i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-342">Returns the maximum value in the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-343">min(doubleVecList)</span></span> |<span data-ttu-id="02ee7-344">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-344">double</span></span> |<span data-ttu-id="02ee7-345">Returnerar det minsta värdet i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-345">Returns the minimum value in the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-346">norm(doubleVecList)</span></span> |<span data-ttu-id="02ee7-347">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-347">double</span></span> |<span data-ttu-id="02ee7-348">Returnerar två normen för vektorn som skapas från doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-348">Returns the two-norm of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-349">percentil (doubleVec v dubbla p)</span><span class="sxs-lookup"><span data-stu-id="02ee7-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="02ee7-350">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-350">double</span></span> |<span data-ttu-id="02ee7-351">Returnerar elementet percentil för vektorn v.</span><span class="sxs-lookup"><span data-stu-id="02ee7-351">Returns the percentile element of the vector v.</span></span> |
| <span data-ttu-id="02ee7-352">SLUMP()</span><span class="sxs-lookup"><span data-stu-id="02ee7-352">rand()</span></span> |<span data-ttu-id="02ee7-353">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-353">double</span></span> |<span data-ttu-id="02ee7-354">Returnerar ett slumpmässigt värde mellan 0,0 och 1,0.</span><span class="sxs-lookup"><span data-stu-id="02ee7-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="02ee7-355">Range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-355">range(doubleVecList)</span></span> |<span data-ttu-id="02ee7-356">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-356">double</span></span> |<span data-ttu-id="02ee7-357">Returnerar skillnaden mellan lägsta och högsta värden i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-357">Returns the difference between the min and max values in the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-358">Std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-358">std(doubleVecList)</span></span> |<span data-ttu-id="02ee7-359">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-359">double</span></span> |<span data-ttu-id="02ee7-360">Returnerar standardavvikelsen för urvalet av värdena i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-360">Returns the sample standard deviation of the values in the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-361">Stop)</span><span class="sxs-lookup"><span data-stu-id="02ee7-361">stop()</span></span> | |<span data-ttu-id="02ee7-362">Stoppar utvärderingen av uttrycket för autoskalning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-362">Stops evaluation of the autoscaling expression.</span></span> |
| <span data-ttu-id="02ee7-363">SUM(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="02ee7-363">sum(doubleVecList)</span></span> |<span data-ttu-id="02ee7-364">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-364">double</span></span> |<span data-ttu-id="02ee7-365">Returnerar summan av alla komponenter i doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="02ee7-365">Returns the sum of all the components of the doubleVecList.</span></span> |
| <span data-ttu-id="02ee7-366">tid (string dateTime = ””)</span><span class="sxs-lookup"><span data-stu-id="02ee7-366">time(string dateTime="")</span></span> |<span data-ttu-id="02ee7-367">tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="02ee7-367">timestamp</span></span> |<span data-ttu-id="02ee7-368">Returnerar tidsstämpeln för den aktuella tiden om inga parametrar skickas eller tidsstämpeln för dateTime-sträng om den skickas.</span><span class="sxs-lookup"><span data-stu-id="02ee7-368">Returns the time stamp of the current time if no parameters are passed, or the time stamp of the dateTime string if it is passed.</span></span> <span data-ttu-id="02ee7-369">Stöds dateTime-format är W3C DTF och RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="02ee7-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="02ee7-370">val (doubleVec v dubbla i)</span><span class="sxs-lookup"><span data-stu-id="02ee7-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="02ee7-371">dubbla</span><span class="sxs-lookup"><span data-stu-id="02ee7-371">double</span></span> |<span data-ttu-id="02ee7-372">Returnerar värdet för det element som är på plats i i vector v, med startIndex noll.</span><span class="sxs-lookup"><span data-stu-id="02ee7-372">Returns the value of the element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="02ee7-373">Några av de funktioner som beskrivs i föregående tabell kan acceptera en lista som ett argument.</span><span class="sxs-lookup"><span data-stu-id="02ee7-373">Some of the functions that are described in the previous table can accept a list as an argument.</span></span> <span data-ttu-id="02ee7-374">Kommaavgränsad lista är en kombination av *dubbla* och *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="02ee7-374">The comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="02ee7-375">Exempel:</span><span class="sxs-lookup"><span data-stu-id="02ee7-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="02ee7-376">Den *doubleVecList* värdet konverteras till en enda *doubleVec* för utvärdering.</span><span class="sxs-lookup"><span data-stu-id="02ee7-376">The *doubleVecList* value is converted to a single *doubleVec* before evaluation.</span></span> <span data-ttu-id="02ee7-377">Till exempel om `v = [1,2,3]`, sedan anropa `avg(v)` motsvarar anropar `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="02ee7-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent to calling `avg(1,2,3)`.</span></span> <span data-ttu-id="02ee7-378">Anropar `avg(v, 7)` motsvarar anropar `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="02ee7-378">Calling `avg(v, 7)` is equivalent to calling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="02ee7-379"><a name="getsampledata"></a>Hämta exempeldata</span><span class="sxs-lookup"><span data-stu-id="02ee7-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="02ee7-380">Autoskala formler fungerar på mätvärdesdata (exempel) som tillhandahålls av Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-380">Autoscale formulas act on metrics data (samples) that is provided by the Batch service.</span></span> <span data-ttu-id="02ee7-381">En formel förstoras eller förminskas poolstorlek baserat på de värden som hämtas från tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-381">A formula grows or shrinks pool size based on the values that it obtains from the service.</span></span> <span data-ttu-id="02ee7-382">Tjänst-definierade variablerna som beskrivs är tidigare objekt som ger olika metoder för att komma åt data som är associerade med objektet.</span><span class="sxs-lookup"><span data-stu-id="02ee7-382">The service-defined variables that were described previously are objects that provide various methods to access data that is associated with that object.</span></span> <span data-ttu-id="02ee7-383">Följande uttryck visar exempelvis en begäran om att hämta de senaste fem minuterna av CPU-användning:</span><span class="sxs-lookup"><span data-stu-id="02ee7-383">For example, the following expression shows a request to get the last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="02ee7-384">Metod</span><span class="sxs-lookup"><span data-stu-id="02ee7-384">Method</span></span> | <span data-ttu-id="02ee7-385">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="02ee7-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="02ee7-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="02ee7-386">GetSample()</span></span> |<span data-ttu-id="02ee7-387">Den `GetSample()` metoden returnerar en vector av insamlade data.</span><span class="sxs-lookup"><span data-stu-id="02ee7-387">The `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="02ee7-388">Ett exempel är 30 sekunder värt mått data.</span><span class="sxs-lookup"><span data-stu-id="02ee7-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="02ee7-389">Med andra ord hämtas exempel var 30: e sekund.</span><span class="sxs-lookup"><span data-stu-id="02ee7-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="02ee7-390">Men som anges nedan, det finns en fördröjning mellan när ett exempel som samlas in och när den är tillgänglig för en formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-390">But as noted below, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="02ee7-391">Därför kanske inte alla prover för en viss tidsperiod för utvärdering av en formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="02ee7-392">Anger antalet exempel som att hämta från de senaste samplingarna som samlades in.</span><span class="sxs-lookup"><span data-stu-id="02ee7-392">Specifies the number of samples to obtain from the most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="02ee7-393">`GetSample(1)`Returnerar den senaste tillgängliga insamlingen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-393">`GetSample(1)` returns the last available sample.</span></span> <span data-ttu-id="02ee7-394">För mått som `$CPUPercent`, men detta bör inte användas eftersom det är omöjligt att veta *när* provet samlades in.</span><span class="sxs-lookup"><span data-stu-id="02ee7-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible to know *when* the sample was collected.</span></span> <span data-ttu-id="02ee7-395">Det kan vara senaste eller på grund av problem med systemet, kan det vara mycket äldre.</span><span class="sxs-lookup"><span data-stu-id="02ee7-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="02ee7-396">Det är bättre i sådana fall att använda ett tidsintervall som visas nedan.</span><span class="sxs-lookup"><span data-stu-id="02ee7-396">It is better in such cases to use a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="02ee7-397">Anger en tid för att samla in exempeldata.</span><span class="sxs-lookup"><span data-stu-id="02ee7-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="02ee7-398">Du kan också anger den också procentandelen exempel som måste vara tillgängliga i den begärda tidsperioden.</span><span class="sxs-lookup"><span data-stu-id="02ee7-398">Optionally, it also specifies the percentage of samples that must be available in the requested time frame.</span></span><br/><br/><span data-ttu-id="02ee7-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)`Returnerar 20 prov om alla prover för de senaste 10 minuterna finns i CPUPercent historiken.</span><span class="sxs-lookup"><span data-stu-id="02ee7-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for the last 10 minutes are present in the CPUPercent history.</span></span> <span data-ttu-id="02ee7-400">Om den senaste minuten tidigare inte var tillgänglig, men skulle endast 18 exempel returneras.</span><span class="sxs-lookup"><span data-stu-id="02ee7-400">If the last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="02ee7-401">I det här fallet:</span><span class="sxs-lookup"><span data-stu-id="02ee7-401">In this case:</span></span><br/><br/><span data-ttu-id="02ee7-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)`misslyckas eftersom endast 90 procent av exemplen är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="02ee7-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of the samples are available.</span></span><br/><br/><span data-ttu-id="02ee7-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)`fungerar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="02ee7-404">Anger en tid för att samla in data med både en starttid och en sluttid.</span><span class="sxs-lookup"><span data-stu-id="02ee7-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="02ee7-405">Som nämnts ovan är det en fördröjning mellan när ett exempel som samlas in och när den är tillgänglig för en formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-405">As mentioned above, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="02ee7-406">Tänk fördröjningen när du använder den `GetSample` metoden.</span><span class="sxs-lookup"><span data-stu-id="02ee7-406">Consider this delay when you use the `GetSample` method.</span></span> <span data-ttu-id="02ee7-407">Se `GetSamplePercent` nedan.</span><span class="sxs-lookup"><span data-stu-id="02ee7-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="02ee7-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="02ee7-408">GetSamplePeriod()</span></span> |<span data-ttu-id="02ee7-409">Returnerar antal prover som har tagits i historiska data exempeldata.</span><span class="sxs-lookup"><span data-stu-id="02ee7-409">Returns the period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="02ee7-410">Count()</span><span class="sxs-lookup"><span data-stu-id="02ee7-410">Count()</span></span> |<span data-ttu-id="02ee7-411">Returnerar det totala antalet prov i historiken för mått.</span><span class="sxs-lookup"><span data-stu-id="02ee7-411">Returns the total number of samples in the metric history.</span></span> |
| <span data-ttu-id="02ee7-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="02ee7-412">HistoryBeginTime()</span></span> |<span data-ttu-id="02ee7-413">Returnerar tidsstämpeln för den äldsta tillgängliga datasampel för måttet.</span><span class="sxs-lookup"><span data-stu-id="02ee7-413">Returns the time stamp of the oldest available data sample for the metric.</span></span> |
| <span data-ttu-id="02ee7-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="02ee7-414">GetSamplePercent()</span></span> |<span data-ttu-id="02ee7-415">Returnerar procentandelen av prov som är tillgängliga för ett visst tidsintervall.</span><span class="sxs-lookup"><span data-stu-id="02ee7-415">Returns the percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="02ee7-416">Exempel:</span><span class="sxs-lookup"><span data-stu-id="02ee7-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="02ee7-417">Eftersom den `GetSample` metoden misslyckas om procentandelen exempel returneras är mindre än den `samplePercent` anges som du kan använda den `GetSamplePercent` metod för att kontrollera först.</span><span class="sxs-lookup"><span data-stu-id="02ee7-417">Because the `GetSample` method fails if the percentage of samples returned is less than the `samplePercent` specified, you can use the `GetSamplePercent` method to check first.</span></span> <span data-ttu-id="02ee7-418">Du kan sedan utföra åtgärden alternativ om det finns inte tillräckligt prover, utan att stoppa automatisk skalning utvärderingen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-418">Then you can perform an alternate action if insufficient samples are present, without halting the automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-the-getsample-method"></a><span data-ttu-id="02ee7-419">Exempel, exempel procent och *GetSample()* metod</span><span class="sxs-lookup"><span data-stu-id="02ee7-419">Samples, sample percentage, and the *GetSample()* method</span></span>
<span data-ttu-id="02ee7-420">Grundläggande drift av en Autoskala formel är att hämta aktivitets- och mätvärden och justera sedan poolstorlek baserat på dessa data.</span><span class="sxs-lookup"><span data-stu-id="02ee7-420">The core operation of an autoscale formula is to obtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="02ee7-421">Därför är det viktigt att ha en förståelse för hur Autoskala formler interagera med mätvärdesdata (exempel).</span><span class="sxs-lookup"><span data-stu-id="02ee7-421">As such, it is important to have a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="02ee7-422">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="02ee7-422">**Samples**</span></span>

<span data-ttu-id="02ee7-423">Batch-tjänsten med jämna mellanrum tar prover av aktivitets- och mått och gör dem tillgängliga i Autoskala formlerna.</span><span class="sxs-lookup"><span data-stu-id="02ee7-423">The Batch service periodically takes samples of task and resource metrics and makes them available to your autoscale formulas.</span></span> <span data-ttu-id="02ee7-424">Exemplen är registrerade med 30 sekunders mellanrum av Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-424">These samples are recorded every 30 seconds by the Batch service.</span></span> <span data-ttu-id="02ee7-425">Det finns dock vanligtvis en fördröjning mellan när de exempel som har registrerats och när de görs tillgängliga för (och kan läsas av) Autoskala formler.</span><span class="sxs-lookup"><span data-stu-id="02ee7-425">However, there is typically a delay between when those samples were recorded and when they are made available to (and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="02ee7-426">På grund av olika faktorer, till exempel nätverks- eller andra problem infrastruktur kan dessutom prover inte registreras för ett visst intervall.</span><span class="sxs-lookup"><span data-stu-id="02ee7-426">Additionally, due to various factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="02ee7-427">**Exempel procent**</span><span class="sxs-lookup"><span data-stu-id="02ee7-427">**Sample percentage**</span></span>

<span data-ttu-id="02ee7-428">När `samplePercent` har överförts till den `GetSample()` metod eller `GetSamplePercent()` metoden anropas _procent_ refererar till en jämförelse mellan det totala antalet prov som är registrerade av Batch-tjänsten och antalet exempel som är tillgängliga för din Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-428">When `samplePercent` is passed to the `GetSample()` method or the `GetSamplePercent()` method is called, _percent_ refers to a comparison between the total possible number of samples that are recorded by the Batch service and the number of samples that are available to your autoscale formula.</span></span>

<span data-ttu-id="02ee7-429">Nu ska vi titta på timespan 10 minuters som exempel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="02ee7-430">Eftersom prover har registrerats med 30 sekunders mellanrum inom timespan 10 minuters, är det maximala totala antalet prov som registreras av Batch 20 prov (2 per minut).</span><span class="sxs-lookup"><span data-stu-id="02ee7-430">Because samples are recorded every 30 seconds within a 10-minute timespan, the maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="02ee7-431">På grund av inbyggd svarstiden för mekanismen för rapportering och andra problem i Azure, kan det dock endast 15 prover som är tillgängliga för Autoskala formeln för läsning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-431">However, due to the inherent latency of the reporting mechanism and other issues within Azure, there may be only 15 samples that are available to your autoscale formula for reading.</span></span> <span data-ttu-id="02ee7-432">Så, till exempel för den 10-minutersperioden endast 75% av det totala antalet prov som registrerats vara tillgängliga för din formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-432">So, for example, for that 10-minute period, only 75% of the total number of samples recorded may be available to your formula.</span></span>

<span data-ttu-id="02ee7-433">**Intervall för GetSample() och exempel**</span><span class="sxs-lookup"><span data-stu-id="02ee7-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="02ee7-434">Autoskala formlerna ska växande och minska storleken på din pooler &mdash; att lägga till noder eller ta bort noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-434">Your autoscale formulas are going to be growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="02ee7-435">Eftersom noder kostar pengar, som du vill kontrollera att dina formler använder ett intelligent sätt att analys som baseras på uppgifter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-435">Because nodes cost you money, you want to ensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="02ee7-436">Därför rekommenderar vi att du använder en trender typen analys i formler.</span><span class="sxs-lookup"><span data-stu-id="02ee7-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="02ee7-437">Den här typen växer och krymper din poolerna baserat på ett intervall av insamlade prover.</span><span class="sxs-lookup"><span data-stu-id="02ee7-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="02ee7-438">Det gör du genom att använda `GetSample(interval look-back start, interval look-back end)` att returnera en vector prover:</span><span class="sxs-lookup"><span data-stu-id="02ee7-438">To do so, use `GetSample(interval look-back start, interval look-back end)` to return a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="02ee7-439">När ovanstående rad utvärderas av Batch returnerar en uppsättning exempel som en vektor med värden.</span><span class="sxs-lookup"><span data-stu-id="02ee7-439">When the above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="02ee7-440">Exempel:</span><span class="sxs-lookup"><span data-stu-id="02ee7-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="02ee7-441">När du har lagrat vector prover, kan du använda funktioner som `min()`, `max()`, och `avg()` att härleda meningsfulla värden från insamlade intervallet.</span><span class="sxs-lookup"><span data-stu-id="02ee7-441">Once you've collected the vector of samples, you can then use functions like `min()`, `max()`, and `avg()` to derive meaningful values from the collected range.</span></span>

<span data-ttu-id="02ee7-442">För ytterligare säkerhet kan du tvinga en formel utvärdering misslyckas om mindre än en viss procentandel av exemplet är tillgänglig för en viss tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="02ee7-442">For additional security, you can force a formula evaluation to fail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="02ee7-443">Om du framtvingar en formel utvärdering misslyckas instruera Batch att upphöra ytterligare utvärdering av formeln om den angivna procentandelen av prover inte är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="02ee7-443">When you force a formula evaluation to fail, you instruct Batch to cease further evaluation of the formula if the specified percentage of samples is not available.</span></span> <span data-ttu-id="02ee7-444">Ingen ändring görs i det här fallet poolstorleken.</span><span class="sxs-lookup"><span data-stu-id="02ee7-444">In this case, no change is made to the pool size.</span></span> <span data-ttu-id="02ee7-445">Om du vill ange nödvändiga procent av exempel för utvärdering ska lyckas, ange den som den tredje parametern `GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="02ee7-445">To specify a required percentage of samples for the evaluation to succeed, specify it as the third parameter to `GetSample()`.</span></span> <span data-ttu-id="02ee7-446">Här är har ett krav för 75 procent av prover angetts:</span><span class="sxs-lookup"><span data-stu-id="02ee7-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="02ee7-447">Eftersom det kan finnas en fördröjning i exempel tillgänglighet, är det viktigt att alltid ange ett tidsintervall med föregående titt starttid som är äldre än en minut.</span><span class="sxs-lookup"><span data-stu-id="02ee7-447">Because there may be a delay in sample availability, it is important to always specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="02ee7-448">Det tar ungefär en minut efter exempel spridas genom systemet, så exempel i intervallet `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` kanske inte tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="02ee7-448">It takes approximately one minute for samples to propagate through the system, so samples in the range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="02ee7-449">Igen och du kan använda parametern procentandel av `GetSample()` att tvinga ett visst exempel procentandel krav.</span><span class="sxs-lookup"><span data-stu-id="02ee7-449">Again, you can use the percentage parameter of `GetSample()` to force a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="02ee7-450">Vi **rekommenderar** som du **förlita dig inte *endast* på `GetSample(1)` i Autoskala formlerna**.</span><span class="sxs-lookup"><span data-stu-id="02ee7-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="02ee7-451">Detta beror på att `GetSample(1)` i stort sett säger till Batch-tjänsten ”ge mig senaste exempel du har, oavsett hur länge sedan den hämtades”.</span><span class="sxs-lookup"><span data-stu-id="02ee7-451">This is because `GetSample(1)` essentially says to the Batch service, "Give me the last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="02ee7-452">Eftersom det är bara ett exempel på en enda, och det kan vara ett äldre prov, kanske inte representativ för större bild av aktivitet eller resource tillstånd.</span><span class="sxs-lookup"><span data-stu-id="02ee7-452">Since it is only a single sample, and it may be an older sample, it may not be representative of the larger picture of recent task or resource state.</span></span> <span data-ttu-id="02ee7-453">Om du använder `GetSample(1)`, se till att det är en del av en större instruktion och inte bara datapunkten som är beroende av din formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not the only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="02ee7-454">Mått</span><span class="sxs-lookup"><span data-stu-id="02ee7-454">Metrics</span></span>
<span data-ttu-id="02ee7-455">Du kan använda både resurs- och mått när du definierar en formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="02ee7-456">Du justera antalet dedicerade noder i poolen baserat på de mått som du vill hämta och utvärdera mål.</span><span class="sxs-lookup"><span data-stu-id="02ee7-456">You adjust the target number of dedicated nodes in the pool based on the metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="02ee7-457">Finns det [variabler](#variables) avsnittet ovan för mer information om varje mått.</span><span class="sxs-lookup"><span data-stu-id="02ee7-457">See the [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="02ee7-458">Mått</span><span class="sxs-lookup"><span data-stu-id="02ee7-458">Metric</span></span></th>
    <th><span data-ttu-id="02ee7-459">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="02ee7-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="02ee7-460"><b>Resurs</b></span><span class="sxs-lookup"><span data-stu-id="02ee7-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="02ee7-461">Resursen mått baseras på Processorn, bandbredd, minnesanvändningen för compute-noder och antalet noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-461">Resource metrics are based on the CPU, the bandwidth, the memory usage of compute nodes, and the number of nodes.</span></span></p>
        <p> <span data-ttu-id="02ee7-462">Dessa definieras av tjänsten variabler är användbara för att göra justeringar baserat på antalet noder:</span><span class="sxs-lookup"><span data-stu-id="02ee7-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="02ee7-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="02ee7-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="02ee7-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="02ee7-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="02ee7-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="02ee7-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="02ee7-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="02ee7-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="02ee7-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="02ee7-469">Dessa definieras av tjänsten variabler är användbara för att göra justeringar baserat på noden Resursanvändning:</span><span class="sxs-lookup"><span data-stu-id="02ee7-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="02ee7-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="02ee7-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="02ee7-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="02ee7-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="02ee7-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="02ee7-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="02ee7-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="02ee7-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="02ee7-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="02ee7-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="02ee7-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="02ee7-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="02ee7-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="02ee7-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="02ee7-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="02ee7-480"><b>Aktivitet</b></span><span class="sxs-lookup"><span data-stu-id="02ee7-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="02ee7-481">Uppgiften mått baserat på status för aktiviteter, till exempel aktiv, väntar, och slutförs.</span><span class="sxs-lookup"><span data-stu-id="02ee7-481">Task metrics are based on the status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="02ee7-482">Följande tjänst definierade variabler är användbara för att göra poolstorleken justeringar baserat på uppgiften mått:</span><span class="sxs-lookup"><span data-stu-id="02ee7-482">The following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="02ee7-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="02ee7-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="02ee7-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="02ee7-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="02ee7-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="02ee7-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="02ee7-488">Skriv en Autoskala formel</span><span class="sxs-lookup"><span data-stu-id="02ee7-488">Write an autoscale formula</span></span>
<span data-ttu-id="02ee7-489">Du skapa en formel Autoskala genom instruktioner som använder komponenterna som ovan och sedan kombinera dessa instruktioner till en fullständig formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-489">You build an autoscale formula by forming statements that use the above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="02ee7-490">I det här avsnittet skapar vi ett exempel Autoskala formeln som kan utföra vissa verkliga skalning beslut.</span><span class="sxs-lookup"><span data-stu-id="02ee7-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="02ee7-491">Först ska vi definiera krav för vår nya Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-491">First, let's define the requirements for our new autoscale formula.</span></span> <span data-ttu-id="02ee7-492">Formeln måste:</span><span class="sxs-lookup"><span data-stu-id="02ee7-492">The formula should:</span></span>

1. <span data-ttu-id="02ee7-493">Öka antalet mål för dedikerade beräkningsnoder i poolen om CPU-användningen är hög.</span><span class="sxs-lookup"><span data-stu-id="02ee7-493">Increase the target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="02ee7-494">Färre mål dedikerade beräkningsnoder i en pool när CPU-användningen är låg.</span><span class="sxs-lookup"><span data-stu-id="02ee7-494">Decrease the target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="02ee7-495">Begränsa alltid det maximala antalet noder dedikerade till 400.</span><span class="sxs-lookup"><span data-stu-id="02ee7-495">Always restrict the maximum number of dedicated nodes to 400.</span></span>

<span data-ttu-id="02ee7-496">Definiera den instruktion som fyller på en användardefinierad variabel om du vill öka antalet noder under hög CPU-användning (`$totalDedicatedNodes`) med ett värde som är 110 procent av målet antalet dedicerade noder, men bara om den minsta Genomsnittlig CPU-användningen under den senaste 10 minuterna översteg 70 procent.</span><span class="sxs-lookup"><span data-stu-id="02ee7-496">To increase the number of nodes during high CPU usage, define the statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of the current target number of dedicated nodes, but only if the minimum average CPU usage during the last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="02ee7-497">Annars använder du värdet för det aktuella antalet dedicerade noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-497">Otherwise, use the value for the current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="02ee7-498">Att *minska* antalet dedicerade noder under låg CPU-användning, nästa instruktionen i vår formel anger samma `$totalDedicatedNodes` variabeln och 90 procent av aktuellt rikta antalet dedicerade noder om Genomsnittlig CPU-användningen i förflutna 60 minuter var under 20 procent.</span><span class="sxs-lookup"><span data-stu-id="02ee7-498">To *decrease* the number of dedicated nodes during low CPU usage, the next statement in our formula sets the same `$totalDedicatedNodes` variable to 90 percent of the current target number of dedicated nodes if the average CPU usage in the past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="02ee7-499">Annars kan använda det aktuella värdet för `$totalDedicatedNodes` som vi har fyllts i instruktionen ovan.</span><span class="sxs-lookup"><span data-stu-id="02ee7-499">Otherwise, use the current value of `$totalDedicatedNodes` that we populated in the statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="02ee7-500">Nu antalet mål dedikerade compute-noder till högst 400:</span><span class="sxs-lookup"><span data-stu-id="02ee7-500">Now limit the target number of dedicated compute nodes to a maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="02ee7-501">Här är klar formeln:</span><span class="sxs-lookup"><span data-stu-id="02ee7-501">Here's the complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="02ee7-502">Skapa en pool med Autoskala-aktiverade med .NET</span><span class="sxs-lookup"><span data-stu-id="02ee7-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="02ee7-503">Följ dessa steg om du vill skapa en pool med autoskalning aktiverat i .NET:</span><span class="sxs-lookup"><span data-stu-id="02ee7-503">To create a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="02ee7-504">Skapa poolen med [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="02ee7-504">Create the pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="02ee7-505">Ange den [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) egenskapen `true`.</span><span class="sxs-lookup"><span data-stu-id="02ee7-505">Set the [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property to `true`.</span></span>
3. <span data-ttu-id="02ee7-506">Ange den [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) egenskap med Autoskala-formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-506">Set the [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="02ee7-507">(Valfritt) Ange den [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) egenskapen (standardvärdet är 15 minuter).</span><span class="sxs-lookup"><span data-stu-id="02ee7-507">(Optional) Set the [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="02ee7-508">Genomför pool med [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) eller [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="02ee7-508">Commit the pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="02ee7-509">Följande kodavsnitt skapar en pool med Autoskala-aktiverade i .NET.</span><span class="sxs-lookup"><span data-stu-id="02ee7-509">The following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="02ee7-510">Poolens Autoskala formeln anger målet antalet noder som är dedikerad till 5 på måndagen och 1 för varje dag i veckan.</span><span class="sxs-lookup"><span data-stu-id="02ee7-510">The pool's autoscale formula sets the target number of dedicated nodes to 5 on Mondays, and 1 on every other day of the week.</span></span> <span data-ttu-id="02ee7-511">Den [intervall för automatisk skalning](#automatic-scaling-interval) har angetts till 30 minuter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-511">The [automatic scaling interval](#automatic-scaling-interval) is set to 30 minutes.</span></span> <span data-ttu-id="02ee7-512">I det här och andra C# fragmenten i den här artikeln `myBatchClient` är en korrekt initierad instans av den [BatchClient] [ net_batchclient] klass.</span><span class="sxs-lookup"><span data-stu-id="02ee7-512">In this and the other C# snippets in this article, `myBatchClient` is a properly initialized instance of the [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="02ee7-513">När du skapar en pool med Autoskala-aktiverade inte anger den _targetDedicatedComputeNodes_ parametern eller _targetLowPriorityComputeNodes_ parameter i anropet till **CreatePool** .</span><span class="sxs-lookup"><span data-stu-id="02ee7-513">When you create an autoscale-enabled pool, do not specify the _targetDedicatedComputeNodes_ parameter or the _targetLowPriorityComputeNodes_ parameter on the call to **CreatePool**.</span></span> <span data-ttu-id="02ee7-514">I stället anger den **AutoScaleEnabled** och **AutoScaleFormula** egenskaper för poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-514">Instead, specify the **AutoScaleEnabled** and **AutoScaleFormula** properties on the pool.</span></span> <span data-ttu-id="02ee7-515">Värden för dessa egenskaper avgör i vilket mål för varje typ av noden.</span><span class="sxs-lookup"><span data-stu-id="02ee7-515">The values for these properties determine the target number of each type of node.</span></span> <span data-ttu-id="02ee7-516">Dessutom att manuellt ändra storlek på en Autoskala-aktiverade pool (med exempelvis [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), första **inaktivera** automatisk skalning på den poolen och sedan ändrar den.</span><span class="sxs-lookup"><span data-stu-id="02ee7-516">Also, to manually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on the pool, then resize it.</span></span>
>
>

<span data-ttu-id="02ee7-517">Förutom Batch .NET, kan du använda någon av de andra [Batch SDK](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell-cmdlets](batch-powershell-cmdlets-get-started.md), och [Batch CLI](batch-cli-get-started.md) till Konfigurera autoskalning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-517">In addition to Batch .NET, you can use any of the other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and the [Batch CLI](batch-cli-get-started.md) to configure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="02ee7-518">Intervall för automatisk skalning</span><span class="sxs-lookup"><span data-stu-id="02ee7-518">Automatic scaling interval</span></span>
<span data-ttu-id="02ee7-519">Som standard justeras Batch-tjänsten poolstorlek enligt dess Autoskala formel var 15: e minut.</span><span class="sxs-lookup"><span data-stu-id="02ee7-519">By default, the Batch service adjusts a pool's size according to its autoscale formula every 15 minutes.</span></span> <span data-ttu-id="02ee7-520">Intervallet kan konfigureras med hjälp av följande egenskaper för programpoolen:</span><span class="sxs-lookup"><span data-stu-id="02ee7-520">This interval is configurable by using the following pool properties:</span></span>

* <span data-ttu-id="02ee7-521">[CloudPool.AutoScaleEvaluationInterval] [ net_cloudpool_autoscaleevalinterval] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="02ee7-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="02ee7-522">[autoScaleEvaluationInterval] [ rest_autoscaleinterval] (REST-API)</span><span class="sxs-lookup"><span data-stu-id="02ee7-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="02ee7-523">Det minsta intervallet är fem minuter och högsta är 168 timmar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-523">The minimum interval is five minutes, and the maximum is 168 hours.</span></span> <span data-ttu-id="02ee7-524">Om ett intervall som är utanför intervallet har angetts returnerar en felaktig begäran (400) fel i Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-524">If an interval outside this range is specified, the Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="02ee7-525">Autoskalning är inte avsedd att svara på ändringar i mindre än en minut, men i stället är avsedd att justera storleken på din pool gradvis som du kör en arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-525">Autoscaling is not currently intended to respond to changes in less than a minute, but rather is intended to adjust the size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="02ee7-526">Aktivera autoskalning på en befintlig adresspool</span><span class="sxs-lookup"><span data-stu-id="02ee7-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="02ee7-527">Varje Batch-SDK är ett sätt att aktivera autoskalning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-527">Each Batch SDK provides a way to enable autoscaling.</span></span> <span data-ttu-id="02ee7-528">Exempel:</span><span class="sxs-lookup"><span data-stu-id="02ee7-528">For example:</span></span>

* <span data-ttu-id="02ee7-529">[BatchClient.PoolOperations.EnableAutoScaleAsync] [ net_enableautoscaleasync] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="02ee7-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="02ee7-530">[Aktivera automatisk skalning på poolen] [ rest_enableautoscale] (REST-API)</span><span class="sxs-lookup"><span data-stu-id="02ee7-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="02ee7-531">När du aktiverar autoskalning på en befintlig adresspool, Tänk på följande saker övervägas:</span><span class="sxs-lookup"><span data-stu-id="02ee7-531">When you enable autoscaling on an existing pool, keep in mind the following points:</span></span>

* <span data-ttu-id="02ee7-532">Om automatisk skalning är inaktiverat på poolen när du skickar en begäran att aktivera autoskalning, måste du ange en giltig Autoskala formel när du skickar en begäran.</span><span class="sxs-lookup"><span data-stu-id="02ee7-532">If automatic scaling is currently disabled on the pool when you issue the request to enable autoscaling, you must specify a valid autoscale formula when you issue the request.</span></span> <span data-ttu-id="02ee7-533">Du kan också ange ett intervall för utvärdering av Autoskala.</span><span class="sxs-lookup"><span data-stu-id="02ee7-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="02ee7-534">Om du inte anger ett intervall, används standardvärdet 15 minuter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-534">If you do not specify an interval, the default value of 15 minutes is used.</span></span>
* <span data-ttu-id="02ee7-535">Om Autoskala är aktiverat i poolen, kan du ange en formel Autoskala, ett intervall för utvärdering eller båda.</span><span class="sxs-lookup"><span data-stu-id="02ee7-535">If autoscale is currently enabled on the pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="02ee7-536">Du måste ange minst en av dessa egenskaper.</span><span class="sxs-lookup"><span data-stu-id="02ee7-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="02ee7-537">Om du anger ett nytt Autoskala utvärdering intervall befintliga utvärderingsschema stoppas och startas ett nytt schema.</span><span class="sxs-lookup"><span data-stu-id="02ee7-537">If you specify a new autoscale evaluation interval, then the existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="02ee7-538">Det nya schemat är start den tid då en begäran att aktivera autoskalning har utfärdats.</span><span class="sxs-lookup"><span data-stu-id="02ee7-538">The new schedule's start time is the time at which the request to enable autoscaling was issued.</span></span>
  * <span data-ttu-id="02ee7-539">Om du utelämnar Autoskala formeln eller intervallet utvärdering, Batch-tjänsten fortsätter att använda det aktuella värdet för den här inställningen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-539">If you omit either the autoscale formula or evaluation interval, the Batch service continues to use the current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="02ee7-540">Om du har angett värden för den *targetDedicatedComputeNodes* eller *targetLowPriorityComputeNodes* parametrarna för den **CreatePool** metoden när du skapade poolen i .NET, eller jämförbar med parametrarna i ett annat språk sedan ignoreras när automatisk skalning formeln utvärderas.</span><span class="sxs-lookup"><span data-stu-id="02ee7-540">If you specified values for the *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of the **CreatePool** method when you created the pool in .NET, or for the comparable parameters in another language, then those values are ignored when the automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="02ee7-541">Den här C#-kodstycke använder den [Batch .NET] [ net_api] biblioteket för att aktivera autoskalning på en befintlig adresspool:</span><span class="sxs-lookup"><span data-stu-id="02ee7-541">This C# code snippet uses the [Batch .NET][net_api] library to enable autoscaling on an existing pool:</span></span>

```csharp
// Define the autoscaling formula. This formula sets the target number of nodes
// to 5 on Mondays, and 1 on every other day of the week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set the autoscale formula on the existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="02ee7-542">Uppdatera en Autoskala formel</span><span class="sxs-lookup"><span data-stu-id="02ee7-542">Update an autoscale formula</span></span>

<span data-ttu-id="02ee7-543">Om du vill uppdatera formeln på en befintlig Autoskala-aktiverade adresspool anropa åtgärden för att aktivera autoskalning igen med den nya formeln.</span><span class="sxs-lookup"><span data-stu-id="02ee7-543">To update the formula on an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new formula.</span></span> <span data-ttu-id="02ee7-544">Om exempelvis autoskalning är redan aktiverat på `myexistingpool` när följande .NET-kod körs dess Autoskala formel ersätts med innehållet i `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="02ee7-544">For example, if autoscaling is already enabled on `myexistingpool` when the following .NET code is executed, its autoscale formula is replaced with the contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-the-autoscale-interval"></a><span data-ttu-id="02ee7-545">Uppdateringsintervall Autoskala</span><span class="sxs-lookup"><span data-stu-id="02ee7-545">Update the autoscale interval</span></span>

<span data-ttu-id="02ee7-546">Om du vill uppdatera Autoskala-intervallet för utvärdering av en befintlig Autoskala-aktiverade pool anropa åtgärden för att aktivera autoskalning igen med ett nytt intervall.</span><span class="sxs-lookup"><span data-stu-id="02ee7-546">To update the autoscale evaluation interval of an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new interval.</span></span> <span data-ttu-id="02ee7-547">Till exempel ange intervallet för utvärdering Autoskala till 60 minuter för en pool som redan är aktiverat Autoskala i .NET:</span><span class="sxs-lookup"><span data-stu-id="02ee7-547">For example, to set the autoscale evaluation interval to 60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="02ee7-548">Utvärdera en Autoskala formel</span><span class="sxs-lookup"><span data-stu-id="02ee7-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="02ee7-549">Du kan utvärdera en formel innan den tillämpas på en pool.</span><span class="sxs-lookup"><span data-stu-id="02ee7-549">You can evaluate a formula before applying it to a pool.</span></span> <span data-ttu-id="02ee7-550">På så sätt kan testa du formel för att se hur rapporterna utvärdera innan du placerar formeln till produktionen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-550">In this way, you can test the formula to see how its statements evaluate before you put the formula into production.</span></span>

<span data-ttu-id="02ee7-551">Om du vill utvärdera en Autoskala formel, måste du först aktivera autoskalning i poolen med en giltig formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-551">To evaluate an autoscale formula, you must first enable autoscaling on the pool with a valid formula.</span></span> <span data-ttu-id="02ee7-552">Testa en formel i en pool som ännu inte har aktiverat autoskalning med en rad formeln `$TargetDedicatedNodes = 0` när du först aktivera autoskalning.</span><span class="sxs-lookup"><span data-stu-id="02ee7-552">To test a formula on a pool that doesn't yet have autoscaling enabled, use the one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="02ee7-553">Använd sedan någon av följande för att utvärdera formeln som du vill testa:</span><span class="sxs-lookup"><span data-stu-id="02ee7-553">Then, use one of the following to evaluate the formula you want to test:</span></span>

* <span data-ttu-id="02ee7-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) eller [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span><span class="sxs-lookup"><span data-stu-id="02ee7-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="02ee7-555">Metoderna Batch .NET kräver ID för en befintlig adresspool och en sträng som innehåller Autoskala formeln att utvärdera.</span><span class="sxs-lookup"><span data-stu-id="02ee7-555">These Batch .NET methods require the ID of an existing pool and a string containing the autoscale formula to evaluate.</span></span>

* [<span data-ttu-id="02ee7-556">Utvärdera en automatisk skalning formel</span><span class="sxs-lookup"><span data-stu-id="02ee7-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="02ee7-557">Ange pool-ID i URI: N och Autoskala formeln i i denna REST API-begäran den *autoScaleFormula* element i begärandetexten.</span><span class="sxs-lookup"><span data-stu-id="02ee7-557">In this REST API request, specify the pool ID in the URI, and the autoscale formula in the *autoScaleFormula* element of the request body.</span></span> <span data-ttu-id="02ee7-558">Svaret från åtgärden innehåller information om eventuella fel som kan vara relaterad till formeln.</span><span class="sxs-lookup"><span data-stu-id="02ee7-558">The response of the operation contains any error information that might be related to the formula.</span></span>

<span data-ttu-id="02ee7-559">I det här [Batch .NET] [ net_api] kodfragmentet vi utvärderar en Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="02ee7-560">Om poolen inte har aktiverats autoskalning, aktivera vi det först.</span><span class="sxs-lookup"><span data-stu-id="02ee7-560">If the pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference to an existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on the pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula to enable autoscaling on the
    // pool. This formula is valid, but won't resize the pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls to once every 30 seconds.
    // Because we want to apply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here to ensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh the properties of the pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on the pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // The formula to evaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform the autoscale formula evaluation. Note that this code does not
    // actually apply the formula to the pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print the results of the AutoScaleRun.
        // This will display the values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply the formula to the pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output the message associated with the error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="02ee7-561">Lyckad utvärdering av formeln som visas i det här kodstycket ger resultat som liknar:</span><span class="sxs-lookup"><span data-stu-id="02ee7-561">Successful evaluation of the formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="02ee7-562">Hämta information om Autoskala körs</span><span class="sxs-lookup"><span data-stu-id="02ee7-562">Get information about autoscale runs</span></span>

<span data-ttu-id="02ee7-563">För att säkerställa att din formel fungerar som förväntat, rekommenderar vi att du regelbundet kontrollera resultatet av autoskalning körs som Batch utför på din pool.</span><span class="sxs-lookup"><span data-stu-id="02ee7-563">To ensure that your formula is performing as expected, we recommend that you periodically check the results of the autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="02ee7-564">Att göra så, hämta (eller uppdatera) en referens till poolen, och kontrollera egenskaperna för dess sista Autoskala kör.</span><span class="sxs-lookup"><span data-stu-id="02ee7-564">To do so, get (or refresh) a reference to the pool, and examine the properties of its last autoscale run.</span></span>

<span data-ttu-id="02ee7-565">I Batch .NET den [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) -egenskap har flera egenskaper som innehåller information om den senaste autoskalning kör utförs på poolen:</span><span class="sxs-lookup"><span data-stu-id="02ee7-565">In Batch .NET, the [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about the latest automatic scaling run performed on the pool:</span></span>

* [<span data-ttu-id="02ee7-566">AutoScaleRun.Timestamp</span><span class="sxs-lookup"><span data-stu-id="02ee7-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="02ee7-567">AutoScaleRun.Results</span><span class="sxs-lookup"><span data-stu-id="02ee7-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="02ee7-568">AutoScaleRun.Error</span><span class="sxs-lookup"><span data-stu-id="02ee7-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="02ee7-569">I REST-API i [få information om poolen](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) begäran returnerar information om poolen, som innehåller den senaste autoskalning körs information den [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) egenskapen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-569">In the REST API, the [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about the pool, which includes the latest automatic scaling run information in the [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="02ee7-570">Följande C# kodfragment använder Batch .NET-biblioteket för att skriva ut information om senaste autoskalning körs på poolen _myPool_:</span><span class="sxs-lookup"><span data-stu-id="02ee7-570">The following C# code snippet uses the Batch .NET library to print information about the last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="02ee7-571">Utdata från den föregående fragment:</span><span class="sxs-lookup"><span data-stu-id="02ee7-571">Sample output of the preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="02ee7-572">Autoskala formler</span><span class="sxs-lookup"><span data-stu-id="02ee7-572">Example autoscale formulas</span></span>
<span data-ttu-id="02ee7-573">Nu ska vi titta på några formler som visar olika sätt att justera beräkningsresurser i poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-573">Let's look at a few formulas that show different ways to adjust the amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="02ee7-574">Exempel 1: Tidsbaserade justering</span><span class="sxs-lookup"><span data-stu-id="02ee7-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="02ee7-575">Anta att du vill justera poolstorleken baserat på dag i veckan och tid på dagen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-575">Suppose you want to adjust the pool size based on the day of the week and time of day.</span></span> <span data-ttu-id="02ee7-576">Det här exemplet visar hur du öka eller minska antalet noder i poolen i enlighet med detta.</span><span class="sxs-lookup"><span data-stu-id="02ee7-576">This example shows how to increase or decrease the number of nodes in the pool accordingly.</span></span>

<span data-ttu-id="02ee7-577">Formeln först hämtar den aktuella tiden.</span><span class="sxs-lookup"><span data-stu-id="02ee7-577">The formula first obtains the current time.</span></span> <span data-ttu-id="02ee7-578">Om det är en vardag (1-5) och inom arbetstid (8: 00 till 18: 00) har poolstorleken mål angetts till 20 noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-578">If it's a weekday (1-5) and within working hours (8 AM to 6 PM), the target pool size is set to 20 nodes.</span></span> <span data-ttu-id="02ee7-579">Annars är den inställd till 10 noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-579">Otherwise, it's set to 10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="02ee7-580">Exempel 2: Uppgiftsbaserade justering</span><span class="sxs-lookup"><span data-stu-id="02ee7-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="02ee7-581">I det här exemplet justeras poolstorleken baserat på antalet aktiviteter i kön.</span><span class="sxs-lookup"><span data-stu-id="02ee7-581">In this example, the pool size is adjusted based on the number of tasks in the queue.</span></span> <span data-ttu-id="02ee7-582">Både kommentarer och radbrytningar accepteras i formeln strängar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for the past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use the last sample point,
// otherwise we use the maximum of last sample point and the history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM to pending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// The pool size is capped at 20, if target VM value is more than that, set it
// to 20. This value should be adjusted according to your use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="02ee7-583">Exempel 3: Redovisning för parallella aktiviteter</span><span class="sxs-lookup"><span data-stu-id="02ee7-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="02ee7-584">Det här exemplet ändrar poolstorleken baserat på antalet aktiviteter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-584">This example adjusts the pool size based on the number of tasks.</span></span> <span data-ttu-id="02ee7-585">Den här formeln också tar hänsyn till den [MaxTasksPerComputeNode] [ net_maxtasks] värdet som har angetts för poolen.</span><span class="sxs-lookup"><span data-stu-id="02ee7-585">This formula also takes into account the [MaxTasksPerComputeNode][net_maxtasks] value that has been set for the pool.</span></span> <span data-ttu-id="02ee7-586">Den här metoden är användbar i situationer där [parallell körning av aktiviteten](batch-parallel-node-tasks.md) har aktiverats på din pool.</span><span class="sxs-lookup"><span data-stu-id="02ee7-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of the samples have been recorded in the past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set the number of nodes to add to one-fourth the number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set to 4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt to grow the number of compute nodes to match the number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep the nodes active until the tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="02ee7-587">Exempel 4: Ange ett inledande poolstorlek</span><span class="sxs-lookup"><span data-stu-id="02ee7-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="02ee7-588">Det här exemplet illustrerar ett C# kodstycke med en Autoskala formeln som anger poolstorleken till ett angivet antal noder för en inledande tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="02ee7-588">This example shows a C# code snippet with an autoscale formula that sets the pool size to a specified number of nodes for an initial time period.</span></span> <span data-ttu-id="02ee7-589">Sedan justeras den poolstorleken baserat på antalet körs och aktiva aktiviteter efter den ursprungliga tidsperioden har löpt ut.</span><span class="sxs-lookup"><span data-stu-id="02ee7-589">Then it adjusts the pool size based on the number of running and active tasks after the initial time period has elapsed.</span></span>

<span data-ttu-id="02ee7-590">Formeln i följande kodavsnitt:</span><span class="sxs-lookup"><span data-stu-id="02ee7-590">The formula in the following code snippet:</span></span>

* <span data-ttu-id="02ee7-591">Anger den första poolstorleken till fyra noder.</span><span class="sxs-lookup"><span data-stu-id="02ee7-591">Sets the initial pool size to four nodes.</span></span>
* <span data-ttu-id="02ee7-592">Justeras inte poolstorleken inom 10 minuter på poolens livscykel.</span><span class="sxs-lookup"><span data-stu-id="02ee7-592">Does not adjust the pool size within the first 10 minutes of the pool's lifecycle.</span></span>
* <span data-ttu-id="02ee7-593">Hämtar värdet för max antal efter 10 minuter körs och aktiva aktiviteter inom de senaste 60 minuterna.</span><span class="sxs-lookup"><span data-stu-id="02ee7-593">After 10 minutes, obtains the max value of the number of running and active tasks within the past 60 minutes.</span></span>
  * <span data-ttu-id="02ee7-594">Om båda värdena är 0 (som anger att inga aktiviteter körs eller aktiv under de senaste 60 minuterna), ange poolstorleken till 0.</span><span class="sxs-lookup"><span data-stu-id="02ee7-594">If both values are 0 (indicating that no tasks were running or active in the last 60 minutes), the pool size is set to 0.</span></span>
  * <span data-ttu-id="02ee7-595">Ingen ändring görs om antingen värdet är större än noll.</span><span class="sxs-lookup"><span data-stu-id="02ee7-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="02ee7-596">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="02ee7-596">Next steps</span></span>
* <span data-ttu-id="02ee7-597">[Maximera Azure Batch beräkning Resursanvändning med samtidiga nod uppgifter](batch-parallel-node-tasks.md) innehåller information om hur du kan köra flera aktiviteter samtidigt på datornoderna i din pool.</span><span class="sxs-lookup"><span data-stu-id="02ee7-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on the compute nodes in your pool.</span></span> <span data-ttu-id="02ee7-598">Förutom autoskalning, kan den här funktionen hjälpa för att sänka jobbet varaktighet för vissa arbetsbelastningar, spara pengar.</span><span class="sxs-lookup"><span data-stu-id="02ee7-598">In addition to autoscaling, this feature may help to lower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="02ee7-599">Se till att tillämpningsprogrammet Batch frågar Batch-tjänsten på ett optimalt sätt för en annan effektivitet booster.</span><span class="sxs-lookup"><span data-stu-id="02ee7-599">For another efficiency booster, ensure that your Batch application queries the Batch service in the most optimal way.</span></span> <span data-ttu-id="02ee7-600">Se [fråga Azure Batch-tjänsten effektivt](batch-efficient-list-queries.md) information om hur du begränsar hur mycket data som passerar kabeln när du frågar status för tusentals compute-noder eller uppgifter.</span><span class="sxs-lookup"><span data-stu-id="02ee7-600">See [Query the Azure Batch service efficiently](batch-efficient-list-queries.md) to learn how to limit the amount of data that crosses the wire when you query the status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
