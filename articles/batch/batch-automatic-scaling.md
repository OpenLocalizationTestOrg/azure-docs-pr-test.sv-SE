---
title: aaaAutomatically skala compute-noder i en Azure Batch-pool | Microsoft Docs
description: "Aktivera automatisk skalning på ett moln poolen toodynamically justera hello antalet compute-noder i hello pool."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: b6d1e0c5d8e0e56e15a4d3588150f2466a689f19
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="4c359-103">Skapa en automatisk skalning formel för att skala beräkningsnoder i en Batch-pool</span><span class="sxs-lookup"><span data-stu-id="4c359-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="4c359-104">Azure Batch skala automatiskt poolerna baserat på parametrarna som du definierar.</span><span class="sxs-lookup"><span data-stu-id="4c359-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="4c359-105">Automatisk skalning Batch lägger till dynamiskt noder tooa poolen som aktiviteten krav och tar bort compute-noder som de minska.</span><span class="sxs-lookup"><span data-stu-id="4c359-105">With automatic scaling, Batch dynamically adds nodes tooa pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="4c359-106">Du kan spara både tid och pengar genom att automatiskt justera hello antalet datornoderna används av Batch-program.</span><span class="sxs-lookup"><span data-stu-id="4c359-106">You can save both time and money by automatically adjusting hello number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="4c359-107">Du aktiverar automatisk skalning på en pool av datornoderna genom att associera med en *Autoskala formeln* som du definierar.</span><span class="sxs-lookup"><span data-stu-id="4c359-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="4c359-108">hello Batch-tjänsten använder hello Autoskala formeln toodetermine hello antal compute-noder som är nödvändiga tooexecute din arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="4c359-108">hello Batch service uses hello autoscale formula toodetermine hello number of compute nodes that are needed tooexecute your workload.</span></span> <span data-ttu-id="4c359-109">Compute-noder kan vara dedikerade noder eller [låg prioritet noder](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="4c359-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="4c359-110">Batch svarar tooservice mått data som samlas in regelbundet.</span><span class="sxs-lookup"><span data-stu-id="4c359-110">Batch responds tooservice metrics data that is collected periodically.</span></span> <span data-ttu-id="4c359-111">Med den här mätvärdesdata kan justeras Batch hello antalet beräkningsnoder i hello poolen baserat på din formel och en konfigurerbar intervall.</span><span class="sxs-lookup"><span data-stu-id="4c359-111">Using this metrics data, Batch adjusts hello number of compute nodes in hello pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="4c359-112">Du kan aktivera automatisk skalning när poolen har skapats, eller på en befintlig adresspool.</span><span class="sxs-lookup"><span data-stu-id="4c359-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="4c359-113">Du kan även ändra en befintlig formel på en pool som har konfigurerats för autoskalning.</span><span class="sxs-lookup"><span data-stu-id="4c359-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="4c359-114">Batch kan tooevaluate formlerna innan du tilldelar dem toopools och toomonitor hello status autoskalning körs.</span><span class="sxs-lookup"><span data-stu-id="4c359-114">Batch enables you tooevaluate your formulas before assigning them toopools and toomonitor hello status of automatic scaling runs.</span></span>

<span data-ttu-id="4c359-115">Den här artikeln beskrivs hello olika enheter som utgör ditt Autoskala formler, inklusive variabler, operatorer, funktioner och funktioner.</span><span class="sxs-lookup"><span data-stu-id="4c359-115">This article discusses hello various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="4c359-116">Diskuterar hur tooobtain olika compute resurs- och mått i Batch.</span><span class="sxs-lookup"><span data-stu-id="4c359-116">We discuss how tooobtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="4c359-117">Du kan använda dessa mått tooadjust antalet för din pool-noder baserat på resursen användnings- och status.</span><span class="sxs-lookup"><span data-stu-id="4c359-117">You can use these metrics tooadjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="4c359-118">Sedan beskrivs hur tooconstruct en formel och aktivera automatisk skalning på en pool med hjälp av både hello Batch REST och .NET-API: er.</span><span class="sxs-lookup"><span data-stu-id="4c359-118">We then describe how tooconstruct a formula and enable automatic scaling on a pool by using both hello Batch REST and .NET APIs.</span></span> <span data-ttu-id="4c359-119">Slutligen vi med några formler.</span><span class="sxs-lookup"><span data-stu-id="4c359-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4c359-120">När du skapar ett Batch-konto kan du ange hello [kontokonfigurationen](batch-api-basics.md#account), som bestämmer om pooler tilldelas i en prenumeration på tjänsten Batch (hello standard) eller i din prenumeration för användaren.</span><span class="sxs-lookup"><span data-stu-id="4c359-120">When you create a Batch account, you can specify hello [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (hello default), or in your user subscription.</span></span> <span data-ttu-id="4c359-121">Om du har skapat Batch-kontot med hello standardkonfiguration för Batch-tjänsten är begränsad tooa högsta antalet kärnor som kan användas för bearbetning med ditt konto.</span><span class="sxs-lookup"><span data-stu-id="4c359-121">If you created your Batch account with hello default Batch Service configuration, then your account is limited tooa maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="4c359-122">hello Batch-tjänsten skalas datornoderna bara in toothat core gränsen.</span><span class="sxs-lookup"><span data-stu-id="4c359-122">hello Batch service scales compute nodes only up toothat core limit.</span></span> <span data-ttu-id="4c359-123">Därför nå hello Batch-tjänsten inte hello mål antalet compute-noder som anges av en Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-123">For this reason, hello Batch service may not reach hello target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="4c359-124">Se [kvoter och gränser för hello Azure Batch-tjänsten](batch-quota-limit.md) information för att visa och öka kvoter för ditt konto.</span><span class="sxs-lookup"><span data-stu-id="4c359-124">See [Quotas and limits for hello Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="4c359-125">Om du har skapat ditt konto med hello användarens prenumeration konfigurationen delar ditt konto i hello kärnkvot för hello prenumeration.</span><span class="sxs-lookup"><span data-stu-id="4c359-125">If you created your account with hello User Subscription configuration, then your account shares in hello core quota for hello subscription.</span></span> <span data-ttu-id="4c359-126">Mer information finns i [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) (Gränser för virtuella datorer) i [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md) (Prenumerations- och tjänstgränser, kvoter och begränsningar i Azure).</span><span class="sxs-lookup"><span data-stu-id="4c359-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="4c359-127">Automatisk skalning formler</span><span class="sxs-lookup"><span data-stu-id="4c359-127">Automatic scaling formulas</span></span>
<span data-ttu-id="4c359-128">En automatisk skalning formeln är ett strängvärde som du definierar som innehåller en eller flera instruktioner.</span><span class="sxs-lookup"><span data-stu-id="4c359-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="4c359-129">hello Autoskala formeln tilldelas tooa pool [autoScaleFormula] [ rest_autoscaleformula] element (Batch REST) eller [CloudPool.AutoScaleFormula] [ net_cloudpool_autoscaleformula] Egenskapen (Batch .NET).</span><span class="sxs-lookup"><span data-stu-id="4c359-129">hello autoscale formula is assigned tooa pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="4c359-130">hello Batch-tjänsten använder formeln toodetermine hello mål antal compute-noder i hello pool för hello nästa intervall för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="4c359-130">hello Batch service uses your formula toodetermine hello target number of compute nodes in hello pool for hello next interval of processing.</span></span> <span data-ttu-id="4c359-131">hello formeln strängen får inte överskrida 8 KB, kan innehålla upp too100 instruktioner som avgränsas med semikolon och kan innehålla radbrytningar och kommentarer.</span><span class="sxs-lookup"><span data-stu-id="4c359-131">hello formula string cannot exceed 8 KB, can include up too100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="4c359-132">Du kan se automatisk skalning formler som en Batch Autoskala ”språk”.</span><span class="sxs-lookup"><span data-stu-id="4c359-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="4c359-133">Formeln satser är kostnadsfri utformad uttryck som kan innehålla både tjänsten användardefinierade variabler (variabler som definieras av hello Batch-tjänsten) och användardefinierade variabler (variabler som du definierar).</span><span class="sxs-lookup"><span data-stu-id="4c359-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by hello Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="4c359-134">De kan utföra olika åtgärder på dessa värden med hjälp av inbyggda typer, operatorer och funktioner.</span><span class="sxs-lookup"><span data-stu-id="4c359-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="4c359-135">En instruktion kan till exempel ta hello följande format:</span><span class="sxs-lookup"><span data-stu-id="4c359-135">For example, a statement might take hello following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="4c359-136">Formler innehåller vanligtvis flera instruktioner som utför åtgärder på värden som hämtas i tidigare rapporter.</span><span class="sxs-lookup"><span data-stu-id="4c359-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="4c359-137">Till exempel först vi hämta ett värde för `variable1`, överför den tooa funktionen toopopulate `variable2`:</span><span class="sxs-lookup"><span data-stu-id="4c359-137">For example, first we obtain a value for `variable1`, then pass it tooa function toopopulate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="4c359-138">Med de här uttrycken i din Autoskala formeln tooarrive på ett mål som antal compute-noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-138">Include these statements in your autoscale formula tooarrive at a target number of compute nodes.</span></span> <span data-ttu-id="4c359-139">Dedikerad noder och låg prioritet noder har sina egna Målinställningar så att du kan definiera ett mål för varje nod.</span><span class="sxs-lookup"><span data-stu-id="4c359-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="4c359-140">En Autoskala formel kan innehålla ett målvärde för dedikerade noder, ett målvärde för låg prioritet noder eller båda.</span><span class="sxs-lookup"><span data-stu-id="4c359-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="4c359-141">hello mål antalet noder kan vara högre eller lägre eller hello lika hello aktuellt antal noder av typen i hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-141">hello target number of nodes may be higher, lower, or hello same as hello current number of nodes of that type in hello pool.</span></span> <span data-ttu-id="4c359-142">Batch utvärderar en pool Autoskala formel med ett specifikt intervall (se [autoskalning intervall](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="4c359-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="4c359-143">Batch justerar hello målnumret för varje typ av nod i hello poolen toohello tal som Autoskala formeln anger vid hello tiden för utvärderingen.</span><span class="sxs-lookup"><span data-stu-id="4c359-143">Batch adjusts hello target number of each type of node in hello pool toohello number that your autoscale formula specifies at hello time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="4c359-144">Autoskala formeln</span><span class="sxs-lookup"><span data-stu-id="4c359-144">Sample autoscale formula</span></span>

<span data-ttu-id="4c359-145">Här är ett exempel på en formel för Autoskala som kan vara justerade toowork för de flesta scenarier.</span><span class="sxs-lookup"><span data-stu-id="4c359-145">Here is an example of an autoscale formula that can be adjusted toowork for most scenarios.</span></span> <span data-ttu-id="4c359-146">Hej variabler `startingNumberOfVMs` och `maxNumberofVMs` i hello exempel formeln kan vara justerade tooyour behov.</span><span class="sxs-lookup"><span data-stu-id="4c359-146">hello variables `startingNumberOfVMs` and `maxNumberofVMs` in hello example formula can be adjusted tooyour needs.</span></span> <span data-ttu-id="4c359-147">Den här formeln skalas dedikerade noder, men kan vara ändrade tooapply tooscale låg prioritet noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-147">This formula scales dedicated nodes, but can be modified tooapply tooscale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="4c359-148">Med den här formeln Autoskala skapas hello poolen med en enda virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="4c359-148">With this autoscale formula, hello pool is initially created with a single VM.</span></span> <span data-ttu-id="4c359-149">Hej `$PendingTasks` mått definierar hello antalet aktiviteter som körs eller står i kö.</span><span class="sxs-lookup"><span data-stu-id="4c359-149">hello `$PendingTasks` metric defines hello number of tasks that are running or queued.</span></span> <span data-ttu-id="4c359-150">hello formeln hittar hello Genomsnittligt antal väntande aktiviteter i hello senaste 180 sekunder och anger hello `$TargetDedicatedNodes` variabeln därefter.</span><span class="sxs-lookup"><span data-stu-id="4c359-150">hello formula finds hello average number of pending tasks in hello last 180 seconds and sets hello `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="4c359-151">hello formeln säkerställer att hello mål antalet dedicerade noder aldrig överstiger 25 virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="4c359-151">hello formula ensures that hello target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="4c359-152">När nya aktiviteter skickas växer hello poolen automatiskt.</span><span class="sxs-lookup"><span data-stu-id="4c359-152">As new tasks are submitted, hello pool automatically grows.</span></span> <span data-ttu-id="4c359-153">Som slutförda uppgifter, virtuella datorer blir ledigt i taget och hello autoskalning formeln krymper hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-153">As tasks complete, VMs become free one by one and hello autoscaling formula shrinks hello pool.</span></span>

## <a name="variables"></a><span data-ttu-id="4c359-154">Variabler</span><span class="sxs-lookup"><span data-stu-id="4c359-154">Variables</span></span>
<span data-ttu-id="4c359-155">Du kan använda båda **tjänst definierade** och **användardefinierade** variabler i Autoskala formlerna.</span><span class="sxs-lookup"><span data-stu-id="4c359-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="4c359-156">hello tjänst definierade variabler är inbyggda i toohello Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4c359-156">hello service-defined variables are built in toohello Batch service.</span></span> <span data-ttu-id="4c359-157">Några variabler som definieras av tjänsten är skrivskyddad och vissa är skrivskyddad.</span><span class="sxs-lookup"><span data-stu-id="4c359-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="4c359-158">Användardefinierade variabler är variabler som du definierar.</span><span class="sxs-lookup"><span data-stu-id="4c359-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="4c359-159">I hello Exempelformel visas i föregående avsnitt hello `$TargetDedicatedNodes` och `$PendingTasks` är variabler som definieras av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4c359-159">In hello example formula shown in hello previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="4c359-160">Variabler `startingNumberOfVMs` och `maxNumberofVMs` är användardefinierade variabler.</span><span class="sxs-lookup"><span data-stu-id="4c359-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="4c359-161">Tjänst-definierade variabler föregås alltid av ett dollartecken ($).</span><span class="sxs-lookup"><span data-stu-id="4c359-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="4c359-162">För användardefinierade variabler är hello dollartecken valfritt.</span><span class="sxs-lookup"><span data-stu-id="4c359-162">For user-defined variables, hello dollar sign is optional.</span></span>
>
>

<span data-ttu-id="4c359-163">hello följande tabeller visar både läs-och skrivbara och skrivskyddade variabler som definieras av hello Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4c359-163">hello following tables show both read-write and read-only variables that are defined by hello Batch service.</span></span>

<span data-ttu-id="4c359-164">Du kan hämta och ange hello värdena för dessa variabler som definieras av tjänsten toomanage hello antalet compute-noder i en pool:</span><span class="sxs-lookup"><span data-stu-id="4c359-164">You can get and set hello values of these service-defined variables toomanage hello number of compute nodes in a pool:</span></span>

| <span data-ttu-id="4c359-165">Läsa / skriva-tjänst-definierade variabler</span><span class="sxs-lookup"><span data-stu-id="4c359-165">Read-write service-defined variables</span></span> | <span data-ttu-id="4c359-166">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="4c359-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4c359-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="4c359-168">hello mål antal dedikerade compute-noder för hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-168">hello target number of dedicated compute nodes for hello pool.</span></span> <span data-ttu-id="4c359-169">hello antalet dedicerade noder har angetts som mål eftersom en pool inte kan alltid får hello önskad antalet noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-169">hello number of dedicated nodes is specified as a target because a pool may not always achieve hello desired number of nodes.</span></span> <span data-ttu-id="4c359-170">Till exempel hello mål antalet dedicerade noder har ändrats av en Autoskala utvärdering innan hello poolen har nått hello inledande mål och hello poolen kan inte nå hello mål.</span><span class="sxs-lookup"><span data-stu-id="4c359-170">For example, if hello target number of dedicated nodes is modified by an autoscale evaluation before hello pool has reached hello initial target, then hello pool may not reach hello target.</span></span> <br /><br /> <span data-ttu-id="4c359-171">Poolen på ett konto som har skapats med hello Batch-tjänsten konfiguration kan inte uppnå målet om hello mål är längre än en nod eller core batchkonton.</span><span class="sxs-lookup"><span data-stu-id="4c359-171">A pool in an account created with hello Batch Service configuration may not achieve its target if hello target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="4c359-172">Poolen på ett konto som har skapats med hello användarens prenumeration konfiguration kan inte uppnå målet om hello mål överskrider hello delade kärnkvot för hello prenumeration.</span><span class="sxs-lookup"><span data-stu-id="4c359-172">A pool in an account created with hello User Subscription configuration may not achieve its target if hello target exceeds hello shared core quota for hello subscription.</span></span>|
| <span data-ttu-id="4c359-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="4c359-174">hello mål antalet låg prioritet compute-noder för hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-174">hello target number of low-priority compute nodes for hello pool.</span></span> <span data-ttu-id="4c359-175">hello antal låg prioritet noder har angetts som mål eftersom en pool inte kan alltid får hello önskad antalet noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-175">hello number of low-priority nodes is specified as a target because a pool may not always achieve hello desired number of nodes.</span></span> <span data-ttu-id="4c359-176">Till exempel hello mål antalet noder med låg prioritet har ändrats av en Autoskala utvärdering innan hello poolen har nått hello inledande mål och hello poolen kan inte nå hello mål.</span><span class="sxs-lookup"><span data-stu-id="4c359-176">For example, if hello target number of low-priority nodes is modified by an autoscale evaluation before hello pool has reached hello initial target, then hello pool may not reach hello target.</span></span> <span data-ttu-id="4c359-177">En pool kan också inte uppnå målet om hello mål är längre än en nod eller core batchkonton.</span><span class="sxs-lookup"><span data-stu-id="4c359-177">A pool may also not achieve its target if hello target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="4c359-178">Mer information på låg prioritet datornoder finns [använda VM med låg prioritet med Batch (förhandsgranskning)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="4c359-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="4c359-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="4c359-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="4c359-180">hello vad som händer när datornoderna tas bort från poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-180">hello action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="4c359-181">Möjliga värden:</span><span class="sxs-lookup"><span data-stu-id="4c359-181">Possible values are:</span></span><ul><li><span data-ttu-id="4c359-182">**meddelanden**--avslutar aktiviteter omedelbart och placerar dem på hello jobbkön så att de schemaläggs.</span><span class="sxs-lookup"><span data-stu-id="4c359-182">**requeue**--Terminates tasks immediately and puts them back on hello job queue so that they are rescheduled.</span></span><li><span data-ttu-id="4c359-183">**Avsluta**--avslutar aktiviteter omedelbart och tar bort dem från hello jobbkön.</span><span class="sxs-lookup"><span data-stu-id="4c359-183">**terminate**--Terminates tasks immediately and removes them from hello job queue.</span></span><li><span data-ttu-id="4c359-184">**taskcompletion**--väntar för pågående aktiviteter toofinish och sedan tar bort hello noden från hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-184">**taskcompletion**--Waits for currently running tasks toofinish and then removes hello node from hello pool.</span></span><li><span data-ttu-id="4c359-185">**retaineddata**--väntar på alla hello lokala uppgift behålls data på hello nod toobe rensas innan du tar bort hello noden från hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-185">**retaineddata**--Waits for all hello local task-retained data on hello node toobe cleaned up before removing hello node from hello pool.</span></span></ul> |

<span data-ttu-id="4c359-186">Du kan få hello värdet för dessa variabler som definieras av tjänsten toomake justeringar som baseras på mått för hello Batch-tjänsten:</span><span class="sxs-lookup"><span data-stu-id="4c359-186">You can get hello value of these service-defined variables toomake adjustments that are based on metrics from hello Batch service:</span></span>

| <span data-ttu-id="4c359-187">Skrivskyddade tjänst definierade variabler</span><span class="sxs-lookup"><span data-stu-id="4c359-187">Read-only service-defined variables</span></span> | <span data-ttu-id="4c359-188">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="4c359-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4c359-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="4c359-189">$CPUPercent</span></span> |<span data-ttu-id="4c359-190">hello genomsnittliga procentandelen av CPU-användning.</span><span class="sxs-lookup"><span data-stu-id="4c359-190">hello average percentage of CPU usage.</span></span> |
| <span data-ttu-id="4c359-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="4c359-191">$WallClockSeconds</span></span> |<span data-ttu-id="4c359-192">hello antal sekunder som används.</span><span class="sxs-lookup"><span data-stu-id="4c359-192">hello number of seconds consumed.</span></span> |
| <span data-ttu-id="4c359-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-193">$MemoryBytes</span></span> |<span data-ttu-id="4c359-194">hello Genomsnittligt antal megabyte som används.</span><span class="sxs-lookup"><span data-stu-id="4c359-194">hello average number of megabytes used.</span></span> |
| <span data-ttu-id="4c359-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-195">$DiskBytes</span></span> |<span data-ttu-id="4c359-196">hello Genomsnittligt antal gigabyte används på hello lokala diskar.</span><span class="sxs-lookup"><span data-stu-id="4c359-196">hello average number of gigabytes used on hello local disks.</span></span> |
| <span data-ttu-id="4c359-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-197">$DiskReadBytes</span></span> |<span data-ttu-id="4c359-198">hello antal lästa byte.</span><span class="sxs-lookup"><span data-stu-id="4c359-198">hello number of bytes read.</span></span> |
| <span data-ttu-id="4c359-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-199">$DiskWriteBytes</span></span> |<span data-ttu-id="4c359-200">hello antalet skrivna byte.</span><span class="sxs-lookup"><span data-stu-id="4c359-200">hello number of bytes written.</span></span> |
| <span data-ttu-id="4c359-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="4c359-201">$DiskReadOps</span></span> |<span data-ttu-id="4c359-202">hello antal lästa diskåtgärder utföras.</span><span class="sxs-lookup"><span data-stu-id="4c359-202">hello count of read disk operations performed.</span></span> |
| <span data-ttu-id="4c359-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="4c359-203">$DiskWriteOps</span></span> |<span data-ttu-id="4c359-204">hello antal skrivåtgärder på disken utförs.</span><span class="sxs-lookup"><span data-stu-id="4c359-204">hello count of write disk operations performed.</span></span> |
| <span data-ttu-id="4c359-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-205">$NetworkInBytes</span></span> |<span data-ttu-id="4c359-206">hello antal inkommande byte.</span><span class="sxs-lookup"><span data-stu-id="4c359-206">hello number of inbound bytes.</span></span> |
| <span data-ttu-id="4c359-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-207">$NetworkOutBytes</span></span> |<span data-ttu-id="4c359-208">hello antal utgående byte.</span><span class="sxs-lookup"><span data-stu-id="4c359-208">hello number of outbound bytes.</span></span> |
| <span data-ttu-id="4c359-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="4c359-209">$SampleNodeCount</span></span> |<span data-ttu-id="4c359-210">hello antal compute-noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-210">hello count of compute nodes.</span></span> |
| <span data-ttu-id="4c359-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-211">$ActiveTasks</span></span> |<span data-ttu-id="4c359-212">hello antalet aktiviteter som är redo tooexecute men ännu inte körs.</span><span class="sxs-lookup"><span data-stu-id="4c359-212">hello number of tasks that are ready tooexecute but are not yet executing.</span></span> <span data-ttu-id="4c359-213">Hej $ActiveTasks antal omfattar alla aktiviteter som är aktiv för hello och vars förutsättningar är uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="4c359-213">hello $ActiveTasks count includes all tasks that are in hello active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="4c359-214">Alla aktiviteter som finns i aktivt läge för hello men vars beroenden är inte uppfyllda undantas från hello $ActiveTasks count.</span><span class="sxs-lookup"><span data-stu-id="4c359-214">Any tasks that are in hello active state but whose dependencies have not been satisfied are excluded from hello $ActiveTasks count.</span></span>|
| <span data-ttu-id="4c359-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-215">$RunningTasks</span></span> |<span data-ttu-id="4c359-216">hello antal aktiviteter körs.</span><span class="sxs-lookup"><span data-stu-id="4c359-216">hello number of tasks in a running state.</span></span> |
| <span data-ttu-id="4c359-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-217">$PendingTasks</span></span> |<span data-ttu-id="4c359-218">hello summan av $ActiveTasks och $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="4c359-218">hello sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="4c359-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-219">$SucceededTasks</span></span> |<span data-ttu-id="4c359-220">hello antalet uppgifter som har slutförts.</span><span class="sxs-lookup"><span data-stu-id="4c359-220">hello number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="4c359-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-221">$FailedTasks</span></span> |<span data-ttu-id="4c359-222">hello antalet uppgifter som misslyckades.</span><span class="sxs-lookup"><span data-stu-id="4c359-222">hello number of tasks that failed.</span></span> |
| <span data-ttu-id="4c359-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="4c359-224">hello aktuellt antal dedikerade compute-noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-224">hello current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="4c359-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="4c359-226">hello aktuellt antal låg prioritet compute-noder, inklusive alla noder som är försenat.</span><span class="sxs-lookup"><span data-stu-id="4c359-226">hello current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="4c359-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="4c359-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="4c359-228">hello antalet noder i hello poolen som är i tillståndet försenat.</span><span class="sxs-lookup"><span data-stu-id="4c359-228">hello number of nodes in hello pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="4c359-229">hello skrivskyddad, tjänst-definierade variabler som visas i hello föregående tabell är *objekt* som ger olika metoder tooaccess data som är associerade med varje.</span><span class="sxs-lookup"><span data-stu-id="4c359-229">hello read-only, service-defined variables that are shown in hello previous table are *objects* that provide various methods tooaccess data associated with each.</span></span> <span data-ttu-id="4c359-230">Mer information finns i [Hämta exempeldata](#getsampledata) senare i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="4c359-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="4c359-231">Typer</span><span class="sxs-lookup"><span data-stu-id="4c359-231">Types</span></span>
<span data-ttu-id="4c359-232">Dessa typer stöds i en formel:</span><span class="sxs-lookup"><span data-stu-id="4c359-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="4c359-233">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-233">double</span></span>
* <span data-ttu-id="4c359-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-234">doubleVec</span></span>
* <span data-ttu-id="4c359-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="4c359-235">doubleVecList</span></span>
* <span data-ttu-id="4c359-236">Sträng</span><span class="sxs-lookup"><span data-stu-id="4c359-236">string</span></span>
* <span data-ttu-id="4c359-237">tidsstämpeln--tidsstämpel är en sammansatt struktur som innehåller hello följande medlemmar:</span><span class="sxs-lookup"><span data-stu-id="4c359-237">timestamp--timestamp is a compound structure that contains hello following members:</span></span>

  * <span data-ttu-id="4c359-238">År</span><span class="sxs-lookup"><span data-stu-id="4c359-238">year</span></span>
  * <span data-ttu-id="4c359-239">månaden (1-12)</span><span class="sxs-lookup"><span data-stu-id="4c359-239">month (1-12)</span></span>
  * <span data-ttu-id="4c359-240">dag (1-31)</span><span class="sxs-lookup"><span data-stu-id="4c359-240">day (1-31)</span></span>
  * <span data-ttu-id="4c359-241">veckodag (hello formatet för tal, till exempel 1 för måndag)</span><span class="sxs-lookup"><span data-stu-id="4c359-241">weekday (in hello format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="4c359-242">timme (i 24-timmarsformat format, till exempel 13 innebär 1 PM)</span><span class="sxs-lookup"><span data-stu-id="4c359-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="4c359-243">minuter (00-59)</span><span class="sxs-lookup"><span data-stu-id="4c359-243">minute (00-59)</span></span>
  * <span data-ttu-id="4c359-244">andra (00-59)</span><span class="sxs-lookup"><span data-stu-id="4c359-244">second (00-59)</span></span>
* <span data-ttu-id="4c359-245">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="4c359-245">timeinterval</span></span>

  * <span data-ttu-id="4c359-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="4c359-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="4c359-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="4c359-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="4c359-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="4c359-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="4c359-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="4c359-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="4c359-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="4c359-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="4c359-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="4c359-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="4c359-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="4c359-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="4c359-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="4c359-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="4c359-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="4c359-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="4c359-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="4c359-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="4c359-256">Åtgärder</span><span class="sxs-lookup"><span data-stu-id="4c359-256">Operations</span></span>
<span data-ttu-id="4c359-257">Dessa åtgärder är tillåtna på hello-typer som anges i hello föregående avsnitt.</span><span class="sxs-lookup"><span data-stu-id="4c359-257">These operations are allowed on hello types that are listed in hello previous section.</span></span>

| <span data-ttu-id="4c359-258">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="4c359-258">Operation</span></span> | <span data-ttu-id="4c359-259">Stöds operatorer</span><span class="sxs-lookup"><span data-stu-id="4c359-259">Supported operators</span></span> | <span data-ttu-id="4c359-260">Typ av resultat</span><span class="sxs-lookup"><span data-stu-id="4c359-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4c359-261">dubbla *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-261">double *operator* double</span></span> |<span data-ttu-id="4c359-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="4c359-262">+, -, *, /</span></span> |<span data-ttu-id="4c359-263">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-263">double</span></span> |
| <span data-ttu-id="4c359-264">dubbla *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="4c359-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="4c359-265">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="4c359-265">timeinterval</span></span> |
| <span data-ttu-id="4c359-266">doubleVec *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-266">doubleVec *operator* double</span></span> |<span data-ttu-id="4c359-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="4c359-267">+, -, *, /</span></span> |<span data-ttu-id="4c359-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-268">doubleVec</span></span> |
| <span data-ttu-id="4c359-269">doubleVec *operatorn* doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="4c359-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="4c359-270">+, -, *, /</span></span> |<span data-ttu-id="4c359-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-271">doubleVec</span></span> |
| <span data-ttu-id="4c359-272">TimeInterval *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-272">timeinterval *operator* double</span></span> |<span data-ttu-id="4c359-273">*, /</span><span class="sxs-lookup"><span data-stu-id="4c359-273">*, /</span></span> |<span data-ttu-id="4c359-274">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="4c359-274">timeinterval</span></span> |
| <span data-ttu-id="4c359-275">TimeInterval *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="4c359-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="4c359-276">+, -</span><span class="sxs-lookup"><span data-stu-id="4c359-276">+, -</span></span> |<span data-ttu-id="4c359-277">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="4c359-277">timeinterval</span></span> |
| <span data-ttu-id="4c359-278">TimeInterval *operatorn* tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="4c359-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="4c359-279">tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="4c359-279">timestamp</span></span> |
| <span data-ttu-id="4c359-280">tidsstämpel *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="4c359-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="4c359-281">tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="4c359-281">timestamp</span></span> |
| <span data-ttu-id="4c359-282">tidsstämpel *operatorn* tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="4c359-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="4c359-283">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="4c359-283">timeinterval</span></span> |
| <span data-ttu-id="4c359-284">*operatorn*dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-284">*operator*double</span></span> |<span data-ttu-id="4c359-285">-, !</span><span class="sxs-lookup"><span data-stu-id="4c359-285">-, !</span></span> |<span data-ttu-id="4c359-286">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-286">double</span></span> |
| <span data-ttu-id="4c359-287">*operatorn*timeinterval</span><span class="sxs-lookup"><span data-stu-id="4c359-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="4c359-288">TimeInterval</span><span class="sxs-lookup"><span data-stu-id="4c359-288">timeinterval</span></span> |
| <span data-ttu-id="4c359-289">dubbla *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-289">double *operator* double</span></span> |<span data-ttu-id="4c359-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="4c359-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="4c359-291">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-291">double</span></span> |
| <span data-ttu-id="4c359-292">strängen *operatorn* sträng</span><span class="sxs-lookup"><span data-stu-id="4c359-292">string *operator* string</span></span> |<span data-ttu-id="4c359-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="4c359-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="4c359-294">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-294">double</span></span> |
| <span data-ttu-id="4c359-295">tidsstämpel *operatorn* tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="4c359-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="4c359-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="4c359-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="4c359-297">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-297">double</span></span> |
| <span data-ttu-id="4c359-298">TimeInterval *operatorn* timeinterval</span><span class="sxs-lookup"><span data-stu-id="4c359-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="4c359-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="4c359-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="4c359-300">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-300">double</span></span> |
| <span data-ttu-id="4c359-301">dubbla *operatorn* dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-301">double *operator* double</span></span> |<span data-ttu-id="4c359-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="4c359-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="4c359-303">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-303">double</span></span> |

<span data-ttu-id="4c359-304">När du testar ett double med en ternär operator (`double ? statement1 : statement2`) inte är noll är **SANT**, och noll är **FALSKT**.</span><span class="sxs-lookup"><span data-stu-id="4c359-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="4c359-305">Funktioner</span><span class="sxs-lookup"><span data-stu-id="4c359-305">Functions</span></span>
<span data-ttu-id="4c359-306">De här fördefinierade **funktioner** är tillgängliga för toouse för att definiera en automatisk skalning formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-306">These predefined **functions** are available for you toouse in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="4c359-307">Funktionen</span><span class="sxs-lookup"><span data-stu-id="4c359-307">Function</span></span> | <span data-ttu-id="4c359-308">Returtyp</span><span class="sxs-lookup"><span data-stu-id="4c359-308">Return type</span></span> | <span data-ttu-id="4c359-309">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="4c359-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4c359-310">AVG(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-310">avg(doubleVecList)</span></span> |<span data-ttu-id="4c359-311">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-311">double</span></span> |<span data-ttu-id="4c359-312">Returnerar hello medelvärdet för alla värden i hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-312">Returns hello average value for all values in hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-313">Len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-313">len(doubleVecList)</span></span> |<span data-ttu-id="4c359-314">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-314">double</span></span> |<span data-ttu-id="4c359-315">Returnerar hello hello-vektorn som skapas från hello doubleVecList längd.</span><span class="sxs-lookup"><span data-stu-id="4c359-315">Returns hello length of hello vector that is created from hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-316">LG(Double)</span><span class="sxs-lookup"><span data-stu-id="4c359-316">lg(double)</span></span> |<span data-ttu-id="4c359-317">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-317">double</span></span> |<span data-ttu-id="4c359-318">Returnerar hello loggen bas 2 av hello dubbla.</span><span class="sxs-lookup"><span data-stu-id="4c359-318">Returns hello log base 2 of hello double.</span></span> |
| <span data-ttu-id="4c359-319">LG(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-319">lg(doubleVecList)</span></span> |<span data-ttu-id="4c359-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-320">doubleVec</span></span> |<span data-ttu-id="4c359-321">Returnerar hello component-wise loggen bas 2 av hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-321">Returns hello component-wise log base 2 of hello doubleVecList.</span></span> <span data-ttu-id="4c359-322">En vec(double) måste uttryckligen skickades för hello-parametern.</span><span class="sxs-lookup"><span data-stu-id="4c359-322">A vec(double) must be explicitly passed for hello parameter.</span></span> <span data-ttu-id="4c359-323">Annars antas hello dubbla lg(double) version.</span><span class="sxs-lookup"><span data-stu-id="4c359-323">Otherwise, hello double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="4c359-324">LN(Double)</span><span class="sxs-lookup"><span data-stu-id="4c359-324">ln(double)</span></span> |<span data-ttu-id="4c359-325">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-325">double</span></span> |<span data-ttu-id="4c359-326">Returnerar hello naturlig log hello dubbla.</span><span class="sxs-lookup"><span data-stu-id="4c359-326">Returns hello natural log of hello double.</span></span> |
| <span data-ttu-id="4c359-327">LN(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-327">ln(doubleVecList)</span></span> |<span data-ttu-id="4c359-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-328">doubleVec</span></span> |<span data-ttu-id="4c359-329">Returnerar hello component-wise loggen bas 2 av hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-329">Returns hello component-wise log base 2 of hello doubleVecList.</span></span> <span data-ttu-id="4c359-330">En vec(double) måste uttryckligen skickades för hello-parametern.</span><span class="sxs-lookup"><span data-stu-id="4c359-330">A vec(double) must be explicitly passed for hello parameter.</span></span> <span data-ttu-id="4c359-331">Annars antas hello dubbla lg(double) version.</span><span class="sxs-lookup"><span data-stu-id="4c359-331">Otherwise, hello double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="4c359-332">log(Double)</span><span class="sxs-lookup"><span data-stu-id="4c359-332">log(double)</span></span> |<span data-ttu-id="4c359-333">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-333">double</span></span> |<span data-ttu-id="4c359-334">Returnerar hello loggen bas 10 av hello dubbla.</span><span class="sxs-lookup"><span data-stu-id="4c359-334">Returns hello log base 10 of hello double.</span></span> |
| <span data-ttu-id="4c359-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-335">log(doubleVecList)</span></span> |<span data-ttu-id="4c359-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="4c359-336">doubleVec</span></span> |<span data-ttu-id="4c359-337">Returnerar hello component-wise loggen bas 10 av hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-337">Returns hello component-wise log base 10 of hello doubleVecList.</span></span> <span data-ttu-id="4c359-338">En vec(double) måste uttryckligen skickades för hello enda dubbla parameter.</span><span class="sxs-lookup"><span data-stu-id="4c359-338">A vec(double) must be explicitly passed for hello single double parameter.</span></span> <span data-ttu-id="4c359-339">Annars antas hello dubbla log(double) version.</span><span class="sxs-lookup"><span data-stu-id="4c359-339">Otherwise, hello double log(double) version is assumed.</span></span> |
| <span data-ttu-id="4c359-340">Max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-340">max(doubleVecList)</span></span> |<span data-ttu-id="4c359-341">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-341">double</span></span> |<span data-ttu-id="4c359-342">Returnerar hello maxvärdet i hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-342">Returns hello maximum value in hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-343">min(doubleVecList)</span></span> |<span data-ttu-id="4c359-344">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-344">double</span></span> |<span data-ttu-id="4c359-345">Returnerar hello minimivärdet i hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-345">Returns hello minimum value in hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-346">norm(doubleVecList)</span></span> |<span data-ttu-id="4c359-347">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-347">double</span></span> |<span data-ttu-id="4c359-348">Returnerar hello två normen av hello-vektorn som skapas från hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-348">Returns hello two-norm of hello vector that is created from hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-349">percentil (doubleVec v dubbla p)</span><span class="sxs-lookup"><span data-stu-id="4c359-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="4c359-350">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-350">double</span></span> |<span data-ttu-id="4c359-351">Returnerar hello percentil element av hello vector v.</span><span class="sxs-lookup"><span data-stu-id="4c359-351">Returns hello percentile element of hello vector v.</span></span> |
| <span data-ttu-id="4c359-352">SLUMP()</span><span class="sxs-lookup"><span data-stu-id="4c359-352">rand()</span></span> |<span data-ttu-id="4c359-353">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-353">double</span></span> |<span data-ttu-id="4c359-354">Returnerar ett slumpmässigt värde mellan 0,0 och 1,0.</span><span class="sxs-lookup"><span data-stu-id="4c359-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="4c359-355">Range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-355">range(doubleVecList)</span></span> |<span data-ttu-id="4c359-356">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-356">double</span></span> |<span data-ttu-id="4c359-357">Returnerar hello skillnaden mellan hello lägsta och högsta värden i hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-357">Returns hello difference between hello min and max values in hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-358">Std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-358">std(doubleVecList)</span></span> |<span data-ttu-id="4c359-359">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-359">double</span></span> |<span data-ttu-id="4c359-360">Returnerar hello exempel standardavvikelsen för hello värden i hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-360">Returns hello sample standard deviation of hello values in hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-361">Stop)</span><span class="sxs-lookup"><span data-stu-id="4c359-361">stop()</span></span> | |<span data-ttu-id="4c359-362">Stoppar utvärderingen av uttrycket för hello autoskalning.</span><span class="sxs-lookup"><span data-stu-id="4c359-362">Stops evaluation of hello autoscaling expression.</span></span> |
| <span data-ttu-id="4c359-363">SUM(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="4c359-363">sum(doubleVecList)</span></span> |<span data-ttu-id="4c359-364">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-364">double</span></span> |<span data-ttu-id="4c359-365">Returnerar hello summan av alla hello komponenter i hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="4c359-365">Returns hello sum of all hello components of hello doubleVecList.</span></span> |
| <span data-ttu-id="4c359-366">tid (string dateTime = ””)</span><span class="sxs-lookup"><span data-stu-id="4c359-366">time(string dateTime="")</span></span> |<span data-ttu-id="4c359-367">tidsstämpel</span><span class="sxs-lookup"><span data-stu-id="4c359-367">timestamp</span></span> |<span data-ttu-id="4c359-368">Returnerar hello tidsstämpeln för hello aktuell tid om inga parametrar skickas eller hello tidsstämpeln för hello dateTime-sträng om den skickas.</span><span class="sxs-lookup"><span data-stu-id="4c359-368">Returns hello time stamp of hello current time if no parameters are passed, or hello time stamp of hello dateTime string if it is passed.</span></span> <span data-ttu-id="4c359-369">Stöds dateTime-format är W3C DTF och RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="4c359-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="4c359-370">val (doubleVec v dubbla i)</span><span class="sxs-lookup"><span data-stu-id="4c359-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="4c359-371">dubbla</span><span class="sxs-lookup"><span data-stu-id="4c359-371">double</span></span> |<span data-ttu-id="4c359-372">Returnerar värdet hello hello-element som är på plats i i vector v, med startIndex noll.</span><span class="sxs-lookup"><span data-stu-id="4c359-372">Returns hello value of hello element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="4c359-373">Vissa av hello-funktioner som beskrivs i föregående tabell för hello kan acceptera en lista som ett argument.</span><span class="sxs-lookup"><span data-stu-id="4c359-373">Some of hello functions that are described in hello previous table can accept a list as an argument.</span></span> <span data-ttu-id="4c359-374">hello kommaavgränsad lista är en kombination av *dubbla* och *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="4c359-374">hello comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="4c359-375">Exempel:</span><span class="sxs-lookup"><span data-stu-id="4c359-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="4c359-376">Hej *doubleVecList* värdet är konverterade tooa enda *doubleVec* för utvärdering.</span><span class="sxs-lookup"><span data-stu-id="4c359-376">hello *doubleVecList* value is converted tooa single *doubleVec* before evaluation.</span></span> <span data-ttu-id="4c359-377">Till exempel om `v = [1,2,3]`, sedan anropa `avg(v)` är likvärdiga toocalling `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="4c359-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent toocalling `avg(1,2,3)`.</span></span> <span data-ttu-id="4c359-378">Anropar `avg(v, 7)` är likvärdiga toocalling `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="4c359-378">Calling `avg(v, 7)` is equivalent toocalling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="4c359-379"><a name="getsampledata"></a>Hämta exempeldata</span><span class="sxs-lookup"><span data-stu-id="4c359-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="4c359-380">Autoskala formler fungerar på mätvärdesdata (exempel) som tillhandahålls av hello Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4c359-380">Autoscale formulas act on metrics data (samples) that is provided by hello Batch service.</span></span> <span data-ttu-id="4c359-381">En formel förstoras eller förminskas poolstorlek utifrån hello värden som hämtas från hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4c359-381">A formula grows or shrinks pool size based on hello values that it obtains from hello service.</span></span> <span data-ttu-id="4c359-382">hello tjänst definierade variabler som beskrivs är tidigare objekt som ger olika metoder tooaccess data som är associerade med objektet.</span><span class="sxs-lookup"><span data-stu-id="4c359-382">hello service-defined variables that were described previously are objects that provide various methods tooaccess data that is associated with that object.</span></span> <span data-ttu-id="4c359-383">Hello visar följande uttryck exempelvis en begäran tooget hello senaste fem minuterna av CPU-användning:</span><span class="sxs-lookup"><span data-stu-id="4c359-383">For example, hello following expression shows a request tooget hello last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="4c359-384">Metod</span><span class="sxs-lookup"><span data-stu-id="4c359-384">Method</span></span> | <span data-ttu-id="4c359-385">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="4c359-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4c359-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="4c359-386">GetSample()</span></span> |<span data-ttu-id="4c359-387">Hej `GetSample()` metoden returnerar en vector av insamlade data.</span><span class="sxs-lookup"><span data-stu-id="4c359-387">hello `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="4c359-388">Ett exempel är 30 sekunder värt mått data.</span><span class="sxs-lookup"><span data-stu-id="4c359-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="4c359-389">Med andra ord hämtas exempel var 30: e sekund.</span><span class="sxs-lookup"><span data-stu-id="4c359-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="4c359-390">Men som anges nedan, det finns en fördröjning mellan när ett exempel som samlas in och när den är tillgänglig tooa formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-390">But as noted below, there is a delay between when a sample is collected and when it is available tooa formula.</span></span> <span data-ttu-id="4c359-391">Därför kanske inte alla prover för en viss tidsperiod för utvärdering av en formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="4c359-392">Anger hello antal prover tooobtain hello senaste prover som samlades in.</span><span class="sxs-lookup"><span data-stu-id="4c359-392">Specifies hello number of samples tooobtain from hello most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="4c359-393">`GetSample(1)`Returnerar hello senaste tillgängliga exempel.</span><span class="sxs-lookup"><span data-stu-id="4c359-393">`GetSample(1)` returns hello last available sample.</span></span> <span data-ttu-id="4c359-394">För mått som `$CPUPercent`, men detta bör inte användas eftersom det är omöjligt tooknow *när* hello exempel samlades in.</span><span class="sxs-lookup"><span data-stu-id="4c359-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible tooknow *when* hello sample was collected.</span></span> <span data-ttu-id="4c359-395">Det kan vara senaste eller på grund av problem med systemet, kan det vara mycket äldre.</span><span class="sxs-lookup"><span data-stu-id="4c359-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="4c359-396">Det är bättre i sådana fall toouse ett tidsintervall som visas nedan.</span><span class="sxs-lookup"><span data-stu-id="4c359-396">It is better in such cases toouse a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="4c359-397">Anger en tid för att samla in exempeldata.</span><span class="sxs-lookup"><span data-stu-id="4c359-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="4c359-398">Du kan också anger den också hello procentandelen exempel som måste vara tillgängliga i hello begärt tidsintervall.</span><span class="sxs-lookup"><span data-stu-id="4c359-398">Optionally, it also specifies hello percentage of samples that must be available in hello requested time frame.</span></span><br/><br/><span data-ttu-id="4c359-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)`Returnerar 20 prov om alla prover för hello senaste 10 minuterna finns i hello CPUPercent historik.</span><span class="sxs-lookup"><span data-stu-id="4c359-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for hello last 10 minutes are present in hello CPUPercent history.</span></span> <span data-ttu-id="4c359-400">Om hello senaste minuten tidigare inte var tillgänglig, men skulle endast 18 exempel returneras.</span><span class="sxs-lookup"><span data-stu-id="4c359-400">If hello last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="4c359-401">I det här fallet:</span><span class="sxs-lookup"><span data-stu-id="4c359-401">In this case:</span></span><br/><br/><span data-ttu-id="4c359-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)`misslyckas eftersom endast 90 procent av hello prover är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="4c359-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of hello samples are available.</span></span><br/><br/><span data-ttu-id="4c359-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)`fungerar.</span><span class="sxs-lookup"><span data-stu-id="4c359-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="4c359-404">Anger en tid för att samla in data med både en starttid och en sluttid.</span><span class="sxs-lookup"><span data-stu-id="4c359-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="4c359-405">Som nämnts ovan är det en fördröjning mellan när ett exempel som samlas in och när den är tillgänglig tooa formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-405">As mentioned above, there is a delay between when a sample is collected and when it is available tooa formula.</span></span> <span data-ttu-id="4c359-406">Tänk fördröjningen när du använder hello `GetSample` metod.</span><span class="sxs-lookup"><span data-stu-id="4c359-406">Consider this delay when you use hello `GetSample` method.</span></span> <span data-ttu-id="4c359-407">Se `GetSamplePercent` nedan.</span><span class="sxs-lookup"><span data-stu-id="4c359-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="4c359-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="4c359-408">GetSamplePeriod()</span></span> |<span data-ttu-id="4c359-409">Returnerar hello antal prover som har tagits i historiska data exempeldata.</span><span class="sxs-lookup"><span data-stu-id="4c359-409">Returns hello period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="4c359-410">Count()</span><span class="sxs-lookup"><span data-stu-id="4c359-410">Count()</span></span> |<span data-ttu-id="4c359-411">Returnerar hello Totalt antal prover i hello mått historik.</span><span class="sxs-lookup"><span data-stu-id="4c359-411">Returns hello total number of samples in hello metric history.</span></span> |
| <span data-ttu-id="4c359-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="4c359-412">HistoryBeginTime()</span></span> |<span data-ttu-id="4c359-413">Returnerar hello tidsstämpeln för hello äldsta tillgängliga datasampel för hello mått.</span><span class="sxs-lookup"><span data-stu-id="4c359-413">Returns hello time stamp of hello oldest available data sample for hello metric.</span></span> |
| <span data-ttu-id="4c359-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="4c359-414">GetSamplePercent()</span></span> |<span data-ttu-id="4c359-415">Returnerar hello procentandelen prover som är tillgängliga för ett visst tidsintervall.</span><span class="sxs-lookup"><span data-stu-id="4c359-415">Returns hello percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="4c359-416">Exempel:</span><span class="sxs-lookup"><span data-stu-id="4c359-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="4c359-417">Eftersom hello `GetSample` metoden misslyckas om hello procentandelen prover som returnerades är mindre än hello `samplePercent` har angetts, kan du använda hello `GetSamplePercent` metoden toocheck första.</span><span class="sxs-lookup"><span data-stu-id="4c359-417">Because hello `GetSample` method fails if hello percentage of samples returned is less than hello `samplePercent` specified, you can use hello `GetSamplePercent` method toocheck first.</span></span> <span data-ttu-id="4c359-418">Du kan sedan utföra åtgärden alternativ om det finns inte tillräckligt prover, utan att avbryta hello automatisk skalning utvärdering.</span><span class="sxs-lookup"><span data-stu-id="4c359-418">Then you can perform an alternate action if insufficient samples are present, without halting hello automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-hello-getsample-method"></a><span data-ttu-id="4c359-419">Exempel, exempel procent och hello *GetSample()* metod</span><span class="sxs-lookup"><span data-stu-id="4c359-419">Samples, sample percentage, and hello *GetSample()* method</span></span>
<span data-ttu-id="4c359-420">hello grundläggande drift ett Autoskala formeln är tooobtain aktivitets- och mätvärden och justera poolstorlek baserat på dessa data.</span><span class="sxs-lookup"><span data-stu-id="4c359-420">hello core operation of an autoscale formula is tooobtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="4c359-421">Det är därför viktigt toohave förstår hur Autoskala formler interagera med mätvärdesdata (exempel).</span><span class="sxs-lookup"><span data-stu-id="4c359-421">As such, it is important toohave a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="4c359-422">**Exempel**</span><span class="sxs-lookup"><span data-stu-id="4c359-422">**Samples**</span></span>

<span data-ttu-id="4c359-423">hello Batch-tjänsten med jämna mellanrum tar prover av aktivitets- och mått och gör dem tillgängliga tooyour Autoskala formler.</span><span class="sxs-lookup"><span data-stu-id="4c359-423">hello Batch service periodically takes samples of task and resource metrics and makes them available tooyour autoscale formulas.</span></span> <span data-ttu-id="4c359-424">Exemplen är registrerade med 30 sekunders mellanrum av hello Batch-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4c359-424">These samples are recorded every 30 seconds by hello Batch service.</span></span> <span data-ttu-id="4c359-425">Det finns dock vanligtvis en fördröjning mellan när de exempel som har registrerats och när de blir tillgängliga för (och kan läsas av) Autoskala formler.</span><span class="sxs-lookup"><span data-stu-id="4c359-425">However, there is typically a delay between when those samples were recorded and when they are made available too(and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="4c359-426">På grund av toovarious faktorer, till exempel nätverks- eller andra problem med infrastruktur, kan dessutom prover inte registreras för ett visst intervall.</span><span class="sxs-lookup"><span data-stu-id="4c359-426">Additionally, due toovarious factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="4c359-427">**Exempel procent**</span><span class="sxs-lookup"><span data-stu-id="4c359-427">**Sample percentage**</span></span>

<span data-ttu-id="4c359-428">När `samplePercent` skickas toohello `GetSample()` metod eller hello `GetSamplePercent()` metoden anropas _procent_ refererar tooa jämförelse mellan hello totala antalet möjliga exempel som är registrerade av hello Batch-tjänsten och hello antal prover som är tillgängliga tooyour Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-428">When `samplePercent` is passed toohello `GetSample()` method or hello `GetSamplePercent()` method is called, _percent_ refers tooa comparison between hello total possible number of samples that are recorded by hello Batch service and hello number of samples that are available tooyour autoscale formula.</span></span>

<span data-ttu-id="4c359-429">Nu ska vi titta på timespan 10 minuters som exempel.</span><span class="sxs-lookup"><span data-stu-id="4c359-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="4c359-430">Eftersom prover har registrerats med 30 sekunders mellanrum inom timespan 10 minuters, är hello maximalt antal prover som registreras av Batch 20 prov (2 per minut).</span><span class="sxs-lookup"><span data-stu-id="4c359-430">Because samples are recorded every 30 seconds within a 10-minute timespan, hello maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="4c359-431">På grund av toohello inbyggd svarstiden för hello reporting mekanism och andra problem i Azure, kan det dock endast 15 prover som är tillgängliga tooyour Autoskala formeln för läsning.</span><span class="sxs-lookup"><span data-stu-id="4c359-431">However, due toohello inherent latency of hello reporting mechanism and other issues within Azure, there may be only 15 samples that are available tooyour autoscale formula for reading.</span></span> <span data-ttu-id="4c359-432">Så, exempelvis för den 10-minutersperioden endast 75% av hello totala antalet prov som registreras kanske tillgängliga tooyour formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-432">So, for example, for that 10-minute period, only 75% of hello total number of samples recorded may be available tooyour formula.</span></span>

<span data-ttu-id="4c359-433">**Intervall för GetSample() och exempel**</span><span class="sxs-lookup"><span data-stu-id="4c359-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="4c359-434">Autoskala formlerna är pågående toobe växande och minska storleken på din pooler &mdash; att lägga till noder eller ta bort noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-434">Your autoscale formulas are going toobe growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="4c359-435">Eftersom noder kostar pengar, vill du tooensure med formler ett intelligent sätt att analys som baseras på uppgifter.</span><span class="sxs-lookup"><span data-stu-id="4c359-435">Because nodes cost you money, you want tooensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="4c359-436">Därför rekommenderar vi att du använder en trender typen analys i formler.</span><span class="sxs-lookup"><span data-stu-id="4c359-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="4c359-437">Den här typen växer och krymper din poolerna baserat på ett intervall av insamlade prover.</span><span class="sxs-lookup"><span data-stu-id="4c359-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="4c359-438">toodo så Använd `GetSample(interval look-back start, interval look-back end)` tooreturn en vector prover:</span><span class="sxs-lookup"><span data-stu-id="4c359-438">toodo so, use `GetSample(interval look-back start, interval look-back end)` tooreturn a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="4c359-439">När hello över linjen utvärderas av Batch returnerar en uppsättning exempel som en vektor med värden.</span><span class="sxs-lookup"><span data-stu-id="4c359-439">When hello above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="4c359-440">Exempel:</span><span class="sxs-lookup"><span data-stu-id="4c359-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="4c359-441">När du har lagrat hello vector prover, kan du använda funktioner som `min()`, `max()`, och `avg()` tooderive meningsfulla värden från hello samlas in intervallet.</span><span class="sxs-lookup"><span data-stu-id="4c359-441">Once you've collected hello vector of samples, you can then use functions like `min()`, `max()`, and `avg()` tooderive meaningful values from hello collected range.</span></span>

<span data-ttu-id="4c359-442">För ytterligare säkerhet kan du tvinga en formel utvärdering toofail om mindre än en viss procentandel av exemplet är tillgänglig för en viss tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="4c359-442">For additional security, you can force a formula evaluation toofail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="4c359-443">Om du framtvingar en formel utvärdering toofail instruera du Batch toocease ytterligare utvärdering av hello formeln om hello angivna procentandelen av prover inte är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="4c359-443">When you force a formula evaluation toofail, you instruct Batch toocease further evaluation of hello formula if hello specified percentage of samples is not available.</span></span> <span data-ttu-id="4c359-444">Ingen ändring görs i det här fallet toohello poolstorlek.</span><span class="sxs-lookup"><span data-stu-id="4c359-444">In this case, no change is made toohello pool size.</span></span> <span data-ttu-id="4c359-445">toospecify krävs procent av prover för hello utvärdering toosucceed, ange den som hello tredje parametern för`GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="4c359-445">toospecify a required percentage of samples for hello evaluation toosucceed, specify it as hello third parameter too`GetSample()`.</span></span> <span data-ttu-id="4c359-446">Här är har ett krav för 75 procent av prover angetts:</span><span class="sxs-lookup"><span data-stu-id="4c359-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="4c359-447">Eftersom det kan finnas en fördröjning i exempel tillgänglighet, är det viktigt tooalways ange ett tidsintervall med föregående titt starttid som är äldre än en minut.</span><span class="sxs-lookup"><span data-stu-id="4c359-447">Because there may be a delay in sample availability, it is important tooalways specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="4c359-448">Det tar ungefär en minut för prover toopropagate via hello system så exempel i hello intervallet `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` kanske inte tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="4c359-448">It takes approximately one minute for samples toopropagate through hello system, so samples in hello range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="4c359-449">Igen och du kan använda hello procentandel parametern för `GetSample()` tooforce ett visst exempel procentandel krav.</span><span class="sxs-lookup"><span data-stu-id="4c359-449">Again, you can use hello percentage parameter of `GetSample()` tooforce a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4c359-450">Vi **rekommenderar** som du **förlita dig inte *endast* på `GetSample(1)` i Autoskala formlerna**.</span><span class="sxs-lookup"><span data-stu-id="4c359-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="4c359-451">Detta beror på att `GetSample(1)` i stort sett står toohello Batch-tjänsten ”ge mig hello sista exemplet som du har, oavsett hur länge sedan den hämtades”.</span><span class="sxs-lookup"><span data-stu-id="4c359-451">This is because `GetSample(1)` essentially says toohello Batch service, "Give me hello last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="4c359-452">Eftersom det är bara ett exempel på en enda, och det kan vara ett äldre prov, kanske inte representativ för hello större bild av aktivitet eller resource tillstånd.</span><span class="sxs-lookup"><span data-stu-id="4c359-452">Since it is only a single sample, and it may be an older sample, it may not be representative of hello larger picture of recent task or resource state.</span></span> <span data-ttu-id="4c359-453">Om du använder `GetSample(1)`och kontrollera att den är del av en större instruktion inte hello endast datapunkt som är beroende av din formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not hello only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="4c359-454">Mått</span><span class="sxs-lookup"><span data-stu-id="4c359-454">Metrics</span></span>
<span data-ttu-id="4c359-455">Du kan använda både resurs- och mått när du definierar en formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="4c359-456">Du kan justera hello mål antalet dedicerade noder i hello poolen baserat på hello mått data som du vill hämta och utvärdera.</span><span class="sxs-lookup"><span data-stu-id="4c359-456">You adjust hello target number of dedicated nodes in hello pool based on hello metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="4c359-457">Se hello [variabler](#variables) avsnittet ovan för mer information om varje mått.</span><span class="sxs-lookup"><span data-stu-id="4c359-457">See hello [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="4c359-458">Mått</span><span class="sxs-lookup"><span data-stu-id="4c359-458">Metric</span></span></th>
    <th><span data-ttu-id="4c359-459">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="4c359-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="4c359-460"><b>Resurs</b></span><span class="sxs-lookup"><span data-stu-id="4c359-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="4c359-461">Resursen mått baseras på hello CPU, hello bandbredd, hello minnesanvändningen för datornoder och hello antalet noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-461">Resource metrics are based on hello CPU, hello bandwidth, hello memory usage of compute nodes, and hello number of nodes.</span></span></p>
        <p> <span data-ttu-id="4c359-462">Dessa definieras av tjänsten variabler är användbara för att göra justeringar baserat på antalet noder:</span><span class="sxs-lookup"><span data-stu-id="4c359-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="4c359-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="4c359-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="4c359-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="4c359-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="4c359-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="4c359-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="4c359-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="4c359-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="4c359-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="4c359-469">Dessa definieras av tjänsten variabler är användbara för att göra justeringar baserat på noden Resursanvändning:</span><span class="sxs-lookup"><span data-stu-id="4c359-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="4c359-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="4c359-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="4c359-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="4c359-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="4c359-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="4c359-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="4c359-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="4c359-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="4c359-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="4c359-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="4c359-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="4c359-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="4c359-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="4c359-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="4c359-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="4c359-480"><b>Aktivitet</b></span><span class="sxs-lookup"><span data-stu-id="4c359-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="4c359-481">Uppgiften mått baserat på hello status för aktiviteter, till exempel aktiv, väntar, och slutförs.</span><span class="sxs-lookup"><span data-stu-id="4c359-481">Task metrics are based on hello status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="4c359-482">hello följande tjänst definierade variabler är användbara för att göra poolstorleken justeringar baserat på uppgiften mått:</span><span class="sxs-lookup"><span data-stu-id="4c359-482">hello following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="4c359-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="4c359-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="4c359-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="4c359-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="4c359-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="4c359-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="4c359-488">Skriv en Autoskala formel</span><span class="sxs-lookup"><span data-stu-id="4c359-488">Write an autoscale formula</span></span>
<span data-ttu-id="4c359-489">Du skapa en formel Autoskala genom instruktioner som använder hello ovan komponenter och sedan kombinera dessa instruktioner till en fullständig formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-489">You build an autoscale formula by forming statements that use hello above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="4c359-490">I det här avsnittet skapar vi ett exempel Autoskala formeln som kan utföra vissa verkliga skalning beslut.</span><span class="sxs-lookup"><span data-stu-id="4c359-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="4c359-491">Först ska vi definiera hello krav för vår nya Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-491">First, let's define hello requirements for our new autoscale formula.</span></span> <span data-ttu-id="4c359-492">hello formeln bör:</span><span class="sxs-lookup"><span data-stu-id="4c359-492">hello formula should:</span></span>

1. <span data-ttu-id="4c359-493">Öka hello mål antalet dedicerade beräkningsnoder i poolen om CPU-användningen är hög.</span><span class="sxs-lookup"><span data-stu-id="4c359-493">Increase hello target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="4c359-494">Minska hello mål antal dedikerade beräkningsnoder i en pool när CPU-användningen är låg.</span><span class="sxs-lookup"><span data-stu-id="4c359-494">Decrease hello target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="4c359-495">Begränsa alltid hello maximalt antal noder dedikerade too400.</span><span class="sxs-lookup"><span data-stu-id="4c359-495">Always restrict hello maximum number of dedicated nodes too400.</span></span>

<span data-ttu-id="4c359-496">tooincrease hello antalet noder under hög CPU-användning, definiera hello-uttryck som fyller på en användardefinierad variabel (`$totalDedicatedNodes`) med ett värde som är 110 procent av hello aktuella mål antal dedikerade noder, men endast om hello minsta Genomsnittlig CPU-användning under hello var senaste 10 minuterna ovan 70 procent.</span><span class="sxs-lookup"><span data-stu-id="4c359-496">tooincrease hello number of nodes during high CPU usage, define hello statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of hello current target number of dedicated nodes, but only if hello minimum average CPU usage during hello last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="4c359-497">Annars Använd hello värdet för hello aktuellt antal dedikerade noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-497">Otherwise, use hello value for hello current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="4c359-498">för*minska* Hej antalet dedicerade noder under låg CPU-användning, hello nästa instruktionen i vår formeln anger hello samma `$totalDedicatedNodes` variabeln too90 procent av hello aktuellt mål antal dedikerade noder om hello Genomsnittlig CPU-användning Hej var senaste 60 minuter under 20 procent.</span><span class="sxs-lookup"><span data-stu-id="4c359-498">too*decrease* hello number of dedicated nodes during low CPU usage, hello next statement in our formula sets hello same `$totalDedicatedNodes` variable too90 percent of hello current target number of dedicated nodes if hello average CPU usage in hello past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="4c359-499">Annars använder hello aktuellt värde för `$totalDedicatedNodes` som vi har fyllts i hello instruktionen ovan.</span><span class="sxs-lookup"><span data-stu-id="4c359-499">Otherwise, use hello current value of `$totalDedicatedNodes` that we populated in hello statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="4c359-500">Nu begränsa hello mål antal dedikerade compute-noder tooa högst 400:</span><span class="sxs-lookup"><span data-stu-id="4c359-500">Now limit hello target number of dedicated compute nodes tooa maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="4c359-501">Här är hello hela formeln:</span><span class="sxs-lookup"><span data-stu-id="4c359-501">Here's hello complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="4c359-502">Skapa en pool med Autoskala-aktiverade med .NET</span><span class="sxs-lookup"><span data-stu-id="4c359-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="4c359-503">toocreate en pool med autoskalning aktiverat i .NET, Följ dessa steg:</span><span class="sxs-lookup"><span data-stu-id="4c359-503">toocreate a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="4c359-504">Skapa hello-pool med [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="4c359-504">Create hello pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="4c359-505">Ange hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) egenskapen för`true`.</span><span class="sxs-lookup"><span data-stu-id="4c359-505">Set hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property too`true`.</span></span>
3. <span data-ttu-id="4c359-506">Ange hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) egenskap med Autoskala-formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-506">Set hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="4c359-507">(Valfritt) Ange hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) egenskapen (standardvärdet är 15 minuter).</span><span class="sxs-lookup"><span data-stu-id="4c359-507">(Optional) Set hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="4c359-508">Genomför hello-pool med [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) eller [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="4c359-508">Commit hello pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="4c359-509">hello skapar nedanstående kodutdrag en pool med Autoskala-aktiverade i .NET.</span><span class="sxs-lookup"><span data-stu-id="4c359-509">hello following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="4c359-510">hello anger poolens Autoskala formeln hello mål antal dedikerade noder too5 på måndagen och 1 för varje dag i veckan hello.</span><span class="sxs-lookup"><span data-stu-id="4c359-510">hello pool's autoscale formula sets hello target number of dedicated nodes too5 on Mondays, and 1 on every other day of hello week.</span></span> <span data-ttu-id="4c359-511">Hej [intervall för automatisk skalning](#automatic-scaling-interval) är ange too30 minuter.</span><span class="sxs-lookup"><span data-stu-id="4c359-511">hello [automatic scaling interval](#automatic-scaling-interval) is set too30 minutes.</span></span> <span data-ttu-id="4c359-512">I det här och andra C#-kodavsnitt i den här artikeln hello `myBatchClient` är en korrekt initierad instans av hello [BatchClient] [ net_batchclient] klass.</span><span class="sxs-lookup"><span data-stu-id="4c359-512">In this and hello other C# snippets in this article, `myBatchClient` is a properly initialized instance of hello [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="4c359-513">När du skapar en Autoskala-aktiverade pool kan inte ange hello _targetDedicatedComputeNodes_ parameter eller hello _targetLowPriorityComputeNodes_ parameter på hello anropa för **CreatePool**.</span><span class="sxs-lookup"><span data-stu-id="4c359-513">When you create an autoscale-enabled pool, do not specify hello _targetDedicatedComputeNodes_ parameter or hello _targetLowPriorityComputeNodes_ parameter on hello call too**CreatePool**.</span></span> <span data-ttu-id="4c359-514">Ange i stället hello **AutoScaleEnabled** och **AutoScaleFormula** egenskaper i hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-514">Instead, specify hello **AutoScaleEnabled** and **AutoScaleFormula** properties on hello pool.</span></span> <span data-ttu-id="4c359-515">hello värden för dessa egenskaper avgör hello målnumret för varje typ av noden.</span><span class="sxs-lookup"><span data-stu-id="4c359-515">hello values for these properties determine hello target number of each type of node.</span></span> <span data-ttu-id="4c359-516">Dessutom toomanually ändra storlek på en Autoskala-aktiverade pool (med exempelvis [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), första **inaktivera** automatisk skalning på Hej poolen och sedan ändrar den.</span><span class="sxs-lookup"><span data-stu-id="4c359-516">Also, toomanually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on hello pool, then resize it.</span></span>
>
>

<span data-ttu-id="4c359-517">Dessutom tooBatch .NET, du kan använda någon av hello andra [Batch SDK](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell-cmdlets](batch-powershell-cmdlets-get-started.md), och hello [Batch CLI](batch-cli-get-started.md)tooconfigure autoskalning.</span><span class="sxs-lookup"><span data-stu-id="4c359-517">In addition tooBatch .NET, you can use any of hello other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and hello [Batch CLI](batch-cli-get-started.md) tooconfigure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="4c359-518">Intervall för automatisk skalning</span><span class="sxs-lookup"><span data-stu-id="4c359-518">Automatic scaling interval</span></span>
<span data-ttu-id="4c359-519">Som standard justeras hello Batch-tjänsten en poolstorlek enligt tooits Autoskala formeln var 15: e minut.</span><span class="sxs-lookup"><span data-stu-id="4c359-519">By default, hello Batch service adjusts a pool's size according tooits autoscale formula every 15 minutes.</span></span> <span data-ttu-id="4c359-520">Intervallet kan konfigureras med hjälp av hello följande egenskaper för programpoolen:</span><span class="sxs-lookup"><span data-stu-id="4c359-520">This interval is configurable by using hello following pool properties:</span></span>

* <span data-ttu-id="4c359-521">[CloudPool.AutoScaleEvaluationInterval] [ net_cloudpool_autoscaleevalinterval] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="4c359-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="4c359-522">[autoScaleEvaluationInterval] [ rest_autoscaleinterval] (REST-API)</span><span class="sxs-lookup"><span data-stu-id="4c359-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="4c359-523">hello minsta intervall är fem minuter och högsta hello är 168 timmar.</span><span class="sxs-lookup"><span data-stu-id="4c359-523">hello minimum interval is five minutes, and hello maximum is 168 hours.</span></span> <span data-ttu-id="4c359-524">Om ett intervall som är utanför intervallet har angetts returnerar hello Batch-tjänsten en felaktig begäran (400) fel.</span><span class="sxs-lookup"><span data-stu-id="4c359-524">If an interval outside this range is specified, hello Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="4c359-525">Autoskalning är inte avsedd för närvarande toorespond toochanges på mindre än en minut, men är snarare avsedd tooadjust hello storleken på din pool gradvis när du kör en arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="4c359-525">Autoscaling is not currently intended toorespond toochanges in less than a minute, but rather is intended tooadjust hello size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="4c359-526">Aktivera autoskalning på en befintlig adresspool</span><span class="sxs-lookup"><span data-stu-id="4c359-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="4c359-527">Varje Batch-SDK tillhandahåller en sätt tooenable autoskalning.</span><span class="sxs-lookup"><span data-stu-id="4c359-527">Each Batch SDK provides a way tooenable autoscaling.</span></span> <span data-ttu-id="4c359-528">Exempel:</span><span class="sxs-lookup"><span data-stu-id="4c359-528">For example:</span></span>

* <span data-ttu-id="4c359-529">[BatchClient.PoolOperations.EnableAutoScaleAsync] [ net_enableautoscaleasync] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="4c359-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="4c359-530">[Aktivera automatisk skalning på poolen] [ rest_enableautoscale] (REST-API)</span><span class="sxs-lookup"><span data-stu-id="4c359-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="4c359-531">När du aktiverar autoskalning på en befintlig adresspool Kom ihåg hello följande punkter:</span><span class="sxs-lookup"><span data-stu-id="4c359-531">When you enable autoscaling on an existing pool, keep in mind hello following points:</span></span>

* <span data-ttu-id="4c359-532">Om automatisk skalning är inaktiverat på hello pool när du skickar hello begäran tooenable autoskalning, måste du ange en giltig Autoskala formel när du skickar hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="4c359-532">If automatic scaling is currently disabled on hello pool when you issue hello request tooenable autoscaling, you must specify a valid autoscale formula when you issue hello request.</span></span> <span data-ttu-id="4c359-533">Du kan också ange ett intervall för utvärdering av Autoskala.</span><span class="sxs-lookup"><span data-stu-id="4c359-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="4c359-534">Om du inte anger ett intervall används hello standardvärdet 15 minuter.</span><span class="sxs-lookup"><span data-stu-id="4c359-534">If you do not specify an interval, hello default value of 15 minutes is used.</span></span>
* <span data-ttu-id="4c359-535">Om Autoskala är aktiverat i hello pool, kan du ange en Autoskala formel, ett intervall för utvärdering eller båda.</span><span class="sxs-lookup"><span data-stu-id="4c359-535">If autoscale is currently enabled on hello pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="4c359-536">Du måste ange minst en av dessa egenskaper.</span><span class="sxs-lookup"><span data-stu-id="4c359-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="4c359-537">Om du anger ett nytt Autoskala utvärdering intervall hello befintliga utvärderingsschema stoppas och startas ett nytt schema.</span><span class="sxs-lookup"><span data-stu-id="4c359-537">If you specify a new autoscale evaluation interval, then hello existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="4c359-538">Starttid för hello nytt schema är hello tid vid vilken hello begäran tooenable autoskalning har utfärdats.</span><span class="sxs-lookup"><span data-stu-id="4c359-538">hello new schedule's start time is hello time at which hello request tooenable autoscaling was issued.</span></span>
  * <span data-ttu-id="4c359-539">Om du utelämnar antingen hello Autoskala formeln eller utvärdering intervall fortsätter hello Batch-tjänsten toouse hello aktuellt värde för den här inställningen.</span><span class="sxs-lookup"><span data-stu-id="4c359-539">If you omit either hello autoscale formula or evaluation interval, hello Batch service continues toouse hello current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="4c359-540">Om du har angett värden för hello *targetDedicatedComputeNodes* eller *targetLowPriorityComputeNodes* parametrarna för hello **CreatePool** metoden när du skapade hello pool i .NET eller för hello jämförbara parametrar i ett annat språk och sedan dessa värden ignoreras när hello autoskalning formeln utvärderas.</span><span class="sxs-lookup"><span data-stu-id="4c359-540">If you specified values for hello *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of hello **CreatePool** method when you created hello pool in .NET, or for hello comparable parameters in another language, then those values are ignored when hello automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="4c359-541">Den här C#-kodstycke använder hello [Batch .NET] [ net_api] biblioteket tooenable autoskalning på en befintlig adresspool:</span><span class="sxs-lookup"><span data-stu-id="4c359-541">This C# code snippet uses hello [Batch .NET][net_api] library tooenable autoscaling on an existing pool:</span></span>

```csharp
// Define hello autoscaling formula. This formula sets hello target number of nodes
// too5 on Mondays, and 1 on every other day of hello week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set hello autoscale formula on hello existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="4c359-542">Uppdatera en Autoskala formel</span><span class="sxs-lookup"><span data-stu-id="4c359-542">Update an autoscale formula</span></span>

<span data-ttu-id="4c359-543">tooupdate hello formeln på en befintlig Autoskala-aktiverade adresspool, anrop hello åtgärden tooenable autoskalning igen med hello ny formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-543">tooupdate hello formula on an existing autoscale-enabled pool, call hello operation tooenable autoscaling again with hello new formula.</span></span> <span data-ttu-id="4c359-544">Om exempelvis autoskalning är redan aktiverat på `myexistingpool` när hello efter .NET-kod körs dess Autoskala formel ersätts med hello innehållet i `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="4c359-544">For example, if autoscaling is already enabled on `myexistingpool` when hello following .NET code is executed, its autoscale formula is replaced with hello contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-hello-autoscale-interval"></a><span data-ttu-id="4c359-545">Hello Autoskala uppdateringsintervall</span><span class="sxs-lookup"><span data-stu-id="4c359-545">Update hello autoscale interval</span></span>

<span data-ttu-id="4c359-546">tooupdate hello Autoskala intervallet utvärdering av en befintlig Autoskala-aktiverade pool, anrop hello åtgärden tooenable autoskalning igen med hello nytt intervall.</span><span class="sxs-lookup"><span data-stu-id="4c359-546">tooupdate hello autoscale evaluation interval of an existing autoscale-enabled pool, call hello operation tooenable autoscaling again with hello new interval.</span></span> <span data-ttu-id="4c359-547">Till exempel tooset hello Autoskala utvärdering too60 minuter för en pool som redan är aktiverat Autoskala i .NET:</span><span class="sxs-lookup"><span data-stu-id="4c359-547">For example, tooset hello autoscale evaluation interval too60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="4c359-548">Utvärdera en Autoskala formel</span><span class="sxs-lookup"><span data-stu-id="4c359-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="4c359-549">Du kan utvärdera en formel innan den tillämpas tooa pool.</span><span class="sxs-lookup"><span data-stu-id="4c359-549">You can evaluate a formula before applying it tooa pool.</span></span> <span data-ttu-id="4c359-550">På så sätt kan testa du hello formeln toosee hur dess rapporter utvärdera innan du publicerar hello formeln till produktionen.</span><span class="sxs-lookup"><span data-stu-id="4c359-550">In this way, you can test hello formula toosee how its statements evaluate before you put hello formula into production.</span></span>

<span data-ttu-id="4c359-551">tooevaluate en Autoskala formel, måste du först aktivera autoskalning på hello-pool med en giltig formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-551">tooevaluate an autoscale formula, you must first enable autoscaling on hello pool with a valid formula.</span></span> <span data-ttu-id="4c359-552">tootest en formel i en pool som ännu inte har autoskalning aktiverad, Använd hello enradiga formel `$TargetDedicatedNodes = 0` när du först aktivera autoskalning.</span><span class="sxs-lookup"><span data-stu-id="4c359-552">tootest a formula on a pool that doesn't yet have autoscaling enabled, use hello one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="4c359-553">Använd sedan någon av följande tooevaluate hello formel som du vill använda tootest hello:</span><span class="sxs-lookup"><span data-stu-id="4c359-553">Then, use one of hello following tooevaluate hello formula you want tootest:</span></span>

* <span data-ttu-id="4c359-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) eller [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span><span class="sxs-lookup"><span data-stu-id="4c359-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="4c359-555">Metoderna Batch .NET kräver hello-ID för en befintlig adresspool och en sträng som innehåller hello Autoskala formeln tooevaluate.</span><span class="sxs-lookup"><span data-stu-id="4c359-555">These Batch .NET methods require hello ID of an existing pool and a string containing hello autoscale formula tooevaluate.</span></span>

* [<span data-ttu-id="4c359-556">Utvärdera en automatisk skalning formel</span><span class="sxs-lookup"><span data-stu-id="4c359-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="4c359-557">Ange hello programpools-ID i hello URI i denna REST API-begäran och hello Autoskala formeln i hello *autoScaleFormula* element av hello frågans brödtext.</span><span class="sxs-lookup"><span data-stu-id="4c359-557">In this REST API request, specify hello pool ID in hello URI, and hello autoscale formula in hello *autoScaleFormula* element of hello request body.</span></span> <span data-ttu-id="4c359-558">hello svaret hello åtgärdens innehåller någon information om fel som kan vara relaterade toohello formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-558">hello response of hello operation contains any error information that might be related toohello formula.</span></span>

<span data-ttu-id="4c359-559">I det här [Batch .NET] [ net_api] kodfragmentet vi utvärderar en Autoskala formel.</span><span class="sxs-lookup"><span data-stu-id="4c359-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="4c359-560">Om hello poolen inte har aktiverat autoskalning det att aktivera den först.</span><span class="sxs-lookup"><span data-stu-id="4c359-560">If hello pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference tooan existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on hello pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula tooenable autoscaling on the
    // pool. This formula is valid, but won't resize hello pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls tooonce every 30 seconds.
    // Because we want tooapply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here tooensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh hello properties of hello pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on hello pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // hello formula tooevaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform hello autoscale formula evaluation. Note that this code does not
    // actually apply hello formula toohello pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print hello results of hello AutoScaleRun.
        // This will display hello values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply hello formula toohello pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output hello message associated with hello error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="4c359-561">Lyckad utvärdering av hello formeln i det här kodstycket ger resultat som liknar:</span><span class="sxs-lookup"><span data-stu-id="4c359-561">Successful evaluation of hello formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="4c359-562">Hämta information om Autoskala körs</span><span class="sxs-lookup"><span data-stu-id="4c359-562">Get information about autoscale runs</span></span>

<span data-ttu-id="4c359-563">tooensure formeln fungerar som förväntat, rekommenderar vi att du regelbundet kontrollerar hello resultaten av hello autoskalning körs som Batch utför på din pool.</span><span class="sxs-lookup"><span data-stu-id="4c359-563">tooensure that your formula is performing as expected, we recommend that you periodically check hello results of hello autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="4c359-564">toodo så få (eller uppdatera) en referens toohello poolen och granska den senaste Autoskala kör hello egenskaper.</span><span class="sxs-lookup"><span data-stu-id="4c359-564">toodo so, get (or refresh) a reference toohello pool, and examine hello properties of its last autoscale run.</span></span>

<span data-ttu-id="4c359-565">I Batch .NET hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) -egenskap har flera egenskaper som innehåller information om hello senaste autoskalning kör utförs på hello pool:</span><span class="sxs-lookup"><span data-stu-id="4c359-565">In Batch .NET, hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about hello latest automatic scaling run performed on hello pool:</span></span>

* [<span data-ttu-id="4c359-566">AutoScaleRun.Timestamp</span><span class="sxs-lookup"><span data-stu-id="4c359-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="4c359-567">AutoScaleRun.Results</span><span class="sxs-lookup"><span data-stu-id="4c359-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="4c359-568">AutoScaleRun.Error</span><span class="sxs-lookup"><span data-stu-id="4c359-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="4c359-569">I hello REST-API, hello [få information om poolen](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) begäran returnerar information om hello poolen, vilket innefattar hello senaste autoskalning körs information i hello [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) egenskapen.</span><span class="sxs-lookup"><span data-stu-id="4c359-569">In hello REST API, hello [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about hello pool, which includes hello latest automatic scaling run information in hello [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="4c359-570">hello följande kodfragment för C# används hello Batch .NET-biblioteket tooprint information om hello senaste autoskalning körs på poolen _myPool_:</span><span class="sxs-lookup"><span data-stu-id="4c359-570">hello following C# code snippet uses hello Batch .NET library tooprint information about hello last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="4c359-571">Utdata från föregående kodfragment hello:</span><span class="sxs-lookup"><span data-stu-id="4c359-571">Sample output of hello preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="4c359-572">Autoskala formler</span><span class="sxs-lookup"><span data-stu-id="4c359-572">Example autoscale formulas</span></span>
<span data-ttu-id="4c359-573">Nu ska vi titta på några formler som visar olika sätt tooadjust hello mängden beräkningsresurser i poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-573">Let's look at a few formulas that show different ways tooadjust hello amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="4c359-574">Exempel 1: Tidsbaserade justering</span><span class="sxs-lookup"><span data-stu-id="4c359-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="4c359-575">Anta att du vill tooadjust hello poolstorlek baserat på hello hello veckodag och tid på dagen.</span><span class="sxs-lookup"><span data-stu-id="4c359-575">Suppose you want tooadjust hello pool size based on hello day of hello week and time of day.</span></span> <span data-ttu-id="4c359-576">Det här exemplet visar hur tooincrease eller minska hello antalet noder i hello poolen därefter.</span><span class="sxs-lookup"><span data-stu-id="4c359-576">This example shows how tooincrease or decrease hello number of nodes in hello pool accordingly.</span></span>

<span data-ttu-id="4c359-577">hello formeln hämtar först hello aktuell tid.</span><span class="sxs-lookup"><span data-stu-id="4c359-577">hello formula first obtains hello current time.</span></span> <span data-ttu-id="4c359-578">Om det är en vardag (1-5) och inom arbetstid (too6 8: 00 PM), hello poolen Målstorlek anges too20 noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-578">If it's a weekday (1-5) and within working hours (8 AM too6 PM), hello target pool size is set too20 nodes.</span></span> <span data-ttu-id="4c359-579">I annat fall har den värdet too10 noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-579">Otherwise, it's set too10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="4c359-580">Exempel 2: Uppgiftsbaserade justering</span><span class="sxs-lookup"><span data-stu-id="4c359-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="4c359-581">I det här exemplet justeras hello poolstorlek utifrån hello antalet aktiviteter i hello kö.</span><span class="sxs-lookup"><span data-stu-id="4c359-581">In this example, hello pool size is adjusted based on hello number of tasks in hello queue.</span></span> <span data-ttu-id="4c359-582">Både kommentarer och radbrytningar accepteras i formeln strängar.</span><span class="sxs-lookup"><span data-stu-id="4c359-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for hello past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use hello last sample point,
// otherwise we use hello maximum of last sample point and hello history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM toopending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// hello pool size is capped at 20, if target VM value is more than that, set it
// too20. This value should be adjusted according tooyour use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="4c359-583">Exempel 3: Redovisning för parallella aktiviteter</span><span class="sxs-lookup"><span data-stu-id="4c359-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="4c359-584">Det här exemplet justerar hello poolstorlek baserat på hello antal uppgifter.</span><span class="sxs-lookup"><span data-stu-id="4c359-584">This example adjusts hello pool size based on hello number of tasks.</span></span> <span data-ttu-id="4c359-585">Den här formeln beaktas även konto hello [MaxTasksPerComputeNode] [ net_maxtasks] värdet som har angetts för hello poolen.</span><span class="sxs-lookup"><span data-stu-id="4c359-585">This formula also takes into account hello [MaxTasksPerComputeNode][net_maxtasks] value that has been set for hello pool.</span></span> <span data-ttu-id="4c359-586">Den här metoden är användbar i situationer där [parallell körning av aktiviteten](batch-parallel-node-tasks.md) har aktiverats på din pool.</span><span class="sxs-lookup"><span data-stu-id="4c359-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of hello samples have been recorded in hello past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set hello number of nodes tooadd tooone-fourth hello number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set too4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt toogrow hello number of compute nodes toomatch hello number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep hello nodes active until hello tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="4c359-587">Exempel 4: Ange ett inledande poolstorlek</span><span class="sxs-lookup"><span data-stu-id="4c359-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="4c359-588">Det här exemplet visar en C# code fragment med en Autoskala formeln som anger hello poolen storlek tooa ange antalet noder för en inledande tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="4c359-588">This example shows a C# code snippet with an autoscale formula that sets hello pool size tooa specified number of nodes for an initial time period.</span></span> <span data-ttu-id="4c359-589">Sedan justeras den hello poolstorlek utifrån hello antalet körs och aktiva uppgifter efter hello inledande tidsperiod har gått ut.</span><span class="sxs-lookup"><span data-stu-id="4c359-589">Then it adjusts hello pool size based on hello number of running and active tasks after hello initial time period has elapsed.</span></span>

<span data-ttu-id="4c359-590">hello formeln i hello följande kodutdrag:</span><span class="sxs-lookup"><span data-stu-id="4c359-590">hello formula in hello following code snippet:</span></span>

* <span data-ttu-id="4c359-591">Anger hello inledande adresspool storlek toofour noder.</span><span class="sxs-lookup"><span data-stu-id="4c359-591">Sets hello initial pool size toofour nodes.</span></span>
* <span data-ttu-id="4c359-592">Justeras inte hello poolstorlek inom hello 10 minuter i hello poolen livscykeln.</span><span class="sxs-lookup"><span data-stu-id="4c359-592">Does not adjust hello pool size within hello first 10 minutes of hello pool's lifecycle.</span></span>
* <span data-ttu-id="4c359-593">Efter 10 minuter hämtar hello maxvärdet för hello antal körs och aktiva aktiviteter inom hello senaste 60 minuter.</span><span class="sxs-lookup"><span data-stu-id="4c359-593">After 10 minutes, obtains hello max value of hello number of running and active tasks within hello past 60 minutes.</span></span>
  * <span data-ttu-id="4c359-594">Om båda värdena är 0 (som anger att inga aktiviteter körs eller är aktiv i hello senaste 60 minuter), anges hello poolstorlek too0.</span><span class="sxs-lookup"><span data-stu-id="4c359-594">If both values are 0 (indicating that no tasks were running or active in hello last 60 minutes), hello pool size is set too0.</span></span>
  * <span data-ttu-id="4c359-595">Ingen ändring görs om antingen värdet är större än noll.</span><span class="sxs-lookup"><span data-stu-id="4c359-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="4c359-596">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="4c359-596">Next steps</span></span>
* <span data-ttu-id="4c359-597">[Maximera Azure Batch beräkning Resursanvändning med samtidiga nod uppgifter](batch-parallel-node-tasks.md) innehåller information om hur du kan köra flera aktiviteter samtidigt i hello beräkningsnoder i din pool.</span><span class="sxs-lookup"><span data-stu-id="4c359-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on hello compute nodes in your pool.</span></span> <span data-ttu-id="4c359-598">Dessutom tooautoscaling, den här funktionen kan hjälpa toolower jobbet varaktighet för vissa arbetsbelastningar, spara pengar.</span><span class="sxs-lookup"><span data-stu-id="4c359-598">In addition tooautoscaling, this feature may help toolower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="4c359-599">Se till att dina frågor för Batch-programmet hello Batch-tjänsten i hello de flesta optimalt sätt för en annan effektivitet booster.</span><span class="sxs-lookup"><span data-stu-id="4c359-599">For another efficiency booster, ensure that your Batch application queries hello Batch service in hello most optimal way.</span></span> <span data-ttu-id="4c359-600">Se [fråga hello Azure Batch-tjänsten effektivt](batch-efficient-list-queries.md) toolearn hur toolimit hello mängden data som passerar hello överföring när du frågar hello status för tusentals compute-noder eller uppgifter.</span><span class="sxs-lookup"><span data-stu-id="4c359-600">See [Query hello Azure Batch service efficiently](batch-efficient-list-queries.md) toolearn how toolimit hello amount of data that crosses hello wire when you query hello status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
