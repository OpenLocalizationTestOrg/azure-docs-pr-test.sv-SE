---
title: "aaaPersist projekt- och utdata tooAzure lagring med hello Azure Batch-tjänsten API | Microsoft Docs"
description: "Lär dig hur toouse API för Batch-tjänsten toopersist batchaktiviteten och jobbet utdata tooAzure lagring."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 71b3f7c0dda2d2a9d8eb3eef83229873c70ca22c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="persist-task-data-tooazure-storage-with-hello-batch-service-api"></a><span data-ttu-id="d10f9-103">Spara aktiviteten data tooAzure lagring med hello API för Batch-tjänsten</span><span class="sxs-lookup"><span data-stu-id="d10f9-103">Persist task data tooAzure Storage with hello Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="d10f9-104">Från och med version 2017-05-01, stöder hello API för Batch-tjänsten bestående utgående data tooAzure lagring för aktiviteter och jobb manager aktiviteter som körs på pooler med hello konfiguration av virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="d10f9-104">Starting with version 2017-05-01, hello Batch service API supports persisting output data tooAzure Storage for tasks and job manager tasks that run on pools with hello virtual machine configuration.</span></span> <span data-ttu-id="d10f9-105">När du lägger till en aktivitet kan du ange en behållare i Azure Storage som hello mål för hello uppgiftens utdata.</span><span class="sxs-lookup"><span data-stu-id="d10f9-105">When you add a task, you can specify a container in Azure Storage as hello destination for hello task's output.</span></span> <span data-ttu-id="d10f9-106">Hej Batch-tjänsten och sedan skriver en utgående data toothat behållare när hello åtgärden är klar.</span><span class="sxs-lookup"><span data-stu-id="d10f9-106">hello Batch service then writes any output data toothat container when hello task is complete.</span></span>

<span data-ttu-id="d10f9-107">En fördel toousing hello Batch service API toopersist uppgiftsutdata är att du inte behöver toomodify hello program som hello aktivitet körs.</span><span class="sxs-lookup"><span data-stu-id="d10f9-107">An advantage toousing hello Batch service API toopersist task output is that you do not need toomodify hello application that hello task is running.</span></span> <span data-ttu-id="d10f9-108">Med några enkla ändringar tooyour-klientprogram, kan du i stället kvarstår hello uppgiftens utdata från inom hello-kod som skapar hello aktiviteten.</span><span class="sxs-lookup"><span data-stu-id="d10f9-108">Instead, with a few simple modifications tooyour client application, you can persist hello task's output from within hello code that creates hello task.</span></span>   

## <a name="when-do-i-use-hello-batch-service-api-toopersist-task-output"></a><span data-ttu-id="d10f9-109">När använder hello API för Batch-tjänsten toopersist uppgiftens utdata?</span><span class="sxs-lookup"><span data-stu-id="d10f9-109">When do I use hello Batch service API toopersist task output?</span></span>

<span data-ttu-id="d10f9-110">Azure Batch tillhandahåller mer än ett sätt toopersist uppgiftens utdata.</span><span class="sxs-lookup"><span data-stu-id="d10f9-110">Azure Batch provides more than one way toopersist task output.</span></span> <span data-ttu-id="d10f9-111">Med hjälp av hello API för Batch-tjänsten är en praktisk metod som är bäst lämpade toothese scenarier:</span><span class="sxs-lookup"><span data-stu-id="d10f9-111">Using hello Batch service API is a convenient approach that's best suited toothese scenarios:</span></span>

- <span data-ttu-id="d10f9-112">Du vill toowrite kod toopersist uppgiftens utdata från i ditt klientprogram utan att ändra hello-program som uppgiften körs.</span><span class="sxs-lookup"><span data-stu-id="d10f9-112">You want toowrite code toopersist task output from within your client application, without modifying hello application that your task is running.</span></span>
- <span data-ttu-id="d10f9-113">Vill du toopersist utdata från Batch-aktiviteter och jobb manager aktiviteter i pooler som har skapats med hello konfiguration av virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="d10f9-113">You want toopersist output from Batch tasks and job manager tasks in pools created with hello virtual machine configuration.</span></span>
- <span data-ttu-id="d10f9-114">Vill du toopersist utdata tooan Azure Storage-behållare med ett godtyckligt namn.</span><span class="sxs-lookup"><span data-stu-id="d10f9-114">You want toopersist output tooan Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="d10f9-115">Du vill toopersist utdata tooan Azure Storage-behållare med namnet bl.a toohello [Batch filen konventioner standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="d10f9-115">You want toopersist output tooan Azure Storage container named according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="d10f9-116">Om ditt scenario skiljer sig från de som visas ovan, kanske du måste tooconsider en annan metod.</span><span class="sxs-lookup"><span data-stu-id="d10f9-116">If your scenario differs from those listed above, you may need tooconsider a different approach.</span></span> <span data-ttu-id="d10f9-117">Till exempel stöder hello API för Batch-tjänsten för närvarande inte strömmande utdata tooAzure lagring medan hello aktiviteten körs.</span><span class="sxs-lookup"><span data-stu-id="d10f9-117">For example, hello Batch service API does not currently support streaming output tooAzure Storage while hello task is running.</span></span> <span data-ttu-id="d10f9-118">toostream utdata, Överväg att använda hello Batch filen konventioner bibliotek, tillgängliga för .NET.</span><span class="sxs-lookup"><span data-stu-id="d10f9-118">toostream output, consider using hello Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="d10f9-119">För andra språk behöver du tooimplement din egen lösning.</span><span class="sxs-lookup"><span data-stu-id="d10f9-119">For other languages, you'll need tooimplement your own solution.</span></span> <span data-ttu-id="d10f9-120">Mer information om andra alternativ för bestående uppgiftsutdata finns [spara projekt- och utdata tooAzure lagring](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="d10f9-120">For more information on other options for persisting task output, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="d10f9-121">Skapa en behållare i Azure Storage</span><span class="sxs-lookup"><span data-stu-id="d10f9-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="d10f9-122">toopersist aktivitet utdata tooAzure lagring måste du toocreate en behållare som fungerar som hello mål för utgående filer.</span><span class="sxs-lookup"><span data-stu-id="d10f9-122">toopersist task output tooAzure Storage, you'll need toocreate a container that serves as hello destination for your output files.</span></span> <span data-ttu-id="d10f9-123">Skapa hello behållare innan du kör uppgiften, helst innan du skickar ditt jobb.</span><span class="sxs-lookup"><span data-stu-id="d10f9-123">Create hello container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="d10f9-124">toocreate hello behållare, Använd hello lämplig Azure Storage-klientbibliotek eller SDK.</span><span class="sxs-lookup"><span data-stu-id="d10f9-124">toocreate hello container, use hello appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="d10f9-125">Mer information om Azure Storage-API: er finns i hello [Azure Storage-dokumentationen](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="d10f9-125">For more information about Azure Storage APIs, see hello [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="d10f9-126">Till exempel om du skapar ditt program i C#, använda hello [Azure Storage-klientbibliotek för .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="d10f9-126">For example, if you are writing your application in C#, use hello [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="d10f9-127">följande exempel visar hur hello toocreate en behållare:</span><span class="sxs-lookup"><span data-stu-id="d10f9-127">hello following example shows how toocreate a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-hello-container"></a><span data-ttu-id="d10f9-128">Hämta en signatur för delad åtkomst för hello behållare</span><span class="sxs-lookup"><span data-stu-id="d10f9-128">Get a shared access signature for hello container</span></span>

<span data-ttu-id="d10f9-129">När du har skapat hello behållaren får du en signatur för delad åtkomst (SAS) med skrivbehörighet toohello behållare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-129">After you create hello container, get a shared access signature (SAS) with write access toohello container.</span></span> <span data-ttu-id="d10f9-130">En SAS ger delegerad åtkomst toohello behållare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-130">A SAS provides delegated access toohello container.</span></span> <span data-ttu-id="d10f9-131">hello SAS beviljar åtkomst med en angiven uppsättning behörigheter och under ett angivet tidsintervall.</span><span class="sxs-lookup"><span data-stu-id="d10f9-131">hello SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="d10f9-132">hello Batch-tjänsten måste en SAS med skriva behörigheter toowrite aktivitet utdata toohello behållare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-132">hello Batch service needs a SAS with write permissions toowrite task output toohello container.</span></span> <span data-ttu-id="d10f9-133">Mer information om SAS finns [använder signaturer för delad åtkomst \(SAS\) i Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="d10f9-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="d10f9-134">När du får en SAS med hello Azure Storage-API: er returnerar hello API en SAS-token-sträng.</span><span class="sxs-lookup"><span data-stu-id="d10f9-134">When you get a SAS using hello Azure Storage APIs, hello API returns a SAS token string.</span></span> <span data-ttu-id="d10f9-135">Den här token strängen innehåller alla parametrar för hello SAS, inklusive hello behörigheter och hello intervall över vilka hello SAS är giltig.</span><span class="sxs-lookup"><span data-stu-id="d10f9-135">This token string includes all parameters of hello SAS, including hello permissions and hello interval over which hello SAS is valid.</span></span> <span data-ttu-id="d10f9-136">toouse hello SAS tooaccess en behållare i Azure Storage, behöver du tooappend hello SAS-token sträng toohello resurs-URI.</span><span class="sxs-lookup"><span data-stu-id="d10f9-136">toouse hello SAS tooaccess a container in Azure Storage, you need tooappend hello SAS token string toohello resource URI.</span></span> <span data-ttu-id="d10f9-137">hello resurs-URI, tillsammans med hello läggs SAS-token, ger autentiserad åtkomst tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="d10f9-137">hello resource URI, together with hello appended SAS token, provides authenticated access tooAzure Storage.</span></span>

<span data-ttu-id="d10f9-138">hello följande exempel visar hur tooget en lässkyddad SAS token sträng för hello-behållaren och sedan lägger till hello SAS toohello behållare URI:</span><span class="sxs-lookup"><span data-stu-id="d10f9-138">hello following example shows how tooget a write-only SAS token string for hello container, then appends hello SAS toohello container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="d10f9-139">Ange utdatafilerna för uppgiftsutdata</span><span class="sxs-lookup"><span data-stu-id="d10f9-139">Specify output files for task output</span></span>

<span data-ttu-id="d10f9-140">toospecify utdatafilerna för en aktivitet, skapa en samling [utdatafil](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objekt och tilldela den toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) egenskapen när du skapar hello-aktivitet.</span><span class="sxs-lookup"><span data-stu-id="d10f9-140">toospecify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create hello task.</span></span> 

<span data-ttu-id="d10f9-141">hello följande kodexempel för .NET skapar en uppgift som skriver slumptal tooa fil med namnet `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="d10f9-141">hello following .NET code example creates a task that writes random numbers tooa file named `output.txt`.</span></span> <span data-ttu-id="d10f9-142">hello exempel skapas en utdatafil för `output.txt` toobe skrivs toohello behållare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-142">hello example creates an output file for `output.txt` toobe written toohello container.</span></span> <span data-ttu-id="d10f9-143">hello exemplet skapar också utdatafilerna för alla loggfiler som matchar mönstret för hello filen `std*.txt` (_t.ex._, `stdout.txt` och `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="d10f9-143">hello example also creates output files for any log files that match hello file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="d10f9-144">hello behållarens Webbadress kräver hello SAS som skapades tidigare för hello behållare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-144">hello container URL requires hello SAS that was created previously for hello container.</span></span> <span data-ttu-id="d10f9-145">hello Batch-tjänsten använder hello SAS tooauthenticate åtkomst toohello behållare:</span><span class="sxs-lookup"><span data-stu-id="d10f9-145">hello Batch service uses hello SAS tooauthenticate access toohello container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="d10f9-146">Ange ett mönster för matchning för filen</span><span class="sxs-lookup"><span data-stu-id="d10f9-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="d10f9-147">När du anger en utdatafil, kan du använda hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) egenskapen toospecify filen mönster för matchning.</span><span class="sxs-lookup"><span data-stu-id="d10f9-147">When you specify an output file, you can use hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property toospecify a file pattern for matching.</span></span> <span data-ttu-id="d10f9-148">Hej filmönstret kan matcha noll filer, en fil eller en uppsättning filer som skapas av hello-aktivitet.</span><span class="sxs-lookup"><span data-stu-id="d10f9-148">hello file pattern may match zero files, a single file, or a set of files that are created by hello task.</span></span>

<span data-ttu-id="d10f9-149">Hej **FilePattern** egenskapen stöder standard filesystem jokertecken som `*` (för icke-rekursiva matchar) och `**` (för rekursiv matchar).</span><span class="sxs-lookup"><span data-stu-id="d10f9-149">hello **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="d10f9-150">Till exempel hello kodexemplet ovan anger hello filen mönster toomatch `std*.txt` icke-rekursivt:</span><span class="sxs-lookup"><span data-stu-id="d10f9-150">For example, hello code sample above specifies hello file pattern toomatch `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="d10f9-151">tooupload en enskild fil, ange ett fil-mönster med jokertecken.</span><span class="sxs-lookup"><span data-stu-id="d10f9-151">tooupload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="d10f9-152">Till exempel hello kodexemplet ovan anger hello filen mönster toomatch `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="d10f9-152">For example, hello code sample above specifies hello file pattern toomatch `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="d10f9-153">Ange ett villkor för överföring</span><span class="sxs-lookup"><span data-stu-id="d10f9-153">Specify an upload condition</span></span>

<span data-ttu-id="d10f9-154">Hej [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) egenskapen tillåter villkorlig överföra utdatafilerna.</span><span class="sxs-lookup"><span data-stu-id="d10f9-154">hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="d10f9-155">Ett vanligt scenario är tooupload en uppsättning filer om hello aktiviteten lyckas och en annan uppsättning filer om den misslyckas.</span><span class="sxs-lookup"><span data-stu-id="d10f9-155">A common scenario is tooupload one set of files if hello task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="d10f9-156">Exempelvis kanske tooupload utförlig loggfiler när hello uppgiften misslyckas och avslutas med slutkoden inte är noll.</span><span class="sxs-lookup"><span data-stu-id="d10f9-156">For example, you may want tooupload verbose log files only when hello task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="d10f9-157">På liknande sätt kan kanske du vill tooupload resultatet filer endast om hello aktiviteten lyckas, eftersom dessa filer kanske saknas eller är ofullständig om hello misslyckas.</span><span class="sxs-lookup"><span data-stu-id="d10f9-157">Similarly, you may want tooupload result files only if hello task succeeds, as those files may be missing or incomplete if hello task fails.</span></span>

<span data-ttu-id="d10f9-158">hello kodexemplen ovan anger hello **UploadCondition** egenskapen för**TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="d10f9-158">hello code sample above sets hello **UploadCondition** property too**TaskCompletion**.</span></span> <span data-ttu-id="d10f9-159">Den här inställningen anger att hello-filen är toobe överförs när hello aktiviteter har slutförts, oavsett hello värdet för hello slutkod.</span><span class="sxs-lookup"><span data-stu-id="d10f9-159">This setting specifies that hello file is toobe uploaded after hello tasks completes, regardless of hello value of hello exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="d10f9-160">Andra inställningar finns i hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span><span class="sxs-lookup"><span data-stu-id="d10f9-160">For other settings, see hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-hello-same-name"></a><span data-ttu-id="d10f9-161">Undvika tvetydigheten filer med hello samma namn</span><span class="sxs-lookup"><span data-stu-id="d10f9-161">Disambiguate files with hello same name</span></span>

<span data-ttu-id="d10f9-162">hello aktiviteter i ett projekt kan skapa filer som har hello samma namn.</span><span class="sxs-lookup"><span data-stu-id="d10f9-162">hello tasks in a job may produce files that have hello same name.</span></span> <span data-ttu-id="d10f9-163">Till exempel `stdout.txt` och `stderr.txt` skapas för varje aktivitet som körs i ett jobb.</span><span class="sxs-lookup"><span data-stu-id="d10f9-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="d10f9-164">Eftersom varje aktivitet körs i sin egen kontext, filerna inte är i konflikt i hello nodens filsystemet.</span><span class="sxs-lookup"><span data-stu-id="d10f9-164">Because each task runs in its own context, these files don't conflict on hello node's file system.</span></span> <span data-ttu-id="d10f9-165">Men när du överför filer från flera aktiviteter tooa delade behållaren måste toodisambiguate filer med hello samma namn.</span><span class="sxs-lookup"><span data-stu-id="d10f9-165">However, when you upload files from multiple tasks tooa shared container, you'll need toodisambiguate files with hello same name.</span></span>

<span data-ttu-id="d10f9-166">Hej [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) egenskapen anger hello mål blob eller virtuell katalog för utdatafilerna.</span><span class="sxs-lookup"><span data-stu-id="d10f9-166">hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies hello destination blob or virtual directory for output files.</span></span> <span data-ttu-id="d10f9-167">Du kan använda hello **sökväg** egenskapen tooname hello blob eller virtuella katalogen så att utdata filer med samma namn är unikt namngivna i Azure Storage hello.</span><span class="sxs-lookup"><span data-stu-id="d10f9-167">You can use hello **Path** property tooname hello blob or virtual directory in such a way that output files with hello same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="d10f9-168">Med hjälp av hello aktivitets-ID i hello sökväg är ett bra sätt tooensure unika namn och att identifiera lätt filer.</span><span class="sxs-lookup"><span data-stu-id="d10f9-168">Using hello task ID in hello path is a good way tooensure unique names and easily identify files.</span></span>

<span data-ttu-id="d10f9-169">Om hello **FilePattern** egenskapen tooa jokerteckenuttryck så kan alla filer som matchar mönstret hello överförda toohello virtuella katalog som anges av hello **sökväg** egenskapen.</span><span class="sxs-lookup"><span data-stu-id="d10f9-169">If hello **FilePattern** property is set tooa wildcard expression, then all files that match hello pattern are uploaded toohello virtual directory specified by hello **Path** property.</span></span> <span data-ttu-id="d10f9-170">Om hello behållare är exempelvis `mycontainer`, hello uppgiften ID är `mytask`, och hello filen mönstret är `..\std*.txt`, hello absolut URI: er toohello utdatafilerna i Azure Storage kommer att likna:</span><span class="sxs-lookup"><span data-stu-id="d10f9-170">For example, if hello container is `mycontainer`, hello task ID is `mytask`, and hello file pattern is `..\std*.txt`, then hello absolute URIs toohello output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="d10f9-171">Om hello **FilePattern** egenskapen är uppsättningen toomatch ett enda filnamn, vilket innebär att den inte innehåller jokertecken, sedan hello värdet för hello **sökväg** egenskapen anger hello blob fullständigt kvalificerat namn .</span><span class="sxs-lookup"><span data-stu-id="d10f9-171">If hello **FilePattern** property is set toomatch a single file name, meaning it does not contain any wildcard characters, then hello value of hello **Path** property specifies hello fully qualified blob name.</span></span> <span data-ttu-id="d10f9-172">Om du tror namngivningskonflikter med en enda fil från flera aktiviteter innehålla hello namnet på hello virtuella katalogen som en del av hello filen namnet toodisambiguate dessa filer.</span><span class="sxs-lookup"><span data-stu-id="d10f9-172">If you anticipate naming conflicts with a single file from multiple tasks, then include hello name of hello virtual directory as part of hello file name toodisambiguate those files.</span></span> <span data-ttu-id="d10f9-173">Till exempel ange hello **sökväg** egenskapen tooinclude hello aktivitets-ID, hello avgränsningstecken (vanligtvis ett snedstreck) och hello filnamn:</span><span class="sxs-lookup"><span data-stu-id="d10f9-173">For example, set hello **Path** property tooinclude hello task ID, hello delimiter character (typically a forward slash), and hello file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="d10f9-174">hello absolut URI: er toohello utdatafilerna för en uppsättning uppgifter ska likna följande:</span><span class="sxs-lookup"><span data-stu-id="d10f9-174">hello absolute URIs toohello output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="d10f9-175">Mer information om virtuella kataloger i Azure Storage finns [visa hello blobbar i en behållare](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="d10f9-175">For more information about virtual directories in Azure Storage, see [List hello blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="d10f9-176">Diagnostisera överför filfel</span><span class="sxs-lookup"><span data-stu-id="d10f9-176">Diagnose file upload errors</span></span>

<span data-ttu-id="d10f9-177">Om överföring av utgående filer tooAzure lagring misslyckas hello aktivitet och går sedan toohello **slutförd** tillstånd och hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) -egenskapen anges.</span><span class="sxs-lookup"><span data-stu-id="d10f9-177">If uploading output files tooAzure Storage fails, then hello task moves toohello **Completed** state and hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="d10f9-178">Granska hello **FailureInformation** egenskapen toodetermine vilka fel uppstod.</span><span class="sxs-lookup"><span data-stu-id="d10f9-178">Examine hello **FailureInformation** property toodetermine what error occurred.</span></span> <span data-ttu-id="d10f9-179">Här är till exempel ett fel som uppstår på filöverföringen om hello behållare inte hittas:</span><span class="sxs-lookup"><span data-stu-id="d10f9-179">For example, here is an error that occurs on file upload if hello container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of hello specified Azure container(s) was not found while attempting tooupload an output file
```

<span data-ttu-id="d10f9-180">På varje filöverföringen Batch skriver två logga filer toohello compute-nod, `fileuploadout.txt` och `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="d10f9-180">On every file upload, Batch writes two log files toohello compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="d10f9-181">Du kan undersöka dessa loggen filer toolearn mer om ett specifikt fel.</span><span class="sxs-lookup"><span data-stu-id="d10f9-181">You can examine these log files toolearn more about a specific failure.</span></span> <span data-ttu-id="d10f9-182">I fall där hello hämtningsförsöket aldrig gjordes, till exempel eftersom själva hello aktiviteten inte gick att köra sedan finns loggfilerna inte.</span><span class="sxs-lookup"><span data-stu-id="d10f9-182">In cases where hello file upload was never attempted, for example because hello task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="d10f9-183">Diagnostisera filen överföringsprestanda</span><span class="sxs-lookup"><span data-stu-id="d10f9-183">Diagnose file upload performance</span></span>

<span data-ttu-id="d10f9-184">Hej `fileuploadout.txt` filen loggar överföringen pågår.</span><span class="sxs-lookup"><span data-stu-id="d10f9-184">hello `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="d10f9-185">Du kan undersöka den här filen toolearn mer om hur länge din filöverföringar tar.</span><span class="sxs-lookup"><span data-stu-id="d10f9-185">You can examine this file toolearn more about how long your file uploads are taking.</span></span> <span data-ttu-id="d10f9-186">Tänk på att det finns många bidragande faktorer tooupload prestanda, bland annat hello storlek hello nod, andra aktiviteter på hello nod när hello hello överför om hello Målbehållaren hello samma region som hello Batch-pool, hur många noder är Överför toohello storage-konto på hello samma tidpunkt, och så vidare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-186">Keep in mind that there are many contributing factors tooupload performance, including hello size of hello node, other activity on hello node at hello time of hello upload, whether hello target container is in hello same region as hello Batch pool, how many nodes are uploading toohello storage account at hello same time, and so on.</span></span>

## <a name="use-hello-batch-service-api-with-hello-batch-file-conventions-standard"></a><span data-ttu-id="d10f9-187">Använda hello API för Batch-tjänsten med hello Batch filen konventioner standard</span><span class="sxs-lookup"><span data-stu-id="d10f9-187">Use hello Batch service API with hello Batch File Conventions standard</span></span>

<span data-ttu-id="d10f9-188">När du bevara uppgiftens utdata med hello API för Batch-tjänsten kan namnge din målbehållare och blobbar du själv vill.</span><span class="sxs-lookup"><span data-stu-id="d10f9-188">When you persist task output with hello Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="d10f9-189">Du kan också välja tooname dem enligt toohello [Batch filen konventioner standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="d10f9-189">You can also choose tooname them according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="d10f9-190">hello filen konventioner standard avgör hello namnen på hello målbehållare och blob i Azure Storage för en given utdatafilen baserat på hello namnen på hello projekt- och.</span><span class="sxs-lookup"><span data-stu-id="d10f9-190">hello File Conventions standard determines hello names of hello destination container and blob in Azure Storage for a given output file based on hello names of hello job and task.</span></span> <span data-ttu-id="d10f9-191">Om du använder hello filen konventioner standard för namngivning av filer och utgående filer är tillgängliga för visning i hello [Azure-portalen](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="d10f9-191">If you do use hello File Conventions standard for naming output files, then your output files are available for viewing in hello [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="d10f9-192">Om du utvecklar i C#, kan du använda hello metoder som är inbyggda i hello [filen konventioner för Batch-biblioteket för .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="d10f9-192">If you are developing in C#, you can use hello methods built into hello [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="d10f9-193">Det här biblioteket skapar hello korrekt angiven behållare och blob-sökvägar för dig.</span><span class="sxs-lookup"><span data-stu-id="d10f9-193">This library creates hello properly named containers and blob paths for you.</span></span> <span data-ttu-id="d10f9-194">Du kan till exempel anropa hello API tooget hello rätt namn hello behållare, baserat på hello jobbnamn:</span><span class="sxs-lookup"><span data-stu-id="d10f9-194">For example, you can call hello API tooget hello correct name for hello container, based on hello job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="d10f9-195">Du kan använda hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) metoden tooreturn en URL för delad åtkomst signatur (SAS) som är används toowrite toohello behållare.</span><span class="sxs-lookup"><span data-stu-id="d10f9-195">You can use hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method tooreturn a shared access signature (SAS) URL that is used toowrite toohello container.</span></span> <span data-ttu-id="d10f9-196">Du kan sedan överföra den här SAS-toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) konstruktor.</span><span class="sxs-lookup"><span data-stu-id="d10f9-196">You can then pass this SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="d10f9-197">Om du utvecklar i ett annat språk än C#, behöver du tooimplement hello filen konventioner standard själv.</span><span class="sxs-lookup"><span data-stu-id="d10f9-197">If you are developing in a language other than C#, you will need tooimplement hello File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="d10f9-198">Kodexempel</span><span class="sxs-lookup"><span data-stu-id="d10f9-198">Code sample</span></span>

<span data-ttu-id="d10f9-199">Hej [PersistOutputs] [ github_persistoutputs] exempelprojektet är en av hello [kodexempel för Azure Batch] [ github_samples] på GitHub.</span><span class="sxs-lookup"><span data-stu-id="d10f9-199">hello [PersistOutputs][github_persistoutputs] sample project is one of hello [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="d10f9-200">Den här Visual Studio-lösningen visar hur toouse hello Batch-klientbibliotek för .NET toopersist aktivitet utdata toodurable lagring.</span><span class="sxs-lookup"><span data-stu-id="d10f9-200">This Visual Studio solution demonstrates how toouse hello Batch client library for .NET toopersist task output toodurable storage.</span></span> <span data-ttu-id="d10f9-201">toorun hello exempel, följer du dessa steg:</span><span class="sxs-lookup"><span data-stu-id="d10f9-201">toorun hello sample, follow these steps:</span></span>

1. <span data-ttu-id="d10f9-202">Öppna hello-projekt i **Visual Studio 2015 eller senare**.</span><span class="sxs-lookup"><span data-stu-id="d10f9-202">Open hello project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="d10f9-203">Lägg till grupp och lagring **kontoautentiseringsuppgifter** för**AccountSettings.settings** i hello Microsoft.Azure.Batch.Samples.Common projekt.</span><span class="sxs-lookup"><span data-stu-id="d10f9-203">Add your Batch and Storage **account credentials** too**AccountSettings.settings** in hello Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="d10f9-204">**Skapa** (men inte kör) hello lösning.</span><span class="sxs-lookup"><span data-stu-id="d10f9-204">**Build** (but do not run) hello solution.</span></span> <span data-ttu-id="d10f9-205">Återställa NuGet-paket om du uppmanas till detta.</span><span class="sxs-lookup"><span data-stu-id="d10f9-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="d10f9-206">Använd hello Azure portal tooupload en [programpaket](batch-application-packages.md) för **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="d10f9-206">Use hello Azure portal tooupload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="d10f9-207">Inkludera hello `PersistOutputsTask.exe` och dess beroende sammansättningar i hello ZIP-paketet, ange hello program-ID för ”PersistOutputsTask” och programmet hello Paketversion för ”1.0”.</span><span class="sxs-lookup"><span data-stu-id="d10f9-207">Include hello `PersistOutputsTask.exe` and its dependent assemblies in hello .zip package, set hello application ID too"PersistOutputsTask", and hello application package version too"1.0".</span></span>
5. <span data-ttu-id="d10f9-208">**Starta** (kör) hello **PersistOutputs** projekt.</span><span class="sxs-lookup"><span data-stu-id="d10f9-208">**Start** (run) hello **PersistOutputs** project.</span></span>
6. <span data-ttu-id="d10f9-209">När begärd toochoose hello beständiga teknik toouse körs hello exempel anger **2** toorun hello exempel med hjälp av hello API för Batch-tjänsten toopersist uppgiftens utdata.</span><span class="sxs-lookup"><span data-stu-id="d10f9-209">When prompted toochoose hello persistence technology toouse for running hello sample, enter **2** toorun hello sample using hello Batch service API toopersist task output.</span></span>
7. <span data-ttu-id="d10f9-210">Om du vill köra hello exemplet igen, ange **3** toopersist utdata med API för hello Batch-tjänsten och tooname hello-behållaren och blob målsökväg enligt toohello filen konventioner som standard.</span><span class="sxs-lookup"><span data-stu-id="d10f9-210">If desired, run hello sample again, entering **3** toopersist output with hello Batch service API, and also tooname hello destination container and blob path according toohello File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d10f9-211">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="d10f9-211">Next steps</span></span>

- <span data-ttu-id="d10f9-212">Mer information om bestående uppgiftens utdata med hello filen konventioner bibliotek för .NET finns [spara projekt- och data tooAzure lagring med hello Batch filen konventioner biblioteket för .NET-toopersist ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="d10f9-212">For more information on persisting task output with hello File Conventions library for .NET, see [Persist job and task data tooAzure Storage with hello Batch File Conventions library for .NET toopersist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="d10f9-213">Information om andra metoder för bestående av utdata i Azure Batch finns [spara projekt- och utdata tooAzure lagring](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="d10f9-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples
