---
title: "Tips om nätverksprestanda - Azure Cosmos DB NoSQL | Microsoft Docs"
description: "Läs klienten konfigurationsalternativ för att förbättra Azure Cosmos DB databasprestanda"
keywords: "hur du förbättrar databasens prestanda"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="921f4-104">Prestandatips för Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="921f4-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="921f4-105">Azure Cosmos-DB är en snabb och flexibel distribuerad databas som kan skalas sömlöst med garanterad svarstid och genomströmning.</span><span class="sxs-lookup"><span data-stu-id="921f4-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="921f4-106">Du behöver inte göra ändringar av större arkitektur eller skriva komplex kod för att skala databasen med Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="921f4-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="921f4-107">Skala upp och ner är lika enkelt som att göra en enda API-anrop eller [SDK-anrop](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="921f4-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="921f4-108">Men eftersom Cosmos DB går att nå via nätverket anrop finns på klientsidan optimeringar du uppnår topprestanda.</span><span class="sxs-lookup"><span data-stu-id="921f4-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="921f4-109">Så om du begär ”hur kan jag förbättra Mina databasprestanda”?</span><span class="sxs-lookup"><span data-stu-id="921f4-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="921f4-110">Överväg följande alternativ:</span><span class="sxs-lookup"><span data-stu-id="921f4-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="921f4-111">Nätverk</span><span class="sxs-lookup"><span data-stu-id="921f4-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="921f4-112">**Anslutningsprincip för: Använd direktanslutning läge**</span><span class="sxs-lookup"><span data-stu-id="921f4-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="921f4-113">Hur en klient ansluter till Cosmos DB har stor betydelse för prestanda, särskilt observerade klientens svarstid.</span><span class="sxs-lookup"><span data-stu-id="921f4-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="921f4-114">Det finns två viktiga konfigurationsinställningar för att konfigurera klienten anslutningsprincip – anslutningen *läge* och [anslutning *protokollet*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="921f4-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="921f4-115">De två lägena finns:</span><span class="sxs-lookup"><span data-stu-id="921f4-115">The two available modes are:</span></span>

   1. <span data-ttu-id="921f4-116">Gateway-läge (standard)</span><span class="sxs-lookup"><span data-stu-id="921f4-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="921f4-117">Direkt-läge</span><span class="sxs-lookup"><span data-stu-id="921f4-117">Direct Mode</span></span>

      <span data-ttu-id="921f4-118">Gateway-läge stöds på alla SDK-plattformar och är konfigurerad som standard.</span><span class="sxs-lookup"><span data-stu-id="921f4-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="921f4-119">Om programmet körs i ett företagsnätverk med strikt brandväggsbegränsningar, är Gateway-läge det bästa valet eftersom den använder standardporten för HTTPS och en enda slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="921f4-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="921f4-120">Förhållandet prestanda är dock att Gateway-läge innebär ett hopp ytterligare nätverk varje gång data har lästs eller skrivits till Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="921f4-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="921f4-121">Därmed ger direkt läge bättre prestanda på grund av färre nätverkshopp.</span><span class="sxs-lookup"><span data-stu-id="921f4-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="921f4-122">**Anslutningsprincip: använda TCP-protokollet**</span><span class="sxs-lookup"><span data-stu-id="921f4-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="921f4-123">När du använder direkt läge, finns det två tillgängliga protokollalternativ:</span><span class="sxs-lookup"><span data-stu-id="921f4-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="921f4-124">TCP</span><span class="sxs-lookup"><span data-stu-id="921f4-124">TCP</span></span>
   * <span data-ttu-id="921f4-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="921f4-125">HTTPS</span></span>

     <span data-ttu-id="921f4-126">Cosmos DB erbjuder ett enkelt och öppna RESTful-programmeringsmiljö via HTTPS.</span><span class="sxs-lookup"><span data-stu-id="921f4-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="921f4-127">Dessutom erbjuder en effektiv TCP-protokoll som är också RESTful i dess kommunikation modell och är tillgänglig via .NET klient-SDK.</span><span class="sxs-lookup"><span data-stu-id="921f4-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="921f4-128">Använda SSL för första autentiseringen och kryptering trafik direkt TCP- och HTTPS.</span><span class="sxs-lookup"><span data-stu-id="921f4-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="921f4-129">Använda TCP-protokollet när det är möjligt för bästa prestanda.</span><span class="sxs-lookup"><span data-stu-id="921f4-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="921f4-130">När du använder TCP i Gateway-läge, TCP-Port 443 är Cosmos-DB-port och 10255 är MongoDB API-port.</span><span class="sxs-lookup"><span data-stu-id="921f4-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="921f4-131">När du använder TCP i direkt läge, förutom portarna som Gateway, måste du kontrollera porten intervallet mellan 10000 och 20000 är öppen eftersom Cosmos DB använder dynamiska TCP-portar.</span><span class="sxs-lookup"><span data-stu-id="921f4-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="921f4-132">Om dessa portar inte är öppna och försök att använda TCP, felmeddelandet 503 tjänsten är inte tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="921f4-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="921f4-133">Anslutningsläget konfigureras under konstruktion av DocumentClient-instans med parametern ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="921f4-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="921f4-134">Om direkt läge används, kan du också ange protokollet i parametern ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="921f4-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="921f4-135">Eftersom TCP stöds endast i direkt läge om Gateway-läget används, HTTPS-protokollet används alltid för att kommunicera med gatewayen och protokollet värdet i ConnectionPolicy ignoreras.</span><span class="sxs-lookup"><span data-stu-id="921f4-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Bild av principen för Azure Cosmos DB](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="921f4-137">**Anropa OpenAsync för att undvika Start svarstid på förfrågan**</span><span class="sxs-lookup"><span data-stu-id="921f4-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="921f4-138">Den första begäranden har en högre latens eftersom den har att hämta adressen routningstabellen som standard.</span><span class="sxs-lookup"><span data-stu-id="921f4-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="921f4-139">Om du vill undvika det här Start fördröjning den första begäran bör du anropa OpenAsync() en gång under initieringen på följande sätt.</span><span class="sxs-lookup"><span data-stu-id="921f4-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="921f4-140">**Samordna klienter i samma Azure-region för prestanda**</span><span class="sxs-lookup"><span data-stu-id="921f4-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="921f4-141">När det är möjligt placera alla program som anropar Cosmos-DB i samma region som Cosmos-DB-databas.</span><span class="sxs-lookup"><span data-stu-id="921f4-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="921f4-142">Anrop till Cosmos-DB i samma region som utför inom 1 – 2 ms för en ungefärlig jämförelse, men fördröjning mellan Väst och av USA: S > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="921f4-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="921f4-143">Den här fördröjningen kan förmodligen variera från begäran till begäran beroende på vägen som begäran när det överförs från klienten till den Azure datacenter-gränsen.</span><span class="sxs-lookup"><span data-stu-id="921f4-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="921f4-144">Lägsta möjliga tidsfördröjning uppnås genom att säkerställa att det anropande programmet finns i samma Azure-region som etablerade Cosmos-DB-slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="921f4-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="921f4-145">En lista över tillgängliga regioner, se [Azure-regioner](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="921f4-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="921f4-146">![Bild av principen för Azure Cosmos DB](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="921f4-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="921f4-147">**Öka antalet trådar/uppgifter**</span><span class="sxs-lookup"><span data-stu-id="921f4-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="921f4-148">Eftersom anrop till Azure Cosmos DB görs över nätverket, kan du behöva variera grad av parallellitet med dina begäranden så att klientprogrammet använder mycket lite tid att vänta mellan begäranden.</span><span class="sxs-lookup"><span data-stu-id="921f4-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="921f4-149">Till exempel om du använder. NET'S [parallella Uppgiftsbibliotek](https://msdn.microsoft.com//library/dd460717.aspx), skapa i 100-tal uppgifter läsning eller skrivning till Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="921f4-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="921f4-150">SDK-användning</span><span class="sxs-lookup"><span data-stu-id="921f4-150">SDK Usage</span></span>
1. <span data-ttu-id="921f4-151">**Installera den senaste SDK**</span><span class="sxs-lookup"><span data-stu-id="921f4-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="921f4-152">DB-SDK Cosmos är ständigt bättre för att tillhandahålla bästa prestanda.</span><span class="sxs-lookup"><span data-stu-id="921f4-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="921f4-153">Finns det [Cosmos DB SDK](documentdb-sdk-dotnet.md) sidor för att avgöra den senaste SDK och granska förbättringar.</span><span class="sxs-lookup"><span data-stu-id="921f4-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="921f4-154">**Använd klienten en singleton-Cosmos-DB för livslängden för ditt program**</span><span class="sxs-lookup"><span data-stu-id="921f4-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="921f4-155">Observera att varje DocumentClient-instans är trådsäker och utför effektiv hantering och cachelagring av adresser när direkt läge.</span><span class="sxs-lookup"><span data-stu-id="921f4-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="921f4-156">Om du vill tillåta effektiv hantering och bättre prestanda med DocumentClient, rekommenderas att använda en enda instans av DocumentClient per AppDomain för livslängden för programmet.</span><span class="sxs-lookup"><span data-stu-id="921f4-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="921f4-157">**Öka System.Net MaxConnections per värd när du använder läget för Gateway**</span><span class="sxs-lookup"><span data-stu-id="921f4-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="921f4-158">Cosmos DB begäranden som görs via HTTPS/RESTEN när du använder Gateway-läge och genomgår Standardgränsen för anslutning per värdnamn eller IP-adress.</span><span class="sxs-lookup"><span data-stu-id="921f4-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="921f4-159">Du kan behöva ange MaxConnections till ett högre värde (100-1000) så att klientbiblioteket kan använda flera samtidiga anslutningar till Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="921f4-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="921f4-160">I .NET SDK 1.8.0 och senare standardvärdet för [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) är 50 och du kan ange om du vill ändra värdet på [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) till ett högre värde.</span><span class="sxs-lookup"><span data-stu-id="921f4-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="921f4-161">**Justera parallella frågor för partitionerade samlingar**</span><span class="sxs-lookup"><span data-stu-id="921f4-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="921f4-162">DocumentDB .NET SDK version 1.9.0 och högre support parallella frågor, vilket gör det möjligt att fråga en partitionerad samling parallellt (se [arbeta med SDK: erna](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) och den relaterade [kodexempel](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) för mer information).</span><span class="sxs-lookup"><span data-stu-id="921f4-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="921f4-163">Parallella frågor är utformade för att förbättra svarstid och genomströmning över sin seriella motsvarighet.</span><span class="sxs-lookup"><span data-stu-id="921f4-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="921f4-164">Parallella frågor ange två parametrar som användare kan justera för anpassade efter deras krav, (a) MaxDegreeOfParallelism: att kontrollera det maximala antalet partitioner sedan kan efterfrågas parallellt och (b) MaxBufferedItemCount: att styra hur många tidigare hämtade resultat.</span><span class="sxs-lookup"><span data-stu-id="921f4-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="921f4-165">(a) ***justera MaxDegreeOfParallelism\: *** parallell frågan fungerar genom att fråga flera partitioner parallellt.</span><span class="sxs-lookup"><span data-stu-id="921f4-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="921f4-166">Dock hämtas data från en enskild partitionerade samla in seriellt med avseende på frågan.</span><span class="sxs-lookup"><span data-stu-id="921f4-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="921f4-167">Så har om MaxDegreeOfParallelism till antalet partitioner högsta risken för att uppnå de flesta performant frågan, förutsatt att alla andra system villkoren förblir oförändrade.</span><span class="sxs-lookup"><span data-stu-id="921f4-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="921f4-168">Om du inte vet antalet partitioner, du kan ange MaxDegreeOfParallelism till ett stort antal och minsta (antal partitioner, tillhandahålls användarindata) som MaxDegreeOfParallelism väljs automatiskt.</span><span class="sxs-lookup"><span data-stu-id="921f4-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="921f4-169">Det är viktigt att notera att parallella frågor ger bästa fördelarna om data är jämnt fördelad över alla partitioner med avseende på frågan.</span><span class="sxs-lookup"><span data-stu-id="921f4-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="921f4-170">Om partitionerade samlingen är partitionerad så att hela eller en majoritet av data som returneras av en fråga samlas i några partitioner (en partition i värsta fall) och sedan dessa partitioner skulle flaskhals prestanda för frågan.</span><span class="sxs-lookup"><span data-stu-id="921f4-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="921f4-171">(b) ***justera MaxBufferedItemCount\: *** Parallel query är utformat för att före hämtar resultat när den aktuella batchen med resultat som behandlas av klienten.</span><span class="sxs-lookup"><span data-stu-id="921f4-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="921f4-172">Det hjälper till att hämtas först i den övergripande svarstiden förbättring av en fråga.</span><span class="sxs-lookup"><span data-stu-id="921f4-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="921f4-173">MaxBufferedItemCount är parametern för att begränsa antalet resultat som tidigare hämtade.</span><span class="sxs-lookup"><span data-stu-id="921f4-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="921f4-174">MaxBufferedItemCount till det förväntade antalet resultat som returneras (eller fler) kan frågan för att hämta det maximala fördelar.</span><span class="sxs-lookup"><span data-stu-id="921f4-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="921f4-175">Observera att hämta fungerar på samma sätt oavsett MaxDegreeOfParallelism och det finns en enda buffert för data från alla partitioner.</span><span class="sxs-lookup"><span data-stu-id="921f4-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="921f4-176">**Aktivera servern GC**</span><span class="sxs-lookup"><span data-stu-id="921f4-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="921f4-177">Minska frekvensen för skräpinsamling kan hjälpa i vissa fall.</span><span class="sxs-lookup"><span data-stu-id="921f4-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="921f4-178">Ange i .NET, [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) till true.</span><span class="sxs-lookup"><span data-stu-id="921f4-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="921f4-179">**Implementera backoff med RetryAfter intervall**</span><span class="sxs-lookup"><span data-stu-id="921f4-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="921f4-180">Under prestandatester, bör du öka belastningen tills en liten andel begäranden hämta begränsas.</span><span class="sxs-lookup"><span data-stu-id="921f4-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="921f4-181">Om begränsas, bör klientprogrammet backoff på begränsning för intervallet-server har angetts.</span><span class="sxs-lookup"><span data-stu-id="921f4-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="921f4-182">Respektera backoff garanterar att du ägnar minimal mängd väntetid mellan försöken.</span><span class="sxs-lookup"><span data-stu-id="921f4-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="921f4-183">Försök stöd för Grupprincip ingår i Version 1.8.0 och senare i documentdb [.NET](documentdb-sdk-dotnet.md) och [Java](documentdb-sdk-java.md), version 1.9.0 och högre av de [Node.js](documentdb-sdk-node.md) och [Python](documentdb-sdk-python.md), och alla versioner av stöds i [.NET Core](documentdb-sdk-dotnet-core.md) SDK: er.</span><span class="sxs-lookup"><span data-stu-id="921f4-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="921f4-184">Mer information finns i [Exceeding reserverat dataflöde gränser](request-units.md#RequestRateTooLarge) och [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="921f4-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="921f4-185">**Skala upp din klient arbetsbelastning**</span><span class="sxs-lookup"><span data-stu-id="921f4-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="921f4-186">Om du testar på hög genomströmning nivåer (> 50 000 RU/s), klientprogrammet kan bli en flaskhals på grund av den datorn tak som skall ut på processor eller användning.</span><span class="sxs-lookup"><span data-stu-id="921f4-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="921f4-187">Om du når den här punkten kan fortsätta du att push-Cosmos-DB kontot ytterligare genom att skala ut ditt klientprogram på flera servrar.</span><span class="sxs-lookup"><span data-stu-id="921f4-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="921f4-188">**Cachelagra dokumentet URI: er för lägre skrivskyddade fördröjning**</span><span class="sxs-lookup"><span data-stu-id="921f4-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="921f4-189">Dokumentet URI: er när det är möjligt för bästa prestanda för Läs-cache.</span><span class="sxs-lookup"><span data-stu-id="921f4-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="921f4-190">**Finjustera sidstorleken för frågor/läsa feeds för bättre prestanda**</span><span class="sxs-lookup"><span data-stu-id="921f4-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="921f4-191">När utför en grupp av dokument med Läs feed funktioner (till exempel ReadDocumentFeedAsync) eller läsas vid utfärdande av en DocumentDB SQL-fråga, returneras resultatet i ett segmenterade sätt om resultatet är för stor.</span><span class="sxs-lookup"><span data-stu-id="921f4-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="921f4-192">Resultaten returneras i mängder 100 objekt eller 1 MB som standard, oavsett vilken gränsen är träffar första.</span><span class="sxs-lookup"><span data-stu-id="921f4-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="921f4-193">För att minska antalet nätverket förfrågningar krävs för att hämta alla tillämpliga resultat, kan du öka sidstorleken med x-ms-max--antal objekt begärandehuvudet till upp till 1000.</span><span class="sxs-lookup"><span data-stu-id="921f4-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="921f4-194">I fall där du vill visa endast några resultat, till exempel om ditt användar-gränssnittet eller programmet API returnerar bara 10 resulterar en tid, du kan också minska sidstorleken till 10 för att minska den används för läsning och frågor.</span><span class="sxs-lookup"><span data-stu-id="921f4-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="921f4-195">Du kan också ange sidstorlek med tillgängliga Cosmos DB SDK: erna.</span><span class="sxs-lookup"><span data-stu-id="921f4-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="921f4-196">Exempel:</span><span class="sxs-lookup"><span data-stu-id="921f4-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="921f4-197">**Öka antalet trådar/uppgifter**</span><span class="sxs-lookup"><span data-stu-id="921f4-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="921f4-198">Se [öka antalet trådar/uppgifter](#increase-threads) i avsnittet nätverk.</span><span class="sxs-lookup"><span data-stu-id="921f4-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="921f4-199">**64-bitars värden bearbetning**</span><span class="sxs-lookup"><span data-stu-id="921f4-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="921f4-200">DocumentDB SDK fungerar i en 32-bitars värdprocess när du använder DocumentDB .NET SDK version 1.11.4 och högre.</span><span class="sxs-lookup"><span data-stu-id="921f4-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="921f4-201">Om du använder mellan partition frågor rekommenderas 64-bitars värden bearbetning för bättre prestanda.</span><span class="sxs-lookup"><span data-stu-id="921f4-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="921f4-202">Följande typer av program har 32-bitars värdprocess som standard, så för att kunna ändra som till 64-bitars, Följ dessa steg beroende på vilken typ av ditt program:</span><span class="sxs-lookup"><span data-stu-id="921f4-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="921f4-203">Körbara program, detta kan göras genom att avmarkera den **föredrar 32-bitars** alternativet i den **projektegenskaperna** fönstret på den **skapa** fliken.</span><span class="sxs-lookup"><span data-stu-id="921f4-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="921f4-204">För VSTest baserad testprojekt, kan du göra det genom att välja **testa**->**Testinställningar**->**standard processorarkitektur som X64**, från den **Visual Studio Test** menyalternativet.</span><span class="sxs-lookup"><span data-stu-id="921f4-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="921f4-205">För lokalt distribuerade ASP.NET-webbprogram, detta kan göras genom att kontrollera den **använder 64-bitarsversionen av IIS Express för webbplatser och projekt**under **verktyg**->**alternativ**->**projekt och lösningar**->**webbprojekt**.</span><span class="sxs-lookup"><span data-stu-id="921f4-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="921f4-206">För ASP.NET-webbprogram har distribuerats på Azure, detta kan göras genom att välja den **plattform som 64-bitars** i den **programinställningar** på Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="921f4-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="921f4-207">Indexprincip</span><span class="sxs-lookup"><span data-stu-id="921f4-207">Indexing Policy</span></span>
1. <span data-ttu-id="921f4-208">**Använd lazy indexering för snabbare belastning tid införandet priser**</span><span class="sxs-lookup"><span data-stu-id="921f4-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="921f4-209">Cosmos DB kan du ange – på samlingsnivå – en indexprincip där du kan välja om du vill att dokument i en samling som indexeras automatiskt eller inte.</span><span class="sxs-lookup"><span data-stu-id="921f4-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="921f4-210">Dessutom kan du också välja mellan synkron (konsekvent) och asynkrona uppdateringar av index (Lazy).</span><span class="sxs-lookup"><span data-stu-id="921f4-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="921f4-211">Indexet uppdateras synkront som standard på varje insert-, ersätta eller ta bort ett befintligt dokument i samlingen.</span><span class="sxs-lookup"><span data-stu-id="921f4-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="921f4-212">Synkront läget kan frågor ta hänsyn till samma [konsekvensnivå](consistency-levels.md) som dokumentet läser utan fördröjning för indexet ”identifiera”.</span><span class="sxs-lookup"><span data-stu-id="921f4-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="921f4-213">Lazy indexering kan övervägas för scenarier där data skrivs i belastning och du vill att amortera arbetet som krävs för att indexera innehåll under en längre tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="921f4-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="921f4-214">Lazy indexering kan du också använda din dataflöde effektivt och tjäna skrivbegäranden vid Högbelastningstider med minimal svarstid.</span><span class="sxs-lookup"><span data-stu-id="921f4-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="921f4-215">Det är viktigt att Observera att frågeresultatet är överensstämmelse oavsett konsekvensnivå som konfigurerats för Cosmos-DB-konto när lazy indexering är aktiverad.</span><span class="sxs-lookup"><span data-stu-id="921f4-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="921f4-216">Därför konsekvent indexering läge (IndexingPolicy.IndexingMode är inställt på konsekvent) ådrar sig högsta begäran enhet kostnad per skrivning vid Lazy indexering läge (IndexingPolicy.IndexingMode är inställt på Lazy) och ingen indexering (IndexingPolicy.Automatic är inställd på False) har noll indexering kostnad vid tidpunkten för skrivning.</span><span class="sxs-lookup"><span data-stu-id="921f4-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="921f4-217">**Uteslut oanvända sökvägar från indexering för snabbare skrivningar**</span><span class="sxs-lookup"><span data-stu-id="921f4-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="921f4-218">Cosmos DBS indexprincip kan du ange vilka sökvägar dokument om du vill inkludera eller exkludera från indexering genom att använda indexering sökvägar (IndexingPolicy.IncludedPaths och IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="921f4-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="921f4-219">Användning av indexering sökvägar kan erbjuda bättre skrivprestanda och lägre index lagring för scenarier där frågemönster är kända i förväg, som indexerings kostnader direkt kopplas ihop med antalet unika sökvägar som indexeras.</span><span class="sxs-lookup"><span data-stu-id="921f4-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="921f4-220">Följande kod visar exempelvis undanta (kallas även ett helt avsnitt av dokumenten</span><span class="sxs-lookup"><span data-stu-id="921f4-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="921f4-221">en underkatalog) från att använda indexering av ”*” jokertecken.</span><span class="sxs-lookup"><span data-stu-id="921f4-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="921f4-222">Mer information finns i [Azure Cosmos DB indexering principer](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="921f4-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="921f4-223">Dataflöde</span><span class="sxs-lookup"><span data-stu-id="921f4-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="921f4-224">**Mäter och finjustera för lägre begäran enheter per sekund användning**</span><span class="sxs-lookup"><span data-stu-id="921f4-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="921f4-225">Cosmos DB erbjuder en omfattande uppsättning databasåtgärder inklusive relationella och hierarkiska frågor med UDF: er, lagrade procedurer och utlösare – alla operativsystem i dokumenten inom en samling i databasen.</span><span class="sxs-lookup"><span data-stu-id="921f4-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="921f4-226">Kostnaden för att var och en av dessa åtgärder varierar beroende på CPU, IO och minne som krävs för att slutföra åtgärden.</span><span class="sxs-lookup"><span data-stu-id="921f4-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="921f4-227">I stället för att tänka på och hantera maskinvaruresurser, Tänk på begäran-enhet (RU) som en enda åtgärd för de resurser som krävs för att utföra olika databasåtgärder och ett program begärde-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="921f4-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="921f4-228">[Enheter för programbegäran](request-units.md) etableras för varje konto baserat på antalet kapacitetsenheter som du köper.</span><span class="sxs-lookup"><span data-stu-id="921f4-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="921f4-229">Konsumtion av begäran enheten utvärderas som en sats per sekund.</span><span class="sxs-lookup"><span data-stu-id="921f4-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="921f4-230">Program som överskrider den etablerade begärandehastighet enhet för sitt konto begränsas förrän frekvensen sjunker under nivån reserverade för kontot.</span><span class="sxs-lookup"><span data-stu-id="921f4-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="921f4-231">Om programmet kräver en högre säkerhetsnivå för genomflöde, kan du köpa ytterligare kapacitetsenheter.</span><span class="sxs-lookup"><span data-stu-id="921f4-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="921f4-232">Komplexiteten i en fråga påverkar hur många enheter som begär förbrukas för en åtgärd.</span><span class="sxs-lookup"><span data-stu-id="921f4-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="921f4-233">Antalet predikat, predikat, antalet UDF: er och storleken på alla källa datauppsättningen påverkar kostnaden för frågor.</span><span class="sxs-lookup"><span data-stu-id="921f4-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="921f4-234">För mätning av alla åtgärder (skapa, uppdatera eller ta bort) inspektera huvudet x-ms-begäran-tillägget (eller motsvarande RequestCharge-egenskapen i ResourceResponse<T> eller FeedResponse<T> i .NET SDK) att mäta antalet begäran enheter som används av dessa åtgärder.</span><span class="sxs-lookup"><span data-stu-id="921f4-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="921f4-235">Begäran-tillägget som returneras i det här sidhuvudet är en del av din dataflöde (d.v.s. 2000 RUs / sekund).</span><span class="sxs-lookup"><span data-stu-id="921f4-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="921f4-236">Om den föregående frågan returnerar 1000 1KB-dokument, är kostnaden för åtgärden 1000.</span><span class="sxs-lookup"><span data-stu-id="921f4-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="921f4-237">Inom en sekund godkänner servern därför bara två sådana begäranden innan begränsning efterföljande förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="921f4-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="921f4-238">Mer information finns i [programbegäran](request-units.md) och [begäran enhet Kalkylatorn](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="921f4-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="921f4-239">**Hantera hastighet begränsa/förfrågningar för stor**</span><span class="sxs-lookup"><span data-stu-id="921f4-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="921f4-240">När en klient försöker överskrida reserverat dataflöde för ett konto, finns det inga prestandaförsämring på servern och ingen användning av genomflödeskapaciteten utanför den reserverade.</span><span class="sxs-lookup"><span data-stu-id="921f4-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="921f4-241">Servern kommer avsluta begäran och RequestRateTooLarge (HTTP-statuskod 429) och returnera x-ms-retry-efter-ms-huvudet som anger hur lång tid i millisekunder som användaren måste vänta innan ett nytt försök för begäran.</span><span class="sxs-lookup"><span data-stu-id="921f4-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="921f4-242">SDK: erna alla implicit catch-svaret respektera server angetts försök igen efter rubriken och försöka.</span><span class="sxs-lookup"><span data-stu-id="921f4-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="921f4-243">Om ditt konto används samtidigt av flera klienter, lyckas nästa försök.</span><span class="sxs-lookup"><span data-stu-id="921f4-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="921f4-244">Om du har mer än ett klientoperativsystem kumulativt konsekvent över den begärt frekvensen standard antal försök som för närvarande inställd på 9 internt av klienten inte finns tillräckligt; i det här fallet genererar klienten ett DocumentClientException med statuskoden 429 till programmet.</span><span class="sxs-lookup"><span data-stu-id="921f4-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="921f4-245">Standardvärdet för antal återförsök kan ändras genom att ange RetryOptions på ConnectionPolicy-instans.</span><span class="sxs-lookup"><span data-stu-id="921f4-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="921f4-246">Som standard returneras DocumentClientException med statuskoden 429 efter en kumulativ väntetid på 30 sekunder om begäran fortsätter att fungera över frekvensen med begäran.</span><span class="sxs-lookup"><span data-stu-id="921f4-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="921f4-247">Detta inträffar även när det aktuella antalet nya försök är mindre än det högsta antal försök antalet måste vara den standardvärdet 9 eller ett användardefinierat värde.</span><span class="sxs-lookup"><span data-stu-id="921f4-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="921f4-248">När automatiska försök beteendet hjälper oss för att förbättra återhämtning och användbarhet för de flesta program, kan det ha följt emot varandra när du gör prestandatester, särskilt när mätning av svarstiden.</span><span class="sxs-lookup"><span data-stu-id="921f4-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="921f4-249">Svarstid för klient-observerade kommer ökar om experimentet träffar server-begränsning och orsakar klient-SDK ska försöka utföra tyst.</span><span class="sxs-lookup"><span data-stu-id="921f4-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="921f4-250">För att undvika svarstidsspikar under prestanda experiment mäta kostnad som returneras av varje åtgärd och se till att begäranden fungerar nedan reserverade förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="921f4-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="921f4-251">Mer information finns i [programbegäran](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="921f4-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="921f4-252">**Design för mindre dokument för högre genomströmning**</span><span class="sxs-lookup"><span data-stu-id="921f4-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="921f4-253">Begäran-tillägget (d.v.s. begäranbearbetningen kostnad) för en viss åtgärd korreleras direkt till samma storlek som dokumentet.</span><span class="sxs-lookup"><span data-stu-id="921f4-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="921f4-254">Åtgärder för stora dokument kostar mer än åtgärder för små dokument.</span><span class="sxs-lookup"><span data-stu-id="921f4-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="921f4-255">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="921f4-255">Next steps</span></span>
<span data-ttu-id="921f4-256">Ett exempelprogram som används för att utvärdera Cosmos DB för scenarier med hög prestanda på några klientdatorer, se [prestanda och skalning testning med Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="921f4-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="921f4-257">Se även om du vill veta mer om hur du utformar ditt program för skalbarhet och hög prestanda [partitionering och skalning i Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="921f4-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
