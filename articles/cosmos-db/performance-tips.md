---
title: aaaPerformance tips - Azure Cosmos DB NoSQL | Microsoft Docs
description: "Läs client configuration alternativ tooimprove Azure Cosmos DB databasprestanda"
keywords: hur tooimprove-databasprestanda
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: 4f3e82ae5048e3dbc20b0fd891a2d3aa22adf3fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="54961-104">Prestandatips för Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="54961-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="54961-105">Azure Cosmos-DB är en snabb och flexibel distribuerad databas som kan skalas sömlöst med garanterad svarstid och genomströmning.</span><span class="sxs-lookup"><span data-stu-id="54961-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="54961-106">Du inte har ändrats och toomake större arkitektur eller skriva komplex kod tooscale databasen med Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="54961-106">You do not have toomake major architecture changes or write complex code tooscale your database with Cosmos DB.</span></span> <span data-ttu-id="54961-107">Skala upp och ner är lika enkelt som att göra en enda API-anrop eller [SDK-anrop](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="54961-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="54961-108">Eftersom Cosmos-databasen är tillgänglig emellertid nätverket anrop det klientsidan optimeringar du tooachieve topprestanda.</span><span class="sxs-lookup"><span data-stu-id="54961-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make tooachieve peak performance.</span></span>

<span data-ttu-id="54961-109">Så om du begär ”hur kan jag förbättra Mina databasprestanda”?</span><span class="sxs-lookup"><span data-stu-id="54961-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="54961-110">Tänk hello följande alternativ:</span><span class="sxs-lookup"><span data-stu-id="54961-110">consider hello following options:</span></span>

## <a name="networking"></a><span data-ttu-id="54961-111">Nätverk</span><span class="sxs-lookup"><span data-stu-id="54961-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="54961-112">**Anslutningsprincip för: Använd direktanslutning läge**</span><span class="sxs-lookup"><span data-stu-id="54961-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="54961-113">Hur en klient ansluter tooCosmos DB har stor betydelse för prestanda, särskilt observerade klientens svarstid.</span><span class="sxs-lookup"><span data-stu-id="54961-113">How a client connects tooCosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="54961-114">Det finns två viktiga konfigurationsinställningar för att konfigurera klienten anslutningsprincip – hello anslutning *läge* och hello [anslutning *protokollet*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="54961-114">There are two key configuration settings available for configuring client Connection Policy – hello connection *mode* and hello [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="54961-115">hello två lägena finns:</span><span class="sxs-lookup"><span data-stu-id="54961-115">hello two available modes are:</span></span>

   1. <span data-ttu-id="54961-116">Gateway-läge (standard)</span><span class="sxs-lookup"><span data-stu-id="54961-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="54961-117">Direkt-läge</span><span class="sxs-lookup"><span data-stu-id="54961-117">Direct Mode</span></span>

      <span data-ttu-id="54961-118">Gateway-läge stöds på alla SDK-plattformar och är hello konfigurerad som standard.</span><span class="sxs-lookup"><span data-stu-id="54961-118">Gateway Mode is supported on all SDK platforms and is hello configured default.</span></span>  <span data-ttu-id="54961-119">Om programmet körs i ett företagsnätverk med strikt brandväggsbegränsningar, är Gateway-läge hello bästa valet eftersom den använder hello standard HTTPS-porten och en enda slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="54961-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is hello best choice since it uses hello standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="54961-120">Hej prestanda förhållandet, är dock att Gateway-läge innebär ett hopp ytterligare nätverk varje gång data har lästs eller skrivits tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="54961-120">hello performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written tooCosmos DB.</span></span> <span data-ttu-id="54961-121">Därför ger direkt läge bättre prestanda på grund av toofewer nätverkshopp.</span><span class="sxs-lookup"><span data-stu-id="54961-121">Because of this, Direct Mode offers better performance due toofewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="54961-122">**Anslutningsprincip för: Använd hello TCP-protokoll**</span><span class="sxs-lookup"><span data-stu-id="54961-122">**Connection policy: Use hello TCP protocol**</span></span>

    <span data-ttu-id="54961-123">När du använder direkt läge, finns det två tillgängliga protokollalternativ:</span><span class="sxs-lookup"><span data-stu-id="54961-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="54961-124">TCP</span><span class="sxs-lookup"><span data-stu-id="54961-124">TCP</span></span>
   * <span data-ttu-id="54961-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="54961-125">HTTPS</span></span>

     <span data-ttu-id="54961-126">Cosmos DB erbjuder ett enkelt och öppna RESTful-programmeringsmiljö via HTTPS.</span><span class="sxs-lookup"><span data-stu-id="54961-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="54961-127">Dessutom erbjuder en effektiv TCP-protokoll som är också RESTful i dess kommunikation modell och är tillgänglig via hello .NET klient-SDK.</span><span class="sxs-lookup"><span data-stu-id="54961-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through hello .NET client SDK.</span></span> <span data-ttu-id="54961-128">Använda SSL för första autentiseringen och kryptering trafik direkt TCP- och HTTPS.</span><span class="sxs-lookup"><span data-stu-id="54961-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="54961-129">Använd hello TCP-protokoll om det är möjligt för bästa prestanda.</span><span class="sxs-lookup"><span data-stu-id="54961-129">For best performance, use hello TCP protocol when possible.</span></span>

     <span data-ttu-id="54961-130">När du använder TCP i Gateway-läge, TCP-Port 443 är hello Cosmos DB port och 10255 är hello MongoDB API-port.</span><span class="sxs-lookup"><span data-stu-id="54961-130">When using TCP in Gateway Mode, TCP Port 443 is hello Cosmos DB port, and 10255 is hello MongoDB API port.</span></span> <span data-ttu-id="54961-131">När du använder TCP i direkt läge i tillägg toohello Gateway hamnar du behöver tooensure hello port intervallet mellan 10000 och 20000 är öppen eftersom Cosmos DB använder dynamiska TCP-portar.</span><span class="sxs-lookup"><span data-stu-id="54961-131">When using TCP in Direct Mode, in addition toohello Gateway ports, you need tooensure hello port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="54961-132">Om dessa portar inte är öppna och försök toouse TCP, felmeddelandet 503 tjänsten är inte tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="54961-132">If these ports are not open and you attempt toouse TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="54961-133">hello anslutningsläget konfigureras under hello konstruktionen av hello DocumentClient instans med hello ConnectionPolicy parameter.</span><span class="sxs-lookup"><span data-stu-id="54961-133">hello Connectivity Mode is configured during hello construction of hello DocumentClient instance with hello ConnectionPolicy parameter.</span></span> <span data-ttu-id="54961-134">Om direkt läge används, kan du också ange hello protokoll inom hello ConnectionPolicy parameter.</span><span class="sxs-lookup"><span data-stu-id="54961-134">If Direct Mode is used, hello Protocol can also be set within hello ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from hello Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="54961-135">Eftersom TCP stöds endast i direkt läge om Gateway-läget används, sedan använda hello HTTPS-protokollet är alltid toocommunicate med hello Gateway och hello protokollvärde i hello ConnectionPolicy ignoreras.</span><span class="sxs-lookup"><span data-stu-id="54961-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then hello HTTPS protocol is always used toocommunicate with hello Gateway and hello Protocol value in hello ConnectionPolicy is ignored.</span></span>

    ![Bild av hello Azure DB som Cosmos-princip](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="54961-137">**Anropa OpenAsync tooavoid Start svarstid för första begäran**</span><span class="sxs-lookup"><span data-stu-id="54961-137">**Call OpenAsync tooavoid startup latency on first request**</span></span>

    <span data-ttu-id="54961-138">Som standard har hello första begäran en högre latens eftersom den har toofetch hello adress-routningstabellen.</span><span class="sxs-lookup"><span data-stu-id="54961-138">By default, hello first request has a higher latency because it has toofetch hello address routing table.</span></span> <span data-ttu-id="54961-139">tooavoid den här fördröjningen för start på hello först begära, du måste anropa OpenAsync() en gång under initieringen på följande sätt.</span><span class="sxs-lookup"><span data-stu-id="54961-139">tooavoid this startup latency on hello first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="54961-140">**Samordna klienter i samma Azure-region för prestanda**</span><span class="sxs-lookup"><span data-stu-id="54961-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="54961-141">Om möjligt, för alla program som anropar Cosmos-DB hello samma region som hello Cosmos DB-databasen.</span><span class="sxs-lookup"><span data-stu-id="54961-141">When possible, place any applications calling Cosmos DB in hello same region as hello Cosmos DB database.</span></span> <span data-ttu-id="54961-142">Anropar en ungefärlig jämförelse tooCosmos DB i samma region slutföra inom 1 – 2 ms, men hello fördröjning mellan hello västra och av hello USA är hello > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="54961-142">For an approximate comparison, calls tooCosmos DB within hello same region complete within 1-2 ms, but hello latency between hello West and East coast of hello US is >50 ms.</span></span> <span data-ttu-id="54961-143">Den här fördröjningen kan förmodligen variera från begäran toorequest beroende på hello väg hello begäran när det överförs från hello klienten toohello Azure-datacenter gräns.</span><span class="sxs-lookup"><span data-stu-id="54961-143">This latency can likely vary from request toorequest depending on hello route taken by hello request as it passes from hello client toohello Azure datacenter boundary.</span></span> <span data-ttu-id="54961-144">hello lägsta möjliga tidsfördröjning uppnås genom att säkerställa hello anropar program finns i hello samma Azure-region som hello etableras Cosmos-DB-slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="54961-144">hello lowest possible latency is achieved by ensuring hello calling application is located within hello same Azure region as hello provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="54961-145">En lista över tillgängliga regioner, se [Azure-regioner](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="54961-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="54961-146">![Bild av hello Azure DB som Cosmos-princip](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="54961-146">![Illustration of hello Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="54961-147">**Öka antalet trådar/uppgifter**</span><span class="sxs-lookup"><span data-stu-id="54961-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="54961-148">Eftersom anrop tooAzure Cosmos DB görs över hello nätverk, kan du kanske måste toovary hello grad av parallellitet med dina begäranden så att klientprogrammet hello tillbringar mycket snabbt väntar på mellan begäranden.</span><span class="sxs-lookup"><span data-stu-id="54961-148">Since calls tooAzure Cosmos DB are made over hello network, you may need toovary hello degree of parallelism of your requests so that hello client application spends very little time waiting between requests.</span></span> <span data-ttu-id="54961-149">Till exempel om du använder. NET'S [parallella Uppgiftsbibliotek](https://msdn.microsoft.com//library/dd460717.aspx), skapa hello efter 100-tal uppgifter läsning eller skrivning tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="54961-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in hello order of 100s of Tasks reading or writing tooCosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="54961-150">SDK-användning</span><span class="sxs-lookup"><span data-stu-id="54961-150">SDK Usage</span></span>
1. <span data-ttu-id="54961-151">**Installera hello senaste SDK**</span><span class="sxs-lookup"><span data-stu-id="54961-151">**Install hello most recent SDK**</span></span>

    <span data-ttu-id="54961-152">Hej Cosmos DB SDK: er som ständigt förbättrad tooprovide hello bästa prestanda.</span><span class="sxs-lookup"><span data-stu-id="54961-152">hello Cosmos DB SDKs are constantly being improved tooprovide hello best performance.</span></span> <span data-ttu-id="54961-153">Se hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) sidor toodetermine hello senaste SDK och granska förbättringar.</span><span class="sxs-lookup"><span data-stu-id="54961-153">See hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages toodetermine hello most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="54961-154">**Använd klienten en singleton-Cosmos-DB för hello livslängden för ditt program**</span><span class="sxs-lookup"><span data-stu-id="54961-154">**Use a singleton Cosmos DB client for hello lifetime of your application**</span></span>

    <span data-ttu-id="54961-155">Observera att varje DocumentClient-instans är trådsäker och utför effektiv hantering och cachelagring av adresser när direkt läge.</span><span class="sxs-lookup"><span data-stu-id="54961-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="54961-156">tooallow effektiv hantering och bättre prestanda med DocumentClient, är det rekommenderade toouse en instans av DocumentClient per AppDomain för hello programmet hello livstid.</span><span class="sxs-lookup"><span data-stu-id="54961-156">tooallow efficient connection management and better performance by DocumentClient, it is recommended toouse a single instance of DocumentClient per AppDomain for hello lifetime of hello application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="54961-157">**Öka System.Net MaxConnections per värd när du använder läget för Gateway**</span><span class="sxs-lookup"><span data-stu-id="54961-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="54961-158">Cosmos DB-begäranden görs över HTTPS/RESTEN när du använder Gateway-läge och är utsatts toohello standard anslutningsgränsen per värdnamn eller IP-adress.</span><span class="sxs-lookup"><span data-stu-id="54961-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected toohello default connection limit per hostname or IP address.</span></span> <span data-ttu-id="54961-159">Du kanske måste tooset hello MaxConnections tooa högre värde (100-1000) så att hello klientbiblioteket kan använda flera samtidiga anslutningar tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="54961-159">You may need tooset hello MaxConnections tooa higher value (100-1000) so that hello client library can utilize multiple simultaneous connections tooCosmos DB.</span></span> <span data-ttu-id="54961-160">I hello .NET SDK 1.8.0 och ovan, hello standardvärdet för [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) är 50 och toochange hello värde kan du ange hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit ](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa högre värde.</span><span class="sxs-lookup"><span data-stu-id="54961-160">In hello .NET SDK 1.8.0 and above, hello default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and toochange hello value, you can set hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa higher value.</span></span>   
4. <span data-ttu-id="54961-161">**Justera parallella frågor för partitionerade samlingar**</span><span class="sxs-lookup"><span data-stu-id="54961-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="54961-162">DocumentDB .NET SDK version 1.9.0 och högre support parallella frågor, vilket gör tooquery en partitionerad samling parallellt (se [arbeta med hello SDK](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) och hello relaterade [kodexempel](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) för Mer info).</span><span class="sxs-lookup"><span data-stu-id="54961-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you tooquery a partitioned collection in parallel (see [Working with hello SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and hello related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="54961-163">Parallella frågor är utformad tooimprove svarstid och genomströmning över sin seriella motsvarighet.</span><span class="sxs-lookup"><span data-stu-id="54961-163">Parallel queries are designed tooimprove query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="54961-164">Parallella frågor ange två parametrar att användare kan justera toocustom passning deras krav, (a) MaxDegreeOfParallelism: toocontrol hello högsta tillåtna antalet partitioner sedan kan efterfrågas parallellt och (b) MaxBufferedItemCount: toocontrol hello antal tidigare hämtade resultat.</span><span class="sxs-lookup"><span data-stu-id="54961-164">Parallel queries provide two parameters that users can tune toocustom-fit their requirements, (a) MaxDegreeOfParallelism: toocontrol hello maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: toocontrol hello number of pre-fetched results.</span></span>

    <span data-ttu-id="54961-165">(a) ***justera MaxDegreeOfParallelism\: *** parallell frågan fungerar genom att fråga flera partitioner parallellt.</span><span class="sxs-lookup"><span data-stu-id="54961-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="54961-166">Dock hämtas data från en enskild partitionerade samla in seriellt med avseende toohello fråga.</span><span class="sxs-lookup"><span data-stu-id="54961-166">However, data from an individual partitioned collect is fetched serially with respect toohello query.</span></span> <span data-ttu-id="54961-167">Därför har inställningen hello MaxDegreeOfParallelism toohello antalet partitioner hello maximala risken för att uppnå Hej de flesta performant frågan, förutsatt att alla andra system villkoren förblir hello samma.</span><span class="sxs-lookup"><span data-stu-id="54961-167">So, setting hello MaxDegreeOfParallelism toohello number of partitions has hello maximum chance of achieving hello most performant query, provided all other system conditions remain hello same.</span></span> <span data-ttu-id="54961-168">Om du inte vet hello antalet partitioner, du kan ange hello MaxDegreeOfParallelism tooa högt värde och hello väljs automatiskt hello minsta (antal partitioner, tillhandahålls användarindata) som hello MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="54961-168">If you don't know hello number of partitions, you can set hello MaxDegreeOfParallelism tooa high number, and hello system chooses hello minimum (number of partitions, user provided input) as hello MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="54961-169">Det är viktigt toonote som parallella frågor producerar hello bästa fördelar om hello data är jämnt fördelad över alla partitioner med avseende toohello fråga.</span><span class="sxs-lookup"><span data-stu-id="54961-169">It is important toonote that parallel queries produce hello best benefits if hello data is evenly distributed across all partitions with respect toohello query.</span></span> <span data-ttu-id="54961-170">Om hello partitionerad samling är partitionerad så att hela eller en majoritet av hello data som returneras av en fråga samlas i några partitioner (en partition i värsta fall) och sedan dessa partitioner skulle flaskhals hello prestanda för hello frågan.</span><span class="sxs-lookup"><span data-stu-id="54961-170">If hello partitioned collection is partitioned such a way that all or a majority of hello data returned by a query is concentrated in a few partitions (one partition in worst case), then hello performance of hello query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="54961-171">(b) ***justera MaxBufferedItemCount\: *** parallella frågan är utformad toopre fetch resultat medan hello aktuell batch resultat bearbetas av hello-klienten.</span><span class="sxs-lookup"><span data-stu-id="54961-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed toopre-fetch results while hello current batch of results is being processed by hello client.</span></span> <span data-ttu-id="54961-172">hello hämta hjälper dig i den övergripande svarstiden förbättring av en fråga.</span><span class="sxs-lookup"><span data-stu-id="54961-172">hello pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="54961-173">MaxBufferedItemCount är hello parametern toolimit hello antal tidigare hämtade resultat.</span><span class="sxs-lookup"><span data-stu-id="54961-173">MaxBufferedItemCount is hello parameter toolimit hello number of pre-fetched results.</span></span> <span data-ttu-id="54961-174">Inställningen MaxBufferedItemCount förväntat toohello antal resultat som returneras (eller fler) tillåter hello frågan tooreceive största möjliga nytta från hämta.</span><span class="sxs-lookup"><span data-stu-id="54961-174">Setting MaxBufferedItemCount toohello expected number of results returned (or a higher number) allows hello query tooreceive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="54961-175">Observera att före hämtning fungerar hello samma sätt oavsett hello MaxDegreeOfParallelism och det finns en enda buffert för hello data från alla partitioner.</span><span class="sxs-lookup"><span data-stu-id="54961-175">Note that pre-fetching works hello same way irrespective of hello MaxDegreeOfParallelism, and there is a single buffer for hello data from all partitions.</span></span>  
5. <span data-ttu-id="54961-176">**Aktivera servern GC**</span><span class="sxs-lookup"><span data-stu-id="54961-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="54961-177">Minska hello frekvensen för skräpinsamling kan hjälpa i vissa fall.</span><span class="sxs-lookup"><span data-stu-id="54961-177">Reducing hello frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="54961-178">Ange i .NET, [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span><span class="sxs-lookup"><span data-stu-id="54961-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span></span>
6. <span data-ttu-id="54961-179">**Implementera backoff med RetryAfter intervall**</span><span class="sxs-lookup"><span data-stu-id="54961-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="54961-180">Under prestandatester, bör du öka belastningen tills en liten andel begäranden hämta begränsas.</span><span class="sxs-lookup"><span data-stu-id="54961-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="54961-181">Om begränsas, bör hello klientprogrammet backoff på begränsning för hello server angetts återförsöksintervall.</span><span class="sxs-lookup"><span data-stu-id="54961-181">If throttled, hello client application should backoff on throttle for hello server-specified retry interval.</span></span> <span data-ttu-id="54961-182">Respektera hello backoff garanterar att du ägnar minimal mängd väntetid mellan försöken.</span><span class="sxs-lookup"><span data-stu-id="54961-182">Respecting hello backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="54961-183">Stöd för återförsök Grupprincip ingår i Version 1.8.0 och senare av hello DocumentDB [.NET](documentdb-sdk-dotnet.md) och [Java](documentdb-sdk-java.md), version 1.9.0 och senare av hello [Node.js](documentdb-sdk-node.md) och [ Python](documentdb-sdk-python.md), och alla versioner av hello stöds [.NET Core](documentdb-sdk-dotnet-core.md) SDK: er.</span><span class="sxs-lookup"><span data-stu-id="54961-183">Retry policy support is included in Version 1.8.0 and above of hello DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of hello [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of hello [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="54961-184">Mer information finns i [Exceeding reserverat dataflöde gränser](request-units.md#RequestRateTooLarge) och [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="54961-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="54961-185">**Skala upp din klient arbetsbelastning**</span><span class="sxs-lookup"><span data-stu-id="54961-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="54961-186">Om du testar på hög genomströmning nivåer (> 50 000 RU/s), hello klientprogrammet kan bli hello flaskhals på grund av toohello datorn tak som skall ut på processor eller användning.</span><span class="sxs-lookup"><span data-stu-id="54961-186">If you are testing at high throughput levels (>50,000 RU/s), hello client application may become hello bottleneck due toohello machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="54961-187">Om du når den här punkten kan fortsätta du toopush hello Cosmos DB konto ytterligare genom att skala ut ditt klientprogram på flera servrar.</span><span class="sxs-lookup"><span data-stu-id="54961-187">If you reach this point, you can continue toopush hello Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="54961-188">**Cachelagra dokumentet URI: er för lägre skrivskyddade fördröjning**</span><span class="sxs-lookup"><span data-stu-id="54961-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="54961-189">URI: er när det är möjligt för hello bästa läsprestanda för cache-dokument.</span><span class="sxs-lookup"><span data-stu-id="54961-189">Cache document URIs whenever possible for hello best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="54961-190">**Finjustera hello sidstorleken för frågor/läsa feeds för bättre prestanda**</span><span class="sxs-lookup"><span data-stu-id="54961-190">**Tune hello page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="54961-191">När utför en grupp av dokument med Läs feed funktioner (till exempel ReadDocumentFeedAsync) eller läsas vid utfärdande av en DocumentDB SQL-fråga, returneras hello resultat segmenterade överskrids om hello resultatmängden är för stor.</span><span class="sxs-lookup"><span data-stu-id="54961-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, hello results are returned in a segmented fashion if hello result set is too large.</span></span> <span data-ttu-id="54961-192">Resultaten returneras i mängder 100 objekt eller 1 MB som standard, oavsett vilken gränsen är träffar första.</span><span class="sxs-lookup"><span data-stu-id="54961-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="54961-193">tooreduce hello antal nätverk sändningar krävs tooretrieve alla tillämpliga resultat, kan du öka hello sidstorlek med hjälp av x-ms--objekt-maxantal begäran huvud tooup too1000.</span><span class="sxs-lookup"><span data-stu-id="54961-193">tooreduce hello number of network round trips required tooretrieve all applicable results, you can increase hello page size using x-ms-max-item-count request header tooup too1000.</span></span> <span data-ttu-id="54961-194">I fall där du behöver toodisplay endast några resultat, till exempel om ditt användar-gränssnittet eller programmet API returnerar bara 10 resulterar en tid, du kan också minska hello sidan storlek too10 tooreduce hello genomströmning används för läsning och frågor.</span><span class="sxs-lookup"><span data-stu-id="54961-194">In cases where you need toodisplay only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease hello page size too10 tooreduce hello throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="54961-195">Du kan också ange hello sidstorleken med hello tillgängliga Cosmos DB SDK.</span><span class="sxs-lookup"><span data-stu-id="54961-195">You may also set hello page size using hello available Cosmos DB SDKs.</span></span>  <span data-ttu-id="54961-196">Exempel:</span><span class="sxs-lookup"><span data-stu-id="54961-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="54961-197">**Öka antalet trådar/uppgifter**</span><span class="sxs-lookup"><span data-stu-id="54961-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="54961-198">Se [öka antalet trådar/uppgifter](#increase-threads) i hello nätverksavsnittet.</span><span class="sxs-lookup"><span data-stu-id="54961-198">See [Increase number of threads/tasks](#increase-threads) in hello Networking section.</span></span>

11. <span data-ttu-id="54961-199">**64-bitars värden bearbetning**</span><span class="sxs-lookup"><span data-stu-id="54961-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="54961-200">Hej DocumentDB SDK fungerar i en 32-bitars värdprocess när du använder DocumentDB .NET SDK version 1.11.4 och högre.</span><span class="sxs-lookup"><span data-stu-id="54961-200">hello DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="54961-201">Om du använder mellan partition frågor rekommenderas 64-bitars värden bearbetning för bättre prestanda.</span><span class="sxs-lookup"><span data-stu-id="54961-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="54961-202">hello följande typer av program har 32-bitars värd bearbeta som hello standard, så Följ anvisningarna utifrån hello typ av ditt program i ordning toochange som too64-bitars:</span><span class="sxs-lookup"><span data-stu-id="54961-202">hello following types of applications have 32-bit host process as hello default, so in order toochange that too64-bit, follow these steps based on hello type of your application:</span></span>

    - <span data-ttu-id="54961-203">Körbara program, detta kan göras genom att avmarkera hello **föredrar 32-bitars** alternativ i hello **projektegenskaperna** fönstret på hello **skapa** fliken.</span><span class="sxs-lookup"><span data-stu-id="54961-203">For Executable applications, this can be done by unchecking hello **Prefer 32-bit** option in hello **Project Properties** window, on hello **Build** tab.</span></span>

    - <span data-ttu-id="54961-204">För VSTest baserad testprojekt, kan du göra det genom att välja **testa**->**Testinställningar**->**standard processorarkitektur som X64**, från hello **Visual Studio Test** menyalternativet.</span><span class="sxs-lookup"><span data-stu-id="54961-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from hello **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="54961-205">För lokalt distribuerade ASP.NET-webbprogram, detta kan göras genom att kontrollera hello **Använd hello 64-bitars version av IIS Express för webbplatser och projekt**under **verktyg** ->  **Alternativ**->**projekt och lösningar**->**Web projekt**.</span><span class="sxs-lookup"><span data-stu-id="54961-205">For locally deployed ASP.NET Web applications, this can be done by checking hello **Use hello 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="54961-206">För ASP.NET-webbprogram har distribuerats på Azure, detta kan göras genom att välja hello **plattform som 64-bitars** i hello **programinställningar** på hello Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="54961-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing hello **Platform as 64-bit** in hello **Application Settings** on hello Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="54961-207">Indexprincip</span><span class="sxs-lookup"><span data-stu-id="54961-207">Indexing Policy</span></span>
1. <span data-ttu-id="54961-208">**Använd lazy indexering för snabbare belastning tid införandet priser**</span><span class="sxs-lookup"><span data-stu-id="54961-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="54961-209">Cosmos DB kan toospecify – på samlingsnivå hello – en indexprincip, vilket gör att du toochoose om du vill att hello dokument i en samling toobe som indexeras automatiskt eller inte.</span><span class="sxs-lookup"><span data-stu-id="54961-209">Cosmos DB allows you toospecify – at hello collection level – an indexing policy, which enables you toochoose if you want hello documents in a collection toobe automatically indexed or not.</span></span>  <span data-ttu-id="54961-210">Dessutom kan du också välja mellan synkron (konsekvent) och asynkrona uppdateringar av index (Lazy).</span><span class="sxs-lookup"><span data-stu-id="54961-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="54961-211">Hello indexet uppdateras synkront som standard på varje infoga, Ersätt eller borttagning av en dokumentsamling toohello.</span><span class="sxs-lookup"><span data-stu-id="54961-211">By default, hello index is updated synchronously on each insert, replace, or delete of a document toohello collection.</span></span> <span data-ttu-id="54961-212">Synkront läge aktiverar hello frågor toohonor hello samma [konsekvensnivå](consistency-levels.md) som hello läser dokumentet utan fördröjning för hello index för ”ikapp”.</span><span class="sxs-lookup"><span data-stu-id="54961-212">Synchronously mode enables hello queries toohonor hello same [consistency level](consistency-levels.md) as that of hello document reads without any delay for hello index too“catch up".</span></span>

    <span data-ttu-id="54961-213">Lazy indexering kan övervägas för scenarier där data skrivs i belastning och du vill att tooamortize hello arbetet som krävs för tooindex innehåll under en längre tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="54961-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want tooamortize hello work required tooindex content over a longer period of time.</span></span> <span data-ttu-id="54961-214">Lazy indexering kan du också toouse din etablerats genomströmning effektivt och fungera skrivåtgärder vid Högbelastningstider med minimal svarstid.</span><span class="sxs-lookup"><span data-stu-id="54961-214">Lazy indexing also allows you toouse your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="54961-215">Det är viktigt toonote, men att frågeresultatet är överensstämmelse oavsett hello konsekvensnivå som konfigurerats för hello Cosmos DB konto när lazy indexering är aktiverad.</span><span class="sxs-lookup"><span data-stu-id="54961-215">It is important toonote, however, that when lazy indexing is enabled, query results are eventually consistent regardless of hello consistency level configured for hello Cosmos DB account.</span></span>

    <span data-ttu-id="54961-216">Därför konsekvent indexering läge (IndexingPolicy.IndexingMode anges tooConsistent) ådrar sig hello högsta begäran enhet kostnad per skrivning vid Lazy indexering läge (IndexingPolicy.IndexingMode anges tooLazy) och ingen indexering (IndexingPolicy.Automatic anges tooFalse) har noll indexering kostnaden hello tiden för skrivning.</span><span class="sxs-lookup"><span data-stu-id="54961-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set tooConsistent) incurs hello highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set tooLazy) and no indexing (IndexingPolicy.Automatic is set tooFalse) have zero indexing cost at hello time of write.</span></span>
2. <span data-ttu-id="54961-217">**Uteslut oanvända sökvägar från indexering för snabbare skrivningar**</span><span class="sxs-lookup"><span data-stu-id="54961-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="54961-218">Cosmos DBS indexprincip kan du också toospecify som dokumentet sökvägar tooinclude eller undantas från att indexera genom att använda indexering sökvägar (IndexingPolicy.IncludedPaths och IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="54961-218">Cosmos DB’s indexing policy also allows you toospecify which document paths tooinclude or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="54961-219">hello användning av indexering sökvägar kan erbjuda bättre skrivprestanda och lägre index lagring för scenarier där hello frågemönster är känt i förväg, som indexerings kostnader som är direkt korrelerade toohello antalet unika sökvägar som indexeras.</span><span class="sxs-lookup"><span data-stu-id="54961-219">hello use of indexing paths can offer improved write performance and lower index storage for scenarios in which hello query patterns are known beforehand, as indexing costs are directly correlated toohello number of unique paths indexed.</span></span>  <span data-ttu-id="54961-220">Till exempel visar hello följande kod hur tooexclude ett helt avsnitt med hello dokument (kallas även</span><span class="sxs-lookup"><span data-stu-id="54961-220">For example, hello following code shows how tooexclude an entire section of hello documents (a.k.a.</span></span> <span data-ttu-id="54961-221">en underkatalog) från att indexera med hello ”*” jokertecken.</span><span class="sxs-lookup"><span data-stu-id="54961-221">a subtree) from indexing using hello "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="54961-222">Mer information finns i [Azure Cosmos DB indexering principer](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="54961-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="54961-223">Dataflöde</span><span class="sxs-lookup"><span data-stu-id="54961-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="54961-224">**Mäter och finjustera för lägre begäran enheter per sekund användning**</span><span class="sxs-lookup"><span data-stu-id="54961-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="54961-225">Cosmos DB erbjuder en omfattande uppsättning databasåtgärder inklusive relationella och hierarkiska frågor med UDF: er, lagrade procedurer och utlösare – alla operativsystem i hello dokument inom en samling i databasen.</span><span class="sxs-lookup"><span data-stu-id="54961-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on hello documents within a database collection.</span></span> <span data-ttu-id="54961-226">hello kostnader som är kopplade till var och en av dessa åtgärder varierar beroende på hello CPU, IO och minne som krävs för toocomplete hello operation.</span><span class="sxs-lookup"><span data-stu-id="54961-226">hello cost associated with each of these operations varies based on hello CPU, IO, and memory required toocomplete hello operation.</span></span> <span data-ttu-id="54961-227">I stället för att tänka på och hantera maskinvaruresurser, Tänk på begäran-enhet (RU) som en enda åtgärd för hello resurser krävs tooperform olika databasåtgärder och tjänsten ett program begärde.</span><span class="sxs-lookup"><span data-stu-id="54961-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for hello resources required tooperform various database operations and service an application request.</span></span>

    <span data-ttu-id="54961-228">[Enheter för programbegäran](request-units.md) etableras för varje konto baserat på hello antalet kapacitetsenheter som du köper.</span><span class="sxs-lookup"><span data-stu-id="54961-228">[Request units](request-units.md) are provisioned for each database account based on hello number of capacity units that you purchase.</span></span> <span data-ttu-id="54961-229">Konsumtion av begäran enheten utvärderas som en sats per sekund.</span><span class="sxs-lookup"><span data-stu-id="54961-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="54961-230">Program som överskrider hello etablerade begäran enhet klassificera för sitt konto är begränsad förrän hello frekvensen sjunker under hello reserverade nivå för hello-kontot.</span><span class="sxs-lookup"><span data-stu-id="54961-230">Applications that exceed hello provisioned request unit rate for their account is limited until hello rate drops below hello reserved level for hello account.</span></span> <span data-ttu-id="54961-231">Om programmet kräver en högre säkerhetsnivå för genomflöde, kan du köpa ytterligare kapacitetsenheter.</span><span class="sxs-lookup"><span data-stu-id="54961-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="54961-232">hello komplexiteten i en fråga påverkar hur många enheter som begär förbrukas för en åtgärd.</span><span class="sxs-lookup"><span data-stu-id="54961-232">hello complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="54961-233">hello antalet predikat, uppbyggnad hello predikat, antalet UDF: er och hello storleken på hello källa datauppsättning alla påverka hello kostnaden för fråga åtgärder.</span><span class="sxs-lookup"><span data-stu-id="54961-233">hello number of predicates, nature of hello predicates, number of UDFs, and hello size of hello source data set all influence hello cost of query operations.</span></span>

    <span data-ttu-id="54961-234">toomeasure hello arbetet med att alla åtgärder (skapa, uppdatera eller ta bort) inspektera hello x-ms-begäran-kostnad huvud (eller hello motsvarande RequestCharge egenskap i ResourceResponse<T> eller FeedResponse<T> i hello .NET SDK) toomeasure hello antal frågeenheter som används av dessa åtgärder.</span><span class="sxs-lookup"><span data-stu-id="54961-234">toomeasure hello overhead of any operation (create, update, or delete), inspect hello x-ms-request-charge header (or hello equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in hello .NET SDK) toomeasure hello number of request units consumed by these operations.</span></span>

    ```C#
    // Measure hello performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure hello performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="54961-235">hello begäran returnerade i huvud är en del av din dataflöde (d.v.s. 2000 RUs / sekund).</span><span class="sxs-lookup"><span data-stu-id="54961-235">hello request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="54961-236">Om hello föregående fråga returnerar 1000 1KB-dokument är hello kostnaden för hello åtgärden 1000.</span><span class="sxs-lookup"><span data-stu-id="54961-236">For example, if hello preceding query returns 1000 1KB-documents, hello cost of hello operation is 1000.</span></span> <span data-ttu-id="54961-237">Inom en sekund godkänner hello servern därför bara två sådana begäranden innan begränsning efterföljande förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="54961-237">As such, within one second, hello server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="54961-238">Mer information finns i [programbegäran](request-units.md) och hello [begäran enhet Kalkylatorn](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="54961-238">For more information, see [Request units](request-units.md) and hello [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="54961-239">**Hantera hastighet begränsa/förfrågningar för stor**</span><span class="sxs-lookup"><span data-stu-id="54961-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="54961-240">När en klient försöker tooexceed hello reserverat dataflöde för ett konto, är det utan prestandaförsämring på hello-servern och ingen användning av genomflödeskapaciteten utanför hello reserverade.</span><span class="sxs-lookup"><span data-stu-id="54961-240">When a client attempts tooexceed hello reserved throughput for an account, there is no performance degradation at hello server and no use of throughput capacity beyond hello reserved level.</span></span> <span data-ttu-id="54961-241">hello server avslutas förebyggande syfte hello begäran med RequestRateTooLarge (HTTP-statuskod 429) och returnerar hello x-ms-retry-efter-ms-huvud som anger hello lång tid i millisekunder som hello användare måste vänta innan ett nytt försök hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="54961-241">hello server will preemptively end hello request with RequestRateTooLarge (HTTP status code 429) and return hello x-ms-retry-after-ms header indicating hello amount of time, in milliseconds, that hello user must wait before reattempting hello request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="54961-242">hello SDK alla implicit catch-svaret, respekterar hello server angetts försök igen efter rubrik och försök hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="54961-242">hello SDKs all implicitly catch this response, respect hello server-specified retry-after header, and retry hello request.</span></span> <span data-ttu-id="54961-243">Om ditt konto används samtidigt av flera klienter, lyckas hello nästa försök.</span><span class="sxs-lookup"><span data-stu-id="54961-243">Unless your account is being accessed concurrently by multiple clients, hello next retry will succeed.</span></span>

    <span data-ttu-id="54961-244">Om du har mer än ett klientoperativsystem kumulativt konsekvent ovan hello förfrågningar hello standard antal försök för närvarande set too9 internt av hello-klienten inte finns tillräckligt; i det här fallet genererar hello klienten ett DocumentClientException med status kod 429 toohello program.</span><span class="sxs-lookup"><span data-stu-id="54961-244">If you have more than one client cumulatively operating consistently above hello request rate, hello default retry count currently set too9 internally by hello client may not suffice; in this case, hello client throws a DocumentClientException with status code 429 toohello application.</span></span> <span data-ttu-id="54961-245">hello standard återförsöksvärde kan ändras genom att inställningen hello RetryOptions på hello ConnectionPolicy instansen.</span><span class="sxs-lookup"><span data-stu-id="54961-245">hello default retry count can be changed by setting hello RetryOptions on hello ConnectionPolicy instance.</span></span> <span data-ttu-id="54961-246">Som standard returneras hello DocumentClientException med statuskoden 429 efter en kumulativ väntetid på 30 sekunder om hello begäran fortsätter toooperate ovan hello-förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="54961-246">By default, hello DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if hello request continues toooperate above hello request rate.</span></span> <span data-ttu-id="54961-247">Detta inträffar även när hello aktuella återförsöksvärdet är mindre än Hej max återförsöksvärdet måste vara den hello standardvärdet 9 eller ett användardefinierat värde.</span><span class="sxs-lookup"><span data-stu-id="54961-247">This occurs even when hello current retry count is less than hello max retry count, be it hello default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="54961-248">När automatisk hello försök beteende hjälper tooimprove återhämtning och användbarhet för hello de flesta program, den kan tas emot varandra när du gör prestandatester, särskilt när mäta svarstid.</span><span class="sxs-lookup"><span data-stu-id="54961-248">While hello automated retry behavior helps tooimprove resiliency and usability for hello most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="54961-249">hello klient-observerade svarstid kommer ökar om hello experiment träffar hello server begränsning och orsakar hello klienten SDK toosilently försök igen.</span><span class="sxs-lookup"><span data-stu-id="54961-249">hello client-observed latency will spike if hello experiment hits hello server throttle and causes hello client SDK toosilently retry.</span></span> <span data-ttu-id="54961-250">tooavoid fördröjning ger spikar i diagrammet under prestanda experiment mått hello kostnad som returneras av varje åtgärd och se till att begäranden fungerar nedan hello reserverade förfrågningar.</span><span class="sxs-lookup"><span data-stu-id="54961-250">tooavoid latency spikes during performance experiments, measure hello charge returned by each operation and ensure that requests are operating below hello reserved request rate.</span></span> <span data-ttu-id="54961-251">Mer information finns i [programbegäran](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="54961-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="54961-252">**Design för mindre dokument för högre genomströmning**</span><span class="sxs-lookup"><span data-stu-id="54961-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="54961-253">hello begäran (d.v.s. begäranbearbetningen kostnad) för en viss åtgärd är direkt korrelerade toohello storlek på hello dokument.</span><span class="sxs-lookup"><span data-stu-id="54961-253">hello request charge (i.e. request processing cost) of a given operation is directly correlated toohello size of hello document.</span></span> <span data-ttu-id="54961-254">Åtgärder för stora dokument kostar mer än åtgärder för små dokument.</span><span class="sxs-lookup"><span data-stu-id="54961-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="54961-255">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="54961-255">Next steps</span></span>
<span data-ttu-id="54961-256">Ett exempel program som används för tooevaluate Cosmos DB för scenarier med hög prestanda på några klientdatorer, se [prestanda och skalning testning med Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="54961-256">For a sample application used tooevaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="54961-257">Toolearn mer information om hur du utformar ditt program för skalbarhet och hög prestanda, se även [partitionering och skalning i Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="54961-257">Also, toolearn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
