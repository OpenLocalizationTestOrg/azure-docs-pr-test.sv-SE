---
title: "Åtkomstkontroll för Azure DB Cosmos-brandväggsstöd & IP | Microsoft Docs"
description: "Lär dig hur du använder IP-principer för åtkomstkontroll för brandväggsstöd för på Azure Cosmos DB databasen konton."
keywords: "IP-åtkomstkontroll, brandväggsstöd"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="b2346-104">Azure DB Cosmos-brandväggsstöd</span><span class="sxs-lookup"><span data-stu-id="b2346-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="b2346-105">Om du vill skydda data som lagras i Azure DB som Cosmos-databaskonto har Azure Cosmos DB fanns stöd för en hemlighet baserat [auktoriseringsmodellen](https://msdn.microsoft.com/library/azure/dn783368.aspx) som använder en stark hashbaserad meddelandeautentiseringskod (HMAC).</span><span class="sxs-lookup"><span data-stu-id="b2346-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="b2346-106">Förutom den hemliga baserat auktoriseringsmodellen stöder nu Azure Cosmos DB drivs IP-baserade åtkomstkontroller för inkommande brandväggsstöd-princip.</span><span class="sxs-lookup"><span data-stu-id="b2346-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="b2346-107">Den här modellen liknar brandväggsregler vid traditionella system och ger en extra nivå av säkerhet till databaskontot Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b2346-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="b2346-108">Med den här modellen kan du nu konfigurera en Azure Cosmos DB konto om du vill att endast nås från en godkänd uppsättning datorer och/eller molntjänster.</span><span class="sxs-lookup"><span data-stu-id="b2346-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="b2346-109">Åtkomst till Azure Cosmos DB resurser från dessa godkända uppsättningar av datorer och tjänster kräver fortfarande anroparen presentera en giltig auktoriserings-token.</span><span class="sxs-lookup"><span data-stu-id="b2346-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="b2346-110">IP-åtkomstkontroll: översikt</span><span class="sxs-lookup"><span data-stu-id="b2346-110">IP access control overview</span></span>
<span data-ttu-id="b2346-111">Ett konto för Azure DB som Cosmos-databasen är tillgänglig från offentliga internet som standard så länge begäran åtföljs av en giltig auktoriserings-token.</span><span class="sxs-lookup"><span data-stu-id="b2346-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="b2346-112">Om du vill konfigurera IP-policy-baserad åtkomstkontroll, måste användaren ange en uppsättning IP-adresser och IP-adressintervall i CIDR-formuläret ska ingå som listan över tillåtna klientens IP-adresser för en viss databas-konto.</span><span class="sxs-lookup"><span data-stu-id="b2346-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="b2346-113">När den här konfigurationen används blockeras alla begäranden från datorer utanför den här listan över tillåtna av servern.</span><span class="sxs-lookup"><span data-stu-id="b2346-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="b2346-114">Anslutningen processchema för IP-baserad åtkomstkontroll beskrivs i följande diagram.</span><span class="sxs-lookup"><span data-stu-id="b2346-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagram över anslutningsprocessen för IP-baserad åtkomstkontroll](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="b2346-116">Anslutningar från molntjänster</span><span class="sxs-lookup"><span data-stu-id="b2346-116">Connections from cloud services</span></span>
<span data-ttu-id="b2346-117">I Azure är cloud services ett mycket vanligt sätt som värd för tjänsten mellannivålogik med hjälp av Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b2346-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="b2346-118">Om du vill aktivera åtkomst till ett konto för Azure DB som Cosmos-databasen från en molnbaserad tjänst, offentliga IP-adressen för Molntjänsten måste läggas till listan över tillåtna IP-adresser som är associerade med din Azure Cosmos DB databaskonto av [konfigurera IP-åtkomst Kontrollera principen](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="b2346-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="b2346-119">Detta säkerställer att alla rollinstanser av molntjänster har åtkomst till ditt konto för Azure DB som Cosmos-databasen.</span><span class="sxs-lookup"><span data-stu-id="b2346-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="b2346-120">Du kan hämta IP-adresser för dina molntjänster i Azure-portalen som visas i följande skärmbild.</span><span class="sxs-lookup"><span data-stu-id="b2346-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Skärmbild som visar den offentliga IP-adressen för en molnbaserad tjänst som visas i Azure-portalen](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="b2346-122">När du skalar upp din molntjänst genom att lägga till ytterligare rollen instanser har de nya instanserna automatiskt åtkomst till Azure Cosmos DB databaskontot eftersom de ingår i samma molntjänst.</span><span class="sxs-lookup"><span data-stu-id="b2346-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="b2346-123">Anslutningar från virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="b2346-123">Connections from virtual machines</span></span>
<span data-ttu-id="b2346-124">[Virtuella datorer](https://azure.microsoft.com/services/virtual-machines/) eller [skalningsuppsättningar i virtuella](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) kan också användas som värd för mellannivån tjänster med hjälp av Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b2346-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="b2346-125">Om du vill konfigurera Azure DB som Cosmos-databaskonto för att tillåta åtkomst från virtuella datorer, offentliga IP-adresser för virtuell dator och/eller virtuella måste skaluppsättning konfigureras som en av de tillåtna IP-adresserna för dina Azure Cosmos DB databaskonto genom [konfigurera de IP-principer för åtkomstkontroll](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="b2346-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="b2346-126">Du kan hämta IP-adresser för virtuella datorer i Azure-portalen som visas i följande skärmbild.</span><span class="sxs-lookup"><span data-stu-id="b2346-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Skärmbild som visar en offentlig IP-adress för en virtuell dator visas i Azure-portalen](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="b2346-128">När du lägger till ytterligare virtuella datorinstanser i gruppen finns de automatiskt åtkomst till ditt konto för Azure DB som Cosmos-databasen.</span><span class="sxs-lookup"><span data-stu-id="b2346-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="b2346-129">Anslutningar från internet</span><span class="sxs-lookup"><span data-stu-id="b2346-129">Connections from the internet</span></span>
<span data-ttu-id="b2346-130">När du använder ett konto för Azure Cosmos-DB-databas från en dator på internet kan läggas klientens IP-adress eller IP-adressintervall för datorn till listan över tillåtna IP-adress för databaskontot Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b2346-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="b2346-131"><a id="configure-ip-policy"></a>Konfigurera de IP-principer för åtkomstkontroll</span><span class="sxs-lookup"><span data-stu-id="b2346-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="b2346-132">De IP-principer för åtkomstkontroll kan anges i Azure-portalen eller programmässigt via [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), eller [REST API](/rest/api/documentdb/) genom att uppdatera `ipRangeFilter`egenskapen.</span><span class="sxs-lookup"><span data-stu-id="b2346-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="b2346-133">IP-adressintervall måste vara kommatecken avgränsade och får inte innehålla blanksteg.</span><span class="sxs-lookup"><span data-stu-id="b2346-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="b2346-134">Exempel: ”13.91.6.132,13.91.6.1/24”.</span><span class="sxs-lookup"><span data-stu-id="b2346-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="b2346-135">När du uppdaterar din databaskonto via dessa metoder, måste du fylla i alla egenskaper för att förhindra återställs till standardinställningarna.</span><span class="sxs-lookup"><span data-stu-id="b2346-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="b2346-136">Genom att aktivera en IP-principer för åtkomstkontroll för din Azure Cosmos DB databaskonto tillåtna all åtkomst till din Azure Cosmos DB databaskonto från datorer utanför den konfigurerade listan över IP-adressintervall blockeras.</span><span class="sxs-lookup"><span data-stu-id="b2346-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="b2346-137">Tack vare den här modellen blockeras surfning plan för åtgärden från portalen också för att kontrollera integriteten för åtkomstkontroll.</span><span class="sxs-lookup"><span data-stu-id="b2346-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="b2346-138">För att förenkla utvecklingen hjälper Azure-portalen dig att identifiera och lägga till IP-Adressen för klientdatorn i listan över tillåtna, så att appar som körs på datorn kan komma åt Azure Cosmos DB-konto.</span><span class="sxs-lookup"><span data-stu-id="b2346-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="b2346-139">Observera att klientens IP-adress här har identifierats som visas av portalen.</span><span class="sxs-lookup"><span data-stu-id="b2346-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="b2346-140">Det kan vara klientens IP-adress för datorn, men det kan också vara IP-adressen för din nätverks-gateway.</span><span class="sxs-lookup"><span data-stu-id="b2346-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="b2346-141">Glöm inte att ta bort det innan du fortsätter till produktionen.</span><span class="sxs-lookup"><span data-stu-id="b2346-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="b2346-142">Om du vill ange de IP-principer för åtkomstkontroll i Azure portal, navigerar du till bladet Azure DB som Cosmos-konto, klickar du på **brandväggen** i navigeringsmenyn, klicka på **på**</span><span class="sxs-lookup"><span data-stu-id="b2346-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Skärmbild som visar hur du öppnar bladet brandväggen i Azure-portalen](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="b2346-144">Ange om Azure-portalen kan få åtkomst till kontot och lägga till andra adresser och intervall som är lämpligt, och klicka sedan i den nya rutan **spara**.</span><span class="sxs-lookup"><span data-stu-id="b2346-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="b2346-145">När du aktiverar en IP-principer för åtkomstkontroll som du behöver lägga till IP-adressen för Azure-portalen att upprätthålla åtkomsten.</span><span class="sxs-lookup"><span data-stu-id="b2346-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="b2346-146">Portalen IP-adresser är:</span><span class="sxs-lookup"><span data-stu-id="b2346-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="b2346-147">Region</span><span class="sxs-lookup"><span data-stu-id="b2346-147">Region</span></span>|<span data-ttu-id="b2346-148">IP-adress</span><span class="sxs-lookup"><span data-stu-id="b2346-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="b2346-149">Alla regioner utom de som anges nedan</span><span class="sxs-lookup"><span data-stu-id="b2346-149">All regions except those specified below</span></span>| <span data-ttu-id="b2346-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="b2346-150">104.42.195.92</span></span>|
> |<span data-ttu-id="b2346-151">Tyskland</span><span class="sxs-lookup"><span data-stu-id="b2346-151">Germany</span></span>|<span data-ttu-id="b2346-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="b2346-152">51.4.229.218</span></span>|
> |<span data-ttu-id="b2346-153">Kina</span><span class="sxs-lookup"><span data-stu-id="b2346-153">China</span></span>|<span data-ttu-id="b2346-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="b2346-154">139.217.8.252</span></span>|
> |<span data-ttu-id="b2346-155">Arizona (USA-förvaltad region)</span><span class="sxs-lookup"><span data-stu-id="b2346-155">US Gov Arizona</span></span>|<span data-ttu-id="b2346-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="b2346-156">52.244.48.71</span></span>|
>

![Skärmbild som visar en hur du konfigurerar inställningar för brandväggen i Azure-portalen](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="b2346-158">Felsökning av de IP-principer för åtkomstkontroll</span><span class="sxs-lookup"><span data-stu-id="b2346-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="b2346-159">Portalen åtgärder</span><span class="sxs-lookup"><span data-stu-id="b2346-159">Portal operations</span></span>
<span data-ttu-id="b2346-160">Genom att aktivera en IP-principer för åtkomstkontroll för din Azure Cosmos DB databaskonto tillåtna all åtkomst till din Azure Cosmos DB databaskonto från datorer utanför den konfigurerade listan över IP-adressintervall blockeras.</span><span class="sxs-lookup"><span data-stu-id="b2346-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="b2346-161">Om du vill aktivera portal plan dataåtgärder som surfning samlingar och fråga dokument måste du därför uttryckligen tillåta Azure portal med hjälp av den **brandväggen** blad i portalen.</span><span class="sxs-lookup"><span data-stu-id="b2346-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Skärmbild som visar en så att aktivera åtkomst till Azure-portalen](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="b2346-163">SDK & Rest API</span><span class="sxs-lookup"><span data-stu-id="b2346-163">SDK & Rest API</span></span>
<span data-ttu-id="b2346-164">För säkerhetsskäl åtkomst via SDK eller REST-API från datorer som inte finns på listan över tillåtna returneras ett allmänt 404 gick inte att hitta svar utan ytterligare information.</span><span class="sxs-lookup"><span data-stu-id="b2346-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="b2346-165">Kontrollera att IP-Adressen tillåten lista som konfigurerats för ditt konto för Azure DB som Cosmos-databasen för att säkerställa rätt principkonfigurationen tillämpas på ditt konto för Azure DB som Cosmos-databasen.</span><span class="sxs-lookup"><span data-stu-id="b2346-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b2346-166">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="b2346-166">Next steps</span></span>
<span data-ttu-id="b2346-167">Information om nätverk prestandatips finns [prestandatips](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="b2346-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

