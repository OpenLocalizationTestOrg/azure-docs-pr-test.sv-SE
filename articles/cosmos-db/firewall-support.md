---
title: "aaaAzure Cosmos-DB-brandväggsstöd & IP-åtkomstkontroll | Microsoft Docs"
description: "Lär dig hur toouse IP-principer för åtkomstkontroll för brandväggen stöder på Azure Cosmos DB databasen konton."
keywords: "IP-åtkomstkontroll, brandväggsstöd"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="1f7fe-104">Azure DB Cosmos-brandväggsstöd</span><span class="sxs-lookup"><span data-stu-id="1f7fe-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="1f7fe-105">toosecure data som lagras i Azure DB som Cosmos-databaskonto, Azure Cosmos DB tillhandahåller stöd för en hemlighet baserat [auktoriseringsmodellen](https://msdn.microsoft.com/library/azure/dn783368.aspx) som använder en stark hashbaserad meddelandeautentiseringskod (HMAC).</span><span class="sxs-lookup"><span data-stu-id="1f7fe-105">toosecure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="1f7fe-106">Nu kan dessutom toohello hemlighet baserad auktoriseringsmodellen, Azure Cosmos DB stöder drivs IP-baserade åtkomstkontroller för inkommande brandväggsstöd-princip.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-106">Now, in addition toohello secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="1f7fe-107">Den här modellen är mycket lik toohello brandväggsregler vid traditionella system och ger en extra nivå av säkerhet toohello Azure Cosmos DB databaskonto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-107">This model is very similar toohello firewall rules of a traditional database system and provides an additional level of security toohello Azure Cosmos DB database account.</span></span> <span data-ttu-id="1f7fe-108">Med den här modellen kan du nu konfigurera en Azure Cosmos DB databasen konto toobe endast nås från en godkänd uppsättning datorer eller molntjänster.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-108">With this model, you can now configure an Azure Cosmos DB database account toobe accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="1f7fe-109">Komma åt tooAzure Cosmos DB resurser från dessa godkända uppsättningar av datorer och tjänster kräver fortfarande hello anroparen toopresent en giltig auktoriserings-token.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-109">Access tooAzure Cosmos DB resources from these approved sets of machines and services still require hello caller toopresent a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="1f7fe-110">IP-åtkomstkontroll: översikt</span><span class="sxs-lookup"><span data-stu-id="1f7fe-110">IP access control overview</span></span>
<span data-ttu-id="1f7fe-111">Ett konto för Azure DB som Cosmos-databasen är tillgänglig från offentliga internet som standard så länge hello begäran åtföljs av en giltig auktoriserings-token.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as hello request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="1f7fe-112">tooconfigure IP-policy-baserad åtkomstkontroll hello användaren måste ange hello uppsättning IP-adresser och IP-adressintervall i CIDR formuläret toobe inkluderad som hello tillåts lista över klientens IP-adresser för en viss databas-konto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-112">tooconfigure IP policy-based access control, hello user must provide hello set of IP addresses or IP address ranges in CIDR form toobe included as hello allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="1f7fe-113">När den här konfigurationen används blockeras alla begäranden från datorer utanför den här listan över tillåtna av hello-servern.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by hello server.</span></span>  <span data-ttu-id="1f7fe-114">hello anslutningen processchema för hello IP-baserad åtkomstkontroll är beskrivs i följande diagram hello.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-114">hello connection processing flow for hello IP-based access control is described in hello following diagram.</span></span>

![Diagram som visar hello anslutningsprocessen för IP-baserad åtkomstkontroll](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="1f7fe-116">Anslutningar från molntjänster</span><span class="sxs-lookup"><span data-stu-id="1f7fe-116">Connections from cloud services</span></span>
<span data-ttu-id="1f7fe-117">I Azure är cloud services ett mycket vanligt sätt som värd för tjänsten mellannivålogik med hjälp av Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="1f7fe-118">tooenable åtkomst tooan Azure Cosmos DB databaskonto från en molnbaserad tjänst hello offentliga IP-adressen för hello Molntjänsten måste vara tillagda toohello tillåts lista över IP-adresser som är associerade med din Azure Cosmos DB databaskonto av [konfigurera Hej IP-princip för åtkomstkontroll](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="1f7fe-118">tooenable access tooan Azure Cosmos DB database account from a cloud service, hello public IP address of hello cloud service must be added toohello allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="1f7fe-119">Detta säkerställer att alla rollinstanser molntjänster åtkomst tooyour Azure Cosmos DB konto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-119">This ensures that all role instances of cloud services have access tooyour Azure Cosmos DB database account.</span></span> <span data-ttu-id="1f7fe-120">Du kan hämta IP-adresser för dina molntjänster i hello Azure-portalen som visas i följande skärmbild hello.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-120">You can retrieve IP addresses for your cloud services in hello Azure portal, as shown in hello following screenshot.</span></span>

![Skärmbild som visar hello offentliga IP-adressen för en molnbaserad tjänst som visas i hello Azure-portalen](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="1f7fe-122">När du skalar upp din molntjänst genom att lägga till ytterligare rollen instanser har de nya instanserna automatiskt databasen åtkomstkonto toohello Azure Cosmos DB eftersom de är en del av hello samma molntjänst.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access toohello Azure Cosmos DB database account since they are part of hello same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="1f7fe-123">Anslutningar från virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="1f7fe-123">Connections from virtual machines</span></span>
<span data-ttu-id="1f7fe-124">[Virtuella datorer](https://azure.microsoft.com/services/virtual-machines/) eller [skalningsuppsättningar i virtuella](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) kan också vara används toohost mellannivå tjänster med hjälp av Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used toohost middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="1f7fe-125">tooconfigure hello Azure Cosmos DB konto tooallow dataåtkomst från virtuella datorer, offentliga IP-adresser för virtuell dator och/eller virtuella datorn måste vara konfigurerad som en hello tillåtna IP-adresser för dina Azure Cosmos DB databaskonto av [Konfigurera princip för åtkomstkontroll för hello IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="1f7fe-125">tooconfigure hello Azure Cosmos DB database account tooallow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of hello allowed IP addresses for your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="1f7fe-126">Du kan hämta IP-adresser för virtuella datorer i hello Azure-portalen som visas i följande skärmbild hello.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-126">You can retrieve IP addresses for virtual machines in hello Azure portal, as shown in hello following screenshot.</span></span>

![Skärmbild som visar en offentlig IP-adress för en virtuell dator visas i hello Azure-portalen](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="1f7fe-128">När du lägger till ytterligare virtuella instanser toohello gruppen finns de automatiskt åtkomst tooyour Azure Cosmos DB konto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-128">When you add additional virtual machine instances toohello group, they are automatically provided access tooyour Azure Cosmos DB database account.</span></span>

## <a name="connections-from-hello-internet"></a><span data-ttu-id="1f7fe-129">Anslutningar från hello internet</span><span class="sxs-lookup"><span data-stu-id="1f7fe-129">Connections from hello internet</span></span>
<span data-ttu-id="1f7fe-130">När du åtkomst till en Azure-Cosmos-DB databasen konto från en dator på hello internet, vara hello klientens IP-adress eller IP-adressintervall för hello datorn tillagda toohello tillåts lista över IP-adress för hello Azure Cosmos DB databaskonto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-130">When you access an Azure Cosmos DB database account from a computer on hello internet, hello client IP address or IP address range of hello machine must be added toohello allowed list of IP address for hello Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="1f7fe-131"><a id="configure-ip-policy"></a>Konfigurera princip för åtkomstkontroll för hello IP</span><span class="sxs-lookup"><span data-stu-id="1f7fe-131"><a id="configure-ip-policy"></a> Configuring hello IP access control policy</span></span>
<span data-ttu-id="1f7fe-132">princip för åtkomstkontroll för hello IP kan anges i hello Azure-portalen eller programmässigt via [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), eller hello [REST API](/rest/api/documentdb/) genom att uppdatera hello `ipRangeFilter` egenskapen.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-132">hello IP access control policy can be set in hello Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or hello [REST API](/rest/api/documentdb/) by updating hello `ipRangeFilter` property.</span></span> <span data-ttu-id="1f7fe-133">IP-adressintervall måste vara kommatecken avgränsade och får inte innehålla blanksteg.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="1f7fe-134">Exempel: ”13.91.6.132,13.91.6.1/24”.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="1f7fe-135">När du uppdaterar din databaskonto via metoderna, vara säker på att toopopulate alla hello egenskaper tooprevent återställer toodefault inställningar.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-135">When updating your database account through these methods, be sure toopopulate all of hello properties tooprevent resetting toodefault settings.</span></span>

> [!NOTE]
> <span data-ttu-id="1f7fe-136">Genom att aktivera en IP-principer för åtkomstkontroll för din Azure Cosmos DB databaskonto tillåts alla åtkomst tooyour Azure Cosmos DB databaskonto från datorer utanför hello konfigurerad lista med IP-adressintervall blockeras.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="1f7fe-137">Tack vare den här modellen kommer surfning hello data plan åtgärden från hello portal också att blockerade tooensure hello integriteten för åtkomstkontroll.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-137">By virtue of this model, browsing hello data plane operation from hello portal will also be blocked tooensure hello integrity of access control.</span></span>

<span data-ttu-id="1f7fe-138">toosimplify utveckling hello Azure-portalen hjälper dig att identifiera och lägga till hello IP för din klient datorn toohello tillåts lista, så att appar som körs på datorn kan komma åt hello Azure DB som Cosmos-konto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-138">toosimplify development, hello Azure portal helps you identify and add hello IP of your client machine toohello allowed list, so that apps running your machine can access hello Azure Cosmos DB account.</span></span> <span data-ttu-id="1f7fe-139">Observera att hello klientens IP-adress här har identifierats som visas av hello-portalen.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-139">Note that hello client IP address here is detected as seen by hello portal.</span></span> <span data-ttu-id="1f7fe-140">Det kan vara hello klientens IP-adress för datorn, men det kan också vara hello IP-adressen för din nätverks-gateway.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-140">It may be hello client IP address of your machine, but it could also be hello IP address of your network gateway.</span></span> <span data-ttu-id="1f7fe-141">Glöm inte tooremove före den pågående tooproduction.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-141">Do not forget tooremove it before going tooproduction.</span></span>

<span data-ttu-id="1f7fe-142">tooset hello IP-princip för åtkomstkontroll i hello Azure-portalen navigera toohello Azure DB som Cosmos-kontoblad klickar du på **brandväggen** i navigeringsmenyn hello Klicka **ON**</span><span class="sxs-lookup"><span data-stu-id="1f7fe-142">tooset hello IP access control policy in hello Azure portal, navigate toohello Azure Cosmos DB account blade, click **Firewall** in hello navigation menu, then click **ON**</span></span> 

![Skärmbild som visar hur tooopen hello brandväggen bladet i hello Azure-portalen](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="1f7fe-144">I hello nya rutan, anger du om hello Azure-portalen kan komma åt hello konto och lägga till andra adresser och intervall efter behov och sedan klickar du på **spara**.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-144">In hello new pane, specify whether hello Azure portal can access hello account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="1f7fe-145">När du aktiverar en IP-principer för åtkomstkontroll, behöver du tooadd hello IP-adress för hello Azure portal toomaintain åtkomst.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-145">When you enable an IP access control policy, you need tooadd hello IP address for hello Azure portal toomaintain access.</span></span> <span data-ttu-id="1f7fe-146">hello portal IP-adresser är:</span><span class="sxs-lookup"><span data-stu-id="1f7fe-146">hello portal IP addresses are:</span></span>
> |<span data-ttu-id="1f7fe-147">Region</span><span class="sxs-lookup"><span data-stu-id="1f7fe-147">Region</span></span>|<span data-ttu-id="1f7fe-148">IP-adress</span><span class="sxs-lookup"><span data-stu-id="1f7fe-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="1f7fe-149">Alla regioner utom de som anges nedan</span><span class="sxs-lookup"><span data-stu-id="1f7fe-149">All regions except those specified below</span></span>| <span data-ttu-id="1f7fe-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="1f7fe-150">104.42.195.92</span></span>|
> |<span data-ttu-id="1f7fe-151">Tyskland</span><span class="sxs-lookup"><span data-stu-id="1f7fe-151">Germany</span></span>|<span data-ttu-id="1f7fe-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="1f7fe-152">51.4.229.218</span></span>|
> |<span data-ttu-id="1f7fe-153">Kina</span><span class="sxs-lookup"><span data-stu-id="1f7fe-153">China</span></span>|<span data-ttu-id="1f7fe-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="1f7fe-154">139.217.8.252</span></span>|
> |<span data-ttu-id="1f7fe-155">Arizona (USA-förvaltad region)</span><span class="sxs-lookup"><span data-stu-id="1f7fe-155">US Gov Arizona</span></span>|<span data-ttu-id="1f7fe-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="1f7fe-156">52.244.48.71</span></span>|
>

![Skärmbild som visar en hur tooconfigure brandväggens inställningar i hello Azure-portalen](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a><span data-ttu-id="1f7fe-158">Felsöka hello IP-princip för åtkomstkontroll</span><span class="sxs-lookup"><span data-stu-id="1f7fe-158">Troubleshooting hello IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="1f7fe-159">Portalen åtgärder</span><span class="sxs-lookup"><span data-stu-id="1f7fe-159">Portal operations</span></span>
<span data-ttu-id="1f7fe-160">Genom att aktivera en IP-principer för åtkomstkontroll för din Azure Cosmos DB databaskonto tillåts alla åtkomst tooyour Azure Cosmos DB databaskonto från datorer utanför hello konfigurerad lista med IP-adressintervall blockeras.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="1f7fe-161">Om du vill tooenable portal plan dataåtgärder som surfning samlingar och dokument i frågan, måste du därför tooexplicitly Tillåt Azure portal åtkomst med hjälp av hello **brandväggen** bladet i hello portal.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-161">Therefore if you want tooenable portal data plane operations like browsing collections and query documents, you need tooexplicitly allow Azure portal access using hello **Firewall** blade in hello portal.</span></span> 

![Skärmbild som visar en hur tooenable åtkomst toohello Azure-portalen](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="1f7fe-163">SDK & Rest API</span><span class="sxs-lookup"><span data-stu-id="1f7fe-163">SDK & Rest API</span></span>
<span data-ttu-id="1f7fe-164">För säkerhetsskäl åtkomst via SDK eller REST-API från datorer som inte finns på listan över tillåtna hello returneras ett allmänt 404 gick inte att hitta svar utan ytterligare information.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-164">For security reasons, access via SDK or REST API from machines not on hello allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="1f7fe-165">Kontrollera hello IP tillåts lista som konfigurerats för din Azure Cosmos DB databasen tooensure hello rätt princip kontokonfiguration tillämpade tooyour Azure Cosmos DB konto.</span><span class="sxs-lookup"><span data-stu-id="1f7fe-165">Please verify hello IP allowed list configured for your Azure Cosmos DB database account tooensure hello correct policy configuration is applied tooyour Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1f7fe-166">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="1f7fe-166">Next steps</span></span>
<span data-ttu-id="1f7fe-167">Information om nätverk prestandatips finns [prestandatips](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="1f7fe-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

