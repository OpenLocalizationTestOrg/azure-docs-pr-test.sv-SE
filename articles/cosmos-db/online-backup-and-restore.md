---
title: "Online säkerhetskopiering och återställning med Azure Cosmos DB | Microsoft Docs"
description: "Lär dig mer om att utföra automatisk säkerhetskopiering och återställning i en Azure Cosmos-DB-databas."
keywords: "säkerhetskopiering och återställning, säkerhetskopiering online"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="474fa-104">Automatisk online säkerhetskopiering och återställning med Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="474fa-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="474fa-105">Azure Cosmos-DB tar automatiskt säkerhetskopior av dina data med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="474fa-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="474fa-106">Automatisk säkerhetskopiering tas utan att påverka prestanda eller tillgänglighet för dina databasåtgärder.</span><span class="sxs-lookup"><span data-stu-id="474fa-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="474fa-107">Alla säkerhetskopior lagras separat i en annan storage-tjänst och dessa säkerhetskopieringar replikeras globalt för återhämtning mot regionala katastrofer.</span><span class="sxs-lookup"><span data-stu-id="474fa-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="474fa-108">Automatisk säkerhetskopiering är avsedda för situationer när du av misstag tar bort Comos DB-behållaren och senare behöver återställa data eller en lösning för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="474fa-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="474fa-109">Den här artikeln börjar med en snabb sammanfattning dataredundans och tillgänglighet i Cosmos-DB och beskriver säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="474fa-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="474fa-110">Hög tillgänglighet med Cosmos-DB - en sammanfattning</span><span class="sxs-lookup"><span data-stu-id="474fa-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="474fa-111">Cosmos DB är avsedd att vara [globalt distribuerade](distribute-data-globally.md) – du kan skala genomströmning över flera Azure-regioner tillsammans med principen som drivs redundans och transparent flera API: er.</span><span class="sxs-lookup"><span data-stu-id="474fa-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="474fa-112">Som en databas för datalagring [99,99% tillgänglighet SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db), alla skrivningar i Cosmos DB genomförs varaktigt till lokala diskar genom att ett kvorum av replikerna i ett lokalt Datacenter innan bekräftades till klienten.</span><span class="sxs-lookup"><span data-stu-id="474fa-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="474fa-113">Observera att den höga tillgängligheten för Cosmos DB förlitar sig på lokal lagring och inte är beroende av någon extern lagringstekniker.</span><span class="sxs-lookup"><span data-stu-id="474fa-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="474fa-114">Dessutom, om ditt konto är kopplat till mer än en Azure-region, replikeras din skrivningar samt andra regioner.</span><span class="sxs-lookup"><span data-stu-id="474fa-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="474fa-115">Om du vill skala din genomflöde och komma åt data på låg latens, kan du ha många läsa regioner som är kopplad till ditt konto som du vill.</span><span class="sxs-lookup"><span data-stu-id="474fa-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="474fa-116">I varje skrivskyddade region sparas varaktigt (replikerade) data i en replik.</span><span class="sxs-lookup"><span data-stu-id="474fa-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="474fa-117">Enligt beskrivningen i följande diagram, en enskild Cosmos-DB-behållare är [vågrätt partitionerade](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="474fa-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="474fa-118">En ”partition” markeras med en cirkel i följande diagram och varje partition görs högtillgänglig via en replik.</span><span class="sxs-lookup"><span data-stu-id="474fa-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="474fa-119">Det här är den lokala distributionsplatsen i ett enda Azure-region (betecknas med X-axeln).</span><span class="sxs-lookup"><span data-stu-id="474fa-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="474fa-120">Dessutom kan distribueras varje partition (med dess motsvarande replikuppsättningen) sedan globalt över flera regioner som är kopplad till ditt konto (till exempel i den här bilden till tre regioner – östra USA, västra USA och centrala Indien).</span><span class="sxs-lookup"><span data-stu-id="474fa-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="474fa-121">”Ange partitionen” är ett globalt distribuerade entitet som består av flera kopior av dina data i varje region (betecknas med Y-axeln).</span><span class="sxs-lookup"><span data-stu-id="474fa-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="474fa-122">Du kan tilldela prioritet till de regioner som är kopplad till ditt konto och Cosmos DB att transparent redundansväxla till nästa område händelse av katastrof.</span><span class="sxs-lookup"><span data-stu-id="474fa-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="474fa-123">Du kan också manuellt simulerar redundans för att testa tillgängligheten för slutpunkt till slutpunkt för ditt program.</span><span class="sxs-lookup"><span data-stu-id="474fa-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="474fa-124">Följande bild illustrerar hög grad av redundans med Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="474fa-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![Hög grad av redundans med Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Hög grad av redundans med Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="474fa-127">Fullständig, automatisk, online-säkerhetskopieringar</span><span class="sxs-lookup"><span data-stu-id="474fa-127">Full, automatic, online backups</span></span>
<span data-ttu-id="474fa-128">OJ, bort jag min behållare eller databasen!</span><span class="sxs-lookup"><span data-stu-id="474fa-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="474fa-129">Med Cosmos DB, inte bara data, men säkerhetskopior av dina data görs också mycket överflödiga och flexibel till regionala katastrofer.</span><span class="sxs-lookup"><span data-stu-id="474fa-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="474fa-130">Dessa säkerhetskopior av automatiserad tas för närvarande cirka var fjärde timme och lagras senaste 2 säkerhetskopior vid alla tidpunkter.</span><span class="sxs-lookup"><span data-stu-id="474fa-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="474fa-131">Om data är av misstag tas bort eller är skadad, kontrollera [kontakta Azure-supporten](https://azure.microsoft.com/support/options/) inom 8 timmar.</span><span class="sxs-lookup"><span data-stu-id="474fa-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="474fa-132">Säkerhetskopieringar tas utan att påverka prestanda eller tillgänglighet för dina databasåtgärder.</span><span class="sxs-lookup"><span data-stu-id="474fa-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="474fa-133">Cosmos DB tar säkerhetskopian i bakgrunden utan att använda din etablerade RUs eller påverka prestandan och utan att påverka tillgängligheten för din databas.</span><span class="sxs-lookup"><span data-stu-id="474fa-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="474fa-134">Till skillnad från dina data som lagras i Cosmos DB lagras automatiska säkerhetskopieringar i Azure Blob Storage-tjänst.</span><span class="sxs-lookup"><span data-stu-id="474fa-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="474fa-135">Om du vill garantera låg latens/effektiv överföring överförs ögonblicksbilden av säkerhetskopian till en instans av Azure Blob storage i samma region som det aktuella skrivning den regionen där din Cosmos-DB-databaskonto.</span><span class="sxs-lookup"><span data-stu-id="474fa-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="474fa-136">För återhämtning mot regionala replikeras igen varje ögonblicksbild av dina säkerhetskopierade data i Azure Blob Storage via geo-redundant lagring (GRS) till en annan region.</span><span class="sxs-lookup"><span data-stu-id="474fa-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="474fa-137">Följande diagram visar att hela Cosmos-DB-behållaren (med alla tre primära partitioner i västra USA i det här exemplet) säkerhetskopieras i en fjärransluten Azure Blob Storage-konto i USA, västra och sedan GRS replikeras till östra USA.</span><span class="sxs-lookup"><span data-stu-id="474fa-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="474fa-138">Följande bild illustrerar periodiska fullständiga säkerhetskopieringar för alla Cosmos-DB-enheter i GRS Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="474fa-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Periodiska fullständiga säkerhetskopieringar för alla Cosmos-DB-enheter i Azure Storage för GRS](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="474fa-140">Period för lagring av säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="474fa-140">Backup retention period</span></span>
<span data-ttu-id="474fa-141">Enligt beskrivningen ovan Azure Cosmos DB tar ögonblicksbilder av data var fjärde timme och behåller de senaste två ögonblicksbilderna av varje partition i 30 dagar.</span><span class="sxs-lookup"><span data-stu-id="474fa-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="474fa-142">Per våra förordningar rensas ögonblicksbilder efter 90 dagar.</span><span class="sxs-lookup"><span data-stu-id="474fa-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="474fa-143">Om du vill att underhålla din egen ögonblicksbilder, du kan använda export till JSON-alternativet i Azure Cosmos DB [datamigreringsverktyget](import-data.md#export-to-json-file) att schemalägga ytterligare säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="474fa-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="474fa-144">Återställa en databas från en onlinesäkerhetskopiering</span><span class="sxs-lookup"><span data-stu-id="474fa-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="474fa-145">Om du av misstag tar bort den databas eller en samling kan du [filen ett supportärende](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) eller [kontakta Azure support](https://azure.microsoft.com/support/options/) att återställa data från den senaste automatiska säkerhetskopieringen.</span><span class="sxs-lookup"><span data-stu-id="474fa-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="474fa-146">Om du behöver återställa databasen på grund av att data skadas problemet, se [hantering datafel](#handling-data-corruption) som du måste vidta ytterligare åtgärder för att förhindra att skadade data leds genom säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="474fa-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="474fa-147">För en specifik ögonblicksbild av säkerhetskopian ska återställas kräver Cosmos DB att data var tillgängliga under säkerhetskopiering för den ögonblicksbilden.</span><span class="sxs-lookup"><span data-stu-id="474fa-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="474fa-148">Hantering av skadade data</span><span class="sxs-lookup"><span data-stu-id="474fa-148">Handling data corruption</span></span>
<span data-ttu-id="474fa-149">Azure Cosmos-DB behåller senaste två säkerhetskopieringar för varje partition i systemet.</span><span class="sxs-lookup"><span data-stu-id="474fa-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="474fa-150">Den här modellen fungerar mycket bra när en behållare (insamling av dokument, diagram, tabell) eller en databas oavsiktligt tas bort eftersom en av de senaste versionerna kan återställas.</span><span class="sxs-lookup"><span data-stu-id="474fa-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="474fa-151">Men i fall när när ett problem med skadade data kan innebära att användare, Azure Cosmos DB kan vara ovetande om skadade data och det är möjligt att skadan kan ha genombryts säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="474fa-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="474fa-152">Så snart skadad är, bör du ta bort behållaren skadat (tabell-samling/diagram) så att säkerhetskopieringar skyddas från att skrivas över med skadade data.</span><span class="sxs-lookup"><span data-stu-id="474fa-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="474fa-153">Sedan den senaste säkerhetskopieringen kan vara fyra timmar, användaren kan använda [ändra feed](change-feed.md) att avbilda och lagra de sista fyra timmarna värt data innan du tar bort behållaren.</span><span class="sxs-lookup"><span data-stu-id="474fa-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="474fa-154">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="474fa-154">Next steps</span></span>

<span data-ttu-id="474fa-155">Om du vill replikera databasen i flera datacenter, se [distribuera dina data globalt med Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="474fa-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="474fa-156">Filen kontakta Azure-Support, [filen en biljett från Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="474fa-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

