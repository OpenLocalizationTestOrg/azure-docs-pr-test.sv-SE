---
title: "aaaOnline säkerhetskopiering och återställning med Azure Cosmos DB | Microsoft Docs"
description: "Lär dig hur tooperform automatisk säkerhetskopiering och återställning i en Azure Cosmos-DB-databas."
keywords: "säkerhetskopiering och återställning, säkerhetskopiering online"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: a0b464c95681dfc7b5462b02bf04c2c43d6bc16f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="448cf-104">Automatisk online säkerhetskopiering och återställning med Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="448cf-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="448cf-105">Azure Cosmos-DB tar automatiskt säkerhetskopior av dina data med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="448cf-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="448cf-106">hello automatiska säkerhetskopieringar tas utan att påverka hello prestanda eller tillgänglighet för dina databasåtgärder.</span><span class="sxs-lookup"><span data-stu-id="448cf-106">hello automatic backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="448cf-107">Alla säkerhetskopior lagras separat i en annan storage-tjänst och dessa säkerhetskopieringar replikeras globalt för återhämtning mot regionala katastrofer.</span><span class="sxs-lookup"><span data-stu-id="448cf-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="448cf-108">hello automatisk säkerhetskopiering är avsedda för situationer när du av misstag tar bort Comos DB-behållaren och senare behöver återställa data eller en lösning för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="448cf-108">hello automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="448cf-109">Den här artikeln börjar med en snabb sammanfattning hello dataredundans och tillgänglighet i Cosmos-DB och beskriver säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="448cf-109">This article starts with a quick recap of hello data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="448cf-110">Hög tillgänglighet med Cosmos-DB - en sammanfattning</span><span class="sxs-lookup"><span data-stu-id="448cf-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="448cf-111">Cosmos DB är utformad toobe [globalt distribuerade](distribute-data-globally.md) – möjliggör dessutom tooscale genomströmning över flera Azure-regioner tillsammans med principen som drivs redundans och transparent flera API: er.</span><span class="sxs-lookup"><span data-stu-id="448cf-111">Cosmos DB is designed toobe [globally distributed](distribute-data-globally.md) – it allows you tooscale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="448cf-112">Som en databas för datalagring [99,99% tillgänglighet SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db), alla hello skrivningar i Cosmos-databasen är varaktigt allokerat toolocal diskar genom att ett kvorum av replikerna i ett lokalt Datacenter innan bekräftades toohello klienten.</span><span class="sxs-lookup"><span data-stu-id="448cf-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all hello writes in Cosmos DB are durably committed toolocal disks by a quorum of replicas within a local data center before acknowledging toohello client.</span></span> <span data-ttu-id="448cf-113">Observera att hello hög tillgänglighet för Cosmos DB förlitar sig på lokal lagring och inte är beroende av någon extern lagringstekniker.</span><span class="sxs-lookup"><span data-stu-id="448cf-113">Note that hello high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="448cf-114">Dessutom, om ditt konto är kopplat till mer än en Azure-region, replikeras din skrivningar samt andra regioner.</span><span class="sxs-lookup"><span data-stu-id="448cf-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="448cf-115">tooscale genomflöde och åtkomst till data på låg latens, du kan använda så många läsa regioner som är kopplad till ditt konto som du vill.</span><span class="sxs-lookup"><span data-stu-id="448cf-115">tooscale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="448cf-116">I varje skrivskyddade region sparas varaktigt hello (replikerad) data i en replik.</span><span class="sxs-lookup"><span data-stu-id="448cf-116">In each read region, hello (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="448cf-117">Enligt beskrivningen i följande diagram hello en enskild Cosmos-DB-behållare är [vågrätt partitionerade](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="448cf-117">As illustrated in hello following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="448cf-118">En ”partition” markeras med en cirkel i följande diagram hello och varje partition görs högtillgänglig via en replikuppsättning.</span><span class="sxs-lookup"><span data-stu-id="448cf-118">A “partition” is denoted by a circle in hello following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="448cf-119">Detta är hello lokala distributionsplatser i ett enda Azure-region (betecknas med hello X-axeln).</span><span class="sxs-lookup"><span data-stu-id="448cf-119">This is hello local distribution within a single Azure region (denoted by hello X axis).</span></span> <span data-ttu-id="448cf-120">Dessutom kan distribueras varje partition (med dess motsvarande replikuppsättningen) sedan globalt över flera regioner som är kopplad till ditt konto (till exempel i den här bilden hello tre regioner – östra USA, västra USA och centrala Indien).</span><span class="sxs-lookup"><span data-stu-id="448cf-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration hello three regions – East US, West US and Central India).</span></span> <span data-ttu-id="448cf-121">Hej ”partition ange” är ett globalt distribuerade entitet som består av flera kopior av dina data i varje region (betecknas med hello Y-axeln).</span><span class="sxs-lookup"><span data-stu-id="448cf-121">hello “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by hello Y axis).</span></span> <span data-ttu-id="448cf-122">Du kan tilldela prioritet toohello regioner som är kopplad till ditt konto och Cosmos DB kommer transparent redundans toohello nästa område händelse av katastrof.</span><span class="sxs-lookup"><span data-stu-id="448cf-122">You can assign priority toohello regions associated with your database account and Cosmos DB will transparently failover toohello next region in case of disaster.</span></span> <span data-ttu-id="448cf-123">Du kan också manuellt simulera redundans tootest hello slutpunkt till slutpunkt tillgängligheten för ditt program.</span><span class="sxs-lookup"><span data-stu-id="448cf-123">You can also manually simulate failover tootest hello end-to-end availability of your application.</span></span>  

<span data-ttu-id="448cf-124">hello illustrerar följande bild hello hög grad av redundans med Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="448cf-124">hello following image illustrates hello high degree of redundancy with Cosmos DB.</span></span>

![Hög grad av redundans med Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Hög grad av redundans med Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="448cf-127">Fullständig, automatisk, online-säkerhetskopieringar</span><span class="sxs-lookup"><span data-stu-id="448cf-127">Full, automatic, online backups</span></span>
<span data-ttu-id="448cf-128">OJ, bort jag min behållare eller databasen!</span><span class="sxs-lookup"><span data-stu-id="448cf-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="448cf-129">Med Cosmos DB görs också mycket överflödiga och flexibel tooregional katastrofer i inte bara din data, men hello säkerhetskopior av dina data.</span><span class="sxs-lookup"><span data-stu-id="448cf-129">With Cosmos DB, not only your data, but hello backups of your data are also made highly redundant and resilient tooregional disasters.</span></span> <span data-ttu-id="448cf-130">Dessa säkerhetskopior av automatiserad tas för närvarande cirka var fjärde timme och lagras senaste 2 säkerhetskopior vid alla tidpunkter.</span><span class="sxs-lookup"><span data-stu-id="448cf-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="448cf-131">Om hello data av misstag tas bort eller är skadad, kontrollera [kontakta Azure-supporten](https://azure.microsoft.com/support/options/) inom 8 timmar.</span><span class="sxs-lookup"><span data-stu-id="448cf-131">If hello data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="448cf-132">hello säkerhetskopieringar tas utan att påverka hello prestanda eller tillgänglighet för dina databasåtgärder.</span><span class="sxs-lookup"><span data-stu-id="448cf-132">hello backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="448cf-133">Cosmos DB tar hello säkerhetskopiering i hello bakgrunden utan att använda din etablerade RUs eller påverka hello prestanda och utan att påverka hello tillgängligheten för din databas.</span><span class="sxs-lookup"><span data-stu-id="448cf-133">Cosmos DB takes hello backup in hello background without consuming your provisioned RUs or affecting hello performance and without affecting hello availability of your database.</span></span> 

<span data-ttu-id="448cf-134">Till skillnad från dina data som lagras i Cosmos DB lagras hello automatiska säkerhetskopior i Azure Blob Storage-tjänst.</span><span class="sxs-lookup"><span data-stu-id="448cf-134">Unlike your data that is stored inside Cosmos DB, hello automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="448cf-135">tooguarantee hello låg latens/effektiv överföring hello ögonblicksbilden av säkerhetskopian är överförda tooan instans av Azure Blob storage i samma region som hello aktuella skrivåtgärder region där din Cosmos-DB-databaskonto hello.</span><span class="sxs-lookup"><span data-stu-id="448cf-135">tooguarantee hello low latency/efficient upload, hello snapshot of your backup is uploaded tooan instance of Azure Blob storage in hello same region as hello current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="448cf-136">För återhämtning mot regionala replikeras igen varje ögonblicksbild av dina säkerhetskopierade data i Azure Blob Storage via geo-redundant lagring (GRS) tooanother region.</span><span class="sxs-lookup"><span data-stu-id="448cf-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) tooanother region.</span></span> <span data-ttu-id="448cf-137">hello följande diagram visar att hello hela Cosmos-DB-behållaren (med alla tre primära partitioner i västra USA i det här exemplet) säkerhetskopieras i en fjärransluten Azure Blob Storage-konto i USA, västra och sedan GRS replikeras tooEast oss.</span><span class="sxs-lookup"><span data-stu-id="448cf-137">hello following diagram shows that hello entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated tooEast US.</span></span> 

<span data-ttu-id="448cf-138">hello illustrerar följande bild periodiska fullständiga säkerhetskopieringar för alla Cosmos-DB-enheter i GRS Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="448cf-138">hello following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Periodiska fullständiga säkerhetskopieringar för alla Cosmos-DB-enheter i Azure Storage för GRS](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="448cf-140">Period för lagring av säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="448cf-140">Backup retention period</span></span>
<span data-ttu-id="448cf-141">Enligt beskrivningen ovan Azure Cosmos DB tar ögonblicksbilder av data var fjärde timme och behåller hello två sista ögonblicksbilder av varje partition i 30 dagar.</span><span class="sxs-lookup"><span data-stu-id="448cf-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains hello last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="448cf-142">Per våra förordningar rensas ögonblicksbilder efter 90 dagar.</span><span class="sxs-lookup"><span data-stu-id="448cf-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="448cf-143">Om du vill toomaintain egna ögonblicksbilder, du kan använda hello exportalternativ tooJSON i hello Azure Cosmos DB [datamigreringsverktyget](import-data.md#export-to-json-file) tooschedule ytterligare säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="448cf-143">If you want toomaintain your own snapshots, you can use hello export tooJSON option in hello Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) tooschedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="448cf-144">Återställa en databas från en onlinesäkerhetskopiering</span><span class="sxs-lookup"><span data-stu-id="448cf-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="448cf-145">Om du av misstag tar bort den databas eller en samling kan du [filen ett supportärende](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) eller [kontakta Azure support](https://azure.microsoft.com/support/options/) toorestore hello data från hello senaste automatisk säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="448cf-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) toorestore hello data from hello last automatic backup.</span></span> <span data-ttu-id="448cf-146">Om du behöver toorestore databasen på grund av att data skadas problemet, se [hantering datafel](#handling-data-corruption) som du behöver tootake ytterligare steg tooprevent hello skadade data från inträngande hello säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="448cf-146">If you need toorestore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need tootake additional steps tooprevent hello corrupted data from penetrating hello backups.</span></span> <span data-ttu-id="448cf-147">För en specifik ögonblicksbild av din backup toobe återställts kräver Cosmos DB hello data var tillgänglig för hello varaktighet hello säkerhetskopiering för den ögonblicksbilden.</span><span class="sxs-lookup"><span data-stu-id="448cf-147">For a specific snapshot of your backup toobe restored, Cosmos DB requires that hello data was available for hello duration of hello backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="448cf-148">Hantering av skadade data</span><span class="sxs-lookup"><span data-stu-id="448cf-148">Handling data corruption</span></span>
<span data-ttu-id="448cf-149">Azure Cosmos-DB behåller hello senaste två säkerhetskopieringar för varje partition i hello system.</span><span class="sxs-lookup"><span data-stu-id="448cf-149">Azure Cosmos DB retains hello last two backups of every partition in hello system.</span></span> <span data-ttu-id="448cf-150">Den här modellen fungerar mycket bra när en behållare (insamling av dokument, diagram, tabell) eller en databas oavsiktligt tas bort eftersom en av hello senaste versioner kan återställas.</span><span class="sxs-lookup"><span data-stu-id="448cf-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of hello last versions can be restored.</span></span> <span data-ttu-id="448cf-151">Dock i hello kan om när ett problem med skadade data kan innebära att användare, Azure Cosmos DB kan vara ovetande om hello datafel och det är möjligt att hello skadas ha genombryts hello säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="448cf-151">However, in hello case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of hello data corruption, and it is possible that hello corruption may have penetrated hello backups.</span></span> <span data-ttu-id="448cf-152">Så snart skadad är, bör du ta bort hello skadad behållare (tabell-samling/diagram) så att säkerhetskopieringar skyddas från att skrivas över med skadade data.</span><span class="sxs-lookup"><span data-stu-id="448cf-152">As soon as corruption is detected, you should delete hello corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="448cf-153">Eftersom hello senaste säkerhetskopiering kan vara fyra timmar gamla hello användare kan använda [ändra feed](change-feed.md) toocapture och lagra hello senaste fyra timmar värt data innan du tar bort hello behållare.</span><span class="sxs-lookup"><span data-stu-id="448cf-153">Since hello last backup could be four hours old, hello user can employ [change feed](change-feed.md) toocapture and store hello last four hours worth of data before deleting hello container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="448cf-154">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="448cf-154">Next steps</span></span>

<span data-ttu-id="448cf-155">tooreplicate databasen i flera datacenter, se [distribuera dina data globalt med Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="448cf-155">tooreplicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="448cf-156">toofile kontakta Azure-Support, [filen en biljett från hello Azure-portalen](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="448cf-156">toofile contact Azure Support, [file a ticket from hello Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

