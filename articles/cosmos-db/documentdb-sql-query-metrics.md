---
title: "aaaSQL fråga mätvärden för Azure Cosmos DB DocumentDB API | Microsoft Docs"
description: "Läs mer om hur tooinstrument och felsökningsloggar hello frågeprestanda för SQL Azure DB som Cosmos-begäranden."
keywords: "SQL-syntax, sql-fråga, sql-frågor, json-frågespråket, databasbegrepp och sql-frågor, mängdfunktioner"
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: 2fee3786b7d48d254162699471943e316764b003
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="a942b-104">Justera prestanda för frågor med Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="a942b-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="a942b-105">Azure Cosmos-DB tillhandahåller en [SQL API för datafrågor](documentdb-sql-query.md), utan att schemat eller sekundärindex.</span><span class="sxs-lookup"><span data-stu-id="a942b-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="a942b-106">Den här artikeln innehåller följande information för utvecklare hello:</span><span class="sxs-lookup"><span data-stu-id="a942b-106">This article provides hello following information for developers:</span></span>

* <span data-ttu-id="a942b-107">Utförlig information om hur fungerar Azure Cosmos DB SQL-frågan</span><span class="sxs-lookup"><span data-stu-id="a942b-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="a942b-108">Information om frågan begärande- och svarshuvuden och alternativ för klient-SDK</span><span class="sxs-lookup"><span data-stu-id="a942b-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="a942b-109">Tips och bästa praxis för prestanda för frågor</span><span class="sxs-lookup"><span data-stu-id="a942b-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="a942b-110">Exempel på hur tooutilize SQL körning statistik toodebug fråga prestanda</span><span class="sxs-lookup"><span data-stu-id="a942b-110">Examples of how tooutilize SQL execution statistics toodebug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="a942b-111">Om körning av SQL-fråga</span><span class="sxs-lookup"><span data-stu-id="a942b-111">About SQL query execution</span></span>

<span data-ttu-id="a942b-112">I Azure Cosmos DB du lagra data i behållare, som kan växa tooany [storlek eller begäran genomflödet](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="a942b-112">In Azure Cosmos DB, you store data in containers, which can grow tooany [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="a942b-113">Azure Cosmos-DB skalas sömlöst data över fysiska partitioner under hello omfattar toohandle datatillväxt eller ökning dataflöde.</span><span class="sxs-lookup"><span data-stu-id="a942b-113">Azure Cosmos DB seamlessly scales data across physical partitions under hello covers toohandle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="a942b-114">Du kan utfärda SQL-frågor tooany behållare med hello REST API eller en av hello stöds [DocumentDB SDK: er](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="a942b-114">You can issue SQL queries tooany container using hello REST API or one of hello supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="a942b-115">En kort översikt över partitionering: du anger en partitionsnyckel som ”stad”, som avgör hur data delas mellan fysiska partitioner.</span><span class="sxs-lookup"><span data-stu-id="a942b-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="a942b-116">Data som tillhör tooa enda partitionsnyckel (till exempel ”stad” == ”Seattle”) lagras i en fysiska partition, men en enda fysisk partition har vanligtvis flera partitionsnycklar.</span><span class="sxs-lookup"><span data-stu-id="a942b-116">Data belonging tooa single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="a942b-117">När en partition når lagringsstorlek hello service sömlöst delar hello partition i två nya partitioner och dividerar hello partitionsnyckel jämnt mellan dessa partitioner.</span><span class="sxs-lookup"><span data-stu-id="a942b-117">When a partition reaches its storage size, hello service seamlessly splits hello partition into two new partitions, and divides hello partition key evenly across these partitions.</span></span> <span data-ttu-id="a942b-118">Eftersom partitioner är tillfälligt använder hello API: er en abstraktion av en ”partitionsnyckelintervallet”, som anger hello intervallen för partition viktiga hashvärden.</span><span class="sxs-lookup"><span data-stu-id="a942b-118">Since partitions are transient, hello APIs use an abstraction of a "partition key range", which denotes hello ranges of partition key hashes.</span></span> 

<span data-ttu-id="a942b-119">När du skickar en fråga tooAzure Cosmos DB utför stegen logiska hello SDK:</span><span class="sxs-lookup"><span data-stu-id="a942b-119">When you issue a query tooAzure Cosmos DB, hello SDK performs these logical steps:</span></span>

* <span data-ttu-id="a942b-120">Parsa hello SQL-frågan toodetermine hello körning frågeplanen.</span><span class="sxs-lookup"><span data-stu-id="a942b-120">Parse hello SQL query toodetermine hello query execution plan.</span></span> 
* <span data-ttu-id="a942b-121">Om hello frågan innehåller ett filter mot hello partitionsnyckel, som `SELECT * FROM c WHERE c.city = "Seattle"`, är det routade tooa enkel partition.</span><span class="sxs-lookup"><span data-stu-id="a942b-121">If hello query includes a filter against hello partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed tooa single partition.</span></span> <span data-ttu-id="a942b-122">Om hello frågan har inte ett filter på partitionsnyckel, sedan den körs i alla partitioner och resultat kombineras på klientsidan.</span><span class="sxs-lookup"><span data-stu-id="a942b-122">If hello query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="a942b-123">hello frågan köras inom varje partition i serien eller parallell, baserat på klientens konfiguration.</span><span class="sxs-lookup"><span data-stu-id="a942b-123">hello query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="a942b-124">Inom varje partition hello fråga kan göra att en eller flera sändningar beroende på hello frågan komplexitet konfigurerad sidstorlek och etablerat dataflöde hello mängden.</span><span class="sxs-lookup"><span data-stu-id="a942b-124">Within each partition, hello query might make one or more round trips depending on hello query complexity, configured page size, and provisioned throughput of hello collection.</span></span> <span data-ttu-id="a942b-125">Varje körning returnerar hello antalet [programbegäran](request-units.md) används genom att köra frågor och eventuellt statistik för körning av frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-125">Each execution returns hello number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="a942b-126">hello SDK utför en sammanfattning av hello frågeresultat över partitioner.</span><span class="sxs-lookup"><span data-stu-id="a942b-126">hello SDK performs a summarization of hello query results across partitions.</span></span> <span data-ttu-id="a942b-127">Till exempel om hello fråga innehåller en ORDER BY över partitioner, är sedan resultaten från enskilda partitioner merge sorteras tooreturn resultat i globalt sorteringsordningen.</span><span class="sxs-lookup"><span data-stu-id="a942b-127">For example, if hello query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted tooreturn results in globally sorted order.</span></span> <span data-ttu-id="a942b-128">Om hello frågan är en samling som `COUNT`, hello från enskilda partitioner är samlade tooproduce hello övergripande antal.</span><span class="sxs-lookup"><span data-stu-id="a942b-128">If hello query is an aggregation like `COUNT`, hello counts from individual partitions are summed tooproduce hello overall count.</span></span>

<span data-ttu-id="a942b-129">hello SDK tillhandahåller olika alternativ för frågekörning.</span><span class="sxs-lookup"><span data-stu-id="a942b-129">hello SDKs provide various options for query execution.</span></span> <span data-ttu-id="a942b-130">Till exempel i .NET dessa alternativ är tillgängliga i hello `FeedOptions` klass.</span><span class="sxs-lookup"><span data-stu-id="a942b-130">For example, in .NET these options are available in hello `FeedOptions` class.</span></span> <span data-ttu-id="a942b-131">hello följande tabell beskrivs dessa alternativ och hur de påverkar körningstid för frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-131">hello following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="a942b-132">Alternativ</span><span class="sxs-lookup"><span data-stu-id="a942b-132">Option</span></span> | <span data-ttu-id="a942b-133">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="a942b-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="a942b-134">Du måste ange tootrue för alla frågor som kräver toobe som körs i mer än en partition.</span><span class="sxs-lookup"><span data-stu-id="a942b-134">Must be set tootrue for any query that requires toobe executed across more than one partition.</span></span> <span data-ttu-id="a942b-135">Det här är en explicit flaggan tooenable du toomake medvetna prestanda kompromisser under utveckling.</span><span class="sxs-lookup"><span data-stu-id="a942b-135">This is an explicit flag tooenable you toomake conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="a942b-136">Måste anges tootrue om du har valt att inte indexera, men ändå vill toorun hello frågan via en genomsökning.</span><span class="sxs-lookup"><span data-stu-id="a942b-136">Must be set tootrue if you have opted out of indexing, but want toorun hello query via a scan anyway.</span></span> <span data-ttu-id="a942b-137">Endast tillgängligt för indexering för hello begärt filter sökväg är inaktiverad.</span><span class="sxs-lookup"><span data-stu-id="a942b-137">Only applicable if indexing for hello requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="a942b-138">hello maximalt antal objekt tooreturn per serveranrop toohello server.</span><span class="sxs-lookup"><span data-stu-id="a942b-138">hello maximum number of items tooreturn per round trip toohello server.</span></span> <span data-ttu-id="a942b-139">Du kan låta hello server hantera hello antal objekt genom att ange för 1.</span><span class="sxs-lookup"><span data-stu-id="a942b-139">By setting too-1, you can let hello server manage hello number of items.</span></span> <span data-ttu-id="a942b-140">Eller så kan du sänka detta värde tooretrieve litet antal objekt per onödig kommunikation.</span><span class="sxs-lookup"><span data-stu-id="a942b-140">Or, you can lower this value tooretrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="a942b-141">Detta är ett alternativ för klientsidan och används toolimit hello minnesförbrukning när du utför cross-partition ORDER BY.</span><span class="sxs-lookup"><span data-stu-id="a942b-141">This is a client-side option, and used toolimit hello memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="a942b-142">Ett högre värde hjälper till att minska hello svarstiden för cross-partition sortering.</span><span class="sxs-lookup"><span data-stu-id="a942b-142">A higher value helps reduce hello latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="a942b-143">Hämtar eller anger hello antalet samtidiga åtgärder som körs på klientsidan under parallell frågekörning i hello Azure DocumentDB database-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="a942b-143">Gets or sets hello number of concurrent operations run client side during parallel query execution in hello Azure DocumentDB database service.</span></span> <span data-ttu-id="a942b-144">Ett positivt egenskapsvärde begränsar hello antal samtidiga åtgärder toohello ange värde.</span><span class="sxs-lookup"><span data-stu-id="a942b-144">A positive property value limits hello number of concurrent operations toohello set value.</span></span> <span data-ttu-id="a942b-145">Om den anges tooless än 0 beslutar hello system automatiskt hello antalet samtidiga åtgärder toorun.</span><span class="sxs-lookup"><span data-stu-id="a942b-145">If it is set tooless than 0, hello system automatically decides hello number of concurrent operations toorun.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="a942b-146">Aktiverar detaljerad loggning av statistik tid som ägnats åt olika faser i Frågekörningen som kompileringstid, indexet loop tid och dokument laddas gång.</span><span class="sxs-lookup"><span data-stu-id="a942b-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="a942b-147">Utdata från frågan statistik kan du dela med Azure-supporten toodiagnose frågan prestandaproblem.</span><span class="sxs-lookup"><span data-stu-id="a942b-147">You can share output from query statistics with Azure Support toodiagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="a942b-148">Du kan återuppta körning av fråga genom att passera i täckande hello fortsättningstoken som returnerades av en fråga.</span><span class="sxs-lookup"><span data-stu-id="a942b-148">You can resume query execution by passing in hello opaque continuation token returned by any query.</span></span> <span data-ttu-id="a942b-149">Hej fortsättningstoken kapslar in alla tillstånd som krävs för frågekörning.</span><span class="sxs-lookup"><span data-stu-id="a942b-149">hello continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="a942b-150">Du kan begränsa hello maxstorleken för hello fortsättningstoken som returnerades av hello-servern.</span><span class="sxs-lookup"><span data-stu-id="a942b-150">You can limit hello maximum size of hello continuation token returned by hello server.</span></span> <span data-ttu-id="a942b-151">Du kan behöva tooset detta om din programvärden har gränser för huvudstorlek.</span><span class="sxs-lookup"><span data-stu-id="a942b-151">You might need tooset this if your application host has limits on response header size.</span></span> <span data-ttu-id="a942b-152">Anger det här kan öka hello övergripande varaktighet och RUs som används för hello frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-152">Setting this may increase hello overall duration and RUs consumed for hello query.</span></span>  |

<span data-ttu-id="a942b-153">Till exempel ta en exempelfråga på partitionsnyckel som efterfrågas på en samling med `/city` som hello partition nyckel och etablerats med 100 000 RU/s genomströmning.</span><span class="sxs-lookup"><span data-stu-id="a942b-153">For example, let's take an example query on partition key requested on a collection with `/city` as hello partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="a942b-154">Du begär den här frågan med `CreateDocumentQuery<T>` i .NET hello följande:</span><span class="sxs-lookup"><span data-stu-id="a942b-154">You request this query using `CreateDocumentQuery<T>` in .NET like hello following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="a942b-155">Hej SDK fragment ovan, motsvarar toohello på REST API-begäran:</span><span class="sxs-lookup"><span data-stu-id="a942b-155">hello SDK snippet shown above, corresponds toohello following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="a942b-156">Varje sida för körning av fråga motsvarar tooa REST API `POST` med hello `Accept: application/query+json` sidhuvud och hello SQL-frågan i hello brödtext.</span><span class="sxs-lookup"><span data-stu-id="a942b-156">Each query execution page corresponds tooa REST API `POST` with hello `Accept: application/query+json` header, and hello SQL query in hello body.</span></span> <span data-ttu-id="a942b-157">Varje fråga gör en eller flera avrunda resor toohello server med hello `x-ms-continuation` token eko mellan hello klienten och servern tooresume körning.</span><span class="sxs-lookup"><span data-stu-id="a942b-157">Each query makes one or more round trips toohello server with hello `x-ms-continuation` token echoed between hello client and server tooresume execution.</span></span> <span data-ttu-id="a942b-158">hello konfigurationsalternativen i FeedOptions skickas toohello server i hello form av huvuden för begäran.</span><span class="sxs-lookup"><span data-stu-id="a942b-158">hello configuration options in FeedOptions are passed toohello server in hello form of request headers.</span></span> <span data-ttu-id="a942b-159">Till exempel `MaxItemCount` motsvarar för`x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="a942b-159">For example, `MaxItemCount` corresponds too`x-ms-max-item-count`.</span></span> 

<span data-ttu-id="a942b-160">hello-begäran returnerar hello följande (trunkerad för läsbarhet) svar:</span><span class="sxs-lookup"><span data-stu-id="a942b-160">hello request returns hello following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="a942b-161">viktiga hello svarshuvuden som returnerades från frågan hello inkludera hello följande:</span><span class="sxs-lookup"><span data-stu-id="a942b-161">hello key response headers returned from hello query include hello following:</span></span>

| <span data-ttu-id="a942b-162">Alternativ</span><span class="sxs-lookup"><span data-stu-id="a942b-162">Option</span></span> | <span data-ttu-id="a942b-163">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="a942b-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="a942b-164">hello antal objekt som returneras i hello svar.</span><span class="sxs-lookup"><span data-stu-id="a942b-164">hello number of items returned in hello response.</span></span> <span data-ttu-id="a942b-165">Detta är beroende av hello angivna `x-ms-max-item-count`, hello antal objekt som ryms inom hello maximala nyttolasten svarsstorlek hello etablerat dataflöde och körningstid för frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-165">This is dependent on hello supplied `x-ms-max-item-count`, hello number of items that can be fit within hello maximum response payload size, hello provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="a942b-166">hello fortsättning token tooresume körning av hello fråga om ytterligare resultat är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="a942b-166">hello continuation token tooresume execution of hello query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="a942b-167">hello frågan statistik för hello körning.</span><span class="sxs-lookup"><span data-stu-id="a942b-167">hello query statistics for hello execution.</span></span> <span data-ttu-id="a942b-168">Det här är en avgränsad sträng som innehåller statistik över tid i hello olika faser i frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-168">This is a delimited string containing statistics of time spent in hello various phases of query execution.</span></span> <span data-ttu-id="a942b-169">Returneras om `x-ms-documentdb-populatequerymetrics` har angetts för`True`.</span><span class="sxs-lookup"><span data-stu-id="a942b-169">Returned if `x-ms-documentdb-populatequerymetrics` is set too`True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="a942b-170">Hej antalet [programbegäran](request-units.md) förbrukas av hello frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-170">hello number of [request units](request-units.md) consumed by hello query.</span></span> | 

<span data-ttu-id="a942b-171">Mer information om hello REST API-huvuden för begäran och alternativ finns [förfrågan efter resurser med hjälp av hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span><span class="sxs-lookup"><span data-stu-id="a942b-171">For details on hello REST API request headers and options, see [Querying resources using hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="a942b-172">Bästa praxis för prestanda för frågor</span><span class="sxs-lookup"><span data-stu-id="a942b-172">Best practices for query performance</span></span>
<span data-ttu-id="a942b-173">hello följande är hello vanligaste faktorer som påverkar Azure Cosmos DB frågeprestanda.</span><span class="sxs-lookup"><span data-stu-id="a942b-173">hello following are hello most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="a942b-174">Vi gräva djupare i var och en av dessa avsnitt i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="a942b-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="a942b-175">Faktor</span><span class="sxs-lookup"><span data-stu-id="a942b-175">Factor</span></span> | <span data-ttu-id="a942b-176">Tips</span><span class="sxs-lookup"><span data-stu-id="a942b-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="a942b-177">Etablerat dataflöde</span><span class="sxs-lookup"><span data-stu-id="a942b-177">Provisioned throughput</span></span> | <span data-ttu-id="a942b-178">Mät RU per fråga och se till att du har etablerat dataflöde för hello krävs för dina frågor.</span><span class="sxs-lookup"><span data-stu-id="a942b-178">Measure RU per query, and ensure that you have hello required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="a942b-179">Partitionering och partitionsnycklar</span><span class="sxs-lookup"><span data-stu-id="a942b-179">Partitioning and partition keys</span></span> | <span data-ttu-id="a942b-180">Ge företräde åt frågor med hello partitionsnyckelvärde i hello filtersatsen för låg latens.</span><span class="sxs-lookup"><span data-stu-id="a942b-180">Favor queries with hello partition key value in hello filter clause for low latency.</span></span> |
| <span data-ttu-id="a942b-181">SDK-och frågealternativ</span><span class="sxs-lookup"><span data-stu-id="a942b-181">SDK and query options</span></span> | <span data-ttu-id="a942b-182">Följ Metodtips för SDK som direkt anslutning och finjustera frågealternativ körning på klientsidan.</span><span class="sxs-lookup"><span data-stu-id="a942b-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="a942b-183">Svarstid för nätverk</span><span class="sxs-lookup"><span data-stu-id="a942b-183">Network latency</span></span> | <span data-ttu-id="a942b-184">Kontot för nätverk omkostnader i mått och använda flera API: er tooread från hello närmsta region.</span><span class="sxs-lookup"><span data-stu-id="a942b-184">Account for network overhead in measurement, and use multi-homing APIs tooread from hello nearest region.</span></span> |
| <span data-ttu-id="a942b-185">Indexprincip</span><span class="sxs-lookup"><span data-stu-id="a942b-185">Indexing Policy</span></span> | <span data-ttu-id="a942b-186">Se till att du har hello krävs sökvägar/indexprincip för hello frågan.</span><span class="sxs-lookup"><span data-stu-id="a942b-186">Ensure that you have hello required indexing paths/policy for hello query.</span></span> |
| <span data-ttu-id="a942b-187">Mätvärden för körning av frågan</span><span class="sxs-lookup"><span data-stu-id="a942b-187">Query execution metrics</span></span> | <span data-ttu-id="a942b-188">Analysera hello frågan körning mått tooidentify potentiella omskrivningar av frågor och former.</span><span class="sxs-lookup"><span data-stu-id="a942b-188">Analyze hello query execution metrics tooidentify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="a942b-189">Etablerat dataflöde</span><span class="sxs-lookup"><span data-stu-id="a942b-189">Provisioned throughput</span></span>
<span data-ttu-id="a942b-190">Skapa behållare av data med reserverat dataflöde, uttryckt i begäran enheter (RU) per sekund i Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="a942b-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="a942b-191">En läsning av ett dokument på 1 KB är 1 RU och varje åtgärd (inklusive frågor) är normaliserat tooa fast antal RUs baserat på dess komplexitet.</span><span class="sxs-lookup"><span data-stu-id="a942b-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized tooa fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="a942b-192">Till exempel om du har 1000 RU/s som skapats för din behållare och du har en fråga som `SELECT * FROM c WHERE c.city = 'Seattle'` som förbrukar 5 RUs och du kan utföra (1000 RU/s) / (5 RU/query) = 200 frågan/s sådana frågor per sekund.</span><span class="sxs-lookup"><span data-stu-id="a942b-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="a942b-193">Om du skickar fler än 200 per sekund startar hello-tjänsten hastighetsbegränsande inkommande begäranden över 200/s.</span><span class="sxs-lookup"><span data-stu-id="a942b-193">If you submit more than 200 queries/sec, hello service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="a942b-194">hello SDK: er hanterar automatiskt det här fallet genom att utföra en backoff/försök, därför ser du kanske en högre latens för dessa frågor.</span><span class="sxs-lookup"><span data-stu-id="a942b-194">hello SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="a942b-195">Öka hello etablerat dataflöde toohello krävs värdet förbättrar dina svarstid och genomströmning.</span><span class="sxs-lookup"><span data-stu-id="a942b-195">Increasing hello provisioned throughput toohello required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="a942b-196">toolearn mer information om frågeenheter, se [programbegäran](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="a942b-196">toolearn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="a942b-197">Partitionering och partitionsnycklar</span><span class="sxs-lookup"><span data-stu-id="a942b-197">Partitioning and partition keys</span></span>
<span data-ttu-id="a942b-198">Med Azure Cosmos DB vanligtvis utför frågor i hello ordning från snabbaste/mest effektiva tooslower/mindre effektiva.</span><span class="sxs-lookup"><span data-stu-id="a942b-198">With Azure Cosmos DB, typically queries perform in hello following order from fastest/most efficient tooslower/less efficient.</span></span> 

* <span data-ttu-id="a942b-199">HÄMTA på en enda partitionsnyckel och objektet nyckel</span><span class="sxs-lookup"><span data-stu-id="a942b-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="a942b-200">Frågan med en filtersats på en enda partitionsnyckel</span><span class="sxs-lookup"><span data-stu-id="a942b-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="a942b-201">Fråga utan en likhet eller intervallet filtersats om en egenskap</span><span class="sxs-lookup"><span data-stu-id="a942b-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="a942b-202">Fråga utan filter</span><span class="sxs-lookup"><span data-stu-id="a942b-202">Query without filters</span></span>

<span data-ttu-id="a942b-203">Frågor som behöver tooconsult alla partitioner behovet av högre latens och kan använda högre RUs.</span><span class="sxs-lookup"><span data-stu-id="a942b-203">Queries that need tooconsult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="a942b-204">Eftersom varje partition har automatisk indexering mot alla egenskaper, kan hello fråga hanteras effektivt från hello index i det här fallet.</span><span class="sxs-lookup"><span data-stu-id="a942b-204">Since each partition has automatic indexing against all properties, hello query can be served efficiently from hello index in this case.</span></span> <span data-ttu-id="a942b-205">Du kan skapa frågor som sträcker sig över partitioner snabbare genom att använda hello parallellitet alternativ.</span><span class="sxs-lookup"><span data-stu-id="a942b-205">You can make queries that span partitions faster by using hello parallelism options.</span></span>

<span data-ttu-id="a942b-206">toolearn mer information om partitionering och partitionsnycklar, se [partitionering i Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="a942b-206">toolearn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="a942b-207">SDK-och frågealternativ</span><span class="sxs-lookup"><span data-stu-id="a942b-207">SDK and query options</span></span>
<span data-ttu-id="a942b-208">Se [prestandatips](performance-tips.md) och [prestandatester](performance-testing.md) för hur tooget hello bäst klientsidans prestanda från Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="a942b-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how tooget hello best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="a942b-209">Detta innefattar att använda hello senaste SDK: er, konfigurera plattformsspecifika konfigurationer som Standardantal anslutningar, frekvensen för skräpinsamling, och använda lightweight anslutningsalternativ som direkt/TCP.</span><span class="sxs-lookup"><span data-stu-id="a942b-209">This includes using hello latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="a942b-210">Max antal</span><span class="sxs-lookup"><span data-stu-id="a942b-210">Max Item Count</span></span>
<span data-ttu-id="a942b-211">Hej värdet för frågor `MaxItemCount` kan ha en betydande inverkan på Frågetid för slutpunkt till slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="a942b-211">For queries, hello value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="a942b-212">Varje rundtur toohello returnerar servern högst hello antal objekt i `MaxItemCount` (standard 100 objekt).</span><span class="sxs-lookup"><span data-stu-id="a942b-212">Each round trip toohello server will return no more than hello number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="a942b-213">Tooa högre värdet (-1 är högsta och rekommenderade) förbättrar din övergripande varaktighet för frågan genom att begränsa hello antal turer mellan servern och klienten, särskilt för frågor med stora resultatuppsättningar.</span><span class="sxs-lookup"><span data-stu-id="a942b-213">Setting this tooa higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting hello number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="a942b-214">Max grad av parallellitet</span><span class="sxs-lookup"><span data-stu-id="a942b-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="a942b-215">För frågor finjustera hello `MaxDegreeOfParallelism` tooidentify hello rekommenderade konfigurationer för programmet, särskilt om du utför mellan partition-frågor (utan ett filter på hello partitionsnyckel värdet).</span><span class="sxs-lookup"><span data-stu-id="a942b-215">For queries, tune hello `MaxDegreeOfParallelism` tooidentify hello best configurations for your application, especially if you perform cross-partition queries (without a filter on hello partition-key value).</span></span> <span data-ttu-id="a942b-216">`MaxDegreeOfParallelism`styr hello maximala antalet parallella aktiviteter, d.v.s. hello maximalt antal partitioner toobe besökt parallellt.</span><span class="sxs-lookup"><span data-stu-id="a942b-216">`MaxDegreeOfParallelism`  controls hello maximum number of parallel tasks, i.e., hello maximum of partitions toobe visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="a942b-217">Vi antar som</span><span class="sxs-lookup"><span data-stu-id="a942b-217">Let’s assume that</span></span>
* <span data-ttu-id="a942b-218">D = standard maximalt antal parallella aktiviteter (= totalt antal processorn i hello klientdatorn)</span><span class="sxs-lookup"><span data-stu-id="a942b-218">D = Default Maximum number of parallel tasks (= total number of processor in hello client machine)</span></span>
* <span data-ttu-id="a942b-219">P = användaren har angett maximalt antal parallella aktiviteter</span><span class="sxs-lookup"><span data-stu-id="a942b-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="a942b-220">N = antalet partitioner som behöver toobe besökt för att svara på en fråga</span><span class="sxs-lookup"><span data-stu-id="a942b-220">N = Number of partitions that needs  toobe visited for answering a query</span></span>

<span data-ttu-id="a942b-221">Följande är effekterna av hur hello parallella frågor skulle fungera för olika värden för P.</span><span class="sxs-lookup"><span data-stu-id="a942b-221">Following are implications of how hello parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="a942b-222">(P == 0) = > Serial-läge</span><span class="sxs-lookup"><span data-stu-id="a942b-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="a942b-223">(P == 1) = > maximalt en uppgift</span><span class="sxs-lookup"><span data-stu-id="a942b-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="a942b-224">(P > 1) = > Min (P, N) parallella aktiviteter</span><span class="sxs-lookup"><span data-stu-id="a942b-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="a942b-225">(P < 1) = > Min (N, D) parallella aktiviteter</span><span class="sxs-lookup"><span data-stu-id="a942b-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="a942b-226">För SDK viktig information och information om implementerade klasser och metoder finns [DocumentDB-SDK](documentdb-sdk-dotnet.md)</span><span class="sxs-lookup"><span data-stu-id="a942b-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="a942b-227">Svarstid för nätverk</span><span class="sxs-lookup"><span data-stu-id="a942b-227">Network latency</span></span>
<span data-ttu-id="a942b-228">Se [Azure Cosmos DB global distributionsplatsen](tutorial-global-distribution-documentdb.md) för hur tooset upp global distributionsplatsen och ansluta toohello närmaste region.</span><span class="sxs-lookup"><span data-stu-id="a942b-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how tooset up global distribution, and connect toohello closest region.</span></span> <span data-ttu-id="a942b-229">Nätverksfördröjningen har en betydande inverkan på prestanda när du behöver toomake flera turer eller hämtar en stor resultatmängd från hello fråga.</span><span class="sxs-lookup"><span data-stu-id="a942b-229">Network latency has a significant impact on query performance when you need toomake multiple round-trips or retrieve a large result set from hello query.</span></span> 

<span data-ttu-id="a942b-230">hello på mått för körning av frågan förklaras hur tooretrieve hello server körningstid för frågor ( `totalExecutionTimeInMs`), så att du kan skilja mellan tid i Frågekörningen och tid i nätverket överföring.</span><span class="sxs-lookup"><span data-stu-id="a942b-230">hello section on query execution metrics explains how tooretrieve hello server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="a942b-231">Indexprincip</span><span class="sxs-lookup"><span data-stu-id="a942b-231">Indexing policy</span></span>
<span data-ttu-id="a942b-232">Se [konfigurera indexprincip](indexing-policies.md) för indexering sökvägar, typer, och lägen och hur de påverkar Frågekörningen.</span><span class="sxs-lookup"><span data-stu-id="a942b-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="a942b-233">Hello indexering principen används som standard hash-indexering för strängar, vilket är effektiv för likhetsfrågor, men inte för intervall frågor/order by-frågor.</span><span class="sxs-lookup"><span data-stu-id="a942b-233">By default, hello indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="a942b-234">Om du behöver intervallet frågor efter strängar, rekommenderar vi att ange hello intervallet Indextypen för alla strängar.</span><span class="sxs-lookup"><span data-stu-id="a942b-234">If you need range queries for strings, we recommend specifying hello Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="a942b-235">Mätvärden för körning av frågan</span><span class="sxs-lookup"><span data-stu-id="a942b-235">Query execution metrics</span></span>
<span data-ttu-id="a942b-236">Du kan hämta detaljerade mått i frågan genom att passera i hello valfria `x-ms-documentdb-populatequerymetrics` huvud (`FeedOptions.PopulateQueryMetrics` i hello .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="a942b-236">You can obtain detailed metrics on query execution by passing in hello optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span></span> <span data-ttu-id="a942b-237">Hej värde som returneras i `x-ms-documentdb-query-metrics` har hello följande nyckel-värdepar avsett för avancerad felsökning av Frågekörningen.</span><span class="sxs-lookup"><span data-stu-id="a942b-237">hello value returned in `x-ms-documentdb-query-metrics` has hello following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="a942b-238">Mått</span><span class="sxs-lookup"><span data-stu-id="a942b-238">Metric</span></span> | <span data-ttu-id="a942b-239">Enhet</span><span class="sxs-lookup"><span data-stu-id="a942b-239">Unit</span></span> | <span data-ttu-id="a942b-240">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="a942b-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="a942b-241">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-241">milliseconds</span></span> | <span data-ttu-id="a942b-242">Körningstid för frågan</span><span class="sxs-lookup"><span data-stu-id="a942b-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="a942b-243">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-243">milliseconds</span></span> | <span data-ttu-id="a942b-244">Frågan kompilering</span><span class="sxs-lookup"><span data-stu-id="a942b-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="a942b-245">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-245">milliseconds</span></span> | <span data-ttu-id="a942b-246">Tid toobuild logiska frågeplan</span><span class="sxs-lookup"><span data-stu-id="a942b-246">Time toobuild logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="a942b-247">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-247">milliseconds</span></span> | <span data-ttu-id="a942b-248">Tid toobuild fysiska frågeplan</span><span class="sxs-lookup"><span data-stu-id="a942b-248">Time toobuild physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="a942b-249">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-249">milliseconds</span></span> | <span data-ttu-id="a942b-250">Tid som ägnats åt att optimera frågan</span><span class="sxs-lookup"><span data-stu-id="a942b-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="a942b-251">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-251">milliseconds</span></span> | <span data-ttu-id="a942b-252">Tid i frågan runtime</span><span class="sxs-lookup"><span data-stu-id="a942b-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="a942b-253">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-253">milliseconds</span></span> | <span data-ttu-id="a942b-254">Tid i fysiska index lager</span><span class="sxs-lookup"><span data-stu-id="a942b-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="a942b-255">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-255">milliseconds</span></span> | <span data-ttu-id="a942b-256">Tid i inläsning av dokument</span><span class="sxs-lookup"><span data-stu-id="a942b-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="a942b-257">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-257">milliseconds</span></span> | <span data-ttu-id="a942b-258">Total tid som ägnats verkställande system (inbyggda) funktioner i millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="a942b-259">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-259">milliseconds</span></span> | <span data-ttu-id="a942b-260">Total tid som ägnats verkställande användardefinierade funktioner i millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="a942b-261">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-261">milliseconds</span></span> | <span data-ttu-id="a942b-262">Totalt antal hämtade dokument</span><span class="sxs-lookup"><span data-stu-id="a942b-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="a942b-263">Byte</span><span class="sxs-lookup"><span data-stu-id="a942b-263">bytes</span></span> | <span data-ttu-id="a942b-264">Total storlek på hämtade dokument i byte</span><span class="sxs-lookup"><span data-stu-id="a942b-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="a942b-265">Antal</span><span class="sxs-lookup"><span data-stu-id="a942b-265">count</span></span> | <span data-ttu-id="a942b-266">Antal dokument som utdata</span><span class="sxs-lookup"><span data-stu-id="a942b-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="a942b-267">millisekunder</span><span class="sxs-lookup"><span data-stu-id="a942b-267">milliseconds</span></span> | <span data-ttu-id="a942b-268">Tid i millisekunder för att köra frågan</span><span class="sxs-lookup"><span data-stu-id="a942b-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="a942b-269">förhållandet mellan (< = 1)</span><span class="sxs-lookup"><span data-stu-id="a942b-269">ratio (<=1)</span></span> | <span data-ttu-id="a942b-270">Förhållandet mellan antalet dokument som matchas av hello filter toohello antal dokument som läses in</span><span class="sxs-lookup"><span data-stu-id="a942b-270">Ratio of number of documents matched by hello filter toohello number of documents loaded</span></span>  | 

<span data-ttu-id="a942b-271">hello klienten SDK: er kan internt göra flera åtgärder tooserve hello fråga inom varje partition.</span><span class="sxs-lookup"><span data-stu-id="a942b-271">hello client SDKs may internally make multiple query operations tooserve hello query within each partition.</span></span> <span data-ttu-id="a942b-272">hello klient gör flera anrop per partition om hello totalt resultat överskrider `x-ms-max-item-count`om hello frågan överskrider hello etablerat dataflöde för hello partition, eller om hello frågan nyttolast når hello maximal storlek per sida eller om hello frågan når hello system allokerade timeout-gränsen.</span><span class="sxs-lookup"><span data-stu-id="a942b-272">hello client makes more than one call per-partition if hello total results exceed `x-ms-max-item-count`, if hello query exceeds hello provisioned throughput for hello partition, or if hello query payload reaches hello maximum size per page, or if hello query reaches hello system allocated timeout limit.</span></span> <span data-ttu-id="a942b-273">Varje partiella Frågekörningen returnerar en `x-ms-documentdb-query-metrics` för sidan.</span><span class="sxs-lookup"><span data-stu-id="a942b-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="a942b-274">Här följer några exempelfrågor och hur toointerpret vissa hello mått returnerades från frågan:</span><span class="sxs-lookup"><span data-stu-id="a942b-274">Here are some sample queries, and how toointerpret some of hello metrics returned from query execution:</span></span> 

| <span data-ttu-id="a942b-275">Fråga</span><span class="sxs-lookup"><span data-stu-id="a942b-275">Query</span></span> | <span data-ttu-id="a942b-276">Exempel mått</span><span class="sxs-lookup"><span data-stu-id="a942b-276">Sample Metric</span></span> | <span data-ttu-id="a942b-277">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="a942b-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="a942b-278">hello antal dokument som hämtats är 100 + 1 toomatch hello TOP-instruktion.</span><span class="sxs-lookup"><span data-stu-id="a942b-278">hello number of documents retrieved is 100+1 toomatch hello TOP clause.</span></span> <span data-ttu-id="a942b-279">Frågetid används främst i `WriteOutputTime` och `DocumentLoadTime` eftersom det är en genomsökning.</span><span class="sxs-lookup"><span data-stu-id="a942b-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="a942b-280">RetrievedDocumentCount är nu högre (500 + 1 toomatch hello TOP-instruktion).</span><span class="sxs-lookup"><span data-stu-id="a942b-280">RetrievedDocumentCount is now higher (500+1 toomatch hello TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="a942b-281">Om 0,9 ms används i IndexLookupTime för en nyckel sökning, eftersom det är ett index sökning `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="a942b-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="a942b-282">Något mer tid (1,7 ms) som används IndexLookupTime via en genomsökning för intervallet, eftersom det är ett index sökning `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="a942b-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="a942b-283">Samma tid som ägnats `DocumentLoadTime` som tidigare frågor men lägre `WriteOutputTime` eftersom vi projicerar bara en egenskap.</span><span class="sxs-lookup"><span data-stu-id="a942b-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="a942b-284">Om 213 ms ägnats åt `UserDefinedFunctionExecutionTime` körs hello UDF på varje värde i `c.N`.</span><span class="sxs-lookup"><span data-stu-id="a942b-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing hello UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="a942b-285">Om 0,6 ms ägnats åt `IndexLookupTime` på `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="a942b-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="a942b-286">De flesta av hello fråga körningstid (ms ~ 7) i `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="a942b-286">Most of hello query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="a942b-287">Frågan utförs som en genomsökning eftersom den använder `LOWER`, och 500 utanför 2491 hämtade dokument som returneras.</span><span class="sxs-lookup"><span data-stu-id="a942b-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="a942b-288">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="a942b-288">Next steps</span></span>
* <span data-ttu-id="a942b-289">toolearn om hello stöds SQL frågeoperatorer och nyckelord, se [SQL-frågan](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="a942b-289">toolearn about hello supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="a942b-290">toolearn om frågeenheter, se [programbegäran](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="a942b-290">toolearn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="a942b-291">toolearn om indexprincip, se [indexering princip](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="a942b-291">toolearn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 


