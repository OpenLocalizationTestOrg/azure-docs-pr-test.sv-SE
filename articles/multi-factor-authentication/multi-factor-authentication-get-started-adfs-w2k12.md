---
title: MFA Server med AD FS i Windows Server | Microsoft Docs
description: "Den här artikeln beskriver hur du kommer igång med Azure Multi-Factor Authentication och AD FS i Windows Server 2012 R2 och 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f2481c18f12d74a90938ffb0353dd000fe73f440
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-multi-factor-authentication-server-to-work-with-ad-fs-in-windows-server"></a><span data-ttu-id="42c62-103">Konfigurera Azure Multi-Factor Authentication Server så att den fungerar med AD FS i Windows Server</span><span class="sxs-lookup"><span data-stu-id="42c62-103">Configure Azure Multi-Factor Authentication Server to work with AD FS in Windows Server</span></span>
<span data-ttu-id="42c62-104">Om du använder Active Directory Federation Services (AD FS) och vill skydda molnresurser eller lokala resurser kan du konfigurera Azure Multi-Factor Authentication Server att fungera med AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-104">If you use Active Directory Federation Services (AD FS) and want to secure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server to work with AD FS.</span></span> <span data-ttu-id="42c62-105">Den här konfigurationen utlöser tvåstegsverifiering för slutpunkter med högt värde.</span><span class="sxs-lookup"><span data-stu-id="42c62-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="42c62-106">I den här artikeln diskuterar vi hur du använder Azure Multi-Factor Authentication Server med AD FS i Windows Server 2012 R2 eller Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="42c62-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="42c62-107">Mer information finns i [Skydda molnresurser och lokala resurser med hjälp av Azure Multi-Factor Authentication Server med AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="42c62-107">For more information, read about how to [secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="42c62-108">Skydda Windows Server AD FS med Azure Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="42c62-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="42c62-109">När du installerar Azure Multi-Factor Authentication Server kan du välja mellan följande alternativ:</span><span class="sxs-lookup"><span data-stu-id="42c62-109">When you install Azure Multi-Factor Authentication Server, you have the following options:</span></span>

* <span data-ttu-id="42c62-110">Installera Azure Multi-Factor Authentication Server lokalt på samma server som AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-110">Install Azure Multi-Factor Authentication Server locally on the same server as AD FS</span></span>
* <span data-ttu-id="42c62-111">Installera Azure Multi-Factor Authentication-adaptern lokalt på AD FS-servern och installera sedan Multi-Factor Authentication-servern på en annan dator.</span><span class="sxs-lookup"><span data-stu-id="42c62-111">Install the Azure Multi-Factor Authentication adapter locally on the AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="42c62-112">Innan du börjar bör du vara medveten om följande:</span><span class="sxs-lookup"><span data-stu-id="42c62-112">Before you begin, be aware of the following information:</span></span>

* <span data-ttu-id="42c62-113">Du behöver inte installera Azure Multi-Factor Authentication Server på AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="42c62-113">You are not required to install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="42c62-114">Dock måste du installera Multi-Factor Authentication-adaptern för AD FS på en Windows Server 2012 R2 eller Windows Server 2016 som kör AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-114">However, you must install the Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="42c62-115">Du kan installera servern på en annan dator, förutsatt att det är en version som stöds och installera AD FS-adaptern separat på AD FS-federationsservern.</span><span class="sxs-lookup"><span data-stu-id="42c62-115">You can install the server on a different computer if it is a supported version and you install the AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="42c62-116">Se följande information om hur du installerar adaptern separat.</span><span class="sxs-lookup"><span data-stu-id="42c62-116">See the following procedures to learn how to install the adapter separately.</span></span>
* <span data-ttu-id="42c62-117">Om din organisation använder verifieringsmetoder med SMS eller mobilappar innehåller strängarna som definierats i företagsinställningarna platshållaren <$*application_name*$>.</span><span class="sxs-lookup"><span data-stu-id="42c62-117">If your organization is using text message or mobile app verification methods, the strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="42c62-118">Du kan ange namnet på ett program som ersätter platshållaren i MFA Server v7.1.</span><span class="sxs-lookup"><span data-stu-id="42c62-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="42c62-119">Den här platshållaren ersätts inte automatiskt när du använder AD FS-adaptern i v 7.0 eller senare.</span><span class="sxs-lookup"><span data-stu-id="42c62-119">In v7.0 or older, this placeholder is not automatically replaced when you use the AD FS adapter.</span></span> <span data-ttu-id="42c62-120">För äldre versioner tar du bort platshållaren från relevanta strängar när du skyddar AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-120">For those older versions, remove the placeholder from the appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="42c62-121">Det konto som du använder för att logga in måste ha användarbehörighet att skapa säkerhetsgrupper i Active Directory-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="42c62-121">The account that you use to sign in must have user rights to create security groups in your Active Directory service.</span></span>
* <span data-ttu-id="42c62-122">Installationsguiden för Multi-Factor Authentication AD FS-adapter skapar en säkerhetsgrupp med namnet PhoneFactor Admins i din instans av Active Directory.</span><span class="sxs-lookup"><span data-stu-id="42c62-122">The Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="42c62-123">AD FS-tjänstkontot för federationstjänsten läggs sedan till i den här gruppen.</span><span class="sxs-lookup"><span data-stu-id="42c62-123">It then adds the AD FS service account of your federation service to this group.</span></span> <span data-ttu-id="42c62-124">Verifiera i domänkontrollanten att gruppen PhoneFactor Admins verkligen har skapats och att AD FS-tjänstkontot är medlem av den här gruppen.</span><span class="sxs-lookup"><span data-stu-id="42c62-124">Verify on your domain controller that the PhoneFactor Admins group is indeed created and that the AD FS service account is a member of this group.</span></span> <span data-ttu-id="42c62-125">Om det behövs lägger du till AD FS-tjänstkontot i gruppen PhoneFactor Admins på domänkontrollanten manuellt.</span><span class="sxs-lookup"><span data-stu-id="42c62-125">If necessary, manually add the AD FS service account to the PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="42c62-126">Information om hur du installerar webbtjänst-SDK med användarportalen finns i [Distribuera användarportalen för Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="42c62-126">For information about installing the Web Service SDK with the user portal, read about [deploying the user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-the-ad-fs-server"></a><span data-ttu-id="42c62-127">Installera Azure Multi-Factor Authentication Server lokalt på AD FS-servern</span><span class="sxs-lookup"><span data-stu-id="42c62-127">Install Azure Multi-Factor Authentication Server locally on the AD FS server</span></span>
1. <span data-ttu-id="42c62-128">Hämta och installera Azure Multi-Factor Authentication Server på AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="42c62-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="42c62-129">Mer information om installationen finns i [Komma igång med Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="42c62-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="42c62-130">Klicka på **AD FS**-ikonen i Azure Multi-Factor Authentication Server-hanteringskonsolen.</span><span class="sxs-lookup"><span data-stu-id="42c62-130">In the Azure Multi-Factor Authentication Server management console, click the **AD FS** icon.</span></span> <span data-ttu-id="42c62-131">Markera alternativen **Tillåt användarregistrering** och **Tillåt användare att välja metod**.</span><span class="sxs-lookup"><span data-stu-id="42c62-131">Select the options **Allow user enrollment** and **Allow users to select method**.</span></span>
3. <span data-ttu-id="42c62-132">Välj ytterligare alternativ som du vill ange för din organisation.</span><span class="sxs-lookup"><span data-stu-id="42c62-132">Select any additional options you'd like to specify for your organization.</span></span>
4. <span data-ttu-id="42c62-133">Klicka på **Installera AD FS-adapter**.</span><span class="sxs-lookup"><span data-stu-id="42c62-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="42c62-134"><center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="42c62-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="42c62-135">Om Active Directory-fönstret visas, betyder det två saker.</span><span class="sxs-lookup"><span data-stu-id="42c62-135">If the Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="42c62-136">Datorn är ansluten till en domän och Active Directory-konfigurationen för att skydda kommunikationen mellan AD FS-adaptern och Multi-Factor Authentication-tjänsten är ofullständig.</span><span class="sxs-lookup"><span data-stu-id="42c62-136">Your computer is joined to a domain, and the Active Directory configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="42c62-137">Klicka på **Nästa** om du vill slutföra konfigurationen automatiskt, eller markera kryssrutan **Hoppa över automatisk konfigurering av Active Directory och konfigurera inställningarna manuellt**.</span><span class="sxs-lookup"><span data-stu-id="42c62-137">Click **Next** to automatically complete this configuration, or select the **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="42c62-138">Klicka på **Nästa**.</span><span class="sxs-lookup"><span data-stu-id="42c62-138">Click **Next**.</span></span>
6. <span data-ttu-id="42c62-139">Om fönstret Lokal grupp visas, betyder det två saker.</span><span class="sxs-lookup"><span data-stu-id="42c62-139">If the Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="42c62-140">Datorn är inte ansluten till en domän och konfigurationen för lokal grupp för att skydda kommunikationen mellan AD FS-adaptern och Multi-Factor Authentication-tjänsten är ofullständig.</span><span class="sxs-lookup"><span data-stu-id="42c62-140">Your computer is not joined to a domain, and the local group configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="42c62-141">Klicka på **Nästa** för att slutföra konfigurationen automatiskt, eller markera kryssrutan **Hoppa över automatisk konfigurering av lokal grupp och konfigurera inställningarna manuellt**.</span><span class="sxs-lookup"><span data-stu-id="42c62-141">Click **Next** to automatically complete this configuration, or select the **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="42c62-142">Klicka på **Nästa**.</span><span class="sxs-lookup"><span data-stu-id="42c62-142">Click **Next**.</span></span>
7. <span data-ttu-id="42c62-143">Klicka på **Nästa** i installationsguiden.</span><span class="sxs-lookup"><span data-stu-id="42c62-143">In the installation wizard, click **Next**.</span></span> <span data-ttu-id="42c62-144">Azure Multi-Factor Authentication Server skapar gruppen PhoneFactor Admins och lägger till AD FS-tjänstkontot i PhoneFactor Admins-gruppen.</span><span class="sxs-lookup"><span data-stu-id="42c62-144">Azure Multi-Factor Authentication Server creates the PhoneFactor Admins group and adds the AD FS service account to the PhoneFactor Admins group.</span></span>
   <span data-ttu-id="42c62-145"><center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="42c62-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="42c62-146">Klicka på **Nästa** på sidan **Installationsprogram**.</span><span class="sxs-lookup"><span data-stu-id="42c62-146">On the **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="42c62-147">Klicka på **Nästa** i installationsprogrammet för Multi-Factor Authentication AD FS-adaptern.</span><span class="sxs-lookup"><span data-stu-id="42c62-147">In the Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="42c62-148">Klicka på **Stäng** när installationen är klar.</span><span class="sxs-lookup"><span data-stu-id="42c62-148">Click **Close** when the installation is finished.</span></span>
11. <span data-ttu-id="42c62-149">När adaptern har installerats måste du registrera den med AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-149">When the adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="42c62-150">Öppna Windows PowerShell och kör följande kommando:</span><span class="sxs-lookup"><span data-stu-id="42c62-150">Open Windows PowerShell and run the following command:</span></span><br><span data-ttu-id="42c62-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="42c62-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="42c62-152">För att använda den nyligen registrerade adaptern, redigera den globala autentiseringsprincipen i AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-152">To use your newly registered adapter, edit the global authentication policy in AD FS.</span></span> <span data-ttu-id="42c62-153">I AD FS-hanteringskonsolen går du till noden **Autentiseringsprinciper**.</span><span class="sxs-lookup"><span data-stu-id="42c62-153">In the AD FS management console, go to the **Authentication Policies** node.</span></span> <span data-ttu-id="42c62-154">I avsnittet **Multi-Factor Authentication** klickar du på länken **Redigera** bredvid avsnittet **Globala inställningar**.</span><span class="sxs-lookup"><span data-stu-id="42c62-154">In the **Multi-factor Authentication** section, click the **Edit** link next to the **Global Settings** section.</span></span> <span data-ttu-id="42c62-155">I fönstret **Redigera global autentiseringsprincip** väljer du **Multi-Factor Authentication** som ytterligare en autentiseringsmetod och klickar på **OK**.</span><span class="sxs-lookup"><span data-stu-id="42c62-155">In the **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="42c62-156">Adaptern registreras som WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="42c62-156">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="42c62-157">Starta om AD FS-tjänsten för att registreringen ska börja gälla.</span><span class="sxs-lookup"><span data-stu-id="42c62-157">Restart the AD FS service for the registration to take effect.</span></span>

<span data-ttu-id="42c62-158"><center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="42c62-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="42c62-159">Nu är Multi-Factor Authentication-servern konfigurerad som ytterligare en autentiseringsprovider för användning med AD FS.</span><span class="sxs-lookup"><span data-stu-id="42c62-159">At this point, Multi-Factor Authentication Server is set up to be an additional authentication provider to use with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-the-ad-fs-adapter-by-using-the-web-service-sdk"></a><span data-ttu-id="42c62-160">Installera en fristående instans av AD FS-adaptern med webbtjänst-SDK</span><span class="sxs-lookup"><span data-stu-id="42c62-160">Install a standalone instance of the AD FS adapter by using the Web Service SDK</span></span>
1. <span data-ttu-id="42c62-161">Installera webbtjänst-SDK på servern som kör Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="42c62-161">Install the Web Service SDK on the server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="42c62-162">Kopiera följande filer från katalogen \Program\Multi-Factor Authentication Server till den server där du planerar att installera AD FS-adaptern:</span><span class="sxs-lookup"><span data-stu-id="42c62-162">Copy the following files from the \Program Files\Multi-Factor Authentication Server directory to the server on which you plan to install the AD FS adapter:</span></span>
   * <span data-ttu-id="42c62-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="42c62-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="42c62-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="42c62-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="42c62-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="42c62-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="42c62-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="42c62-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="42c62-167">Kör installationsfilen MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="42c62-167">Run the MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="42c62-168">Starta installationen genom att klicka på **Nästa** i installationsprogrammet för Multi-Factor Authentication AD FS-adaptern.</span><span class="sxs-lookup"><span data-stu-id="42c62-168">In the Multi-Factor Authentication AD FS adapter installer, click **Next** to start the installation.</span></span>
5. <span data-ttu-id="42c62-169">Klicka på **Stäng** när installationen är klar.</span><span class="sxs-lookup"><span data-stu-id="42c62-169">Click **Close** when the installation is finished.</span></span>

## <a name="edit-the-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="42c62-170">Redigera filen MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="42c62-170">Edit the MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="42c62-171">Redigera filen MultiFactorAuthenticationAdfsAdapter.config genom att följa stegen nedan:</span><span class="sxs-lookup"><span data-stu-id="42c62-171">Follow these steps to edit the MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="42c62-172">Ange noden **UseWebServiceSdk** till **sant**.</span><span class="sxs-lookup"><span data-stu-id="42c62-172">Set the **UseWebServiceSdk** node to **true**.</span></span>  
2. <span data-ttu-id="42c62-173">Ange värdet för **WebServiceSdkUrl** till URL:en för webbtjänst-SDK för Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="42c62-173">Set the value for **WebServiceSdkUrl** to the URL of the Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="42c62-174">Exempel: *https://contoso.com/&lt;certifikatnamn&gt;/MultiFactorAuthWebServicesSdk/PfWsSdk.asmx* där *certifikatnamn* är namnet på certifikatet.</span><span class="sxs-lookup"><span data-stu-id="42c62-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is the name of your certificate.</span></span>  
3. <span data-ttu-id="42c62-175">Redigera skriptet Register-MultiFactorAuthenticationAdfsAdapter.ps1 genom att lägga till *-ConfigurationFilePath &lt;sökväg&gt;* i slutet av kommandot `Register-AdfsAuthenticationProvider`, där *&lt;sökväg&gt;* är den fullständiga sökvägen till filen MultiFactorAuthenticationAdfsAdapter.config.</span><span class="sxs-lookup"><span data-stu-id="42c62-175">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* to the end of the `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is the full path to the MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-the-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="42c62-176">Konfigurera webbtjänst-SDK med ett användarnamn och lösenord</span><span class="sxs-lookup"><span data-stu-id="42c62-176">Configure the Web Service SDK with a username and password</span></span>
<span data-ttu-id="42c62-177">Det finns två alternativ för att konfigurera webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="42c62-177">There are two options for configuring the Web Service SDK.</span></span> <span data-ttu-id="42c62-178">Det första alternativet är att använda ett användarnamn och lösenord, det andra är att använda ett klientcertifikat.</span><span class="sxs-lookup"><span data-stu-id="42c62-178">The first is with a username and password, the second is with a client certificate.</span></span> <span data-ttu-id="42c62-179">Följ dessa steg för det första alternativet eller hoppa framåt till det andra.</span><span class="sxs-lookup"><span data-stu-id="42c62-179">Follow these steps for the first option, or skip ahead for the second.</span></span>  

1. <span data-ttu-id="42c62-180">Ange värdet för **WebServiceSdkUsername** till ett konto som är medlem i säkerhetsgruppen PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="42c62-180">Set the value for **WebServiceSdkUsername** to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="42c62-181">Använd formatet &lt;domän&gt;&#92;&lt;användarnamn&gt;.</span><span class="sxs-lookup"><span data-stu-id="42c62-181">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="42c62-182">Ange värdet för **WebServiceSdkPassword** till lämpligt kontolösenord.</span><span class="sxs-lookup"><span data-stu-id="42c62-182">Set the value for **WebServiceSdkPassword** to the appropriate account password.</span></span>

### <a name="configure-the-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="42c62-183">Konfigurera webbtjänst-SDK med ett klientcertifikat</span><span class="sxs-lookup"><span data-stu-id="42c62-183">Configure the Web Service SDK with a client certificate</span></span>
<span data-ttu-id="42c62-184">Följ dessa steg om du vill konfigurera webbtjänst-SDK med ett klientcertifikat om du inte vill använda ett användarnamn och lösenord.</span><span class="sxs-lookup"><span data-stu-id="42c62-184">If you don't want to use a username and password, follow these steps to configure the Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="42c62-185">Skaffa ett klientcertifikat från en certifikatutfärdare för servern som kör webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="42c62-185">Obtain a client certificate from a certificate authority for the server that is running the Web Service SDK.</span></span> <span data-ttu-id="42c62-186">Lär dig hur du [skaffar klientcertifikat](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c62-186">Learn how to [obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="42c62-187">Importera klientcertifikatet till den lokala datorns personliga certifikatarkiv på servern som kör webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="42c62-187">Import the client certificate to the local computer personal certificate store on the server that is running the Web Service SDK.</span></span> <span data-ttu-id="42c62-188">Kontrollera att certifikatutfärdarens offentliga certifikat finns i certifikatarkivet för betrodda rotcertifikat.</span><span class="sxs-lookup"><span data-stu-id="42c62-188">Make sure that the certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="42c62-189">Exportera de offentliga och privata nycklarna för klientcertifikatet till en PFX-fil.</span><span class="sxs-lookup"><span data-stu-id="42c62-189">Export the public and private keys of the client certificate to a .pfx file.</span></span>  
4. <span data-ttu-id="42c62-190">Exportera den offentliga nyckeln i Base64-format till en CER-fil.</span><span class="sxs-lookup"><span data-stu-id="42c62-190">Export the public key in Base64 format to a .cer file.</span></span>  
5. <span data-ttu-id="42c62-191">I Serverhanteraren kontrollerar du att funktionen Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication är installerad.</span><span class="sxs-lookup"><span data-stu-id="42c62-191">In Server Manager, verify that the Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="42c62-192">Om den inte är installerad väljer du **Lägg till roller och funktioner** för att lägga till funktionen.</span><span class="sxs-lookup"><span data-stu-id="42c62-192">If it is not installed, select **Add Roles and Features** to add this feature.</span></span>  
6. <span data-ttu-id="42c62-193">I IIS-hanteraren dubbelklickar du på **Konfigurationsredigeraren** i webbplatsen som innehåller den virtuella katalogen för webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="42c62-193">In IIS Manager, double-click **Configuration Editor** in the website that contains the Web Service SDK virtual directory.</span></span> <span data-ttu-id="42c62-194">Det är viktigt att du markerar webbplatsen och inte den virtuella katalogen.</span><span class="sxs-lookup"><span data-stu-id="42c62-194">It is important to select the website, not the virtual directory.</span></span>  
7. <span data-ttu-id="42c62-195">Gå till avsnittet **system.webServer/security/authentication/iisClientCertificateMappingAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="42c62-195">Go to the **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="42c62-196">Ange aktiverat till **sant**.</span><span class="sxs-lookup"><span data-stu-id="42c62-196">Set enabled to **true**.</span></span>  
9. <span data-ttu-id="42c62-197">Ange oneToOneCertificateMappingsEnabled till **sant**.</span><span class="sxs-lookup"><span data-stu-id="42c62-197">Set oneToOneCertificateMappingsEnabled to **true**.</span></span>  
10. <span data-ttu-id="42c62-198">Klicka på knappen **...** bredvid oneToOneMappings och klicka sedan på länken **Lägg till**.</span><span class="sxs-lookup"><span data-stu-id="42c62-198">Click the **...** button next to oneToOneMappings, and then click the **Add** link.</span></span>  
11. <span data-ttu-id="42c62-199">Öppna CER-filen med Base64-format som du exporterade tidigare.</span><span class="sxs-lookup"><span data-stu-id="42c62-199">Open the Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="42c62-200">Ta bort *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* och eventuella radbrytningar.</span><span class="sxs-lookup"><span data-stu-id="42c62-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="42c62-201">Kopiera den resulterande strängen.</span><span class="sxs-lookup"><span data-stu-id="42c62-201">Copy the resulting string.</span></span>  
12. <span data-ttu-id="42c62-202">Ange certificate till strängen som du kopierade i föregående steg.</span><span class="sxs-lookup"><span data-stu-id="42c62-202">Set certificate to the string copied in the preceding step.</span></span>  
13. <span data-ttu-id="42c62-203">Ange aktiverat till **sant**.</span><span class="sxs-lookup"><span data-stu-id="42c62-203">Set enabled to **true**.</span></span>  
14. <span data-ttu-id="42c62-204">Ange userName till ett konto som är medlem i säkerhetsgruppen PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="42c62-204">Set userName to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="42c62-205">Använd formatet &lt;domän&gt;&#92;&lt;användarnamn&gt;.</span><span class="sxs-lookup"><span data-stu-id="42c62-205">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="42c62-206">Ange lösenordet till lämpligt kontolösenord och stäng Konfigurationsredigeraren.</span><span class="sxs-lookup"><span data-stu-id="42c62-206">Set the password to the appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="42c62-207">Klicka på länken **Använd**.</span><span class="sxs-lookup"><span data-stu-id="42c62-207">Click the **Apply** link.</span></span>  
17. <span data-ttu-id="42c62-208">I den virtuella katalogen för webbtjänst-SDK dubbelklickar du på **Autentisering**.</span><span class="sxs-lookup"><span data-stu-id="42c62-208">In the Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="42c62-209">Kontrollera att ASP.NET-personifiering och Grundläggande autentisering är **aktiverat** och att alla andra objekt är **inaktiverade**.</span><span class="sxs-lookup"><span data-stu-id="42c62-209">Verify that ASP.NET Impersonation and Basic Authentication are set to **Enabled**, and that all other items are set to **Disabled**.</span></span>  
19. <span data-ttu-id="42c62-210">Dubbelklicka på **SSL-inställningar** i den virtuella katalogen för webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="42c62-210">In the Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="42c62-211">Ange Klientcertifikat till **Acceptera** och klicka på **Använd**.</span><span class="sxs-lookup"><span data-stu-id="42c62-211">Set Client Certificates to **Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="42c62-212">Kopiera PFX-filen som du exporterade tidigare till servern som kör AD FS-adaptern.</span><span class="sxs-lookup"><span data-stu-id="42c62-212">Copy the .pfx file you exported earlier to the server that is running the AD FS adapter.</span></span>  
22. <span data-ttu-id="42c62-213">Importera PFX-filen till den lokala datorns personliga certifikatarkiv.</span><span class="sxs-lookup"><span data-stu-id="42c62-213">Import the .pfx file to the local computer personal certificate store.</span></span>  
23. <span data-ttu-id="42c62-214">Högerklicka och välj **Hantera privata nycklar** och ge sedan läsbehörighet till kontot som du använde för att logga in till AD FS-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="42c62-214">Right-click and select **Manage Private Keys**, and then grant read access to the account you used to sign in to the AD FS service.</span></span>  
24. <span data-ttu-id="42c62-215">Öppna klientcertifikatet och kopiera tumavtrycket från fliken **Information**.</span><span class="sxs-lookup"><span data-stu-id="42c62-215">Open the client certificate and copy the thumbprint from the **Details** tab.</span></span>  
25. <span data-ttu-id="42c62-216">I filen MultiFactorAuthenticationAdfsAdapter.config anger du **WebServiceSdkCertificateThumbprint** till strängen som du kopierade i föregående steg.</span><span class="sxs-lookup"><span data-stu-id="42c62-216">In the MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** to the string copied in the previous step.</span></span>  

<span data-ttu-id="42c62-217">Registrera adaptern genom att köra skriptet \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 i PowerShell.</span><span class="sxs-lookup"><span data-stu-id="42c62-217">Finally, to register the adapter, run the \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="42c62-218">Adaptern registreras som WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="42c62-218">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="42c62-219">Starta om AD FS-tjänsten för att registreringen ska börja gälla.</span><span class="sxs-lookup"><span data-stu-id="42c62-219">Restart the AD FS service for the registration to take effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="42c62-220">Skydda Azure AD-resurser med hjälp av AD FS</span><span class="sxs-lookup"><span data-stu-id="42c62-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="42c62-221">Ställ in en anspråksregel så att Active Directory Federation Services genererar multipleauthn-kravet när en användare utför tvåstegsverifiering om du vill skydda din molnresurs.</span><span class="sxs-lookup"><span data-stu-id="42c62-221">To secure your cloud resource, set up a claims rule so that Active Directory Federation Services emits the multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="42c62-222">Det här anspråket överförs till Azure AD.</span><span class="sxs-lookup"><span data-stu-id="42c62-222">This claim is passed on to Azure AD.</span></span> <span data-ttu-id="42c62-223">Följ dessa steg:</span><span class="sxs-lookup"><span data-stu-id="42c62-223">Follow this procedure to walk through the steps:</span></span>

1. <span data-ttu-id="42c62-224">Öppna AD FS-hantering.</span><span class="sxs-lookup"><span data-stu-id="42c62-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="42c62-225">Välj **Förlitande partsförtroenden** till vänster.</span><span class="sxs-lookup"><span data-stu-id="42c62-225">On the left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="42c62-226">Högerklicka på **Microsoft Office 365 Identity Platform** och välj **Redigera anspråksregler...**</span><span class="sxs-lookup"><span data-stu-id="42c62-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Molnet](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="42c62-228">För Utfärdande av transformeringsregler klickar du på **Lägg till regel.**</span><span class="sxs-lookup"><span data-stu-id="42c62-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Molnet](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="42c62-230">I guiden Lägg till anspråksregel för transformering väljer du **Släpp igenom eller Filtrera ett inkommande anspråk** i listrutan och klickar sedan på **Nästa**.</span><span class="sxs-lookup"><span data-stu-id="42c62-230">On the Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from the drop-down and click **Next**.</span></span>

   ![Molnet](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="42c62-232">Namnge din regel.</span><span class="sxs-lookup"><span data-stu-id="42c62-232">Give your rule a name.</span></span>
7. <span data-ttu-id="42c62-233">Välj **Autentiseringsmetodreferenser** som den inkommande anspråkstypen.</span><span class="sxs-lookup"><span data-stu-id="42c62-233">Select **Authentication Methods References** as the Incoming claim type.</span></span>
8. <span data-ttu-id="42c62-234">Välj **Släpp igenom alla anspråksvärden**.</span><span class="sxs-lookup"><span data-stu-id="42c62-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="42c62-235">![Guiden Lägg till anspråksregel för transformering](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="42c62-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="42c62-236">Klicka på **Slutför**.</span><span class="sxs-lookup"><span data-stu-id="42c62-236">Click **Finish**.</span></span> <span data-ttu-id="42c62-237">Stäng AD FS-hanteringskonsolen.</span><span class="sxs-lookup"><span data-stu-id="42c62-237">Close the AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="42c62-238">Relaterade ämnen</span><span class="sxs-lookup"><span data-stu-id="42c62-238">Related topics</span></span>
<span data-ttu-id="42c62-239">Hjälp med felsökning finns i [Azure Multi-Factor Authentication FAQs (Vanliga frågor och svar om Azure Multi-Factor Authentication)](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="42c62-239">For troubleshooting help, see the [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
