---
title: aaaMFA Server med AD FS i Windows Server | Microsoft Docs
description: "Den här artikeln beskriver hur tooget igång med Azure Multi-Factor Authentication och AD FS i Windows Server 2012 R2 och 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 656785abcc63a020add765a86670b488a3b84b51
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-toowork-with-ad-fs-in-windows-server"></a><span data-ttu-id="29627-103">Konfigurera Azure-flerfunktionsautentisering toowork med AD FS i Windows Server</span><span class="sxs-lookup"><span data-stu-id="29627-103">Configure Azure Multi-Factor Authentication Server toowork with AD FS in Windows Server</span></span>
<span data-ttu-id="29627-104">Om du använder Active Directory Federation Services (AD FS) och vill toosecure molnet eller lokala resurser kan du konfigurera Azure Multi-Factor Authentication-servern toowork med AD FS.</span><span class="sxs-lookup"><span data-stu-id="29627-104">If you use Active Directory Federation Services (AD FS) and want toosecure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server toowork with AD FS.</span></span> <span data-ttu-id="29627-105">Den här konfigurationen utlöser tvåstegsverifiering för slutpunkter med högt värde.</span><span class="sxs-lookup"><span data-stu-id="29627-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="29627-106">I den här artikeln diskuterar vi hur du använder Azure Multi-Factor Authentication Server med AD FS i Windows Server 2012 R2 eller Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="29627-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="29627-107">Mer information finns i avsnittet om hur för[skydda molnresurser och lokala resurser med Azure Multi-Factor Authentication-Server med AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="29627-107">For more information, read about how too[secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="29627-108">Skydda Windows Server AD FS med Azure Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="29627-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="29627-109">När du installerar Azure Multi-Factor Authentication-servern har hello följande alternativ:</span><span class="sxs-lookup"><span data-stu-id="29627-109">When you install Azure Multi-Factor Authentication Server, you have hello following options:</span></span>

* <span data-ttu-id="29627-110">Installera Azure Multi-Factor Authentication-servern lokalt på hello samma server som AD FS</span><span class="sxs-lookup"><span data-stu-id="29627-110">Install Azure Multi-Factor Authentication Server locally on hello same server as AD FS</span></span>
* <span data-ttu-id="29627-111">Installera hello Azure Multi-Factor Authentication adaptern lokalt på hello AD FS-servern och sedan installera Multi-Factor Authentication-servern på en annan dator</span><span class="sxs-lookup"><span data-stu-id="29627-111">Install hello Azure Multi-Factor Authentication adapter locally on hello AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="29627-112">Innan du börjar bör du vara medveten om hello följande information:</span><span class="sxs-lookup"><span data-stu-id="29627-112">Before you begin, be aware of hello following information:</span></span>

* <span data-ttu-id="29627-113">Du är inte obligatoriska tooinstall Azure Multi-Factor Authentication-servern på AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="29627-113">You are not required tooinstall Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="29627-114">Dock måste du installera hello Multi-Factor Authentication adaptern för AD FS på en Windows Server 2012 R2 eller Windows Server 2016 som kör AD FS.</span><span class="sxs-lookup"><span data-stu-id="29627-114">However, you must install hello Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="29627-115">Du kan installera hello server på en annan dator om det är en version som stöds och du installerar separat hello AD FS-adaptern på din AD FS-federationsserver.</span><span class="sxs-lookup"><span data-stu-id="29627-115">You can install hello server on a different computer if it is a supported version and you install hello AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="29627-116">Se hello följande procedurer toolearn hur tooinstall hello kortet separat.</span><span class="sxs-lookup"><span data-stu-id="29627-116">See hello following procedures toolearn how tooinstall hello adapter separately.</span></span>
* <span data-ttu-id="29627-117">Om din organisation använder SMS eller mobilapp verifieringsmetoderna hello strängar som definierats i Företagsinställningar innehålla en platshållare <$*$application_name*$>.</span><span class="sxs-lookup"><span data-stu-id="29627-117">If your organization is using text message or mobile app verification methods, hello strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="29627-118">Du kan ange namnet på ett program som ersätter platshållaren i MFA Server v7.1.</span><span class="sxs-lookup"><span data-stu-id="29627-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="29627-119">I v7.0 eller äldre ersätts platshållaren automatiskt inte när du använder hello AD FS-adaptern.</span><span class="sxs-lookup"><span data-stu-id="29627-119">In v7.0 or older, this placeholder is not automatically replaced when you use hello AD FS adapter.</span></span> <span data-ttu-id="29627-120">För dessa äldre versioner att ta bort hello platshållare från strängar som hello när du skyddar AD FS.</span><span class="sxs-lookup"><span data-stu-id="29627-120">For those older versions, remove hello placeholder from hello appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="29627-121">hello-konto som du använder toosign i måste ha användaren rättigheter toocreate säkerhetsgrupper i Active Directory-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="29627-121">hello account that you use toosign in must have user rights toocreate security groups in your Active Directory service.</span></span>
* <span data-ttu-id="29627-122">Installationsguiden för hello Multi-Factor Authentication AD FS-adapter skapar en säkerhetsgrupp med namnet PhoneFactor Admins i din instans av Active Directory.</span><span class="sxs-lookup"><span data-stu-id="29627-122">hello Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="29627-123">Hello AD FS-tjänstkontot för toothis för federation tjänstgruppen lägger sedan till.</span><span class="sxs-lookup"><span data-stu-id="29627-123">It then adds hello AD FS service account of your federation service toothis group.</span></span> <span data-ttu-id="29627-124">Kontrollera på domänkontrollanten som hello gruppen PhoneFactor Admins faktiskt har skapats och att hello AD FS-tjänstkontot är medlem i den här gruppen.</span><span class="sxs-lookup"><span data-stu-id="29627-124">Verify on your domain controller that hello PhoneFactor Admins group is indeed created and that hello AD FS service account is a member of this group.</span></span> <span data-ttu-id="29627-125">Om det behövs kan du manuellt lägga till hello AD FS-tjänsten konto toohello gruppen PhoneFactor Admins på domänkontrollanten.</span><span class="sxs-lookup"><span data-stu-id="29627-125">If necessary, manually add hello AD FS service account toohello PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="29627-126">Läs mer om information om hur du installerar hello webbtjänst-SDK med hello användarportalen [distribuera hello användarportalen för Azure Multi-Factor Authentication-servern.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="29627-126">For information about installing hello Web Service SDK with hello user portal, read about [deploying hello user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-hello-ad-fs-server"></a><span data-ttu-id="29627-127">Installera Azure Multi-Factor Authentication-servern lokalt på hello AD FS-server</span><span class="sxs-lookup"><span data-stu-id="29627-127">Install Azure Multi-Factor Authentication Server locally on hello AD FS server</span></span>
1. <span data-ttu-id="29627-128">Hämta och installera Azure Multi-Factor Authentication Server på AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="29627-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="29627-129">Mer information om installationen finns i [Komma igång med Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="29627-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="29627-130">I hanteringskonsolen för hello Azure Multi-Factor Authentication-servern klickar du på hello **AD FS** ikon.</span><span class="sxs-lookup"><span data-stu-id="29627-130">In hello Azure Multi-Factor Authentication Server management console, click hello **AD FS** icon.</span></span> <span data-ttu-id="29627-131">Välj alternativ för hello **Tillåt användarregistrering** och **användarna tooselect metoden**.</span><span class="sxs-lookup"><span data-stu-id="29627-131">Select hello options **Allow user enrollment** and **Allow users tooselect method**.</span></span>
3. <span data-ttu-id="29627-132">Välj eventuella ytterligare alternativ som du vill att toospecify för din organisation.</span><span class="sxs-lookup"><span data-stu-id="29627-132">Select any additional options you'd like toospecify for your organization.</span></span>
4. <span data-ttu-id="29627-133">Klicka på **Installera AD FS-adapter**.</span><span class="sxs-lookup"><span data-stu-id="29627-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="29627-134"><center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="29627-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="29627-135">Om hello Active Directory-fönstret visas, betyder det två saker.</span><span class="sxs-lookup"><span data-stu-id="29627-135">If hello Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="29627-136">Datorn är domänansluten tooa domän och hello Active Directory-konfigurationen för säker kommunikation mellan hello AD FS-adaptern och hello Multi-Factor Authentication-tjänsten är ofullständig.</span><span class="sxs-lookup"><span data-stu-id="29627-136">Your computer is joined tooa domain, and hello Active Directory configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="29627-137">Klicka på **nästa** tooautomatically slutföra den här konfigurationen eller markera hello **hoppa över automatisk konfiguration av Active Directory och konfigurera inställningarna manuellt** kryssrutan.</span><span class="sxs-lookup"><span data-stu-id="29627-137">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="29627-138">Klicka på **Nästa**.</span><span class="sxs-lookup"><span data-stu-id="29627-138">Click **Next**.</span></span>
6. <span data-ttu-id="29627-139">Om hello lokal grupp windows visas, betyder det två saker.</span><span class="sxs-lookup"><span data-stu-id="29627-139">If hello Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="29627-140">Datorn är inte kopplade tooa domän och hello lokala gruppens konfiguration för säker kommunikation mellan hello AD FS-adaptern och hello Multi-Factor Authentication-tjänsten är ofullständig.</span><span class="sxs-lookup"><span data-stu-id="29627-140">Your computer is not joined tooa domain, and hello local group configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="29627-141">Klicka på **nästa** tooautomatically slutföra den här konfigurationen eller markera hello **hoppa över automatisk konfiguration av lokal grupp och konfigurera inställningarna manuellt** kryssrutan.</span><span class="sxs-lookup"><span data-stu-id="29627-141">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="29627-142">Klicka på **Nästa**.</span><span class="sxs-lookup"><span data-stu-id="29627-142">Click **Next**.</span></span>
7. <span data-ttu-id="29627-143">I installationsguiden för hello klickar du på **nästa**.</span><span class="sxs-lookup"><span data-stu-id="29627-143">In hello installation wizard, click **Next**.</span></span> <span data-ttu-id="29627-144">Azure Multi-Factor Authentication-servern skapar hello PhoneFactor Admins-gruppen och lägger till hello AD FS-tjänsten konto toohello gruppen PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="29627-144">Azure Multi-Factor Authentication Server creates hello PhoneFactor Admins group and adds hello AD FS service account toohello PhoneFactor Admins group.</span></span>
   <span data-ttu-id="29627-145"><center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="29627-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="29627-146">På hello **starta installationsprogrammet** klickar du på **nästa**.</span><span class="sxs-lookup"><span data-stu-id="29627-146">On hello **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="29627-147">Klicka i hello Multi-Factor Authentication AD FS kortet installer **nästa**.</span><span class="sxs-lookup"><span data-stu-id="29627-147">In hello Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="29627-148">Klicka på **Stäng** när hello installationen är klar.</span><span class="sxs-lookup"><span data-stu-id="29627-148">Click **Close** when hello installation is finished.</span></span>
11. <span data-ttu-id="29627-149">När hello nätverkskort har installerats, måste du registrera den med AD FS.</span><span class="sxs-lookup"><span data-stu-id="29627-149">When hello adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="29627-150">Öppna Windows PowerShell och kör följande kommando hello:</span><span class="sxs-lookup"><span data-stu-id="29627-150">Open Windows PowerShell and run hello following command:</span></span><br><span data-ttu-id="29627-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="29627-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="29627-152">toouse nätverkskortet nyregistrerade redigera hello globala autentiseringsprincipen i AD FS.</span><span class="sxs-lookup"><span data-stu-id="29627-152">toouse your newly registered adapter, edit hello global authentication policy in AD FS.</span></span> <span data-ttu-id="29627-153">I hello AD FS-hanteringskonsolen gå toohello **autentiseringsprinciper** nod.</span><span class="sxs-lookup"><span data-stu-id="29627-153">In hello AD FS management console, go toohello **Authentication Policies** node.</span></span> <span data-ttu-id="29627-154">I hello **Multifaktorautentisering** klickar du på hello **redigera** länka nästa toohello **globala inställningar** avsnitt.</span><span class="sxs-lookup"><span data-stu-id="29627-154">In hello **Multi-factor Authentication** section, click hello **Edit** link next toohello **Global Settings** section.</span></span> <span data-ttu-id="29627-155">I hello **redigera Global autentiseringsprincip** väljer **Multifaktorautentisering** som ytterligare autentiseringsmetod och klicka sedan på **OK**.</span><span class="sxs-lookup"><span data-stu-id="29627-155">In hello **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="29627-156">hello adaptern registreras som WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="29627-156">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="29627-157">Starta om hello AD FS-tjänsten för hello registrering tootake effekt.</span><span class="sxs-lookup"><span data-stu-id="29627-157">Restart hello AD FS service for hello registration tootake effect.</span></span>

<span data-ttu-id="29627-158"><center>![Moln](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="29627-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="29627-159">Nu har Multi-Factor Authentication-Server ställts in toobe en ytterligare autentisering providern toouse med AD FS.</span><span class="sxs-lookup"><span data-stu-id="29627-159">At this point, Multi-Factor Authentication Server is set up toobe an additional authentication provider toouse with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-hello-ad-fs-adapter-by-using-hello-web-service-sdk"></a><span data-ttu-id="29627-160">Installera en fristående instans av hello AD FS-adapter med hello webbtjänst-SDK</span><span class="sxs-lookup"><span data-stu-id="29627-160">Install a standalone instance of hello AD FS adapter by using hello Web Service SDK</span></span>
1. <span data-ttu-id="29627-161">Installera hello webbtjänst-SDK på hello-server som kör Multi-Factor Authentication-servern.</span><span class="sxs-lookup"><span data-stu-id="29627-161">Install hello Web Service SDK on hello server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="29627-162">Kopiera hello följande filer från hello \program\multi-Factor-Factor Authentication-servern toohello katalogserver när du planerar tooinstall hello AD FS-adaptern:</span><span class="sxs-lookup"><span data-stu-id="29627-162">Copy hello following files from hello \Program Files\Multi-Factor Authentication Server directory toohello server on which you plan tooinstall hello AD FS adapter:</span></span>
   * <span data-ttu-id="29627-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="29627-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="29627-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="29627-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="29627-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="29627-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="29627-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="29627-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="29627-167">Kör installationsfilen för hello sedan filerna MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="29627-167">Run hello MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="29627-168">Klicka i hello Multi-Factor Authentication AD FS kortet installer **nästa** toostart hello installation.</span><span class="sxs-lookup"><span data-stu-id="29627-168">In hello Multi-Factor Authentication AD FS adapter installer, click **Next** toostart hello installation.</span></span>
5. <span data-ttu-id="29627-169">Klicka på **Stäng** när hello installationen är klar.</span><span class="sxs-lookup"><span data-stu-id="29627-169">Click **Close** when hello installation is finished.</span></span>

## <a name="edit-hello-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="29627-170">Redigera hello MultiFactorAuthenticationAdfsAdapter.config fil</span><span class="sxs-lookup"><span data-stu-id="29627-170">Edit hello MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="29627-171">Följ dessa steg tooedit hello MultiFactorAuthenticationAdfsAdapter.config fil:</span><span class="sxs-lookup"><span data-stu-id="29627-171">Follow these steps tooedit hello MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="29627-172">Ange hello **UseWebServiceSdk** nod för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="29627-172">Set hello **UseWebServiceSdk** node too**true**.</span></span>  
2. <span data-ttu-id="29627-173">Hello-värdet för **in WebServiceSdkUrl** toohello URL för hello Multi-Factor Authentication webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="29627-173">Set hello value for **WebServiceSdkUrl** toohello URL of hello Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="29627-174">Till exempel: *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, där *certificatename* är hello namnet på ditt certifikat.</span><span class="sxs-lookup"><span data-stu-id="29627-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is hello name of your certificate.</span></span>  
3. <span data-ttu-id="29627-175">Redigera hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 skript genom att lägga till *- ConfigurationFilePath &lt;sökväg&gt;*  toohello slutet av hello `Register-AdfsAuthenticationProvider` kommando, där  *&lt;sökväg&gt;*  är hello fullständig sökväg toohello MultiFactorAuthenticationAdfsAdapter.config fil.</span><span class="sxs-lookup"><span data-stu-id="29627-175">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* toohello end of hello `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="29627-176">Konfigurera hello webbtjänst-SDK med ett användarnamn och lösenord</span><span class="sxs-lookup"><span data-stu-id="29627-176">Configure hello Web Service SDK with a username and password</span></span>
<span data-ttu-id="29627-177">Det finns två alternativ för att konfigurera hello webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="29627-177">There are two options for configuring hello Web Service SDK.</span></span> <span data-ttu-id="29627-178">hello först är med ett användarnamn och lösenord är hello andra med ett klientcertifikat.</span><span class="sxs-lookup"><span data-stu-id="29627-178">hello first is with a username and password, hello second is with a client certificate.</span></span> <span data-ttu-id="29627-179">Följ dessa steg för hello första alternativet, eller kan du gå vidare för hello andra.</span><span class="sxs-lookup"><span data-stu-id="29627-179">Follow these steps for hello first option, or skip ahead for hello second.</span></span>  

1. <span data-ttu-id="29627-180">Hello-värdet för **in WebServiceSdkUsername** tooan konto som är medlem i hello säkerhetsgruppen PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="29627-180">Set hello value for **WebServiceSdkUsername** tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="29627-181">Använd hello &lt;domän&gt;&#92;&lt; användarnamnet&gt; format.</span><span class="sxs-lookup"><span data-stu-id="29627-181">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="29627-182">Hello-värdet för **in WebServiceSdkPassword** toohello rätt kontolösenord.</span><span class="sxs-lookup"><span data-stu-id="29627-182">Set hello value for **WebServiceSdkPassword** toohello appropriate account password.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="29627-183">Konfigurera hello webbtjänst-SDK med ett klientcertifikat</span><span class="sxs-lookup"><span data-stu-id="29627-183">Configure hello Web Service SDK with a client certificate</span></span>
<span data-ttu-id="29627-184">Om du inte vill toouse ett användarnamn och lösenord, följer du dessa steg tooconfigure hello webbtjänst-SDK med ett klientcertifikat.</span><span class="sxs-lookup"><span data-stu-id="29627-184">If you don't want toouse a username and password, follow these steps tooconfigure hello Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="29627-185">Hämta ett certifikat från en certifikatutfärdare för hello-server som kör hello webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="29627-185">Obtain a client certificate from a certificate authority for hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="29627-186">Lär dig hur för[Hämta klientcertifikat](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="29627-186">Learn how too[obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="29627-187">Importera hello klienten certifikat toohello lokala datorns personliga certifikatarkiv på hello-server som kör hello webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="29627-187">Import hello client certificate toohello local computer personal certificate store on hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="29627-188">Kontrollera att hello certifikatutfärdarens offentliga certifikat i certifikatarkivet för betrodda rotcertifikat.</span><span class="sxs-lookup"><span data-stu-id="29627-188">Make sure that hello certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="29627-189">Exportera hello offentliga och privata nycklar hello klienten certifikatet tooa .pfx-fil.</span><span class="sxs-lookup"><span data-stu-id="29627-189">Export hello public and private keys of hello client certificate tooa .pfx file.</span></span>  
4. <span data-ttu-id="29627-190">Exportera hello offentliga nyckeln i Base64-format tooa .cer-fil.</span><span class="sxs-lookup"><span data-stu-id="29627-190">Export hello public key in Base64 format tooa .cer file.</span></span>  
5. <span data-ttu-id="29627-191">I Serverhanteraren Kontrollera hello webbserver (IIS) \Web Server\Security\IIS autentisering av klientcertifikatsmappning funktionen är installerad.</span><span class="sxs-lookup"><span data-stu-id="29627-191">In Server Manager, verify that hello Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="29627-192">Om den inte är installerad väljer **Lägg till roller och funktioner** tooadd den här funktionen.</span><span class="sxs-lookup"><span data-stu-id="29627-192">If it is not installed, select **Add Roles and Features** tooadd this feature.</span></span>  
6. <span data-ttu-id="29627-193">I IIS-hanteraren, dubbelklicka på **Konfigurationsredigeraren** i hello-webbplats som innehåller hello webbtjänst-SDK virtuell katalog.</span><span class="sxs-lookup"><span data-stu-id="29627-193">In IIS Manager, double-click **Configuration Editor** in hello website that contains hello Web Service SDK virtual directory.</span></span> <span data-ttu-id="29627-194">Det är viktigt tooselect hello webbplats, inte hello virtuell katalog.</span><span class="sxs-lookup"><span data-stu-id="29627-194">It is important tooselect hello website, not hello virtual directory.</span></span>  
7. <span data-ttu-id="29627-195">Gå toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** avsnitt.</span><span class="sxs-lookup"><span data-stu-id="29627-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="29627-196">Ange aktiverad för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="29627-196">Set enabled too**true**.</span></span>  
9. <span data-ttu-id="29627-197">Ställ in oneToOneCertificateMappingsEnabled för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="29627-197">Set oneToOneCertificateMappingsEnabled too**true**.</span></span>  
10. <span data-ttu-id="29627-198">Klicka på hello **...**  knappen Nästa toooneToOneMappings och klicka sedan på hello **Lägg till** länk.</span><span class="sxs-lookup"><span data-stu-id="29627-198">Click hello **...** button next toooneToOneMappings, and then click hello **Add** link.</span></span>  
11. <span data-ttu-id="29627-199">Öppna hello Base64 .cer-fil som du exporterade tidigare.</span><span class="sxs-lookup"><span data-stu-id="29627-199">Open hello Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="29627-200">Ta bort *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* och eventuella radbrytningar.</span><span class="sxs-lookup"><span data-stu-id="29627-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="29627-201">Kopiera hello resulterande strängen.</span><span class="sxs-lookup"><span data-stu-id="29627-201">Copy hello resulting string.</span></span>  
12. <span data-ttu-id="29627-202">Ange certifikatet toohello strängen som du kopierade i föregående steg hello.</span><span class="sxs-lookup"><span data-stu-id="29627-202">Set certificate toohello string copied in hello preceding step.</span></span>  
13. <span data-ttu-id="29627-203">Ange aktiverad för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="29627-203">Set enabled too**true**.</span></span>  
14. <span data-ttu-id="29627-204">Ange användarnamn tooan konto som är medlem i hello säkerhetsgruppen PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="29627-204">Set userName tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="29627-205">Använd hello &lt;domän&gt;&#92;&lt; användarnamnet&gt; format.</span><span class="sxs-lookup"><span data-stu-id="29627-205">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="29627-206">Ange hello lösenord toohello rätt kontolösenord och stäng sedan Redigeraren för säkerhetskonfiguration.</span><span class="sxs-lookup"><span data-stu-id="29627-206">Set hello password toohello appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="29627-207">Klicka på hello **tillämpa** länk.</span><span class="sxs-lookup"><span data-stu-id="29627-207">Click hello **Apply** link.</span></span>  
17. <span data-ttu-id="29627-208">Dubbelklicka i hello webbtjänst-SDK virtuella katalogen **autentisering**.</span><span class="sxs-lookup"><span data-stu-id="29627-208">In hello Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="29627-209">Kontrollera att ASP.NET Impersonation and Basic Authentication är inställda för**aktiverad**, och alla andra objekt för**inaktiverade**.</span><span class="sxs-lookup"><span data-stu-id="29627-209">Verify that ASP.NET Impersonation and Basic Authentication are set too**Enabled**, and that all other items are set too**Disabled**.</span></span>  
19. <span data-ttu-id="29627-210">Dubbelklicka i hello webbtjänst-SDK virtuella katalogen **SSL-inställningar**.</span><span class="sxs-lookup"><span data-stu-id="29627-210">In hello Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="29627-211">Ställ in klientcertifikat för**acceptera**, och klicka sedan på **tillämpa**.</span><span class="sxs-lookup"><span data-stu-id="29627-211">Set Client Certificates too**Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="29627-212">Kopiera hello PFX-filen som du exporterade tidigare toohello-server som kör hello AD FS-adaptern.</span><span class="sxs-lookup"><span data-stu-id="29627-212">Copy hello .pfx file you exported earlier toohello server that is running hello AD FS adapter.</span></span>  
22. <span data-ttu-id="29627-213">Importera hello .pfx-filen toohello lokala datorns personliga certifikatarkiv.</span><span class="sxs-lookup"><span data-stu-id="29627-213">Import hello .pfx file toohello local computer personal certificate store.</span></span>  
23. <span data-ttu-id="29627-214">Högerklicka och välj **hantera privata nycklar**, och sedan bevilja läsbehörighet toohello konto du använde toosign i toohello AD FS-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="29627-214">Right-click and select **Manage Private Keys**, and then grant read access toohello account you used toosign in toohello AD FS service.</span></span>  
24. <span data-ttu-id="29627-215">Öppna hello klienten certifikat och kopiera hello tumavtrycket från hello **information** fliken.</span><span class="sxs-lookup"><span data-stu-id="29627-215">Open hello client certificate and copy hello thumbprint from hello **Details** tab.</span></span>  
25. <span data-ttu-id="29627-216">I filen MultiFactorAuthenticationAdfsAdapter.config hello anger **WebServiceSdkCertificateThumbprint** toohello sträng kopierade i föregående steg i hello.</span><span class="sxs-lookup"><span data-stu-id="29627-216">In hello MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** toohello string copied in hello previous step.</span></span>  

<span data-ttu-id="29627-217">Slutligen tooregister hello-kort, kör hello \program\multi-Factor-Factor Authentication Server\Register-multifactorauthenticationadfsadapter.ps1 i PowerShell.</span><span class="sxs-lookup"><span data-stu-id="29627-217">Finally, tooregister hello adapter, run hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="29627-218">hello adaptern registreras som WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="29627-218">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="29627-219">Starta om hello AD FS-tjänsten för hello registrering tootake effekt.</span><span class="sxs-lookup"><span data-stu-id="29627-219">Restart hello AD FS service for hello registration tootake effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="29627-220">Skydda Azure AD-resurser med hjälp av AD FS</span><span class="sxs-lookup"><span data-stu-id="29627-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="29627-221">toosecure din molnresursen, konfigurera en regel för anspråk så att Active Directory Federation Services avger hello multipleauthn anspråk när en användare utför tvåstegsverifiering har.</span><span class="sxs-lookup"><span data-stu-id="29627-221">toosecure your cloud resource, set up a claims rule so that Active Directory Federation Services emits hello multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="29627-222">Denna begäran har skickats på tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="29627-222">This claim is passed on tooAzure AD.</span></span> <span data-ttu-id="29627-223">Följ den här proceduren toowalk hello stegen:</span><span class="sxs-lookup"><span data-stu-id="29627-223">Follow this procedure toowalk through hello steps:</span></span>

1. <span data-ttu-id="29627-224">Öppna AD FS-hantering.</span><span class="sxs-lookup"><span data-stu-id="29627-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="29627-225">Hello vänster markerar **förtroende för förlitande part**.</span><span class="sxs-lookup"><span data-stu-id="29627-225">On hello left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="29627-226">Högerklicka på **Microsoft Office 365 Identity Platform** och välj **Redigera anspråksregler...**</span><span class="sxs-lookup"><span data-stu-id="29627-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Molnet](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="29627-228">För Utfärdande av transformeringsregler klickar du på **Lägg till regel.**</span><span class="sxs-lookup"><span data-stu-id="29627-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Molnet](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="29627-230">På Hej guiden Lägg till transformera anspråk, Välj **släpp igenom eller filtrera ett inkommande anspråk** hello listrutan och klicka på **nästa**.</span><span class="sxs-lookup"><span data-stu-id="29627-230">On hello Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from hello drop-down and click **Next**.</span></span>

   ![Molnet](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="29627-232">Namnge din regel.</span><span class="sxs-lookup"><span data-stu-id="29627-232">Give your rule a name.</span></span>
7. <span data-ttu-id="29627-233">Välj **autentiseringsmetodernas referenser** hello inkommande anspråkstyp.</span><span class="sxs-lookup"><span data-stu-id="29627-233">Select **Authentication Methods References** as hello Incoming claim type.</span></span>
8. <span data-ttu-id="29627-234">Välj **Släpp igenom alla anspråksvärden**.</span><span class="sxs-lookup"><span data-stu-id="29627-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="29627-235">![Guiden Lägg till anspråksregel för transformering](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="29627-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="29627-236">Klicka på **Slutför**.</span><span class="sxs-lookup"><span data-stu-id="29627-236">Click **Finish**.</span></span> <span data-ttu-id="29627-237">Stäng hello AD FS-hanteringskonsol.</span><span class="sxs-lookup"><span data-stu-id="29627-237">Close hello AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="29627-238">Relaterade ämnen</span><span class="sxs-lookup"><span data-stu-id="29627-238">Related topics</span></span>
<span data-ttu-id="29627-239">Hjälp med felsökning finns hello [Azure Multi-Factor Authentication vanliga frågor och svar](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="29627-239">For troubleshooting help, see hello [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
