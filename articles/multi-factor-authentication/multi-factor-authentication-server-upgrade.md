---
title: Uppgraderingen av Azure MFA-Server | Microsoft Docs
description: "Steg och vägledning för att uppgradera Azure Multi-Factor Authentication-Server till en nyare version."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="6e5af-103">Uppgradera till den senaste Azure Multi-Factor Authentication-servern</span><span class="sxs-lookup"><span data-stu-id="6e5af-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="6e5af-104">Den här artikeln vägleder dig genom processen med att uppgradera Azure Multi-Factor Authentication (MFA) Server v6.0 eller högre.</span><span class="sxs-lookup"><span data-stu-id="6e5af-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="6e5af-105">Om du behöver uppgradera en gammal version av PhoneFactor Agent finns [uppgradera PhoneFactor-agenten till Azure-flerfunktionsautentisering](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="6e5af-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="6e5af-106">Om du uppgraderar från v6.x eller äldre till v7.x eller senare, ändra alla komponenter från .NET 2.0 till .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="6e5af-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="6e5af-107">Alla komponenter måste också Microsoft Visual C++ 2015 Redistributable Update 1 eller högre.</span><span class="sxs-lookup"><span data-stu-id="6e5af-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="6e5af-108">MFA-Server-installationsprogrammet installerar x86 och x64 versioner av dessa komponenter om de inte redan har installerats.</span><span class="sxs-lookup"><span data-stu-id="6e5af-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="6e5af-109">Om Användarportalen och Mobilappwebbtjänsten körs på separata servrar, måste du installera dessa paket innan du uppgraderar komponenterna.</span><span class="sxs-lookup"><span data-stu-id="6e5af-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="6e5af-110">Du kan söka efter den senaste uppdateringen för Microsoft Visual C++ 2015 Redistributable på den [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="6e5af-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="6e5af-111">Installera den senaste versionen av Azure MFA-Server</span><span class="sxs-lookup"><span data-stu-id="6e5af-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="6e5af-112">Följ instruktionerna i [hämta Azure Multi-Factor Authentication-servern](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) att hämta den senaste versionen av Azure MFA-Server.</span><span class="sxs-lookup"><span data-stu-id="6e5af-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="6e5af-113">Gör en säkerhetskopia av filen MFA-servern data finns i C:\Program program\multi-Factor Authentication Server\Data\PhoneFactor.pfdata (förutsatt att installera standardplatsen) på din MFA-huvudservern.</span><span class="sxs-lookup"><span data-stu-id="6e5af-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="6e5af-114">Om du kör flera servrar för hög tillgänglighet, ändra klientsystem som autentiseras till MFA-servern så att de slutar skickar trafik till de servrar som uppgraderas.</span><span class="sxs-lookup"><span data-stu-id="6e5af-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="6e5af-115">Om du använder en belastningsutjämnare, ta bort en MFA-Server från belastningsutjämnaren, uppgraderingen och Lägg sedan till servern i servergruppen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="6e5af-116">Kör installationsprogrammet för nya på varje MFA-Server.</span><span class="sxs-lookup"><span data-stu-id="6e5af-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="6e5af-117">Uppgradera först underordnade servrar eftersom de kan läsa den gamla datafilen replikeras av hanteraren.</span><span class="sxs-lookup"><span data-stu-id="6e5af-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="6e5af-118">Du behöver inte avinstallera den aktuella MFA-servern innan du kör installationsprogrammet.</span><span class="sxs-lookup"><span data-stu-id="6e5af-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="6e5af-119">Installationsprogrammet utför en uppgradering på plats.</span><span class="sxs-lookup"><span data-stu-id="6e5af-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="6e5af-120">Installationssökvägen hämtas från registret från den tidigare installationen, så installeras på samma plats (till exempel C:\Program program\multi-Factor Authentication-servern).</span><span class="sxs-lookup"><span data-stu-id="6e5af-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="6e5af-121">Acceptera uppmaningen om du uppmanas att installera Microsoft Visual C++ 2015 Redistributable uppdateringspaketet.</span><span class="sxs-lookup"><span data-stu-id="6e5af-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="6e5af-122">X86 och x64 versioner av paketet installeras.</span><span class="sxs-lookup"><span data-stu-id="6e5af-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="6e5af-123">Om du använder SDK för webbtjänst, uppmanas du att installera ny webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="6e5af-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="6e5af-124">När du installerar nya webbtjänst-SDK måste du kontrollera att namnet på virtuella katalogen matchar tidigare installerade virtuell katalog (till exempel MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="6e5af-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="6e5af-125">Upprepa steg på alla underordnade servrar.</span><span class="sxs-lookup"><span data-stu-id="6e5af-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="6e5af-126">Uppgradera en av underordnade ska vara den nya hanteraren och sedan uppgradera den gamla huvudservern.</span><span class="sxs-lookup"><span data-stu-id="6e5af-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="6e5af-127">Uppgradera Användarportalen</span><span class="sxs-lookup"><span data-stu-id="6e5af-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="6e5af-128">Skapa en säkerhetskopia av filen Web.config i den virtuella katalogen för Användarportalen installationsplatsen (till exempel C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="6e5af-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="6e5af-129">Om ändringar som gjordes i standardtemat, skapa en säkerhetskopia av mappen App_Themes\Default.</span><span class="sxs-lookup"><span data-stu-id="6e5af-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="6e5af-130">Det är bättre att skapa en kopia av standardmappen och skapa ett nytt tema än om du vill ändra standardtemat.</span><span class="sxs-lookup"><span data-stu-id="6e5af-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="6e5af-131">Om Användarportalen körs på samma server som de andra komponenterna i MFA-Server, uppmanas du att uppdatera Användarportalen MFA-Server-installationen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="6e5af-132">Acceptera uppmaningen och installera uppdateringen för Användarportalen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="6e5af-133">Kontrollera att namnet på virtuella katalogen matchar tidigare installerade virtuell katalog (till exempel MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="6e5af-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="6e5af-134">Om Användarportalen finns på en egen server, kopiera filen MultiFactorAuthenticationUserPortalSetup64.msi från installationsplatsen för en av MFA-servrar och placera den på webbservern för Användarportalen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="6e5af-135">Kör installationsprogrammet.</span><span class="sxs-lookup"><span data-stu-id="6e5af-135">Run the installer.</span></span> 

  <span data-ttu-id="6e5af-136">Om ett fel inträffar anger ”Microsoft Visual C++ 2015 Redistributable uppdatering 1 eller senare krävs”, hämta och installera det senaste uppdateringspaketet från den [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="6e5af-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="6e5af-137">Installera både x86 och x64 versioner.</span><span class="sxs-lookup"><span data-stu-id="6e5af-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="6e5af-138">Jämför web.config säkerhetskopiorna i steg 1 med den nya web.config-filen när den uppdaterade Användarportalen programvaran har installerats.</span><span class="sxs-lookup"><span data-stu-id="6e5af-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="6e5af-139">Om det finns inga nya attribut i den nya web.config, kopiera filen web.config för säkerhetskopiering till den virtuella katalogen för att skriva över en ny.</span><span class="sxs-lookup"><span data-stu-id="6e5af-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="6e5af-140">Ett annat alternativ är att kopiera och klistra in appSettings värdena och URL för webbtjänsten SDK från säkerhetskopian till den nya web.config.</span><span class="sxs-lookup"><span data-stu-id="6e5af-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="6e5af-141">Om du har Användarportalen på flera servrar, Upprepa installationen på dem alla.</span><span class="sxs-lookup"><span data-stu-id="6e5af-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="6e5af-142">Uppgradera Mobilappwebbtjänsten</span><span class="sxs-lookup"><span data-stu-id="6e5af-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="6e5af-143">Skapa en säkerhetskopia av filen Web.config i den virtuella katalogen för Mobilappwebbtjänsten installationsplatsen (till exempel C:\inetpub\wwwroot\app eller C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="6e5af-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="6e5af-144">Kopiera filen MultiFactorAuthenticationMobileAppWebServiceSetup64.msi från installationsplatsen för MFA-servrar och placera den på webbservern för Mobilapp registrering.</span><span class="sxs-lookup"><span data-stu-id="6e5af-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="6e5af-145">Kör installationsprogrammet.</span><span class="sxs-lookup"><span data-stu-id="6e5af-145">Run the installer.</span></span> 

  <span data-ttu-id="6e5af-146">Om det uppstår ett fel som anger att Microsoft Visual C++ 2015 Redistributable uppdatering 1 eller senare krävs, hämta och installera det senaste uppdateringspaketet från den [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="6e5af-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="6e5af-147">Installera både x86 och x64 versioner.</span><span class="sxs-lookup"><span data-stu-id="6e5af-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="6e5af-148">Jämför web.config-filen som har säkerhetskopierats i steg 1 med den nya web.config-filen när den uppdaterade Mobilappwebbtjänsten programvaran har installerats.</span><span class="sxs-lookup"><span data-stu-id="6e5af-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="6e5af-149">Om det finns inga nya attribut i den nya web.config, kan du kopiera dina sparade web.config tillbaka till den virtuella katalogen och skriva över den nya servern.</span><span class="sxs-lookup"><span data-stu-id="6e5af-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="6e5af-150">Ett annat alternativ är att kopiera och klistra in appSettings värdena och URL för webbtjänsten SDK från säkerhetskopian till den nya web.config.</span><span class="sxs-lookup"><span data-stu-id="6e5af-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="6e5af-151">Om du har den Mobilappwebbtjänsten på flera servrar kan du upprepa installationen på dem alla.</span><span class="sxs-lookup"><span data-stu-id="6e5af-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="6e5af-152">Uppgradera AD FS-kort</span><span class="sxs-lookup"><span data-stu-id="6e5af-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="6e5af-153">Om MFA körs på olika servrar än AD FS</span><span class="sxs-lookup"><span data-stu-id="6e5af-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="6e5af-154">Dessa anvisningar gäller endast om du kör servern för flerfunktionsautentisering separat från AD FS-servrarna.</span><span class="sxs-lookup"><span data-stu-id="6e5af-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="6e5af-155">Om båda tjänsterna körs på samma servrar, hoppa över det här avsnittet och gå till följande steg.</span><span class="sxs-lookup"><span data-stu-id="6e5af-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="6e5af-156">Spara en kopia av filen multifactorauthenticationadfsadapter.config som har registrerats i AD FS eller exportera konfigurationen med följande PowerShell-kommando: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span><span class="sxs-lookup"><span data-stu-id="6e5af-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="6e5af-157">Att kortets namn är ”WindowsAzureMultiFactorAuthentication” eller ”AzureMfaServerAuthentication” beroende på vilken version som installerats tidigare.</span><span class="sxs-lookup"><span data-stu-id="6e5af-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="6e5af-158">Kopiera följande filer från installationsplatsen för MFA-servern till AD FS-servrarna:</span><span class="sxs-lookup"><span data-stu-id="6e5af-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="6e5af-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="6e5af-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="6e5af-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="6e5af-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="6e5af-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="6e5af-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="6e5af-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="6e5af-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="6e5af-163">Redigera skriptet Register-MultiFactorAuthenticationAdfsAdapter.ps1 genom att lägga till `-ConfigurationFilePath [path]` till slutet av den `Register-AdfsAuthenticationProvider` kommando.</span><span class="sxs-lookup"><span data-stu-id="6e5af-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="6e5af-164">Ersätt *[sökväg]* med den fullständiga sökvägen till MultiFactorAuthenticationAdfsAdapter.config exporterade filen eller konfigurationsfilen i föregående steg.</span><span class="sxs-lookup"><span data-stu-id="6e5af-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="6e5af-165">Kontrollera attributen i den nya MultiFactorAuthenticationAdfsAdapter.config att se om de matchar den gamla config-fil.</span><span class="sxs-lookup"><span data-stu-id="6e5af-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="6e5af-166">Om några attribut har lagts till eller tas bort i den nya versionen, kopiera attributvärden från den gamla konfigurationsfilen till en ny eller ändra gammal konfigurationsfil att matcha.</span><span class="sxs-lookup"><span data-stu-id="6e5af-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="6e5af-167">Installera nya AD FS-kort</span><span class="sxs-lookup"><span data-stu-id="6e5af-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="6e5af-168">Användarna uppmanas inte att utföra tvåstegsverifiering under steg 3 – 8 av det här avsnittet.</span><span class="sxs-lookup"><span data-stu-id="6e5af-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="6e5af-169">Om du har AD FS som konfigurerats i flera kluster kan du ta bort, uppgradera och återställa varje kluster i servergruppen oberoende av andra kluster att undvika driftsavbrott.</span><span class="sxs-lookup"><span data-stu-id="6e5af-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="6e5af-170">Ta bort vissa AD FS-servrar från gruppen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="6e5af-171">Uppdatera servrarna medan de andra fortfarande körs.</span><span class="sxs-lookup"><span data-stu-id="6e5af-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="6e5af-172">Installera den nya AD FS-adaptern på varje server som tas bort från AD FS-servergruppen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="6e5af-173">Om MFA-servern är installerad på varje AD FS-servern, kan du uppdatera via MFA serveradministratören UX.</span><span class="sxs-lookup"><span data-stu-id="6e5af-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="6e5af-174">Uppdatera annars genom att köra sedan filerna MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="6e5af-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="6e5af-175">Om ett fel inträffar anger ”Microsoft Visual C++ 2015 Redistributable uppdatering 1 eller senare krävs”, hämta och installera det senaste uppdateringspaketet från den [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="6e5af-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="6e5af-176">Installera både x86 och x64 versioner.</span><span class="sxs-lookup"><span data-stu-id="6e5af-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="6e5af-177">Gå till **AD FS** > **autentiseringsprinciper** > **redigera globala flerfunktionsautentisering princip**.</span><span class="sxs-lookup"><span data-stu-id="6e5af-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="6e5af-178">Avmarkera **WindowsAzureMultiFactorAuthentication** eller **AzureMFAServerAuthentication** (beroende på den aktuella installerade versionen).</span><span class="sxs-lookup"><span data-stu-id="6e5af-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="6e5af-179">När det här steget har slutförts är tvåstegsverifiering via MFA-servern inte tillgänglig i det här AD FS-klustret förrän du har slutfört steg 8.</span><span class="sxs-lookup"><span data-stu-id="6e5af-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="6e5af-180">Avregistrera den äldre versionen av AD FS-adaptern genom att köra Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell-skript.</span><span class="sxs-lookup"><span data-stu-id="6e5af-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="6e5af-181">Se till att den *-namnet* parameter (”WindowsAzureMultiFactorAuthentication” eller ”AzureMFAServerAuthentication”) som matchar namnet som visas i steg 3.</span><span class="sxs-lookup"><span data-stu-id="6e5af-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="6e5af-182">Detta gäller för alla servrar i samma AD FS-kluster eftersom det inte finns en central konfiguration.</span><span class="sxs-lookup"><span data-stu-id="6e5af-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="6e5af-183">Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell-skript för att registrera nya AD FS-adaptern.</span><span class="sxs-lookup"><span data-stu-id="6e5af-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="6e5af-184">Detta gäller för alla servrar i samma AD FS-kluster eftersom det inte finns en central konfiguration.</span><span class="sxs-lookup"><span data-stu-id="6e5af-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="6e5af-185">Starta om AD FS-tjänsten på varje server som tas bort från AD FS-servergruppen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="6e5af-186">Lägga till uppdaterade servrar i AD FS-servergruppen och ta bort de andra servrarna från servergruppen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="6e5af-187">Gå till **AD FS** > **autentiseringsprinciper** > **redigera globala flerfunktionsautentisering princip**.</span><span class="sxs-lookup"><span data-stu-id="6e5af-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="6e5af-188">Kontrollera **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="6e5af-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="6e5af-189">Upprepa steg 2 för att uppdatera de servrar som har nu tagits bort från AD FS-servergruppen och starta om AD FS-tjänsten på dessa servrar.</span><span class="sxs-lookup"><span data-stu-id="6e5af-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="6e5af-190">Lägga till dessa servrar i AD FS-servergruppen igen.</span><span class="sxs-lookup"><span data-stu-id="6e5af-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6e5af-191">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="6e5af-191">Next steps</span></span>

- <span data-ttu-id="6e5af-192">Exempel på [avancerade scenarier med Azure Multi-Factor Authentication och tredje parts VPN-anslutningar](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="6e5af-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="6e5af-193">Synkronisera MFA-Server med Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="6e5af-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="6e5af-194">[Konfigurera Windows-autentisering](multi-factor-authentication-get-started-server-windows.md) för dina program</span><span class="sxs-lookup"><span data-stu-id="6e5af-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
