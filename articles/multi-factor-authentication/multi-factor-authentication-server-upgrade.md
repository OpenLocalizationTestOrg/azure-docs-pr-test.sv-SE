---
title: uppgradering av aaaAzure MFA-Server | Microsoft Docs
description: Anvisningar och riktlinjer tooupgrade hello Azure Multi-Factor Authentication-servern tooa nyare version.
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: aaa8d400e0e5f1c6be3a6d22cde6dd893ef4d546
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-toohello-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="7eabe-103">Uppgradera toohello senaste Azure Multi-Factor Authentication-servern</span><span class="sxs-lookup"><span data-stu-id="7eabe-103">Upgrade toohello latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="7eabe-104">Den här artikeln vägleder dig genom hello processen med att uppgradera Azure Multi-Factor Authentication (MFA) Server v6.0 eller högre.</span><span class="sxs-lookup"><span data-stu-id="7eabe-104">This article walks you through hello process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="7eabe-105">Om du behöver tooupgrade en gammal version av hello PhoneFactor Agent Se för[uppgradera hello PhoneFactor Agent tooAzure servern för flerfunktionsautentisering](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="7eabe-105">If you need tooupgrade an old version of hello PhoneFactor Agent, refer too[Upgrade hello PhoneFactor Agent tooAzure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="7eabe-106">Om du inte uppgradera från v6.x eller äldre toov7.x eller senare kan ändra alla komponenter från .NET 2.0 too.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="7eabe-106">If you're upgrading from v6.x or older toov7.x or newer, all components change from .NET 2.0 too.NET 4.5.</span></span> <span data-ttu-id="7eabe-107">Alla komponenter måste också Microsoft Visual C++ 2015 Redistributable Update 1 eller högre.</span><span class="sxs-lookup"><span data-stu-id="7eabe-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="7eabe-108">Hej MFA-Server installer installerar både hello x86 och x64 versioner av dessa komponenter om de inte redan har installerats.</span><span class="sxs-lookup"><span data-stu-id="7eabe-108">hello MFA Server installer installs both hello x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="7eabe-109">Om hello Användarportalen och Mobilappwebbtjänsten körs på separata servrar, måste tooinstall paketen innan du uppgraderar komponenterna.</span><span class="sxs-lookup"><span data-stu-id="7eabe-109">If hello User Portal and Mobile App Web Service run on separate servers, you need tooinstall those packages before upgrading those components.</span></span> <span data-ttu-id="7eabe-110">Du kan söka efter hello senaste Microsoft Visual C++ 2015 Redistributable uppdateringen på hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="7eabe-110">You can search for hello latest Microsoft Visual C++ 2015 Redistributable update on hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-hello-latest-version-of-azure-mfa-server"></a><span data-ttu-id="7eabe-111">Installera hello senaste versionen av Azure MFA-Server</span><span class="sxs-lookup"><span data-stu-id="7eabe-111">Install hello latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="7eabe-112">Använd hello-instruktioner i [Download hello Azure Multi-Factor Authentication-servern](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello senaste versionen av hello Azure MFA-Server.</span><span class="sxs-lookup"><span data-stu-id="7eabe-112">Use hello instructions in [Download hello Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello latest version of hello Azure MFA Server.</span></span>
2. <span data-ttu-id="7eabe-113">Gör en säkerhetskopia av hello MFA-serverns datafil som finns i C:\Program program\multi-Factor Authentication Server\Data\PhoneFactor.pfdata (antagande om hello installera standardplatsen) på din MFA-huvudservern.</span><span class="sxs-lookup"><span data-stu-id="7eabe-113">Make a backup of hello MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming hello default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="7eabe-114">Om du kör flera servrar för hög tillgänglighet, ändra hello klientsystem som autentiseras toohello MFA-servern så att de slutar skickar trafik toohello servrar som uppgraderas.</span><span class="sxs-lookup"><span data-stu-id="7eabe-114">If you run multiple servers for high availability, change hello client systems that authenticate toohello MFA Server so that they stop sending traffic toohello servers that are upgrading.</span></span> <span data-ttu-id="7eabe-115">Om du använder en belastningsutjämnare, ta bort en MFA-Server från belastningsutjämnaren hello gör hello uppgradering och Lägg sedan till hello servern tillbaka till hello servergruppen.</span><span class="sxs-lookup"><span data-stu-id="7eabe-115">If you use a load balancer, remove a MFA Server from hello load balancer, do hello upgrade, and then add hello server back into hello farm.</span></span>
4. <span data-ttu-id="7eabe-116">Kör hello nya installationsprogrammet på varje MFA-Server.</span><span class="sxs-lookup"><span data-stu-id="7eabe-116">Run hello new installer on each MFA Server.</span></span> <span data-ttu-id="7eabe-117">Uppgradera först underordnade servrar eftersom de kan läsa hello gamla datafilen replikeras av hello master.</span><span class="sxs-lookup"><span data-stu-id="7eabe-117">Upgrade subordinate servers first because they can read hello old data file being replicated by hello master.</span></span> 

  <span data-ttu-id="7eabe-118">Du behöver inte toouninstall din aktuella MFA-servern innan du kör installationsprogrammet för hello.</span><span class="sxs-lookup"><span data-stu-id="7eabe-118">You do not need toouninstall your current MFA Server before running hello installer.</span></span> <span data-ttu-id="7eabe-119">hello installer utför en uppgradering på plats.</span><span class="sxs-lookup"><span data-stu-id="7eabe-119">hello installer performs an in-place upgrade.</span></span> <span data-ttu-id="7eabe-120">hello installationssökväg hämtas från registret hello från hello tidigare installation, så installeras i hello samma plats (till exempel C:\Program program\multi-Factor Authentication-servern).</span><span class="sxs-lookup"><span data-stu-id="7eabe-120">hello installation path is picked up from hello registry from hello previous installation, so it installs in hello same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="7eabe-121">Om du inte ange tooinstall en Microsoft Visual C++ 2015 Redistributable uppdateringspaketet kan acceptera uppmaningen om hello.</span><span class="sxs-lookup"><span data-stu-id="7eabe-121">If you're prompted tooinstall a Microsoft Visual C++ 2015 Redistributable update package, accept hello prompt.</span></span> <span data-ttu-id="7eabe-122">Båda hello x86 och x64 versioner av hello-paket installeras.</span><span class="sxs-lookup"><span data-stu-id="7eabe-122">Both hello x86 and x64 versions of hello package are installed.</span></span>
5. <span data-ttu-id="7eabe-123">Om du använder hello webbtjänst-SDK, uppmanas du tooinstall hello ny webbtjänst-SDK.</span><span class="sxs-lookup"><span data-stu-id="7eabe-123">If you use hello Web Service SDK, you are prompted tooinstall hello new Web Service SDK.</span></span> <span data-ttu-id="7eabe-124">När du installerar Hej ny webbtjänst-SDK, se till att det virtuella katalognamnet hello matchar hello tidigare installerade virtuell katalog (till exempel MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="7eabe-124">When you install hello new Web Service SDK, make sure that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="7eabe-125">Upprepa steg hello på alla underordnade servrar.</span><span class="sxs-lookup"><span data-stu-id="7eabe-125">Repeat hello steps on all subordinate servers.</span></span> <span data-ttu-id="7eabe-126">Uppgradera en av hello underordnade toobe hello ny mall och sedan uppgradera hello gamla huvudservern.</span><span class="sxs-lookup"><span data-stu-id="7eabe-126">Promote one of hello subordinates toobe hello new master, then upgrade hello old master server.</span></span> 

## <a name="upgrade-hello-user-portal"></a><span data-ttu-id="7eabe-127">Uppgradera hello Användarportalen</span><span class="sxs-lookup"><span data-stu-id="7eabe-127">Upgrade hello User Portal</span></span>

1. <span data-ttu-id="7eabe-128">Gör en säkerhetskopia av hello web.config-fil som finns i hello virtuella katalogen för hello installationsplats för Användarportalen (till exempel C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="7eabe-128">Make a backup of hello web.config file that is in hello virtual directory of hello User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="7eabe-129">Gör en säkerhetskopia av hello App_Themes\Default mappen även om några ändringar har gjorts toohello standardtemat.</span><span class="sxs-lookup"><span data-stu-id="7eabe-129">If any changes were made toohello default theme, make a backup of hello App_Themes\Default folder as well.</span></span> <span data-ttu-id="7eabe-130">Det är bättre toocreate en kopia av hello standardmapp och skapa ett nytt tema än toochange hello standardtemat.</span><span class="sxs-lookup"><span data-stu-id="7eabe-130">It is better toocreate a copy of hello Default folder and create a new theme than toochange hello Default theme.</span></span>
2. <span data-ttu-id="7eabe-131">Om hello Användarportalen körs på samma server som hello andra MFA-Server-komponenter, hello hello uppmaning MFA serverinstallation tooupdate hello Användarportalen.</span><span class="sxs-lookup"><span data-stu-id="7eabe-131">If hello User Portal runs on hello same server as hello other MFA Server components, hello MFA Server installation prompts you tooupdate hello User Portal.</span></span> <span data-ttu-id="7eabe-132">Acceptera uppmaningen om hello och installera hello Användarportalen uppdatering.</span><span class="sxs-lookup"><span data-stu-id="7eabe-132">Accept hello prompt and install hello User Portal update.</span></span> <span data-ttu-id="7eabe-133">Kontrollera att hello katalognamnet matchar hello tidigare installerade virtuell katalog (till exempel MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="7eabe-133">Check that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="7eabe-134">Om hello Användarportalen finns på en egen server, kopiera hello MultiFactorAuthenticationUserPortalSetup64.msi fil från hello installationsplats för en av hello MFA-servrar och placera den på hello Användarportalen webbserver.</span><span class="sxs-lookup"><span data-stu-id="7eabe-134">If hello User Portal is on its own server, copy hello MultiFactorAuthenticationUserPortalSetup64.msi file from hello install location of one of hello MFA Servers and put it onto hello User Portal web server.</span></span> <span data-ttu-id="7eabe-135">Kör installationsprogrammet för hello.</span><span class="sxs-lookup"><span data-stu-id="7eabe-135">Run hello installer.</span></span> 

  <span data-ttu-id="7eabe-136">Om ett fel inträffar anger ”Microsoft Visual C++ 2015 Redistributable uppdatering 1 eller senare krävs”, hämta och installera hello senaste uppdateringspaketet från hello [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="7eabe-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7eabe-137">Installera båda hello x86 och x64 versioner.</span><span class="sxs-lookup"><span data-stu-id="7eabe-137">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="7eabe-138">Jämför hello web.config säkerhetskopiorna i steg 1 med hello nya web.config-filen när hello uppdaterats Användarportalen programvara är installerad.</span><span class="sxs-lookup"><span data-stu-id="7eabe-138">After hello updated User Portal software is installed, compare hello web.config backup you made in step 1 with hello new web.config file.</span></span> <span data-ttu-id="7eabe-139">Om det finns inga nya attribut i hello nya web.config, kopiera filen web.config för säkerhetskopiering till hello virtuell katalog toooverwrite hello ny.</span><span class="sxs-lookup"><span data-stu-id="7eabe-139">If no new attributes exist in hello new web.config, copy your backup web.config into hello virtual directory toooverwrite hello new one.</span></span> <span data-ttu-id="7eabe-140">Ett annat alternativ är toocopy och klistra in hello appSettings värden och hello webbtjänst-SDK URL från hello säkerhetskopian till hello nya web.config.</span><span class="sxs-lookup"><span data-stu-id="7eabe-140">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="7eabe-141">Om du har hello Användarportalen på flera servrar, upprepa hello installation på dem alla.</span><span class="sxs-lookup"><span data-stu-id="7eabe-141">If you have hello User Portal on multiple servers, repeat hello installation on all of them.</span></span> 


## <a name="upgrade-hello-mobile-app-web-service"></a><span data-ttu-id="7eabe-142">Uppgradera hello Mobilappwebbtjänsten</span><span class="sxs-lookup"><span data-stu-id="7eabe-142">Upgrade hello Mobile App Web Service</span></span>

1. <span data-ttu-id="7eabe-143">Gör en säkerhetskopia av hello web.config-fil som finns i hello virtuella katalogen för hello Mobilappwebbtjänsten installationsplatsen (till exempel C:\inetpub\wwwroot\app eller C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="7eabe-143">Make a backup of hello web.config file that is in hello virtual directory of hello Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="7eabe-144">Kopiera hello MultiFactorAuthenticationMobileAppWebServiceSetup64.msi fil från hello installera platsen för hello MFA-servrar och placera den på hello Mobilapp registreringsserver.</span><span class="sxs-lookup"><span data-stu-id="7eabe-144">Copy hello MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from hello install location of hello MFA Servers and put it onto hello Mobile App registration web server.</span></span>
3. <span data-ttu-id="7eabe-145">Kör installationsprogrammet för hello.</span><span class="sxs-lookup"><span data-stu-id="7eabe-145">Run hello installer.</span></span> 

  <span data-ttu-id="7eabe-146">Om det uppstår ett fel som anger att Microsoft Visual C++ 2015 Redistributable uppdatering 1 eller senare krävs, hämta och installera hello senaste uppdateringspaketet från hello [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="7eabe-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7eabe-147">Installera båda hello x86 och x64 versioner.</span><span class="sxs-lookup"><span data-stu-id="7eabe-147">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="7eabe-148">Jämför hello web.config-filen som har säkerhetskopierats i steg 1 med hello nya web.config-filen när hello uppdateras Mobilappwebbtjänsten programvara har installerats.</span><span class="sxs-lookup"><span data-stu-id="7eabe-148">After hello updated Mobile App Web Service software installs, compare hello web.config file that was backed up in step 1 with hello new web.config file.</span></span> <span data-ttu-id="7eabe-149">Om det finns inga nya attribut i hello nya web.config, kan du kopiera dina sparade web.config till hello virtuell katalog och skriver över hello ny.</span><span class="sxs-lookup"><span data-stu-id="7eabe-149">If no new attributes exist in hello new web.config, you can copy your saved web.config back into hello virtual directory and overwrite hello new one.</span></span> <span data-ttu-id="7eabe-150">Ett annat alternativ är toocopy och klistra in hello appSettings värden och hello webbtjänst-SDK URL från hello säkerhetskopian till hello nya web.config.</span><span class="sxs-lookup"><span data-stu-id="7eabe-150">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="7eabe-151">Om du har hello Mobilappwebbtjänsten på flera servrar, upprepa hello installation på dem alla.</span><span class="sxs-lookup"><span data-stu-id="7eabe-151">If you have hello Mobile App Web Service on multiple servers, repeat hello installation on all of them.</span></span> 

## <a name="upgrade-hello-ad-fs-adapters"></a><span data-ttu-id="7eabe-152">Uppgradera hello AD FS-kort</span><span class="sxs-lookup"><span data-stu-id="7eabe-152">Upgrade hello AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="7eabe-153">Om MFA körs på olika servrar än AD FS</span><span class="sxs-lookup"><span data-stu-id="7eabe-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="7eabe-154">Dessa anvisningar gäller endast om du kör servern för flerfunktionsautentisering separat från AD FS-servrarna.</span><span class="sxs-lookup"><span data-stu-id="7eabe-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="7eabe-155">Om båda tjänsterna körs hello samma servrar, hoppa över det här avsnittet och gå toohello installationssteg.</span><span class="sxs-lookup"><span data-stu-id="7eabe-155">If both services run on hello same servers, skip this section and go toohello installation steps.</span></span> 

1. <span data-ttu-id="7eabe-156">Spara en kopia av hello MultiFactorAuthenticationAdfsAdapter.config fil som har registrerats i AD FS eller exportera hello-konfigurationen med hjälp av följande PowerShell-kommando hello: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span><span class="sxs-lookup"><span data-stu-id="7eabe-156">Save a copy of hello MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export hello configuration using hello following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span></span> <span data-ttu-id="7eabe-157">hello kortets namn är ”WindowsAzureMultiFactorAuthentication” eller ”AzureMfaServerAuthentication” beroende på hello-version som installerats tidigare.</span><span class="sxs-lookup"><span data-stu-id="7eabe-157">hello adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on hello version previously installed.</span></span>
2. <span data-ttu-id="7eabe-158">Kopiera följande filer från hello MFA-Server installation plats toohello AD FS-servrarna hello:</span><span class="sxs-lookup"><span data-stu-id="7eabe-158">Copy hello following files from hello MFA Server installation location toohello AD FS servers:</span></span>

  - <span data-ttu-id="7eabe-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="7eabe-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="7eabe-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="7eabe-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="7eabe-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="7eabe-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="7eabe-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="7eabe-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="7eabe-163">Redigera hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 skript genom att lägga till `-ConfigurationFilePath [path]` toohello slutet av hello `Register-AdfsAuthenticationProvider` kommando.</span><span class="sxs-lookup"><span data-stu-id="7eabe-163">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` toohello end of hello `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="7eabe-164">Ersätt *[sökväg]* med hello fullständig sökväg toohello MultiFactorAuthenticationAdfsAdapter.config exporterade filen eller hello-konfigurationsfilen i hello föregående steg.</span><span class="sxs-lookup"><span data-stu-id="7eabe-164">Replace *[path]* with hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file or hello configuration file exported in hello previous step.</span></span> 

  <span data-ttu-id="7eabe-165">Kontrollera hello attribut i hello nya MultiFactorAuthenticationAdfsAdapter.config toosee om de matchar hello gammal konfigurationsfil.</span><span class="sxs-lookup"><span data-stu-id="7eabe-165">Check hello attributes in hello new MultiFactorAuthenticationAdfsAdapter.config toosee if they match hello old config file.</span></span> <span data-ttu-id="7eabe-166">Om några attribut har lagts till eller tas bort i hello ny version, kopiera hello attributvärden från hello gamla configuration file toohello ny eller ändra hello gamla configuration file toomatch.</span><span class="sxs-lookup"><span data-stu-id="7eabe-166">If any attributes were added or removed in hello new version, copy hello attribute values from hello old configuration file toohello new one or modify hello old configuration file toomatch.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="7eabe-167">Installera nya AD FS-kort</span><span class="sxs-lookup"><span data-stu-id="7eabe-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="7eabe-168">Användarna kommer inte att nödvändiga tooperform tvåstegsverifiering under steg 3 – 8 av det här avsnittet.</span><span class="sxs-lookup"><span data-stu-id="7eabe-168">Your users will not be required tooperform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="7eabe-169">Om du har AD FS som konfigurerats i flera kluster, kan du ta bort, uppgradering och återställa varje kluster i hello servergrupp oberoende av hello andra kluster tooavoid driftstopp.</span><span class="sxs-lookup"><span data-stu-id="7eabe-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in hello farm independently of hello other clusters tooavoid downtime.</span></span>

1. <span data-ttu-id="7eabe-170">Ta bort några AD FS-servrar från hello servergruppen.</span><span class="sxs-lookup"><span data-stu-id="7eabe-170">Remove some AD FS servers from hello farm.</span></span> <span data-ttu-id="7eabe-171">Uppdatera servrarna när hello andra fortfarande körs.</span><span class="sxs-lookup"><span data-stu-id="7eabe-171">Update these servers while hello others are still running.</span></span>
2. <span data-ttu-id="7eabe-172">Installera hello nya AD FS-adaptern på varje server som tas bort från hello AD FS-servergrupp.</span><span class="sxs-lookup"><span data-stu-id="7eabe-172">Install hello new AD FS adapter on each server removed from hello AD FS farm.</span></span> <span data-ttu-id="7eabe-173">Om hello MFA-servern är installerad på varje AD FS-servern, kan du uppdatera via hello MFA-administratören UX.</span><span class="sxs-lookup"><span data-stu-id="7eabe-173">If hello MFA Server is installed on each AD FS server, you can update through hello MFA Server admin UX.</span></span> <span data-ttu-id="7eabe-174">Uppdatera annars genom att köra sedan filerna MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="7eabe-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="7eabe-175">Om ett fel inträffar anger ”Microsoft Visual C++ 2015 Redistributable uppdatering 1 eller senare krävs”, hämta och installera hello senaste uppdateringspaketet från hello [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="7eabe-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7eabe-176">Installera båda hello x86 och x64 versioner.</span><span class="sxs-lookup"><span data-stu-id="7eabe-176">Install both hello x86 and x64 versions.</span></span>

3. <span data-ttu-id="7eabe-177">Gå för**AD FS** > **autentiseringsprinciper** > **Multifaktoråtkomstkontroll certifikatautentisering**.</span><span class="sxs-lookup"><span data-stu-id="7eabe-177">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="7eabe-178">Avmarkera **WindowsAzureMultiFactorAuthentication** eller **AzureMFAServerAuthentication** (beroende på hello aktuell version installerad).</span><span class="sxs-lookup"><span data-stu-id="7eabe-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on hello current version installed).</span></span> 

  <span data-ttu-id="7eabe-179">När det här steget har slutförts är tvåstegsverifiering via MFA-servern inte tillgänglig i det här AD FS-klustret förrän du har slutfört steg 8.</span><span class="sxs-lookup"><span data-stu-id="7eabe-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="7eabe-180">Avregistrera hello äldre version av hello AD FS-adaptern genom att köra hello Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell-skript.</span><span class="sxs-lookup"><span data-stu-id="7eabe-180">Unregister hello older version of hello AD FS adapter by running hello Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="7eabe-181">Se till att hello *-namnet* parameter (”WindowsAzureMultiFactorAuthentication” eller ”AzureMFAServerAuthentication”) som matchar hello-namnet som visas i steg 3.</span><span class="sxs-lookup"><span data-stu-id="7eabe-181">Ensure that hello *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches hello name that was displayed in step 3.</span></span> <span data-ttu-id="7eabe-182">Detta gäller tooall servrar i hello samma AD FS-klustret eftersom det inte finns en central konfiguration.</span><span class="sxs-lookup"><span data-stu-id="7eabe-182">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="7eabe-183">Registrera hello nya AD FS-adaptern genom att köra hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell-skript.</span><span class="sxs-lookup"><span data-stu-id="7eabe-183">Register hello new AD FS adapter by running hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="7eabe-184">Detta gäller tooall servrar i hello samma AD FS-klustret eftersom det inte finns en central konfiguration.</span><span class="sxs-lookup"><span data-stu-id="7eabe-184">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="7eabe-185">Starta om hello AD FS-tjänsten på varje server som tas bort från hello AD FS-servergrupp.</span><span class="sxs-lookup"><span data-stu-id="7eabe-185">Restart hello AD FS service on each server removed from hello AD FS farm.</span></span>
7. <span data-ttu-id="7eabe-186">Lägg till hello uppdateras servrar tillbaka toohello AD FS-grupp och ta bort hello servrar från hello servergruppen.</span><span class="sxs-lookup"><span data-stu-id="7eabe-186">Add hello updated servers back toohello AD FS farm and remove hello other servers from hello farm.</span></span>
8. <span data-ttu-id="7eabe-187">Gå för**AD FS** > **autentiseringsprinciper** > **Multifaktoråtkomstkontroll certifikatautentisering**.</span><span class="sxs-lookup"><span data-stu-id="7eabe-187">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="7eabe-188">Kontrollera **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="7eabe-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="7eabe-189">Upprepa steg 2 tooupdate hello servrar som har nu tagits bort från hello AD FS-grupp och starta om hello AD FS-tjänsten på dessa servrar.</span><span class="sxs-lookup"><span data-stu-id="7eabe-189">Repeat step 2 tooupdate hello servers now removed from hello AD FS farm and restart hello AD FS service on those servers.</span></span>
10. <span data-ttu-id="7eabe-190">Lägg till dessa servrar till hello AD FS-servergrupp.</span><span class="sxs-lookup"><span data-stu-id="7eabe-190">Add those servers back into hello AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7eabe-191">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="7eabe-191">Next steps</span></span>

- <span data-ttu-id="7eabe-192">Exempel på [avancerade scenarier med Azure Multi-Factor Authentication och tredje parts VPN-anslutningar](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="7eabe-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="7eabe-193">Synkronisera MFA-Server med Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="7eabe-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="7eabe-194">[Konfigurera Windows-autentisering](multi-factor-authentication-get-started-server-windows.md) för dina program</span><span class="sxs-lookup"><span data-stu-id="7eabe-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
