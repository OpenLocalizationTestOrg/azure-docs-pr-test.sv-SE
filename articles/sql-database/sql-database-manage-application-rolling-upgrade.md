---
title: aaaRolling programuppgraderingar - Azure SQL Database | Microsoft Docs
description: "Lär dig hur toouse Azure SQL Database geo-replikering toosupport online uppgraderingar av ditt program i molnet."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 18c56300916d129bff141624cc5c416b500408d4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="d5748-103">Hantera löpande uppgraderingar av molnprogram som använder SQL-databas aktiv geo-replikering</span><span class="sxs-lookup"><span data-stu-id="d5748-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="d5748-104">[Aktiv geo-replikering](sql-database-geo-replication-overview.md) är nu tillgänglig för alla databaser i alla nivåer.</span><span class="sxs-lookup"><span data-stu-id="d5748-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="d5748-105">Lär dig hur toouse [georeplikering](sql-database-geo-replication-overview.md) i SQL-databasen tooenable löpande uppgradering av ditt program i molnet.</span><span class="sxs-lookup"><span data-stu-id="d5748-105">Learn how toouse [geo-replication](sql-database-geo-replication-overview.md) in SQL Database tooenable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="d5748-106">Uppgraderingen är en störande åtgärd, bör den vara en del av ditt företag kontinuitet planerings- och.</span><span class="sxs-lookup"><span data-stu-id="d5748-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="d5748-107">I den här artikeln som vi titta på två olika metoder för att samordna hello uppgraderingsprocessen och diskutera hello fördelar och avvägningarna med varje alternativ.</span><span class="sxs-lookup"><span data-stu-id="d5748-107">In this article we look at two different methods of orchestrating hello upgrade process, and discuss hello benefits and trade-offs of each option.</span></span> <span data-ttu-id="d5748-108">Hello enligt den här artikeln ska vi använda ett enkelt program som består av en webbplats anslutna tooa databas som sin datanivå.</span><span class="sxs-lookup"><span data-stu-id="d5748-108">For hello purposes of this article we will use a simple application that consists of a web site connected tooa single database as its data tier.</span></span> <span data-ttu-id="d5748-109">Vårt mål är tooupgrade version 1 av hello programmet tooversion 2 utan betydande påverkan på hello slutanvändarens upplevelse.</span><span class="sxs-lookup"><span data-stu-id="d5748-109">Our goal is tooupgrade version 1 of hello application tooversion 2 without any significant impact on hello end-user experience.</span></span> 

<span data-ttu-id="d5748-110">När du utvärderar hello uppgraderingsalternativ bör du hello följande faktorer:</span><span class="sxs-lookup"><span data-stu-id="d5748-110">When evaluating hello upgrade options you should consider hello following factors:</span></span>

* <span data-ttu-id="d5748-111">Inverkan på tillgänglighet under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="d5748-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="d5748-112">Hur länge hello programmet funktionen begränsad eller vara försämrad.</span><span class="sxs-lookup"><span data-stu-id="d5748-112">How long hello application function may be limited or degraded.</span></span>
* <span data-ttu-id="d5748-113">Möjlighet tooroll tillbaka om ett fel uppstår på uppgradera.</span><span class="sxs-lookup"><span data-stu-id="d5748-113">Ability tooroll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="d5748-114">Säkerhetsproblem för hello program om en orelaterade katastrofalt fel inträffar under hello uppgradering.</span><span class="sxs-lookup"><span data-stu-id="d5748-114">Vulnerability of hello application if an unrelated catastrophic failure occurs during hello upgrade.</span></span>
* <span data-ttu-id="d5748-115">Totalt antal dollar kostnad.</span><span class="sxs-lookup"><span data-stu-id="d5748-115">Total dollar cost.</span></span>  <span data-ttu-id="d5748-116">Detta omfattar ytterligare redundans och kostnader för hello tillfälliga komponenter som används av hello uppgraderingsprocessen.</span><span class="sxs-lookup"><span data-stu-id="d5748-116">This includes additional redundancy and incremental costs of hello temporary components  used by hello upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="d5748-117">Uppgradera program som förlitar sig på säkerhetskopiering av databaser för katastrofåterställning</span><span class="sxs-lookup"><span data-stu-id="d5748-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="d5748-118">Om ditt program använder automatiska säkerhetskopieringar och använder geo-återställning för katastrofåterställning, är det vanligtvis distribuerade tooa enda Azure-region.</span><span class="sxs-lookup"><span data-stu-id="d5748-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed tooa single Azure region.</span></span> <span data-ttu-id="d5748-119">I det här fallet innebär hello uppgraderingen att du skapar en säkerhetskopiering distribution av alla programkomponenter ingår i hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="d5748-119">In this case hello upgrade process involves creating a backup deployment of all application components involved in hello upgrade.</span></span> <span data-ttu-id="d5748-120">toominimize hello slutanvändaren du använder Azure Traffic Manager (WATM) med hello redundans profil.</span><span class="sxs-lookup"><span data-stu-id="d5748-120">toominimize hello end-user disruption you will leverage Azure Traffic Manager (WATM) with hello failover profile.</span></span>  <span data-ttu-id="d5748-121">hello följande diagram illustrerar hello driftsmiljön tidigare toohello uppgraderingsprocessen.</span><span class="sxs-lookup"><span data-stu-id="d5748-121">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="d5748-122">Hej endpoint <i>contoso 1.azurewebsites.net</i> representerar en produktionsplatsen för hello-program som behöver toobe uppgraderas.</span><span class="sxs-lookup"><span data-stu-id="d5748-122">hello endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of hello application that needs toobe upgraded.</span></span> <span data-ttu-id="d5748-123">tooenable hello möjlighet tooroll tillbaka Hej uppgraderingen, du måste skapa en steg-plats med en helt synkroniserad kopia av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="d5748-123">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="d5748-124">hello är följande steg nödvändiga tooprepare hello programmet hello uppgraderingen:</span><span class="sxs-lookup"><span data-stu-id="d5748-124">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="d5748-125">Skapa en plats för fas för hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="d5748-125">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="d5748-126">toodo som skapar en sekundär databas (1) och distribuera en identisk webbplats i hello samma Azure-region.</span><span class="sxs-lookup"><span data-stu-id="d5748-126">toodo that create a secondary database (1) and deploy an identical web site in hello same Azure region.</span></span> <span data-ttu-id="d5748-127">Övervaka hello sekundära toosee om hello seeding processen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="d5748-127">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="d5748-128">Skapa en profil för växling vid fel i WATM med <i>contoso 1.azurewebsites.net</i> som online slutpunkt och <i>contoso 2.azurewebsites.net</i> som offline.</span><span class="sxs-lookup"><span data-stu-id="d5748-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="d5748-129">Obs hello förberedelsesteg påverkar inte programmet hello i hello produktionsplatsen och den kan fungera i full åtkomst-läge.</span><span class="sxs-lookup"><span data-stu-id="d5748-129">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
>  

![Konfiguration av SQL-databasen gå-replikeringen.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="d5748-132">När hello förberedelsesteg har slutförts är hello programmet redo för hello verkliga uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="d5748-132">Once hello preparation steps are completed hello application is ready for hello actual upgrade.</span></span> <span data-ttu-id="d5748-133">hello följande diagram illustrerar hello steg som ingår i hello uppgraderingsprocessen.</span><span class="sxs-lookup"><span data-stu-id="d5748-133">hello following diagram illustrates hello steps involved in hello upgrade process.</span></span> 

1. <span data-ttu-id="d5748-134">Ange hello primära databasen i hello fack endast tooread Produktionsläge (3).</span><span class="sxs-lookup"><span data-stu-id="d5748-134">Set hello primary database in hello production slot tooread-only mode (3).</span></span> <span data-ttu-id="d5748-135">Detta garanterar att hello produktion instans av programmet hello (V1) förblir skrivskyddad uppgraderar hello vilket gör hello dataavvikelser mellan hello V1 och V2-databasinstanser.</span><span class="sxs-lookup"><span data-stu-id="d5748-135">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="d5748-136">Koppla från hello sekundär databas med hjälp av hello planerad avslutning läge (4).</span><span class="sxs-lookup"><span data-stu-id="d5748-136">Disconnect hello secondary database using hello planned termination mode (4).</span></span> <span data-ttu-id="d5748-137">Den skapar en helt synkroniserad oberoende kopia av hello primära databasen.</span><span class="sxs-lookup"><span data-stu-id="d5748-137">It will create a fully synchronized independent copy of hello primary database.</span></span> <span data-ttu-id="d5748-138">Den här databasen kommer att uppgraderas.</span><span class="sxs-lookup"><span data-stu-id="d5748-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="d5748-139">Aktivera hello primära databasen tooread-och skrivbehörighet och kör hello uppgraderingsskriptet hello steget fack (5).</span><span class="sxs-lookup"><span data-stu-id="d5748-139">Turn hello primary database tooread-write mode and run hello upgrade script in hello stage slot  (5).</span></span>     

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="d5748-142">Om hello uppgraderingen har slutförts men du är nu redo tooswitch hello slutanvändare toohello mellanlagrad kopiera hello program.</span><span class="sxs-lookup"><span data-stu-id="d5748-142">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello staged copy hello application.</span></span> <span data-ttu-id="d5748-143">Det blir nu hello produktionsplatsen av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="d5748-143">It will now become hello production slot of hello application.</span></span>  <span data-ttu-id="d5748-144">Detta omfattar några fler steg som visas på hello följande diagram.</span><span class="sxs-lookup"><span data-stu-id="d5748-144">This involves a few more steps as illustrated on hello following diagram.</span></span>

1. <span data-ttu-id="d5748-145">Växla hello online slutpunkt i hello WATM profil för<i>contoso 2.azurewebsites.net</i>, vilken punkter toohello V2 version av hello-webbplats (6).</span><span class="sxs-lookup"><span data-stu-id="d5748-145">Switch hello online endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which points toohello V2 version of hello web site (6).</span></span> <span data-ttu-id="d5748-146">Nu blir hello produktionsplatsen med hello V2 program och hello slutanvändarens trafiken dirigerad tooit.</span><span class="sxs-lookup"><span data-stu-id="d5748-146">It now becomes hello production slot with hello V2 application and hello end-user traffic is directed tooit.</span></span>  
2. <span data-ttu-id="d5748-147">Om du inte längre behöver hello V1 programkomponenter så du kan ta bort dem (7).</span><span class="sxs-lookup"><span data-stu-id="d5748-147">If you no longer need hello V1 application components so you can safely remove them (7).</span></span>   

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="d5748-150">Om hello uppgraderingsprocessen misslyckas, till exempel på grund av tooan fel i hello uppgraderingsskript, hello steget fack bör övervägas komprometteras.</span><span class="sxs-lookup"><span data-stu-id="d5748-150">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="d5748-151">tooroll tillbaka hello toohello förberedande programtillstånd du bara återställa hello programmet hello produktion fack toofull åtkomst.</span><span class="sxs-lookup"><span data-stu-id="d5748-151">tooroll back hello application toohello pre-upgrade state you simply revert hello application in hello production slot toofull access.</span></span> <span data-ttu-id="d5748-152">hello stegen visas i nästa hello-diagrammet.</span><span class="sxs-lookup"><span data-stu-id="d5748-152">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="d5748-153">Ange hello databasen kopiera tooread-och skrivbehörighet (8).</span><span class="sxs-lookup"><span data-stu-id="d5748-153">Set hello database copy tooread-write mode (8).</span></span> <span data-ttu-id="d5748-154">Detta återställer hello fullständig V1 funktionellt hello produktionsplatsen.</span><span class="sxs-lookup"><span data-stu-id="d5748-154">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="d5748-155">Utför hello Rotorsaksanalys och ta bort hello komprometteras komponenter i hello steget fack (9).</span><span class="sxs-lookup"><span data-stu-id="d5748-155">Perform hello root cause analysis and remove hello compromised components in hello stage slot (9).</span></span> 

<span data-ttu-id="d5748-156">Nu hello programmet fungerar fullt ut och hello Uppgraderingsstegen kan upprepas.</span><span class="sxs-lookup"><span data-stu-id="d5748-156">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="d5748-157">hello rollback inte kräver ändringar i WATM profilen eftersom den redan pekar för<i>contoso 1.azurewebsites.net</i> som hello aktiv slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="d5748-157">hello rollback does not require changes in WATM profile as it already points too<i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="d5748-160">hello nyckeln **nytta** för det här alternativet är att du kan uppgradera ett program i en region med en uppsättning enkla steg.</span><span class="sxs-lookup"><span data-stu-id="d5748-160">hello key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="d5748-161">hello är dollar hello uppgraderingen relativt låg.</span><span class="sxs-lookup"><span data-stu-id="d5748-161">hello dollar cost of hello upgrade is relatively low.</span></span> <span data-ttu-id="d5748-162">hello huvudsakliga **förhållandet** är som om ett oåterkalleligt fel uppstår under hello uppgradera hello toohello förberedande återställningstillstånd kommer att omfatta ny distribution av programmet hello i en annan region och återställa hello-databas från säkerhetskopiering med geo-återställning.</span><span class="sxs-lookup"><span data-stu-id="d5748-162">hello main **tradeoff** is that if a catastrophic failure occurs during hello upgrade hello recovery toohello pre-upgrade state will involve re-deployment of hello application in a different region and restoring hello database from backup using geo-restore.</span></span> <span data-ttu-id="d5748-163">Den här processen medför betydande driftstopp.</span><span class="sxs-lookup"><span data-stu-id="d5748-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="d5748-164">Uppgradera program som förlitar sig på database geo-replikering för katastrofåterställning</span><span class="sxs-lookup"><span data-stu-id="d5748-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="d5748-165">Om ditt program utnyttjar geo-replikering för verksamhetskontinuitet, är det distribuerade tooat minst två olika regioner med en aktiv distribution i primär region och en vänteläge distribution i säkerhetskopiering region.</span><span class="sxs-lookup"><span data-stu-id="d5748-165">If your application leverages geo-replication for business continuity, it is deployed  tooat least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="d5748-166">Dessutom nämnts toohello faktorer tidigare hello uppgraderingsprocessen måste garantera att:</span><span class="sxs-lookup"><span data-stu-id="d5748-166">In addition toohello factors mentioned earlier, hello upgrade process must guarantee that:</span></span>

* <span data-ttu-id="d5748-167">programmet hello förblir skyddat från allvarligt fel vid alla tidpunkter under uppgraderingsprocessen hello</span><span class="sxs-lookup"><span data-stu-id="d5748-167">hello application remains protected from catastrophic failures at all times during hello upgrade process</span></span>
* <span data-ttu-id="d5748-168">hello geo-redundant komponenter av programmet hello uppgraderas parallellt med hello active komponenter</span><span class="sxs-lookup"><span data-stu-id="d5748-168">hello geo-redundant components of hello application are upgraded in parallel with hello active components</span></span>

<span data-ttu-id="d5748-169">tooachieve dessa mål som du använder Azure Traffic Manager (WATM) med hjälp av hello redundans profil med en aktiv och tre säkerhetskopierade slutpunkter.</span><span class="sxs-lookup"><span data-stu-id="d5748-169">tooachieve these goals you will leverage Azure Traffic Manager (WATM) using hello failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="d5748-170">hello följande diagram illustrerar hello driftsmiljön tidigare toohello uppgraderingsprocessen.</span><span class="sxs-lookup"><span data-stu-id="d5748-170">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="d5748-171">Hej webbplatser <i>contoso 1.azurewebsites.net</i> och <i>contoso dr.azurewebsites.net</i> motsvarar en produktionsplatsen av programmet hello med fullständig geografisk redundans.</span><span class="sxs-lookup"><span data-stu-id="d5748-171">hello web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of hello application with full geographic redundancy.</span></span> <span data-ttu-id="d5748-172">tooenable hello möjlighet tooroll tillbaka Hej uppgraderingen, du måste skapa en steg-plats med en helt synkroniserad kopia av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="d5748-172">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="d5748-173">Eftersom du behöver tooensure hello program kan snabbt återställa om ett oåterkalleligt fel uppstår under uppgraderingsprocessen hello måste hello steget fack toobe geo-redundant samt.</span><span class="sxs-lookup"><span data-stu-id="d5748-173">Because you need tooensure that hello application can quickly recover in case a catastrophic failure occurs during hello upgrade process, hello stage slot needs toobe geo-redundant as well.</span></span> <span data-ttu-id="d5748-174">hello är följande steg nödvändiga tooprepare hello programmet hello uppgraderingen:</span><span class="sxs-lookup"><span data-stu-id="d5748-174">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="d5748-175">Skapa en plats för fas för hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="d5748-175">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="d5748-176">toodo som skapar en sekundär databas (1) och distribuera en identisk kopia av hello-webbplats i hello samma Azure-region.</span><span class="sxs-lookup"><span data-stu-id="d5748-176">toodo that create a secondary database (1) and deploy an identical copy of hello web site in hello same Azure region.</span></span> <span data-ttu-id="d5748-177">Övervaka hello sekundära toosee om hello seeding processen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="d5748-177">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="d5748-178">Skapa en geo-redundant sekundär databas i hello steget uttag av geo-replikering hello sekundära databasen toohello säkerhetskopiering region (Detta kallas ”härledda geo-replikering”).</span><span class="sxs-lookup"><span data-stu-id="d5748-178">Create a geo-redundant secondary database in hello stage slot by geo-replicating hello secondary database toohello backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="d5748-179">Övervaka hello säkerhetskopiering sekundära toosee om hello seeding processen är slutförd (3).</span><span class="sxs-lookup"><span data-stu-id="d5748-179">Monitor hello backup secondary toosee if hello seeding process is completed (3).</span></span>
3. <span data-ttu-id="d5748-180">Skapa en vänteläge kopia av hello-webbplats i hello säkerhetskopiering region och länka det toohello geo-redundant sekundära (4).</span><span class="sxs-lookup"><span data-stu-id="d5748-180">Create a standby copy of hello web site in hello backup region and link it toohello geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="d5748-181">Lägga till ytterligare slutpunkter för hello <i>contoso 2.azurewebsites.net</i> och <i>contoso 3.azurewebsites.net</i> toohello redundans profil i WATM som offline slutpunkter (5).</span><span class="sxs-lookup"><span data-stu-id="d5748-181">Add hello additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> toohello failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="d5748-182">Obs hello förberedelsesteg påverkar inte programmet hello i hello produktionsplatsen och den kan fungera i full åtkomst-läge.</span><span class="sxs-lookup"><span data-stu-id="d5748-182">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
> 
> 

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="d5748-185">När hello förberedelsesteg har slutförts, är hello steget klar för uppgradering av hello.</span><span class="sxs-lookup"><span data-stu-id="d5748-185">Once hello preparation steps are completed, hello stage slot is ready for hello upgrade.</span></span> <span data-ttu-id="d5748-186">hello följande diagram illustrerar hello uppgradering.</span><span class="sxs-lookup"><span data-stu-id="d5748-186">hello following diagram illustrates hello upgrade steps.</span></span>

1. <span data-ttu-id="d5748-187">Ange hello primära databasen i hello fack endast tooread Produktionsläge (6).</span><span class="sxs-lookup"><span data-stu-id="d5748-187">Set hello primary database in hello production slot tooread-only mode (6).</span></span> <span data-ttu-id="d5748-188">Detta garanterar att hello produktion instans av programmet hello (V1) förblir skrivskyddad uppgraderar hello vilket gör hello dataavvikelser mellan hello V1 och V2-databasinstanser.</span><span class="sxs-lookup"><span data-stu-id="d5748-188">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="d5748-189">Koppla från hello sekundär databas i hello samma region med hello planerad avslutning läge (7).</span><span class="sxs-lookup"><span data-stu-id="d5748-189">Disconnect hello secondary database in hello same region using hello planned termination mode (7).</span></span> <span data-ttu-id="d5748-190">Den skapar en helt synkroniserad oberoende kopia av hello primära databasen, som blir automatiskt till en primär när hello avslutades.</span><span class="sxs-lookup"><span data-stu-id="d5748-190">It will create a fully synchronized independent copy of hello primary database, which will automatically become a primary after hello termination.</span></span> <span data-ttu-id="d5748-191">Den här databasen kommer att uppgraderas.</span><span class="sxs-lookup"><span data-stu-id="d5748-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="d5748-192">Aktivera hello primära databasen i hello steget fack tooread-och skrivbehörighet och kör hello uppgraderingsskriptet (8).</span><span class="sxs-lookup"><span data-stu-id="d5748-192">Turn hello primary database in hello stage slot tooread-write mode and run hello upgrade script (8).</span></span>    

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="d5748-195">Om hello uppgraderingen har slutförts men du är nu redo tooswitch hello slutanvändare toohello V2 version av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="d5748-195">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello V2 version of hello application.</span></span> <span data-ttu-id="d5748-196">hello följande diagram illustrerar hello stegen.</span><span class="sxs-lookup"><span data-stu-id="d5748-196">hello following diagram illustrates hello steps involved.</span></span>

1. <span data-ttu-id="d5748-197">Växla hello aktiv slutpunkt i hello WATM profil för<i>contoso 2.azurewebsites.net</i>, som nu pekar toohello V2-versionen av hello-webbplats (9).</span><span class="sxs-lookup"><span data-stu-id="d5748-197">Switch hello active endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which now points toohello V2 version of hello web site (9).</span></span> <span data-ttu-id="d5748-198">Nu blir den en produktionsplatsen med hello V2 program och slutanvändarens trafiken dirigerad tooit.</span><span class="sxs-lookup"><span data-stu-id="d5748-198">It now becomes a production slot with hello V2 application and end-user traffic is directed tooit.</span></span> 
2. <span data-ttu-id="d5748-199">Om du inte längre behöver hello V1 program så att du kan på ett säkert sätt kan du ta bort den (10 och 11).</span><span class="sxs-lookup"><span data-stu-id="d5748-199">If you no longer need hello V1 application so you can safely remove it (10 and 11).</span></span>  

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="d5748-202">Om hello uppgraderingsprocessen misslyckas, till exempel på grund av tooan fel i hello uppgraderingsskript, hello steget fack bör övervägas komprometteras.</span><span class="sxs-lookup"><span data-stu-id="d5748-202">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="d5748-203">tooroll tillbaka hello toohello förberedande programtillstånd du bara återställa toousing hello programmet hello produktionsplatsen med fullständig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="d5748-203">tooroll back hello application toohello pre-upgrade state you simply revert toousing hello application in hello production slot with full access.</span></span> <span data-ttu-id="d5748-204">hello stegen visas i nästa hello-diagrammet.</span><span class="sxs-lookup"><span data-stu-id="d5748-204">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="d5748-205">Ange hello primära databaskopia hello produktion fack tooread skrivskyddad åtkomst (12).</span><span class="sxs-lookup"><span data-stu-id="d5748-205">Set hello primary database copy in hello production slot tooread-write mode (12).</span></span> <span data-ttu-id="d5748-206">Detta återställer hello fullständig V1 funktionellt hello produktionsplatsen.</span><span class="sxs-lookup"><span data-stu-id="d5748-206">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="d5748-207">Utför hello Rotorsaksanalys och ta bort hello komprometteras komponenter i hello steget fack (13 och 14).</span><span class="sxs-lookup"><span data-stu-id="d5748-207">Perform hello root cause analysis and remove hello compromised components in hello stage slot (13 and 14).</span></span> 

<span data-ttu-id="d5748-208">Nu hello programmet fungerar fullt ut och hello Uppgraderingsstegen kan upprepas.</span><span class="sxs-lookup"><span data-stu-id="d5748-208">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="d5748-209">hello rollback inte kräver ändringar i WATM profilen eftersom den redan pekar för <i>contoso 1.azurewebsites.net</i> som hello aktiv slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="d5748-209">hello rollback does not require changes in WATM profile as it already points too <i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Konfiguration av SQL Database geo-replikering.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="d5748-212">hello nyckeln **nytta** för det här alternativet är att du kan uppgradera både hello programmet och dess geo-redundant kopierar parallellt utan att kompromissa med din företagskontinuitet under hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="d5748-212">hello key **advantage** of this option is that you can upgrade both hello application and its geo-redundant copy in parallel without compromising your business continuity during hello upgrade.</span></span> <span data-ttu-id="d5748-213">hello huvudsakliga **förhållandet** är att den kräver dubbla redundans för varje PROGRAMKOMPONENTEN och därför högre dollar kostnad uppkommer för.</span><span class="sxs-lookup"><span data-stu-id="d5748-213">hello main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="d5748-214">Det innebär också en mer komplicerad arbetsflöde.</span><span class="sxs-lookup"><span data-stu-id="d5748-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="d5748-215">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="d5748-215">Summary</span></span>
<span data-ttu-id="d5748-216">uppgradera hello två metoder som beskrivs i artikel hello skiljer sig åt i komplexitet och hello dollar kostnad men båda fokusera på Minimera hello tidpunkt då hello slutanvändaren är begränsad endast tooread-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="d5748-216">hello two upgrade methods described in hello article differ in complexity and hello dollar cost but they both focus on minimizing hello time when hello end user is limited tooread-only operations.</span></span> <span data-ttu-id="d5748-217">Då definieras direkt hello uppgraderingsskriptet hello varaktighet.</span><span class="sxs-lookup"><span data-stu-id="d5748-217">That time is directly defined by hello duration of hello upgrade script.</span></span> <span data-ttu-id="d5748-218">Det är inte beroende hello databasstorleken, hello tjänstnivåmallen du valt, hello webbplatskonfiguration och andra faktorer som du kan enkelt styra.</span><span class="sxs-lookup"><span data-stu-id="d5748-218">It does not depend on hello database size, hello service tier you chose, hello web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="d5748-219">Detta beror på att alla hello förberedelsesteg frikopplat från hello uppgradering och kan göras utan att påverka hello produktionsprogram.</span><span class="sxs-lookup"><span data-stu-id="d5748-219">This is because all hello preparation steps are decoupled from hello upgrade steps and can be done without impacting hello production application.</span></span> <span data-ttu-id="d5748-220">hello effektiviteten för hello uppgraderingsskriptet är hello nyckelfaktor som bestämmer hello slutanvändarens upplevelse under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="d5748-220">hello efficiency of hello upgrade script is hello key factor that determines hello end-user experience during upgrades.</span></span> <span data-ttu-id="d5748-221">Det är därför hello bästa sättet du kan förbättra den genom att fokusera arbetet på gör hello uppgraderingsskriptet så effektivt som möjligt.</span><span class="sxs-lookup"><span data-stu-id="d5748-221">So hello best way you can improve it is by focusing your efforts on making hello upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="d5748-222">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="d5748-222">Next steps</span></span>
* <span data-ttu-id="d5748-223">En översikt över verksamhetskontinuitet och scenarier finns [översikt över verksamhetskontinuitet](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="d5748-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="d5748-224">toolearn om Azure SQL Database automatisk säkerhetskopiering finns [SQL-databas automatisk säkerhetskopiering](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="d5748-224">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="d5748-225">toolearn om hur du använder automatisk säkerhetskopiering för återställning, se [återställa en databas från automatisk säkerhetskopiering](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="d5748-225">toolearn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="d5748-226">toolearn om snabbare återställningsalternativ finns [aktiv geo-replikering](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d5748-226">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


