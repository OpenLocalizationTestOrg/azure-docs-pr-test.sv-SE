---
title: "aaaMoving data mellan databaser som skalats ut molntjänster | Microsoft Docs"
description: "Förklarar hur toomanipulate delar och flytta data via en automatisk värdbaserade tjänst med elastisk databas API: er."
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 629dee06e22609e9b61edf93ba5c38d997132d8c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="08b0e-103">Flytta data mellan utskalade molndatabaser</span><span class="sxs-lookup"><span data-stu-id="08b0e-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="08b0e-104">Om du är en programvara som en tjänst-utvecklare och plötsligt enorm begäran görs i appen, måste tooaccommodate hello tillväxt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need tooaccommodate hello growth.</span></span> <span data-ttu-id="08b0e-105">Så får du lägga till flera databaser (shards).</span><span class="sxs-lookup"><span data-stu-id="08b0e-105">So you add more databases (shards).</span></span> <span data-ttu-id="08b0e-106">Hur du distribuera hello data toohello nya databaser utan att störa hello dataintegritet?</span><span class="sxs-lookup"><span data-stu-id="08b0e-106">How do you redistribute hello data toohello new databases without disrupting hello data integrity?</span></span> <span data-ttu-id="08b0e-107">Använd hello **för delade sökvägssammanslagning** toomove data från begränsad databaser toohello nya databaser.</span><span class="sxs-lookup"><span data-stu-id="08b0e-107">Use hello **split-merge tool** toomove data from constrained databases toohello new databases.</span></span>  

<span data-ttu-id="08b0e-108">hello delade dokument verktyget körs som en Azure-webbtjänst.</span><span class="sxs-lookup"><span data-stu-id="08b0e-108">hello split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="08b0e-109">En administratör eller utvecklare använder hello verktyget toomove shardlets (data från en Fragmentera) mellan olika databaser (shards).</span><span class="sxs-lookup"><span data-stu-id="08b0e-109">An administrator or developer uses hello tool toomove shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="08b0e-110">hello verktyget använder Fragmentera kartan management toomaintain hello service metadata-databasen och säkerställa konsekvent mappningar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-110">hello tool uses shard map management toomaintain hello service metadata database, and ensure consistent mappings.</span></span>

![Översikt][1]

## <a name="download"></a><span data-ttu-id="08b0e-112">Ladda ned</span><span class="sxs-lookup"><span data-stu-id="08b0e-112">Download</span></span>
[<span data-ttu-id="08b0e-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="08b0e-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="08b0e-114">Dokumentation</span><span class="sxs-lookup"><span data-stu-id="08b0e-114">Documentation</span></span>
1. [<span data-ttu-id="08b0e-115">Elastisk dela Merge tool självstudie om databaser</span><span class="sxs-lookup"><span data-stu-id="08b0e-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="08b0e-116">Dela dokument säkerhetskonfiguration</span><span class="sxs-lookup"><span data-stu-id="08b0e-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="08b0e-117">Dela dokument säkerhetsaspekter</span><span class="sxs-lookup"><span data-stu-id="08b0e-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="08b0e-118">Karthantering för shard</span><span class="sxs-lookup"><span data-stu-id="08b0e-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="08b0e-119">Migrera befintliga databaser tooscale ut</span><span class="sxs-lookup"><span data-stu-id="08b0e-119">Migrate existing databases tooscale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="08b0e-120">Elastisk Databasverktyg</span><span class="sxs-lookup"><span data-stu-id="08b0e-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="08b0e-121">Ordlista för verktyg för elastisk databas</span><span class="sxs-lookup"><span data-stu-id="08b0e-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-hello-split-merge-tool"></a><span data-ttu-id="08b0e-122">Varför använda hello dela merge tool?</span><span class="sxs-lookup"><span data-stu-id="08b0e-122">Why use hello split-merge tool?</span></span>
<span data-ttu-id="08b0e-123">**Flexibilitet**</span><span class="sxs-lookup"><span data-stu-id="08b0e-123">**Flexibility**</span></span>

<span data-ttu-id="08b0e-124">Program behöver toostretch flexibelt utöver hello gränsvärden för en enskild Azure SQL DB-databas.</span><span class="sxs-lookup"><span data-stu-id="08b0e-124">Applications need toostretch flexibly beyond hello limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="08b0e-125">Använd hello verktyget toomove data som behövs toonew databaser samtidigt integritet.</span><span class="sxs-lookup"><span data-stu-id="08b0e-125">Use hello tool toomove data as needed toonew databases while retaining integrity.</span></span>

<span data-ttu-id="08b0e-126">**Dela toogrow**</span><span class="sxs-lookup"><span data-stu-id="08b0e-126">**Split toogrow**</span></span> 

<span data-ttu-id="08b0e-127">Du behöver tooincrease övergripande kapacitet toohandle enorm tillväxt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-127">You need tooincrease overall capacity toohandle explosive growth.</span></span> <span data-ttu-id="08b0e-128">toodo skapa ytterligare kapacitet så genom delning hello data och distribuera den över inkrementellt flera databaser tills kapacitetsbehov är uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="08b0e-128">toodo so, create additional capacity by sharding hello data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="08b0e-129">Detta är ett typiskt exempel hello-split-funktionen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-129">This is a prime example of hello ‘split’ feature.</span></span> 

<span data-ttu-id="08b0e-130">**Sammanfoga tooshrink**</span><span class="sxs-lookup"><span data-stu-id="08b0e-130">**Merge tooshrink**</span></span>

<span data-ttu-id="08b0e-131">Kapacitet måste krympa på grund av hur toohello när en organisation.</span><span class="sxs-lookup"><span data-stu-id="08b0e-131">Capacity needs shrink due toohello seasonal nature of a business.</span></span> <span data-ttu-id="08b0e-132">hello verktyg kan du skala ned toofewer skalenheter när business långsammare.</span><span class="sxs-lookup"><span data-stu-id="08b0e-132">hello tool lets you scale down toofewer scale units when business slows.</span></span> <span data-ttu-id="08b0e-133">hello '' utskrift i hello elastisk skalbarhet split-kopplingstjänsten beskriver det här kravet.</span><span class="sxs-lookup"><span data-stu-id="08b0e-133">hello ‘merge’ feature in hello Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="08b0e-134">**Hantera anslutningar genom att flytta shardlets**</span><span class="sxs-lookup"><span data-stu-id="08b0e-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="08b0e-135">Med flera innehavare per databas leda hello fördelning av shardlets tooshards toocapacity flaskhalsar på vissa delar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-135">With multiple tenants per database, hello allocation of shardlets tooshards can lead toocapacity bottlenecks on some shards.</span></span> <span data-ttu-id="08b0e-136">Detta kräver omfördelning shardlets eller flytta upptagen shardlets toonew eller mindre utnyttjade delar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-136">This requires re-allocating shardlets or moving busy shardlets toonew or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="08b0e-137">Begrepp & viktiga funktioner</span><span class="sxs-lookup"><span data-stu-id="08b0e-137">Concepts & key features</span></span>
<span data-ttu-id="08b0e-138">**Kund-värdbaserade tjänster**</span><span class="sxs-lookup"><span data-stu-id="08b0e-138">**Customer-hosted services**</span></span>

<span data-ttu-id="08b0e-139">hello dela sammanslagna levereras som en kund-värdbaserad tjänst.</span><span class="sxs-lookup"><span data-stu-id="08b0e-139">hello split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="08b0e-140">Du måste distribuera och värd hello-tjänsten i din Microsoft Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="08b0e-140">You must deploy and host hello service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="08b0e-141">hello-paket som du hämtar från NuGet innehåller en konfiguration mallen toocomplete med hello information för din distribution.</span><span class="sxs-lookup"><span data-stu-id="08b0e-141">hello package you download from NuGet contains a configuration template toocomplete with hello information for your specific deployment.</span></span> <span data-ttu-id="08b0e-142">Se hello [delade dokument kursen](sql-database-elastic-scale-configure-deploy-split-and-merge.md) mer information.</span><span class="sxs-lookup"><span data-stu-id="08b0e-142">See hello [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="08b0e-143">Eftersom hello-tjänsten körs i din Azure-prenumeration kan du styra och konfigureras säkerhet hello service.</span><span class="sxs-lookup"><span data-stu-id="08b0e-143">Since hello service runs in your Azure subscription, you can control and configure most security aspects of hello service.</span></span> <span data-ttu-id="08b0e-144">hello standardmallen innehåller hello alternativ tooconfigure SSL, certifikatbaserad klientautentisering, kryptering för lagrade autentiseringsuppgifter, DoS skyddar och IP-begränsningar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-144">hello default template includes hello options tooconfigure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="08b0e-145">Du hittar mer information om hello säkerhetsaspekter i följande dokument hello [delade dokument säkerhetskonfiguration](sql-database-elastic-scale-split-merge-security-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="08b0e-145">You can find more information on hello security aspects in hello following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="08b0e-146">hello standard distribuerade tjänsten körs med en arbetare och en webbroll.</span><span class="sxs-lookup"><span data-stu-id="08b0e-146">hello default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="08b0e-147">Var används hello A1 VM-storlek i Azure-molntjänster.</span><span class="sxs-lookup"><span data-stu-id="08b0e-147">Each uses hello A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="08b0e-148">Du inte kan ändra dessa inställningar när du distribuerar hello paketet, kan du ändra dem efter en lyckad distribution i hello kör molnbaserad tjänst (via hello Azure-portalen).</span><span class="sxs-lookup"><span data-stu-id="08b0e-148">While you cannot modify these settings when deploying hello package, you could change them after a successful deployment in hello running cloud service, (through hello Azure portal).</span></span> <span data-ttu-id="08b0e-149">Observera att hello worker-rollen inte måste konfigureras för mer än en instans av tekniska skäl.</span><span class="sxs-lookup"><span data-stu-id="08b0e-149">Note that hello worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="08b0e-150">**Fragmentera kartan integrering**</span><span class="sxs-lookup"><span data-stu-id="08b0e-150">**Shard map integration**</span></span>

<span data-ttu-id="08b0e-151">hello split-kopplingstjänsten samverkar med hello Fragmentera karta över hello program.</span><span class="sxs-lookup"><span data-stu-id="08b0e-151">hello split-merge service interacts with hello shard map of hello application.</span></span> <span data-ttu-id="08b0e-152">När du använder hello dela kopplingstjänsten toosplit eller merge-adressintervall eller toomove shardlets mellan shards, håller hello service automatiskt hello Fragmentera kartan in toodate.</span><span class="sxs-lookup"><span data-stu-id="08b0e-152">When using hello split-merge service toosplit or merge ranges or toomove shardlets between shards, hello service automatically keeps hello shard map up toodate.</span></span> <span data-ttu-id="08b0e-153">toodo så hello-tjänsten ansluter toohello Fragmentera kartan manager-databasen av programmet hello och underhåller intervall och mappningar som delade/merge/move-begäran pågår.</span><span class="sxs-lookup"><span data-stu-id="08b0e-153">toodo so, hello service connects toohello shard map manager database of hello application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="08b0e-154">Detta säkerställer som hello Fragmentera mappar alltid anger aktuell när ska dela dokument.</span><span class="sxs-lookup"><span data-stu-id="08b0e-154">This ensures that hello shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="08b0e-155">Dela, implementeras dokument och shardlet förflyttning genom att flytta en batch med shardlets från hello källa Fragmentera toohello mål Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from hello source shard toohello target shard.</span></span> <span data-ttu-id="08b0e-156">Under hello shardlet flytt åtgärden hello shardlets ämne toohello aktuell batch är markerad som offline i hello Fragmentera mappning och är inte tillgängligt för data-beroende anslutningar med hello **OpenConnectionForKey** API.</span><span class="sxs-lookup"><span data-stu-id="08b0e-156">During hello shardlet movement operation hello shardlets subject toohello current batch are marked as offline in hello shard map and are unavailable for data-dependent routing connections using hello **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="08b0e-157">**Konsekvent shardlet anslutningar**</span><span class="sxs-lookup"><span data-stu-id="08b0e-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="08b0e-158">Dataflyttning att starta en ny grupp med shardlets, alla angivna Fragmentera mappning data beroende routning anslutningar toohello Fragmentera lagra hello shardlet finns avlivade och efterföljande anslutningar från hello Fragmentera kartan API: er toohello dessa shardlets blockeras medan hello dataflyttning pågår i ordning tooavoid inkonsekvenser.</span><span class="sxs-lookup"><span data-stu-id="08b0e-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections toohello shard storing hello shardlet are killed and subsequent connections from hello shard map APIs toohello these shardlets are blocked while hello data movement is in progress in order tooavoid inconsistencies.</span></span> <span data-ttu-id="08b0e-159">Anslutningar tooother shardlets på hello samma Fragmentera också hämta avslutats, men kommer att lyckas igen omedelbart på försök igen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-159">Connections tooother shardlets on hello same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="08b0e-160">När hello batch flyttas hello shardlets markeras online igen för hello mål Fragmentera och hello källdata tas bort från hello källa Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-160">Once hello batch is moved, hello shardlets are marked online again for hello target shard and hello source data is removed from hello source shard.</span></span> <span data-ttu-id="08b0e-161">hello tjänsten går igenom de här stegen för varje batch tills alla shardlets har flyttats.</span><span class="sxs-lookup"><span data-stu-id="08b0e-161">hello service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="08b0e-162">Detta leder tooseveral anslutningsåtgärder kill under hello hello fullständig move-dela/merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-162">This will lead tooseveral connection kill operations during hello course of hello complete split/merge/move operation.</span></span>  

<span data-ttu-id="08b0e-163">**Hantera shardlet tillgänglighet**</span><span class="sxs-lookup"><span data-stu-id="08b0e-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="08b0e-164">Begränsa hello anslutningen om du avbryter toohello aktuell batch för shardlets som beskrivs ovan begränsar hello omfattning otillgänglighet tooone batch med shardlets i taget.</span><span class="sxs-lookup"><span data-stu-id="08b0e-164">Limiting hello connection killing toohello current batch of shardlets as discussed above restricts hello scope of unavailability tooone batch of shardlets at a time.</span></span> <span data-ttu-id="08b0e-165">Detta är att föredra över en metod där hello fullständig Fragmentera är offline för alla shardlets under hello loppet av en delad eller merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-165">This is preferred over an approach where hello complete shard would remain offline for all its shardlets during hello course of a split or merge operation.</span></span> <span data-ttu-id="08b0e-166">hello storleken på en grupp som definierats som hello antalet distinkta shardlets toomove samtidigt, är en konfigurationsparameter.</span><span class="sxs-lookup"><span data-stu-id="08b0e-166">hello size of a batch, defined as hello number of distinct shardlets toomove at a time, is a configuration parameter.</span></span> <span data-ttu-id="08b0e-167">Det kan definieras för varje dela och slå samman åtgärd beroende på behov av hello programmets tillgänglighet och prestanda.</span><span class="sxs-lookup"><span data-stu-id="08b0e-167">It can be defined for each split and merge operation depending on hello application’s availability and performance needs.</span></span> <span data-ttu-id="08b0e-168">Observera att hello-intervall som håller på att låsas i hello Fragmentera mappning kan vara större än hello batchstorlek anges.</span><span class="sxs-lookup"><span data-stu-id="08b0e-168">Note that hello range that is being locked in hello shard map may be larger than hello batch size specified.</span></span> <span data-ttu-id="08b0e-169">Det beror på att hello service hämtar hello intervallet storlek så att hello faktiska horisontell partitionering nyckelvärdena i hello data cirka matchar hello batchstorlek.</span><span class="sxs-lookup"><span data-stu-id="08b0e-169">This is because hello service picks hello range size such that hello actual number of sharding key values in hello data approximately matches hello batch size.</span></span> <span data-ttu-id="08b0e-170">Detta är särskilt viktigt tooremember för glesbefolkade horisontell partitionering nycklar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-170">This is important tooremember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="08b0e-171">**Utrymmet för metadata**</span><span class="sxs-lookup"><span data-stu-id="08b0e-171">**Metadata storage**</span></span>

<span data-ttu-id="08b0e-172">hello split-kopplingstjänsten använder en databas toomaintain status och tookeep loggar under bearbetning av begäran.</span><span class="sxs-lookup"><span data-stu-id="08b0e-172">hello split-merge service uses a database toomaintain its status and tookeep logs during request processing.</span></span> <span data-ttu-id="08b0e-173">hello användaren i prenumerationen skapas denna databas och ger hello anslutningssträngen för den i hello konfigurationsfilen för hello service-distributionen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-173">hello user creates this database in their subscription and provides hello connection string for it in hello configuration file for hello service deployment.</span></span> <span data-ttu-id="08b0e-174">Administratörer från hello användarens organisation kan också ansluta toothis databasen tooreview begäran förlopp och tooinvestigate detaljerad information om potentiella problem.</span><span class="sxs-lookup"><span data-stu-id="08b0e-174">Administrators from hello user’s organization can also connect toothis database tooreview request progress and tooinvestigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="08b0e-175">**Horisontell partitionering medvetenhet**</span><span class="sxs-lookup"><span data-stu-id="08b0e-175">**Sharding-awareness**</span></span>

<span data-ttu-id="08b0e-176">hello split-kopplingstjänsten skiljer mellan (1) delat tabeller och (2) referenstabellerna (3) normal tabeller.</span><span class="sxs-lookup"><span data-stu-id="08b0e-176">hello split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="08b0e-177">hello semantiken för en move-dela/merge-åtgärd beror på hello hello-tabell som används och definieras enligt följande:</span><span class="sxs-lookup"><span data-stu-id="08b0e-177">hello semantics of a split/merge/move operation depend on hello type of hello table used and are defined as follows:</span></span> 

* <span data-ttu-id="08b0e-178">**Delat tabeller**: dela dokument och flytta flytta shardlets från källan tootarget Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-178">**Sharded tables**: Split, merge, and move operations move shardlets from source tootarget shard.</span></span> <span data-ttu-id="08b0e-179">Efter slutförd hello övergripande begära dessa shardlets inte längre finns på hello källan.</span><span class="sxs-lookup"><span data-stu-id="08b0e-179">After successful completion of hello overall request, those shardlets are no longer present on hello source.</span></span> <span data-ttu-id="08b0e-180">Observera att hello måltabeller måste tooexist på hello mål Fragmentera och får inte innehålla data i hello mål intervallet tidigare tooprocessing av hello-åtgärden.</span><span class="sxs-lookup"><span data-stu-id="08b0e-180">Note that hello target tables need tooexist on hello target shard and must not contain data in hello target range prior tooprocessing of hello operation.</span></span> 
* <span data-ttu-id="08b0e-181">**Refererar till tabeller**: för register, hello delning, slå samman och flytta operations kopiera hello data från hello källa toohello mål Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-181">**Reference tables**: For reference tables, hello split, merge and move operations copy hello data from hello source toohello target shard.</span></span> <span data-ttu-id="08b0e-182">Observera att inga ändringar inträffar på hello mål Fragmentera för en viss tabell om en rad finns redan i den här tabellen på hello målet.</span><span class="sxs-lookup"><span data-stu-id="08b0e-182">Note, however, that no changes occur on hello target shard for a given table if any row is already present in this table on hello target.</span></span> <span data-ttu-id="08b0e-183">hello-tabellen har toobe tomt för alla referens tabell Kopiera åtgärden tooget bearbetas.</span><span class="sxs-lookup"><span data-stu-id="08b0e-183">hello table has toobe empty for any reference table copy operation tooget processed.</span></span>
* <span data-ttu-id="08b0e-184">**Andra tabeller**: andra tabeller kan finnas på hello käll- eller hello målet för en delning och merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-184">**Other Tables**: Other tables can be present on either hello source or hello target of a split and merge operation.</span></span> <span data-ttu-id="08b0e-185">hello split-kopplingstjänsten ignorerar dessa tabeller för dataflyttning eller kopiering.</span><span class="sxs-lookup"><span data-stu-id="08b0e-185">hello split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="08b0e-186">Observera att de stör dessa åtgärder vid begränsningar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="08b0e-187">hello-information för referens kontra delat tabeller tillhandahålls av hello **SchemaInfo** API: er på hello Fragmentera karta.</span><span class="sxs-lookup"><span data-stu-id="08b0e-187">hello information on reference vs. sharded tables is provided by hello **SchemaInfo** APIs on hello shard map.</span></span> <span data-ttu-id="08b0e-188">hello som följande exempel visar hello användning av dessa API: er på en viss Fragmentera kartan manager objektet smm:</span><span class="sxs-lookup"><span data-stu-id="08b0e-188">hello following example illustrates hello use of these APIs on a given shard map manager object smm:</span></span> 

    // Create hello schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="08b0e-189">hello tabeller 'region' och 'landet' har definierats som referenstabellerna och kommer att kopieras med move-dela/merge-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="08b0e-189">hello tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="08b0e-190">”kund” och 'order' definieras i sin tur som delat tabeller.</span><span class="sxs-lookup"><span data-stu-id="08b0e-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="08b0e-191">C_CUSTKEY och O_CUSTKEY fungera som hello horisontell partitionering nyckel.</span><span class="sxs-lookup"><span data-stu-id="08b0e-191">C_CUSTKEY and O_CUSTKEY serve as hello sharding key.</span></span> 

<span data-ttu-id="08b0e-192">**Referensintegritet**</span><span class="sxs-lookup"><span data-stu-id="08b0e-192">**Referential Integrity**</span></span>

<span data-ttu-id="08b0e-193">hello split-kopplingstjänsten analyserar alla beroenden mellan tabellerna och använder primära nyckel sekundärnyckelrelationer toostage hello åtgärder för att flytta referenstabellerna och shardlets.</span><span class="sxs-lookup"><span data-stu-id="08b0e-193">hello split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships toostage hello operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="08b0e-194">I allmänhet kopieras referenstabellerna först i beroendeordningen, och sedan shardlets kopieras i den ordning de beroenden inom varje grupp.</span><span class="sxs-lookup"><span data-stu-id="08b0e-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="08b0e-195">Detta är nödvändigt så att gäller FK PK begränsningar på hello mål Fragmentera som anländer hello nya data.</span><span class="sxs-lookup"><span data-stu-id="08b0e-195">This is necessary so that FK-PK constraints on hello target shard are honored as hello new data arrives.</span></span> 

<span data-ttu-id="08b0e-196">**Fragmentera kartan konsekvens och eventuell slutförande**</span><span class="sxs-lookup"><span data-stu-id="08b0e-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="08b0e-197">I hello närvaro fel, hello split-kopplingstjänsten återupptar åtgärder efter eventuella avbrott och syftar toocomplete någon i förloppet begäranden.</span><span class="sxs-lookup"><span data-stu-id="08b0e-197">In hello presence of failures, hello split-merge service resumes operations after any outage and aims toocomplete any in progress requests.</span></span> <span data-ttu-id="08b0e-198">Det kan dock finnas oåterkalleligt situationer, t.ex. när hello mål Fragmentera tappas bort eller komprometteras inte repareras.</span><span class="sxs-lookup"><span data-stu-id="08b0e-198">However, there may be unrecoverable situations, e.g., when hello target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="08b0e-199">Under dessa omständigheter kan vissa shardlets som skulle flyttas toobe fortsätta tooreside på hello källa Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-199">Under those circumstances, some shardlets that were supposed toobe moved may continue tooreside on hello source shard.</span></span> <span data-ttu-id="08b0e-200">hello service garanterar att shardlet mappningar uppdateras bara efter hello nödvändiga data har korrekt kopierade toohello mål.</span><span class="sxs-lookup"><span data-stu-id="08b0e-200">hello service ensures that shardlet mappings are only updated after hello necessary data has been successfully copied toohello target.</span></span> <span data-ttu-id="08b0e-201">Shardlets bara ta bort på hello källan när alla data har kopierats toohello mål och hello motsvarande mappningar har uppdaterats.</span><span class="sxs-lookup"><span data-stu-id="08b0e-201">Shardlets are only deleted on hello source once all their data has been copied toohello target and hello corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="08b0e-202">hello borttagningsåtgärden avbryts sker i bakgrunden hello när hello intervallet är redan online på hello mål Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-202">hello deletion operation happens in hello background while hello range is already online on hello target shard.</span></span> <span data-ttu-id="08b0e-203">hello split-kopplingstjänsten garanterar alltid hello avbildningar lagras i hello Fragmentera mappningen är korrekt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-203">hello split-merge service always ensures correctness of hello mappings stored in hello shard map.</span></span>

## <a name="hello-split-merge-user-interface"></a><span data-ttu-id="08b0e-204">användargränssnittet för hello delade dokument</span><span class="sxs-lookup"><span data-stu-id="08b0e-204">hello split-merge user interface</span></span>
<span data-ttu-id="08b0e-205">hello dela kopplingstjänsten paketet innehåller en arbetsroll och en webbroll.</span><span class="sxs-lookup"><span data-stu-id="08b0e-205">hello split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="08b0e-206">Hej webbroll begärs används toosubmit delade dokument på ett interaktivt sätt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-206">hello web role is used toosubmit split-merge requests in an interactive way.</span></span> <span data-ttu-id="08b0e-207">hello huvudkomponenterna i hello användargränssnittet är följande:</span><span class="sxs-lookup"><span data-stu-id="08b0e-207">hello main components of hello user interface are as follows:</span></span>

* <span data-ttu-id="08b0e-208">Åtgärdstyp av: hello åtgärdstypen är en alternativknapp som styr hello typ av åtgärd som utförs av hello-tjänsten för denna begäran.</span><span class="sxs-lookup"><span data-stu-id="08b0e-208">Operation Type: hello operation type is a radio button that controls hello kind of operation performed by hello service for this request.</span></span> <span data-ttu-id="08b0e-209">Du kan välja mellan hello dela, slå samman och flytta scenarier.</span><span class="sxs-lookup"><span data-stu-id="08b0e-209">You can choose between hello split, merge and move scenarios.</span></span> <span data-ttu-id="08b0e-210">Du kan också avbryta en tidigare skickade.</span><span class="sxs-lookup"><span data-stu-id="08b0e-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="08b0e-211">Du kan använda delade, slå samman och flytta begäranden för intervallet Fragmentera maps.</span><span class="sxs-lookup"><span data-stu-id="08b0e-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="08b0e-212">Lista Fragmentera mappar endast stöd för move-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="08b0e-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="08b0e-213">Fragmentera mappa: hello nästa avsnitt av begäran parametrar omfattar information om hello Fragmentera karta och hello databasen värd Fragmentera kartan.</span><span class="sxs-lookup"><span data-stu-id="08b0e-213">Shard Map: hello next section of request parameters cover information about hello shard map and hello database hosting your shard map.</span></span> <span data-ttu-id="08b0e-214">I synnerhet måste tooprovide hello namn hello Azure SQL Database-server och databas som värd för hello shardmap, autentiseringsuppgifter tooconnect toohello Fragmentera mappa databasen och slutligen hello namnet på hello Fragmentera kartan.</span><span class="sxs-lookup"><span data-stu-id="08b0e-214">In particular, you need tooprovide hello name of hello Azure SQL Database server and database hosting hello shardmap, credentials tooconnect toohello shard map database, and finally hello name of hello shard map.</span></span> <span data-ttu-id="08b0e-215">För närvarande accepterar hello åtgärden bara en enda uppsättning autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="08b0e-215">Currently, hello operation only accepts a single set of credentials.</span></span> <span data-ttu-id="08b0e-216">Dessa autentiseringsuppgifter måste toohave behörighet tooperform ändras toohello Fragmentera kartan samt toohello användardata på hello delar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-216">These credentials need toohave sufficient permissions tooperform changes toohello shard map as well as toohello user data on hello shards.</span></span>
* <span data-ttu-id="08b0e-217">Käll-adressintervall (dela och sammanfoga): en åtgärd för dela och slå samman bearbetar ett intervall med den lägsta och högsta nyckeln.</span><span class="sxs-lookup"><span data-stu-id="08b0e-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="08b0e-218">toospecify en åtgärd med ett unbounded hög nyckelvärde, kontrollera hello ”övre nyckel är max” kryssrutan och lämna hello hög fält tomt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-218">toospecify an operation with an unbounded high key value, check hello “High key is max” check box and leave hello high key field empty.</span></span> <span data-ttu-id="08b0e-219">hello intervallet nyckelvärden som du anger göra måste tooprecisely matchar inte en mappning och dess gränser i kartan Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-219">hello range key values that you specify do not need tooprecisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="08b0e-220">Om du inte anger någon adressintervallsgränser alls kommer hello tjänsten härleda hello närmaste intervall du automatiskt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-220">If you do not specify any range boundaries at all hello service will infer hello closest range for you automatically.</span></span> <span data-ttu-id="08b0e-221">Du kan använda hello GetMappings.ps1 PowerShell tooretrieve hello aktuella skriptmappningar i en given Fragmentera karta.</span><span class="sxs-lookup"><span data-stu-id="08b0e-221">You can use hello GetMappings.ps1 PowerShell script tooretrieve hello current mappings in a given shard map.</span></span>
* <span data-ttu-id="08b0e-222">Dela källa beteende (delning): för dela-åtgärder, definiera hello punkt toosplit hello käll-adressintervall.</span><span class="sxs-lookup"><span data-stu-id="08b0e-222">Split Source Behavior (split): For split operations, define hello point toosplit hello source range.</span></span> <span data-ttu-id="08b0e-223">Det gör du genom att tillhandahålla hello horisontell partitionering nyckeln där du vill att hello dela toooccur.</span><span class="sxs-lookup"><span data-stu-id="08b0e-223">You do this by providing hello sharding key where you want hello split toooccur.</span></span> <span data-ttu-id="08b0e-224">Använd hello knappen Ange om du vill att hello nedre delen av hello intervallet (exklusive hello dela nyckel) toomove eller om du vill att hello övre delen toomove (inklusive hello delad nyckel).</span><span class="sxs-lookup"><span data-stu-id="08b0e-224">Use hello radio button specify whether you want hello lower part of hello range (excluding hello split key) toomove, or whether you want hello upper part toomove (including hello split key).</span></span>
* <span data-ttu-id="08b0e-225">Datakällan Shardlet (flytta): flytta operations skiljer sig från delade eller merge-åtgärder eftersom de inte kräver en intervallet toodescribe hello källa.</span><span class="sxs-lookup"><span data-stu-id="08b0e-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range toodescribe hello source.</span></span> <span data-ttu-id="08b0e-226">En källa för flytta identifieras bara av hello horisontell partitionering nyckelvärdet du planerar toomove.</span><span class="sxs-lookup"><span data-stu-id="08b0e-226">A source for move is simply identified by hello sharding key value that you plan toomove.</span></span>
* <span data-ttu-id="08b0e-227">Rikta Fragmentera (delning): när du har angett hello information i hello källa split-åtgärden, måste toodefine där du vill att hello data toobe kopieras tooby tillhandahåller hello Azure SQL Db-server och databasnamnet för hello mål.</span><span class="sxs-lookup"><span data-stu-id="08b0e-227">Target Shard (split): Once you have provided hello information on hello source of your split operation, you need toodefine where you want hello data toobe copied tooby providing hello Azure SQL Db server and database name for hello target.</span></span>
* <span data-ttu-id="08b0e-228">Målområdet (merge): Merge-operationer flytta shardlets tooan befintliga Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-228">Target Range (merge): Merge operations move shardlets tooan existing shard.</span></span> <span data-ttu-id="08b0e-229">Du kan identifiera hello befintliga Fragmentera genom att tillhandahålla hello adressintervallsgränser av befintliga hello-intervall som du vill toomerge med.</span><span class="sxs-lookup"><span data-stu-id="08b0e-229">You identify hello existing shard by providing hello range boundaries of hello existing range that you want toomerge with.</span></span>
* <span data-ttu-id="08b0e-230">Batchstorlek: hello batch storlek kontroller hello antalet shardlets försätts offline i taget under hello dataflyttning.</span><span class="sxs-lookup"><span data-stu-id="08b0e-230">Batch Size: hello batch size controls hello number of shardlets that will go offline at a time during hello data movement.</span></span> <span data-ttu-id="08b0e-231">Detta är ett heltalsvärde där du kan använda mindre värden när du är känsliga toolong stilleståndsperioder för shardlets.</span><span class="sxs-lookup"><span data-stu-id="08b0e-231">This is an integer value where you can use smaller values when you are sensitive toolong periods of downtime for shardlets.</span></span> <span data-ttu-id="08b0e-232">Högre värden ökar hello tid som en given shardlet är offline men kan förbättra prestanda.</span><span class="sxs-lookup"><span data-stu-id="08b0e-232">Larger values will increase hello time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="08b0e-233">Åtgärds-Id (Avbryt): Om du har en pågående åtgärd som inte längre behövs, du kan avbryta hello genom att ange dess åtgärds-ID i det här fältet.</span><span class="sxs-lookup"><span data-stu-id="08b0e-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel hello operation by providing its operation ID in this field.</span></span> <span data-ttu-id="08b0e-234">Du kan hämta hello åtgärds-ID från hello begäran statustabellen (se avsnittet 8.1) eller från hello utdata i hello webbläsare där du skickade begäran om hello.</span><span class="sxs-lookup"><span data-stu-id="08b0e-234">You can retrieve hello operation ID from hello request status table (see Section 8.1) or from hello output in hello web browser where you submitted hello request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="08b0e-235">Krav och begränsningar</span><span class="sxs-lookup"><span data-stu-id="08b0e-235">Requirements and Limitations</span></span>
<span data-ttu-id="08b0e-236">hello aktuella implementationen av hello split-kopplingstjänsten är ämne toohello följande krav och begränsningar:</span><span class="sxs-lookup"><span data-stu-id="08b0e-236">hello current implementation of hello split-merge service is subject toohello following requirements and limitations:</span></span> 

* <span data-ttu-id="08b0e-237">hello delar måste tooexist och registreras i hello Fragmentera mappningen innan en delad merge-åtgärd på dessa delar kan utföras.</span><span class="sxs-lookup"><span data-stu-id="08b0e-237">hello shards need tooexist and be registered in hello shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="08b0e-238">hello-tjänsten kan inte skapa tabeller eller andra databasobjekt automatiskt som en del av dessa åtgärder.</span><span class="sxs-lookup"><span data-stu-id="08b0e-238">hello service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="08b0e-239">Det betyder att hello schemat för alla delat tabeller och refererar till tabeller måste tooexist på hello mål Fragmentera tidigare tooany dela/merge/move-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-239">This means that hello schema for all sharded tables and reference tables need tooexist on hello target shard prior tooany split/merge/move operation.</span></span> <span data-ttu-id="08b0e-240">Delat tabeller är särskilt krävs toobe tomt i hello intervallet där nya shardlets är toobe som lagts till av en move-dela/merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-240">Sharded tables in particular are required toobe empty in hello range where new shardlets are toobe added by a split/merge/move operation.</span></span> <span data-ttu-id="08b0e-241">Annars misslyckas åtgärden hello hello inledande konsekvenskontroll på hello mål Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-241">Otherwise, hello operation will fail hello initial consistency check on hello target shard.</span></span> <span data-ttu-id="08b0e-242">Observera referensdata kopieras bara om hello referenstabellen är tom och att det inte finns några konsekvens garanterar även med beaktande tooother samtidiga skrivåtgärder på hello register.</span><span class="sxs-lookup"><span data-stu-id="08b0e-242">Also note that reference data is only copied if hello reference table is empty and that there are no consistency guarantees with regard tooother concurrent write operations on hello reference tables.</span></span> <span data-ttu-id="08b0e-243">Vi rekommenderar detta: när du kör dela/merge-operationer kan inga andra skrivåtgärder ändrar toohello register.</span><span class="sxs-lookup"><span data-stu-id="08b0e-243">We recommend this: when running split/merge operations, no other write operations make changes toohello reference tables.</span></span>
* <span data-ttu-id="08b0e-244">hello tjänst förlitar sig på rad-ID som upprättas genom ett unikt index eller en nyckel som innehåller hello horisontell partitionering viktiga tooimprove prestanda och tillförlitlighet för stora shardlets.</span><span class="sxs-lookup"><span data-stu-id="08b0e-244">hello service relies on row identity established by a unique index or key that includes hello sharding key tooimprove performance and reliability for large shardlets.</span></span> <span data-ttu-id="08b0e-245">Detta gör att hello service toomove data på ett även ökad detaljnivå än bara hello horisontell partitionering nyckel/värde.</span><span class="sxs-lookup"><span data-stu-id="08b0e-245">This allows hello service toomove data at an even finer granularity than just hello sharding key value.</span></span> <span data-ttu-id="08b0e-246">Detta hjälper tooreduce hello maximal mängd loggutrymme och lås som krävs under hello-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-246">This helps tooreduce hello maximum amount of log space and locks that are required during hello operation.</span></span> <span data-ttu-id="08b0e-247">Överväg att skapa ett unikt index eller primärnyckel inklusive hello horisontell partitionering nyckel för en given tabell om du vill toouse tabellen med delade/merge/move-begäranden.</span><span class="sxs-lookup"><span data-stu-id="08b0e-247">Consider creating a unique index or a primary key including hello sharding key on a given table if you want toouse that table with split/merge/move requests.</span></span> <span data-ttu-id="08b0e-248">Av prestandaskäl ska hello horisontell partitionering nyckeln hello inledande kolumn i hello nyckel eller hello index.</span><span class="sxs-lookup"><span data-stu-id="08b0e-248">For performance reasons, hello sharding key should be hello leading column in hello key or hello index.</span></span>
* <span data-ttu-id="08b0e-249">Under hello behandling av begäranden, kanske vissa shardlet data finns både på hello käll- och hello mål Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="08b0e-249">During hello course of request processing, some shardlet data may be present both on hello source and hello target shard.</span></span> <span data-ttu-id="08b0e-250">Detta är nödvändigt tooprotect mot fel under hello shardlet förflyttning.</span><span class="sxs-lookup"><span data-stu-id="08b0e-250">This is necessary tooprotect against failures during hello shardlet movement.</span></span> <span data-ttu-id="08b0e-251">hello integrering av dela dokument med hello Fragmentera karta garanterar att anslutningar via hello data beroende routning API: er med hjälp av hello **OpenConnectionForKey** metod på hello Fragmentera karta inte ser alla mellanliggande inkonsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-251">hello integration of split-merge with hello shard map ensures that connections through hello data dependent routing APIs using hello **OpenConnectionForKey** method on hello shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="08b0e-252">Men när anslutande toohello käll- eller hello mot shards utan att använda hello **OpenConnectionForKey** metoden inkonsekvent mellanliggande tillstånd kanske visas när du ska dela/merge/move-begäranden.</span><span class="sxs-lookup"><span data-stu-id="08b0e-252">However, when connecting toohello source or hello target shards without using hello **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="08b0e-253">Dessa anslutningar kan visa helt eller delvis dubbla resultat beroende på hello tidsinställning eller hello Fragmentera underliggande hello anslutningen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-253">These connections may show partial or duplicate results depending on hello timing or hello shard underlying hello connection.</span></span> <span data-ttu-id="08b0e-254">Den här begränsningen innehåller för närvarande hello anslutningar av elastisk skalbarhet flera-Shard-frågor.</span><span class="sxs-lookup"><span data-stu-id="08b0e-254">This limitation currently includes hello connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="08b0e-255">hello metadata-databasen för hello split-kopplingstjänsten måste inte delas mellan olika roller.</span><span class="sxs-lookup"><span data-stu-id="08b0e-255">hello metadata database for hello split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="08b0e-256">Till exempel måste en roll hello delade dokument service körs i Förproduktion toopoint tooa olika metadata-databasen än hello produktion roll.</span><span class="sxs-lookup"><span data-stu-id="08b0e-256">For example, a role of hello split-merge service running in staging needs toopoint tooa different metadata database than hello production role.</span></span>

## <a name="billing"></a><span data-ttu-id="08b0e-257">Fakturering</span><span class="sxs-lookup"><span data-stu-id="08b0e-257">Billing</span></span>
<span data-ttu-id="08b0e-258">hello dela merge-tjänsten körs som en tjänst i molnet i Microsoft Azure-prenumerationen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-258">hello split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="08b0e-259">Därför gäller avgifter för molntjänster tooyour hello service-instans.</span><span class="sxs-lookup"><span data-stu-id="08b0e-259">Therefore charges for cloud services apply tooyour instance of hello service.</span></span> <span data-ttu-id="08b0e-260">Om du ofta utför move-dela/merge-åtgärder rekommenderar vi att du tar bort dina delade dokument Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="08b0e-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="08b0e-261">Som kostnaderna för att köra eller distribueras molnet tjänstinstanser.</span><span class="sxs-lookup"><span data-stu-id="08b0e-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="08b0e-262">Du kan distribuera och starta lätt körbara konfigurationen när du behöver tooperform split- eller merge-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="08b0e-262">You can re-deploy and start your readily runnable configuration whenever you need tooperform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="08b0e-263">Övervakning</span><span class="sxs-lookup"><span data-stu-id="08b0e-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="08b0e-264">Status för tabeller</span><span class="sxs-lookup"><span data-stu-id="08b0e-264">Status tables</span></span>
<span data-ttu-id="08b0e-265">hello dela kopplingstjänsten ger hello **RequestStatus** tabell i databasen hello metadata lagring för övervakning av slutfördes och en pågående begäranden.</span><span class="sxs-lookup"><span data-stu-id="08b0e-265">hello split-merge Service provides hello **RequestStatus** table in hello metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="08b0e-266">hello tabell innehåller en rad för varje delad kopplingsbegäran som har skickats toothis instans av hello split-kopplingstjänsten.</span><span class="sxs-lookup"><span data-stu-id="08b0e-266">hello table lists a row for each split-merge request that has been submitted toothis instance of hello split-merge service.</span></span> <span data-ttu-id="08b0e-267">Den ger hello följande information för varje begäran:</span><span class="sxs-lookup"><span data-stu-id="08b0e-267">It gives hello following information for each request:</span></span>

* <span data-ttu-id="08b0e-268">**Tidsstämpel**: hello tid och datum när hello begäran startades.</span><span class="sxs-lookup"><span data-stu-id="08b0e-268">**Timestamp**: hello time and date when hello request was started.</span></span>
* <span data-ttu-id="08b0e-269">**Åtgärds-ID**: ett GUID som unikt identifierar hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="08b0e-269">**OperationId**: A GUID that uniquely identifies hello request.</span></span> <span data-ttu-id="08b0e-270">Denna begäran kan också vara används toocancel hello åtgärden medan det pågår fortfarande.</span><span class="sxs-lookup"><span data-stu-id="08b0e-270">This request can also be used toocancel hello operation while it is still ongoing.</span></span>
* <span data-ttu-id="08b0e-271">**Status för**: hello hello begäran aktuella tillstånd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-271">**Status**: hello current state of hello request.</span></span> <span data-ttu-id="08b0e-272">För pågående begäranden dessutom visas hello Aktuell fas i vilken hello-begäran är.</span><span class="sxs-lookup"><span data-stu-id="08b0e-272">For ongoing requests, it also lists hello current phase in which hello request is.</span></span>
* <span data-ttu-id="08b0e-273">**CancelRequest**: en flagga som anger om hello begäran har avbrutits.</span><span class="sxs-lookup"><span data-stu-id="08b0e-273">**CancelRequest**: A flag that indicates whether hello request has been cancelled.</span></span>
* <span data-ttu-id="08b0e-274">**Förlopp**: en del uppskattning av hello-åtgärden har slutförts.</span><span class="sxs-lookup"><span data-stu-id="08b0e-274">**Progress**: A percentage estimate of completion for hello operation.</span></span> <span data-ttu-id="08b0e-275">Ett värde på 50 anger att hello åtgärden är klar ungefär 50%.</span><span class="sxs-lookup"><span data-stu-id="08b0e-275">A value of 50 indicates that hello operation is approximately 50% complete.</span></span>
* <span data-ttu-id="08b0e-276">**Information om**: en XML-värde som innehåller en mer detaljerad rapport.</span><span class="sxs-lookup"><span data-stu-id="08b0e-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="08b0e-277">Hej förloppsrapport uppdateras regelbundet som anger rader kopieras från källan tootarget.</span><span class="sxs-lookup"><span data-stu-id="08b0e-277">hello progress report is periodically updated as sets of rows are copied from source tootarget.</span></span> <span data-ttu-id="08b0e-278">Den här kolumnen innehåller också mer detaljerad information om hello fel vid fel eller undantag.</span><span class="sxs-lookup"><span data-stu-id="08b0e-278">In case of failures or exceptions, this column also includes more detailed information about hello failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="08b0e-279">Azure Diagnostics</span><span class="sxs-lookup"><span data-stu-id="08b0e-279">Azure Diagnostics</span></span>
<span data-ttu-id="08b0e-280">hello split-kopplingstjänsten använder Azure-diagnostik baserat på Azure SDK 2.5 för övervakning och diagnostik.</span><span class="sxs-lookup"><span data-stu-id="08b0e-280">hello split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="08b0e-281">Du kan styra hello diagnostik konfigurationen som beskrivs här: [aktiverar diagnostik i Azure-molntjänster och virtuella datorer](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="08b0e-281">You control hello diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="08b0e-282">hello hämtningspaketet innehåller två konfigurationer av diagnostik - en för hello-webbroll och en för hello worker-rollen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-282">hello download package includes two diagnostics configurations - one for hello web role and one for hello worker role.</span></span> <span data-ttu-id="08b0e-283">Konfigurationerna diagnostik för hello tjänsten följer hello vägledning från [Cloud Service grunderna i Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span><span class="sxs-lookup"><span data-stu-id="08b0e-283">These diagnostics configurations for hello service follow hello guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="08b0e-284">Den omfattar hello definitioner toolog prestandaräknare, IIS loggar, Windows-händelseloggar och dela dokument, program-händelseloggar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-284">It includes hello definitions toolog Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="08b0e-285">Distribuera diagnostik</span><span class="sxs-lookup"><span data-stu-id="08b0e-285">Deploy Diagnostics</span></span>
<span data-ttu-id="08b0e-286">tooenable övervakning och diagnostik använder hello diagnostikkonfiguration för hello webb- och arbetsroller roller som tillhandahålls av hello NuGet-paketet, kör följande kommandon med hjälp av Azure PowerShell hello:</span><span class="sxs-lookup"><span data-stu-id="08b0e-286">tooenable monitoring and diagnostics using hello diagnostic configuration for hello web and worker roles provided by hello NuGet package, run hello following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="08b0e-287">Du hittar mer information om hur tooconfigure och distribuera här diagnostikinställningar: [aktiverar diagnostik i Azure-molntjänster och virtuella datorer](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="08b0e-287">You can find more information on how tooconfigure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="08b0e-288">Hämta diagnostik</span><span class="sxs-lookup"><span data-stu-id="08b0e-288">Retrieve diagnostics</span></span>
<span data-ttu-id="08b0e-289">Du kan enkelt komma åt din diagnostik från hello Visual Studio Server Explorer i hello Azure en del av hello Server Explorer träd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-289">You can easily access your diagnostics from hello Visual Studio Server Explorer in hello Azure part of hello Server Explorer tree.</span></span> <span data-ttu-id="08b0e-290">Öppna en Visual Studio-instans och i hello menyraden klickar du på Visa och Server Explorer.</span><span class="sxs-lookup"><span data-stu-id="08b0e-290">Open a Visual Studio instance, and in hello menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="08b0e-291">Klicka på hello Azure ikonen tooconnect tooyour Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="08b0e-291">Click hello Azure icon tooconnect tooyour Azure subscription.</span></span> <span data-ttu-id="08b0e-292">Gå sedan tooAzure -> Storage -> <your storage account> -> tabeller -> WADLogsTable.</span><span class="sxs-lookup"><span data-stu-id="08b0e-292">Then navigate tooAzure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="08b0e-293">Mer information finns i [surfning lagringsresurser med Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span><span class="sxs-lookup"><span data-stu-id="08b0e-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="08b0e-295">Hej WADLogsTable markerade i hello siffran ovan innehåller hello detaljerad händelser från hello delade dokument service programloggen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-295">hello WADLogsTable highlighted in hello figure above contains hello detailed events from hello split-merge service’s application log.</span></span> <span data-ttu-id="08b0e-296">Observera att hello standardkonfigurationen av hello hämtade paketet riktar sig till en Produktionsdistribution.</span><span class="sxs-lookup"><span data-stu-id="08b0e-296">Note that hello default configuration of hello downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="08b0e-297">Därför är Hej då loggar och räknare hämtas från hello tjänstinstanser stor (5 minuter).</span><span class="sxs-lookup"><span data-stu-id="08b0e-297">Therefore hello interval at which logs and counters are pulled from hello service instances is large (5 minutes).</span></span> <span data-ttu-id="08b0e-298">Lägre hello intervall genom att justera hello diagnostikinställningarna för hello webb- eller hello worker-rollen tooyour måste för testning och utveckling.</span><span class="sxs-lookup"><span data-stu-id="08b0e-298">For test and development, lower hello interval by adjusting hello diagnostics settings of hello web or hello worker role tooyour needs.</span></span> <span data-ttu-id="08b0e-299">Högerklicka på hello roll i hello Visual Studio Server Explorer (se ovan) och justera sedan hello överföra Period i hello dialogrutan för hello diagnostikinställningarna för konfiguration:</span><span class="sxs-lookup"><span data-stu-id="08b0e-299">Right-click on hello role in hello Visual Studio Server Explorer (see above) and then adjust hello Transfer Period in hello dialog for hello Diagnostics configuration settings:</span></span> 

![Konfiguration][3]

## <a name="performance"></a><span data-ttu-id="08b0e-301">Prestanda</span><span class="sxs-lookup"><span data-stu-id="08b0e-301">Performance</span></span>
<span data-ttu-id="08b0e-302">I allmänhet är bättre prestanda toobe förväntades från hello senare, mer performant tjänstnivåer i Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="08b0e-302">In general, better performance is toobe expected from hello higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="08b0e-303">Högre i/o-, processor- och minnesresurser tilldelningarna för hello högre tjänstnivåer dra hello masskopiering och delete-åtgärder som hello dela kopplingstjänsten använder.</span><span class="sxs-lookup"><span data-stu-id="08b0e-303">Higher IO, CPU and memory allocations for hello higher service tiers benefit hello bulk copy and delete operations that hello split-merge service uses.</span></span> <span data-ttu-id="08b0e-304">Av den anledningen bör öka hello tjänstnivån för dessa databaser för ett definierat begränsad tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="08b0e-304">For that reason, increase hello service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="08b0e-305">hello-tjänsten utför även validering frågor som en del av dess normal drift.</span><span class="sxs-lookup"><span data-stu-id="08b0e-305">hello service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="08b0e-306">Frågorna verifiering för oväntat förekomsten av data i intervallet för hello mål och kontrollerar att alla delade/merge/flyttningsåtgärd startar från ett konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="08b0e-306">These validation queries check for unexpected presence of data in hello target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="08b0e-307">De här frågorna alla arbeta via delning nyckelintervall definieras av hello omfattning hello åtgärden och hello batchstorlek tillhandahålls som en del av definitionen för hello förfrågningen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-307">These queries all work over sharding key ranges defined by hello scope of hello operation and hello batch size provided as part of hello request definition.</span></span> <span data-ttu-id="08b0e-308">De här frågorna gör bäst ifrån sig när ett index som har hello horisontell partitionering nyckeln som hello inledande kolumn.</span><span class="sxs-lookup"><span data-stu-id="08b0e-308">These queries perform best when an index is present that has hello sharding key as hello leading column.</span></span> 

<span data-ttu-id="08b0e-309">Dessutom tillåter en unikhet egenskap med hello horisontell partitionering nyckel som hello inledande kolumnen hello service toouse en optimerad metod som begränsar förbrukning av nätverksresurser vad gäller loggutrymme och minne.</span><span class="sxs-lookup"><span data-stu-id="08b0e-309">In addition, a uniqueness property with hello sharding key as hello leading column will allow hello service toouse an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="08b0e-310">Egenskapen unikhet är obligatoriska toomove stora datamängder (vanligtvis ovanför 1GB).</span><span class="sxs-lookup"><span data-stu-id="08b0e-310">This uniqueness property is required toomove large data sizes (typically above 1GB).</span></span> 

## <a name="how-tooupgrade"></a><span data-ttu-id="08b0e-311">Hur tooupgrade</span><span class="sxs-lookup"><span data-stu-id="08b0e-311">How tooupgrade</span></span>
1. <span data-ttu-id="08b0e-312">Gör så hello i [distribuera en delad kopplingstjänsten](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span><span class="sxs-lookup"><span data-stu-id="08b0e-312">Follow hello steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="08b0e-313">Ändra konfigurationsfilen cloud service för dina delade dokument distribution tooreflect hello nya konfigurationsparametrar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-313">Change your cloud service configuration file for your split-merge deployment tooreflect hello new configuration parameters.</span></span> <span data-ttu-id="08b0e-314">En ny obligatorisk parameter är hello information om hello-certifikat som används för kryptering.</span><span class="sxs-lookup"><span data-stu-id="08b0e-314">A new required parameter is hello information about hello certificate used for encryption.</span></span> <span data-ttu-id="08b0e-315">Ett enkelt sätt toodo detta är toocompare hello ny mall konfigurationsfil från hello hämta mot den befintliga konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-315">An easy way toodo this is toocompare hello new configuration template file from hello download against your existing configuration.</span></span> <span data-ttu-id="08b0e-316">Kontrollera att du lägger till hello inställningar för ”DataEncryptionPrimaryCertificateThumbprint” och ”DataEncryptionPrimary” för både hello webb- och hello worker-rollen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-316">Make sure you add hello settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both hello web and hello worker role.</span></span>
3. <span data-ttu-id="08b0e-317">Se till att alla som körs dela merge-åtgärder har slutförts innan du distribuerar hello uppdatering tooAzure.</span><span class="sxs-lookup"><span data-stu-id="08b0e-317">Before deploying hello update tooAzure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="08b0e-318">Du kan göra detta genom att fråga hello RequestStatus och PendingWorkflows tabeller i hello dela sammanslagna metadata-databasen för pågående begäranden.</span><span class="sxs-lookup"><span data-stu-id="08b0e-318">You can easily do this by querying hello RequestStatus and PendingWorkflows tables in hello split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="08b0e-319">Uppdatera den befintliga cloud service-distributionen för att dela dokument i Azure-prenumerationen med hello nya paketet och uppdaterade konfigurationsfilen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-319">Update your existing cloud service deployment for split-merge in your Azure subscription with hello new package and your updated service configuration file.</span></span>

<span data-ttu-id="08b0e-320">Du behöver inte tooprovision en ny databas för metadata för delade dokument tooupgrade.</span><span class="sxs-lookup"><span data-stu-id="08b0e-320">You do not need tooprovision a new metadata database for split-merge tooupgrade.</span></span> <span data-ttu-id="08b0e-321">hello nya versionen uppgraderas automatiskt din befintliga metadata toohello nya databasversionen.</span><span class="sxs-lookup"><span data-stu-id="08b0e-321">hello new version will automatically upgrade your existing metadata database toohello new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="08b0e-322">Bästa praxis och felsöka</span><span class="sxs-lookup"><span data-stu-id="08b0e-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="08b0e-323">Definiera en Testklient och utnyttja dina viktigaste move-dela/merge-åtgärder med hello testklienten över flera delar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-323">Define a test tenant and exercise your most important split/merge/move operations with hello test tenant across several shards.</span></span> <span data-ttu-id="08b0e-324">Se till att alla metadata har definierats korrekt i Fragmentera map och att hello operations inte strider mot villkor eller sekundärnycklar.</span><span class="sxs-lookup"><span data-stu-id="08b0e-324">Ensure that all metadata is defined correctly in your shard map and that hello operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="08b0e-325">Behåll hello test klient datastorleken ovan hello maximal storlek för din största klient tooensure datastorleken inte uppstår problem som rör.</span><span class="sxs-lookup"><span data-stu-id="08b0e-325">Keep hello test tenant data size above hello maximum data size of your largest tenant tooensure you are not encountering data size related issues.</span></span> <span data-ttu-id="08b0e-326">Detta hjälper dig att utvärdera en övre gräns på hello tid det tar toomove en enskild klient runt.</span><span class="sxs-lookup"><span data-stu-id="08b0e-326">This helps you assess an upper bound on hello time it takes toomove a single tenant around.</span></span> 
* <span data-ttu-id="08b0e-327">Kontrollera att schemat tillåter borttagning.</span><span class="sxs-lookup"><span data-stu-id="08b0e-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="08b0e-328">hello split-kopplingstjänsten kräver hello möjlighet tooremove data från hello källa Fragmentera när hello data har korrekt kopierade toohello mål.</span><span class="sxs-lookup"><span data-stu-id="08b0e-328">hello split-merge service requires hello ability tooremove data from hello source shard once hello data has been successfully copied toohello target.</span></span> <span data-ttu-id="08b0e-329">Till exempel **ta bort utlösare** kan förhindra hello tjänsten från att ta bort hello data på hello källan och kan orsaka operations toofail.</span><span class="sxs-lookup"><span data-stu-id="08b0e-329">For example, **delete triggers** can prevent hello service from deleting hello data on hello source and may cause operations toofail.</span></span>
* <span data-ttu-id="08b0e-330">hello horisontell partitionering nyckel måste vara hello inledande kolumn i din primär nyckel eller ett unikt Indexdefinition.</span><span class="sxs-lookup"><span data-stu-id="08b0e-330">hello sharding key should be hello leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="08b0e-331">Som säkerställer hello bästa prestanda för hello delade eller merge frågor för verifiering och för hello faktiska data movement och borttagning åtgärder som använder alltid nyckelintervall för horisontell partitionering.</span><span class="sxs-lookup"><span data-stu-id="08b0e-331">That ensures hello best performance for hello split or merge validation queries, and for hello actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="08b0e-332">Samordna split-kopplingstjänsten i hello region och datacenter där databaserna finns.</span><span class="sxs-lookup"><span data-stu-id="08b0e-332">Collocate your split-merge service in hello region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png

