---
title: "Flytta data mellan databaser som skalats ut molntjänster | Microsoft Docs"
description: "Beskriver hur du hanterar shards och flytta data via en automatisk värdbaserad tjänst som använder API: er för elastisk databas."
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: b41b6d6be686168359a97eb7468351a105b748db
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="1fc94-103">Flytta data mellan utskalade molndatabaser</span><span class="sxs-lookup"><span data-stu-id="1fc94-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="1fc94-104">Om du är en programvara som en tjänst-utvecklare och plötsligt enorm begäran görs i appen, måste du anpassa tillväxt.</span><span class="sxs-lookup"><span data-stu-id="1fc94-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need to accommodate the growth.</span></span> <span data-ttu-id="1fc94-105">Så får du lägga till flera databaser (shards).</span><span class="sxs-lookup"><span data-stu-id="1fc94-105">So you add more databases (shards).</span></span> <span data-ttu-id="1fc94-106">Hur du för att distribuera data till de nya databaserna utan att störa dataintegriteten?</span><span class="sxs-lookup"><span data-stu-id="1fc94-106">How do you redistribute the data to the new databases without disrupting the data integrity?</span></span> <span data-ttu-id="1fc94-107">Använd den **för delade sökvägssammanslagning** att flytta data från begränsad databaser till de nya databaserna.</span><span class="sxs-lookup"><span data-stu-id="1fc94-107">Use the **split-merge tool** to move data from constrained databases to the new databases.</span></span>  

<span data-ttu-id="1fc94-108">Verktyget delade dokument körs som en Azure-webbtjänst.</span><span class="sxs-lookup"><span data-stu-id="1fc94-108">The split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="1fc94-109">En administratör eller utvecklare använder du verktyget för att flytta shardlets (data från en Fragmentera) mellan olika databaser (shards).</span><span class="sxs-lookup"><span data-stu-id="1fc94-109">An administrator or developer uses the tool to move shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="1fc94-110">Verktyget använder Fragmentera kartan management för att upprätthålla tjänsten metadata-databasen och säkerställa konsekvent mappningar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-110">The tool uses shard map management to maintain the service metadata database, and ensure consistent mappings.</span></span>

![Översikt][1]

## <a name="download"></a><span data-ttu-id="1fc94-112">Ladda ned</span><span class="sxs-lookup"><span data-stu-id="1fc94-112">Download</span></span>
[<span data-ttu-id="1fc94-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="1fc94-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="1fc94-114">Dokumentation</span><span class="sxs-lookup"><span data-stu-id="1fc94-114">Documentation</span></span>
1. [<span data-ttu-id="1fc94-115">Elastisk dela Merge tool självstudie om databaser</span><span class="sxs-lookup"><span data-stu-id="1fc94-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="1fc94-116">Dela dokument säkerhetskonfiguration</span><span class="sxs-lookup"><span data-stu-id="1fc94-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="1fc94-117">Dela dokument säkerhetsaspekter</span><span class="sxs-lookup"><span data-stu-id="1fc94-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="1fc94-118">Karthantering för shard</span><span class="sxs-lookup"><span data-stu-id="1fc94-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="1fc94-119">Migrera befintliga databaser att skala ut</span><span class="sxs-lookup"><span data-stu-id="1fc94-119">Migrate existing databases to scale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="1fc94-120">Elastisk Databasverktyg</span><span class="sxs-lookup"><span data-stu-id="1fc94-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="1fc94-121">Ordlista för verktyg för elastisk databas</span><span class="sxs-lookup"><span data-stu-id="1fc94-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-the-split-merge-tool"></a><span data-ttu-id="1fc94-122">Varför använda verktyget delade dokument?</span><span class="sxs-lookup"><span data-stu-id="1fc94-122">Why use the split-merge tool?</span></span>
<span data-ttu-id="1fc94-123">**Flexibilitet**</span><span class="sxs-lookup"><span data-stu-id="1fc94-123">**Flexibility**</span></span>

<span data-ttu-id="1fc94-124">Program behöver stretch flexibelt överskrider gränserna för en enskild Azure SQL DB-databas.</span><span class="sxs-lookup"><span data-stu-id="1fc94-124">Applications need to stretch flexibly beyond the limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="1fc94-125">Använda verktyget för att flytta data som behövs för att nya databaser samtidigt integritet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-125">Use the tool to move data as needed to new databases while retaining integrity.</span></span>

<span data-ttu-id="1fc94-126">**Dela att växa**</span><span class="sxs-lookup"><span data-stu-id="1fc94-126">**Split to grow**</span></span> 

<span data-ttu-id="1fc94-127">Du måste öka totala kapaciteten att hantera enorm tillväxt.</span><span class="sxs-lookup"><span data-stu-id="1fc94-127">You need to increase overall capacity to handle explosive growth.</span></span> <span data-ttu-id="1fc94-128">Gör du genom att skapa ytterligare kapacitet genom delning data och distribuera den över inkrementellt flera databaser tills kapacitetsbehov är uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="1fc94-128">To do so, create additional capacity by sharding the data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="1fc94-129">Detta är ett typiskt exempel av funktionen 'dela'.</span><span class="sxs-lookup"><span data-stu-id="1fc94-129">This is a prime example of the ‘split’ feature.</span></span> 

<span data-ttu-id="1fc94-130">**Koppla till krympa**</span><span class="sxs-lookup"><span data-stu-id="1fc94-130">**Merge to shrink**</span></span>

<span data-ttu-id="1fc94-131">Kapacitet måste krympa på grund av ett företag när.</span><span class="sxs-lookup"><span data-stu-id="1fc94-131">Capacity needs shrink due to the seasonal nature of a business.</span></span> <span data-ttu-id="1fc94-132">Verktyget kan du skala till färre skalenheter när business långsammare.</span><span class="sxs-lookup"><span data-stu-id="1fc94-132">The tool lets you scale down to fewer scale units when business slows.</span></span> <span data-ttu-id="1fc94-133">Funktionen 'merge' i elastisk skalbarhet split-kopplingstjänsten beskriver det här kravet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-133">The ‘merge’ feature in the Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="1fc94-134">**Hantera anslutningar genom att flytta shardlets**</span><span class="sxs-lookup"><span data-stu-id="1fc94-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="1fc94-135">Med flera klienter per databas leda tilldelning av shardlets till shards till kapacitet flaskhalsar på vissa delar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-135">With multiple tenants per database, the allocation of shardlets to shards can lead to capacity bottlenecks on some shards.</span></span> <span data-ttu-id="1fc94-136">Detta kräver omfördelning shardlets eller flytta upptagen shardlets till nya eller mindre utnyttjade delar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-136">This requires re-allocating shardlets or moving busy shardlets to new or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="1fc94-137">Begrepp & viktiga funktioner</span><span class="sxs-lookup"><span data-stu-id="1fc94-137">Concepts & key features</span></span>
<span data-ttu-id="1fc94-138">**Kund-värdbaserade tjänster**</span><span class="sxs-lookup"><span data-stu-id="1fc94-138">**Customer-hosted services**</span></span>

<span data-ttu-id="1fc94-139">Dela sammanslagna levereras som en kund-värdbaserad tjänst.</span><span class="sxs-lookup"><span data-stu-id="1fc94-139">The split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="1fc94-140">Du måste distribuera och hantera tjänsten i din Microsoft Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="1fc94-140">You must deploy and host the service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="1fc94-141">Det paket som du hämtar från NuGet innehåller en konfigurationsmall för att slutföra med information för din distribution.</span><span class="sxs-lookup"><span data-stu-id="1fc94-141">The package you download from NuGet contains a configuration template to complete with the information for your specific deployment.</span></span> <span data-ttu-id="1fc94-142">Finns det [delade dokument kursen](sql-database-elastic-scale-configure-deploy-split-and-merge.md) mer information.</span><span class="sxs-lookup"><span data-stu-id="1fc94-142">See the [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="1fc94-143">Eftersom tjänsten körs i din Azure-prenumeration, kan du styra och konfigurera de flesta säkerhetsaspekter för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="1fc94-143">Since the service runs in your Azure subscription, you can control and configure most security aspects of the service.</span></span> <span data-ttu-id="1fc94-144">Standardmallen innehåller alternativ för att konfigurera SSL, certifikatbaserad klientautentisering, kryptering för lagrade autentiseringsuppgifter, DoS skyddar och IP-begränsningar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-144">The default template includes the options to configure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="1fc94-145">Du hittar mer information om säkerhetsaspekterna i följande dokument [delade dokument säkerhetskonfiguration](sql-database-elastic-scale-split-merge-security-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="1fc94-145">You can find more information on the security aspects in the following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="1fc94-146">Standard distribuerade tjänsten körs med en arbetare och en webbroll.</span><span class="sxs-lookup"><span data-stu-id="1fc94-146">The default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="1fc94-147">Var används den A1 VM-storleken i Azure Cloud Services.</span><span class="sxs-lookup"><span data-stu-id="1fc94-147">Each uses the A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="1fc94-148">Du inte kan ändra dessa inställningar när du distribuerar paketet, kan du ändra dem efter en lyckad distribution i körs Molntjänsten (via Azure portal).</span><span class="sxs-lookup"><span data-stu-id="1fc94-148">While you cannot modify these settings when deploying the package, you could change them after a successful deployment in the running cloud service, (through the Azure portal).</span></span> <span data-ttu-id="1fc94-149">Observera att arbetsrollen inte måste konfigureras för mer än en instans av tekniska skäl.</span><span class="sxs-lookup"><span data-stu-id="1fc94-149">Note that the worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="1fc94-150">**Fragmentera kartan integrering**</span><span class="sxs-lookup"><span data-stu-id="1fc94-150">**Shard map integration**</span></span>

<span data-ttu-id="1fc94-151">Dela kopplingstjänsten samverkar med Fragmentera mappningen av programmet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-151">The split-merge service interacts with the shard map of the application.</span></span> <span data-ttu-id="1fc94-152">När du använder dela kopplingstjänsten att dela eller sammanfoga intervall eller flytta shardlets mellan shards, håller tjänsten automatiskt Fragmentera kartan uppdaterade.</span><span class="sxs-lookup"><span data-stu-id="1fc94-152">When using the split-merge service to split or merge ranges or to move shardlets between shards, the service automatically keeps the shard map up to date.</span></span> <span data-ttu-id="1fc94-153">Gör du genom tjänsten ansluter till Fragmentera kartan manager-databas i programmet och underhåller intervall och mappningar som delade/merge/move-begäran pågår.</span><span class="sxs-lookup"><span data-stu-id="1fc94-153">To do so, the service connects to the shard map manager database of the application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="1fc94-154">Detta säkerställer att fragmentera kartan visas alltid aktuell när ska dela dokument.</span><span class="sxs-lookup"><span data-stu-id="1fc94-154">This ensures that the shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="1fc94-155">Dela, implementeras dokument och shardlet förflyttning genom att flytta en batch med shardlets från Fragmentera för källan till målet Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from the source shard to the target shard.</span></span> <span data-ttu-id="1fc94-156">Under åtgärden shardlet flytt shardlets omfattas aktuell batch är markerad som offline i kartan Fragmentera och är inte tillgängliga för data-beroende anslutningar med hjälp av den **OpenConnectionForKey** API.</span><span class="sxs-lookup"><span data-stu-id="1fc94-156">During the shardlet movement operation the shardlets subject to the current batch are marked as offline in the shard map and are unavailable for data-dependent routing connections using the **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="1fc94-157">**Konsekvent shardlet anslutningar**</span><span class="sxs-lookup"><span data-stu-id="1fc94-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="1fc94-158">Dataflyttning att starta en ny grupp med shardlets, alla angivna Fragmentera mappning data beroende routning anslutningar till Fragmentera lagra shardlet är avlivade och efterföljande anslutningar från Fragmentera kartan API: er till dessa shardlets blockeras när data flytt pågår för att undvika inkonsekvenser.</span><span class="sxs-lookup"><span data-stu-id="1fc94-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections to the shard storing the shardlet are killed and subsequent connections from the shard map APIs to the these shardlets are blocked while the data movement is in progress in order to avoid inconsistencies.</span></span> <span data-ttu-id="1fc94-159">Anslutningar till andra shardlets på samma Fragmentera också hämta avslutats, men kommer att lyckas igen omedelbart på försök igen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-159">Connections to other shardlets on the same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="1fc94-160">När gruppen flyttas shardlets markeras online igen för mål-Fragmentera och datakällan tas bort från källan Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-160">Once the batch is moved, the shardlets are marked online again for the target shard and the source data is removed from the source shard.</span></span> <span data-ttu-id="1fc94-161">Tjänsten går igenom de här stegen för varje batch tills alla shardlets har flyttats.</span><span class="sxs-lookup"><span data-stu-id="1fc94-161">The service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="1fc94-162">Detta leder till flera anslutningsåtgärder kill under slutföra move-dela/merge-åtgärden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-162">This will lead to several connection kill operations during the course of the complete split/merge/move operation.</span></span>  

<span data-ttu-id="1fc94-163">**Hantera shardlet tillgänglighet**</span><span class="sxs-lookup"><span data-stu-id="1fc94-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="1fc94-164">Begränsa anslutningen om du avbryter den aktuella gruppen med shardlets som beskrivs ovan begränsar omfånget för tillfället till en batch med shardlets i taget.</span><span class="sxs-lookup"><span data-stu-id="1fc94-164">Limiting the connection killing to the current batch of shardlets as discussed above restricts the scope of unavailability to one batch of shardlets at a time.</span></span> <span data-ttu-id="1fc94-165">Detta är att föredra över en metod där fullständig Fragmentera är offline för alla shardlets under loppet av en delad eller merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="1fc94-165">This is preferred over an approach where the complete shard would remain offline for all its shardlets during the course of a split or merge operation.</span></span> <span data-ttu-id="1fc94-166">Storleken på en grupp definieras som antalet distinkta shardlets att flytta samtidigt, är en konfigurationsparameter.</span><span class="sxs-lookup"><span data-stu-id="1fc94-166">The size of a batch, defined as the number of distinct shardlets to move at a time, is a configuration parameter.</span></span> <span data-ttu-id="1fc94-167">Det kan definieras för varje dela och slå samman åtgärd beroende på programmets tillgänglighet och prestanda behov.</span><span class="sxs-lookup"><span data-stu-id="1fc94-167">It can be defined for each split and merge operation depending on the application’s availability and performance needs.</span></span> <span data-ttu-id="1fc94-168">Observera att det intervall som håller på att låsas i kartan Fragmentera kan vara större än batchstorlek som har angetts.</span><span class="sxs-lookup"><span data-stu-id="1fc94-168">Note that the range that is being locked in the shard map may be larger than the batch size specified.</span></span> <span data-ttu-id="1fc94-169">Det beror på att tjänsten hämtar intervallet storlek så att det faktiska antalet horisontell partitionering nyckelvärdena i data matchar cirka batchstorleken.</span><span class="sxs-lookup"><span data-stu-id="1fc94-169">This is because the service picks the range size such that the actual number of sharding key values in the data approximately matches the batch size.</span></span> <span data-ttu-id="1fc94-170">Det här är viktigt att komma ihåg särskilt för glesbefolkade horisontell partitionering nycklar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-170">This is important to remember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="1fc94-171">**Utrymmet för metadata**</span><span class="sxs-lookup"><span data-stu-id="1fc94-171">**Metadata storage**</span></span>

<span data-ttu-id="1fc94-172">Dela kopplingstjänsten använder en databas om du vill bevara statusen och hålla loggar under bearbetning av begäran.</span><span class="sxs-lookup"><span data-stu-id="1fc94-172">The split-merge service uses a database to maintain its status and to keep logs during request processing.</span></span> <span data-ttu-id="1fc94-173">Användaren i prenumerationen skapas denna databas och innehåller anslutningssträngen för den i konfigurationsfilen för tjänstdistributionen av.</span><span class="sxs-lookup"><span data-stu-id="1fc94-173">The user creates this database in their subscription and provides the connection string for it in the configuration file for the service deployment.</span></span> <span data-ttu-id="1fc94-174">Administratörer från användarens organisation kan också ansluta till databasen att granska begäran förlopp och undersöka detaljerad information om potentiella problem.</span><span class="sxs-lookup"><span data-stu-id="1fc94-174">Administrators from the user’s organization can also connect to this database to review request progress and to investigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="1fc94-175">**Horisontell partitionering medvetenhet**</span><span class="sxs-lookup"><span data-stu-id="1fc94-175">**Sharding-awareness**</span></span>

<span data-ttu-id="1fc94-176">Dela kopplingstjänsten skiljer mellan (1) delat tabeller och (2) referenstabellerna (3) normal tabeller.</span><span class="sxs-lookup"><span data-stu-id="1fc94-176">The split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="1fc94-177">Semantiken för en move-dela/merge-åtgärd beror på vilken typ av tabellen som används och definieras enligt följande:</span><span class="sxs-lookup"><span data-stu-id="1fc94-177">The semantics of a split/merge/move operation depend on the type of the table used and are defined as follows:</span></span> 

* <span data-ttu-id="1fc94-178">**Delat tabeller**: dela dokument och flytta flytta shardlets från källan till målet Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-178">**Sharded tables**: Split, merge, and move operations move shardlets from source to target shard.</span></span> <span data-ttu-id="1fc94-179">Efter slutförande av övergripande begäran dessa shardlets inte längre finns på källan.</span><span class="sxs-lookup"><span data-stu-id="1fc94-179">After successful completion of the overall request, those shardlets are no longer present on the source.</span></span> <span data-ttu-id="1fc94-180">Observera att måltabeller måste finnas på mål-Fragmentera och får inte innehålla data i målområdet innan bearbetningen av åtgärden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-180">Note that the target tables need to exist on the target shard and must not contain data in the target range prior to processing of the operation.</span></span> 
* <span data-ttu-id="1fc94-181">**Refererar till tabeller**: för register, dela, slå samman och flytta operations kopiera data från källan till målet Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-181">**Reference tables**: For reference tables, the split, merge and move operations copy the data from the source to the target shard.</span></span> <span data-ttu-id="1fc94-182">Observera att inga ändringar inträffar på mål-Fragmentera för en viss tabell om det finns redan en rad i tabellen på målet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-182">Note, however, that no changes occur on the target shard for a given table if any row is already present in this table on the target.</span></span> <span data-ttu-id="1fc94-183">Tabellen måste vara tom för någon referens tabell kopieringsåtgärd bearbetas.</span><span class="sxs-lookup"><span data-stu-id="1fc94-183">The table has to be empty for any reference table copy operation to get processed.</span></span>
* <span data-ttu-id="1fc94-184">**Andra tabeller**: andra tabeller kan finnas på källan eller målet för en delning och merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="1fc94-184">**Other Tables**: Other tables can be present on either the source or the target of a split and merge operation.</span></span> <span data-ttu-id="1fc94-185">Dela kopplingstjänsten ignorerar dessa tabeller för dataflyttning eller kopiering.</span><span class="sxs-lookup"><span data-stu-id="1fc94-185">The split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="1fc94-186">Observera att de stör dessa åtgärder vid begränsningar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="1fc94-187">Information om referens kontra delat tabeller tillhandahålls av den **SchemaInfo** API: er på kartan Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-187">The information on reference vs. sharded tables is provided by the **SchemaInfo** APIs on the shard map.</span></span> <span data-ttu-id="1fc94-188">I följande exempel visar hur dessa API: n på en viss Fragmentera kartan manager objektet smm:</span><span class="sxs-lookup"><span data-stu-id="1fc94-188">The following example illustrates the use of these APIs on a given shard map manager object smm:</span></span> 

    // Create the schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="1fc94-189">Tabeller 'region' och 'landet' har definierats som referenstabellerna och kommer att kopieras med move-dela/merge-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fc94-189">The tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="1fc94-190">”kund” och 'order' definieras i sin tur som delat tabeller.</span><span class="sxs-lookup"><span data-stu-id="1fc94-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="1fc94-191">C_CUSTKEY och O_CUSTKEY fungera som en nyckel för horisontell partitionering.</span><span class="sxs-lookup"><span data-stu-id="1fc94-191">C_CUSTKEY and O_CUSTKEY serve as the sharding key.</span></span> 

<span data-ttu-id="1fc94-192">**Referensintegritet**</span><span class="sxs-lookup"><span data-stu-id="1fc94-192">**Referential Integrity**</span></span>

<span data-ttu-id="1fc94-193">Dela kopplingstjänsten analyserar alla beroenden mellan tabellerna och använder primära nyckel sekundärnyckelrelationer för att mellanlagra åtgärderna för att flytta referenstabellerna och shardlets.</span><span class="sxs-lookup"><span data-stu-id="1fc94-193">The split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships to stage the operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="1fc94-194">I allmänhet kopieras referenstabellerna först i beroendeordningen, och sedan shardlets kopieras i den ordning de beroenden inom varje grupp.</span><span class="sxs-lookup"><span data-stu-id="1fc94-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="1fc94-195">Detta är nödvändigt så att gäller FK PK begränsningar på mål-Fragmentera som nya data tas emot.</span><span class="sxs-lookup"><span data-stu-id="1fc94-195">This is necessary so that FK-PK constraints on the target shard are honored as the new data arrives.</span></span> 

<span data-ttu-id="1fc94-196">**Fragmentera kartan konsekvens och eventuell slutförande**</span><span class="sxs-lookup"><span data-stu-id="1fc94-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="1fc94-197">Med fel, dela kopplingstjänsten återupptar åtgärder efter eventuella avbrott och syftet är att slutföra i förloppet begäranden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-197">In the presence of failures, the split-merge service resumes operations after any outage and aims to complete any in progress requests.</span></span> <span data-ttu-id="1fc94-198">Det kan dock finnas oåterkalleligt situationer, t.ex. när mål Fragmentera tappas bort eller komprometteras inte repareras.</span><span class="sxs-lookup"><span data-stu-id="1fc94-198">However, there may be unrecoverable situations, e.g., when the target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="1fc94-199">Under dessa omständigheter kan vissa shardlets som skulle flyttas fortsätta att finnas på käll-Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-199">Under those circumstances, some shardlets that were supposed to be moved may continue to reside on the source shard.</span></span> <span data-ttu-id="1fc94-200">Tjänsten garanterar att shardlet mappningar uppdateras bara när uppgifter som krävs har kopierats till målet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-200">The service ensures that shardlet mappings are only updated after the necessary data has been successfully copied to the target.</span></span> <span data-ttu-id="1fc94-201">Shardlets bara ta bort på källan när alla data har kopierats till målet och motsvarande mappningar har uppdaterats.</span><span class="sxs-lookup"><span data-stu-id="1fc94-201">Shardlets are only deleted on the source once all their data has been copied to the target and the corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="1fc94-202">Borttagningen sker i bakgrunden medan intervallet är redan online på mål-Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-202">The deletion operation happens in the background while the range is already online on the target shard.</span></span> <span data-ttu-id="1fc94-203">Dela kopplingstjänsten garanterar alltid mappningar som lagras i Fragmentera mappningen är korrekt.</span><span class="sxs-lookup"><span data-stu-id="1fc94-203">The split-merge service always ensures correctness of the mappings stored in the shard map.</span></span>

## <a name="the-split-merge-user-interface"></a><span data-ttu-id="1fc94-204">Dela dokument användargränssnittet</span><span class="sxs-lookup"><span data-stu-id="1fc94-204">The split-merge user interface</span></span>
<span data-ttu-id="1fc94-205">Dela kopplingstjänsten paketet innehåller en arbetsroll och en webbroll.</span><span class="sxs-lookup"><span data-stu-id="1fc94-205">The split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="1fc94-206">Webbrollen används för att skicka förfrågningar om delade dokument på ett interaktivt sätt.</span><span class="sxs-lookup"><span data-stu-id="1fc94-206">The web role is used to submit split-merge requests in an interactive way.</span></span> <span data-ttu-id="1fc94-207">Huvudkomponenterna i användargränssnittet är följande:</span><span class="sxs-lookup"><span data-stu-id="1fc94-207">The main components of the user interface are as follows:</span></span>

* <span data-ttu-id="1fc94-208">Åtgärdstyp: Typ av åtgärd är en alternativknapp som styr typ av åtgärd som utförs av tjänsten för denna begäran.</span><span class="sxs-lookup"><span data-stu-id="1fc94-208">Operation Type: The operation type is a radio button that controls the kind of operation performed by the service for this request.</span></span> <span data-ttu-id="1fc94-209">Du kan välja mellan delning, slå samman och flytta scenarier.</span><span class="sxs-lookup"><span data-stu-id="1fc94-209">You can choose between the split, merge and move scenarios.</span></span> <span data-ttu-id="1fc94-210">Du kan också avbryta en tidigare skickade.</span><span class="sxs-lookup"><span data-stu-id="1fc94-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="1fc94-211">Du kan använda delade, slå samman och flytta begäranden för intervallet Fragmentera maps.</span><span class="sxs-lookup"><span data-stu-id="1fc94-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="1fc94-212">Lista Fragmentera mappar endast stöd för move-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fc94-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="1fc94-213">Fragmentera mappa: Nästa avsnitt av parametrar för begäran omfatta information om Fragmentera kartan och databasen som värd för kartan Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-213">Shard Map: The next section of request parameters cover information about the shard map and the database hosting your shard map.</span></span> <span data-ttu-id="1fc94-214">I synnerhet måste du ange namnet på Azure SQL Database-servern och databasen som värd för shardmap autentiseringsuppgifter för anslutning till Fragmentera kartan databasen och slutligen namnet på kartan Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-214">In particular, you need to provide the name of the Azure SQL Database server and database hosting the shardmap, credentials to connect to the shard map database, and finally the name of the shard map.</span></span> <span data-ttu-id="1fc94-215">För närvarande accepterar åtgärden bara en enda uppsättning autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="1fc94-215">Currently, the operation only accepts a single set of credentials.</span></span> <span data-ttu-id="1fc94-216">Dessa autentiseringsuppgifter måste ha behörighet att utföra ändringar på Fragmentera kartan samt att användardata på shards.</span><span class="sxs-lookup"><span data-stu-id="1fc94-216">These credentials need to have sufficient permissions to perform changes to the shard map as well as to the user data on the shards.</span></span>
* <span data-ttu-id="1fc94-217">Käll-adressintervall (dela och sammanfoga): en åtgärd för dela och slå samman bearbetar ett intervall med den lägsta och högsta nyckeln.</span><span class="sxs-lookup"><span data-stu-id="1fc94-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="1fc94-218">Om du vill ange en åtgärd med ett unbounded hög nyckelvärde, markera kryssrutan ”övre nyckel är max” och lämnar hög nyckelfältet tom.</span><span class="sxs-lookup"><span data-stu-id="1fc94-218">To specify an operation with an unbounded high key value, check the “High key is max” check box and leave the high key field empty.</span></span> <span data-ttu-id="1fc94-219">Intervallet nyckelvärden som du anger behöver inte matcha exakt en mappning och dess gränser i kartan Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-219">The range key values that you specify do not need to precisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="1fc94-220">Om du inte anger någon adressintervallsgränser alls kommer tjänsten härleda närmaste intervallet du automatiskt.</span><span class="sxs-lookup"><span data-stu-id="1fc94-220">If you do not specify any range boundaries at all the service will infer the closest range for you automatically.</span></span> <span data-ttu-id="1fc94-221">Du kan använda GetMappings.ps1 PowerShell-skript för att hämta aktuella mappningarna i en given Fragmentera karta.</span><span class="sxs-lookup"><span data-stu-id="1fc94-221">You can use the GetMappings.ps1 PowerShell script to retrieve the current mappings in a given shard map.</span></span>
* <span data-ttu-id="1fc94-222">Dela källa beteende (delning): definiera platsen om du vill dela käll-adressintervall för dela-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fc94-222">Split Source Behavior (split): For split operations, define the point to split the source range.</span></span> <span data-ttu-id="1fc94-223">Det gör du genom att tillhandahålla nyckeln horisontell partitionering där du vill dela ska ske.</span><span class="sxs-lookup"><span data-stu-id="1fc94-223">You do this by providing the sharding key where you want the split to occur.</span></span> <span data-ttu-id="1fc94-224">Använd knappen Ange om du vill den nedre delen av intervallet (exklusive nyckeln delning) för att flytta eller om du vill att den övre delen att flytta (inklusive den delade nyckeln).</span><span class="sxs-lookup"><span data-stu-id="1fc94-224">Use the radio button specify whether you want the lower part of the range (excluding the split key) to move, or whether you want the upper part to move (including the split key).</span></span>
* <span data-ttu-id="1fc94-225">Datakällan Shardlet (flytta): flytta operations skiljer sig från delade eller merge-åtgärder eftersom de inte kräver ett intervall för att beskriva källan.</span><span class="sxs-lookup"><span data-stu-id="1fc94-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range to describe the source.</span></span> <span data-ttu-id="1fc94-226">En källa för flytta identifieras bara av horisontell partitionering värdet för nyckeln som du planerar att flytta.</span><span class="sxs-lookup"><span data-stu-id="1fc94-226">A source for move is simply identified by the sharding key value that you plan to move.</span></span>
* <span data-ttu-id="1fc94-227">Rikta Fragmentera (delning): när du har angett informationen på källan för split-åtgärden, måste du definiera där du vill att data ska kopieras till med Azure SQL Db-server och databas-namn för målet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-227">Target Shard (split): Once you have provided the information on the source of your split operation, you need to define where you want the data to be copied to by providing the Azure SQL Db server and database name for the target.</span></span>
* <span data-ttu-id="1fc94-228">Målområdet (merge): Merge-operationer flytta shardlets till en befintlig Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-228">Target Range (merge): Merge operations move shardlets to an existing shard.</span></span> <span data-ttu-id="1fc94-229">Du kan identifiera befintliga Fragmentera genom att tillhandahålla adressintervallsgränser i befintliga intervallet som du vill koppla med.</span><span class="sxs-lookup"><span data-stu-id="1fc94-229">You identify the existing shard by providing the range boundaries of the existing range that you want to merge with.</span></span>
* <span data-ttu-id="1fc94-230">Batchstorleken: Batchstorleken reglerar antalet shardlets som ska försättas i offlineläge vid en tidpunkt under dataflytten.</span><span class="sxs-lookup"><span data-stu-id="1fc94-230">Batch Size: The batch size controls the number of shardlets that will go offline at a time during the data movement.</span></span> <span data-ttu-id="1fc94-231">Detta är ett heltalsvärde där du kan använda mindre värden när du är känsligt för långa stilleståndsperioder för shardlets.</span><span class="sxs-lookup"><span data-stu-id="1fc94-231">This is an integer value where you can use smaller values when you are sensitive to long periods of downtime for shardlets.</span></span> <span data-ttu-id="1fc94-232">Högre värden ökar den tid som en given shardlet är offline men kan förbättra prestanda.</span><span class="sxs-lookup"><span data-stu-id="1fc94-232">Larger values will increase the time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="1fc94-233">Åtgärds-Id (Avbryt): Om du har en pågående åtgärd som inte längre behövs, du kan avbryta åtgärden genom att ange dess åtgärds-ID i det här fältet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel the operation by providing its operation ID in this field.</span></span> <span data-ttu-id="1fc94-234">Du kan hämta åtgärds-ID från tabellen begäran status (se avsnittet 8.1) eller från utdata i webbläsaren där du skickade begäran.</span><span class="sxs-lookup"><span data-stu-id="1fc94-234">You can retrieve the operation ID from the request status table (see Section 8.1) or from the output in the web browser where you submitted the request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="1fc94-235">Krav och begränsningar</span><span class="sxs-lookup"><span data-stu-id="1fc94-235">Requirements and Limitations</span></span>
<span data-ttu-id="1fc94-236">Den aktuella implementationen av delade kopplingstjänsten regleras följande krav och begränsningar:</span><span class="sxs-lookup"><span data-stu-id="1fc94-236">The current implementation of the split-merge service is subject to the following requirements and limitations:</span></span> 

* <span data-ttu-id="1fc94-237">Shards måste finnas och vara registrerade i kartan Fragmentera innan en delad merge-åtgärd på dessa delar kan utföras.</span><span class="sxs-lookup"><span data-stu-id="1fc94-237">The shards need to exist and be registered in the shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="1fc94-238">Tjänsten kan inte skapa tabeller eller andra databasobjekt automatiskt som en del av dessa åtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fc94-238">The service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="1fc94-239">Det innebär att schemat för alla delat tabeller och referenstabeller måste finnas på mål-Fragmentera innan någon move-dela/merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="1fc94-239">This means that the schema for all sharded tables and reference tables need to exist on the target shard prior to any split/merge/move operation.</span></span> <span data-ttu-id="1fc94-240">Delat tabeller måste i synnerhet vara tom i området där nya shardlets ska läggas till av en move-dela/merge-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="1fc94-240">Sharded tables in particular are required to be empty in the range where new shardlets are to be added by a split/merge/move operation.</span></span> <span data-ttu-id="1fc94-241">Annars misslyckas åtgärden första konsekvenskontrollen för mål-Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-241">Otherwise, the operation will fail the initial consistency check on the target shard.</span></span> <span data-ttu-id="1fc94-242">Observera också att referensen kopieras bara data om referensen tabellen är tom och att det inte finns några konsekvenskontroll garantier avseende andra samtidiga skrivåtgärder på referens-tabeller.</span><span class="sxs-lookup"><span data-stu-id="1fc94-242">Also note that reference data is only copied if the reference table is empty and that there are no consistency guarantees with regard to other concurrent write operations on the reference tables.</span></span> <span data-ttu-id="1fc94-243">Vi rekommenderar detta: när du kör dela/merge-operationer kan inga andra skrivåtgärder göra ändringar i referenstabellerna.</span><span class="sxs-lookup"><span data-stu-id="1fc94-243">We recommend this: when running split/merge operations, no other write operations make changes to the reference tables.</span></span>
* <span data-ttu-id="1fc94-244">Tjänsten är beroende av raden identitet upprättas genom ett unikt index eller en nyckel som innehåller delning nyckel för att förbättra prestanda och tillförlitlighet för stora shardlets.</span><span class="sxs-lookup"><span data-stu-id="1fc94-244">The service relies on row identity established by a unique index or key that includes the sharding key to improve performance and reliability for large shardlets.</span></span> <span data-ttu-id="1fc94-245">Detta gör tjänsten för att flytta data på ett även ökad detaljnivå än bara nyckelvärdet horisontell partitionering.</span><span class="sxs-lookup"><span data-stu-id="1fc94-245">This allows the service to move data at an even finer granularity than just the sharding key value.</span></span> <span data-ttu-id="1fc94-246">Detta hjälper till att minska maximal mängd loggutrymme och lås som krävs under åtgärden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-246">This helps to reduce the maximum amount of log space and locks that are required during the operation.</span></span> <span data-ttu-id="1fc94-247">Överväg att skapa ett unikt index eller primärnyckel inklusive delning nyckeln för en given tabell om du vill använda tabellen med delade/merge/move-begäranden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-247">Consider creating a unique index or a primary key including the sharding key on a given table if you want to use that table with split/merge/move requests.</span></span> <span data-ttu-id="1fc94-248">Av prestandaskäl ska nyckeln för horisontell partitionering inledande kolumn i nyckeln eller index.</span><span class="sxs-lookup"><span data-stu-id="1fc94-248">For performance reasons, the sharding key should be the leading column in the key or the index.</span></span>
* <span data-ttu-id="1fc94-249">Under bearbetning av begäranden kanske vissa shardlet data finns både på käll- och mål-Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-249">During the course of request processing, some shardlet data may be present both on the source and the target shard.</span></span> <span data-ttu-id="1fc94-250">Detta är nödvändigt för att skydda mot fel under transport av shardlet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-250">This is necessary to protect against failures during the shardlet movement.</span></span> <span data-ttu-id="1fc94-251">Integrering av dela dokument med Fragmentera kartan säkerställer att anslutningar via data beroende routning API: er med hjälp av **OpenConnectionForKey** metod på kartan Fragmentera inte ser alla mellanliggande inkonsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="1fc94-251">The integration of split-merge with the shard map ensures that connections through the data dependent routing APIs using the **OpenConnectionForKey** method on the shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="1fc94-252">Men när du ansluter till källan eller målet shards utan att använda den **OpenConnectionForKey** metoden inkonsekvent mellanliggande tillstånd kanske visas när du ska dela/merge/move-begäranden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-252">However, when connecting to the source or the target shards without using the **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="1fc94-253">Dessa anslutningar kan visa helt eller delvis dubbla resultat beroende på tidpunkten eller Fragmentera underliggande anslutningen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-253">These connections may show partial or duplicate results depending on the timing or the shard underlying the connection.</span></span> <span data-ttu-id="1fc94-254">Den här begränsningen innehåller för närvarande anslutningar som görs av elastisk skalbarhet flera-Shard-frågor.</span><span class="sxs-lookup"><span data-stu-id="1fc94-254">This limitation currently includes the connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="1fc94-255">Metadata-databasen för den delade kopplingstjänsten måste inte delas mellan olika roller.</span><span class="sxs-lookup"><span data-stu-id="1fc94-255">The metadata database for the split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="1fc94-256">Till exempel måste en roll för den delade dokument-tjänst som körs i Förproduktion peka på en annan metadata-databasen än rollen produktion.</span><span class="sxs-lookup"><span data-stu-id="1fc94-256">For example, a role of the split-merge service running in staging needs to point to a different metadata database than the production role.</span></span>

## <a name="billing"></a><span data-ttu-id="1fc94-257">Fakturering</span><span class="sxs-lookup"><span data-stu-id="1fc94-257">Billing</span></span>
<span data-ttu-id="1fc94-258">Dela merge-tjänsten körs som en tjänst i molnet i Microsoft Azure-prenumerationen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-258">The split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="1fc94-259">Därför gäller avgifterna för molntjänster för din instans av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="1fc94-259">Therefore charges for cloud services apply to your instance of the service.</span></span> <span data-ttu-id="1fc94-260">Om du ofta utför move-dela/merge-åtgärder rekommenderar vi att du tar bort dina delade dokument Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="1fc94-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="1fc94-261">Som kostnaderna för att köra eller distribueras molnet tjänstinstanser.</span><span class="sxs-lookup"><span data-stu-id="1fc94-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="1fc94-262">Du kan distribuera och starta lätt körbara konfigurationen när du behöver utföra delade eller merge-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fc94-262">You can re-deploy and start your readily runnable configuration whenever you need to perform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="1fc94-263">Övervakning</span><span class="sxs-lookup"><span data-stu-id="1fc94-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="1fc94-264">Status för tabeller</span><span class="sxs-lookup"><span data-stu-id="1fc94-264">Status tables</span></span>
<span data-ttu-id="1fc94-265">Dela kopplingstjänsten ger den **RequestStatus** tabellen i metadata-databasen för lagring för övervakning av slutfördes och en pågående begäranden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-265">The split-merge Service provides the **RequestStatus** table in the metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="1fc94-266">Tabellen innehåller en rad för varje delad kopplingsbegäran som har skickats till den här instansen av delade kopplingstjänsten.</span><span class="sxs-lookup"><span data-stu-id="1fc94-266">The table lists a row for each split-merge request that has been submitted to this instance of the split-merge service.</span></span> <span data-ttu-id="1fc94-267">Den ger följande information för varje begäran:</span><span class="sxs-lookup"><span data-stu-id="1fc94-267">It gives the following information for each request:</span></span>

* <span data-ttu-id="1fc94-268">**Tidsstämpel**: tid och datum då begäran startades.</span><span class="sxs-lookup"><span data-stu-id="1fc94-268">**Timestamp**: The time and date when the request was started.</span></span>
* <span data-ttu-id="1fc94-269">**Åtgärds-ID**: ett GUID som identifierar begäran.</span><span class="sxs-lookup"><span data-stu-id="1fc94-269">**OperationId**: A GUID that uniquely identifies the request.</span></span> <span data-ttu-id="1fc94-270">Denna begäran kan också användas för att avbryta åtgärden när den är fortfarande pågår.</span><span class="sxs-lookup"><span data-stu-id="1fc94-270">This request can also be used to cancel the operation while it is still ongoing.</span></span>
* <span data-ttu-id="1fc94-271">**Status för**: aktuell status för begäran.</span><span class="sxs-lookup"><span data-stu-id="1fc94-271">**Status**: The current state of the request.</span></span> <span data-ttu-id="1fc94-272">För pågående begäranden visas också aktuell fas där begäran är.</span><span class="sxs-lookup"><span data-stu-id="1fc94-272">For ongoing requests, it also lists the current phase in which the request is.</span></span>
* <span data-ttu-id="1fc94-273">**CancelRequest**: en flagga som anger om begäran har avbrutits.</span><span class="sxs-lookup"><span data-stu-id="1fc94-273">**CancelRequest**: A flag that indicates whether the request has been cancelled.</span></span>
* <span data-ttu-id="1fc94-274">**Förlopp**: en del uppskattning av åtgärden har slutförts.</span><span class="sxs-lookup"><span data-stu-id="1fc94-274">**Progress**: A percentage estimate of completion for the operation.</span></span> <span data-ttu-id="1fc94-275">Ett värde på 50 anger att åtgärden är klar ungefär 50%.</span><span class="sxs-lookup"><span data-stu-id="1fc94-275">A value of 50 indicates that the operation is approximately 50% complete.</span></span>
* <span data-ttu-id="1fc94-276">**Information om**: en XML-värde som innehåller en mer detaljerad rapport.</span><span class="sxs-lookup"><span data-stu-id="1fc94-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="1fc94-277">Rapporten status uppdateras regelbundet som anger rader kopieras från källan till målet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-277">The progress report is periodically updated as sets of rows are copied from source to target.</span></span> <span data-ttu-id="1fc94-278">I den här kolumnen vid fel eller undantag innehåller också mer detaljerad information om felet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-278">In case of failures or exceptions, this column also includes more detailed information about the failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="1fc94-279">Azure Diagnostics</span><span class="sxs-lookup"><span data-stu-id="1fc94-279">Azure Diagnostics</span></span>
<span data-ttu-id="1fc94-280">Dela kopplingstjänsten använder Azure-diagnostik baserat på Azure SDK 2.5 för övervakning och diagnostik.</span><span class="sxs-lookup"><span data-stu-id="1fc94-280">The split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="1fc94-281">Du kan styra diagnostik konfigurationen som beskrivs här: [aktiverar diagnostik i Azure-molntjänster och virtuella datorer](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="1fc94-281">You control the diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="1fc94-282">Det nedladdade paketet innehåller två diagnostik konfigurationer - en för webbrollen och en för arbetsrollen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-282">The download package includes two diagnostics configurations - one for the web role and one for the worker role.</span></span> <span data-ttu-id="1fc94-283">Konfigurationerna diagnostik för tjänsten följer du anvisningarna från [Cloud Service grunderna i Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span><span class="sxs-lookup"><span data-stu-id="1fc94-283">These diagnostics configurations for the service follow the guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="1fc94-284">Den innehåller definitioner för att logga prestandaräknare, IIS loggar, Windows-händelseloggar och dela dokument, program-händelseloggar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-284">It includes the definitions to log Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="1fc94-285">Distribuera diagnostik</span><span class="sxs-lookup"><span data-stu-id="1fc94-285">Deploy Diagnostics</span></span>
<span data-ttu-id="1fc94-286">Kör följande kommandon med hjälp av Azure PowerShell om du vill aktivera övervakning och diagnostik med diagnostisk konfiguration för webb- och arbetsroller roller som tillhandahålls av NuGet-paketet:</span><span class="sxs-lookup"><span data-stu-id="1fc94-286">To enable monitoring and diagnostics using the diagnostic configuration for the web and worker roles provided by the NuGet package, run the following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="1fc94-287">Du hittar mer information om hur du konfigurerar och distribuerar här diagnostikinställningar: [aktiverar diagnostik i Azure-molntjänster och virtuella datorer](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="1fc94-287">You can find more information on how to configure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="1fc94-288">Hämta diagnostik</span><span class="sxs-lookup"><span data-stu-id="1fc94-288">Retrieve diagnostics</span></span>
<span data-ttu-id="1fc94-289">Du kan enkelt komma åt din diagnostik från Visual Studio Server Explorer i Azure del i Server Explorer-trädet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-289">You can easily access your diagnostics from the Visual Studio Server Explorer in the Azure part of the Server Explorer tree.</span></span> <span data-ttu-id="1fc94-290">Öppna en Visual Studio-instans och i menyraden klickar du på Visa och Server Explorer.</span><span class="sxs-lookup"><span data-stu-id="1fc94-290">Open a Visual Studio instance, and in the menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="1fc94-291">Klicka på ikonen Azure för att ansluta till din Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="1fc94-291">Click the Azure icon to connect to your Azure subscription.</span></span> <span data-ttu-id="1fc94-292">Gå till Azure Storage -> -> <your storage account> -> tabeller -> WADLogsTable.</span><span class="sxs-lookup"><span data-stu-id="1fc94-292">Then navigate to Azure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="1fc94-293">Mer information finns i [surfning lagringsresurser med Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span><span class="sxs-lookup"><span data-stu-id="1fc94-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="1fc94-295">WADLogsTable markerade i figuren ovan innehåller detaljerade händelser från tjänsten delade dokument programloggen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-295">The WADLogsTable highlighted in the figure above contains the detailed events from the split-merge service’s application log.</span></span> <span data-ttu-id="1fc94-296">Observera att standardkonfigurationen av det Hämta paketet riktar sig till en Produktionsdistribution.</span><span class="sxs-lookup"><span data-stu-id="1fc94-296">Note that the default configuration of the downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="1fc94-297">Därför är det intervall då loggar och räknare hämtas från tjänstinstanser stora (5 minuter).</span><span class="sxs-lookup"><span data-stu-id="1fc94-297">Therefore the interval at which logs and counters are pulled from the service instances is large (5 minutes).</span></span> <span data-ttu-id="1fc94-298">Lägre intervallet för testning och utveckling genom att justera diagnostikinställningar för webben eller arbetsrollen efter dina behov.</span><span class="sxs-lookup"><span data-stu-id="1fc94-298">For test and development, lower the interval by adjusting the diagnostics settings of the web or the worker role to your needs.</span></span> <span data-ttu-id="1fc94-299">Högerklicka på rollen i Visual Studio Server Explorer (se ovan) och justera sedan överföra perioden i dialogrutan för konfigurationsinställningar för diagnostik:</span><span class="sxs-lookup"><span data-stu-id="1fc94-299">Right-click on the role in the Visual Studio Server Explorer (see above) and then adjust the Transfer Period in the dialog for the Diagnostics configuration settings:</span></span> 

![Konfiguration][3]

## <a name="performance"></a><span data-ttu-id="1fc94-301">Prestanda</span><span class="sxs-lookup"><span data-stu-id="1fc94-301">Performance</span></span>
<span data-ttu-id="1fc94-302">I allmänhet förväntas bättre prestanda kan från desto högre mer performant tjänstnivåer i Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="1fc94-302">In general, better performance is to be expected from the higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="1fc94-303">Högre i/o-, processor- och minnesresurser tilldelningarna för högre tjänstnivåer dra nytta av masskopiering och delete-åtgärder som använder delade kopplingstjänsten.</span><span class="sxs-lookup"><span data-stu-id="1fc94-303">Higher IO, CPU and memory allocations for the higher service tiers benefit the bulk copy and delete operations that the split-merge service uses.</span></span> <span data-ttu-id="1fc94-304">Av den anledningen bör öka tjänstnivån för dessa databaser för en definierad, begränsad tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="1fc94-304">For that reason, increase the service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="1fc94-305">Tjänsten utför även validering frågor som en del av dess normal drift.</span><span class="sxs-lookup"><span data-stu-id="1fc94-305">The service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="1fc94-306">Frågorna verifiering för oväntat förekomsten av data i målintervallet och kontrollerar att alla delade/merge/flyttningsåtgärd startar från ett konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="1fc94-306">These validation queries check for unexpected presence of data in the target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="1fc94-307">Frågorna alla fungerar över horisontell partitionering nyckelintervall definieras av omfattningen av åtgärden och batchstorleken tillhandahålls som en del av definitionen för begäran.</span><span class="sxs-lookup"><span data-stu-id="1fc94-307">These queries all work over sharding key ranges defined by the scope of the operation and the batch size provided as part of the request definition.</span></span> <span data-ttu-id="1fc94-308">De här frågorna gör bäst ifrån sig när ett index som har horisontell partitionering nyckel som inledande kolumnen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-308">These queries perform best when an index is present that has the sharding key as the leading column.</span></span> 

<span data-ttu-id="1fc94-309">Dessutom kan en unikhet egenskap med nyckel för horisontell partitionering som kolumnen inledande tjänsten för att använda en optimerad metod som begränsar förbrukning av nätverksresurser vad gäller loggutrymme och minne.</span><span class="sxs-lookup"><span data-stu-id="1fc94-309">In addition, a uniqueness property with the sharding key as the leading column will allow the service to use an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="1fc94-310">Den här egenskapen unikhet krävs för att flytta stora datamängder (vanligtvis ovanför 1GB).</span><span class="sxs-lookup"><span data-stu-id="1fc94-310">This uniqueness property is required to move large data sizes (typically above 1GB).</span></span> 

## <a name="how-to-upgrade"></a><span data-ttu-id="1fc94-311">Så här uppgraderar du</span><span class="sxs-lookup"><span data-stu-id="1fc94-311">How to upgrade</span></span>
1. <span data-ttu-id="1fc94-312">Följ stegen i [distribuera en delad kopplingstjänsten](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span><span class="sxs-lookup"><span data-stu-id="1fc94-312">Follow the steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="1fc94-313">Ändra konfigurationsfilen cloud service för dina delade dokument distributionen så att de nya konfigurationsparametrarna.</span><span class="sxs-lookup"><span data-stu-id="1fc94-313">Change your cloud service configuration file for your split-merge deployment to reflect the new configuration parameters.</span></span> <span data-ttu-id="1fc94-314">En ny obligatorisk parameter är information om certifikatet som används för kryptering.</span><span class="sxs-lookup"><span data-stu-id="1fc94-314">A new required parameter is the information about the certificate used for encryption.</span></span> <span data-ttu-id="1fc94-315">Ett enkelt sätt att göra detta är att jämföra den nya mall för konfigurationsfilen från download mot den befintliga konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-315">An easy way to do this is to compare the new configuration template file from the download against your existing configuration.</span></span> <span data-ttu-id="1fc94-316">Kontrollera att du lägger till inställningar för ”DataEncryptionPrimaryCertificateThumbprint” och ”DataEncryptionPrimary” för både webb- och arbetsrollen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-316">Make sure you add the settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both the web and the worker role.</span></span>
3. <span data-ttu-id="1fc94-317">Se till att alla som körs dela merge-åtgärder har slutförts innan du distribuerar uppdateringen till Azure.</span><span class="sxs-lookup"><span data-stu-id="1fc94-317">Before deploying the update to Azure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="1fc94-318">Du kan göra detta genom att fråga tabellerna RequestStatus och PendingWorkflows i delade sammanslagna metadata-databasen för pågående begäranden.</span><span class="sxs-lookup"><span data-stu-id="1fc94-318">You can easily do this by querying the RequestStatus and PendingWorkflows tables in the split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="1fc94-319">Uppdatera den befintliga cloud service-distributionen för att dela dokument i Azure-prenumeration med det nya paketet och uppdaterade konfigurationsfilen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-319">Update your existing cloud service deployment for split-merge in your Azure subscription with the new package and your updated service configuration file.</span></span>

<span data-ttu-id="1fc94-320">Du behöver inte att etablera en ny databas för metadata för att dela dokument att uppgradera.</span><span class="sxs-lookup"><span data-stu-id="1fc94-320">You do not need to provision a new metadata database for split-merge to upgrade.</span></span> <span data-ttu-id="1fc94-321">Den nya versionen uppgraderas automatiskt den befintliga metadata-databasen till den nya versionen.</span><span class="sxs-lookup"><span data-stu-id="1fc94-321">The new version will automatically upgrade your existing metadata database to the new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="1fc94-322">Bästa praxis och felsöka</span><span class="sxs-lookup"><span data-stu-id="1fc94-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="1fc94-323">Definiera en Testklient och utnyttja dina viktigaste move-dela/merge-åtgärder med testklienten över flera delar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-323">Define a test tenant and exercise your most important split/merge/move operations with the test tenant across several shards.</span></span> <span data-ttu-id="1fc94-324">Se till att alla metadata har definierats korrekt i Fragmentera map och att åtgärderna inte strider mot villkor eller sekundärnycklar.</span><span class="sxs-lookup"><span data-stu-id="1fc94-324">Ensure that all metadata is defined correctly in your shard map and that the operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="1fc94-325">Behåll testklienten datastorleken ovanför det maximala storleken på din största klient Se till att det inte uppstår datastorleken relaterade problem.</span><span class="sxs-lookup"><span data-stu-id="1fc94-325">Keep the test tenant data size above the maximum data size of your largest tenant to ensure you are not encountering data size related issues.</span></span> <span data-ttu-id="1fc94-326">Detta hjälper dig att utvärdera en övre gräns på den tid det tar för att flytta en enskild klient.</span><span class="sxs-lookup"><span data-stu-id="1fc94-326">This helps you assess an upper bound on the time it takes to move a single tenant around.</span></span> 
* <span data-ttu-id="1fc94-327">Kontrollera att schemat tillåter borttagning.</span><span class="sxs-lookup"><span data-stu-id="1fc94-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="1fc94-328">Dela kopplingstjänsten kräver möjlighet att ta bort data från källan Fragmentera när data har kopierats till målet.</span><span class="sxs-lookup"><span data-stu-id="1fc94-328">The split-merge service requires the ability to remove data from the source shard once the data has been successfully copied to the target.</span></span> <span data-ttu-id="1fc94-329">Till exempel **ta bort utlösare** kan förhindra tjänsten från att ta bort data på käll- och kan orsaka åtgärder misslyckas.</span><span class="sxs-lookup"><span data-stu-id="1fc94-329">For example, **delete triggers** can prevent the service from deleting the data on the source and may cause operations to fail.</span></span>
* <span data-ttu-id="1fc94-330">Nyckeln för horisontell partitionering bör vara den inledande kolumnen i din primär nyckel eller ett unikt Indexdefinition.</span><span class="sxs-lookup"><span data-stu-id="1fc94-330">The sharding key should be the leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="1fc94-331">Detta säkerställer att uppnå bästa prestanda för frågor för delade eller merge-verifiering och för faktiska data movement och borttagning åtgärder som använder alltid nyckelintervall för horisontell partitionering.</span><span class="sxs-lookup"><span data-stu-id="1fc94-331">That ensures the best performance for the split or merge validation queries, and for the actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="1fc94-332">Samordna split-kopplingstjänsten i den region och datacenter där databaserna finns.</span><span class="sxs-lookup"><span data-stu-id="1fc94-332">Collocate your split-merge service in the region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png

