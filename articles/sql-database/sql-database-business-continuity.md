---
title: "Affärskontinuitet i molnet – databasåterställning – SQL Database | Microsoft Docs"
description: "Lär dig hur Azure SQL Database stöder databasåterställning och affärskontinuitet i molnet och hur du kan köra verksamhetskritiska molnprogram."
keywords: "affärskontinuitet, molnaffärskontinuitet, databashaveriberedskap, databasåterställning"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: cc93ee34a37a4a8688fa2eca338126c13b9940c0
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a><span data-ttu-id="e4c9c-104">Översikt över affärskontinuitet med Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="e4c9c-104">Overview of business continuity with Azure SQL Database</span></span>

<span data-ttu-id="e4c9c-105">Den här översikten beskriver de funktioner som Azure SQL Database tillhandahåller för affärskontinuitet och haveriberedskap.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-105">This overview describes the capabilities that Azure SQL Database provides for business continuity and disaster recovery.</span></span> <span data-ttu-id="e4c9c-106">Läs mer om alternativen och rekommendationer självstudier för att återställa från avbrott som kan leda till dataförlust eller leda till databasen och programmet ska bli tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-106">Learn about options, recommendations, and tutorials for recovering from disruptive events that could cause data loss or cause your database and application to become unavailable.</span></span> <span data-ttu-id="e4c9c-107">Lär dig vad du gör om en användare eller ett program fel påverkar dataintegritet, en Azure-region har ett avbrott eller programmet kräver underhåll.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-107">Learn what to do when a user or application error affects data integrity, an Azure region has an outage, or your application requires maintenance.</span></span>

## <a name="sql-database-features-that-you-can-use-to-provide-business-continuity"></a><span data-ttu-id="e4c9c-108">SQL Database-funktioner som du kan använda för att upprätthålla affärskontinuitet</span><span class="sxs-lookup"><span data-stu-id="e4c9c-108">SQL Database features that you can use to provide business continuity</span></span>

<span data-ttu-id="e4c9c-109">SQL Database tillhandahåller flera funktioner för affärskontinuitet, inklusive automatiserade säkerhetskopieringar och valfri databasreplikering.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-109">SQL Database provides several business continuity features, including automated backups and optional database replication.</span></span> <span data-ttu-id="e4c9c-110">Den uppskattade återställningstiden (ERT) och den potentiella dataförlusten för de senaste transaktionerna skiljer sig mellan de olika metoderna.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-110">Each has different characteristics for estimated recovery time (ERT) and potential data loss for recent transactions.</span></span> <span data-ttu-id="e4c9c-111">Om du förstår de olika alternativen blir det enklare att välja mellan dem, och i de flesta fall kan du använda dem tillsammans för olika scenarier.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-111">Once you understand these options, you can choose among them - and, in most scenarios, use them together for different scenarios.</span></span> <span data-ttu-id="e4c9c-112">När du utvecklar din affärskontinuitetsplan är det viktigt att du tittar på den högsta acceptabla tiden innan programmet är helt återställt efter en avbrottshändelse – detta är ditt mål för återställningstid (RTO).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-112">As you develop your business continuity plan, you need to understand the maximum acceptable time before the application fully recovers after the disruptive event - this is your recovery time objective (RTO).</span></span> <span data-ttu-id="e4c9c-113">Du måste också att förstå hur senaste data uppdateringar (tidsintervall) programmet kan tolerera förlorar när återställning efter händelsen störande – det här är ditt mål för återställningspunkt (RPO).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-113">You also need to understand the maximum amount of recent data updates (time interval) the application can tolerate losing when recovering after the disruptive event - this is your recovery point objective (RPO).</span></span>

<span data-ttu-id="e4c9c-114">I följande tabell jämförs ERT och RPO för de tre vanligaste scenarierna.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-114">The following table compares the ERT and RPO for the three most common scenarios.</span></span>

| <span data-ttu-id="e4c9c-115">Funktion</span><span class="sxs-lookup"><span data-stu-id="e4c9c-115">Capability</span></span> | <span data-ttu-id="e4c9c-116">Basic-nivå</span><span class="sxs-lookup"><span data-stu-id="e4c9c-116">Basic tier</span></span> | <span data-ttu-id="e4c9c-117">Standard-nivå</span><span class="sxs-lookup"><span data-stu-id="e4c9c-117">Standard tier</span></span> | <span data-ttu-id="e4c9c-118">Premiumnivå</span><span class="sxs-lookup"><span data-stu-id="e4c9c-118">Premium tier</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="e4c9c-119">Återställning till tidpunkt från säkerhetskopia</span><span class="sxs-lookup"><span data-stu-id="e4c9c-119">Point in Time Restore from backup</span></span> |<span data-ttu-id="e4c9c-120">En återställningspunkt inom 7 dagar</span><span class="sxs-lookup"><span data-stu-id="e4c9c-120">Any restore point within 7 days</span></span> |<span data-ttu-id="e4c9c-121">En återställningspunkt inom 35 dagar</span><span class="sxs-lookup"><span data-stu-id="e4c9c-121">Any restore point within 35 days</span></span> |<span data-ttu-id="e4c9c-122">En återställningspunkt inom 35 dagar</span><span class="sxs-lookup"><span data-stu-id="e4c9c-122">Any restore point within 35 days</span></span> |
| <span data-ttu-id="e4c9c-123">GEO-återställning från säkerhetskopior georeplikerad</span><span class="sxs-lookup"><span data-stu-id="e4c9c-123">Geo-restore from geo-replicated backups</span></span> |<span data-ttu-id="e4c9c-124">ERT < 12 timme, RPO < 1 timme</span><span class="sxs-lookup"><span data-stu-id="e4c9c-124">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="e4c9c-125">ERT < 12 timme, RPO < 1 timme</span><span class="sxs-lookup"><span data-stu-id="e4c9c-125">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="e4c9c-126">ERT < 12 timme, RPO < 1 timme</span><span class="sxs-lookup"><span data-stu-id="e4c9c-126">ERT < 12h, RPO < 1h</span></span> |
| <span data-ttu-id="e4c9c-127">Återställning från Azure Backup Vault</span><span class="sxs-lookup"><span data-stu-id="e4c9c-127">Restore from Azure Backup Vault</span></span> |<span data-ttu-id="e4c9c-128">ERT < 12 timme, RPO < 1 vecka</span><span class="sxs-lookup"><span data-stu-id="e4c9c-128">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="e4c9c-129">ERT < 12 timme, RPO < 1 vecka</span><span class="sxs-lookup"><span data-stu-id="e4c9c-129">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="e4c9c-130">ERT < 12 timme, RPO < 1 vecka</span><span class="sxs-lookup"><span data-stu-id="e4c9c-130">ERT < 12h, RPO < 1 wk</span></span> |
| <span data-ttu-id="e4c9c-131">Aktiv geo-replikering</span><span class="sxs-lookup"><span data-stu-id="e4c9c-131">Active geo-replication</span></span> |<span data-ttu-id="e4c9c-132">ERT < 30 sekunder, RPO < 5 sekunder</span><span class="sxs-lookup"><span data-stu-id="e4c9c-132">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="e4c9c-133">ERT < 30 sekunder, RPO < 5 sekunder</span><span class="sxs-lookup"><span data-stu-id="e4c9c-133">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="e4c9c-134">ERT < 30 sekunder, RPO < 5 sekunder</span><span class="sxs-lookup"><span data-stu-id="e4c9c-134">ERT < 30s, RPO < 5s</span></span> |

### <a name="use-database-backups-to-recover-a-database"></a><span data-ttu-id="e4c9c-135">Använda databassäkerhetskopior för att återställa en databas</span><span class="sxs-lookup"><span data-stu-id="e4c9c-135">Use database backups to recover a database</span></span>

<span data-ttu-id="e4c9c-136">SQL-databas utförs automatiskt en kombination av fullständiga databassäkerhetskopieringar varje vecka, varje timme differentiella säkerhetskopieringar och transaktionen loggsäkerhetskopior var femte - tio minuter för att skydda företaget från förlust av data.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-136">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes to protect your business from data loss.</span></span> <span data-ttu-id="e4c9c-137">Dessa säkerhetskopior lagras i geo-redundant lagring för 35 dagar för databaser i tjänstnivåer Standard och Premium och 7 dagar för databaser på Basic tjänstnivån.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-137">These backups are stored in geo-redundant storage for 35 days for databases in the Standard and Premium service tiers and 7 days for databases in the Basic service tier.</span></span> <span data-ttu-id="e4c9c-138">Mer information finns i [tjänstnivåer](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-138">For more information, see [service tiers](sql-database-service-tiers.md).</span></span> <span data-ttu-id="e4c9c-139">Om kvarhållningsperioden för din tjänstenivå inte uppfyller dina verksamhetskrav kan du öka kvarhållningsperioden genom att [byta tjänstnivå](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-139">If the retention period for your service tier does not meet your business requirements, you can increase the retention period by [changing the service tier](sql-database-service-tiers.md).</span></span> <span data-ttu-id="e4c9c-140">De fullständiga och differentiella säkerhetskopieringarna replikeras också till ett [kopplat datacenter](../best-practices-availability-paired-regions.md) för skydd mot avbrott på datacentret.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-140">The full and differential database backups are also replicated to a [paired data center](../best-practices-availability-paired-regions.md) for protection against a data center outage.</span></span> <span data-ttu-id="e4c9c-141">Mer information finns i [automatiska säkerhetskopieringar](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-141">For more information, see [automatic database backups](sql-database-automated-backups.md).</span></span>

<span data-ttu-id="e4c9c-142">Om inbyggda kvarhållningsperioden inte är tillräcklig för programmet, utöka du den genom att konfigurera databasen långsiktiga bevarandeprincip.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-142">If the built-in retention period is not sufficient for your application, you can extend it by configuring a database long-term retention policy.</span></span> <span data-ttu-id="e4c9c-143">Mer information finns i [långsiktig kvarhållning](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-143">For more information, see [long-term retention](sql-database-long-term-retention.md).</span></span>

<span data-ttu-id="e4c9c-144">Du kan använda dessa automatiska databassäkerhetskopior för att återställa en databas från olika avbrottshändelser, både i ditt datacenter och till ett annat datacenter.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-144">You can use these automatic database backups to recover a database from various disruptive events, both within your data center and to another data center.</span></span> <span data-ttu-id="e4c9c-145">Om du använder automatiska databassäkerhetskopieringar beror den beräknade återställningstiden på flera faktorer, inklusive det totala antalet databaser som återställs i samma region vid samma tidpunkt, databasens storlek, transaktionsloggarnas storlek och nätverksbandbredden.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-145">Using automatic database backups, the estimated time of recovery depends on several factors including the total number of databases recovering in the same region at the same time, the database size, the transaction log size, and network bandwidth.</span></span> <span data-ttu-id="e4c9c-146">Tiden för återställning är vanligtvis mindre än 12 timmar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-146">The recovery time is usually less than 12 hours.</span></span> <span data-ttu-id="e4c9c-147">När du återställer till en annan dataregion är den potentiella dataförlusten begränsad till 1 timme med geo-redundant lagring med differentiella säkerhetskopieringar varje timme.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-147">When recovering to another data region, the potential data loss is limited to 1 hour by the geo-redundant storage of hourly differential database backups.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e4c9c-148">Om du återställer med hjälp av automatisk säkerhetskopior måste du vara medlem i SQL Server-rollen Deltagare eller vara prenumerationsägaren. Mer information finns i [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md) (Rollbaserad åtkomstkontroll: Inbyggda roller).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-148">To recover using automated backups, you must be a member of the SQL Server Contributor role or the subscription owner - see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md).</span></span> <span data-ttu-id="e4c9c-149">Du kan återställa med hjälp av Azure Portal, PowerShell eller REST-API:et.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-149">You can recover using the Azure portal, PowerShell, or the REST API.</span></span> <span data-ttu-id="e4c9c-150">Du kan inte använda Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-150">You cannot use Transact-SQL.</span></span>
>

<span data-ttu-id="e4c9c-151">Använd automatiska säkerhetskopieringar som din affärskontinuitets- och återställningsmetod om ditt program:</span><span class="sxs-lookup"><span data-stu-id="e4c9c-151">Use automated backups as your business continuity and recovery mechanism if your application:</span></span>

* <span data-ttu-id="e4c9c-152">Inte betraktas som verksamhetskritiskt.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-152">Is not considered mission critical.</span></span>
* <span data-ttu-id="e4c9c-153">Har en bindning SLA - ett driftstopp på 24 timmar eller resulterar längre inte i finansiella ansvar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-153">Doesn't have a binding SLA - a downtime of 24 hours or longer does not result in financial liability.</span></span>
* <span data-ttu-id="e4c9c-154">Har en låg frekvens av dataändringar (lågt antal transaktioner per timme) och en förlust på upp till en timmes ändringar är en acceptabel dataförlust.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-154">Has a low rate of data change (low transactions per hour) and losing up to an hour of change is an acceptable data loss.</span></span>
* <span data-ttu-id="e4c9c-155">Är kostnadskänsligt.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-155">Is cost sensitive.</span></span>

<span data-ttu-id="e4c9c-156">Om du behöver snabbare återställning använder [aktiv geo-replikering](sql-database-geo-replication-overview.md) (beskrivs nedan).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-156">If you need faster recovery, use [active geo-replication](sql-database-geo-replication-overview.md) (discussed next).</span></span> <span data-ttu-id="e4c9c-157">Om du behöver för att kunna återställa data från en period som är äldre än 35 dagar använder [långsiktig lagring av säkerhetskopior](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-157">If you need to be able to recover data from a period older than 35 days, use [long-term backup retention](sql-database-long-term-retention.md).</span></span> 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-to-reduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a><span data-ttu-id="e4c9c-158">Använda aktiv geo-replikering och automatisk redundans grupper (i förhandsversion) för att minska tiden för återställning och begränsa förlust av data som är associerade med en återställning</span><span class="sxs-lookup"><span data-stu-id="e4c9c-158">Use active geo-replication and auto-failover groups (in-preview) to reduce recovery time and limit data loss associated with a recovery</span></span>

<span data-ttu-id="e4c9c-159">Förutom att använda säkerhetskopiering av databaser för återställning av databasen om ett företag avbrott inträffar kan du använda [aktiv geo-replikering](sql-database-geo-replication-overview.md) du konfigurerar en databas med upp till fyra läsbara sekundära databaser i områden av ditt val.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-159">In addition to using database backups for database recovery if a business disruption occurs, you can use [active geo-replication](sql-database-geo-replication-overview.md) to configure a database to have up to four readable secondary databases in the regions of your choice.</span></span> <span data-ttu-id="e4c9c-160">Dessa sekundära databaser synkroniseras med den primära databasen med hjälp av en asynkron replikeringsmekanism.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-160">These secondary databases are kept synchronized with the primary database using an asynchronous replication mechanism.</span></span> <span data-ttu-id="e4c9c-161">Den här funktionen används för att skydda mot avbrott i verksamheten om en data center strömavbrott eller under en uppgradering av programmet.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-161">This feature is used to protect against business disruption if a data center outage occurs or during an application upgrade.</span></span> <span data-ttu-id="e4c9c-162">Aktiv geo-replikering kan också användas för att ge bättre prestanda för frågor för skrivskyddade frågor till geografiskt spridda användare.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-162">Active geo-replication can also be used to provide better query performance for read-only queries to geographically dispersed users.</span></span>

<span data-ttu-id="e4c9c-163">Aktivera automatiserad och transparent redundans bör du organisera dina geo-replikerade databaser i grupper med hjälp av den [automatisk redundans grupp](sql-database-geo-replication-overview.md) funktion i SQL-databas (i förhandsversion).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-163">To enable automated and transparent failover you should organize your geo-replicated databases into groups using the [auto-failover group](sql-database-geo-replication-overview.md) feature of SQL Database (in-preview).</span></span>

<span data-ttu-id="e4c9c-164">Om den primära databasen försätts offline oväntat eller måste du kopplar från för underhåll, kan du snabbt uppgraderar en sekundär att bli den primära servern (kallas även en växling vid fel) och konfigurera program för att ansluta till den upphöjda primärt.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-164">If the primary database goes offline unexpectedly or you need to take it offline for maintenance activities, you can quickly promote a secondary to become the primary (also called a failover) and configure applications to connect to the promoted primary.</span></span> <span data-ttu-id="e4c9c-165">Om programmet ansluter till databaserna med grupplyssnarens växling vid fel, behöver du inte ändra SQL-sträng konfigurationen efter växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-165">If your application is connecting to the databases using the failover group listener, you don’t need to change the SQL connection string configuration after failover.</span></span> <span data-ttu-id="e4c9c-166">Vid en planerad redundansväxling förekommer ingen dataförlust.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-166">With a planned failover, there is no data loss.</span></span> <span data-ttu-id="e4c9c-167">Vid en oplanerad redundansväxling kan en mindre mängd data gå förlorade för de senaste transaktionerna på grund av hur den asynkrona replikeringen fungerar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-167">With an unplanned failover, there may be some small amount of data loss for very recent transactions due to the nature of asynchronous replication.</span></span> <span data-ttu-id="e4c9c-168">Du kan anpassa redundans principen för att minimera potentiell dataförlust använder automatisk redundans-grupper (i förhandsversion).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-168">Using auto-failover groups (in-preview), you can customize the failover policy to minimize the potential data loss.</span></span> <span data-ttu-id="e4c9c-169">Efter en redundansväxling kan du senare växla tillbaka igen, antingen enligt en plan eller när datacentret är online igen.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-169">After a failover, you can later failback - either according to a plan or when the data center comes back online.</span></span> <span data-ttu-id="e4c9c-170">I samtliga fall upplever användarna ett kort avbrott och måste återansluta.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-170">In all cases, users experience a small amount of downtime and need to reconnect.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e4c9c-171">Om du vill använda aktiv geo-replikering och automatisk redundans grupper (i förhandsversion), måste du vara prenumerationsägaren eller har administrativ behörighet i SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-171">To use active geo-replication and auto-failover groups (in-preview), you must either be the subscription owner or have administrative permissions in SQL Server.</span></span> <span data-ttu-id="e4c9c-172">Du kan konfigurera och växla över med hjälp av Azure portal, PowerShell eller REST-API med hjälp av Azure-Prenumerationsbehörigheter eller Transact-SQL med SQL Server-behörighet.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-172">You can configure and fail over using the Azure portal, PowerShell, or the REST API using Azure subscription permissions or using Transact-SQL with SQL Server permissions.</span></span>
> 

<span data-ttu-id="e4c9c-173">Använd aktiv geo-replikering och automatisk redundans grupper (under förhandsgranskning) om appen uppfyller någon av dessa villkor:</span><span class="sxs-lookup"><span data-stu-id="e4c9c-173">Use active geo-replication and auto-failover groups (in preview) if your application meets any of these criteria:</span></span>

* <span data-ttu-id="e4c9c-174">Är verksamhetskritiskt.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-174">Is mission critical.</span></span>
* <span data-ttu-id="e4c9c-175">Har ett serviceavtal (SLA) som inte tillåter driftavbrott på 24 timmar eller mer.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-175">Has a service level agreement (SLA) that does not allow for 24 hours or more of downtime.</span></span>
* <span data-ttu-id="e4c9c-176">Driftstopp kan resultera i finansiella ansvar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-176">Downtime may result in financial liability.</span></span>
* <span data-ttu-id="e4c9c-177">Har en hög frekvens av dataändringar och en timmes dataförlust är inte acceptabelt.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-177">Has a high rate of data change is high and losing an hour of data is not acceptable.</span></span>
* <span data-ttu-id="e4c9c-178">Den extra kostnaden för aktiv geo-replikering är lägre än de potentiella ekonomiska skyldigheterna och den associerade affärsförlusten.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-178">The additional cost of active geo-replication is lower than the potential financial liability and associated loss of business.</span></span>

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a><span data-ttu-id="e4c9c-179">Återställa en databas efter ett användar- eller programfel</span><span class="sxs-lookup"><span data-stu-id="e4c9c-179">Recover a database after a user or application error</span></span>
<span data-ttu-id="e4c9c-180">* Ingen är perfekt!</span><span class="sxs-lookup"><span data-stu-id="e4c9c-180">*No one is perfect!</span></span> <span data-ttu-id="e4c9c-181">En användare kan oavsiktligt ta bort vissa data eller av misstag radera en viktig tabell eller till och med en hel databas.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-181">A user might accidentally delete some data, inadvertently drop an important table, or even drop an entire database.</span></span> <span data-ttu-id="e4c9c-182">Och ett program kan av misstag skriva över värdefulla data med felaktiga data på grund av ett fel i programmet.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-182">Or, an application might accidentally overwrite good data with bad data due to an application defect.</span></span>

<span data-ttu-id="e4c9c-183">I det här scenariot har du följande återställningsalternativ.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-183">In this scenario, these are your recovery options.</span></span>

### <a name="perform-a-point-in-time-restore"></a><span data-ttu-id="e4c9c-184">Utföra en återställning till en viss tidpunkt</span><span class="sxs-lookup"><span data-stu-id="e4c9c-184">Perform a point-in-time restore</span></span>
<span data-ttu-id="e4c9c-185">Du kan använda automatiska säkerhetskopior för att återställa en kopia av databasen till en tidigare tidpunkt, förutsatt att tiden ligger inom databasens kvarhållningsperiod.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-185">You can use the automated backups to recover a copy of your database to a known good point in time, provided that time is within the database retention period.</span></span> <span data-ttu-id="e4c9c-186">När databasen har återställts kan du antingen ersätta den ursprungliga databasen med den återställda databasen eller kopiera nödvändiga data från den återställda informationen till den ursprungliga databasen.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-186">After the database is restored, you can either replace the original database with the restored database or copy the needed data from the restored data into the original database.</span></span> <span data-ttu-id="e4c9c-187">Om databasen använder aktiv geo-replikering, rekommenderar vi kopiering av nödvändiga data från den återställda kopian i den ursprungliga databasen.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-187">If the database uses active geo-replication, we recommend copying the required data from the restored copy into the original database.</span></span> <span data-ttu-id="e4c9c-188">Om du ersätta den ursprungliga databasen med den återställda databasen måste du konfigurera om och omsynkronisera aktiv geo-replikering (vilket kan ta mycket tid för en stor databas).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-188">If you replace the original database with the restored database, you need to reconfigure and resynchronize active geo-replication (which can take quite some time for a large database).</span></span>

<span data-ttu-id="e4c9c-189">Mer information och detaljerade anvisningar som beskriver hur du återställer en databas till en viss tidpunkt med hjälp av Azure Portal eller PowerShell finns i avsnittet om [återställning till tidpunkt](sql-database-recovery-using-backups.md#point-in-time-restore).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-189">For more information and for detailed steps for restoring a database to a point in time using the Azure portal or using PowerShell, see [point-in-time restore](sql-database-recovery-using-backups.md#point-in-time-restore).</span></span> <span data-ttu-id="e4c9c-190">Du kan inte återställa med hjälp av Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-190">You cannot recover using Transact-SQL.</span></span>

### <a name="restore-a-deleted-database"></a><span data-ttu-id="e4c9c-191">Återställa en borttagen databas</span><span class="sxs-lookup"><span data-stu-id="e4c9c-191">Restore a deleted database</span></span>
<span data-ttu-id="e4c9c-192">Om databasen tas bort, men den logiska servern inte har tagits bort, kan du återställa den borttagna databasen till den tidpunkt då den togs bort.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-192">If the database is deleted but the logical server has not been deleted, you can restore the deleted database to the point at which it was deleted.</span></span> <span data-ttu-id="e4c9c-193">Om du gör det återställs en säkerhetskopia av databasen till samma logiska SQL-server som den togs bort från.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-193">This restores a database backup to the same logical SQL server from which it was deleted.</span></span> <span data-ttu-id="e4c9c-194">Du kan återställa den genom att använda det ursprungliga namnet eller ange ett nytt namn eller den återställda databasen.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-194">You can restore it using the original name or provide a new name or the restored database.</span></span>

<span data-ttu-id="e4c9c-195">Mer information och detaljerade anvisningar som beskriver hur du återställer en borttagen databas med hjälp av Azure Portal eller PowerShell finns i avsnittet om hur du [återställer en borttagen databas](sql-database-recovery-using-backups.md#deleted-database-restore).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-195">For more information and for detailed steps for restoring a deleted database using the Azure portal or using PowerShell, see [restore a deleted database](sql-database-recovery-using-backups.md#deleted-database-restore).</span></span> <span data-ttu-id="e4c9c-196">Du kan inte återställa med hjälp av Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-196">You cannot restore using Transact-SQL.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e4c9c-197">Om den logiska servern tas bort kan du inte återställa en borttagen databas.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-197">If the logical server is deleted, you cannot recover a deleted database.</span></span>
>
>

### <a name="restore-from-azure-backup-vault"></a><span data-ttu-id="e4c9c-198">Återställning från Azure Backup Vault</span><span class="sxs-lookup"><span data-stu-id="e4c9c-198">Restore from Azure Backup Vault</span></span>
<span data-ttu-id="e4c9c-199">Om dataförlusten inträffat utanför den aktuella kvarhållningsperioden för automatisk säkerhetskopiering och databasen har konfigurerats för långsiktig kvarhållning, kan du återställa från en veckovis säkerhetskopiering i Azure Backup Vault till en ny databas.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-199">If the data loss occurred outside the current retention period for automated backups and your database is configured for long-term retention, you can restore from a weekly backup in Azure Backup Vault to a new database.</span></span> <span data-ttu-id="e4c9c-200">I detta läge kan du antingen ersätta den ursprungliga databasen med den återställda databasen eller kopiera nödvändiga data från den återställda databasen till den ursprungliga databasen.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-200">At this point, you can either replace the original database with the restored database or copy the needed data from the restored database into the original database.</span></span> <span data-ttu-id="e4c9c-201">Om du behöver hämta en gammal version av databasen före en uppgradering av större programmet uppfylla en begäran från granskare eller en juridiska ordning du kan skapa en databas med en fullständig säkerhetskopia som sparats i Azure Backup-valvet.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-201">If you need to retrieve an old version of your database prior to a major application upgrade, satisfy a request from auditors or a legal order, you can create a database using a full backup saved in the Azure Backup Vault.</span></span>  <span data-ttu-id="e4c9c-202">Mer information finns i avsnittet om [långsiktig kvarhållning](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-202">For more information, see [Long-term retention](sql-database-long-term-retention.md).</span></span>

## <a name="recover-a-database-to-another-region-from-an-azure-regional-data-center-outage"></a><span data-ttu-id="e4c9c-203">Återställa en databas till en annan region från ett avbrott på ett regionalt Azure-datacenter</span><span class="sxs-lookup"><span data-stu-id="e4c9c-203">Recover a database to another region from an Azure regional data center outage</span></span>
<!-- Explain this scenario -->

<span data-ttu-id="e4c9c-204">Även om det är ovanligt finns risken för ett avbrott på ett Azure-datacenter.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-204">Although rare, an Azure data center can have an outage.</span></span> <span data-ttu-id="e4c9c-205">När ett avbrott uppstår orsakar det ett verksamhetsavbrott som kan vara några få minuter eller flera timmar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-205">When an outage occurs, it causes a business disruption that might only last a few minutes or might last for hours.</span></span>

* <span data-ttu-id="e4c9c-206">Ett alternativ är att vänta tills databasen är tillbaka online när avbrottet på datadatacentret är över.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-206">One option is to wait for your database to come back online when the data center outage is over.</span></span> <span data-ttu-id="e4c9c-207">Det här fungerar för program som har råd att ha databasen offline.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-207">This works for applications that can afford to have the database offline.</span></span> <span data-ttu-id="e4c9c-208">Till exempel ett utvecklingsprojekt eller en kostnadsfri utvärderingsversion som du inte behöver arbeta med hela tiden.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-208">For example, a development project or free trial you don't need to work on constantly.</span></span> <span data-ttu-id="e4c9c-209">När ett datacenter har ett avbrott, vet du inte hur länge kan det senaste avbrottet, så det här alternativet fungerar bara om du inte behöver databasen för en stund.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-209">When a data center has an outage, you do not know how long the outage might last, so this option only works if you don't need your database for a while.</span></span>
* <span data-ttu-id="e4c9c-210">Ett annat alternativ är att antingen misslyckas över till en annan dataområdet om du använder aktiv geo-replikering eller alternativet Återställ en databas med geo-redundant databassäkerhetskopieringar (geo-återställning).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-210">Another option is to either fail over to another data region if you are using active geo-replication or the recover a database using geo-redundant database backups (geo-restore).</span></span> <span data-ttu-id="e4c9c-211">Redundans tar endast några sekunder medan databasåterställning från säkerhetskopior tar timmar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-211">Failover takes only a few seconds while database recovery from backups takes hours.</span></span>

<span data-ttu-id="e4c9c-212">När du utför en åtgärd, hur lång tid det tar att återställa och hur mycket du medföra dataförluster beror på hur du väljer att använda de här funktionerna för verksamhetskontinuitet i ditt program.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-212">When you take action, how long it takes you to recover, and how much data loss you incur depends upon how you decide to use these business continuity features in your application.</span></span> <span data-ttu-id="e4c9c-213">Kan du använda en kombination av säkerhetskopior av databasen och aktiv geo-replikering beroende på kraven för application.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-213">Indeed, you may choose to use a combination of database backups and active geo-replication depending upon your application requirements.</span></span> <span data-ttu-id="e4c9c-214">Information om designöverväganden för fristående databaser och för elastiska pooler när dessa funktioner för affärskontinuitet används finns i [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) (Utforma ett program för haveriberedskap i molnet) och [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md) (Haveriberedskapsstrategier med en elastisk pool).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-214">For a discussion of application design considerations for stand-alone databases and for elastic pools using these business continuity features, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

<span data-ttu-id="e4c9c-215">Följande avsnitt innehåller en översikt över stegen för att återställa med hjälp av säkerhetskopiorna av databasen eller aktiv geo-replikering.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-215">The following sections provide an overview of the steps to recover using either database backups or active geo-replication.</span></span> <span data-ttu-id="e4c9c-216">Detaljerade anvisningar inklusive planering krav, post återställningsåtgärderna och information om hur du simulera ett avbrott om du vill utföra en katastrof återställningsgranskning finns [återställa en SQL-databas från ett avbrott](sql-database-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-216">For detailed steps including planning requirements, post recovery steps, and information about how to simulate an outage to perform a disaster recovery drill, see [Recover a SQL Database from an outage](sql-database-disaster-recovery.md).</span></span>

### <a name="prepare-for-an-outage"></a><span data-ttu-id="e4c9c-217">Förbereda för ett avbrott</span><span class="sxs-lookup"><span data-stu-id="e4c9c-217">Prepare for an outage</span></span>
<span data-ttu-id="e4c9c-218">Oavsett vilken funktion för affärskontinuitet du använder, måste du:</span><span class="sxs-lookup"><span data-stu-id="e4c9c-218">Regardless of the business continuity feature you use, you must:</span></span>

* <span data-ttu-id="e4c9c-219">Identifiera och förbered målservern, inklusive brandväggsregler på servernivå, inloggningar och behörigheter på huvuddatabasnivå.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-219">Identify and prepare the target server, including server-level firewall rules, logins, and master database level permissions.</span></span>
* <span data-ttu-id="e4c9c-220">Bestämma hur du ska omdirigera klienter och klientprogram till den nya servern.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-220">Determine how to redirect clients and client applications to the new server</span></span>
* <span data-ttu-id="e4c9c-221">Dokumentera andra beroenden, till exempel granskningsinställningar och aviseringar.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-221">Document other dependencies, such as auditing settings and alerts</span></span>

<span data-ttu-id="e4c9c-222">Om du inte framställer korrekt, att dina program online efter en växling vid fel eller en databasåterställning tar extra tid och kan också kräva felsökning i taget stress - en felaktig kombination.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-222">If you do not prepare properly, bringing your applications online after a failover or a database recovery takes additional time and likely also require troubleshooting at a time of stress - a bad combination.</span></span>

### <a name="fail-over-to-a-geo-replicated-secondary-database"></a><span data-ttu-id="e4c9c-223">Växla över till en sekundär geo-replikerade-databas</span><span class="sxs-lookup"><span data-stu-id="e4c9c-223">Fail over to a geo-replicated secondary database</span></span>
<span data-ttu-id="e4c9c-224">Om du använder aktiv geo-replikering och automatisk redundans grupper (i förhandsversion) som återställningsmekanism för kan du konfigurera en princip för automatisk redundans eller använda [manuell växling](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-224">If you are using active geo-replication and auto-failover groups (in-preview) as your recovery mechanism, you can configure an automatic failover policy or use [manual failover](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span></span> <span data-ttu-id="e4c9c-225">Efter växling vid fel gör att sekundärt att bli den nya primärt och är redo att registrera nya transaktioner och besvara frågor – med minimal dataförlust för de data som inte har replikerats.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-225">Once initiated, the failover causes the secondary to become the new primary and ready to record new transactions and respond to queries - with minimal data loss for the data not yet replicated.</span></span> <span data-ttu-id="e4c9c-226">Information om hur du utformar failover-processen finns [utforma ett program för katastrofåterställning i molnet](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-226">For information on designing the failover process, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e4c9c-227">När Datacenter är tillbaka online återansluta till den nya primärt gamla primärfärgerna automatiskt och blir sekundära databaser.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-227">When the data center comes back online the old primaries automatically reconnect to the new primary and become secondary databases.</span></span> <span data-ttu-id="e4c9c-228">Om du behöver flytta primära tillbaka till den ursprungliga regionen du kan starta en planerad redundans manuellt (återställning).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-228">If you need to relocate the primary back to the original region, you can initiate a planned failover manually (failback).</span></span> 
> 

### <a name="perform-a-geo-restore"></a><span data-ttu-id="e4c9c-229">Utför en geo-återställning</span><span class="sxs-lookup"><span data-stu-id="e4c9c-229">Perform a geo-restore</span></span>
<span data-ttu-id="e4c9c-230">Om du använder automatisk säkerhetskopiering med geo-redundant lagringsreplikering som återställningsmekanism för [initiera en databasåterställning med geo-återställning](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-230">If you are using automated backups with geo-redundant storage replication as your recovery mechanism, [initiate a database recovery using geo-restore](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span> <span data-ttu-id="e4c9c-231">Återställningen sker vanligtvis inom 12 timmar – med en dataförlust på upp till en timme beroende på när den senaste differentiella säkerhetskopieringen per timme gjordes och replikerades.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-231">Recovery usually takes place within 12 hours - with data loss of up to one hour determined by when the last hourly differential backup with taken and replicated.</span></span> <span data-ttu-id="e4c9c-232">Databasen kan inte registrera några transaktioner eller svara på frågor förrän återställningen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-232">Until the recovery completes, the database is unable to record any transactions or respond to any queries.</span></span> <span data-ttu-id="e4c9c-233">När det här återställer en databas till den senaste stöds tillgängliga tidpunkten, återställa geo-sekundär till valfri punkt i tiden inte.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-233">While this restores a database to the last available point in time, restoring the geo-secondary to any point in time is not currently supported.</span></span>

> [!NOTE]
> <span data-ttu-id="e4c9c-234">Om datacentret ansluts innan programmet växla till den återställda databasen, kan du avbryta återställningen.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-234">If the data center comes back online before you switch your application over to the recovered database, you can cancel the recovery.</span></span>  
>
>

### <a name="perform-post-failover--recovery-tasks"></a><span data-ttu-id="e4c9c-235">Utföra åtgärder efter en redundansväxling eller återställning</span><span class="sxs-lookup"><span data-stu-id="e4c9c-235">Perform post failover / recovery tasks</span></span>
<span data-ttu-id="e4c9c-236">Efter återställningen från endera återställningsmetod måste du utföra följande ytterligare uppgifter innan dina användare och program kan komma igång igen:</span><span class="sxs-lookup"><span data-stu-id="e4c9c-236">After recovery from either recovery mechanism, you must perform the following additional tasks before your users and applications are back up and running:</span></span>

* <span data-ttu-id="e4c9c-237">Omdirigera klienter och klientprogram till den nya servern och återställda databasen</span><span class="sxs-lookup"><span data-stu-id="e4c9c-237">Redirect clients and client applications to the new server and restored database</span></span>
* <span data-ttu-id="e4c9c-238">Kontrollera att lämpliga brandväggsregler på servernivå är på plats så att användarna kan ansluta (eller använd [brandväggsregler på databasnivå](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span><span class="sxs-lookup"><span data-stu-id="e4c9c-238">Ensure appropriate server-level firewall rules are in place for users to connect (or use [database-level firewalls](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span></span>
* <span data-ttu-id="e4c9c-239">Se till att rätt inloggningar och behörigheter på huvuddatabasnivå är på plats (eller använd [inneslutna användare](https://msdn.microsoft.com/library/ff929188.aspx))</span><span class="sxs-lookup"><span data-stu-id="e4c9c-239">Ensure appropriate logins and master database level permissions are in place (or use [contained users](https://msdn.microsoft.com/library/ff929188.aspx))</span></span>
* <span data-ttu-id="e4c9c-240">Konfigurera granskning efter behov</span><span class="sxs-lookup"><span data-stu-id="e4c9c-240">Configure auditing, as appropriate</span></span>
* <span data-ttu-id="e4c9c-241">Konfigurera aviseringar efter behov</span><span class="sxs-lookup"><span data-stu-id="e4c9c-241">Configure alerts, as appropriate</span></span>

## <a name="upgrade-an-application-with-minimal-downtime"></a><span data-ttu-id="e4c9c-242">Uppgradera ett program med minimal avbrottstid</span><span class="sxs-lookup"><span data-stu-id="e4c9c-242">Upgrade an application with minimal downtime</span></span>
<span data-ttu-id="e4c9c-243">Ibland måste ett program vara offline på grund av planerat underhåll, till exempel en uppgradering av programmet.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-243">Sometimes an application must be taken offline because of planned maintenance such as an application upgrade.</span></span> <span data-ttu-id="e4c9c-244">[Hantera programuppgraderingar](sql-database-manage-application-rolling-upgrade.md) beskriver hur du använder aktiv geo-replikering för att aktivera löpande uppgraderingar av tillämpningsprogrammet molnet för att minimera driftstopp under uppgraderingar och ange en Återställningssökväg om något går fel.</span><span class="sxs-lookup"><span data-stu-id="e4c9c-244">[Manage application upgrades](sql-database-manage-application-rolling-upgrade.md) describes how to use active geo-replication to enable rolling upgrades of your cloud application to minimize downtime during upgrades and provide a recovery path if something goes wrong.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="e4c9c-245">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="e4c9c-245">Next steps</span></span>
<span data-ttu-id="e4c9c-246">En beskrivning av designöverväganden för fristående databaser och för elastiska pooler finns i [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) (Utforma ett program för haveriberedskap i molnet) och [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md) (Haveriberedskapsstrategier med en elastisk pool).</span><span class="sxs-lookup"><span data-stu-id="e4c9c-246">For a discussion of application design considerations for stand-alone databases and for elastic pools, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
