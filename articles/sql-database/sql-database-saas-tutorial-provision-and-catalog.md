---
title: "Etablera nya klienter i en app för flera innehavare som använder Azure SQL Database | Microsoft Docs"
description: "Lär dig hur du etablera och katalogen nya klienter i Wingtip SaaS-app"
keywords: sql database tutorial
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: 8fa4c4f95386a92c8c818eef1a5b4de5a086fe07
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="provision-new-tenants-and-register-them-in-the-catalog"></a><span data-ttu-id="149f8-104">Etablera nya klienter och registrera dem i katalogen</span><span class="sxs-lookup"><span data-stu-id="149f8-104">Provision new tenants and register them in the catalog</span></span>

<span data-ttu-id="149f8-105">I kursen får du lära dig om SaaS-mönster etablera och katalogen och hur de implementeras i Wingtip SaaS-program.</span><span class="sxs-lookup"><span data-stu-id="149f8-105">In this tutorial, you learn about the provision and catalog SaaS patterns, and how they are implemented in the Wingtip SaaS application.</span></span> <span data-ttu-id="149f8-106">Skapa och initiera den nya innehavaren databaser och registrera dem i programkatalogen klient.</span><span class="sxs-lookup"><span data-stu-id="149f8-106">You create and initialize new tenant databases, and register them in the application’s tenant catalog.</span></span> <span data-ttu-id="149f8-107">Katalogen är en databas som underhåller mappningen mellan många hyresgäster i SaaS-program och data.</span><span class="sxs-lookup"><span data-stu-id="149f8-107">The catalog is a database that maintains the mapping between the SaaS application's many tenants and their data.</span></span> <span data-ttu-id="149f8-108">Katalogen spelar en viktig roll dirigera programförfrågningar till rätt databas.</span><span class="sxs-lookup"><span data-stu-id="149f8-108">The catalog plays an important role directing application requests to the correct database.</span></span>  

<span data-ttu-id="149f8-109">I den här guiden får du lära dig hur man:</span><span class="sxs-lookup"><span data-stu-id="149f8-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="149f8-110">Etablera en enda ny klient, inklusive stega igenom hur detta implementeras</span><span class="sxs-lookup"><span data-stu-id="149f8-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="149f8-111">Etablera en batch med ytterligare klienter</span><span class="sxs-lookup"><span data-stu-id="149f8-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="149f8-112">Följande krav måste uppfyllas för att kunna köra den här självstudiekursen:</span><span class="sxs-lookup"><span data-stu-id="149f8-112">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="149f8-113">Wingtip SaaS-appen har distribuerats.</span><span class="sxs-lookup"><span data-stu-id="149f8-113">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="149f8-114">För att distribuera på mindre än fem minuter finns [distribuera och utforska Wingtip SaaS-program](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="149f8-114">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="149f8-115">Azure PowerShell ska ha installerats.</span><span class="sxs-lookup"><span data-stu-id="149f8-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="149f8-116">Mer information finns i [Kom igång med Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="149f8-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-the-saas-catalog-pattern"></a><span data-ttu-id="149f8-117">Introduktion till SaaS-katalogmönstret</span><span class="sxs-lookup"><span data-stu-id="149f8-117">Introduction to the SaaS Catalog pattern</span></span>

<span data-ttu-id="149f8-118">I ett databasen har säkerhetskopierats flera innehavare SaaS-program är det viktigt att veta var informationen för varje klient lagras.</span><span class="sxs-lookup"><span data-stu-id="149f8-118">In a database-backed multi-tenant SaaS application, it's important to know where information for each tenant is stored.</span></span> <span data-ttu-id="149f8-119">I mönster för SaaS-katalog är en katalog databas används för att lagra mappningen mellan varje klient och där deras data lagras.</span><span class="sxs-lookup"><span data-stu-id="149f8-119">In the SaaS catalog pattern, a catalog database is used to hold the mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="149f8-120">Wingtip SaaS-appen använder en enskild klient per databas arkitektur, men det grundläggande mönstret för lagring av mappning för klient-till-databasen i en katalog gäller om en eller flera single-klient databas används.</span><span class="sxs-lookup"><span data-stu-id="149f8-120">The Wingtip SaaS app uses a single-tenant per database architecture, but the basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="149f8-121">Varje klient tilldelas en nyckel som identifierar dem i katalogen och som är mappad till platsen för en lämplig databas.</span><span class="sxs-lookup"><span data-stu-id="149f8-121">Each tenant is assigned a key that identifies them in the catalog and which is mapped to the location of the appropriate database.</span></span> <span data-ttu-id="149f8-122">Nyckeln har ett format från en hash av klientens namn i Wingtip SaaS-app.</span><span class="sxs-lookup"><span data-stu-id="149f8-122">In the Wingtip SaaS app, the key is formed from a hash of the tenant’s name.</span></span> <span data-ttu-id="149f8-123">På så sätt kan klienten del av programmets URL som används för att skapa nyckeln.</span><span class="sxs-lookup"><span data-stu-id="149f8-123">This allows the tenant name portion of the application URL to be used to construct the key.</span></span> <span data-ttu-id="149f8-124">Andra viktiga klient-system kan användas.</span><span class="sxs-lookup"><span data-stu-id="149f8-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="149f8-125">Katalogen kan namn eller plats på databasen som ska ändras med minimal påverkan på programmet.</span><span class="sxs-lookup"><span data-stu-id="149f8-125">The catalog allows the name or location of the database to be changed with minimal impact on the application.</span></span>  <span data-ttu-id="149f8-126">I en databasmodell för flera innehavare, detta kan även hantera, flytta' en klient mellan databaser.</span><span class="sxs-lookup"><span data-stu-id="149f8-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="149f8-127">Katalogen kan också användas för att ange om en klient eller databasen är offline för underhåll eller andra åtgärder.</span><span class="sxs-lookup"><span data-stu-id="149f8-127">The catalog can also be used to indicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="149f8-128">Detta är utforskade i den [Återställ enstaka klient kursen](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="149f8-128">This is explored in the [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="149f8-129">Dessutom erbjudas katalog, som är i praktiken en management-databas för ett SaaS-program, kan lagra ytterligare klient eller databasmetadata, till exempel nivå eller utgåva av en databas, schemaversionen, service-plan eller serviceavtal till klienter och annan information som gör att programhantering, kundsupport eller devops-processer.</span><span class="sxs-lookup"><span data-stu-id="149f8-129">In addition, the catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as the tier or edition of a database, schema version, service plan, or SLAs offered to tenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="149f8-130">Katalogen kan aktivera Databasverktyg utöver SaaS-program.</span><span class="sxs-lookup"><span data-stu-id="149f8-130">Beyond the SaaS application, the catalog can enable database tools.</span></span>  <span data-ttu-id="149f8-131">I exemplet Wingtip SaaS katalogen används för att aktivera mellan klient-fråga, utforskade i den [ad hoc-analytics kursen](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="149f8-131">In the Wingtip SaaS sample, the catalog is used to enable cross-tenant query, explored in the [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="149f8-132">Hantering av flera databaser utskriftsjobb utforskade i den [schemat management](sql-database-saas-tutorial-schema-management.md) och [klient analytics](sql-database-saas-tutorial-tenant-analytics.md) självstudier.</span><span class="sxs-lookup"><span data-stu-id="149f8-132">Cross-database job management is explored in the [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="149f8-133">I appen Wingtip SaaS katalogen implementeras med hjälp av Fragmentera hanteringsfunktionerna i den [elastisk databas klienten bibliotek (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="149f8-133">In the Wingtip SaaS app, the catalog is implemented using the Shard Management features of the [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="149f8-134">EDCL kan ett program för att skapa, hantera och använda en databasen har säkerhetskopierats Fragmentera karta.</span><span class="sxs-lookup"><span data-stu-id="149f8-134">The EDCL enables an application to create, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="149f8-135">En Fragmentera-mappning innehåller en lista över delar (databaser) och mappningen mellan nycklar (klienter) och databaser.</span><span class="sxs-lookup"><span data-stu-id="149f8-135">A shard map contains a list of shards (databases) and the mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="149f8-136">EDCL funktioner kan användas från program eller PowerShell-skript under etablering för att skapa poster i kartan Fragmentera klient och program för att effektivt ansluta till rätt databas.</span><span class="sxs-lookup"><span data-stu-id="149f8-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning to create the entries in the shard map, and from applications to efficiently connect to the correct database.</span></span> <span data-ttu-id="149f8-137">EDCL cachelagrar anslutningsinformationen för att minimera trafiken till katalogdatabasen och snabba upp programmet.</span><span class="sxs-lookup"><span data-stu-id="149f8-137">EDCL caches connection information to minimize the traffic to the catalog database and speed up the application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="149f8-138">Mappningsdata är tillgängliga i katalogdatabasen, men *redigera den inte*!</span><span class="sxs-lookup"><span data-stu-id="149f8-138">The mapping data is accessible in the catalog database, but *don't edit it*!</span></span> <span data-ttu-id="149f8-139">Redigera endast mappningsdata med API:er för klientbiblioteket för den elastiska databasen.</span><span class="sxs-lookup"><span data-stu-id="149f8-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="149f8-140">Direkt manipulering av mappningsdatan riskerar att skada katalogen och stöds inte.</span><span class="sxs-lookup"><span data-stu-id="149f8-140">Directly manipulating the mapping data risks corrupting the catalog and is not supported.</span></span>


## <a name="introduction-to-the-saas-provisioning-pattern"></a><span data-ttu-id="149f8-141">Introduktion till mönstret SaaS-etablering</span><span class="sxs-lookup"><span data-stu-id="149f8-141">Introduction to the SaaS Provisioning pattern</span></span>

<span data-ttu-id="149f8-142">När onboarding en ny klient i ett SaaS-program som använder måste en enskild klient databasmodell en ny klient-databas etableras.</span><span class="sxs-lookup"><span data-stu-id="149f8-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="149f8-143">Det måste skapas i rätt plats och tjänstnivån initierats med lämpligt schema och referensdata och registreras sedan på katalogen under lämpliga klientnyckeln.</span><span class="sxs-lookup"><span data-stu-id="149f8-143">It must be created in the appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in the catalog under the appropriate tenant key.</span></span>  

<span data-ttu-id="149f8-144">Olika metoder kan användas till att databasen etablering, som kan omfatta SQL-skript körs, distribution av en bacpac eller kopiera en 'gyllene' mall-databas.</span><span class="sxs-lookup"><span data-stu-id="149f8-144">Different approaches can be used to database provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="149f8-145">Etablering metod du använder måste vara comprehended i din övergripande schemat hanteringsstrategi som skall se till att nya databaser är etablerad med det senaste schemat.</span><span class="sxs-lookup"><span data-stu-id="149f8-145">The provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with the latest schema.</span></span>  <span data-ttu-id="149f8-146">Detta är utforskade i den [schemat management kursen](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="149f8-146">This is explored in the [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="149f8-147">Wingtip SaaS app tillhandahåller nya klienter genom att kopiera en gyllene databas med namnet basetenantdb, distribueras på en katalog-server.</span><span class="sxs-lookup"><span data-stu-id="149f8-147">The Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on the catalog server.</span></span>  <span data-ttu-id="149f8-148">Etablering kan vara integrerat i programmet som en del av en registrering och/eller stöds offline med hjälp av skript.</span><span class="sxs-lookup"><span data-stu-id="149f8-148">Provisioning could be integrated into the application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="149f8-149">Den här självstudiekursen kommer utforska etablering med hjälp av PowerShell.</span><span class="sxs-lookup"><span data-stu-id="149f8-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="149f8-150">Etablering skripten kopiera basetenantdb för att skapa en ny klient-databas i en elastisk pool och sedan initiera med klient-specifik information och registrera det i katalogen Fragmentera kartan.</span><span class="sxs-lookup"><span data-stu-id="149f8-150">The provisioning scripts copy the basetenantdb to create a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in the catalog shard map.</span></span>  <span data-ttu-id="149f8-151">I sample-appen databaser får namn baserat på innehavarens namn, men detta är inte en viktig del av mönstret – med katalogen kan valfritt namn kan tilldelas till databasen. +</span><span class="sxs-lookup"><span data-stu-id="149f8-151">In the sample app, databases are given names based on the tenant name, but this is not a critical part of the pattern – the use of the catalog allows any name to be assigned to the database.+</span></span> 


## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="149f8-152">Hämta Wingtip-programskript</span><span class="sxs-lookup"><span data-stu-id="149f8-152">Get the Wingtip application scripts</span></span>

<span data-ttu-id="149f8-153">Wingtip SaaS-skript och programmets källkod är tillgängliga i den [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github-lagringsplatsen.</span><span class="sxs-lookup"><span data-stu-id="149f8-153">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="149f8-154">[Steg för att hämta Wingtip SaaS-skripten](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="149f8-154">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="149f8-155">Etablera och katalogisera detaljerad genomgång</span><span class="sxs-lookup"><span data-stu-id="149f8-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="149f8-156">Lägg till en brytpunkt och stega igenom arbetsflödet vid etablering av en klient för att förstå hur programmet Wingtip implementerar ny klient etablering:</span><span class="sxs-lookup"><span data-stu-id="149f8-156">To understand how the Wingtip application implements new tenant provisioning, add a breakpoint and step through the workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="149f8-157">Öppna... \\Learning moduler\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ och ange följande parametrar:</span><span class="sxs-lookup"><span data-stu-id="149f8-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set the following parameters:</span></span>
   * <span data-ttu-id="149f8-158">**$TenantName** = namnet på den nya platsen (till exempel *Bushwillow Blues*).</span><span class="sxs-lookup"><span data-stu-id="149f8-158">**$TenantName** = the name of the new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="149f8-159">**$VenueType** = en av de fördefinierade plats typerna: *blått*, classicalmusic, webbsidor, jazz, judo, motorracing, multipurpose, opera, rockmusic, fotboll.</span><span class="sxs-lookup"><span data-stu-id="149f8-159">**$VenueType** = one of the pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="149f8-160">**$DemoScenario** = **1**, inställd på **1** till *etablera en enskild klient*.</span><span class="sxs-lookup"><span data-stu-id="149f8-160">**$DemoScenario** = **1**, Set to **1** to *Provision a single tenant*.</span></span>

1. <span data-ttu-id="149f8-161">Lägga till en brytpunkt genom att placera markören på raden 48, raden: *ny klient '*, och tryck på **F9**.</span><span class="sxs-lookup"><span data-stu-id="149f8-161">Add a breakpoint by putting your cursor anywhere on line 48, the line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![brytpunkt](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="149f8-163">Att köra skriptet tryck **F5**.</span><span class="sxs-lookup"><span data-stu-id="149f8-163">To run the script press **F5**.</span></span>

1. <span data-ttu-id="149f8-164">Körningen av skriptet slutar vid brytpunkten, tryck på **F11** till steg i koden.</span><span class="sxs-lookup"><span data-stu-id="149f8-164">After the script execution stops at the breakpoint, press **F11** to step into the code.</span></span>

   ![brytpunkt](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="149f8-166">Spåra körning av skript med hjälp av den **felsöka** menyalternativen - **F10** och **F11** till steg via eller som kallas funktioner.</span><span class="sxs-lookup"><span data-stu-id="149f8-166">Trace the script's execution using the **Debug** menu options - **F10** and **F11** to step over or into the called functions.</span></span> <span data-ttu-id="149f8-167">Mer information om felsökning av PowerShell-skript finns [Tips om att arbeta med och felsöka PowerShell-skript](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="149f8-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="149f8-168">Följande är inte steg att följa explicit, men en förklaring av arbetsflöde du steg för steg när du felsöker skriptet:</span><span class="sxs-lookup"><span data-stu-id="149f8-168">The following are not steps to explicitly follow, but an explanation of the workflow you step through while debugging the script:</span></span>

1. <span data-ttu-id="149f8-169">**Importera modulen SubscriptionManagement.psm1** vilken innehåller funktioner för att logga in på Azure och markera den Azure-prenumeration du arbetar med.</span><span class="sxs-lookup"><span data-stu-id="149f8-169">**Import the SubscriptionManagement.psm1** module that contains functions for signing in to Azure and selecting the Azure subscription you are working with.</span></span>
1. <span data-ttu-id="149f8-170">**Importera modulen CatalogAndDatabaseManagement.psm1** vilken tillhandahåller en abstraktion på katalog- och klientnivå över [fragmenthanterings](sql-database-elastic-scale-shard-map-management.md)-funktionerna.</span><span class="sxs-lookup"><span data-stu-id="149f8-170">**Import the CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over the [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="149f8-171">Det här är en viktig modul som innehåller en stor del av katalogmönstret och är värd att utforska.</span><span class="sxs-lookup"><span data-stu-id="149f8-171">This is an important module that encapsulates much of the catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="149f8-172">**Hämta konfigurationsinformationen**.</span><span class="sxs-lookup"><span data-stu-id="149f8-172">**Get configuration details**.</span></span> <span data-ttu-id="149f8-173">Gå till Get-konfiguration (med F11) och se hur programmets konfiguration har angetts.</span><span class="sxs-lookup"><span data-stu-id="149f8-173">Step into Get-Configuration (with F11) and see how the app config is specified.</span></span> <span data-ttu-id="149f8-174">Resursnamn och andra appspecifika värden definieras här, men ändra inte några av värdena innan du bekantat dig med skriptet.</span><span class="sxs-lookup"><span data-stu-id="149f8-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with the scripts.</span></span>
1. <span data-ttu-id="149f8-175">**Hämta katalogobjektet**.</span><span class="sxs-lookup"><span data-stu-id="149f8-175">**Get the catalog object**.</span></span> <span data-ttu-id="149f8-176">Gå till Get-katalog composes och returnerar ett objekt i katalogen som används i skriptet på högre nivå.</span><span class="sxs-lookup"><span data-stu-id="149f8-176">Step into Get-Catalog which composes and returns a catalog object that is used in the higher-level script.</span></span>  <span data-ttu-id="149f8-177">Den här funktionen används Fragmentera hanteringsfunktioner som importeras från **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="149f8-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="149f8-178">Katalogobjektet består av följande:</span><span class="sxs-lookup"><span data-stu-id="149f8-178">The catalog object is composed of the following:</span></span>
   * <span data-ttu-id="149f8-179">$catalogServerFullyQualifiedName konstrueras med standardstammen plus ditt användarnamn: _catalog-\<användare\>.database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="149f8-179">$catalogServerFullyQualifiedName is constructed using the standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="149f8-180">$catalogDatabaseName hämtas från konfigurationen: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="149f8-180">$catalogDatabaseName is retrieved from the config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="149f8-181">$shardMapManager-objektet initieras från katalogdatabasen.</span><span class="sxs-lookup"><span data-stu-id="149f8-181">$shardMapManager object is initialized from the catalog database.</span></span>
   * <span data-ttu-id="149f8-182">$shardMap-objektet initieras från fragmentkartan *tenantcatalog* i katalogdatabasen.</span><span class="sxs-lookup"><span data-stu-id="149f8-182">$shardMap object is initialized from the *tenantcatalog* shard map in the catalog database.</span></span>
   <span data-ttu-id="149f8-183">Ett katalogobjekt skapas och returneras för att sedan användas i skriptet på högre nivå.</span><span class="sxs-lookup"><span data-stu-id="149f8-183">A catalog object is composed and returned, and used in the higher-level script.</span></span>
1. <span data-ttu-id="149f8-184">**Beräkna den nya klientnyckeln**.</span><span class="sxs-lookup"><span data-stu-id="149f8-184">**Calculate the new tenant key**.</span></span> <span data-ttu-id="149f8-185">En hash-funktion används för att skapa klientnyckeln från klientnamnet.</span><span class="sxs-lookup"><span data-stu-id="149f8-185">A hash function is used to create the tenant key from the tenant name.</span></span>
1. <span data-ttu-id="149f8-186">**Kontrollera om klientnyckeln redan finns**.</span><span class="sxs-lookup"><span data-stu-id="149f8-186">**Check if the tenant key already exists**.</span></span> <span data-ttu-id="149f8-187">Katalogen kontrolleras för att försäkra om att nyckeln är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="149f8-187">The catalog is checked to ensure the key is available.</span></span>
1. <span data-ttu-id="149f8-188">**Klientdatabasen etableras med New-TenantDatabase.**</span><span class="sxs-lookup"><span data-stu-id="149f8-188">**The tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="149f8-189">Använd **F11** till steg och se hur databasen är etablerats med hjälp av en [Azure Resource Manager-mall](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="149f8-189">Use **F11** to step in and see how the database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="149f8-190">Databasnamnet skapas från klientnamnet för att klargöra vilket fragment som tillhör vilken klient.</span><span class="sxs-lookup"><span data-stu-id="149f8-190">The database name is constructed from the tenant name to make it clear which shard belongs to which tenant.</span></span> <span data-ttu-id="149f8-191">(Andra strategier för namngivning av databasen enkelt kunde användas.) + En Resource Manager-mall används för att skapa en klient-databas genom att kopiera en gyllene databas (baseTenantDB) på katalogservern.</span><span class="sxs-lookup"><span data-stu-id="149f8-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used to create a tenant database by copying a golden database (baseTenantDB) on the catalog server.</span></span> <span data-ttu-id="149f8-192">En annan metod kan vara att skapa en tom databas och sedan starta den genom att importera en bacpac eller köra ett Initieringsskript för från en känd plats.</span><span class="sxs-lookup"><span data-stu-id="149f8-192">An alternative approach could be to create an empty database and then initialize it by importing a bacpac, or to execute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="149f8-193">Resource Manager-mallen finns i mappen ...\Learning Modules\Common\: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="149f8-193">The Resource Manager template is in the …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="149f8-194">När klient-databasen har skapats, är det sedan ytterligare **initieras med namnet på platsen (klient) och vilken plats**.</span><span class="sxs-lookup"><span data-stu-id="149f8-194">After the tenant database is created, it is then further **initialized with the venue (tenant) name and the venue type**.</span></span> <span data-ttu-id="149f8-195">Övrig initialisering kan också göras här.</span><span class="sxs-lookup"><span data-stu-id="149f8-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="149f8-196">Den **databas för klienten har registrerats i katalogen** med *Lägg till TenantDatabaseToCatalog* med hjälp av klientnyckeln.</span><span class="sxs-lookup"><span data-stu-id="149f8-196">The **tenant database is registered in the catalog** with *Add-TenantDatabaseToCatalog* using the tenant key.</span></span> <span data-ttu-id="149f8-197">Använd **F11** för att stega in i detaljerna:</span><span class="sxs-lookup"><span data-stu-id="149f8-197">Use **F11** to step into the details:</span></span>

* <span data-ttu-id="149f8-198">Katalogdatabasen läggs till i fragmentkartan (listan över kända databaser).</span><span class="sxs-lookup"><span data-stu-id="149f8-198">The catalog database is added to the shard map (the list of known databases).</span></span>
* <span data-ttu-id="149f8-199">Mappningen som länkar nyckelvärdet till fragmentet skapas.</span><span class="sxs-lookup"><span data-stu-id="149f8-199">The mapping that links the key value to the shard is created.</span></span>
* <span data-ttu-id="149f8-200">Ytterligare metadata (namn på den platsen) om klienten har lagts till tabellen hyresgäster i katalogen.</span><span class="sxs-lookup"><span data-stu-id="149f8-200">Additional meta data (the venue's name) about the tenant is added to the Tenants table in the catalog.</span></span>  <span data-ttu-id="149f8-201">Tabellen klienter är inte en del av ShardManagement schema och installeras inte som EDCL.</span><span class="sxs-lookup"><span data-stu-id="149f8-201">The Tenants table is not part of the ShardManagement schema and is not installed by the EDCL.</span></span>  <span data-ttu-id="149f8-202">I följande tabell visas hur databasen katalog kan utökas för att stödja ytterligare programspecifika data.</span><span class="sxs-lookup"><span data-stu-id="149f8-202">This table illustrates how the Catalog database can be extended to support additional application-specific data.</span></span>   


<span data-ttu-id="149f8-203">När etableringen är klar körning returnerar till ursprungligt *Demo-ProvisionAndCatalog* skript, vilket öppnar den **händelser** för den nya innehavaren i webbläsaren:</span><span class="sxs-lookup"><span data-stu-id="149f8-203">After provisioning completes, execution returns to the original *Demo-ProvisionAndCatalog* script, which opens the **Events** page for the new tenant in the browser:</span></span>

   ![evenemang](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="149f8-205">Etablera en grupp med klienter</span><span class="sxs-lookup"><span data-stu-id="149f8-205">Provision a batch of tenants</span></span>

<span data-ttu-id="149f8-206">Den här övningen etablerar en batch med 17 innehavare.</span><span class="sxs-lookup"><span data-stu-id="149f8-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="149f8-207">Det rekommenderas att du etablerar den här gruppen med klienter innan du startar andra Wingtip SaaS-självstudier, så det finns fler än några databaser du arbetar med.</span><span class="sxs-lookup"><span data-stu-id="149f8-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases to work with.</span></span>

1. <span data-ttu-id="149f8-208">Öppna... \\Learning moduler\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* i den *PowerShell ISE* och ändra den *$ DemoScenario* parameter till 3:</span><span class="sxs-lookup"><span data-stu-id="149f8-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in the *PowerShell ISE* and change the *$DemoScenario* parameter to 3:</span></span>
   * <span data-ttu-id="149f8-209">**$DemoScenario** = **3**, ändra till **3** till *etablera en grupp med klienter*.</span><span class="sxs-lookup"><span data-stu-id="149f8-209">**$DemoScenario** = **3**, change to **3** to *Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="149f8-210">Tryck på **F5** och kör skriptet.</span><span class="sxs-lookup"><span data-stu-id="149f8-210">Press **F5** and run the script.</span></span>

<span data-ttu-id="149f8-211">Skriptet etablerar en batch med ytterligare klienter.</span><span class="sxs-lookup"><span data-stu-id="149f8-211">The script deploys a batch of additional tenants.</span></span> <span data-ttu-id="149f8-212">Den använder en [Azure Resource Manager-mall](../azure-resource-manager/resource-manager-template-walkthrough.md) som styr batchen och sedan delegerar etableringen av varje databas till en länkad mall.</span><span class="sxs-lookup"><span data-stu-id="149f8-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls the batch and then delegates provisioning of each database to a linked template.</span></span> <span data-ttu-id="149f8-213">Om du använder mallar på det här sättet, kan Azure Resource Manager mäkla etableringsprocessen för ditt skript.</span><span class="sxs-lookup"><span data-stu-id="149f8-213">Using templates in this way allows Azure Resource Manager to broker the provisioning process for your script.</span></span> <span data-ttu-id="149f8-214">Mallar etablerar databaser parallellt när det går och hanterar omförsök vid behov, vilket optimerar processen.</span><span class="sxs-lookup"><span data-stu-id="149f8-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing the overall process.</span></span> <span data-ttu-id="149f8-215">Skriptet är idempotent så om den misslyckas eller avbryts av någon anledning, kör det igen.</span><span class="sxs-lookup"><span data-stu-id="149f8-215">The script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-the-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="149f8-216">Verifiera att batchen med klienter etablerades</span><span class="sxs-lookup"><span data-stu-id="149f8-216">Verify the batch of tenants successfully deployed</span></span>

* <span data-ttu-id="149f8-217">Öppna den *tenants1* servern genom att bläddra i listan över servrar i den [Azure-portalen](https://portal.azure.com), klickar du på **SQL-databaser**, och verifiera batch 17 nya databaser är nu i den lista:</span><span class="sxs-lookup"><span data-stu-id="149f8-217">Open the *tenants1* server by browsing to your list of servers in the [Azure portal](https://portal.azure.com), click **SQL databases**, and verify the batch of 17 additional databases are now in the list:</span></span>

   ![databaslista](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="149f8-219">Andra etableringsmönster</span><span class="sxs-lookup"><span data-stu-id="149f8-219">Other provisioning patterns</span></span>

<span data-ttu-id="149f8-220">Andra etableringsmönster som inte ingår i den här guiden inkluderar:</span><span class="sxs-lookup"><span data-stu-id="149f8-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="149f8-221">**Företablering av databaser.**</span><span class="sxs-lookup"><span data-stu-id="149f8-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="149f8-222">Före etablering mönstret utnyttjar det faktum att databaser i en elastisk pool inte Lägg till extra kostnad.</span><span class="sxs-lookup"><span data-stu-id="149f8-222">The pre-provisioning pattern exploits the fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="149f8-223">Faktureringen är för den elastiska poolen inte databaser och inaktiv databaser förbrukar några resurser.</span><span class="sxs-lookup"><span data-stu-id="149f8-223">Billing is for the elastic pool, not the databases, and idle databases consume no resources.</span></span> <span data-ttu-id="149f8-224">Genom före etablering databaser i poolen och tilldela dem vid behov, minskas tid för klient onboarding avsevärt.</span><span class="sxs-lookup"><span data-stu-id="149f8-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="149f8-225">Antalet företablerade databaser kan justeras efter behov för att ha en buffert som är lämplig för den förväntade etableringstakten.</span><span class="sxs-lookup"><span data-stu-id="149f8-225">The number of databases pre-provisioned could be adjusted as needed to keep a buffer suitable for the anticipated provisioning rate.</span></span>

<span data-ttu-id="149f8-226">**Automatisk etablering.**</span><span class="sxs-lookup"><span data-stu-id="149f8-226">**Auto-provisioning.**</span></span> <span data-ttu-id="149f8-227">I mönstret Automatisk etablering används en dedikerad etablering tjänst för att etablera servrar, pooler och databaserna automatiskt vid behov – inklusive före etablering databaser i elastiska pooler om så önskas.</span><span class="sxs-lookup"><span data-stu-id="149f8-227">In the auto-provisioning pattern, a dedicated provisioning service is used to provision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="149f8-228">Om databaserna därefter tas ur drift och tas bort, kan luckorna i de elastiska poolerna fyllas av etableringstjänsten efter behov.</span><span class="sxs-lookup"><span data-stu-id="149f8-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by the provisioning service as desired.</span></span> <span data-ttu-id="149f8-229">Dessa tjänster kan vara enkla eller avancerade – till exempel hantera etablering över flera områden, och kan ställa in geo-replikering automatiskt om den strategin som används för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="149f8-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="149f8-230">Med mönstret för automatisk etablering, skickar ett klientprogram eller ett skript in en etableringsbegäran till en kö för att behandlas av etableringstjänsten och frågar sedan tjänsten för att avgöra när det slutförts.</span><span class="sxs-lookup"><span data-stu-id="149f8-230">With the auto-provisioning pattern, a client application or script would submit a provisioning request to a queue to be processed by the provisioning service, and would then poll the service to determine completion.</span></span> <span data-ttu-id="149f8-231">Om företablering används, hanteras begäranden snabbt när tjänsten hanterar etableringen av en ersättningsdatabas som körs i bakgrunden.</span><span class="sxs-lookup"><span data-stu-id="149f8-231">If pre-provisioning is used, requests would be handled quickly with the service managing provisioning of a replacement database running in the background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="149f8-232">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="149f8-232">Next steps</span></span>

<span data-ttu-id="149f8-233">I den här guiden lärde du dig hur man:</span><span class="sxs-lookup"><span data-stu-id="149f8-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="149f8-234">Etablera en enskild ny klient</span><span class="sxs-lookup"><span data-stu-id="149f8-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="149f8-235">Etablera en batch med ytterligare klienter</span><span class="sxs-lookup"><span data-stu-id="149f8-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="149f8-236">Gå till information om etablering klienter och registrera dem till katalogen</span><span class="sxs-lookup"><span data-stu-id="149f8-236">Step into the details of provisioning tenants, and registering them into the catalog</span></span>

<span data-ttu-id="149f8-237">Försök i [prestanda övervakning kursen](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="149f8-237">Try the [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="149f8-238">Ytterligare resurser</span><span class="sxs-lookup"><span data-stu-id="149f8-238">Additional Resources</span></span>

* <span data-ttu-id="149f8-239">Ytterligare [självstudier som bygger på Wingtip SaaS-program](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="149f8-239">Additional [tutorials that build upon the Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="149f8-240">Klientbibliotek för elastiska databaser</span><span class="sxs-lookup"><span data-stu-id="149f8-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="149f8-241">Felsök skript i Windows PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="149f8-241">How to Debug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
