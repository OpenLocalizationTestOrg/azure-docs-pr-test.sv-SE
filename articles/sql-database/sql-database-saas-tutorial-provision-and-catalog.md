---
title: "aaaProvision nya klienter i en app för flera innehavare som använder Azure SQL Database | Microsoft Docs"
description: "Lär dig hur tooprovision och katalogen nya hyresgäster i hello Wingtip SaaS-app"
keywords: sql database tutorial
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="1a70b-104">Etablera nya klienter och registrerar dem i hello-katalogen</span><span class="sxs-lookup"><span data-stu-id="1a70b-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="1a70b-105">I kursen får du lära dig om hello etablera och katalogen SaaS mönster och hur de implementeras i hello Wingtip SaaS-program.</span><span class="sxs-lookup"><span data-stu-id="1a70b-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="1a70b-106">Skapa och initiera den nya innehavaren databaser och registrerar dem i hello programmets klient-katalogen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="1a70b-107">hello katalog är en databas som underhåller hello mappning mellan hello SaaS programmet många klienter och deras data.</span><span class="sxs-lookup"><span data-stu-id="1a70b-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="1a70b-108">hello katalog spelar en viktig roll dirigera begäranden toohello rätt databas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="1a70b-109">I den här guiden får du lära dig hur man:</span><span class="sxs-lookup"><span data-stu-id="1a70b-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1a70b-110">Etablera en enda ny klient, inklusive stega igenom hur detta implementeras</span><span class="sxs-lookup"><span data-stu-id="1a70b-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="1a70b-111">Etablera en batch med ytterligare klienter</span><span class="sxs-lookup"><span data-stu-id="1a70b-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="1a70b-112">den här självstudiekursen, se till att hello följande krav är slutförda toocomplete:</span><span class="sxs-lookup"><span data-stu-id="1a70b-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="1a70b-113">hello Wingtip SaaS appen har distribuerats.</span><span class="sxs-lookup"><span data-stu-id="1a70b-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="1a70b-114">toodeploy på mindre än fem minuter finns [distribuera och utforska hello Wingtip SaaS-program](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="1a70b-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="1a70b-115">Azure PowerShell ska ha installerats.</span><span class="sxs-lookup"><span data-stu-id="1a70b-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="1a70b-116">Mer information finns i [Komma igång med Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="1a70b-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="1a70b-117">Introduktion toohello SaaS katalog mönster</span><span class="sxs-lookup"><span data-stu-id="1a70b-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="1a70b-118">Det är viktigt tooknow där information för varje klient lagras i ett databasen har säkerhetskopierats flera innehavare SaaS-program.</span><span class="sxs-lookup"><span data-stu-id="1a70b-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="1a70b-119">En katalog-databas är används toohold hello mappning mellan varje klient och där deras data lagras i hello SaaS mönster för katalogen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="1a70b-120">hello Wingtip SaaS appen använder en enskild klient per databas arkitektur, men hello grundläggande mönster för lagring av mappning för klient-till-databasen i en katalog som gäller om en eller flera single-klient databas används.</span><span class="sxs-lookup"><span data-stu-id="1a70b-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="1a70b-121">Varje klient tilldelas en nyckel som identifierar dem i hello-katalogen och som är mappad toohello platsen för hello lämplig databas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="1a70b-122">I hello Wingtip SaaS app format hello nyckel från en hash av hello innehavarens namn.</span><span class="sxs-lookup"><span data-stu-id="1a70b-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="1a70b-123">Detta gör att hello klient del av hello programmet URL toobe används tooconstruct hello nyckel.</span><span class="sxs-lookup"><span data-stu-id="1a70b-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="1a70b-124">Andra viktiga klient-system kan användas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="1a70b-125">hello katalog kan hello namnet eller platsen för hello databasen toobe ändras med minimal påverkan på hello program.</span><span class="sxs-lookup"><span data-stu-id="1a70b-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="1a70b-126">I en databasmodell för flera innehavare, detta kan även hantera, flytta' en klient mellan databaser.</span><span class="sxs-lookup"><span data-stu-id="1a70b-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="1a70b-127">hello katalogen kan också vara används tooindicate om en klient eller databasen är offline för underhåll eller andra åtgärder.</span><span class="sxs-lookup"><span data-stu-id="1a70b-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="1a70b-128">Detta är utforskade i hello [Återställ enstaka klient kursen](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="1a70b-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="1a70b-129">Dessutom hello katalog, som är i praktiken en management-databas för ett SaaS-program, kan lagra ytterligare klient eller databasen metadata, till exempel hello nivå eller utgåva av en databas, schemaversionen, service-plan eller serviceavtal erbjuds tootenants och annan information som aktiverar programhantering, kundsupport eller devops-processer.</span><span class="sxs-lookup"><span data-stu-id="1a70b-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="1a70b-130">Hello katalog kan aktivera Databasverktyg utöver hello SaaS-program.</span><span class="sxs-lookup"><span data-stu-id="1a70b-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="1a70b-131">I exemplet Wingtip SaaS hello hello katalog är används tooenable mellan klient-fråga som utforskade i hello [ad hoc-analytics kursen](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="1a70b-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="1a70b-132">Hantering av flera databaser utskriftsjobb utforskade i hello [schemat management](sql-database-saas-tutorial-schema-management.md) och [klient analytics](sql-database-saas-tutorial-tenant-analytics.md) självstudier.</span><span class="sxs-lookup"><span data-stu-id="1a70b-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="1a70b-133">I hello Wingtip SaaS app hello katalog implementeras med hjälp av hello Fragmentera hanteringsfunktionerna i hello [elastisk databas klienten bibliotek (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="1a70b-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="1a70b-134">Hej EDCL gör det möjligt för ett program toocreate, hantera och använda en databasen har säkerhetskopierats Fragmentera karta.</span><span class="sxs-lookup"><span data-stu-id="1a70b-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="1a70b-135">En Fragmentera-mappning innehåller en lista över delar (databaser) och hello mappning mellan nycklar (klienter) och databaser.</span><span class="sxs-lookup"><span data-stu-id="1a70b-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="1a70b-136">EDCL funktioner kan användas under klientorganisationens Etableringsläge toocreate hello poster i hello Fragmentera mappning från program eller PowerShell-skript och program tooefficiently ansluter toohello rätt databas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="1a70b-137">EDCL cachelagras information toominimize hello trafik toohello katalog databas och snabba upp hello program.</span><span class="sxs-lookup"><span data-stu-id="1a70b-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="1a70b-138">hello mappningsdata är tillgängliga i hello katalogdatabasen men *inte redigera den*!</span><span class="sxs-lookup"><span data-stu-id="1a70b-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="1a70b-139">Redigera endast mappningsdata med API:er för klientbiblioteket för den elastiska databasen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="1a70b-140">Direkt manipulering hello mappade data risker skadas hello-katalogen och stöds inte.</span><span class="sxs-lookup"><span data-stu-id="1a70b-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="1a70b-141">Introduktion toohello SaaS etablering mönster</span><span class="sxs-lookup"><span data-stu-id="1a70b-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="1a70b-142">När onboarding en ny klient i ett SaaS-program som använder måste en enskild klient databasmodell en ny klient-databas etableras.</span><span class="sxs-lookup"><span data-stu-id="1a70b-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="1a70b-143">Det måste skapas i hello lämplig plats och tjänstnivån initieras med lämpligt schema- och data och registreras sedan på hello-katalogen under hello lämpliga klientnyckel.</span><span class="sxs-lookup"><span data-stu-id="1a70b-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="1a70b-144">Olika strategier kan vara används toodatabase etablering, vilket kan omfatta SQL-skript körs, distribuera en bacpac, eller kopiera en 'gyllene' mall-databas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="1a70b-145">hello etablerar du anger måste vara comprehended i din övergripande schemat hanteringsstrategi som skall se till att nya databaser är etablerad med hello senaste schema.</span><span class="sxs-lookup"><span data-stu-id="1a70b-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="1a70b-146">Detta är utforskade i hello [schemat management kursen](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="1a70b-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="1a70b-147">hello Wingtip SaaS app tillhandahåller nya klienter genom att kopiera en gyllene databas med namnet basetenantdb som distribuerats på hello katalogserver.</span><span class="sxs-lookup"><span data-stu-id="1a70b-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="1a70b-148">Etablering kan vara integrerade i hello programmet som en del av en registrering och/eller stöds offline med hjälp av skript.</span><span class="sxs-lookup"><span data-stu-id="1a70b-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="1a70b-149">Den här självstudiekursen kommer utforska etablering med hjälp av PowerShell.</span><span class="sxs-lookup"><span data-stu-id="1a70b-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="1a70b-150">hello etablering skript kopiera hello basetenantdb toocreate en ny klient-databas i en elastisk pool och sedan initiera med klient-specifik information och registrera det i hello katalog Fragmentera kartan.</span><span class="sxs-lookup"><span data-stu-id="1a70b-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="1a70b-151">I hello exempelapp databaser ges namn baserat på hello-klient, men detta är inte en viktig del av hello mönster – hello med hello katalog kan någon databas med namnet toobe som tilldelats toohello. +</span><span class="sxs-lookup"><span data-stu-id="1a70b-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="1a70b-152">Hämta hello Wingtip programskript</span><span class="sxs-lookup"><span data-stu-id="1a70b-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="1a70b-153">hello Wingtip SaaS-skript och programmets källkod är tillgängliga i hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github-lagringsplatsen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="1a70b-154">[Steg toodownload hello Wingtip SaaS skript](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="1a70b-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="1a70b-155">Etablera och katalogisera detaljerad genomgång</span><span class="sxs-lookup"><span data-stu-id="1a70b-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="1a70b-156">toounderstand hur hello Wingtip programmet innehåller ny klient etablering, lägga till en brytpunkt och gå igenom hello arbetsflöde vid etablering av en klient:</span><span class="sxs-lookup"><span data-stu-id="1a70b-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="1a70b-157">Öppna... \\Learning moduler\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ och ange hello följande parametrar:</span><span class="sxs-lookup"><span data-stu-id="1a70b-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="1a70b-158">**$TenantName** = hello namnet på hello ny plats (till exempel *Bushwillow blått*).</span><span class="sxs-lookup"><span data-stu-id="1a70b-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="1a70b-159">**$VenueType** = hello fördefinierade platsen typer: *blått*, classicalmusic, webbsidor, jazz, judo, motorracing, multipurpose, opera, rockmusic, fotboll.</span><span class="sxs-lookup"><span data-stu-id="1a70b-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="1a70b-160">**$DemoScenario** = **1**, Ställ in för**1** för*etablera en enskild klient*.</span><span class="sxs-lookup"><span data-stu-id="1a70b-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="1a70b-161">Lägga till en brytpunkt genom att placera markören på raden 48, hello raden: *ny klient '*, och tryck på **F9**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![brytpunkt](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="1a70b-163">Tryck på toorun hello-skript **F5**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="1a70b-164">När hello skriptkörningen slutar vid hello brytpunkt, trycker du på **F11** toostep till hello kod.</span><span class="sxs-lookup"><span data-stu-id="1a70b-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![brytpunkt](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="1a70b-166">Spåra körning av hello skript med hjälp av hello **felsöka** menyalternativen - **F10** och **F11** toostep via eller i hello kallas för funktioner.</span><span class="sxs-lookup"><span data-stu-id="1a70b-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="1a70b-167">Mer information om felsökning av PowerShell-skript finns [Tips om att arbeta med och felsöka PowerShell-skript](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="1a70b-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="1a70b-168">hello följande är inte tooexplicitly följer stegen, men en förklaring av hello arbetsflöde du steg för steg när du felsöker hello skript:</span><span class="sxs-lookup"><span data-stu-id="1a70b-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="1a70b-169">**Importera hello SubscriptionManagement.psm1** modul som innehåller funktioner för att logga in tooAzure och markera hello Azure-prenumeration du arbetar med.</span><span class="sxs-lookup"><span data-stu-id="1a70b-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="1a70b-170">**Importera hello CatalogAndDatabaseManagement.psm1** modul som tillhandahåller en katalog och klient-nivå abstraction över hello [Fragmentera Management](sql-database-elastic-scale-shard-map-management.md) funktioner.</span><span class="sxs-lookup"><span data-stu-id="1a70b-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="1a70b-171">Detta är ett viktigt modul som kapslar in mycket hello katalog mönster och är värt att utforska.</span><span class="sxs-lookup"><span data-stu-id="1a70b-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="1a70b-172">**Hämta konfigurationsinformationen**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-172">**Get configuration details**.</span></span> <span data-ttu-id="1a70b-173">Gå till Get-konfiguration (med F11) och se hur hello programmets konfiguration har angetts.</span><span class="sxs-lookup"><span data-stu-id="1a70b-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="1a70b-174">Resursnamn och andra app-specifik värden definieras här, men ändra inte dessa värden tills du är bekant med hello skript.</span><span class="sxs-lookup"><span data-stu-id="1a70b-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="1a70b-175">**Hämta hello katalogobjektet**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-175">**Get hello catalog object**.</span></span> <span data-ttu-id="1a70b-176">Gå till Get-katalog composes och returnerar ett objekt i katalogen som används i hello på högre nivå skript.</span><span class="sxs-lookup"><span data-stu-id="1a70b-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="1a70b-177">Den här funktionen används Fragmentera hanteringsfunktioner som importeras från **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="1a70b-178">hello katalogobjektet består av hello följande:</span><span class="sxs-lookup"><span data-stu-id="1a70b-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="1a70b-179">$catalogServerFullyQualifiedName konstrueras hello standard stam plus ditt användarnamn: _katalog -\<användare\>. database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="1a70b-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="1a70b-180">$catalogDatabaseName hämtas från hello config: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="1a70b-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="1a70b-181">$shardMapManager objektet har initierats från hello katalog-databasen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="1a70b-182">$shardMap-objektet har initierats från hello *tenantcatalog* Fragmentera kartan i hello katalogdatabasen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="1a70b-183">Ett objekt i katalogen är består returnerade och i hello på högre nivå skript.</span><span class="sxs-lookup"><span data-stu-id="1a70b-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="1a70b-184">**Beräkna hello nya klientnyckel**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="1a70b-185">En hash-funktionen är används toocreate hello klientnyckel från hello innehavarens namn.</span><span class="sxs-lookup"><span data-stu-id="1a70b-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="1a70b-186">**Kontrollera om det redan finns hello klientnyckel**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="1a70b-187">hello katalogen kontrolleras tooensure hello nyckeln är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="1a70b-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="1a70b-188">**hello klient databasen har etablerats med ny TenantDatabase.**</span><span class="sxs-lookup"><span data-stu-id="1a70b-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="1a70b-189">Använd **F11** toostep i och se hur hello databasen är etablerats med hjälp av en [Azure Resource Manager-mall](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="1a70b-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="1a70b-190">hello databasnamnet konstrueras utifrån hello klient namnet toomake den avmarkera vilka Fragmentera tillhör toowhich klient.</span><span class="sxs-lookup"><span data-stu-id="1a70b-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="1a70b-191">(Andra strategier för namngivning av databasen enkelt kunde användas.) + En Resource Manager-mall är används toocreate en klient-databas genom att kopiera en gyllene databas (baseTenantDB) på hello katalogserver.</span><span class="sxs-lookup"><span data-stu-id="1a70b-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="1a70b-192">En annan metod kan vara en tom databas för toocreate och sedan starta den genom att importera en bacpac eller tooexecute en Initieringsskript från en känd plats.</span><span class="sxs-lookup"><span data-stu-id="1a70b-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="1a70b-193">hello Resource Manager-mall finns i hello ...\Learning Modules\Common\ mapp: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="1a70b-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="1a70b-194">När hello klient-databasen har skapats är det sedan ytterligare **initieras med hello plats (klient) namn och typ för hello platsen**.</span><span class="sxs-lookup"><span data-stu-id="1a70b-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="1a70b-195">Övrig initialisering kan också göras här.</span><span class="sxs-lookup"><span data-stu-id="1a70b-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="1a70b-196">Hej **klient databas har registrerats i katalogen hello** med *Lägg till TenantDatabaseToCatalog* använder hello klientnyckel.</span><span class="sxs-lookup"><span data-stu-id="1a70b-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="1a70b-197">Använd **F11** toostep hello detaljer:</span><span class="sxs-lookup"><span data-stu-id="1a70b-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="1a70b-198">hello katalog databas läggs toohello Fragmentera karta (hello lista över kända databaser).</span><span class="sxs-lookup"><span data-stu-id="1a70b-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="1a70b-199">hello mappning som länkar hello nyckelvärdet toohello Fragmentera skapas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="1a70b-200">Ytterligare metadata (namn hello platsen) om hello klienten läggs toohello hyresgäster tabellen i hello-katalogen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="1a70b-201">hello hyresgäster tabellen ingår inte i hello ShardManagement schema och installeras inte som hello EDCL.</span><span class="sxs-lookup"><span data-stu-id="1a70b-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="1a70b-202">I följande tabell visas hur hello katalogdatabasen kan utökas toosupport ytterligare programspecifika data.</span><span class="sxs-lookup"><span data-stu-id="1a70b-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="1a70b-203">När etableringen är klar körning returnerar toohello ursprungliga *Demo-ProvisionAndCatalog* skript, vilket öppnar hello **händelser** sidan för hello ny klient i hello webbläsare:</span><span class="sxs-lookup"><span data-stu-id="1a70b-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![evenemang](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="1a70b-205">Etablera en grupp med klienter</span><span class="sxs-lookup"><span data-stu-id="1a70b-205">Provision a batch of tenants</span></span>

<span data-ttu-id="1a70b-206">Den här övningen etablerar en batch med 17 innehavare.</span><span class="sxs-lookup"><span data-stu-id="1a70b-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="1a70b-207">Det rekommenderas att du etablerar den här gruppen med klienter innan du startar andra Wingtip SaaS-självstudier, så det finns fler än några databaser toowork med.</span><span class="sxs-lookup"><span data-stu-id="1a70b-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="1a70b-208">Öppna... \\Learning moduler\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* i hello *PowerShell ISE* och ändra hello *$ DemoScenario* parametern too3:</span><span class="sxs-lookup"><span data-stu-id="1a70b-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="1a70b-209">**$DemoScenario** = **3**, ändra också**3** för*etablera en grupp med klienter*.</span><span class="sxs-lookup"><span data-stu-id="1a70b-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="1a70b-210">Tryck på **F5** och kör hello-skript.</span><span class="sxs-lookup"><span data-stu-id="1a70b-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="1a70b-211">hello skript distribuerar en batch med ytterligare klienter.</span><span class="sxs-lookup"><span data-stu-id="1a70b-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="1a70b-212">Den använder en [Azure Resource Manager-mall](../azure-resource-manager/resource-manager-template-walkthrough.md) som styr hello batch och sedan delegerar etablering av varje databas tooa länkade mall.</span><span class="sxs-lookup"><span data-stu-id="1a70b-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="1a70b-213">Med hjälp av mallar på så sätt kan Azure Resource Manager toobroker hello etableringsprocessen för skriptet.</span><span class="sxs-lookup"><span data-stu-id="1a70b-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="1a70b-214">Mallar etablera databaser parallellt där den kan och hanterar försök om det behövs, optimera hello övergripande processer.</span><span class="sxs-lookup"><span data-stu-id="1a70b-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="1a70b-215">Hej skriptet idempotent så om den misslyckas eller avbryts av någon anledning, körs det igen.</span><span class="sxs-lookup"><span data-stu-id="1a70b-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="1a70b-216">Kontrollera hello grupp med klienter som har distribuerats</span><span class="sxs-lookup"><span data-stu-id="1a70b-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="1a70b-217">Öppna hello *tenants1* servern genom att bläddra tooyour listan över servrar i hello [Azure-portalen](https://portal.azure.com), klickar du på **SQL-databaser**, och kontrollera hello batch 17 nya databaser är nu i listan hello:</span><span class="sxs-lookup"><span data-stu-id="1a70b-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![databaslista](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="1a70b-219">Andra etableringsmönster</span><span class="sxs-lookup"><span data-stu-id="1a70b-219">Other provisioning patterns</span></span>

<span data-ttu-id="1a70b-220">Andra etableringsmönster som inte ingår i den här guiden inkluderar:</span><span class="sxs-lookup"><span data-stu-id="1a70b-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="1a70b-221">**Företablering av databaser.**</span><span class="sxs-lookup"><span data-stu-id="1a70b-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="1a70b-222">hello före etablering mönster utnyttjar hello faktum att databaser i en elastisk pool inte Lägg till extra kostnad.</span><span class="sxs-lookup"><span data-stu-id="1a70b-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="1a70b-223">Faktureringen är för hello elastiska poolen, hello inte databaser och inaktiv databaser förbrukar några resurser.</span><span class="sxs-lookup"><span data-stu-id="1a70b-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="1a70b-224">Genom före etablering databaser i poolen och tilldela dem vid behov, minskas tid för klient onboarding avsevärt.</span><span class="sxs-lookup"><span data-stu-id="1a70b-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="1a70b-225">hello antalet databaser som etableras i förväg kan justeras som behövs tookeep en buffert som är lämplig för hello förväntat etablering hastighet.</span><span class="sxs-lookup"><span data-stu-id="1a70b-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="1a70b-226">**Automatisk etablering.**</span><span class="sxs-lookup"><span data-stu-id="1a70b-226">**Auto-provisioning.**</span></span> <span data-ttu-id="1a70b-227">I hello Automatisk etablering mönster en dedikerad etablering tjänst är används tooprovision servrar, pooler och databaser automatiskt efter behov – inklusive före etablering databaser i elastiska pooler om så önskas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="1a70b-228">Och om databaser Frigör uppdrag och tas bort, luckor i elastiska pooler kan fyllas av hello Etablerar tjänsten efter behov.</span><span class="sxs-lookup"><span data-stu-id="1a70b-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="1a70b-229">Dessa tjänster kan vara enkla eller avancerade – till exempel hantera etablering över flera områden, och kan ställa in geo-replikering automatiskt om den strategin som används för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="1a70b-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="1a70b-230">Ett klientprogram eller skript med hello Automatisk etablering mönster skulle skicka en allokering begäran tooa kön toobe bearbetas av hello etableras och skulle sedan avsöka hello tjänsten toodetermine avslutas.</span><span class="sxs-lookup"><span data-stu-id="1a70b-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="1a70b-231">Om före etablering används, skulle begäranden hanteras snabbt med hello-tjänst som hanterar etablering av en ersättning-databas som körs i bakgrunden hello.</span><span class="sxs-lookup"><span data-stu-id="1a70b-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="1a70b-232">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="1a70b-232">Next steps</span></span>

<span data-ttu-id="1a70b-233">I den här guiden lärde du dig hur man:</span><span class="sxs-lookup"><span data-stu-id="1a70b-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1a70b-234">Etablera en enskild ny klient</span><span class="sxs-lookup"><span data-stu-id="1a70b-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="1a70b-235">Etablera en batch med ytterligare klienter</span><span class="sxs-lookup"><span data-stu-id="1a70b-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="1a70b-236">Steg hello detaljer om etablering klienter och registrera dem till hello katalog</span><span class="sxs-lookup"><span data-stu-id="1a70b-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="1a70b-237">Försök hello [prestanda övervakning kursen](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="1a70b-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="1a70b-238">Ytterligare resurser</span><span class="sxs-lookup"><span data-stu-id="1a70b-238">Additional Resources</span></span>

* <span data-ttu-id="1a70b-239">Ytterligare [självstudier som bygger på hello Wingtip SaaS-program](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="1a70b-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="1a70b-240">Klientbibliotek för elastiska databaser</span><span class="sxs-lookup"><span data-stu-id="1a70b-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="1a70b-241">Hur tooDebug skript i Windows PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="1a70b-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
