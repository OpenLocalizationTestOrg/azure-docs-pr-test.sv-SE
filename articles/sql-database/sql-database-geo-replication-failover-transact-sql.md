---
title: "TSQL:initiate redundans för Azure SQL Database | Microsoft Docs"
description: "Initiera en planerad eller oplanerad växling för Azure SQL Database med Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 459941d2c82e5d4ef62beab4ccf775ab8f5efce4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="c5633-103">Starta en planerad eller oplanerad växling för Azure SQL-databas med Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c5633-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="c5633-104">Den här artikeln visar hur du påbörja växling till en sekundär SQL-databas med Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="c5633-104">This article shows you how to initiate failover to a secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="c5633-105">Om du vill konfigurera geo-replikering finns [konfigurera geo-replikering för Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="c5633-105">To configure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="c5633-106">Om du vill initiera växling vid fel, behöver du följande:</span><span class="sxs-lookup"><span data-stu-id="c5633-106">To initiate failover, you need the following:</span></span>

* <span data-ttu-id="c5633-107">En inloggning som är DBManager på primärt</span><span class="sxs-lookup"><span data-stu-id="c5633-107">A login that is DBManager on the primary</span></span>
* <span data-ttu-id="c5633-108">Har db_ownership för den lokala databasen som du kommer att geo-replikering</span><span class="sxs-lookup"><span data-stu-id="c5633-108">Have db_ownership of the local database that you will geo-replicate</span></span>
* <span data-ttu-id="c5633-109">Vara DBManager på partner-servrar som du vill konfigurera geo-replikering</span><span class="sxs-lookup"><span data-stu-id="c5633-109">Be DBManager on the partner server(s) to which you will configure geo-replication</span></span>
* <span data-ttu-id="c5633-110">Senaste versionen av SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="c5633-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5633-111">Det rekommenderas att du alltid använder den senaste versionen av Management Studio för att förbli synkroniserad med uppdateringar av Microsoft Azure och SQL Database.</span><span class="sxs-lookup"><span data-stu-id="c5633-111">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="c5633-112">[Uppdatera SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="c5633-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-to-become-the-new-primary"></a><span data-ttu-id="c5633-113">Starta en planerad redundans uppgradera en sekundär databas till den nya primärt</span><span class="sxs-lookup"><span data-stu-id="c5633-113">Initiate a planned failover promoting a secondary database to become the new primary</span></span>
<span data-ttu-id="c5633-114">Du kan använda den **ALTER DATABASE** instruktionen för att uppgradera en sekundär databas till den nya primära databasen i ett planerat sätt degradering av den befintliga primärt för att bli en sekundär.</span><span class="sxs-lookup"><span data-stu-id="c5633-114">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in a planned fashion, demoting the existing primary to become a secondary.</span></span> <span data-ttu-id="c5633-115">Den här instruktionen körs i master-databasen på den logiska Azure SQL Database-servern där georeplikerad sekundära databasen som håller på att uppgraderas finns.</span><span class="sxs-lookup"><span data-stu-id="c5633-115">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="c5633-116">Den här funktionen är avsedd för planerad redundans exempelvis under DR-flyttar och kräver att den primära databasen är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="c5633-116">This functionality is designed for planned failover, such as during the DR drills, and requires that the primary database be available.</span></span>

<span data-ttu-id="c5633-117">Kommandot utför följande arbetsflöde:</span><span class="sxs-lookup"><span data-stu-id="c5633-117">The command performs the following workflow:</span></span>

1. <span data-ttu-id="c5633-118">Växlar tillfälligt replikering till synkront läge orsakar alla utestående transaktioner ska tömmas för sekundärt och blockerar alla nya transaktioner.</span><span class="sxs-lookup"><span data-stu-id="c5633-118">Temporarily switches replication to synchronous mode, causing all outstanding transactions to be flushed to the secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="c5633-119">Växlar roller i de två databaserna i partnerskap geo-replikering.</span><span class="sxs-lookup"><span data-stu-id="c5633-119">Switches the roles of the two databases in the geo-replication partnership.</span></span>  

<span data-ttu-id="c5633-120">Den här sekvensen garanterar att de två databaserna är synkroniserade innan rollerna som växlar och därför ingen data försvinner.</span><span class="sxs-lookup"><span data-stu-id="c5633-120">This sequence guarantees that the two databases are synchronized before the roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="c5633-121">Det finns en kort period under vilken båda databaserna är inte tillgänglig (terabyte 0 till 25 sekunder) när rollerna växlas.</span><span class="sxs-lookup"><span data-stu-id="c5633-121">There is a short period during which both databases are unavailable (on the order of 0 to 25 seconds) while the roles are switched.</span></span> <span data-ttu-id="c5633-122">Om den primära databasen har flera sekundära databaser, konfigurera kommandot automatiskt om de andra sekundärservrar för att ansluta till den nya primärt.</span><span class="sxs-lookup"><span data-stu-id="c5633-122">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>  <span data-ttu-id="c5633-123">Hela åtgärden bör ta mindre än en minut att slutföra under normala omständigheter.</span><span class="sxs-lookup"><span data-stu-id="c5633-123">The entire operation should take less than a minute to complete under normal circumstances.</span></span> <span data-ttu-id="c5633-124">Mer information finns i [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) och [tjänstnivåer](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="c5633-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="c5633-125">Använd följande steg för att starta en planerad redundans.</span><span class="sxs-lookup"><span data-stu-id="c5633-125">Use the following steps to initiate a planned failover.</span></span>

1. <span data-ttu-id="c5633-126">Anslut till den logiska Azure SQL Database-servern som en sekundär geo-replikerade databas finns i Management Studio.</span><span class="sxs-lookup"><span data-stu-id="c5633-126">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="c5633-127">Öppna mappen databaser, expandera den **systemdatabaser** mappen, högerklicka på **master**, och klicka sedan på **ny fråga**.</span><span class="sxs-lookup"><span data-stu-id="c5633-127">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="c5633-128">Använd följande **ALTER DATABASE** instruktionen för att växla den sekundära databasen till den primära rollen.</span><span class="sxs-lookup"><span data-stu-id="c5633-128">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="c5633-129">Klicka på **Kör** att köra frågan.</span><span class="sxs-lookup"><span data-stu-id="c5633-129">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="c5633-130">I sällsynta fall är det möjligt att åtgärden går inte att slutföra och kan visas låsta.</span><span class="sxs-lookup"><span data-stu-id="c5633-130">In rare cases, it is possible that the operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="c5633-131">I det här fallet kan användaren köra kommando för påtvingad redundans och acceptera data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="c5633-131">In this case, the user can execute the force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-the-primary-database-to-the-secondary-database"></a><span data-ttu-id="c5633-132">Initiera oplanerad växling från den primära databasen till den sekundära databasen</span><span class="sxs-lookup"><span data-stu-id="c5633-132">Initiate an unplanned failover from the primary database to the secondary database</span></span>
<span data-ttu-id="c5633-133">Du kan använda den **ALTER DATABASE** instruktionen för att uppgradera en sekundär databas till den nya primära databasen på en oplanerad sätt framtvingar degraderingen av den befintliga primärt ska bli en sekundär samtidigt när den primära databasen är inte längre tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="c5633-133">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in an unplanned fashion, forcing the demotion of the existing primary to become a secondary at a time when the primary database is no longer available.</span></span> <span data-ttu-id="c5633-134">Den här instruktionen körs i master-databasen på den logiska Azure SQL Database-servern där georeplikerad sekundära databasen som håller på att uppgraderas finns.</span><span class="sxs-lookup"><span data-stu-id="c5633-134">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="c5633-135">Den här funktionen är avsedd för katastrofåterställning när återställning av tillgänglighet för databasen är viktiga och vissa dataförlust är acceptabel.</span><span class="sxs-lookup"><span data-stu-id="c5633-135">This functionality is designed for disaster recovery when restoring availability of the database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="c5633-136">När framtvingad växling vid fel anropas, blir den primära databasen den angivna sekundära databasen omedelbart och börjar ta emot skrivtransaktioner.</span><span class="sxs-lookup"><span data-stu-id="c5633-136">When forced failover is invoked, the specified secondary database immediately becomes the primary database and begins accepting write transactions.</span></span> <span data-ttu-id="c5633-137">Så snart som den ursprungliga primära databasen återansluta med den nya primära databasen, utförs en inkrementell säkerhetskopiering på den ursprungliga primära databasen och den gamla primära databasen görs till en sekundär databas för den nya primära databasen; Det är bara en synkronisera repliken av den nya primärt.</span><span class="sxs-lookup"><span data-stu-id="c5633-137">As soon as the original primary database is able to reconnect with this new primary database, an incremental backup is taken on the original primary database and the old primary database is made into a secondary database for the new primary database; subsequently, it is merely a synchronizing replica of the new primary.</span></span>

<span data-ttu-id="c5633-138">Men eftersom punkt i återställning till tidpunkt inte stöds på de sekundära databaserna, om användaren vill återställa data till den gamla primära databasen inte hade har replikerats till den nya primära databasen innan framtvingad växling vid fel inträffade, måste användaren Om du vill delta stöd för att återställa det förlorade data.</span><span class="sxs-lookup"><span data-stu-id="c5633-138">However, because Point In Time Restore is not supported on the secondary databases, if the user wishes to recover data committed to the old primary database that had not been replicated to the new primary database before the forced failover occurred, the user will need to engage support to recover this lost data.</span></span>

<span data-ttu-id="c5633-139">Om den primära databasen har flera sekundära databaser, konfigurera kommandot automatiskt om de andra sekundärservrar för att ansluta till den nya primärt.</span><span class="sxs-lookup"><span data-stu-id="c5633-139">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>

<span data-ttu-id="c5633-140">Använd följande steg för att initiera en oplanerad redundans.</span><span class="sxs-lookup"><span data-stu-id="c5633-140">Use the following steps to initiate an unplanned failover.</span></span>

1. <span data-ttu-id="c5633-141">Anslut till den logiska Azure SQL Database-servern som en sekundär geo-replikerade databas finns i Management Studio.</span><span class="sxs-lookup"><span data-stu-id="c5633-141">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="c5633-142">Öppna mappen databaser, expandera den **systemdatabaser** mappen, högerklicka på **master**, och klicka sedan på **ny fråga**.</span><span class="sxs-lookup"><span data-stu-id="c5633-142">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="c5633-143">Använd följande **ALTER DATABASE** instruktionen för att växla den sekundära databasen till den primära rollen.</span><span class="sxs-lookup"><span data-stu-id="c5633-143">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="c5633-144">Klicka på **Kör** att köra frågan.</span><span class="sxs-lookup"><span data-stu-id="c5633-144">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="c5633-145">Om kommandot utfärdas när både primär och sekundär är online blir den gamla primärt den nya sekundärt omedelbart utan datasynkronisering.</span><span class="sxs-lookup"><span data-stu-id="c5633-145">If the command is issued when both primary and secondary are online the old primary will become the new secondary immediately without data synchronization.</span></span> <span data-ttu-id="c5633-146">Om primärt kan genomför transaktioner när kommandot utfärdas dataförluster uppstå.</span><span class="sxs-lookup"><span data-stu-id="c5633-146">If the primary is committing transactions when the command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="c5633-147">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="c5633-147">Next steps</span></span>
* <span data-ttu-id="c5633-148">Kontrollera autentiseringskraven för servern och databasen har konfigurerats på den nya primärt efter redundans.</span><span class="sxs-lookup"><span data-stu-id="c5633-148">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="c5633-149">Mer information finns i [SQL Database-säkerhet efter katastrofåterställning](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="c5633-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="c5633-150">Mer information om återställning efter en katastrof använder aktiv geo-replikering, inklusive före återställning och efter återställning och utför en katastrofåterställning återställningsgranskning finns [Disaster Recovery](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="c5633-150">To learn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="c5633-151">Ett Sasha Nosov blogginlägg om aktiv geo-replikering finns [Spotlight på nya funktioner för geo-replikering](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="c5633-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="c5633-152">Information om hur du utformar molnprogram du använder aktiv geo-replikering finns [designa molnprogram för företagskontinuitet med geo-replikering](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="c5633-152">For information about designing cloud applications to use active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="c5633-153">Information om hur du använder aktiv geo-replikering med elastiska pooler finns [elastisk Pool strategi för katastrofåterställning](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="c5633-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="c5633-154">En översikt över verksamhetskontinuitet finns [översikt över verksamhetskontinuitet](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="c5633-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

