---
title: "TSQL:initiate redundans för Azure SQL Database | Microsoft Docs"
description: "Initiera en planerad eller oplanerad växling för Azure SQL Database med Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="5f62e-103">Starta en planerad eller oplanerad växling för Azure SQL-databas med Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="5f62e-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="5f62e-104">Den här artikeln beskrivs hur du tooinitiate redundans tooa sekundär SQL-databas med Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="5f62e-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="5f62e-105">tooconfigure geo-replikering, se [konfigurera geo-replikering för Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="5f62e-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="5f62e-106">tooinitiate redundans, behöver du hello följande:</span><span class="sxs-lookup"><span data-stu-id="5f62e-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="5f62e-107">En inloggning som DBManager på hello primära</span><span class="sxs-lookup"><span data-stu-id="5f62e-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="5f62e-108">Har db_ownership av hello lokal databas som du kommer att geo-replikering</span><span class="sxs-lookup"><span data-stu-id="5f62e-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="5f62e-109">Vara DBManager på hello partner servrar toowhich konfigurerar du geo-replikering</span><span class="sxs-lookup"><span data-stu-id="5f62e-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="5f62e-110">Senaste versionen av SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="5f62e-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5f62e-111">Det rekommenderas att du alltid använder hello senaste versionen av Management Studio tooremain synkroniseras med uppdateringar tooMicrosoft Azure och SQL-databas.</span><span class="sxs-lookup"><span data-stu-id="5f62e-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="5f62e-112">[Uppdatera SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="5f62e-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="5f62e-113">Starta en planerad redundans befordrar en ny primär för sekundära databasen toobecome hello</span><span class="sxs-lookup"><span data-stu-id="5f62e-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="5f62e-114">Du kan använda hello **ALTER DATABASE** instruktionen toopromote en sekundär databas toobecome hello nya primära databasen i ett planerat sätt degradering hello befintliga primära toobecome en sekundär.</span><span class="sxs-lookup"><span data-stu-id="5f62e-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="5f62e-115">Den här instruktionen körs på hello master-databasen på hello Azure SQL Database logisk server i vilken hello georeplikerad sekundär databas som håller på att uppgraderas finns.</span><span class="sxs-lookup"><span data-stu-id="5f62e-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="5f62e-116">Den här funktionen är avsedd för planerad redundans, som under hello DR flyttar och kräver att hello primära databasen är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="5f62e-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="5f62e-117">hello-kommando utför hello följande arbetsflöde:</span><span class="sxs-lookup"><span data-stu-id="5f62e-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="5f62e-118">Tillfälligt rensade växlar replikering toosynchronous läge orsakar alla utestående transaktioner toobe toohello sekundära och blockerar alla nya transaktioner.</span><span class="sxs-lookup"><span data-stu-id="5f62e-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="5f62e-119">Växlar hello roller i hello två databaserna hello geo-replikering tillsammans.</span><span class="sxs-lookup"><span data-stu-id="5f62e-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="5f62e-120">Den här sekvensen garanterar att hello två databaserna är synkroniserade innan hello roller växla och därför ingen data försvinner.</span><span class="sxs-lookup"><span data-stu-id="5f62e-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="5f62e-121">Det finns en kort period under vilken båda databaserna är inte tillgängliga (på hello ordning 0 too25 sekunder) när hello roller växlas.</span><span class="sxs-lookup"><span data-stu-id="5f62e-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="5f62e-122">Om hello primära databasen har flera sekundära databaser, hello kommandot kommer automatiskt reconfigure hello andra sekundärservrar tooconnect toohello nya primära servern.</span><span class="sxs-lookup"><span data-stu-id="5f62e-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="5f62e-123">hello hela åtgärden bör ta mindre än en minut toocomplete under normala omständigheter.</span><span class="sxs-lookup"><span data-stu-id="5f62e-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="5f62e-124">Mer information finns i [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) och [tjänstnivåer](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="5f62e-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="5f62e-125">Använd hello följande steg tooinitiate en planerad redundans.</span><span class="sxs-lookup"><span data-stu-id="5f62e-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="5f62e-126">Anslut toohello Azure SQL Database logiska servern som en sekundär geo-replikerade databas finns i Management Studio.</span><span class="sxs-lookup"><span data-stu-id="5f62e-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="5f62e-127">Öppna databasmappen hello, expandera hello **systemdatabaser** mappen, högerklicka på **master**, och klicka sedan på **ny fråga**.</span><span class="sxs-lookup"><span data-stu-id="5f62e-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="5f62e-128">Använder följande hello **ALTER DATABASE** instruktionen tooswitch hello sekundära databasen toohello primära rollen.</span><span class="sxs-lookup"><span data-stu-id="5f62e-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="5f62e-129">Klicka på **kör** toorun hello frågan.</span><span class="sxs-lookup"><span data-stu-id="5f62e-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="5f62e-130">I sällsynta fall är det möjligt att hello åtgärden går inte att slutföra och kan visas låsta.</span><span class="sxs-lookup"><span data-stu-id="5f62e-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="5f62e-131">I det här fallet kan hello användare köra hello-kommando för påtvingad redundans och acceptera data går förlorade.</span><span class="sxs-lookup"><span data-stu-id="5f62e-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="5f62e-132">Initiera oplanerad växling från hello primära databasen toohello sekundära databas</span><span class="sxs-lookup"><span data-stu-id="5f62e-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="5f62e-133">Du kan använda hello **ALTER DATABASE** instruktionen toopromote en sekundär databas toobecome hello nya primära databasen i ett oplanerad sätt att tvinga hello degraderingen av hello befintliga primära toobecome en sekundär samtidigt när hello primära databasen är inte längre tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="5f62e-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="5f62e-134">Den här instruktionen körs på hello master-databasen på hello Azure SQL Database logisk server i vilken hello georeplikerad sekundär databas som håller på att uppgraderas finns.</span><span class="sxs-lookup"><span data-stu-id="5f62e-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="5f62e-135">Den här funktionen är avsedd för katastrofåterställning när återställning tillgängligheten för hello databasen är viktiga och dataförluster tillåts.</span><span class="sxs-lookup"><span data-stu-id="5f62e-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="5f62e-136">När framtvingad växling vid fel anropas angetts hello sekundära databasen omedelbart blir hello primära databasen och börjar ta emot skrivtransaktioner.</span><span class="sxs-lookup"><span data-stu-id="5f62e-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="5f62e-137">Så snart hello ursprungliga primära databasen är kan tooreconnect med den nya primära databasen, utförs en inkrementell säkerhetskopia på hello ursprungliga primära databasen och hello gamla primära databasen görs till en sekundär databas för hello nya primära databasen. Det är bara en synkronisera repliken av hello nya primära.</span><span class="sxs-lookup"><span data-stu-id="5f62e-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="5f62e-138">Men eftersom punkt i återställning till tidpunkt inte stöds på hello sekundära databaser, om hello som toorecover data allokerat replikerats toohello gamla primära databasen som inte hade har toohello nya primära databasen innan hello framtvingad växling vid fel uppstod hello användaren måste tooengage stöd toorecover detta förlorade data.</span><span class="sxs-lookup"><span data-stu-id="5f62e-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="5f62e-139">Om hello primära databasen har flera sekundära databaser, hello kommandot kommer automatiskt reconfigure hello andra sekundärservrar tooconnect toohello nya primära servern.</span><span class="sxs-lookup"><span data-stu-id="5f62e-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="5f62e-140">Använd följande steg tooinitiate oplanerad växling hello.</span><span class="sxs-lookup"><span data-stu-id="5f62e-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="5f62e-141">Anslut toohello Azure SQL Database logiska servern som en sekundär geo-replikerade databas finns i Management Studio.</span><span class="sxs-lookup"><span data-stu-id="5f62e-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="5f62e-142">Öppna databasmappen hello, expandera hello **systemdatabaser** mappen, högerklicka på **master**, och klicka sedan på **ny fråga**.</span><span class="sxs-lookup"><span data-stu-id="5f62e-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="5f62e-143">Använder följande hello **ALTER DATABASE** instruktionen tooswitch hello sekundära databasen toohello primära rollen.</span><span class="sxs-lookup"><span data-stu-id="5f62e-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="5f62e-144">Klicka på **kör** toorun hello frågan.</span><span class="sxs-lookup"><span data-stu-id="5f62e-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="5f62e-145">Om hello utfärdas när både primär och sekundär är online hello gamla primära blir hello nya sekundära omedelbart utan datasynkronisering.</span><span class="sxs-lookup"><span data-stu-id="5f62e-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="5f62e-146">Om hello primära kan genomför transaktioner när hello-kommandot har utfärdats dataförluster uppstå.</span><span class="sxs-lookup"><span data-stu-id="5f62e-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="5f62e-147">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="5f62e-147">Next steps</span></span>
* <span data-ttu-id="5f62e-148">Kontrollera hello autentiseringskraven för servern och databasen har konfigurerats på hello nya primära efter redundans.</span><span class="sxs-lookup"><span data-stu-id="5f62e-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="5f62e-149">Mer information finns i [SQL Database-säkerhet efter katastrofåterställning](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="5f62e-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="5f62e-150">toolearn återställning efter en katastrof använder aktiv geo-replikering, inklusive före återställning och efter återställning och utför en katastrofåterställning återställningsgranskning finns [Disaster Recovery](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="5f62e-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="5f62e-151">Ett Sasha Nosov blogginlägg om aktiv geo-replikering finns [Spotlight på nya funktioner för geo-replikering](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="5f62e-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="5f62e-152">Information om hur du utformar molnet program toouse aktiv geo-replikering finns [designa molnprogram för företagskontinuitet med geo-replikering](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="5f62e-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="5f62e-153">Information om hur du använder aktiv geo-replikering med elastiska pooler finns [elastisk Pool strategi för katastrofåterställning](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="5f62e-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="5f62e-154">En översikt över verksamhetskontinuitet finns [översikt över verksamhetskontinuitet](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="5f62e-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

