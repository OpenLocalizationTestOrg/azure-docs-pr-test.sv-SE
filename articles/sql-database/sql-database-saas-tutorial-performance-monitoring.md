---
title: "Övervaka prestanda för många Azure SQL-databaser i en app för flera innehavare SaaS | Microsoft Docs"
description: "Övervaka och hantera prestanda för databaser och pooler i Azure SQL Database Wingtip SaaS-app"
keywords: sql database tutorial
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: 42f727aa40e744916b1a8adf634c10d55880bef0
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-performance-of-the-wingtip-saas-application"></a><span data-ttu-id="87cba-104">Övervaka prestanda för Wingtip SaaS-program</span><span class="sxs-lookup"><span data-stu-id="87cba-104">Monitor performance of the Wingtip SaaS application</span></span>

<span data-ttu-id="87cba-105">I den här självstudiekursen beskrivs flera KPI hanteringsscenarier som används i SaaS-program.</span><span class="sxs-lookup"><span data-stu-id="87cba-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="87cba-106">Simulera aktiviteten över alla klient-databaser med hjälp av en load-generatorn är inbyggd övervakning och avisering funktioner i SQL-databasen och elastiska pooler visas.</span><span class="sxs-lookup"><span data-stu-id="87cba-106">Using a load generator to simulate activity across all tenant databases, the built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="87cba-107">Wingtip SaaS-appen använder en enskild klient datamodellen, där varje plats (klient) har sina egna databasen.</span><span class="sxs-lookup"><span data-stu-id="87cba-107">The Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="87cba-108">Precis som för flera SaaS-program så är de förväntade belastningsmönstren för klienterna oberäkneliga och sporadiska.</span><span class="sxs-lookup"><span data-stu-id="87cba-108">Like many SaaS applications, the anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="87cba-109">Biljettförsäljningar kan med andra ord ske när som helst.</span><span class="sxs-lookup"><span data-stu-id="87cba-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="87cba-110">För att dra nytta av det här typiska databasanvändningsmönstret, distribueras klientdatabaserna i elastiska databaspooler.</span><span class="sxs-lookup"><span data-stu-id="87cba-110">To take advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="87cba-111">Elastiska pooler optimerar kostnaderna för en lösning genom att dela resurser över flera databaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-111">Elastic pools optimize the cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="87cba-112">Med den här typen av mönster är det viktigt att övervaka användningen av databas- och poolresurser för att försäkra att belastningarna balanseras över poolerna.</span><span class="sxs-lookup"><span data-stu-id="87cba-112">With this type of pattern, it's important to monitor database and pool resource usage to ensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="87cba-113">Du behöver också se till att enskilda databaser har tillräckliga resurser och att pooler inte träffar sina [eDTU](sql-database-what-is-a-dtu.md)-gränser.</span><span class="sxs-lookup"><span data-stu-id="87cba-113">You also need to ensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="87cba-114">Den här guiden går igenom sätt att övervaka och hantera databaser och pooler och hur man vidtar åtgärder i respons på belastningsvariationer.</span><span class="sxs-lookup"><span data-stu-id="87cba-114">This tutorial explores ways to monitor and manage databases and pools, and how to take corrective action in response to variations in workload.</span></span>

<span data-ttu-id="87cba-115">I den här guiden får du lära dig hur man:</span><span class="sxs-lookup"><span data-stu-id="87cba-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="87cba-116">Simulerar användning på klientdatabaserna genom att köra en angiven belastningsgenerator</span><span class="sxs-lookup"><span data-stu-id="87cba-116">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="87cba-117">Övervakar klientdatabaserna när de svarar på belastningsökningar</span><span class="sxs-lookup"><span data-stu-id="87cba-117">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="87cba-118">Skalar upp den elastiska poolen i svar på den ökade databasbelastningen</span><span class="sxs-lookup"><span data-stu-id="87cba-118">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="87cba-119">Etablerar en andra elastisk pool för att belastningsutjämna databasaktiviteten</span><span class="sxs-lookup"><span data-stu-id="87cba-119">Provision a second Elastic pool to load balance database activity</span></span>


<span data-ttu-id="87cba-120">Följande krav måste uppfyllas för att kunna köra den här självstudiekursen:</span><span class="sxs-lookup"><span data-stu-id="87cba-120">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="87cba-121">Wingtip SaaS-appen har distribuerats.</span><span class="sxs-lookup"><span data-stu-id="87cba-121">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="87cba-122">För att distribuera på mindre än fem minuter finns [distribuera och utforska Wingtip SaaS-program](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="87cba-122">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="87cba-123">Azure PowerShell ska ha installerats.</span><span class="sxs-lookup"><span data-stu-id="87cba-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="87cba-124">Mer information finns i [Komma igång med Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="87cba-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-saas-performance-management-patterns"></a><span data-ttu-id="87cba-125">Introduktion till SaaS prestanda management mönster</span><span class="sxs-lookup"><span data-stu-id="87cba-125">Introduction to SaaS performance management patterns</span></span>

<span data-ttu-id="87cba-126">Hantering av databasprestanda innebär kompilering och analys av prestandadata för att sedan reagera på den genom att justera parametrarna för att bibehålla en acceptabel svarstid för programmet.</span><span class="sxs-lookup"><span data-stu-id="87cba-126">Managing database performance consists of compiling and analyzing performance data, and then reacting to this data by adjusting parameters to maintain an acceptable response time for your application.</span></span> <span data-ttu-id="87cba-127">När du är värd för flera klientorganisationer, är elastiska databaspooler ett kostnadseffektivt sätt att tillhandahålla och hantera resurser för en grupp databaser med oförutsägbara arbetsbelastningar.</span><span class="sxs-lookup"><span data-stu-id="87cba-127">When hosting multiple tenants, Elastic database pools are a cost-effective way to provide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="87cba-128">Med vissa arbetsbelastningmönster, kan så få som två S3-databaser dra nytta av att hanteras i en pool.</span><span class="sxs-lookup"><span data-stu-id="87cba-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![media](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="87cba-130">Pooler och databaserna i poolen, bör övervakas för att säkerställa att de förblir inom acceptabel prestanda.</span><span class="sxs-lookup"><span data-stu-id="87cba-130">Pools, and the databases in pools, should be monitored to ensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="87cba-131">Finjustera konfigurationen för lagringspooler för att uppfylla behoven för alla databaser som säkerställer att pool-edtu: er är lämpliga för den övergripande arbetsbelastningen sammanställd arbetsbelastningen.</span><span class="sxs-lookup"><span data-stu-id="87cba-131">Tune the pool configuration to meet the needs of the aggregate workload of all databases, ensuring that the pool eDTUs are appropriate for the overall workload.</span></span> <span data-ttu-id="87cba-132">Justera per databas min och max eDTU-värden till lämpliga värden för dina specifika programkrav.</span><span class="sxs-lookup"><span data-stu-id="87cba-132">Adjust the per-database min and per-database max eDTU values to appropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="87cba-133">Strategier för prestandahantering</span><span class="sxs-lookup"><span data-stu-id="87cba-133">Performance management strategies</span></span>

* <span data-ttu-id="87cba-134">Om du vill undvika att övervaka prestanda manuellt är det mest effektiva till **ställa in aviseringar som utlöses när databaser eller pooler avvika utanför normal adressintervall**.</span><span class="sxs-lookup"><span data-stu-id="87cba-134">To avoid having to manually monitor performance, it’s most effective to **set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="87cba-135">För att svara på kortsiktiga variationer i sammansatt prestandanivå för en pool, kan **poolens eDTU-nivå skalas upp eller ned**.</span><span class="sxs-lookup"><span data-stu-id="87cba-135">To respond to short-term fluctuations in the aggregate performance level of a pool, the **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="87cba-136">Om de här variationerna inträffar på regelbunden eller förutsägbar basis, **kan skalning av poolen schemaläggas att ske automatiskt**.</span><span class="sxs-lookup"><span data-stu-id="87cba-136">If this fluctuation occurs on a regular or predictable basis, **scaling the pool can be scheduled to occur automatically**.</span></span> <span data-ttu-id="87cba-137">Du kan exempelvis skala ned när du vet att din arbetsbelastning är lätt, på nätter eller helger till exempel.</span><span class="sxs-lookup"><span data-stu-id="87cba-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="87cba-138">För att svara på mer långsiktiga variationer eller förändringar av antalet databaser, **kan enskilda databaser flyttas till andra pooler**.</span><span class="sxs-lookup"><span data-stu-id="87cba-138">To respond to longer-term fluctuations, or changes in the number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="87cba-139">För att svara på kort sikt ökar i *enskilda* databasbelastningen **enskilda databaser kan tas bort från en pool och tilldelats en enskilda prestandanivå**.</span><span class="sxs-lookup"><span data-stu-id="87cba-139">To respond to short term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="87cba-140">När belastningen minskar, kan databasen returneras till poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-140">Once the load is reduced, the database can then be returned to the pool.</span></span> <span data-ttu-id="87cba-141">När det är känt i förväg, kan databaser flyttas pre-emptively att säkerställa att databasen alltid har resurser som behövs och undvika påverkan på andra databaser i poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-141">When this is known in advance, databases can be moved pre-emptively to ensure the database always has the resources it needs, and to avoid impact on other databases in the pool.</span></span> <span data-ttu-id="87cba-142">Om det här kravet är förutsägbart, till exempel en plats där ett populärt evenemang skapar en rusning efter biljetter, kan det här hanteringsbeteendet integreras i programmet.</span><span class="sxs-lookup"><span data-stu-id="87cba-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into the application.</span></span>

<span data-ttu-id="87cba-143">[Azure-portalen](https://portal.azure.com) tillhandahåller inbyggd övervakning och avisering för de flesta resurser.</span><span class="sxs-lookup"><span data-stu-id="87cba-143">The [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="87cba-144">För SQL Database, finns övervakning och avisering tillgängligt för databaser och pooler.</span><span class="sxs-lookup"><span data-stu-id="87cba-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="87cba-145">Den här inbyggda övervakning och avisering är resurs-specifika, så det är praktiskt att använda för litet antal resurser, men är inte är användbart när du arbetar med många resurser.</span><span class="sxs-lookup"><span data-stu-id="87cba-145">This built-in monitoring and alerting is resource-specific, so it's convenient to use for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="87cba-146">För omfattande scenarier där du arbetar med många reources [logganalys (OMS)](sql-database-saas-tutorial-log-analytics.md) kan användas.</span><span class="sxs-lookup"><span data-stu-id="87cba-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="87cba-147">Detta är en separat Azure-tjänst som ger analytics över skickade diagnostikloggar och telemetri som samlats in i en log analytics-arbetsyta.</span><span class="sxs-lookup"><span data-stu-id="87cba-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="87cba-148">Logganalys kan samla in telemetri från många tjänster och användas för att fråga efter och Ställ in aviseringar.</span><span class="sxs-lookup"><span data-stu-id="87cba-148">Log Analytics can collect telemetry from many services and be used to query and set alerts.</span></span>

## <a name="get-the-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="87cba-149">Hämta Wingtip programmets källkod och skript</span><span class="sxs-lookup"><span data-stu-id="87cba-149">Get the Wingtip application source code and scripts</span></span>

<span data-ttu-id="87cba-150">Wingtip SaaS-skript och programmets källkod är tillgängliga i den [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github-lagringsplatsen.</span><span class="sxs-lookup"><span data-stu-id="87cba-150">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="87cba-151">[Steg för att hämta Wingtip SaaS-skripten](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="87cba-151">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="87cba-152">Etablera ytterligare klienter</span><span class="sxs-lookup"><span data-stu-id="87cba-152">Provision additional tenants</span></span>

<span data-ttu-id="87cba-153">Pooler kan vara kostnadseffektiva med bara två S3 databaser, men ju fler databaser som finns i poolen, desto mer kostnadseffektiv blir genomsnittseffekten.</span><span class="sxs-lookup"><span data-stu-id="87cba-153">While pools can be cost-effective with just two S3 databases, the more databases that are in the pool the more cost-effective the averaging effect becomes.</span></span> <span data-ttu-id="87cba-154">För att få en bra förståelse för hur prestandaövervakning och hantering fungerar i stor skala, kräver den här kursen du har distribuerat minst 20 databaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="87cba-155">Om du redan har etablerats en grupp med klienter i en tidigare kursen går du till den [simulera användning för alla databaser som klient](#simulate-usage-on-all-tenant-databases) avsnitt.</span><span class="sxs-lookup"><span data-stu-id="87cba-155">If you already provisioned a batch of tenants in a prior tutorial, skip to the [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="87cba-156">Öppna... \\Learning moduler\\prestandaövervakning och hantering av\\*Demo-PerformanceMonitoringAndManagement.ps1* i den *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="87cba-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="87cba-157">Ha det här skriptet öppet medan du kör scenarierna i den här guiden.</span><span class="sxs-lookup"><span data-stu-id="87cba-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="87cba-158">Ställ in **$DemoScenario** = **1**, **etablera en batch med klienter**</span><span class="sxs-lookup"><span data-stu-id="87cba-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="87cba-159">Tryck **F5** för att köra skriptet.</span><span class="sxs-lookup"><span data-stu-id="87cba-159">Press **F5** to run the script.</span></span>

<span data-ttu-id="87cba-160">Skriptet distribuerar 17 klienter på mindre än fem minuter.</span><span class="sxs-lookup"><span data-stu-id="87cba-160">The script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="87cba-161">Den *ny TenantBatch* skript som använder en kapslad eller länkade uppsättning [Resource Manager](../azure-resource-manager/index.md) mallar som skapar en grupp med klienter, vilket som standard kopieras databasen **basetenantdb** på katalogserver att skapa den nya innehavaren databaser registrerar sedan dessa i katalogen och slutligen initierar dem med typen klient namn och plats.</span><span class="sxs-lookup"><span data-stu-id="87cba-161">The *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies the database **basetenantdb** on the catalog server to create the new tenant databases, then registers these in the catalog, and finally initializes them with the tenant name and venue type.</span></span> <span data-ttu-id="87cba-162">Detta är förenligt med hur appen etablerar en ny klient.</span><span class="sxs-lookup"><span data-stu-id="87cba-162">This is consistent with the way the app provisions a new tenant.</span></span> <span data-ttu-id="87cba-163">Ändringar som görs till *basetenantdb* tillämpas på alla nya klienter som etablerats därefter.</span><span class="sxs-lookup"><span data-stu-id="87cba-163">Any changes made to *basetenantdb* are applied to any new tenants provisioned thereafter.</span></span> <span data-ttu-id="87cba-164">Finns det [schemat Management kursen](sql-database-saas-tutorial-schema-management.md) att se hur du ändrar schemat *befintliga* klient databaser (inklusive den *basetenantdb* databas).</span><span class="sxs-lookup"><span data-stu-id="87cba-164">See the [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) to see how to make schema changes to *existing* tenant databases (including the *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="87cba-165">Simulera användning på alla klientdatabaser</span><span class="sxs-lookup"><span data-stu-id="87cba-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="87cba-166">Den *Demo-PerformanceMonitoringAndManagement.ps1* skript har angetts som simulerar en arbetsbelastning som körs mot alla klient-databaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-166">The *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="87cba-167">Belastningen skapas med någon av de tillgängliga belastning scenarierna:</span><span class="sxs-lookup"><span data-stu-id="87cba-167">The load is generated using one of the available load scenarios:</span></span>

| <span data-ttu-id="87cba-168">Demo</span><span class="sxs-lookup"><span data-stu-id="87cba-168">Demo</span></span> | <span data-ttu-id="87cba-169">Scenario</span><span class="sxs-lookup"><span data-stu-id="87cba-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="87cba-170">2</span><span class="sxs-lookup"><span data-stu-id="87cba-170">2</span></span> | <span data-ttu-id="87cba-171">Generera belastning av normal intensitet (ca 40 DTU)</span><span class="sxs-lookup"><span data-stu-id="87cba-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="87cba-172">3</span><span class="sxs-lookup"><span data-stu-id="87cba-172">3</span></span> | <span data-ttu-id="87cba-173">Generera belastning med längre och mer frekventa toppar per databas</span><span class="sxs-lookup"><span data-stu-id="87cba-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="87cba-174">4</span><span class="sxs-lookup"><span data-stu-id="87cba-174">4</span></span> | <span data-ttu-id="87cba-175">Generera belastningar med högre DTU-toppar per databas (cirka 80 DTU)</span><span class="sxs-lookup"><span data-stu-id="87cba-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="87cba-176">5</span><span class="sxs-lookup"><span data-stu-id="87cba-176">5</span></span> | <span data-ttu-id="87cba-177">Generera en normal belastning plus en hög belastning på en enskild klient (cirka 95 DTU)</span><span class="sxs-lookup"><span data-stu-id="87cba-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="87cba-178">6</span><span class="sxs-lookup"><span data-stu-id="87cba-178">6</span></span> | <span data-ttu-id="87cba-179">Generera obalanserad belastning över flera pooler</span><span class="sxs-lookup"><span data-stu-id="87cba-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="87cba-180">Belastningsgeneratorn tillämpar en *syntetisk* enbart-CPU-belastning på varje klientdatabas.</span><span class="sxs-lookup"><span data-stu-id="87cba-180">The load generator applies a *synthetic* CPU-only load to every tenant database.</span></span> <span data-ttu-id="87cba-181">Generatorn startar ett jobb för varje klientdatabas som anropar en lagrad procedur med jämna mellanrum, vilket genererar belastningen.</span><span class="sxs-lookup"><span data-stu-id="87cba-181">The generator starts a job for each tenant database, which calls a stored procedure periodically that generates the load.</span></span> <span data-ttu-id="87cba-182">Belastningsnivåer (i eDTU:er), varaktighet och intervaller varierar över alla databaser, vilket simulerar oförutsägbar klientaktivitet.</span><span class="sxs-lookup"><span data-stu-id="87cba-182">The load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="87cba-183">Öppna... \\Learning moduler\\prestandaövervakning och hantering av\\*Demo-PerformanceMonitoringAndManagement.ps1* i den *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="87cba-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="87cba-184">Ha det här skriptet öppet medan du kör scenarierna i den här guiden.</span><span class="sxs-lookup"><span data-stu-id="87cba-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="87cba-185">Ange **$DemoScenario** = **2**, *generera normal styrka belastningen*.</span><span class="sxs-lookup"><span data-stu-id="87cba-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="87cba-186">Tryck på **F5** för att tillämpa en belastning på alla dina klientdatabaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-186">Press **F5** to apply a load to all your tenant databases.</span></span>

<span data-ttu-id="87cba-187">Wingtip är en SaaS-app och verkliga belastningen på en SaaS-app är vanligtvis sporadiska och oförutsägbart.</span><span class="sxs-lookup"><span data-stu-id="87cba-187">Wingtip is a SaaS app, and the real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="87cba-188">För att simulera det så skapar belastningsgeneratorn en slumpmässig belastning som distribueras över alla klienterna.</span><span class="sxs-lookup"><span data-stu-id="87cba-188">To simulate this, the load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="87cba-189">Flera minuter krävs för belastningen mönstret ut, så kör belastningen generatorn för 3-5 minuter innan du försöker att övervaka belastningen i följande avsnitt.</span><span class="sxs-lookup"><span data-stu-id="87cba-189">Several minutes are needed for the load pattern to emerge, so run the load generator for 3-5 minutes before attempting to monitor the load in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="87cba-190">Belastningsgeneratorn körs som en serie jobb i din lokala PowerShell-session.</span><span class="sxs-lookup"><span data-stu-id="87cba-190">The load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="87cba-191">Behåll fliken *Demo-PerformanceMonitoringAndManagement.ps1* öppen!</span><span class="sxs-lookup"><span data-stu-id="87cba-191">Keep the *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="87cba-192">Om du stänger fliken eller pausar din dator, stannar belastningsgeneratorn.</span><span class="sxs-lookup"><span data-stu-id="87cba-192">If you close the tab, or suspend your machine, the load generator stops.</span></span> <span data-ttu-id="87cba-193">Läs in generator finns kvar i en *jobbet anropar* tillstånd där den genererar belastningen på alla nya klienter som tillhandahålls när generatorn har startats.</span><span class="sxs-lookup"><span data-stu-id="87cba-193">The load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after the generator is started.</span></span> <span data-ttu-id="87cba-194">Använd *Ctrl-C* att stoppa anropar nya jobb och avslutas skriptet.</span><span class="sxs-lookup"><span data-stu-id="87cba-194">Use *Ctrl-C* to stop invoking new jobs and exit the script.</span></span> <span data-ttu-id="87cba-195">Läs in generator fortsätter att köras, men endast på befintliga klienter.</span><span class="sxs-lookup"><span data-stu-id="87cba-195">The load generator will continue to run, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-the-azure-portal"></a><span data-ttu-id="87cba-196">Övervaka Resursanvändning i Azure Portal</span><span class="sxs-lookup"><span data-stu-id="87cba-196">Monitor resource usage using the Azure portal</span></span>

<span data-ttu-id="87cba-197">Öppna portal till poolen innehåller klient-databaser för att övervaka Resursanvändning som resultat av belastningen tillämpas:</span><span class="sxs-lookup"><span data-stu-id="87cba-197">To monitor the resource usage that results from the load being applied, open the portal to the pool containing the tenant databases:</span></span>

1. <span data-ttu-id="87cba-198">Öppna den [Azure-portalen](https://portal.azure.com) och bläddra till den *tenants1 -&lt;användare&gt;*  server.</span><span class="sxs-lookup"><span data-stu-id="87cba-198">Open the [Azure portal](https://portal.azure.com) and browse to the *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="87cba-199">Bläddra ned och hitta elastiska pooler och klicka på **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="87cba-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="87cba-200">Den här poolen innehåller alla klientdatabaser som skapats än så länge.</span><span class="sxs-lookup"><span data-stu-id="87cba-200">This pool contains all the tenant databases created so far.</span></span>

<span data-ttu-id="87cba-201">Se den **elastisk pool övervakning** och **elastisk databas övervakning** diagram.</span><span class="sxs-lookup"><span data-stu-id="87cba-201">Observe the **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="87cba-202">Poolens resursutnyttjandet är sammanställd databasen användning för alla databaser i poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-202">The pool's resource utilization is the aggregate database utilization for all databases in the pool.</span></span> <span data-ttu-id="87cba-203">Databasen diagrammet visar de fem senaste databaserna:</span><span class="sxs-lookup"><span data-stu-id="87cba-203">The database chart shows the five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="87cba-204">Eftersom det finns ytterligare databaser i poolen utöver fem, visar aktivitet som inte återspeglas i översta fem databaser diagrammet pool-användning.</span><span class="sxs-lookup"><span data-stu-id="87cba-204">Because there are additional databases in the pool beyond the top five, the pool utilization shows activity that is not reflected in the top five databases chart.</span></span> <span data-ttu-id="87cba-205">Mer information klickar du på **databasen resursutnyttjande**:</span><span class="sxs-lookup"><span data-stu-id="87cba-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-the-pool"></a><span data-ttu-id="87cba-206">Ställ in prestandaaviseringar för poolen</span><span class="sxs-lookup"><span data-stu-id="87cba-206">Set performance alerts on the pool</span></span>

<span data-ttu-id="87cba-207">Ange en avisering i den pool som utlösare på \>75% användning på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="87cba-207">Set an alert on the pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="87cba-208">Öppna *Pool1* (på servern *tenants1-\<användare\>*) i [Azure-portalen](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="87cba-208">Open *Pool1* (on the *tenants1-\<user\>* server) in the [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="87cba-209">Klicka på **aviseringsregler** och därefter på **+ lägg till avisering**:</span><span class="sxs-lookup"><span data-stu-id="87cba-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![lägg till avisering](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="87cba-211">Ange ett namn, exempelvis **hög DTU**,</span><span class="sxs-lookup"><span data-stu-id="87cba-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="87cba-212">Ställ in följande värden:</span><span class="sxs-lookup"><span data-stu-id="87cba-212">Set the following values:</span></span>
   * <span data-ttu-id="87cba-213">**Mått = eDTU procent**</span><span class="sxs-lookup"><span data-stu-id="87cba-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="87cba-214">**Villkor = större än**.</span><span class="sxs-lookup"><span data-stu-id="87cba-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="87cba-215">**Tröskelvärdet = 75**.</span><span class="sxs-lookup"><span data-stu-id="87cba-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="87cba-216">**Period = de senaste 30 minuterna**.</span><span class="sxs-lookup"><span data-stu-id="87cba-216">**Period = Over the last 30 minutes**.</span></span>
1. <span data-ttu-id="87cba-217">Lägg till en e-postadress till den *ytterligare administratören email(s)* och klicka på **OK**.</span><span class="sxs-lookup"><span data-stu-id="87cba-217">Add an email address to the *Additional administrator email(s)* box and click **OK**.</span></span>

   ![ange varning](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="87cba-219">Skala upp en upptagen pool</span><span class="sxs-lookup"><span data-stu-id="87cba-219">Scale up a busy pool</span></span>

<span data-ttu-id="87cba-220">Om den sammanställda belastningsnivån ökar på en pool till den punkt där poolen maxas ut och den når 100% eDTU-användning så påverkas individuell databasprestanda, vilket kan sakta ner frågesvarstiderna för alla databaser i poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-220">If the aggregate load level increases on a pool to the point that it maxes out the pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in the pool.</span></span>

<span data-ttu-id="87cba-221">**Kort sikt**, Överväg att skala upp pool för att tillhandahålla ytterligare resurser eller ta bort databaser från poolen (flytta dem till andra pooler eller från poolen till en fristående tjänstnivå).</span><span class="sxs-lookup"><span data-stu-id="87cba-221">**Short term**, consider scaling up the pool to provide additional resources, or removing databases from the pool (moving them to other pools, or out of the pool to a stand-alone service tier).</span></span>

<span data-ttu-id="87cba-222">**Längre sikt**, optimera frågor eller index-syntax för att förbättra prestanda för databasen.</span><span class="sxs-lookup"><span data-stu-id="87cba-222">**Longer term**, consider optimizing queries or index usage to improve database performance.</span></span> <span data-ttu-id="87cba-223">Beroende på programmets känslighet för prestandaproblem, är det praxis att skala upp en pool innan den når 100% eDTU-användning.</span><span class="sxs-lookup"><span data-stu-id="87cba-223">Depending on the application's sensitivity to performance issues its best practice to scale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="87cba-224">Använd en avisering för att varna dig i förväg.</span><span class="sxs-lookup"><span data-stu-id="87cba-224">Use an alert to warn you in advance.</span></span>

<span data-ttu-id="87cba-225">Du kan simulera en upptagen pool genom att öka belastningen som generatorn skapar.</span><span class="sxs-lookup"><span data-stu-id="87cba-225">You can simulate a busy pool by increasing the load produced by the generator.</span></span> <span data-ttu-id="87cba-226">Orsakar databaser till burst oftare och för längre, öka sammanställd belastningen på poolen utan att ändra kraven för enskilda databaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-226">Causing the databases to burst more frequently, and for longer, increasing the aggregate load on the pool without changing the requirements of the individual databases.</span></span> <span data-ttu-id="87cba-227">Det är enkelt att skala upp poolen i portalen eller från PowerShell.</span><span class="sxs-lookup"><span data-stu-id="87cba-227">Scaling up the pool is easily done in the portal or from PowerShell.</span></span> <span data-ttu-id="87cba-228">Den här övningen använder portalen.</span><span class="sxs-lookup"><span data-stu-id="87cba-228">This exercise uses the portal.</span></span>

1. <span data-ttu-id="87cba-229">Ställ in *$DemoScenario* = **3**, _generera belastning med längre och mer frekventa toppar per databas_ för att öka intensiteten av den sammanställda belastningen på poolen utan att ändra toppbelastningen som krävs av varje databas.</span><span class="sxs-lookup"><span data-stu-id="87cba-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ to increase the intensity of the aggregate load on the pool without changing the peak load required by each database.</span></span>
1. <span data-ttu-id="87cba-230">Tryck på **F5** för att tillämpa en belastning på alla dina klientdatabaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-230">Press **F5** to apply a load to all your tenant databases.</span></span>

1. <span data-ttu-id="87cba-231">Gå till **Pool1** i Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="87cba-231">Go to **Pool1** in the Azure portal.</span></span>

<span data-ttu-id="87cba-232">Övervaka ökad poolen eDTU-användning på övre diagrammet.</span><span class="sxs-lookup"><span data-stu-id="87cba-232">Monitor the increased pool eDTU usage on the upper chart.</span></span> <span data-ttu-id="87cba-233">Det tar några minuter för den nya högre belastning kan förbättra, men du se snabbt poolen börjar nått maximal användning och som belastningen steadies till det nya mönstret, overloads snabbt poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-233">It takes a few minutes for the new higher load to kick in, but you should quickly see the pool start to hit max utilization, and as the load steadies into the new pattern, it rapidly overloads the pool.</span></span>

1. <span data-ttu-id="87cba-234">Om du vill skala upp poolen klickar du på **konfigurera pool** överst i den **Pool1** sidan.</span><span class="sxs-lookup"><span data-stu-id="87cba-234">To scale up the pool, click **Configure pool** at the top of the **Pool1** page.</span></span>
1. <span data-ttu-id="87cba-235">Justera det **Pool-eDTU** till **100**.</span><span class="sxs-lookup"><span data-stu-id="87cba-235">Adjust the **Pool eDTU** setting to **100**.</span></span> <span data-ttu-id="87cba-236">Ändringar av pool-eDTU:er, ändrar inte inställningarna per databas (som fortfarande är 50 eDTU max per databas).</span><span class="sxs-lookup"><span data-stu-id="87cba-236">Changing the pool eDTU does not change the per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="87cba-237">Du kan se per databas-inställningar på höger sida av den **konfigurera pool** sidan.</span><span class="sxs-lookup"><span data-stu-id="87cba-237">You can see the per-database settings on the right side of the **Configure pool** page.</span></span>
1. <span data-ttu-id="87cba-238">Klicka på **spara** att skicka begäran om att skala poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-238">Click **Save** to submit the request to scale the pool.</span></span>

<span data-ttu-id="87cba-239">Gå tillbaka till **Pool1** > **översikt** att visa övervakning diagram.</span><span class="sxs-lookup"><span data-stu-id="87cba-239">Go back to **Pool1** > **Overview** to view the monitoring charts.</span></span> <span data-ttu-id="87cba-240">Övervaka effekten av att tillhandahålla poolen med mer resurser (men med några databaser och en slumpmässig belastning inte är det alltid lätt att se säkerhet förrän du kör under en viss tid).</span><span class="sxs-lookup"><span data-stu-id="87cba-240">Monitor the effect of providing the pool with more resources (although with few databases and a randomized load it’s not always easy to see conclusively until you run for some time).</span></span> <span data-ttu-id="87cba-241">När du tittar på diagrammen, tänk på att 100% i det övre diagrammet nu representerar 100 eDTU:er, medan 100% i det lägre diagrammet fortfarande är 50 eDTU:er eftersom max per databas fortfarande är 50 eDTU:er.</span><span class="sxs-lookup"><span data-stu-id="87cba-241">While you are looking at the charts bear in mind that 100% on the upper chart now represents 100 eDTUs, while on the lower chart 100% is still 50 eDTUs as the per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="87cba-242">Databaserna är online och fullt tillgängliga under hela processen.</span><span class="sxs-lookup"><span data-stu-id="87cba-242">Databases remain online and fully available throughout the process.</span></span> <span data-ttu-id="87cba-243">Under det sista ögonblicket när varje databas är redo att aktiveras med de nya pool-eDTU:erna, bryts alla aktiva anslutningar.</span><span class="sxs-lookup"><span data-stu-id="87cba-243">At the last moment as each database is ready to be enabled with the new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="87cba-244">Du ska alltid skriva programkod för att återförsöka brutna anslutningar, vilken då kommer att återansluta till databasen i den uppskalade poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-244">Application code should always be written to retry dropped connections, and so will reconnect to the database in the scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="87cba-245">Belastningsutjämna mellan pooler</span><span class="sxs-lookup"><span data-stu-id="87cba-245">Load balance between pools</span></span>

<span data-ttu-id="87cba-246">Som ett alternativ till att skala upp poolen, kan du skapa en andra pool och flytta databaserna till den för att balansera belastningen mellan de två poolerna.</span><span class="sxs-lookup"><span data-stu-id="87cba-246">As an alternative to scaling up the pool, create a second pool and move databases into it to balance the load between the two pools.</span></span> <span data-ttu-id="87cba-247">Det gör du genom att skapa den nya poolen på samma server som den första.</span><span class="sxs-lookup"><span data-stu-id="87cba-247">To do this the new pool must be created on the same server as the first.</span></span>

1. <span data-ttu-id="87cba-248">I den [Azure-portalen](https://portal.azure.com)öppnar den **tenants1 -&lt;användare&gt;**  server.</span><span class="sxs-lookup"><span data-stu-id="87cba-248">In the [Azure portal](https://portal.azure.com), open the **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="87cba-249">Klicka på **+ ny pool** att skapa en pool på den aktuella servern.</span><span class="sxs-lookup"><span data-stu-id="87cba-249">Click **+ New pool** to create a pool on the current server.</span></span>
1. <span data-ttu-id="87cba-250">På den **elastisk databaspool** mallen:</span><span class="sxs-lookup"><span data-stu-id="87cba-250">On the **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="87cba-251">Ange **namn** till *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="87cba-251">Set **Name** to *Pool2*.</span></span>
    1. <span data-ttu-id="87cba-252">Lämna prisnivån som **standardpool**.</span><span class="sxs-lookup"><span data-stu-id="87cba-252">Leave the pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="87cba-253">Klicka på **konfigurera poolen**,</span><span class="sxs-lookup"><span data-stu-id="87cba-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="87cba-254">Ange **Pool-eDTU** till *50 eDTU*.</span><span class="sxs-lookup"><span data-stu-id="87cba-254">Set **Pool eDTU** to *50 eDTU*.</span></span>
    1. <span data-ttu-id="87cba-255">Klicka på **lägga till databaser** att se en lista över databaser på den server som kan läggas till *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="87cba-255">Click **Add databases** to see a list of databases on the server that can be added to *Pool2*.</span></span>
    1. <span data-ttu-id="87cba-256">Välj alla 10 databaser att flytta dem till den nya poolen och klickar sedan på **Välj**.</span><span class="sxs-lookup"><span data-stu-id="87cba-256">Select any 10 databases to move these to the new pool, and then click **Select**.</span></span> <span data-ttu-id="87cba-257">Om du har kört belastningen generator, vet tjänsten redan att profilen prestanda kräver en pool som är större än 50 eDTU standardstorleken och rekommenderar att du börjar med en 100 eDTU-inställning.</span><span class="sxs-lookup"><span data-stu-id="87cba-257">If you've been running the load generator, the service already knows that your performance profile requires a larger pool than the default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![Rekommendation](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="87cba-259">Låt standardvärdet på 50 edtu: er för den här självstudien och klicka på **Välj** igen.</span><span class="sxs-lookup"><span data-stu-id="87cba-259">For this tutorial, leave the default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="87cba-260">Välj **OK** att skapa den nya poolen och flytta valda databaserna till den.</span><span class="sxs-lookup"><span data-stu-id="87cba-260">Select **OK** to create the new pool and to move the selected databases into it.</span></span>

<span data-ttu-id="87cba-261">Skapa poolen och Flytta databaserna tar några minuter.</span><span class="sxs-lookup"><span data-stu-id="87cba-261">Creating the pool and moving the databases takes a few minutes.</span></span> <span data-ttu-id="87cba-262">När databaser flyttas de fortfarande är online och tillgängliga fullständigt tills sista, då alla öppna anslutningar stängs.</span><span class="sxs-lookup"><span data-stu-id="87cba-262">As databases are moved they remain online and fully accessible until the very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="87cba-263">Så länge som du har några logik ansluter klienter sedan till databasen i den nya poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-263">As long as you have some retry logic, clients will then connect to the database in the new pool.</span></span>

<span data-ttu-id="87cba-264">Bläddra till **Pool2** (på den *tenants1* server) att öppna poolen och övervaka dess prestanda.</span><span class="sxs-lookup"><span data-stu-id="87cba-264">Browse to **Pool2** (on the *tenants1* server) to open the pool and monitor its performance.</span></span> <span data-ttu-id="87cba-265">Om du inte ser det, vänta tills etableringen av den nya poolen för att slutföra.</span><span class="sxs-lookup"><span data-stu-id="87cba-265">If you don't see it, wait for provisioning of the new pool to complete.</span></span>

<span data-ttu-id="87cba-266">Du ser nu att resursanvändningen på *Pool1* har tagits bort och att *Pool2* läses nu på samma sätt.</span><span class="sxs-lookup"><span data-stu-id="87cba-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="87cba-267">Hantera prestanda för en enskild databas</span><span class="sxs-lookup"><span data-stu-id="87cba-267">Manage performance of a single database</span></span>

<span data-ttu-id="87cba-268">Om en enskild databas i poolen har problem med en varaktigt hög belastning, kan det beroende poolkonfigurationen dominera resurserna i poolen och påverka andra databaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-268">If a single database in a pool experiences a sustained high load, depending on the pool configuration, it may tend to dominate the resources in the pool and impact other databases.</span></span> <span data-ttu-id="87cba-269">Om aktiviteten är sannolikt att fortsätta under en viss tid, flyttas databasen tillfälligt från poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-269">If the activity is likely to continue for some time, the database can be temporarily moved out of the pool.</span></span> <span data-ttu-id="87cba-270">Detta gör att databasen ska ha de extra resurser som den behöver och isoleras från andra databaser.</span><span class="sxs-lookup"><span data-stu-id="87cba-270">This allows the database to have the extra resources it needs, and isolates it from the other databases.</span></span>

<span data-ttu-id="87cba-271">Den här övningen simulerar effekten av att Contosos konserthall upplever en hög belastning när biljetter börjar säljas för ett populärt evenemang.</span><span class="sxs-lookup"><span data-stu-id="87cba-271">This exercise simulates the effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="87cba-272">Öppna den... \\ *Demo-PerformanceMonitoringAndManagement.ps1* skript.</span><span class="sxs-lookup"><span data-stu-id="87cba-272">Open the …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="87cba-273">Ställ in **$DemoScenario = 5, generera en normal belastning plus en hög belastning för en enskild klient (cirka 95 DTU).**</span><span class="sxs-lookup"><span data-stu-id="87cba-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="87cba-274">Ställ in **$SingleTenantDatabaseName = contosoconcerthall**</span><span class="sxs-lookup"><span data-stu-id="87cba-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="87cba-275">Kör skriptet med **F5**.</span><span class="sxs-lookup"><span data-stu-id="87cba-275">Execute the script using **F5**.</span></span>


1. <span data-ttu-id="87cba-276">I den [Azure-portalen](https://portal.azure.com) öppna **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="87cba-276">In the [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="87cba-277">Kontrollera den **elastisk pool övervakning** diagram och leta efter ökad pool-eDTU-användning.</span><span class="sxs-lookup"><span data-stu-id="87cba-277">Inspect the **Elastic pool monitoring** chart and look for the increased pool eDTU usage.</span></span> <span data-ttu-id="87cba-278">Efter någon minut sätter den högre belastningen in och du borde snabbt se att poolen når 100% användning.</span><span class="sxs-lookup"><span data-stu-id="87cba-278">After a minute or two, the higher load should start to kick in, and you should quickly see that the pool hits 100% utilization.</span></span>
1. <span data-ttu-id="87cba-279">Kontrollera den **elastisk databas övervakning** visas som visar de mest populära databaserna under den senaste timmen.</span><span class="sxs-lookup"><span data-stu-id="87cba-279">Inspect the **Elastic database monitoring** display which shows the hottest databases in the past hour.</span></span> <span data-ttu-id="87cba-280">Den *contosoconcerthall* databasen snart ska visas som en av de fem senaste databaserna.</span><span class="sxs-lookup"><span data-stu-id="87cba-280">The *contosoconcerthall* database should soon appear as one of the five hottest databases.</span></span>
1. <span data-ttu-id="87cba-281">**Klicka på övervakning elastisk databas** **diagram** och öppnar den **databasen resursutnyttjande** sida där du kan övervaka någon av databaserna.</span><span class="sxs-lookup"><span data-stu-id="87cba-281">**Click on the Elastic database monitoring** **chart** and it opens the **Database Resource Utilization** page where you can monitor any of the databases.</span></span> <span data-ttu-id="87cba-282">På så sätt kan du isolera visa för den *contosoconcerthall* databas.</span><span class="sxs-lookup"><span data-stu-id="87cba-282">This lets you isolate the display for the *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="87cba-283">Från listan över databaser, klickar du på **contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="87cba-283">From the list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="87cba-284">Klicka på **prisnivån (skala dtu: er)** att öppna den **konfigurera prestanda** sida där du kan ange en fristående prestandanivå för databasen.</span><span class="sxs-lookup"><span data-stu-id="87cba-284">Click **Pricing Tier (scale DTUs)** to open the **Configure performance** page where you can set a stand-alone performance level for the database.</span></span>
1. <span data-ttu-id="87cba-285">Klicka på **Standard**-fliken för att öppna skalningsalternativen på standardnivån.</span><span class="sxs-lookup"><span data-stu-id="87cba-285">Click on the **Standard** tab to open the scale options in the Standard tier.</span></span>
1. <span data-ttu-id="87cba-286">Dra den **DTU skjutreglaget** till höger för att välja **100** dtu: er.</span><span class="sxs-lookup"><span data-stu-id="87cba-286">Slide the **DTU slider** to right to select **100** DTUs.</span></span> <span data-ttu-id="87cba-287">Obs detta motsvarar tjänstmålet, **S3**.</span><span class="sxs-lookup"><span data-stu-id="87cba-287">Note this corresponds to the service objective, **S3**.</span></span>
1. <span data-ttu-id="87cba-288">Klicka på **tillämpa** flytta databasen från poolen och ge den en *Standard S3* databas.</span><span class="sxs-lookup"><span data-stu-id="87cba-288">Click **Apply** to move the database out of the pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="87cba-289">När skalning är klar kan du övervaka effekten på contosoconcerthall databasen och Pool1 på de elastiska poolen och databas-blad.</span><span class="sxs-lookup"><span data-stu-id="87cba-289">Once scaling is complete, monitor the effect on the contosoconcerthall database and Pool1 on the elastic pool and database blades.</span></span>

<span data-ttu-id="87cba-290">När hög belastning på databasen för contosoconcerthall subsides returnera du den för att minska kostnaden för dess.</span><span class="sxs-lookup"><span data-stu-id="87cba-290">Once the high load on the contosoconcerthall database subsides you should promptly return it to the pool to reduce its cost.</span></span> <span data-ttu-id="87cba-291">Om det är oklart om som sker du kan ange en avisering på databasen som utlöses när dess DTU-användningen sjunker under den per databasen max på poolen.</span><span class="sxs-lookup"><span data-stu-id="87cba-291">If it’s unclear when that will happen you could set an alert on the database that will trigger when its DTU usage drops below the per-database max on the pool.</span></span> <span data-ttu-id="87cba-292">Övrning 5 beskriver hur du flyttar en databas till en pool.</span><span class="sxs-lookup"><span data-stu-id="87cba-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="87cba-293">Övriga prestandahanteringsmönster</span><span class="sxs-lookup"><span data-stu-id="87cba-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="87cba-294">**Pre-emptive skalning** i övning ovan där utforskade du hur du skalar en isolerad databas du vet vilken databas som ska sökas.</span><span class="sxs-lookup"><span data-stu-id="87cba-294">**Pre-emptive scaling** In the exercise above where you explored how to scale an isolated database, you knew which database to look for.</span></span> <span data-ttu-id="87cba-295">Om hantering av Contoso samklang Hall hade Wingtips för nära förestående biljett försäljning, ha databasen flyttats från poolen pre-emptively.</span><span class="sxs-lookup"><span data-stu-id="87cba-295">If the management of Contoso Concert Hall had informed Wingtips of the impending ticket sale, the database could have been moved out of the pool pre-emptively.</span></span> <span data-ttu-id="87cba-296">Annars hade det sannolikt behövts en avisering på poolen eller databasen för att upptäcka vad som hände.</span><span class="sxs-lookup"><span data-stu-id="87cba-296">Otherwise, it would likely have required an alert on the pool or the database to spot what was happening.</span></span> <span data-ttu-id="87cba-297">Du vill inte få reda på sånt här genom att andra klienter i poolen klagar på försämrad prestanda.</span><span class="sxs-lookup"><span data-stu-id="87cba-297">You wouldn’t want to learn about this from the other tenants in the pool complaining of degraded performance.</span></span> <span data-ttu-id="87cba-298">Och om klienten kan förutse hur länge de behöver ytterligare resurser, kan du ställa in en Azure Automation-runbook för att flytta ut databasen från poolen och sedan tillbaka igen enligt ett definierat schema.</span><span class="sxs-lookup"><span data-stu-id="87cba-298">And if the tenant can predict how long they will need additional resources you can set up an Azure Automation runbook to move the database out of the pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="87cba-299">**Klientskalning som självservice** eftersom skalning är en aktivitet som enkelt kan anropas via hanterings-API:t, kan du enkelt bygga in möjligheten att skala klientdatabaser i ditt klientriktade program och erbjuda de som en funktion av din SaaS-tjänst.</span><span class="sxs-lookup"><span data-stu-id="87cba-299">**Tenant self-service scaling** Because scaling is a task easily called via the management API, you can easily build the ability to scale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="87cba-300">Exempelvis kan du låta klienter självhantera upp- och nedskalning, kanske kopplat direkt till sin fakturering!</span><span class="sxs-lookup"><span data-stu-id="87cba-300">For example, let tenants self-administer scaling up and down, perhaps linked directly to their billing!</span></span>

<span data-ttu-id="87cba-301">**Skala upp och ner poolen enligt ett schema så att den matchar användningsmönster**</span><span class="sxs-lookup"><span data-stu-id="87cba-301">**Scaling a pool up and down on a schedule to match usage patterns**</span></span>

<span data-ttu-id="87cba-302">I de fall där sammanställd klientanvändning följer förutsägbara mönster, kan du använda Azure Automation för att skala upp en pool efter ett schema.</span><span class="sxs-lookup"><span data-stu-id="87cba-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation to scale a pool up and down on a schedule.</span></span> <span data-ttu-id="87cba-303">Skala exempelvis ned en pool efter 18.00 och upp igen innan 06.00 på veckodagar, när du vet att kraven på resursanvändning går ned.</span><span class="sxs-lookup"><span data-stu-id="87cba-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="87cba-304">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="87cba-304">Next steps</span></span>

<span data-ttu-id="87cba-305">I den här guiden får du lära dig hur man:</span><span class="sxs-lookup"><span data-stu-id="87cba-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="87cba-306">Simulerar användning på klientdatabaserna genom att köra en angiven belastningsgenerator</span><span class="sxs-lookup"><span data-stu-id="87cba-306">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="87cba-307">Övervakar klientdatabaserna när de svarar på belastningsökningar</span><span class="sxs-lookup"><span data-stu-id="87cba-307">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="87cba-308">Skalar upp den elastiska poolen i svar på den ökade databasbelastningen</span><span class="sxs-lookup"><span data-stu-id="87cba-308">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="87cba-309">Etablerar en andra elastisk pool för att belastningsutjämna databasaktiviteten</span><span class="sxs-lookup"><span data-stu-id="87cba-309">Provision a second Elastic pool to load balance the database activity</span></span>

[<span data-ttu-id="87cba-310">Guiden återställ en enskild klient</span><span class="sxs-lookup"><span data-stu-id="87cba-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="87cba-311">Ytterligare resurser</span><span class="sxs-lookup"><span data-stu-id="87cba-311">Additional resources</span></span>

* <span data-ttu-id="87cba-312">Ytterligare [självstudier som bygger på Wingtip SaaS-programdistribution](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="87cba-312">Additional [tutorials that build upon the Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="87cba-313">Elastiska SQL-pooler</span><span class="sxs-lookup"><span data-stu-id="87cba-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="87cba-314">Azure Automation</span><span class="sxs-lookup"><span data-stu-id="87cba-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="87cba-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Guide för att konfigurera och använda Log Analytics</span><span class="sxs-lookup"><span data-stu-id="87cba-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>
