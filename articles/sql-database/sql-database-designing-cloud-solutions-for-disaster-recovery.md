---
title: "aaaDesign tjänst med hög tillgänglighet med hjälp av Azure SQL Database | Microsoft Docs"
description: "Läs mer om programmet design för hög tillgänglighet med hjälp av Azure SQL Database-tjänster."
keywords: "molnet katastrofåterställning, katastrofåterställning, app-säkerhetskopiering, geo-replikering, kontinuerlig planering"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 815f754ba7014cd8a1108a2d84c2a8f71d7030a5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="3cb16-104">Designa tjänster med hög tillgänglighet med hjälp av Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="3cb16-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="3cb16-105">När du skapar och distribuerar tjänster med hög tillgänglighet på Azure SQL Database, använder du [redundans grupper och aktiv geo-replikering](sql-database-geo-replication-overview.md) tooprovide återhämtning tooregional fel och oåterkalleligt avbrott och aktivera snabb återställning toohello sekundära databaser.</span><span class="sxs-lookup"><span data-stu-id="3cb16-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) tooprovide resilience tooregional failures and catastrophic outages and enable fast recovery toohello secondary databases.</span></span> <span data-ttu-id="3cb16-106">Den här artikeln fokuserar på vanliga program mönster och beskriver hello fördelar och avvägningarna med varje alternativ beroende på hello-krav för distribution av programmet, hello servicenivåavtalet du inriktar trafik svarstid och kostnader.</span><span class="sxs-lookup"><span data-stu-id="3cb16-106">This article focuses on common application patterns and discusses hello benefits and trade-offs of each option depending on hello application deployment requirements, hello service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="3cb16-107">Information om aktiv geo-replikering med elastiska pooler finns [elastisk Pool strategi för katastrofåterställning](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="3cb16-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="3cb16-108">Designmönstret 1: aktivt-passivt distribution för katastrofåterställning i molnet med en samplacerade-databas</span><span class="sxs-lookup"><span data-stu-id="3cb16-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="3cb16-109">Det här alternativet fungerar bäst för program med hello följande egenskaper:</span><span class="sxs-lookup"><span data-stu-id="3cb16-109">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="3cb16-110">Aktiva instans i en enda Azure-region</span><span class="sxs-lookup"><span data-stu-id="3cb16-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="3cb16-111">Stark beroendet av skrivskyddad (RW) åtkomst toodata</span><span class="sxs-lookup"><span data-stu-id="3cb16-111">Strong dependency on read-write (RW) access toodata</span></span>
* <span data-ttu-id="3cb16-112">Cross-region anslutningen mellan hello-webbprogram och hello databasen är inte giltig på grund av toolatency och trafik kostnad</span><span class="sxs-lookup"><span data-stu-id="3cb16-112">Cross-region connectivity between hello web application and hello database is not acceptable due toolatency and traffic cost</span></span>    

<span data-ttu-id="3cb16-113">I det här fallet är hello topologi för distribution av program optimerad för hantering av regionala katastrofer när alla programkomponenter som påverkas och måste toofailover som en enhet.</span><span class="sxs-lookup"><span data-stu-id="3cb16-113">In this case, hello application deployment topology is optimized for handling regional disasters when all application components are impacted and need toofailover as a unit.</span></span> <span data-ttu-id="3cb16-114">Hello programlogiken och hello databasen är replikerad tooanother region för geografisk redundans men används inte för hello programmet arbetsbelastning under normala hello.</span><span class="sxs-lookup"><span data-stu-id="3cb16-114">For geographic redundancy, hello application logic and hello database are replicated tooanother region but they are not used for hello application workload under hello normal conditions.</span></span> <span data-ttu-id="3cb16-115">hello programmet hello sekundär region måste vara konfigurerade toouse en SQL-anslutning sträng toohello sekundär databas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-115">hello application in hello secondary region should be configured toouse a SQL connection string toohello secondary database.</span></span> <span data-ttu-id="3cb16-116">Trafikhanterarprofilen har ställts in toouse [routningsmetoden för redundans](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="3cb16-116">Traffic manager is set up toouse [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="3cb16-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) används endast för illustration i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="3cb16-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="3cb16-118">Du kan använda belastningsutjämning lösning som har stöd för routningsmetoden för redundans.</span><span class="sxs-lookup"><span data-stu-id="3cb16-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="3cb16-119">hello följande diagram visar denna konfiguration innan ett avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-119">hello following diagram shows this configuration before an outage.</span></span>

![Konfiguration av SQL Database geo-replikering.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="3cb16-122">Efter ett avbrott i hello primära region identifierar hello SQL Database-tjänsten hello primära databasen inte är tillgänglig och utlösa en växling vid fel toohello sekundär databas baserat på hello parametrar hello automatisk redundansprincip.</span><span class="sxs-lookup"><span data-stu-id="3cb16-122">After an outage in hello primary region, hello SQL Database service detects that hello primary database is not accessible and trigger a failover toohello secondary database based on hello parameters of hello automatic failover policy.</span></span> <span data-ttu-id="3cb16-123">Beroende på SERVICENIVÅAVTAL för programmet kan du bestämma tooconfigure en respitperiod mellan hello identifiering av hello avbrott och hello redundans sig själv.</span><span class="sxs-lookup"><span data-stu-id="3cb16-123">Depending on your application SLA, you can decide tooconfigure a grace period between hello detection of hello outage and hello failover itself.</span></span> <span data-ttu-id="3cb16-124">Konfigurera en respitperiod minskar risken för hello data går förlorade toohello fall där hello avbrott är allvarligt och tillgänglighet i hello region kan inte återställas snabbt.</span><span class="sxs-lookup"><span data-stu-id="3cb16-124">Configuring a grace period reduces hello risk of data loss toohello cases where hello outage is catastrophic and availability in hello region cannot be quickly restored.</span></span> <span data-ttu-id="3cb16-125">Om hello endpoint redundans initieras av hello traffic manager innan hello redundans grupp utlösare hello redundans för hello-databasen, hello webbprogram är inte kan tooreconnect toohello databas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-125">If hello endpoint failover is initiated by hello traffic manager before hello failover group triggers hello failover of hello database, hello web application is not able tooreconnect toohello database.</span></span> <span data-ttu-id="3cb16-126">hello programmet försök tooreconnect lyckas automatiskt så snart hello databasen redundansväxlingen är klar.</span><span class="sxs-lookup"><span data-stu-id="3cb16-126">hello application’s attempt tooreconnect automatically succeeds as soon as hello database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="3cb16-127">tooachieve samordnad fullständigt redundans av programmet hello och hello databaser, bör du utforma din egen övervakningsmetod och använda manuell växling av hello web application slutpunkter och hello-databaser.</span><span class="sxs-lookup"><span data-stu-id="3cb16-127">tooachieve fully coordinated failover of hello application and hello databases, you should devise your own monitoring method and use manual failover of hello web application endpoints and hello databases.</span></span>
>

<span data-ttu-id="3cb16-128">När hello redundans för både hello programmet slutpunkter och hello-databasen, hello programmet startas om bearbetning hello användarförfrågningar i hello region B och förblir samordnas med hello databasen eftersom hello primära databasen nu finns i region B. Det här scenariot illustreras i följande diagram hello.</span><span class="sxs-lookup"><span data-stu-id="3cb16-128">After hello failover of both hello application’s endpoints and hello database completes, hello application will re-start processing hello user requests in hello region B and will remain co-located with hello database because hello primary database is now in region B. This scenario is illustrated in hello following diagram.</span></span> <span data-ttu-id="3cb16-129">Alla diagram heldragen linje visar en aktiv anslutning, streckade linjer anger avbrutna anslutningar och stoppa loggar ange åtgärd utlösare.</span><span class="sxs-lookup"><span data-stu-id="3cb16-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![GEO-replikering: Redundans toosecondary databas.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="3cb16-132">Om ett avbrott inträffar i hello sekundär region hello replikeringslänk mellan hello primära och sekundära hello-databasen har pausats, men hello redundans aktiveras inte eftersom hello primära databasen inte påverkas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-132">If an outage happens in hello secondary region, hello replication link between hello primary and hello secondary database is suspended but hello failover is not triggered because hello primary database is not impacted.</span></span> <span data-ttu-id="3cb16-133">hello programmets tillgänglighet ändras inte i det här fallet men hello programmet fungerar exponerade och därför högre risk om båda regioner misslyckas i följd.</span><span class="sxs-lookup"><span data-stu-id="3cb16-133">hello application's availability is not changed in this case, but hello application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="3cb16-134">Vi rekommenderar hello konfiguration med programmet distribution begränsad tootwo regioner för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="3cb16-134">For disaster recovery we recommend hello configuration with application deployment limited tootwo regions.</span></span> <span data-ttu-id="3cb16-135">Detta beror på att de flesta av hello Azure geografiska områden har bara två områden.</span><span class="sxs-lookup"><span data-stu-id="3cb16-135">This is because most of hello Azure geographies have only two regions.</span></span> <span data-ttu-id="3cb16-136">Den här konfigurationen skyddar inte programmet från ett samtidiga oåterkalleligt fel på båda regioner.</span><span class="sxs-lookup"><span data-stu-id="3cb16-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="3cb16-137">En osannolika av ett sådant fel kan du återställa databaserna i en tredje region med [geo-återställning åtgärden](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="3cb16-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="3cb16-138">När hello avbrott minskas synkroniseras automatiskt hello sekundära databasen igen med primär hello.</span><span class="sxs-lookup"><span data-stu-id="3cb16-138">Once hello outage is mitigated, hello secondary database will automatically re-synchronize with hello primary.</span></span> <span data-ttu-id="3cb16-139">Under synkroniseringen gick av hello primära något påverkas databasprestanda beroende på hello mängden data som behöver toobe synkroniseras.</span><span class="sxs-lookup"><span data-stu-id="3cb16-139">During synchronization, performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="3cb16-140">hello illustrerar följande diagram ett avbrott i hello sekundär region.</span><span class="sxs-lookup"><span data-stu-id="3cb16-140">hello following diagram illustrates an outage in hello secondary region.</span></span>

![Sekundär databas synkroniseras med primär.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="3cb16-143">hello nyckeln **fördelar** av det här designmönstret är:</span><span class="sxs-lookup"><span data-stu-id="3cb16-143">hello key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="3cb16-144">hello är samma webbprogram distribuerade tooboth regioner utan någon regionspecifika konfiguration och inga ytterligare logik tooreact toohello redundans.</span><span class="sxs-lookup"><span data-stu-id="3cb16-144">hello same web application is deployed tooboth regions without any region-specific configuration and no additional logic tooreact toohello failover.</span></span> 
* <span data-ttu-id="3cb16-145">hello programmets prestanda påverkas inte av redundans som hello-webbprogram och hello databas är alltid samordnas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-145">hello application's performance is not impacted by failover as hello web application and hello database are always co-located.</span></span>

<span data-ttu-id="3cb16-146">hello huvudsakliga **förhållandet** är att hello redundant programmet instans i hello sekundär region används endast för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="3cb16-146">hello main **tradeoff** is that hello redundant application instance in hello secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="3cb16-147">Designmönstret 2: aktiv-aktiv distribution för belastningsutjämning för program</span><span class="sxs-lookup"><span data-stu-id="3cb16-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="3cb16-148">Det här alternativet för molnet disaster recovery fungerar bäst för program med hello följande egenskaper:</span><span class="sxs-lookup"><span data-stu-id="3cb16-148">This cloud disaster recovery option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="3cb16-149">Hög förhållandet mellan databasen läser toowrites</span><span class="sxs-lookup"><span data-stu-id="3cb16-149">High ratio of database reads toowrites</span></span>
* <span data-ttu-id="3cb16-150">Databasen läsa svarstiden är mer kritiska för hello slutanvändarens upplevelse än hello skrivfördröjningen</span><span class="sxs-lookup"><span data-stu-id="3cb16-150">Database read latency is more critical for hello end-user experience than hello write latency</span></span> 
* <span data-ttu-id="3cb16-151">Skrivskyddad logik kan skiljas från skrivskyddad logik med hjälp av en annan anslutningssträng</span><span class="sxs-lookup"><span data-stu-id="3cb16-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="3cb16-152">Skrivskyddad logik är inte beroende data synkroniseras fullständigt med hello senaste uppdateringarna</span><span class="sxs-lookup"><span data-stu-id="3cb16-152">Read-only logic does not depend on data being fully synchronized with hello latest updates</span></span>  

<span data-ttu-id="3cb16-153">Om dina program har följande egenskaper, belastningsutjämning hello slutanvändarens anslutningar mellan flera programinstanser i olika regioner kan avsevärt förbättra hello övergripande slutanvändarens upplevelse.</span><span class="sxs-lookup"><span data-stu-id="3cb16-153">If your applications have these characteristics, load balancing hello end-user connections across multiple application instances in different regions can substantially improve hello overall end-user experience.</span></span> <span data-ttu-id="3cb16-154">Två av hello regioner är markerat som hello DR-par och hello redundans gruppen bör innehålla hello databaser i dessa regioner.</span><span class="sxs-lookup"><span data-stu-id="3cb16-154">Two of hello regions should be selected as hello DR pair and hello failover group should include hello databases in these regions.</span></span> <span data-ttu-id="3cb16-155">tooimplement belastningsutjämning, bör varje region har en aktiv instans av programmet hello med hello skrivskyddad (RW) logik anslutna toohello skrivskyddad lyssnare slutpunkt hello redundans gruppen.</span><span class="sxs-lookup"><span data-stu-id="3cb16-155">tooimplement load-balancing, each region should have an active instance of hello application with hello read-write (RW) logic connected toohello read-write listener endpoint of hello failover group.</span></span> <span data-ttu-id="3cb16-156">Det garanterar att hello redundansväxlingen automatiskt initieras om hello primära databasen påverkas av ett avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-156">It will guarantee that hello failover will be automatically initiated if hello primary database is impacted by an outage.</span></span> <span data-ttu-id="3cb16-157">hello skrivskyddad logiken (RO) i hello webbprogram ska ansluta direkt toohello databasen i den regionen.</span><span class="sxs-lookup"><span data-stu-id="3cb16-157">hello read-only logic (RO) in hello web application should connect directly toohello database in that region.</span></span> <span data-ttu-id="3cb16-158">Traffic manager ska ställas in toouse [prestanda routning](../traffic-manager/traffic-manager-configure-performance-routing-method.md) med [slutpunkt övervakning](../traffic-manager/traffic-manager-monitoring.md) aktiverat för varje förekomst av programmet.</span><span class="sxs-lookup"><span data-stu-id="3cb16-158">Traffic manager should be set up toouse [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="3cb16-159">Som i mönstret #1, bör du distribuera en liknande övervakningsprogram.</span><span class="sxs-lookup"><span data-stu-id="3cb16-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="3cb16-160">Men till skillnad från mönstret #1 hello övervakning av program kan inte ansvarar för att utlösa hello slutpunkt redundans.</span><span class="sxs-lookup"><span data-stu-id="3cb16-160">But unlike pattern #1, hello monitoring application will not be responsible for triggering hello end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="3cb16-161">När det här mönstret använder mer än en sekundär databas, endast hello sekundär i Region B ska användas för redundans och ska vara en del av hello redundansväxlingsgrupp.</span><span class="sxs-lookup"><span data-stu-id="3cb16-161">While this pattern uses more than one secondary database, only hello secondary in Region B  would be used for failover and should be part of hello failover group.</span></span>
>

<span data-ttu-id="3cb16-162">Traffic manager ska konfigureras för prestanda routning toodirect hello användare anslutningar toohello programmet instans närmaste toohello användarens geografisk plats.</span><span class="sxs-lookup"><span data-stu-id="3cb16-162">Traffic manager should be configured for performance routing toodirect hello user connections toohello application instance closest toohello user's geographic location.</span></span> <span data-ttu-id="3cb16-163">hello följande diagram illustrerar den här konfigurationen innan ett avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-163">hello following diagram illustrates this configuration before an outage.</span></span>

![Inga avbrott: prestanda routning toonearest program.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="3cb16-166">Om ett avbrott i databasen har upptäckts i hello region A hello redundans gruppen automatiskt att starta redundans för hello primära databasen i region A toohello sekundär region B. Hello skrivskyddad lyssnare endpoint tooregion B uppdateras automatiskt så att läsa / skriva-anslutningar i hello webbprogram inte påverkas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-166">If a database outage is detected in hello region A, hello failover group will automatically initiate failover of hello primary database in region A toohello secondary in region B. It will also automatically update hello read-write listener endpoint tooregion B so read-write connections in hello web application will not be impacted.</span></span> <span data-ttu-id="3cb16-167">hello traffic manager utesluta hello offline slutpunkt från hello routningstabellen men fortsätter routning hello slutanvändarens trafik toohello återstående instanser online.</span><span class="sxs-lookup"><span data-stu-id="3cb16-167">hello traffic manager will exclude hello offline end-point from hello routing table but will continue routing hello end-user traffic toohello remaining online instances.</span></span> <span data-ttu-id="3cb16-168">hello skrivskyddad SQL-anslutningssträngar påverkas inte samma som de alltid toohello databasen i hello samma region.</span><span class="sxs-lookup"><span data-stu-id="3cb16-168">hello read-only SQL connection strings will not be impacted as they always point toohello database in hello same region.</span></span> 

<span data-ttu-id="3cb16-169">hello följande diagram illustrerar hello ny konfiguration efter hello växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="3cb16-169">hello following diagram illustrates hello new configuration after hello failover.</span></span>

![Konfiguration efter växling vid fel.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="3cb16-172">Vid ett avbrott i någon av hello sekundära regioner tar hello traffic manager automatiskt bort hello offline slutpunkt i regionen från hello-routningstabell.</span><span class="sxs-lookup"><span data-stu-id="3cb16-172">In case of an outage in one of hello secondary regions, hello traffic manager will automatically remove hello offline end-point in that region from hello routing table.</span></span> <span data-ttu-id="3cb16-173">hello replikering kanal toohello sekundär databas i den regionen kommer att inaktiveras.</span><span class="sxs-lookup"><span data-stu-id="3cb16-173">hello replication channel toohello secondary database in that region will be suspended.</span></span> <span data-ttu-id="3cb16-174">Eftersom hello återstående regioner få ytterligare användartrafiken i det här scenariot, påverkas hello programmets prestanda under hello avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-174">Because hello remaining regions get additional user traffic in this scenario, hello application's performance will be impacted during hello outage.</span></span> <span data-ttu-id="3cb16-175">När hello avbrott minskas synkroniseras hello sekundär databas i hello påverkas region omedelbart med hello primära.</span><span class="sxs-lookup"><span data-stu-id="3cb16-175">Once hello outage is mitigated, hello secondary database in hello impacted region will be immediately synchronized with hello primary.</span></span> <span data-ttu-id="3cb16-176">Under hello gick synkroniseringsprestanda för hello primära något påverkas beroende på hello mängden data som behöver toobe synkroniseras.</span><span class="sxs-lookup"><span data-stu-id="3cb16-176">During hello synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="3cb16-177">hello följande diagram illustrerar ett avbrott i region B.</span><span class="sxs-lookup"><span data-stu-id="3cb16-177">hello following diagram illustrates an outage in region B.</span></span>

![Avbrott i sekundär region.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="3cb16-180">hello nyckeln **nytta** för den här designen mönstret är att du kan skala hello programmet arbetsbelastningen över flera sekundärservrar tooachieve hello slutanvändarens optimala prestanda.</span><span class="sxs-lookup"><span data-stu-id="3cb16-180">hello key **advantage** of this design pattern is that you can scale hello application workload across multiple secondaries tooachieve hello optimal end-user performance.</span></span> <span data-ttu-id="3cb16-181">Hej **kompromisser** detta alternativ är:</span><span class="sxs-lookup"><span data-stu-id="3cb16-181">hello **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="3cb16-182">Skrivskyddad anslutningar mellan programinstanser hello och databasen har olika svarstid och kostnad</span><span class="sxs-lookup"><span data-stu-id="3cb16-182">Read-write connections between hello application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="3cb16-183">Programmets prestanda påverkas under hello avbrott</span><span class="sxs-lookup"><span data-stu-id="3cb16-183">Application performance is impacted during hello outage</span></span>

> [!NOTE]
> <span data-ttu-id="3cb16-184">Ett liknande sätt kan användas för toooffload specialiserade arbetsbelastningar som rapportering jobb, verktyg för business intelligence eller säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="3cb16-184">A similar approach can be used toooffload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="3cb16-185">Normalt dessa arbetsbelastningar använder betydande databasresurser därför rekommenderas det att du anger en hello sekundära databaser för dem med hello prestanda nivån matchade toohello förväntade arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="3cb16-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of hello secondary databases for them with hello performance level matched toohello anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="3cb16-186">Designmönstret 3: aktivt-passivt distribution för förvaring av data</span><span class="sxs-lookup"><span data-stu-id="3cb16-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="3cb16-187">Det här alternativet fungerar bäst för program med hello följande egenskaper:</span><span class="sxs-lookup"><span data-stu-id="3cb16-187">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="3cb16-188">Dataförlust är viktiga för verksamheten risk.</span><span class="sxs-lookup"><span data-stu-id="3cb16-188">Any data loss is high business risk.</span></span> <span data-ttu-id="3cb16-189">hello databasfel kan endast användas som en sista utväg om hello avbrott är oåterkalleligt.</span><span class="sxs-lookup"><span data-stu-id="3cb16-189">hello database failover can only be used as a last resort if hello outage is catastrophic.</span></span>
* <span data-ttu-id="3cb16-190">hello-programmet stöder skrivskyddade och läsa / skriva-lägen för åtgärder och kan köras ”skrivskyddad” för en viss tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="3cb16-190">hello application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="3cb16-191">I det här mönstret växlar programmet hello läget endast tooread när hello skrivskyddad anslutningar börja få timeout-fel.</span><span class="sxs-lookup"><span data-stu-id="3cb16-191">In this pattern, hello application switches tooread-only mode when hello read-write connections start getting time-out errors.</span></span> <span data-ttu-id="3cb16-192">hello webbprogram är distribuerade tooboth regioner och innehåller en anslutning toohello skrivskyddad lyssnare slutpunkt och en annan anslutning toohello skrivskyddad lyssnare slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="3cb16-192">hello Web Application is deployed tooboth regions and include a connection toohello read-write listener endpoint and different connection toohello read-only listener endpoint.</span></span> <span data-ttu-id="3cb16-193">hello Traffic manager ska ställas in toouse [redundans routning](../traffic-manager/traffic-manager-configure-failover-routing-method.md) med [slutpunkt övervakning](../traffic-manager/traffic-manager-monitoring.md) aktiverad för hello programslutpunkt i varje region.</span><span class="sxs-lookup"><span data-stu-id="3cb16-193">hello Traffic manager should be set up toouse [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for hello application endpoint in each region.</span></span>

<span data-ttu-id="3cb16-194">hello följande diagram illustrerar den här konfigurationen innan ett avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-194">hello following diagram illustrates this configuration before an outage.</span></span>

![Aktivt-passivt distribution före redundans.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="3cb16-197">När hello traffic manager upptäcker en anslutning fel tooregion A, växlar automatiskt trafiken toohello programmet användarinstans i region B. Med det här mönstret är det viktigt att du ställer in hello respitperioden med förlust tooa tillräckligt högt värde, t.ex. 24 timmar.</span><span class="sxs-lookup"><span data-stu-id="3cb16-197">When hello traffic manager detects a connectivity failure tooregion A, it automatically switches user traffic toohello application instance in region B. With this pattern, it is important that you set hello grace period with data loss tooa sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="3cb16-198">Det garanterar att data går förlorade förhindras om hello avbrott minskas inom den tiden.</span><span class="sxs-lookup"><span data-stu-id="3cb16-198">It will ensure that data loss is prevented if hello outage is mitigated within that time.</span></span> <span data-ttu-id="3cb16-199">När hello webbprogram i hello region B är aktiverad startar hello Läs-och skrivåtgärder misslyckas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-199">When hello Web application in hello region B is activated hello read-write operations will start failing.</span></span> <span data-ttu-id="3cb16-200">Då ska den växla toohello skrivskyddat läge.</span><span class="sxs-lookup"><span data-stu-id="3cb16-200">At that point, it should switch toohello read-only mode.</span></span> <span data-ttu-id="3cb16-201">I det här läget hello begäranden inte automatiskt routade toohello sekundär databas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-201">In this mode hello requests will be automatically routed toohello secondary database.</span></span> <span data-ttu-id="3cb16-202">Hello gäller ett katastrofalt fel hello avbrott inte ska undvikas inom respitperioden hello och hello redundansväxlingsgrupp utlöser hello växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="3cb16-202">In hello case of a catastrophic failure hello outage will not be mitigated within hello grace period and hello failover group will trigger hello failover.</span></span> <span data-ttu-id="3cb16-203">Efter att hello skrivskyddad lyssnare blir tillgängliga och hello anrop tooit stoppas misslyckas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-203">After that hello read-write listener will become available and hello calls tooit will stop failing.</span></span> <span data-ttu-id="3cb16-204">Detta visas hello följande diagram.</span><span class="sxs-lookup"><span data-stu-id="3cb16-204">This is illustrated by hello following diagram.</span></span>

![Avbrott: Programmet i skrivskyddat läge.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="3cb16-207">Om hello avbrott i hello primära region minskas inom respitperioden hello traffic manager identifierar hello återställning av anslutning i hello primär region och växlar trafiken tillbaka toohello programmet användarinstans i region A. Den programinstansen återgår och körs i läsa / skriva-läge med hjälp av hello primära databasen i region A.</span><span class="sxs-lookup"><span data-stu-id="3cb16-207">If hello outage in hello primary region is mitigated within hello grace period, traffic manager detects hello restoration of connectivity in hello primary region and switches user traffic back toohello application instance in region A. That application instance resumes and operates in read-write mode using hello primary database in region A.</span></span>

<span data-ttu-id="3cb16-208">Vid ett strömavbrott i hello region B identifierar hello traffic manager hello fel i hello programmet slutpunkt i region B och hello redundans gruppen växlar hello skrivskyddad lyssnare tooregion A. Den här avbrott påverkar inte hello slutanvändarens upplevelse men hello primära databasen kommer att exponeras under hello avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-208">In case of an outage in hello region B, hello traffic manager detects hello failure of hello application end-point in region B and hello failover group switches hello read-only listener tooregion A. This outage does not impact hello end-user experience but hello primary database will be exposed during hello outage.</span></span> <span data-ttu-id="3cb16-209">Detta visas hello följande diagram.</span><span class="sxs-lookup"><span data-stu-id="3cb16-209">This is illustrated by hello following diagram.</span></span>

![Avbrott: Sekundär databas.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="3cb16-212">När hello avbrott minskas hello sekundära databasen synkroniseras omedelbart med hello primära och hello skrivskyddad lyssnare är avstängda tillbaka toohello sekundär databas i region B. Under synkroniseringen gick av hello primära något påverkas databasprestanda beroende på hello mängden data som behöver toobe synkroniseras.</span><span class="sxs-lookup"><span data-stu-id="3cb16-212">Once hello outage is mitigated, hello secondary database is immediately synchronized with hello primary and hello read-only listener is switched back toohello secondary database in region B. During synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span>

<span data-ttu-id="3cb16-213">Det här designmönstret har flera **fördelar**:</span><span class="sxs-lookup"><span data-stu-id="3cb16-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="3cb16-214">Den förhindrar dataförlust under hello tillfälliga avbrott.</span><span class="sxs-lookup"><span data-stu-id="3cb16-214">It avoids data loss during hello temporary outages.</span></span>
* <span data-ttu-id="3cb16-215">Driftstopp beror på hur snabbt traffic manager identifierar hello anslutningsfel, som kan konfigureras.</span><span class="sxs-lookup"><span data-stu-id="3cb16-215">Downtime depends only on how quickly traffic manager detects hello connectivity failure, which is configurable.</span></span>

<span data-ttu-id="3cb16-216">Hej **förhållandet** är:</span><span class="sxs-lookup"><span data-stu-id="3cb16-216">hello **tradeoff** is:</span></span>

* <span data-ttu-id="3cb16-217">Programmet måste vara kan toooperate i skrivskyddat läge.</span><span class="sxs-lookup"><span data-stu-id="3cb16-217">Application must be able toooperate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="3cb16-218">Vid en permanent avbrott i hello region du manuellt Aktivera databasen redundans och accepterar hello dataförlust.</span><span class="sxs-lookup"><span data-stu-id="3cb16-218">In case of a permanent service outage in hello region, you manually activate database failover and accept hello data loss.</span></span> <span data-ttu-id="3cb16-219">hello programmet kommer att fungera i hello sekundär region med läs-/ skrivåtkomst toohello databas.</span><span class="sxs-lookup"><span data-stu-id="3cb16-219">hello application will be functional in hello secondary region with read-write access toohello database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="3cb16-220">Kontinuitet planering: Välj en design för programmet för katastrofåterställning i molnet</span><span class="sxs-lookup"><span data-stu-id="3cb16-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="3cb16-221">Din strategi för katastrofåterställning specifika molnet kan kombinera eller utöka dessa designmönster toobest hello uppfyller behoven för ditt program.</span><span class="sxs-lookup"><span data-stu-id="3cb16-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns toobest meet hello needs of your application.</span></span>  <span data-ttu-id="3cb16-222">Som tidigare nämnts är hello strategi som du väljer baserad på hello SLA och du vill toooffer tooyour kunder hello topologi för distribution av programmet.</span><span class="sxs-lookup"><span data-stu-id="3cb16-222">As mentioned earlier, hello strategy you choose is based on hello SLA you want toooffer tooyour customers and hello application deployment topology.</span></span> <span data-ttu-id="3cb16-223">toohelp hjälper ditt beslut, hello följande tabell jämförs hello alternativ baserat på hello uppskattade data förlust eller återställning mål för återställningspunkt (RPO) och uppskattade återställningstid (Infoga).</span><span class="sxs-lookup"><span data-stu-id="3cb16-223">toohelp guide your decision, hello following table compares hello choices based on hello estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="3cb16-224">Mönstret</span><span class="sxs-lookup"><span data-stu-id="3cb16-224">Pattern</span></span> | <span data-ttu-id="3cb16-225">ÅTERSTÄLLNINGSPUNKTMÅL</span><span class="sxs-lookup"><span data-stu-id="3cb16-225">RPO</span></span> | <span data-ttu-id="3cb16-226">INFOGA</span><span class="sxs-lookup"><span data-stu-id="3cb16-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="3cb16-227">Aktivt-passivt distribution för katastrofåterställning med samordnade databasåtkomst</span><span class="sxs-lookup"><span data-stu-id="3cb16-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="3cb16-228">Läs-/ skrivåtkomst < 5 SEK.</span><span class="sxs-lookup"><span data-stu-id="3cb16-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="3cb16-229">Fel identifieringstiden + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="3cb16-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="3cb16-230">Aktiv-aktiv distribution för belastningsutjämning för program</span><span class="sxs-lookup"><span data-stu-id="3cb16-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="3cb16-231">Läs-/ skrivåtkomst < 5 SEK.</span><span class="sxs-lookup"><span data-stu-id="3cb16-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="3cb16-232">Fel identifieringstiden + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="3cb16-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="3cb16-233">Aktivt-passivt distribution för förvaring av data</span><span class="sxs-lookup"><span data-stu-id="3cb16-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="3cb16-234">Skrivskyddad åtkomst < 5 SEK.</span><span class="sxs-lookup"><span data-stu-id="3cb16-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="3cb16-235">Skrivskyddad åtkomst = 0</span><span class="sxs-lookup"><span data-stu-id="3cb16-235">Read-only access = 0</span></span> |
||<span data-ttu-id="3cb16-236">Läs-/ skrivåtkomst = noll</span><span class="sxs-lookup"><span data-stu-id="3cb16-236">Read-write access = zero</span></span> | <span data-ttu-id="3cb16-237">Läs-/ skrivåtkomst = fel identifieringstiden + respitperioden med dataförlust</span><span class="sxs-lookup"><span data-stu-id="3cb16-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="3cb16-238">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="3cb16-238">Next steps</span></span>
* <span data-ttu-id="3cb16-239">toolearn om Azure SQL Database automatisk säkerhetskopiering finns [SQL-databas automatisk säkerhetskopiering](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="3cb16-239">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="3cb16-240">En översikt över verksamhetskontinuitet och scenarier finns [översikt över verksamhetskontinuitet](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="3cb16-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="3cb16-241">toolearn om hur du använder automatisk säkerhetskopiering för återställning finns [återställa en databas från hello service-initierad säkerhetskopiering](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="3cb16-241">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="3cb16-242">toolearn om snabbare återställningsalternativ finns [aktiv geo-replikering](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="3cb16-242">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="3cb16-243">toolearn om hur du använder automatisk säkerhetskopiering för arkivering, se [databaskopieringen](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="3cb16-243">toolearn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="3cb16-244">Information om aktiv geo-replikering med elastiska pooler finns [elastisk Pool strategi för katastrofåterställning](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="3cb16-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
