---
title: "aaaUsing klientbibliotek för elastisk databas med Dapper | Microsoft Docs"
description: "Med Dapper klientbibliotek för elastisk databas."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="94e0f-103">Med Dapper klientbibliotek för elastisk databas</span><span class="sxs-lookup"><span data-stu-id="94e0f-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="94e0f-104">Det här dokumentet är för utvecklare som förlitar sig på Dapper toobuild program, men också tooembrace [elastisk databas-tooling](sql-database-elastic-scale-introduction.md) toocreate program som implementerar horisontell partitionering tooscale ut sina datanivå.</span><span class="sxs-lookup"><span data-stu-id="94e0f-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="94e0f-105">Det här dokumentet visar hello ändringar i Dapper-baserade program som är nödvändiga toointegrate med elastiska Databasverktyg.</span><span class="sxs-lookup"><span data-stu-id="94e0f-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="94e0f-106">Vår fokus på fastställdes hello elastisk databas Fragmentera hanterings- och beroende routning med Dapper.</span><span class="sxs-lookup"><span data-stu-id="94e0f-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="94e0f-107">**Exempelkoden**: [elastisk Databasverktyg för Azure SQL Database - Dapper integrering](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="94e0f-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="94e0f-108">Integrera **Dapper** och **DapperExtensions** med hello klientbibliotek för elastisk databas för Azure SQL Database är enkelt.</span><span class="sxs-lookup"><span data-stu-id="94e0f-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="94e0f-109">Dina program kan använda data beroende routning genom att ändra hello skapa och öppna i nytt [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekt toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) anropa från hello [klienten biblioteket](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="94e0f-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="94e0f-110">Detta begränsar ändringar i dina program tooonly där nya anslutningar skapas och öppnas.</span><span class="sxs-lookup"><span data-stu-id="94e0f-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="94e0f-111">Dapper översikt</span><span class="sxs-lookup"><span data-stu-id="94e0f-111">Dapper overview</span></span>
<span data-ttu-id="94e0f-112">**Dapper** är en Objektrelationer mappning.</span><span class="sxs-lookup"><span data-stu-id="94e0f-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="94e0f-113">.NET-objekt från ditt program tooa relationsdatabas (och vice versa) mappas.</span><span class="sxs-lookup"><span data-stu-id="94e0f-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="94e0f-114">hello första delen av hello exempelkod visar hur du kan integrera hello klientbibliotek för elastisk databas med Dapper-baserade program.</span><span class="sxs-lookup"><span data-stu-id="94e0f-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="94e0f-115">hello andra delen av hello exempelkod visar hur toointegrate när du använder både Dapper och DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="94e0f-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="94e0f-116">hello mapper funktioner i Dapper innehåller tilläggsmetoder om databasanslutningar som förenklar skickar T-SQL-uttryck för körning eller frågor hello-databasen.</span><span class="sxs-lookup"><span data-stu-id="94e0f-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="94e0f-117">Till exempel Dapper gör det enkelt toomap mellan .NET-objekt och hello parametrar för SQL-uttryck för **kör** samtal eller tooconsume hello resultatet av dina SQL-frågor till .NET-objekt med hjälp av **frågan**anrop från Dapper.</span><span class="sxs-lookup"><span data-stu-id="94e0f-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="94e0f-118">När du använder DapperExtensions, behöver du inte längre tooprovide hello SQL-instruktioner.</span><span class="sxs-lookup"><span data-stu-id="94e0f-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="94e0f-119">Tillägg metoder som **GetList** eller **infoga** över hello databasanslutning skapa hello SQL-instruktioner hello bakgrunden.</span><span class="sxs-lookup"><span data-stu-id="94e0f-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="94e0f-120">En annan fördel med Dapper och DapperExtensions är att hello programkontroller hello skapandet av hello databasanslutning.</span><span class="sxs-lookup"><span data-stu-id="94e0f-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="94e0f-121">På så sätt kan interagera med klientbiblioteket för hello elastisk databas som mäklare databasanslutningar baserat på hello mappningen av shardlets toodatabases.</span><span class="sxs-lookup"><span data-stu-id="94e0f-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="94e0f-122">tooget hello Dapper sammansättningar, se [Dapper punkt net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="94e0f-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="94e0f-123">Hej Dapper tillägg, se [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="94e0f-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="94e0f-124">En titt på hello klientbibliotek för elastisk databas</span><span class="sxs-lookup"><span data-stu-id="94e0f-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="94e0f-125">Du kan definiera partitioner för dina programdata som kallas med hello klientbibliotek för elastisk databas, *shardlets* , mappa dem toodatabases och identifiera dem genom *horisontell partitionering nycklar*.</span><span class="sxs-lookup"><span data-stu-id="94e0f-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="94e0f-126">Du kan ha valfritt antal databaser du behöver och distribuera din shardlets mellan dessa databaser.</span><span class="sxs-lookup"><span data-stu-id="94e0f-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="94e0f-127">hello-mappningen för horisontell partitionering nyckelvärden toohello databaser lagras av en Fragmentera karta som tillhandahålls av hello biblioteket API: er.</span><span class="sxs-lookup"><span data-stu-id="94e0f-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="94e0f-128">Den här funktionen kallas **Fragmentera kartan management**.</span><span class="sxs-lookup"><span data-stu-id="94e0f-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="94e0f-129">hello Fragmentera kartan fungerar också som hello broker till databaser för begäranden som innehåller en nyckel för horisontell partitionering.</span><span class="sxs-lookup"><span data-stu-id="94e0f-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="94e0f-130">Den här funktionen är refererad tooas **data beroende routning**.</span><span class="sxs-lookup"><span data-stu-id="94e0f-130">This capability is referred tooas **data dependent routing**.</span></span>

![Fragmentera mappar och data beroende Routning][1]

<span data-ttu-id="94e0f-132">hello Fragmentera kartan manager skyddar användare från inkonsekvent vyer i shardlet data som kan uppstå när samtidiga shardlet hanteringsåtgärder sker på hello-databaser.</span><span class="sxs-lookup"><span data-stu-id="94e0f-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="94e0f-133">toodo hello så Fragmentera maps broker hello anslutningar för ett program som skapats med hello-biblioteket.</span><span class="sxs-lookup"><span data-stu-id="94e0f-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="94e0f-134">Fragmentera hanteringsåtgärder kan påverka hello shardlet, kan hello Fragmentera kartan funktioner tooautomatically kill en databasanslutning.</span><span class="sxs-lookup"><span data-stu-id="94e0f-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="94e0f-135">Istället för att använda hello traditionella sätt toocreate anslutningar för Dapper måste toouse hello [OpenConnectionForKey metoden](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="94e0f-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="94e0f-136">Detta säkerställer att alla hello validering sker och anslutningar hanteras korrekt när data flyttas mellan shards.</span><span class="sxs-lookup"><span data-stu-id="94e0f-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="94e0f-137">Krav för Dapper integrering</span><span class="sxs-lookup"><span data-stu-id="94e0f-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="94e0f-138">När du arbetar med både hello klientbibliotek för elastisk databas och hello Dapper API: er kan vill vi tooretain hello följande egenskaper:</span><span class="sxs-lookup"><span data-stu-id="94e0f-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="94e0f-139">**Scaleout**: vi vill tooadd eller ta bort databaser från hello datanivå hello delat tillämpas efter behov för hello kapacitetskraven hello program.</span><span class="sxs-lookup"><span data-stu-id="94e0f-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="94e0f-140">**Konsekvenskontroll**: eftersom vårt program utskalad med horisontell partitionering, behöver vi tooperform data beroende routning.</span><span class="sxs-lookup"><span data-stu-id="94e0f-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="94e0f-141">Vi vill toouse hello Data beroende funktioner för hello biblioteket toodo så.</span><span class="sxs-lookup"><span data-stu-id="94e0f-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="94e0f-142">I synnerhet vi vill tooretain hello validering och konsekvens garanterar tillhandahålls av anslutningar som asynkrona via hello Fragmentera kartan manager i ordning tooavoid skadas eller fel frågeresultat.</span><span class="sxs-lookup"><span data-stu-id="94e0f-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="94e0f-143">Detta säkerställer att anslutningar tooa angivna shardlet avvisade eller stoppas om (till exempel) hello shardlet är för närvarande har flyttats tooa olika Fragmentera med delade/Merge API: er.</span><span class="sxs-lookup"><span data-stu-id="94e0f-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="94e0f-144">**Objektmappningen**: vi vill tooretain hello bekvämlighet hello mappningar som tillhandahålls av Dapper tootranslate mellan klasser i hello program och hello underliggande databasstrukturer.</span><span class="sxs-lookup"><span data-stu-id="94e0f-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="94e0f-145">hello följande avsnitt innehåller information om kraven för programmen baserat på **Dapper** och **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="94e0f-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="94e0f-146">Teknisk information</span><span class="sxs-lookup"><span data-stu-id="94e0f-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="94e0f-147">Data beroende routning med Dapper</span><span class="sxs-lookup"><span data-stu-id="94e0f-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="94e0f-148">Med Dapper ansvarar hello-programmet vanligtvis för att skapa och öppna hello anslutningar toohello underliggande databasen.</span><span class="sxs-lookup"><span data-stu-id="94e0f-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="94e0f-149">Typ T som angetts av hello program, returnerar Dapper frågeresultat som .NET samlingar av typen T. Dapper utför hello mappning från hello T-SQL resultatet rader toohello objekt av typen T. På liknande sätt mappar Dapper .NET-objekt till SQL-värden eller parametrar för uttryck data manipulation language (DML).</span><span class="sxs-lookup"><span data-stu-id="94e0f-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="94e0f-150">Dapper erbjuder den här funktionen via tilläggsmetoder på hello regelbundna [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekt från hello ADO .NET SQL klientbibliotek.</span><span class="sxs-lookup"><span data-stu-id="94e0f-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="94e0f-151">hello SQL-anslutning som returneras av hello Elastic Scale API: er för DDR är också regelbundna [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekt.</span><span class="sxs-lookup"><span data-stu-id="94e0f-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="94e0f-152">Detta gör att vi toodirectly Använd Dapper tillägg över hello-typen som returnerades av hello-klientbiblioteket DDR-API, eftersom det är en enkel anslutning för SQL-klienten.</span><span class="sxs-lookup"><span data-stu-id="94e0f-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="94e0f-153">Dessa observationer gör det enkelt toouse anslutningar asynkrona av hello klientbibliotek för elastisk databas för Dapper.</span><span class="sxs-lookup"><span data-stu-id="94e0f-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="94e0f-154">Det här kodexemplet (från hello tillhörande exempel) illustrerar hello metod där hello horisontell partitionering nyckeln tillhandahålls av hello programmet toohello biblioteket toobroker hello anslutning toohello rätt Fragmentera.</span><span class="sxs-lookup"><span data-stu-id="94e0f-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="94e0f-155">hello anropet toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API ersätter hello standard skapas eller öppnas av en SQL-klientanslutning.</span><span class="sxs-lookup"><span data-stu-id="94e0f-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="94e0f-156">Hej [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) anrop tar hello-argument som krävs för data beroende routning:</span><span class="sxs-lookup"><span data-stu-id="94e0f-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="94e0f-157">hello Fragmentera kartan tooaccess hello beroende routning gränssnitt för data</span><span class="sxs-lookup"><span data-stu-id="94e0f-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="94e0f-158">hello horisontell partitionering viktiga tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="94e0f-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="94e0f-159">hello autentiseringsuppgifter (användarnamn och lösenord) tooconnect toohello Fragmentera</span><span class="sxs-lookup"><span data-stu-id="94e0f-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="94e0f-160">hello Fragmentera kartan objektet skapar en anslutning toohello Fragmentera som innehåller hello shardlet för hello angivna horisontell partitionering nyckel.</span><span class="sxs-lookup"><span data-stu-id="94e0f-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="94e0f-161">hello elastisk databas-klientens API: er tagga också hello anslutning tooimplement dess konsekvens garanterar.</span><span class="sxs-lookup"><span data-stu-id="94e0f-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="94e0f-162">Eftersom hello anropa för[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returnerar en vanlig SQL objekt för klientanslutning, hello efterföljande anrop toohello **Execute** metod från Dapper sätt hello standard Dapper praxis.</span><span class="sxs-lookup"><span data-stu-id="94e0f-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="94e0f-163">Frågor arbete mycket hello samma sätt – du först öppna hello anslutning med [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) från hello klient API.</span><span class="sxs-lookup"><span data-stu-id="94e0f-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="94e0f-164">Du kan använda hello regelbundna Dapper tillägget metoder toomap hello resultaten av SQL-frågan i .NET-objekt:</span><span class="sxs-lookup"><span data-stu-id="94e0f-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="94e0f-165">Observera att hello **med** med hello DDR anslutning scope blockera alla databasåtgärder i hello block toohello en Fragmentera där tenantId1 sparas.</span><span class="sxs-lookup"><span data-stu-id="94e0f-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="94e0f-166">hello frågan returnerar endast bloggar som lagras på hello aktuella Fragmentera, men inte hello som finns på andra delar.</span><span class="sxs-lookup"><span data-stu-id="94e0f-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="94e0f-167">Data beroende routning med Dapper och DapperExtensions</span><span class="sxs-lookup"><span data-stu-id="94e0f-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="94e0f-168">Dapper levereras med en ekosystem med ytterligare filnamnstillägg som kan ge ytterligare underlätta för dig och abstraction från hello databas när du utvecklar databasprogram.</span><span class="sxs-lookup"><span data-stu-id="94e0f-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="94e0f-169">DapperExtensions är ett exempel.</span><span class="sxs-lookup"><span data-stu-id="94e0f-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="94e0f-170">Med hjälp av DapperExtensions i ditt program ändrar inte hur databasanslutningar skapas och hanteras.</span><span class="sxs-lookup"><span data-stu-id="94e0f-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="94e0f-171">Det är fortfarande hello programmet ansvar tooopen anslutningar och regelbundna SQL Client anslutningsobjekt förväntas av hello tilläggsmetoder.</span><span class="sxs-lookup"><span data-stu-id="94e0f-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="94e0f-172">Vi kan utgå ifrån hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) som beskrivs ovan.</span><span class="sxs-lookup"><span data-stu-id="94e0f-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="94e0f-173">Som hello visar följande kodexempel hello enda förändringen är att det inte längre finns toowrite hello T-SQL-uttryck:</span><span class="sxs-lookup"><span data-stu-id="94e0f-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="94e0f-174">Och här är hello kodexempel för hello-frågan:</span><span class="sxs-lookup"><span data-stu-id="94e0f-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="94e0f-175">Hantering av tillfälliga problem</span><span class="sxs-lookup"><span data-stu-id="94e0f-175">Handling transient faults</span></span>
<span data-ttu-id="94e0f-176">hello Microsoft Patterns & praxis gruppmedlemmarna publicerade hello [tillfälliga fel hanterar programmet Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp programutvecklare minimera vanliga tillfälligt fel villkor uppstod när körs i hello moln.</span><span class="sxs-lookup"><span data-stu-id="94e0f-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="94e0f-177">Mer information finns i [Perseverance, hemligheten för alla framgångar: med hello tillfälliga fel hanterar programmet Block](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="94e0f-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="94e0f-178">hello kodexempel är beroende av hello tillfälligt fel biblioteket tooprotect mot tillfälliga problem.</span><span class="sxs-lookup"><span data-stu-id="94e0f-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="94e0f-179">**SqlDatabaseUtils.SqlRetryPolicy** i hello koden ovan har definierats som en **SqlDatabaseTransientErrorDetectionStrategy** med ett återförsöksvärde på 10 och 5 sekunder väntetid mellan återförsök.</span><span class="sxs-lookup"><span data-stu-id="94e0f-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="94e0f-180">Om du använder transaktioner, se till att ditt försök omfång återgår toohello i början av hello transaktion i hello fall av ett tillfälligt fel.</span><span class="sxs-lookup"><span data-stu-id="94e0f-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="94e0f-181">Begränsningar</span><span class="sxs-lookup"><span data-stu-id="94e0f-181">Limitations</span></span>
<span data-ttu-id="94e0f-182">hello-metoder som beskrivs i det här dokumentet medför några begränsningar:</span><span class="sxs-lookup"><span data-stu-id="94e0f-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="94e0f-183">hello exempelkod för det här dokumentet visar inte hur toomanage schema över shards.</span><span class="sxs-lookup"><span data-stu-id="94e0f-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="94e0f-184">Får en förfrågan antar vi att dess databasbearbetning ingår i en enda Fragmentera som identifieras av hello horisontell partitionering nyckel som tillhandahålls av hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="94e0f-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="94e0f-185">Men innehåller detta antagande inte alltid, till exempel när det inte är möjligt toomake en nyckel för horisontell partitionering som är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="94e0f-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="94e0f-186">tooaddress detta, hello klientbibliotek för elastisk databas innehåller hello [MultiShardQuery klassen](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="94e0f-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="94e0f-187">hello-klassen implementerar en anslutning abstraktion för frågor över flera delar.</span><span class="sxs-lookup"><span data-stu-id="94e0f-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="94e0f-188">Använda MultiShardQuery i kombination med Dapper ligger utanför hello i det här dokumentet.</span><span class="sxs-lookup"><span data-stu-id="94e0f-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="94e0f-189">Slutsats</span><span class="sxs-lookup"><span data-stu-id="94e0f-189">Conclusion</span></span>
<span data-ttu-id="94e0f-190">Program med hjälp av Dapper och DapperExtensions kan enkelt utnyttja elastisk Databasverktyg för Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="94e0f-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="94e0f-191">Via hello steg som beskrivs i det här dokumentet, programmen kan använda hello verktyget kapaciteten för data beroende routning genom att ändra hello skapa och öppna i nytt [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekt toouse hello [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) anrop av hello klientbibliotek för elastisk databas.</span><span class="sxs-lookup"><span data-stu-id="94e0f-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="94e0f-192">Detta begränsar hello programmet ändringar krävs toothose platser där nya anslutningar skapas och öppnas.</span><span class="sxs-lookup"><span data-stu-id="94e0f-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
