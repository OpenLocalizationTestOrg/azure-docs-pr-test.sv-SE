---
title: "SQL Database-katastrofåterställning | Microsoft Docs"
description: "Lär dig hur du återställer en databas från en regionala datacenter avbrott eller ett fel med Azure SQL Database aktiv geo-replikering och funktioner för geo-återställning."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: e33f69bf04b32a31aae3c311c41aa44e4da5016a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="restore-an-azure-sql-database-or-failover-to-a-secondary"></a><span data-ttu-id="a2e6b-103">Återställa en Azure SQL Database eller växling vid fel till en sekundär</span><span class="sxs-lookup"><span data-stu-id="a2e6b-103">Restore an Azure SQL Database or failover to a secondary</span></span>
<span data-ttu-id="a2e6b-104">Azure SQL-databasen innehåller följande funktioner för återställning efter ett avbrott:</span><span class="sxs-lookup"><span data-stu-id="a2e6b-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="a2e6b-105">Aktiv geo-replikering</span><span class="sxs-lookup"><span data-stu-id="a2e6b-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="a2e6b-106">GEO-återställning</span><span class="sxs-lookup"><span data-stu-id="a2e6b-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="a2e6b-107">Läs om business continuity scenarier och funktioner som stöder dessa scenarier i [företagskontinuitet](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-the-event-of-an-outage"></a><span data-ttu-id="a2e6b-108">Förbereda för händelse av ett avbrott</span><span class="sxs-lookup"><span data-stu-id="a2e6b-108">Prepare for the event of an outage</span></span>
<span data-ttu-id="a2e6b-109">För att lyckas med återställning till en annan dataområdet använder aktiv geo-replikering eller geo-redundant säkerhetskopior måste du förbereda en server i en annan Datacenter avbrott blir den nya primära servern senare om behovet uppstår samt ha väldefinierade steg dokumenterat och testats för att säkerställa en smidig.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-109">For success with recovery to another data region using either active geo-replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well-defined steps documented and tested to ensure a smooth recovery.</span></span> <span data-ttu-id="a2e6b-110">Dessa förberedelsesteg inkluderar:</span><span class="sxs-lookup"><span data-stu-id="a2e6b-110">These preparation steps include:</span></span>

* <span data-ttu-id="a2e6b-111">Identifiera den logiska servern i en annan region ska bli den nya primära servern.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-111">Identify the logical server in another region to become the new primary server.</span></span> <span data-ttu-id="a2e6b-112">Detta kan vara minst och kanske var och en av de sekundära servrarna med aktiv geo-replikering.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-112">With active geo-replication, this will be at least one and perhaps each of the secondary servers.</span></span> <span data-ttu-id="a2e6b-113">För geo-återställning, kommer detta vanligtvis att en server i den [parad region](../best-practices-availability-paired-regions.md) för den region där databasen är placerad.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-113">For geo-restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span></span>
* <span data-ttu-id="a2e6b-114">Identifiera och du kan också definiera servernivå brandväggsregler som behövs för användare att få åtkomst till den nya primära databasen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span></span>
* <span data-ttu-id="a2e6b-115">Bestämma hur du kommer att omdirigera användare till den nya primära servern, exempelvis genom att ändra anslutningssträngar eller genom att ändra DNS-poster.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="a2e6b-116">Identifiera och om du vill skapa de inloggningar som måste finnas i master-databasen på den nya primära servern och se till att dessa inloggningar behörighet i master-databasen, om sådana finns.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span></span> <span data-ttu-id="a2e6b-117">Mer information finns i [SQL Database-säkerhet efter återställning](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="a2e6b-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="a2e6b-118">Identifiera Varningsregler som måste uppdateras för att mappa till den nya primära databasen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-118">Identify alert rules that will need to be updated to map to the new primary database.</span></span>
* <span data-ttu-id="a2e6b-119">Dokumentet granskning konfigurationen på den aktuella primära databasen</span><span class="sxs-lookup"><span data-stu-id="a2e6b-119">Document the auditing configuration on the current primary database</span></span>
* <span data-ttu-id="a2e6b-120">Utföra en [disaster recovery ökad](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="a2e6b-121">För att simulera ett avbrott för geo-återställning, kan du ta bort eller byta namn på källdatabasen om du vill att programmet anslutningsfel.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-121">To simulate an outage for geo-restore, you can delete or rename the source database to cause application connectivity failure.</span></span> <span data-ttu-id="a2e6b-122">Om du vill simulera ett avbrott för aktiv geo-replikering kan inaktivera du webbprogram eller virtuella datorn är ansluten till databasen eller failover databasen om du vill att anslutningen programfel.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-122">To simulate an outage for active geo-replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectivity failures.</span></span>

## <a name="when-to-initiate-recovery"></a><span data-ttu-id="a2e6b-123">När du ska initiera återställningen</span><span class="sxs-lookup"><span data-stu-id="a2e6b-123">When to initiate recovery</span></span>
<span data-ttu-id="a2e6b-124">Återställningsåtgärden påverkar programmet.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-124">The recovery operation impacts the application.</span></span> <span data-ttu-id="a2e6b-125">Det innebär att du ändrar SQL-anslutningssträngen eller med hjälp av DNS-omdirigering och kan resultera i permanent dataförlust.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="a2e6b-126">Det bör därför göras endast när avbrottet kan pågå längre än mål för ditt program.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span></span> <span data-ttu-id="a2e6b-127">När programmet distribueras till produktion bör du utföra regelbundna övervakning av programmets hälsotillstånd och använder följande datapunkter för att bekräfta att återställningen garanteras:</span><span class="sxs-lookup"><span data-stu-id="a2e6b-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span></span>

1. <span data-ttu-id="a2e6b-128">Permanent anslutningsfel från programmet lager till databasen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-128">Permanent connectivity failure from the application tier to the database.</span></span>
2. <span data-ttu-id="a2e6b-129">Azure portal visas en avisering om en incident i region med bred påverkan.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-129">The Azure portal shows an alert about an incident in the region with broad impact.</span></span>
3. <span data-ttu-id="a2e6b-130">Azure SQL Database-server markeras som försämrad.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-130">The Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="a2e6b-131">Beroende på toleransvärde programmet driftstopp och möjliga ansvar för företag kan du överväga följande återställningsalternativ.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span></span>

<span data-ttu-id="a2e6b-132">Använd den [hämta återställningsbara databasen](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) att hämta den senaste georeplikerad återställningspunkten.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="a2e6b-133">Vänta tills tjänsten återställning</span><span class="sxs-lookup"><span data-stu-id="a2e6b-133">Wait for service recovery</span></span>
<span data-ttu-id="a2e6b-134">Azure team fungerar ordentligt för att återställa tjänsttillgänglighet så snabbt som möjligt, men beroende på roten orsaka det kan ta timmar eller dagar.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span></span>  <span data-ttu-id="a2e6b-135">Om ditt program kan tolerera betydande driftstopp kan du bara vänta för att slutföra återställningen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span></span> <span data-ttu-id="a2e6b-136">I så fall krävs ingen åtgärd.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="a2e6b-137">Du kan se aktuell status för tjänsten på vår [Azure Hälsoinstrumentpanelen](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="a2e6b-138">Programmets tillgänglighet kommer att återställas efter återställningen av region.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-138">After the recovery of the region your application’s availability will be restored.</span></span>

## <a name="fail-over-to-geo-replicated-secondary-database"></a><span data-ttu-id="a2e6b-139">Växla över till georeplikerad sekundära databas</span><span class="sxs-lookup"><span data-stu-id="a2e6b-139">Fail over to geo-replicated secondary database</span></span>
<span data-ttu-id="a2e6b-140">Om ditt programs driftstopp kan resultera i företag ansvar bör du använda geo-replikerade databaser i ditt program.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="a2e6b-141">Det kan programmet för att snabbt återställa tillgänglighet i en annan region vid ett strömavbrott.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="a2e6b-142">Lär dig hur du [konfigurera geo-replikering](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-142">Learn how to [configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="a2e6b-143">Om du vill återställa tillgängligheten för databaserna som du behöver initiera växling vid fel för sekundär geo-replikerade med någon av metoderna som stöds.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span></span>

<span data-ttu-id="a2e6b-144">Använd någon av följande guider för att växla över till en sekundär databas georeplikerad:</span><span class="sxs-lookup"><span data-stu-id="a2e6b-144">Use one of the following guides to fail over to a geo-replicated secondary database:</span></span>

* [<span data-ttu-id="a2e6b-145">Växla över till en georeplikerad sekundär med hjälp av Azure Portal</span><span class="sxs-lookup"><span data-stu-id="a2e6b-145">Fail over to a geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="a2e6b-146">Växla över till en sekundär geo-replikerade med hjälp av PowerShell</span><span class="sxs-lookup"><span data-stu-id="a2e6b-146">Fail over to a geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="a2e6b-147">Växla över till en georeplikerad sekundär med T-SQL</span><span class="sxs-lookup"><span data-stu-id="a2e6b-147">Fail over to a geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="a2e6b-148">Återställa med geo-återställning</span><span class="sxs-lookup"><span data-stu-id="a2e6b-148">Recover using geo-restore</span></span>
<span data-ttu-id="a2e6b-149">Om ditt program driftstopp inte resulterar i business ansvar kan du använda [geo-återställning](sql-database-recovery-using-backups.md) som en metod för att återställa programmet-databaserna.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span></span> <span data-ttu-id="a2e6b-150">Den skapar en kopia av databasen från den senaste geo-redundant säkerhetskopian.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-150">It creates a copy of the database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="a2e6b-151">Konfigurera databasen efter återställningen</span><span class="sxs-lookup"><span data-stu-id="a2e6b-151">Configure your database after recovery</span></span>
<span data-ttu-id="a2e6b-152">Om du använder geo-replikering, redundans eller geo-återställning för att återställa från ett avbrott måste du kontrollera att anslutningen till de nya databaserna är korrekt konfigurerad så att funktionen normal program kan återupptas.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span></span> <span data-ttu-id="a2e6b-153">Det här är en checklista för uppgifter för att förbereda din återställda databas produktion.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-153">This is a checklist of tasks to get your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="a2e6b-154">Uppdatera anslutningssträngar</span><span class="sxs-lookup"><span data-stu-id="a2e6b-154">Update connection strings</span></span>
<span data-ttu-id="a2e6b-155">Eftersom den återställda databasen kommer att finnas i en annan server, måste du uppdatera ditt programs anslutningssträngen så att den pekar till servern.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span></span>

<span data-ttu-id="a2e6b-156">Mer information om hur du ändrar anslutningssträngar finns i lämplig programmeringsspråk för din [anslutningsbibliotek](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="a2e6b-157">Konfigurera brandväggsregler</span><span class="sxs-lookup"><span data-stu-id="a2e6b-157">Configure Firewall Rules</span></span>
<span data-ttu-id="a2e6b-158">Du måste se till att brandväggsreglerna som konfigurerats på servern och databasen matchar de som har konfigurerats på den primära servern och den primära databasen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span></span> <span data-ttu-id="a2e6b-159">Mer information finns i [så här: konfigurera brandväggsinställningar (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="a2e6b-160">Konfigurera inloggning och databasanvändare</span><span class="sxs-lookup"><span data-stu-id="a2e6b-160">Configure logins and database users</span></span>
<span data-ttu-id="a2e6b-161">Du måste se till att alla inloggningar som används av programmet finns på servern som är värd för den återställda databasen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span></span> <span data-ttu-id="a2e6b-162">Mer information finns i [säkerhetskonfiguration för geo-replikering](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="a2e6b-163">Du bör konfigurera och testa din serverbrandväggsreglerna och inloggningar (och deras behörigheter) under en katastrofåterställning återställningsgranskning.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="a2e6b-164">Dessa servernivå objekt och deras konfiguration får inte vara tillgängliga under avbrottet.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-164">These server-level objects and their configuration may not be available during the outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="a2e6b-165">Ställa in telemetri aviseringar</span><span class="sxs-lookup"><span data-stu-id="a2e6b-165">Setup telemetry alerts</span></span>
<span data-ttu-id="a2e6b-166">Du måste se till att de befintliga inställningarna för varningsregeln uppdateras för att mappa till den återställda databasen och annan server.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span></span>

<span data-ttu-id="a2e6b-167">Mer information om databasen Varningsregler finns [ta emot aviseringen meddelanden](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) och [spåra tjänstens hälsa](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="a2e6b-168">Aktivera granskning</span><span class="sxs-lookup"><span data-stu-id="a2e6b-168">Enable auditing</span></span>
<span data-ttu-id="a2e6b-169">Om granskning krävs för att ansluta till databasen, måste du aktivera granskning efter återställning av databasen.</span><span class="sxs-lookup"><span data-stu-id="a2e6b-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span></span> <span data-ttu-id="a2e6b-170">Mer information finns i [Database auditing](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="a2e6b-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="a2e6b-171">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="a2e6b-171">Next steps</span></span>
* <span data-ttu-id="a2e6b-172">Lär dig mer om Azure SQL Database automatiserad säkerhetskopieringar, se [SQL-databas automatisk säkerhetskopiering](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="a2e6b-172">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="a2e6b-173">Läs om business continuity design- och återställningsscenarier i [kontinuitet scenarier](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="a2e6b-173">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="a2e6b-174">Läs om hur du använder automatisk säkerhetskopiering för återställning i [återställa en databas från säkerhetskopior service-initierad](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="a2e6b-174">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>

