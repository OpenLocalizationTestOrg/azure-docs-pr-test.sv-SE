---
title: aaaCopy en Azure SQL database | Microsoft Docs
description: Skapa en kopia av en Azure SQL database
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5aaf6bcd-3839-49b5-8c77-cbdf786e359b
ms.service: sql-database
ms.custom: load & move data
ms.devlang: NA
ms.date: 06/15/2017
ms.author: carlrab
ms.workload: data-management
ms.topic: article
ms.tgt_pltfrm: NA
ms.openlocfilehash: 64a297d819d6da89600fda60abe8394ae405abfe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="copy-an-azure-sql-database"></a><span data-ttu-id="ad15e-103">Kopiera en Azure SQL database</span><span class="sxs-lookup"><span data-stu-id="ad15e-103">Copy an Azure SQL database</span></span>

<span data-ttu-id="ad15e-104">Azure SQL-databasen innehåller flera metoder för att skapa en konsekvent transaktionellt kopia av en befintlig Azure SQL-databas på antingen hello samma eller en annan server.</span><span class="sxs-lookup"><span data-stu-id="ad15e-104">Azure SQL Database provides several methods for creating a transactionally consistent copy of an existing Azure SQL database on either hello same server or a different server.</span></span> <span data-ttu-id="ad15e-105">Du kan kopiera en SQL-databas med hjälp av hello Azure-portalen, PowerShell eller T-SQL.</span><span class="sxs-lookup"><span data-stu-id="ad15e-105">You can copy a SQL database by using hello Azure portal, PowerShell, or T-SQL.</span></span> 

## <a name="overview"></a><span data-ttu-id="ad15e-106">Översikt</span><span class="sxs-lookup"><span data-stu-id="ad15e-106">Overview</span></span>

<span data-ttu-id="ad15e-107">En databaskopia är en ögonblicksbild av hello källdatabasen från och med hello tid för hello copy-begäran.</span><span class="sxs-lookup"><span data-stu-id="ad15e-107">A database copy is a snapshot of hello source database as of hello time of hello copy request.</span></span> <span data-ttu-id="ad15e-108">Du kan välja hello samma server eller en annan server, dess servicenivå för tjänstnivå och prestandanivå eller en annan prestandanivå inom hello samma tjänstnivån (edition).</span><span class="sxs-lookup"><span data-stu-id="ad15e-108">You can select hello same server or a different server, its service tier and performance level, or a different performance level within hello same service tier (edition).</span></span> <span data-ttu-id="ad15e-109">När hello kopieringen är klar blir den en fullt fungerande oberoende databas.</span><span class="sxs-lookup"><span data-stu-id="ad15e-109">After hello copy is complete, it becomes a fully functional, independent database.</span></span> <span data-ttu-id="ad15e-110">Nu kan du uppgradera eller nedgradera den tooany edition.</span><span class="sxs-lookup"><span data-stu-id="ad15e-110">At this point, you can upgrade or downgrade it tooany edition.</span></span> <span data-ttu-id="ad15e-111">hello-inloggningar, användare och behörigheter kan hanteras oberoende av varandra.</span><span class="sxs-lookup"><span data-stu-id="ad15e-111">hello logins, users, and permissions can be managed independently.</span></span>  

## <a name="logins-in-hello-database-copy"></a><span data-ttu-id="ad15e-112">Inloggningar i hello databaskopian</span><span class="sxs-lookup"><span data-stu-id="ad15e-112">Logins in hello database copy</span></span>

<span data-ttu-id="ad15e-113">När du kopierar en databas toohello samma logiska server, hello samma inloggningar som kan användas på båda databaserna.</span><span class="sxs-lookup"><span data-stu-id="ad15e-113">When you copy a database toohello same logical server, hello same logins can be used on both databases.</span></span> <span data-ttu-id="ad15e-114">hello säkerhetsobjekt du använder toocopy hello databas blir hello databasägaren på hello ny databas.</span><span class="sxs-lookup"><span data-stu-id="ad15e-114">hello security principal you use toocopy hello database becomes hello database owner on hello new database.</span></span> <span data-ttu-id="ad15e-115">Alla användare och deras behörigheter säkerhet säkerhetsidentifierare (SID) är kopieras toohello databaskopian.</span><span class="sxs-lookup"><span data-stu-id="ad15e-115">All database users, their permissions, and their security identifiers (SIDs) are copied toohello database copy.</span></span>  

<span data-ttu-id="ad15e-116">När du kopierar en tooa olika logiska databasserver, blir hello säkerhetsobjekt på hello nya servern hello databasägaren på hello ny databas.</span><span class="sxs-lookup"><span data-stu-id="ad15e-116">When you copy a database tooa different logical server, hello security principal on hello new server becomes hello database owner on hello new database.</span></span> <span data-ttu-id="ad15e-117">Om du använder [innehöll databasanvändare](sql-database-manage-logins.md) för dataåtkomst, kontrollera att både hello primära och sekundära databaser har alltid hello samma autentiseringsuppgifter, så som när hello kopieringen är klar har direkt åtkomst till den med hello samma autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="ad15e-117">If you use [contained database users](sql-database-manage-logins.md) for data access, ensure that both hello primary and secondary databases always have hello same user credentials, so that after hello copy is complete you can immediately access it with hello same credentials.</span></span> 

<span data-ttu-id="ad15e-118">Om du använder [Azure Active Directory](../active-directory/active-directory-whatis.md), du kan helt eliminera hello behovet av att hantera autentiseringsuppgifter i hello kopia.</span><span class="sxs-lookup"><span data-stu-id="ad15e-118">If you use [Azure Active Directory](../active-directory/active-directory-whatis.md), you can completely eliminate hello need for managing credentials in hello copy.</span></span> <span data-ttu-id="ad15e-119">Men när du kopierar hello tooa nya databasservern kanske hello inloggnings-baserad åtkomst inte fungerar, eftersom hello inloggningar inte finns på hello ny server.</span><span class="sxs-lookup"><span data-stu-id="ad15e-119">However, when you copy hello database tooa new server, hello login-based access might not work, because hello logins do not exist on hello new server.</span></span> <span data-ttu-id="ad15e-120">toolearn om hur du hanterar inloggningar när du kopierar en tooa olika logiska databasserver, se [hur toomanage Azure SQL-databas säkerhet efter katastrofåterställning](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-120">toolearn about managing logins when you copy a database tooa different logical server, see [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> 

<span data-ttu-id="ad15e-121">När hello kopiera lyckas och innan andra användare mappas om kan endast hello inloggning som initierade hello kopierar, hello databasägaren logga in toohello ny databas.</span><span class="sxs-lookup"><span data-stu-id="ad15e-121">After hello copying succeeds and before other users are remapped, only hello login that initiated hello copying, hello database owner, can log in toohello new database.</span></span> <span data-ttu-id="ad15e-122">tooresolve inloggningar när hello Kopiera åtgärden är klar finns [lösa inloggningar](#resolve-logins).</span><span class="sxs-lookup"><span data-stu-id="ad15e-122">tooresolve logins after hello copying operation is complete, see [Resolve logins](#resolve-logins).</span></span>

## <a name="copy-a-database-by-using-hello-azure-portal"></a><span data-ttu-id="ad15e-123">Kopiera en databas med hjälp av hello Azure-portalen</span><span class="sxs-lookup"><span data-stu-id="ad15e-123">Copy a database by using hello Azure portal</span></span>

<span data-ttu-id="ad15e-124">toocopy en databas med hjälp av hello Azure-portalen, öppna hello sidan för databasen, och klicka sedan på **kopiera**.</span><span class="sxs-lookup"><span data-stu-id="ad15e-124">toocopy a database by using hello Azure portal, open hello page for your database, and then click **Copy**.</span></span> 

   ![Databaskopian](./media/sql-database-copy/database-copy.png)

## <a name="copy-a-database-by-using-powershell"></a><span data-ttu-id="ad15e-126">Kopiera en databas med hjälp av PowerShell</span><span class="sxs-lookup"><span data-stu-id="ad15e-126">Copy a database by using PowerShell</span></span>

<span data-ttu-id="ad15e-127">toocopy en databas med hjälp av PowerShell, Använd hello [ny AzureRmSqlDatabaseCopy](/powershell/module/azurerm.sql/new-azurermsqldatabasecopy) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="ad15e-127">toocopy a database by using PowerShell, use hello [New-AzureRmSqlDatabaseCopy](/powershell/module/azurerm.sql/new-azurermsqldatabasecopy) cmdlet.</span></span> 

```PowerShell
New-AzureRmSqlDatabaseCopy -ResourceGroupName "myResourceGroup" `
    -ServerName $sourceserver `
    -DatabaseName "MySampleDatabase" `
    -CopyResourceGroupName "myResourceGroup" `
    -CopyServerName $targetserver `
    -CopyDatabaseName "CopyOfMySampleDatabase"
```

<span data-ttu-id="ad15e-128">En fullständig exempelskript finns [kopiera en tooa ny databasserver](scripts/sql-database-copy-database-to-new-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-128">For a complete sample script, see [Copy a database tooa new server](scripts/sql-database-copy-database-to-new-server-powershell.md).</span></span>

## <a name="copy-a-database-by-using-transact-sql"></a><span data-ttu-id="ad15e-129">Kopiera en databas med hjälp av Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="ad15e-129">Copy a database by using Transact-SQL</span></span>

<span data-ttu-id="ad15e-130">Logga in toohello master databasen med hello huvudsaklig inloggning på servernivå eller hello-inloggning som skapade hello-databas som du vill toocopy.</span><span class="sxs-lookup"><span data-stu-id="ad15e-130">Log in toohello master database with hello server-level principal login or hello login that created hello database you want toocopy.</span></span> <span data-ttu-id="ad15e-131">Kopiera toosucceed-databas måste inloggningar som inte är hello servernivå huvudnamn vara medlemmar i hello dbmanager roll.</span><span class="sxs-lookup"><span data-stu-id="ad15e-131">For database copying toosucceed, logins that are not hello server-level principal must be members of hello dbmanager role.</span></span> <span data-ttu-id="ad15e-132">Läs mer om inloggningar och anslutande toohello [hantera inloggningar](sql-database-manage-logins.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-132">For more information about logins and connecting toohello server, see [Manage logins](sql-database-manage-logins.md).</span></span>

<span data-ttu-id="ad15e-133">Börja kopiera hello källdatabasen med hello [CREATE DATABASE](https://msdn.microsoft.com/library/ms176061.aspx) instruktionen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-133">Start copying hello source database with hello [CREATE DATABASE](https://msdn.microsoft.com/library/ms176061.aspx) statement.</span></span> <span data-ttu-id="ad15e-134">Kör den här instruktionen initierar hello databasen kopiera processen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-134">Executing this statement initiates hello database copying process.</span></span> <span data-ttu-id="ad15e-135">Eftersom kopiera en databas är en asynkron åtgärd, returnerar hello CREATE DATABASE-instruktionen innan hello databasen kopieringen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="ad15e-135">Because copying a database is an asynchronous process, hello CREATE DATABASE statement returns before hello database copying is complete.</span></span>

### <a name="copy-a-sql-database-toohello-same-server"></a><span data-ttu-id="ad15e-136">Kopiera en SQL-databas toohello samma server</span><span class="sxs-lookup"><span data-stu-id="ad15e-136">Copy a SQL database toohello same server</span></span>
<span data-ttu-id="ad15e-137">Logga in toohello master databasen med hello huvudsaklig inloggning på servernivå eller hello-inloggning som skapade hello-databas som du vill toocopy.</span><span class="sxs-lookup"><span data-stu-id="ad15e-137">Log in toohello master database with hello server-level principal login or hello login that created hello database you want toocopy.</span></span> <span data-ttu-id="ad15e-138">Kopiera toosucceed-databas måste inloggningar som inte är hello servernivå huvudnamn vara medlemmar i hello dbmanager roll.</span><span class="sxs-lookup"><span data-stu-id="ad15e-138">For database copying toosucceed, logins that are not hello server-level principal must be members of hello dbmanager role.</span></span>

<span data-ttu-id="ad15e-139">Det här kommandot kopieras Database1 tooa ny databas med namnet Database2 på hello samma server.</span><span class="sxs-lookup"><span data-stu-id="ad15e-139">This command copies Database1 tooa new database named Database2 on hello same server.</span></span> <span data-ttu-id="ad15e-140">Hello Kopiera åtgärden kan ta viss tid toocomplete beroende hello storleken på databasen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-140">Depending on hello size of your database, hello copying operation might take some time toocomplete.</span></span>

    -- Execute on hello master database.
    -- Start copying.
    CREATE DATABASE Database1_copy AS COPY OF Database1;

### <a name="copy-a-sql-database-tooa-different-server"></a><span data-ttu-id="ad15e-141">Kopiera en annan server för SQL-databasen tooa</span><span class="sxs-lookup"><span data-stu-id="ad15e-141">Copy a SQL database tooa different server</span></span>

<span data-ttu-id="ad15e-142">Logga in toohello master databasen på målservern hello, där hello ny databas är toobe skapade hello-SQL-databasservern.</span><span class="sxs-lookup"><span data-stu-id="ad15e-142">Log in toohello master database of hello destination server, hello SQL database server where hello new database is toobe created.</span></span> <span data-ttu-id="ad15e-143">Använd en inloggning som har hello samma namn och lösenord som hello databasägaren hello källdatabasens på hello källservern SQL-databasen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-143">Use a login that has hello same name and password as hello database owner of hello source database on hello source SQL database server.</span></span> <span data-ttu-id="ad15e-144">hello logga in på målservern för hello måste också vara medlem i rollen för hello dbmanager eller vara hello huvudsaklig inloggning på servernivå.</span><span class="sxs-lookup"><span data-stu-id="ad15e-144">hello login on hello destination server must also be a member of hello dbmanager role or be hello server-level principal login.</span></span>

<span data-ttu-id="ad15e-145">Det här kommandot kopieras Database1 på server1 tooa ny databas med namnet Database2 på server2.</span><span class="sxs-lookup"><span data-stu-id="ad15e-145">This command copies Database1 on server1 tooa new database named Database2 on server2.</span></span> <span data-ttu-id="ad15e-146">Hello Kopiera åtgärden kan ta viss tid toocomplete beroende hello storleken på databasen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-146">Depending on hello size of your database, hello copying operation might take some time toocomplete.</span></span>

    -- Execute on hello master database of hello target server (server2)
    -- Start copying from Server1 tooServer2
    CREATE DATABASE Database1_copy AS COPY OF server1.Database1;


### <a name="monitor-hello-progress-of-hello-copying-operation"></a><span data-ttu-id="ad15e-147">Övervaka hello hello Kopiera åtgärden</span><span class="sxs-lookup"><span data-stu-id="ad15e-147">Monitor hello progress of hello copying operation</span></span>

<span data-ttu-id="ad15e-148">Övervaka hello kopieringen genom att fråga hello sys.databases och sys.dm_database_copies vyer.</span><span class="sxs-lookup"><span data-stu-id="ad15e-148">Monitor hello copying process by querying hello sys.databases and sys.dm_database_copies views.</span></span> <span data-ttu-id="ad15e-149">När hello kopiera pågår, hello **state_desc** kolumnen hello sys.databases vyn för hello ny databas har angetts för**kopiering**.</span><span class="sxs-lookup"><span data-stu-id="ad15e-149">While hello copying is in progress, hello **state_desc** column of hello sys.databases view for hello new database is set too**COPYING**.</span></span>

* <span data-ttu-id="ad15e-150">Om hello kopiera misslyckas hello **state_desc** kolumnen hello sys.databases vyn för hello ny databas har angetts för**MISSTÄNKER**.</span><span class="sxs-lookup"><span data-stu-id="ad15e-150">If hello copying fails, hello **state_desc** column of hello sys.databases view for hello new database is set too**SUSPECT**.</span></span> <span data-ttu-id="ad15e-151">Köra hello DROP-uttryck på hello ny databas och försök igen senare.</span><span class="sxs-lookup"><span data-stu-id="ad15e-151">Execute hello DROP statement on hello new database, and try again later.</span></span>
* <span data-ttu-id="ad15e-152">Om hello kopiera lyckas hello **state_desc** kolumnen hello sys.databases vyn för hello ny databas har angetts för**ONLINE**.</span><span class="sxs-lookup"><span data-stu-id="ad15e-152">If hello copying succeeds, hello **state_desc** column of hello sys.databases view for hello new database is set too**ONLINE**.</span></span> <span data-ttu-id="ad15e-153">hello kopieringen har slutförts och hello ny databas är en vanlig databas som kan ändras oberoende av hello källdatabasen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-153">hello copying is complete, and hello new database is a regular database that can be changed independent of hello source database.</span></span>

> [!NOTE]
> <span data-ttu-id="ad15e-154">Om du väljer toocancel hello kopiera medan det pågår, köra hello [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx) satsen på hello ny databas.</span><span class="sxs-lookup"><span data-stu-id="ad15e-154">If you decide toocancel hello copying while it is in progress, execute hello [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx) statement on hello new database.</span></span> <span data-ttu-id="ad15e-155">Du kan också avbryter köra hello DROP DATABASE-instruktionen på hello källdatabasen också hello kopiera processen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-155">Alternatively, executing hello DROP DATABASE statement on hello source database also cancels hello copying process.</span></span>
> 

## <a name="resolve-logins"></a><span data-ttu-id="ad15e-156">Lös inloggningar</span><span class="sxs-lookup"><span data-stu-id="ad15e-156">Resolve logins</span></span>

<span data-ttu-id="ad15e-157">När nya hello-databasen är online på målservern för hello använda hello [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx) instruktionen tooremap hello användare från hello databasen nya toologins på hello-målservern.</span><span class="sxs-lookup"><span data-stu-id="ad15e-157">After hello new database is online on hello destination server, use hello [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx) statement tooremap hello users from hello new database toologins on hello destination server.</span></span> <span data-ttu-id="ad15e-158">tooresolve ägarlösa användare se [felsöka ägarlösa användare](https://msdn.microsoft.com/library/ms175475.aspx).</span><span class="sxs-lookup"><span data-stu-id="ad15e-158">tooresolve orphaned users, see [Troubleshoot Orphaned Users](https://msdn.microsoft.com/library/ms175475.aspx).</span></span> <span data-ttu-id="ad15e-159">Se även [hur toomanage Azure SQL-databas säkerhet efter katastrofåterställning](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-159">See also [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

<span data-ttu-id="ad15e-160">Alla användare i hello ny databas behåller hello behörigheter som de hade i hello källdatabasen.</span><span class="sxs-lookup"><span data-stu-id="ad15e-160">All users in hello new database retain hello permissions that they had in hello source database.</span></span> <span data-ttu-id="ad15e-161">hello-användaren som initierade hello databaskopian blir hello databasens ägare av den nya hello-databasen och tilldelas en ny säkerhetsidentifierare (SID).</span><span class="sxs-lookup"><span data-stu-id="ad15e-161">hello user who initiated hello database copy becomes hello database owner of hello new database and is assigned a new security identifier (SID).</span></span> <span data-ttu-id="ad15e-162">När hello kopiera lyckas och innan andra användare mappas om kan endast hello inloggning som initierade hello kopierar, hello databasägaren logga in toohello ny databas.</span><span class="sxs-lookup"><span data-stu-id="ad15e-162">After hello copying succeeds and before other users are remapped, only hello login that initiated hello copying, hello database owner, can log in toohello new database.</span></span>

<span data-ttu-id="ad15e-163">toolearn om att hantera användare och inloggningar när du kopierar en tooa olika logiska databasserver, se [hur toomanage Azure SQL-databas säkerhet efter katastrofåterställning](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-163">toolearn about managing users and logins when you copy a database tooa different logical server, see [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ad15e-164">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="ad15e-164">Next steps</span></span>

* <span data-ttu-id="ad15e-165">Information om inloggningar finns [hantera inloggningar](sql-database-manage-logins.md) och [hur toomanage Azure SQL-databas säkerhet efter katastrofåterställning](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-165">For information about logins, see [Manage logins](sql-database-manage-logins.md) and [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="ad15e-166">tooexport en databas finns [exportera hello databasen tooa BACPAC](sql-database-export.md).</span><span class="sxs-lookup"><span data-stu-id="ad15e-166">tooexport a database, see [Export hello database tooa BACPAC](sql-database-export.md).</span></span>
