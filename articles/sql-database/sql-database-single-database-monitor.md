---
title: aaaMonitoring databasprestanda i Azure SQL Database | Microsoft Docs
description: "Läs mer om hello alternativ för att övervaka din databas med Azure-verktyg och dynamiska hanteringsvyer."
keywords: "databasövervakning, molndatabasprestanda"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="690a4-104">Övervaka databasprestanda i Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="690a4-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="690a4-105">Övervakning hello prestanda i en SQL-databas i Azure startar med att övervaka hello resurs användning relativa toohello nivån på databasprestanda som du väljer.</span><span class="sxs-lookup"><span data-stu-id="690a4-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="690a4-106">Övervakning hjälper dig att avgöra om din databas har överflödig kapacitet eller har problem med eftersom resurserna är överutnyttjade ut och sedan avgöra om det är tid tooadjust hello prestandanivå och [tjänstnivån](sql-database-service-tiers.md) för din databas.</span><span class="sxs-lookup"><span data-stu-id="690a4-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="690a4-107">Du kan övervaka din databas med grafiska verktyg i hello [Azure-portalen](https://portal.azure.com) eller med hjälp av SQL [dynamiska hanteringsvyer](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="690a4-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="690a4-108">Övervaka databaser med hello Azure-portalen</span><span class="sxs-lookup"><span data-stu-id="690a4-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="690a4-109">I hello [Azure-portalen](https://portal.azure.com/), du kan övervaka en enskild databas resursutnyttjning genom att välja din databas och klicka på hello **övervakning** diagram.</span><span class="sxs-lookup"><span data-stu-id="690a4-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="690a4-110">Detta öppnar en **mått** fönster som du kan ändra genom att klicka på hello **redigera diagram** knappen.</span><span class="sxs-lookup"><span data-stu-id="690a4-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="690a4-111">Lägg till hello följande mått:</span><span class="sxs-lookup"><span data-stu-id="690a4-111">Add hello following metrics:</span></span>

* <span data-ttu-id="690a4-112">CPU-procent</span><span class="sxs-lookup"><span data-stu-id="690a4-112">CPU percentage</span></span>
* <span data-ttu-id="690a4-113">DTU-procent</span><span class="sxs-lookup"><span data-stu-id="690a4-113">DTU percentage</span></span>
* <span data-ttu-id="690a4-114">Data IO-procent</span><span class="sxs-lookup"><span data-stu-id="690a4-114">Data IO percentage</span></span>
* <span data-ttu-id="690a4-115">Databasstorlek i procent</span><span class="sxs-lookup"><span data-stu-id="690a4-115">Database size percentage</span></span>

<span data-ttu-id="690a4-116">När du har lagt till de här måtten, kan du fortsätta tooview dem i hello **övervakning** diagram med mer information om hello **mått** fönster.</span><span class="sxs-lookup"><span data-stu-id="690a4-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="690a4-117">Alla fyra mätvärdena visar hello genomsnittlig användning procentandel relativa toohello **DTU** för din databas.</span><span class="sxs-lookup"><span data-stu-id="690a4-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="690a4-118">Se hello [tjänstnivåer](sql-database-service-tiers.md) artikeln för information om dtu: er.</span><span class="sxs-lookup"><span data-stu-id="690a4-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Tjänstnivå-övervakning av databasprestanda.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="690a4-120">Du kan också konfigurera aviseringar på hello prestandamått.</span><span class="sxs-lookup"><span data-stu-id="690a4-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="690a4-121">Klicka på hello **Lägg till avisering** knapp i hello **mått** fönster.</span><span class="sxs-lookup"><span data-stu-id="690a4-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="690a4-122">Följ hello guiden tooconfigure aviseringen.</span><span class="sxs-lookup"><span data-stu-id="690a4-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="690a4-123">Du har hello alternativet tooalert om hello måttet överskrider ett visst tröskelvärde eller om hello måttet faller under ett visst tröskelvärde.</span><span class="sxs-lookup"><span data-stu-id="690a4-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="690a4-124">Till exempel om du räknar hello arbetsbelastningen på din databas toogrow du tooconfigure en e-postavisering när databasen når 80% av hello prestandamått.</span><span class="sxs-lookup"><span data-stu-id="690a4-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="690a4-125">Du kan använda den som en tidig varning toofigure ut när du kanske tooswitch toohello högre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="690a4-126">hello prestandamåtten kan också hjälpa dig att avgöra om du kan toodowngrade tooa lägre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="690a4-127">Anta att du använder en Standard S2-databas och alla prestanda mått visar att hello databasen i genomsnitt använder inte mer än 10% vid något tillfälle.</span><span class="sxs-lookup"><span data-stu-id="690a4-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="690a4-128">Det är troligt att hello-databasen fungerar bra i Standard S1.</span><span class="sxs-lookup"><span data-stu-id="690a4-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="690a4-129">Dock vara medveten om arbetsbelastningar som varierar kraftigt innan du gör hello beslut toomove tooa lägre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="690a4-130">Övervaka databaser med hjälp av DMV:er</span><span class="sxs-lookup"><span data-stu-id="690a4-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="690a4-131">hello samma mått som exponeras i hello portal finns också tillgängliga via systemvyer: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) i hello logiska **master** databasen på din server och [sys.dm_db_ resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) i hello användardatabas.</span><span class="sxs-lookup"><span data-stu-id="690a4-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="690a4-132">Använd **sys.resource_stats** om du behöver toomonitor mindre detaljerad data över en längre tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="690a4-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="690a4-133">Använd **sys.dm_db_resource_stats** om du behöver toomonitor mer detaljerad data inom ett kortare tidsintervall.</span><span class="sxs-lookup"><span data-stu-id="690a4-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="690a4-134">Mer information finns i [Azure SQL Database-prestandaråd](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="690a4-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="690a4-135">**sys.dm_db_resource_stats** returnerar en tom resultatuppsättning när den används i databaser av Webb- och Business-utgåva som är föråldrade.</span><span class="sxs-lookup"><span data-stu-id="690a4-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="690a4-136">Övervaka Resursanvändning</span><span class="sxs-lookup"><span data-stu-id="690a4-136">Monitor resource use</span></span>

<span data-ttu-id="690a4-137">Du kan övervaka resurs användning med [SQL Database Query Performance Insight](sql-database-query-performance.md) och [Frågearkivet](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="690a4-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="690a4-138">Du kan också övervaka användningen med hjälp av dessa två vyer:</span><span class="sxs-lookup"><span data-stu-id="690a4-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="690a4-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="690a4-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="690a4-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="690a4-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="690a4-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="690a4-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="690a4-142">Du kan använda hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) vyn i varje SQL-databas.</span><span class="sxs-lookup"><span data-stu-id="690a4-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="690a4-143">Hej **sys.dm_db_resource_stats** vyn visar senaste resursen används data relativa toohello tjänstnivån.</span><span class="sxs-lookup"><span data-stu-id="690a4-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="690a4-144">Genomsnittlig procent för processor, data i/o, skrivs loggen och minne registreras var 15: e sekund och bevaras i timmen.</span><span class="sxs-lookup"><span data-stu-id="690a4-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="690a4-145">Eftersom den här vyn innehåller en mer detaljerad titt på Resursanvändning, använda **sys.dm_db_resource_stats** första för alla aktuella tillstånd analys eller felsökning.</span><span class="sxs-lookup"><span data-stu-id="690a4-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="690a4-146">Den här frågan visar till exempel hello medel och maximala använder för hello databasen via hello senaste timmen:</span><span class="sxs-lookup"><span data-stu-id="690a4-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="690a4-147">Andra frågor finns i hello i [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="690a4-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="690a4-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="690a4-148">sys.resource_stats</span></span>
<span data-ttu-id="690a4-149">Hej [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) vyn i hello **master** databasen innehåller ytterligare information som kan hjälpa dig att övervaka hello prestanda för SQL-databasen på den specifika tjänstnivå och prestandanivå nivån .</span><span class="sxs-lookup"><span data-stu-id="690a4-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="690a4-150">hello data samlas var femte minut och underhålls i cirka 35 dagar.</span><span class="sxs-lookup"><span data-stu-id="690a4-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="690a4-151">Den här vyn är användbar för en långsiktiga historiska analys av hur SQL-databasen använder resurser.</span><span class="sxs-lookup"><span data-stu-id="690a4-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="690a4-152">hello följande diagram visar hello CPU resursanvändningen för en Premium-databas med hello P2 prestandanivå för varje timme under en vecka.</span><span class="sxs-lookup"><span data-stu-id="690a4-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="690a4-153">Det här diagrammet startar på en måndag, visar 5 arbetsdagar och sedan visas en helger, när mycket mindre sker på hello program.</span><span class="sxs-lookup"><span data-stu-id="690a4-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![Resursanvändning för SQL-databas](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="690a4-155">Från hello data, har den här databasen för närvarande en CPU-belastning bara över 50% CPU-användning relativa toohello P2 prestandanivå (mitt på dagen tisdagen).</span><span class="sxs-lookup"><span data-stu-id="690a4-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="690a4-156">Om Processorn är hello företag faktor i hello programmet resurs profil, kan du bestämma att P2 är hello rätt prestanda nivå tooguarantee som hello arbetsbelastning alltid får plats.</span><span class="sxs-lookup"><span data-stu-id="690a4-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="690a4-157">Om du förväntar dig ett program toogrow över tid är en bra idé toohave en buffert som extra resurs så att programmet hello inte någonsin nå hello prestandanivå gränsen.</span><span class="sxs-lookup"><span data-stu-id="690a4-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="690a4-158">Om du ökar hello prestandanivå du undvika kunden visas fel som kan uppstå när en databas inte har tillräckligt med power tooprocess begäranden effektivt, särskilt i miljöer med känslig för fördröjningar.</span><span class="sxs-lookup"><span data-stu-id="690a4-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="690a4-159">Ett exempel är en databas som har stöd för ett program som återger webbsidor utifrån hello resultat av databasanrop.</span><span class="sxs-lookup"><span data-stu-id="690a4-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="690a4-160">Andra programtyper av kan tolka hello samma diagram på olika sätt.</span><span class="sxs-lookup"><span data-stu-id="690a4-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="690a4-161">Till exempel om ett program försöker tooprocess löneuppgifter data varje dag och har hello kan samma diagram, detta kind av ”batchjobb” modell göra att vid prestandanivå P1.</span><span class="sxs-lookup"><span data-stu-id="690a4-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="690a4-162">hello prestandanivå P1 har 100 Dtu jämfört med too200 dtu: er på hello P2 prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="690a4-163">hello prestandanivå P1 ger halva hello prestanda för hello P2 prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="690a4-164">Därför är 50 procent av CPU-användning i P2 lika med 100 procent CPU-användning i P1.</span><span class="sxs-lookup"><span data-stu-id="690a4-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="690a4-165">Om programmet hello saknar tidsgränser kanske det ingen roll om ett jobb tar 2 timmar eller 2,5 timmar toofinish om den hämtar gjort idag.</span><span class="sxs-lookup"><span data-stu-id="690a4-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="690a4-166">Ett program i den här kategorin kan förmodligen använda prestandanivå P1.</span><span class="sxs-lookup"><span data-stu-id="690a4-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="690a4-167">Du kan dra nytta av hello faktum att tidsperioder under hello dag när Resursanvändning är lägre, så att alla ”stor belastning” kan hamnar i en hello tvättställ senare i hello dag.</span><span class="sxs-lookup"><span data-stu-id="690a4-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="690a4-168">hello prestandanivå P1 kan vara bra för den typen av program (och spara pengar), så länge hello jobb kan avslutas i tid varje dag.</span><span class="sxs-lookup"><span data-stu-id="690a4-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="690a4-169">Azure SQL Database visar förbrukas resursinformation för varje aktiv databas i hello **sys.resource_stats** vy över hello **master** databasen i varje server.</span><span class="sxs-lookup"><span data-stu-id="690a4-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="690a4-170">hello data i hello tabell sammanställs för 5 minuters mellanrum.</span><span class="sxs-lookup"><span data-stu-id="690a4-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="690a4-171">Med hello Basic, Standard och Premium-servicenivåer, hello data kan det ta mer än 5 minuter tooappear i hello tabell, så att dessa data är mer användbar för historisk analys i stället för analys i nära realtid.</span><span class="sxs-lookup"><span data-stu-id="690a4-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="690a4-172">Frågan hello **sys.resource_stats** visa toosee hello senaste historiken för en databas och toovalidate om hello reservation du valde levereras hello prestanda när det behövs.</span><span class="sxs-lookup"><span data-stu-id="690a4-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="690a4-173">Du måste vara anslutna toohello **master** databasen för din logiska SQL database server tooquery **sys.resource_stats** i hello följande exempel.</span><span class="sxs-lookup"><span data-stu-id="690a4-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="690a4-174">Det här exemplet illustrerar hur hello data i den här vyn visas:</span><span class="sxs-lookup"><span data-stu-id="690a4-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![Hej sys.resource_stats katalogvyn](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="690a4-176">hello nästa exempel visas olika sätt som du kan använda hello **sys.resource_stats** katalogen visa tooget information om hur SQL-databasen använder resurser:</span><span class="sxs-lookup"><span data-stu-id="690a4-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="690a4-177">toolook på hello tidigare veckans resurs för hello databasen userdb1, kan du köra den här frågan:</span><span class="sxs-lookup"><span data-stu-id="690a4-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="690a4-178">hur väl din arbetsbelastning passar hello prestandanivå tooevaluate, behöver du toodrill ned i varje aspekt av hello resurs mått: processor, läsningar, skrivningar, antalet arbetare och antalet sessioner.</span><span class="sxs-lookup"><span data-stu-id="690a4-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="690a4-179">Här är en reviderade fråga med **sys.resource_stats** tooreport hello genomsnittliga och högsta värden för de här måtten för resursen:</span><span class="sxs-lookup"><span data-stu-id="690a4-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="690a4-180">Med den här informationen om hello genomsnittliga och högsta värden för varje resurs mått bedöma du hur bra din arbetsbelastning passar in i hello prestandanivå du valt.</span><span class="sxs-lookup"><span data-stu-id="690a4-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="690a4-181">Vanligtvis medelvärden från **sys.resource_stats** ger dig en bra baslinjen toouse mot hello Målstorlek.</span><span class="sxs-lookup"><span data-stu-id="690a4-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="690a4-182">Det bör vara primär mätning-minne.</span><span class="sxs-lookup"><span data-stu-id="690a4-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="690a4-183">Exempelvis kan du använda hello Standard-tjänstnivå med S2 prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="690a4-184">hello medelvärde använder procent för processor- och i/o-läsningar och skrivningar är lägre än 40 procent hello Genomsnittligt antal arbetare understiger 50 och hello Genomsnittligt antal sessioner understiger 200.</span><span class="sxs-lookup"><span data-stu-id="690a4-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="690a4-185">Din arbetsbelastning kan passa hello S1-prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="690a4-186">Det är enkelt toosee om databasen passar i hello arbetare och sessionsgränser.</span><span class="sxs-lookup"><span data-stu-id="690a4-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="690a4-187">toosee om en databas som passar in i en lägre prestandanivå med avseende på tooCPU läsningar och skrivningar, dividera hello DTU antalet hello lägre prestandanivå med hello DTU numret på ditt nuvarande prestandanivå och sedan multiplicera hello resultatet med 100:</span><span class="sxs-lookup"><span data-stu-id="690a4-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="690a4-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="690a4-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="690a4-189">hello resultatet är hello relativa prestandaskillnaden mellan hello två prestandanivåer i procent.</span><span class="sxs-lookup"><span data-stu-id="690a4-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="690a4-190">Om din Resursanvändning inte överskrider den här mängden, kanske passar din arbetsbelastning i hello lägre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="690a4-191">Men du behöver toolook på alla intervall med värden för användning av resursen och i procent avgör hur ofta arbetsbelastningen databasen passar in i hello lägre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="690a4-192">hello visar följande fråga hello passar procent per resursdimension, baserat på hello tröskelvärdet 40 procent som vi har beräknats i det här exemplet:</span><span class="sxs-lookup"><span data-stu-id="690a4-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="690a4-193">Baserat på din databas servicenivåmål (SLO), kan du bestämma om din arbetsbelastning passar in i hello lägre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="690a4-194">Om din databas arbetsbelastning Servicenivåmål är 99,9 procent och hello föregående fråga returnerar värden större än 99,9 procent för alla tre resursdimensioner, din arbetsbelastning som sannolikt passar in i hello lägre prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="690a4-195">Titta på hello passar procentandel ger dig även insikt om du ska flytta toohello nästa högre prestanda nivå toomeet din Servicenivåmål.</span><span class="sxs-lookup"><span data-stu-id="690a4-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="690a4-196">Till exempel visar userdb1 hello efter CPU-användning för hello gångna veckan:</span><span class="sxs-lookup"><span data-stu-id="690a4-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="690a4-197">Genomsnittlig CPU-procent</span><span class="sxs-lookup"><span data-stu-id="690a4-197">Average CPU percent</span></span> | <span data-ttu-id="690a4-198">Högsta CPU-procent</span><span class="sxs-lookup"><span data-stu-id="690a4-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="690a4-199">24.5</span><span class="sxs-lookup"><span data-stu-id="690a4-199">24.5</span></span> |<span data-ttu-id="690a4-200">100.00</span><span class="sxs-lookup"><span data-stu-id="690a4-200">100.00</span></span> |
   
    <span data-ttu-id="690a4-201">hello Genomsnittlig CPU handlar om ett kvartal av hello gräns på hello prestandanivå, skulle passar in i hello prestandanivå hello-databasen.</span><span class="sxs-lookup"><span data-stu-id="690a4-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="690a4-202">Men hello maxvärdet visar hello databasen når hello gränsen på hello prestandanivå.</span><span class="sxs-lookup"><span data-stu-id="690a4-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="690a4-203">Behöver du toomove toohello högre prestandanivå?</span><span class="sxs-lookup"><span data-stu-id="690a4-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="690a4-204">Titta på hur många gånger din arbetsbelastning når 100 procent och sedan jämföra tooyour databasen arbetsbelastning Servicenivåmål.</span><span class="sxs-lookup"><span data-stu-id="690a4-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="690a4-205">Om den här frågan returnerar ett värde mindre än 99,9 procent av hello tre resursdimensioner, Överväg att antingen flytta toohello högre prestandanivå eller använda programmet mottagningsfönster tekniker tooreduce hello belastningen på hello SQL-databas.</span><span class="sxs-lookup"><span data-stu-id="690a4-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="690a4-206">Den här övningen även tas hänsyn till dina planerade arbetsbelastning ökning hello framtida.</span><span class="sxs-lookup"><span data-stu-id="690a4-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="690a4-207">Du kan övervaka enskilda databaser i hello-pool med hello tekniker som beskrivs i det här avsnittet för elastiska pooler.</span><span class="sxs-lookup"><span data-stu-id="690a4-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="690a4-208">Men du kan också övervaka hello poolen som helhet.</span><span class="sxs-lookup"><span data-stu-id="690a4-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="690a4-209">Mer information finns i [Övervaka och hantera en elastisk pool](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="690a4-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="690a4-210">Högsta antal samtidiga begäranden</span><span class="sxs-lookup"><span data-stu-id="690a4-210">Maximum concurrent requests</span></span>
<span data-ttu-id="690a4-211">toosee hello antalet samtidiga förfrågningar, kör den här Transact-SQL-frågan på din SQL-databas:</span><span class="sxs-lookup"><span data-stu-id="690a4-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="690a4-212">tooanalyze hello arbetsbelastningen på en lokal SQL Server-databasen, ändra den här frågan toofilter på hello viss databas du vill tooanalyze.</span><span class="sxs-lookup"><span data-stu-id="690a4-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="690a4-213">Till exempel om du har en lokal databas med namnet mindatabas returnerar den här Transact-SQL-frågan hello antal samtidiga begäranden i databasen:</span><span class="sxs-lookup"><span data-stu-id="690a4-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="690a4-214">Detta är bara en ögonblicksbild på ett ställe i tid.</span><span class="sxs-lookup"><span data-stu-id="690a4-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="690a4-215">tooget en bättre förståelse för din arbetsbelastning och krav för antal samtidiga begäranden, behöver du toocollect många prover över tid.</span><span class="sxs-lookup"><span data-stu-id="690a4-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="690a4-216">Maximal samtidiga inloggningar</span><span class="sxs-lookup"><span data-stu-id="690a4-216">Maximum concurrent logins</span></span>
<span data-ttu-id="690a4-217">Du kan analysera ditt användar- och mönster-tooget en uppfattning om hello frekvensen av inloggningar.</span><span class="sxs-lookup"><span data-stu-id="690a4-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="690a4-218">Du kan också köra verkliga belastningar i toomake till att du inte träffa detta eller andra begränsningar i den här artikeln diskuterar vi ett test-miljön.</span><span class="sxs-lookup"><span data-stu-id="690a4-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="690a4-219">Det finns inte en enskild fråga eller dynamisk hanteringsvy (DMV) som kan du visa samtidiga inloggningen räknar eller tidigare.</span><span class="sxs-lookup"><span data-stu-id="690a4-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="690a4-220">Om flera klienter använder hello samma anslutningssträng hello service autentiseras varje inloggning.</span><span class="sxs-lookup"><span data-stu-id="690a4-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="690a4-221">Om 10 användare ansluta samtidigt tooa databasen med hjälp av hello samma användarnamn och lösenord, det skulle vara 10 samtidiga inloggningar.</span><span class="sxs-lookup"><span data-stu-id="690a4-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="690a4-222">Den här gränsen gäller endast toohello varaktighet hello inloggning och autentisering.</span><span class="sxs-lookup"><span data-stu-id="690a4-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="690a4-223">Om hello samma 10 användare ansluter sekventiellt toohello databas, skulle hello antal samtidiga inloggningar aldrig vara större än 1.</span><span class="sxs-lookup"><span data-stu-id="690a4-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="690a4-224">Den här begränsningen gäller för närvarande inte toodatabases i elastiska pooler.</span><span class="sxs-lookup"><span data-stu-id="690a4-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="690a4-225">Maximalt antal sessioner</span><span class="sxs-lookup"><span data-stu-id="690a4-225">Maximum sessions</span></span>
<span data-ttu-id="690a4-226">toosee hello antalet aktuella aktiva sessioner, kör den här Transact-SQL-frågan på din SQL-databas:</span><span class="sxs-lookup"><span data-stu-id="690a4-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="690a4-227">Ändra hello frågan toofocus på en viss databas om du analyserar en lokal SQL Server-arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="690a4-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="690a4-228">Den här frågan hjälper dig att avgöra en session måste för hello databasen om du funderar på att flytta den tooAzure SQL-databas.</span><span class="sxs-lookup"><span data-stu-id="690a4-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="690a4-229">De här frågorna returnera igen, en tidpunkt i antal.</span><span class="sxs-lookup"><span data-stu-id="690a4-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="690a4-230">Om du samlar in flera insamlingar över tid, har du hello bästa förståelse för din session använder.</span><span class="sxs-lookup"><span data-stu-id="690a4-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="690a4-231">SQL Database-analys, du kan få historiska statistik på sessioner genom att fråga hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) visa och granska hello **active_session_count** kolumn.</span><span class="sxs-lookup"><span data-stu-id="690a4-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 
