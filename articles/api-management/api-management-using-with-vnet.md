---
title: "aaaHow toouse Azure API Management med virtuella nätverk"
description: "Lär dig hur toosetup anslutning tooa virtuella nätverk i Azure API Management och åtkomst web services genom den."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="18024-103">Hur toouse Azure API Management med virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="18024-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="18024-104">Virtuella Azure-nätverk (Vnet) kan du tooplace någon av dina Azure-resurser i ett routeable-internet-nätverk som du styr åtkomst till.</span><span class="sxs-lookup"><span data-stu-id="18024-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="18024-105">Dessa nätverk kan sedan vara anslutna tooyour lokala nätverk med olika VPN-teknologier.</span><span class="sxs-lookup"><span data-stu-id="18024-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="18024-106">toolearn mer om Azure Virtual Networks börja med hello information här: [Azure översikt över virtuella nätverk](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="18024-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="18024-107">Azure API Management kan distribueras i hello virtuella nätverk (VNET), så att den har åtkomst till backend-tjänster inom hello nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="18024-108">hello kan developer-portalen och API-gateway vara konfigurerade toobe som är tillgänglig från hello Internet eller endast inom hello virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="18024-109">Azure API Management stöder både klassiska och Azure Resource Manager Vnet.</span><span class="sxs-lookup"><span data-stu-id="18024-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="18024-110"><a name="enable-vpn"></a>Aktivera VNET-anslutning</span><span class="sxs-lookup"><span data-stu-id="18024-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="18024-111">Virtuella nätverk är tillgängliga i hello **Premium** och **Developer** nivåer.</span><span class="sxs-lookup"><span data-stu-id="18024-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="18024-112">tooswitch mellan hello nivåer, öppna API Management-tjänsten i hello Azure-portalen och sedan hello **skala och prissättning** fliken. Under hello **prisnivå** väljer hello Premium eller utvecklare nivån och klicka på Spara.</span><span class="sxs-lookup"><span data-stu-id="18024-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="18024-113">tooenable VNET-anslutningar, öppna API Management-tjänsten i hello Azure-portalen och hello **för virtuella nätverk** sidan.</span><span class="sxs-lookup"><span data-stu-id="18024-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Virtuellt nätverk-menyn i API Management][api-management-using-vnet-menu]

<span data-ttu-id="18024-115">Välj önskad hello åtkomsttyp:</span><span class="sxs-lookup"><span data-stu-id="18024-115">Select hello desired access type:</span></span>

* <span data-ttu-id="18024-116">**Externa**: hello API Management gateway- och developer-portalen är tillgängliga från hello offentliga internet via en extern belastningsutjämnare.</span><span class="sxs-lookup"><span data-stu-id="18024-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="18024-117">hello gateway kan komma åt resurser i hello virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-117">hello gateway can access resources within hello virtual network.</span></span>

![Offentlig peering][api-management-vnet-public]

* <span data-ttu-id="18024-119">**Internt**: hello API Management gateway- och developer-portalen är enbart tillgänglig från hello virtuellt nätverk via en intern belastningsutjämnare.</span><span class="sxs-lookup"><span data-stu-id="18024-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="18024-120">hello gateway kan komma åt resurser i hello virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-120">hello gateway can access resources within hello virtual network.</span></span>

![Privat peering][api-management-vnet-private]

<span data-ttu-id="18024-122">Nu visas en lista över alla regioner där API Management-tjänsten har etablerats.</span><span class="sxs-lookup"><span data-stu-id="18024-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="18024-123">Välj en VNET och undernät för varje region.</span><span class="sxs-lookup"><span data-stu-id="18024-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="18024-124">hello listan är fylld med både klassiska och Resource Manager virtuella nätverk som är tillgängliga i din Azure-prenumerationer som har konfigurerats i hello region som du konfigurerar.</span><span class="sxs-lookup"><span data-stu-id="18024-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="18024-125">**Tjänstslutpunkten** i hello ovanför diagrammet innehåller Gateway-proxyn, Publisher Portal, Developer-portalen, GIT och hello direkt hantering av slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="18024-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="18024-126">**Hanteringsslutpunkten** i hello ovan diagram är hello-slutpunkt som finns på hello toomanage tjänstkonfiguration via Azure portal och Powershell.</span><span class="sxs-lookup"><span data-stu-id="18024-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="18024-127">Tänk också på, att, även om hello diagram visar IP-adresser för olika, API Management-tjänsten **endast** svarar på dess konfigurerade värdnamn.</span><span class="sxs-lookup"><span data-stu-id="18024-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="18024-128">När du distribuerar ett Azure API Management instans tooa Resource Manager VNET måste hello tjänsten vara i ett dedikerat undernät som innehåller några resurser förutom Azure API Management-instanser.</span><span class="sxs-lookup"><span data-stu-id="18024-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="18024-129">Om ett försök görs toodeploy misslyckas en Azure API Management instans tooa Resource Manager VNET-undernät som innehåller andra resurser, hello-distribution.</span><span class="sxs-lookup"><span data-stu-id="18024-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Välj VPN][api-management-setup-vpn-select]

<span data-ttu-id="18024-131">Klicka på **spara** hello överst i hello-skärmen.</span><span class="sxs-lookup"><span data-stu-id="18024-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="18024-132">hello VIP-adressen för hello API Management-instansen kommer att ändras varje gång virtuella nätverk är aktiverad eller inaktiverad.</span><span class="sxs-lookup"><span data-stu-id="18024-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="18024-133">hello VIP-adressen ändras samtidigt när API Management flyttas från **externa** för**internt** eller tvärtom</span><span class="sxs-lookup"><span data-stu-id="18024-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="18024-134">Om du tar bort API-hantering från ett VNET eller ändrar hello ett den har distribuerats i låst hello har använts tidigare VNET kan vara upp too4 timmar.</span><span class="sxs-lookup"><span data-stu-id="18024-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="18024-135">Under denna tid vara möjligt toodelete hello VNET eller inte distribuera en ny resurs tooit.</span><span class="sxs-lookup"><span data-stu-id="18024-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="18024-136"><a name="enable-vnet-powershell"></a>Aktivera VNET-anslutningen med hjälp av PowerShell-cmdlets</span><span class="sxs-lookup"><span data-stu-id="18024-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="18024-137">Du kan också aktivera VNET-anslutning med hello PowerShell-cmdlets</span><span class="sxs-lookup"><span data-stu-id="18024-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="18024-138">**Skapa en API Management-tjänst i ett VNET**: Använd cmdlet hello [ny AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate Azure API Management-tjänsten i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="18024-139">**Distribuera en befintlig API Management-tjänst i ett VNET**: Använd cmdlet hello [uppdatering AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove en befintlig Azure API Management-tjänst i ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="18024-140"><a name="connect-vnet"></a>Ansluta tooa webbtjänst inom ett virtuellt nätverk</span><span class="sxs-lookup"><span data-stu-id="18024-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="18024-141">När din API Management-tjänst är ansluten toohello VNET, är åtkomst till backend-tjänster i den inte annorlunda än att komma åt offentliga tjänster.</span><span class="sxs-lookup"><span data-stu-id="18024-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="18024-142">Skriv i hello lokal IP-adress eller hello värdnamnet (om en DNS-server är konfigurerad för hello VNET) för webbtjänsten i hello **-webbtjänstens URL** fältet när du skapar ett nytt API eller redigerar en befintlig.</span><span class="sxs-lookup"><span data-stu-id="18024-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Lägg till API från VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="18024-144"><a name="network-configuration-issues"></a>Vanliga nätverkskonfigurationen</span><span class="sxs-lookup"><span data-stu-id="18024-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="18024-145">Nedan följer en lista över vanliga problem som kan uppstå vid distribution av API Management-tjänsten till ett virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="18024-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="18024-146">**Anpassade DNS-serverinstallation**: hello API Management-tjänsten är beroende av flera Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="18024-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="18024-147">När API-hantering finns i ett VNET med en anpassad DNS-server, måste tooresolve hello värdnamn för de Azure-tjänsterna.</span><span class="sxs-lookup"><span data-stu-id="18024-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="18024-148">Följ [detta](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) vägledning om anpassade DNS-inställningarna.</span><span class="sxs-lookup"><span data-stu-id="18024-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="18024-149">Se hello portar tabellen nedan och andra krav som referens.</span><span class="sxs-lookup"><span data-stu-id="18024-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="18024-150">Det rekommenderas att, om du använder en anpassad DNS-servrar för hello VNET kan du konfigurera som **innan** distribuera en API Management-tjänsten till den.</span><span class="sxs-lookup"><span data-stu-id="18024-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="18024-151">Annat du behöver för uppdatera hello API Management-tjänsten varje gång du ändrar hello DNS-servrar (s) genom att köra hello [gäller åtgärden för konfiguration](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="18024-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="18024-152">**Portar som behövs för API Management**: inkommande och utgående trafik till hello undernät som API Management har distribuerats kan kontrolleras med [Nätverkssäkerhetsgruppen][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="18024-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="18024-153">Om någon av dessa portar är otillgängliga API Management kanske inte fungerar korrekt och kan inte komma åt.</span><span class="sxs-lookup"><span data-stu-id="18024-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="18024-154">Med en eller flera av de här portarna blockeras är ett annat vanligt felkonfiguration problem när du använder API-hantering med ett VNET.</span><span class="sxs-lookup"><span data-stu-id="18024-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="18024-155">När en instans för API Management-tjänsten finns i ett VNET, används hello portarna i följande tabell hello.</span><span class="sxs-lookup"><span data-stu-id="18024-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="18024-156">Källan / målet portar</span><span class="sxs-lookup"><span data-stu-id="18024-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="18024-157">Riktning</span><span class="sxs-lookup"><span data-stu-id="18024-157">Direction</span></span> | <span data-ttu-id="18024-158">Transportprotokoll</span><span class="sxs-lookup"><span data-stu-id="18024-158">Transport protocol</span></span> | <span data-ttu-id="18024-159">Syfte</span><span class="sxs-lookup"><span data-stu-id="18024-159">Purpose</span></span> | <span data-ttu-id="18024-160">Källan / målet</span><span class="sxs-lookup"><span data-stu-id="18024-160">Source / Destination</span></span> | <span data-ttu-id="18024-161">Åtkomsttyp</span><span class="sxs-lookup"><span data-stu-id="18024-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="18024-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="18024-162">* / 80, 443</span></span> |<span data-ttu-id="18024-163">Inkommande</span><span class="sxs-lookup"><span data-stu-id="18024-163">Inbound</span></span> |<span data-ttu-id="18024-164">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-164">TCP</span></span> |<span data-ttu-id="18024-165">Klienten kommunikation tooAPI Management</span><span class="sxs-lookup"><span data-stu-id="18024-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="18024-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="18024-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="18024-167">Extern</span><span class="sxs-lookup"><span data-stu-id="18024-167">External</span></span> |
| <span data-ttu-id="18024-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="18024-168">* / 3443</span></span> |<span data-ttu-id="18024-169">Inkommande</span><span class="sxs-lookup"><span data-stu-id="18024-169">Inbound</span></span> |<span data-ttu-id="18024-170">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-170">TCP</span></span> |<span data-ttu-id="18024-171">Hanteringsslutpunkten för Azure-portalen och Powershell</span><span class="sxs-lookup"><span data-stu-id="18024-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="18024-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="18024-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="18024-173">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-173">External & Internal</span></span> |
| <span data-ttu-id="18024-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="18024-174">* / 80, 443</span></span> |<span data-ttu-id="18024-175">Utgående</span><span class="sxs-lookup"><span data-stu-id="18024-175">Outbound</span></span> |<span data-ttu-id="18024-176">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-176">TCP</span></span> |<span data-ttu-id="18024-177">Beroendet av Azure Storage och Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="18024-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="18024-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="18024-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="18024-179">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-179">External & Internal</span></span> |
| <span data-ttu-id="18024-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="18024-180">* / 1433</span></span> |<span data-ttu-id="18024-181">Utgående</span><span class="sxs-lookup"><span data-stu-id="18024-181">Outbound</span></span> |<span data-ttu-id="18024-182">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-182">TCP</span></span> |<span data-ttu-id="18024-183">Beroende på Azure SQL</span><span class="sxs-lookup"><span data-stu-id="18024-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="18024-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="18024-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="18024-185">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-185">External & Internal</span></span> |
| <span data-ttu-id="18024-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="18024-186">* / 11000 - 11999</span></span> |<span data-ttu-id="18024-187">Utgående</span><span class="sxs-lookup"><span data-stu-id="18024-187">Outbound</span></span> |<span data-ttu-id="18024-188">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-188">TCP</span></span> |<span data-ttu-id="18024-189">V12 Azure SQL-beroendet</span><span class="sxs-lookup"><span data-stu-id="18024-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="18024-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="18024-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="18024-191">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-191">External & Internal</span></span> |
| <span data-ttu-id="18024-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="18024-192">* / 14000 - 14999</span></span> |<span data-ttu-id="18024-193">Utgående</span><span class="sxs-lookup"><span data-stu-id="18024-193">Outbound</span></span> |<span data-ttu-id="18024-194">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-194">TCP</span></span> |<span data-ttu-id="18024-195">V12 Azure SQL-beroendet</span><span class="sxs-lookup"><span data-stu-id="18024-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="18024-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="18024-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="18024-197">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-197">External & Internal</span></span> |
| <span data-ttu-id="18024-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="18024-198">* / 5671</span></span> |<span data-ttu-id="18024-199">Utgående</span><span class="sxs-lookup"><span data-stu-id="18024-199">Outbound</span></span> |<span data-ttu-id="18024-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="18024-200">AMQP</span></span> |<span data-ttu-id="18024-201">Beroende av loggen tooEvent hubb principen och övervakningsagent</span><span class="sxs-lookup"><span data-stu-id="18024-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="18024-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="18024-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="18024-203">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-203">External & Internal</span></span> |
| <span data-ttu-id="18024-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="18024-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="18024-205">Inkommande och utgående</span><span class="sxs-lookup"><span data-stu-id="18024-205">Inbound & Outbound</span></span> |<span data-ttu-id="18024-206">UDP</span><span class="sxs-lookup"><span data-stu-id="18024-206">UDP</span></span> |<span data-ttu-id="18024-207">Beroende på Redis-Cache</span><span class="sxs-lookup"><span data-stu-id="18024-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="18024-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="18024-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="18024-209">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-209">External & Internal</span></span> |-
| <span data-ttu-id="18024-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="18024-210">* / 445</span></span> |<span data-ttu-id="18024-211">Utgående</span><span class="sxs-lookup"><span data-stu-id="18024-211">Outbound</span></span> |<span data-ttu-id="18024-212">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-212">TCP</span></span> |<span data-ttu-id="18024-213">Beroende på Azure-filresursen för GIT</span><span class="sxs-lookup"><span data-stu-id="18024-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="18024-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="18024-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="18024-215">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-215">External & Internal</span></span> |
| <span data-ttu-id="18024-216">* / *</span><span class="sxs-lookup"><span data-stu-id="18024-216">* / *</span></span> | <span data-ttu-id="18024-217">Inkommande</span><span class="sxs-lookup"><span data-stu-id="18024-217">Inbound</span></span> |<span data-ttu-id="18024-218">TCP</span><span class="sxs-lookup"><span data-stu-id="18024-218">TCP</span></span> |<span data-ttu-id="18024-219">Azure-infrastrukturen belastningsutjämnare</span><span class="sxs-lookup"><span data-stu-id="18024-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="18024-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="18024-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="18024-221">Externa och interna</span><span class="sxs-lookup"><span data-stu-id="18024-221">External & Internal</span></span> |

* <span data-ttu-id="18024-222">**SSL-funktionen**: kedjan byggnad och validering hello API Management-tjänsten måste utgående network connectivity tooocsp.msocsp.com, mscrl.microsoft.com och crl.microsoft.com tooenable SSL-certifikat. Detta beroende är inte krävs, om alla certifikat som du överför tooAPI Management innehåller hello fullständig kedja toohello CA rot.</span><span class="sxs-lookup"><span data-stu-id="18024-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="18024-223">**DNS-åtkomst**: utgående åtkomst på port 53 krävs för kommunikation med DNS-servrar.</span><span class="sxs-lookup"><span data-stu-id="18024-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="18024-224">Om en anpassad DNS-server finns på Hej andra änden av en VPN-gateway, hello DNS-server måste kunna nås från hello undernät som är värd för API-hantering.</span><span class="sxs-lookup"><span data-stu-id="18024-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="18024-225">**Mått och hälsoövervakning**: utgående anslutning tooAzure övervakning nätverksslutpunkter, vilket löser under hello följande domäner: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="18024-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="18024-226">**Expressinstallationen väg**: en gemensam konfiguration av customer är toodefine sina egna standardvägen (0.0.0.0/0) som tvingar utgående Internet-trafik tooinstead flöde lokalt.</span><span class="sxs-lookup"><span data-stu-id="18024-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="18024-227">Den här trafikflöde bryts utan undantag anslutningen till Azure API Management eftersom hello utgående trafik är antingen blockerade lokalt eller NAT d tooan okänt uppsättning adresser som inte längre att fungera med olika Azure-slutpunkter.</span><span class="sxs-lookup"><span data-stu-id="18024-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="18024-228">hello lösningen är toodefine (minst) användardefinierade vägar ([udr: er][UDRs]) i hello undernät som innehåller hello Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="18024-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="18024-229">En UDR definierar undernät-specifika vägar som ska användas i stället för hello standardväg.</span><span class="sxs-lookup"><span data-stu-id="18024-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="18024-230">Om möjligt bör toouse hello följande konfiguration:</span><span class="sxs-lookup"><span data-stu-id="18024-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="18024-231">Hej ExpressRoute configuration annonserar 0.0.0.0/0 och som standard kraft tunnlar all utgående trafik lokalt.</span><span class="sxs-lookup"><span data-stu-id="18024-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="18024-232">Hej UDR tillämpas toohello undernät som innehåller hello Azure API Management definierar 0.0.0.0/0 med ett nexthop-typ för Internet.</span><span class="sxs-lookup"><span data-stu-id="18024-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="18024-233">hello är kombinerade effekten av dessa steg att hello undernätverksnivå UDR företräde framför hello ExpressRoute Tvingad tunneltrafik tillse utgående Internetåtkomst från hello Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="18024-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="18024-234">Azure API Management stöds inte med ExpressRoute-konfigurationer som **felaktigt cross-annonsera vägar från hello offentlig peering sökväg toohello privat peering sökväg**.</span><span class="sxs-lookup"><span data-stu-id="18024-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="18024-235">ExpressRoute-konfigurationer som har konfigurerats, offentlig peering får vägannonser från Microsoft för ett stort antal Microsoft Azure IP-adressintervall.</span><span class="sxs-lookup"><span data-stu-id="18024-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="18024-236">Om dessa adressintervall felaktigt cross-annonserade på hello privat peering sökväg, är hello slutresultatet att alla utgående paket från hello Azure API Management instans undernät är felaktigt kraft tunneldata tooa kundens lokala nätverk infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="18024-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="18024-237">Det här nätverket flödet bryts Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="18024-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="18024-238">hello lösning toothis problemet är toostop mellan reklam vägar från hello offentlig peering sökväg toohello privat peering sökväg.</span><span class="sxs-lookup"><span data-stu-id="18024-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="18024-239"><a name="troubleshooting"></a>Felsökning</span><span class="sxs-lookup"><span data-stu-id="18024-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="18024-240">När du gör ändringar tooyour nätverket referera för[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate om hello API Management-tjänsten inte har förlorat åtkomst tooany av hello viktiga resurser som den är beroende av.</span><span class="sxs-lookup"><span data-stu-id="18024-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="18024-241">hello anslutningsstatus ska uppdateras var 15: e minut.</span><span class="sxs-lookup"><span data-stu-id="18024-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="18024-242"><a name="limitations"></a>Begränsningar</span><span class="sxs-lookup"><span data-stu-id="18024-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="18024-243">Ett undernät som innehåller API Management-instanser får inte innehålla andra Azure-resurs-typer.</span><span class="sxs-lookup"><span data-stu-id="18024-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="18024-244">hello-undernät och hello API Management-tjänsten måste vara i hello samma prenumeration.</span><span class="sxs-lookup"><span data-stu-id="18024-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="18024-245">Ett undernät som innehåller API Management-instanser kan inte flyttas mellan prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="18024-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="18024-246">När du använder ett internt virtuellt nätverk endast en intern IP-adress ska vara tillgänglig från hello intervallet anges i [RFC 1918](https://tools.ietf.org/html/rfc1918), en offentlig IP-adress kan inte anges.</span><span class="sxs-lookup"><span data-stu-id="18024-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="18024-247">För distribution av flera regioner API Management ansvarar med interna virtuella nätverk som har konfigurerats kan användare för att hantera sina egna belastningsutjämning som de äger hello DNS.</span><span class="sxs-lookup"><span data-stu-id="18024-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="18024-248"><a name="related-content"></a>Relaterat innehåll</span><span class="sxs-lookup"><span data-stu-id="18024-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="18024-249">Ansluta ett virtuellt nätverk toobackend med hjälp av Vpn-Gateway</span><span class="sxs-lookup"><span data-stu-id="18024-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="18024-250">Ansluta ett virtuellt nätverk från olika distributionsmodeller</span><span class="sxs-lookup"><span data-stu-id="18024-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="18024-251">Hur toouse hello API Inspector tootrace anropar i Azure API Management</span><span class="sxs-lookup"><span data-stu-id="18024-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
