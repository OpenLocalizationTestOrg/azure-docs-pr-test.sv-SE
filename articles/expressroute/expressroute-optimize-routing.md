---
title: 'Optimera ExpressRoute-routning: Azure | Microsoft Docs'
description: "Den här sidan innehåller information om hur toooptimize routning när du har mer än en ExpressRoute kretsar som anslutning mellan Microsoft och corp-nätverk."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="e3fcb-103">Optimera ExpressRoute-routning</span><span class="sxs-lookup"><span data-stu-id="e3fcb-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="e3fcb-104">När du har flera ExpressRoute-kretsar har mer än en sökväg tooconnect tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="e3fcb-105">Därför kan hända att något sämre routning - som är trafiken kan ta en längre sökväg tooreach Microsoft, och Microsoft tooyour nätverk.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="e3fcb-106">hello längre hello nätverkssökväg hello högre hello latens.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="e3fcb-107">Svarstiden har direkt inverkan på programmens prestanda och användarupplevelse.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="e3fcb-108">Den här artikeln kommer illustrerar problemet och förklara hur toooptimize routning med hello standard routning tekniker.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="e3fcb-109">Något sämre routning från kunden tooMicrosoft</span><span class="sxs-lookup"><span data-stu-id="e3fcb-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="e3fcb-110">Nu ska vi titta Stäng på hello routning problem med ett exempel.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="e3fcb-111">Anta att du har två kontor i hello USA, en i Los Angeles och en i New York.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="e3fcb-112">Ditt kontor ansluts i ett WAN (Wide Area Network), som kan vara antingen ditt eget stamnät eller leverantörens IP VPN.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="e3fcb-113">Du har två ExpressRoute-kretsar, en i oss Väst och en i oss East, som även är anslutna på hello WAN.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="e3fcb-114">Naturligtvis, har du två sökvägar tooconnect toohello Microsoft-nätverk.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="e3fcb-115">Anta nu att du har Azure-distribution (t.ex. Azure App Service) i både ”USA, västra” och ”USA, östra”.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="e3fcb-116">Din avsikt är tooconnect användarna i Los Angeles tooAzure oss Väst och användarna i New York tooAzure oss Öst eftersom tjänstadministratören meddelar att användare i varje office access hello Närliggande Azure-tjänster för optimal upplevelse.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="e3fcb-117">Tyvärr fungerar hello plan bra för hello ostkust användare men inte för hello någon annan användare.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="e3fcb-118">hello beror hello problemet på hello följande.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="e3fcb-119">På varje ExpressRoute-krets annonsera vi tooyou både hello prefix i Azure oss East (23.100.0.0/16) och hello-prefix i Azure oss Väst (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="e3fcb-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="e3fcb-120">Om du inte vet vilka prefixet är från vilken region kan du inte är kan tootreat den på olika sätt.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="e3fcb-121">WAN-nätverk kan tänka både hello prefix är närmare tooUS Öst än oss Väst och därför dirigera både office användare toohello ExpressRoute-krets i oss East.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="e3fcb-122">Du har många missnöjda användare i hello Los Angeles office i hello slutet.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![ExpressRoute fall 1 problem - något sämre routning från kunden tooMicrosoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="e3fcb-124">Lösning: Använd BGP-communities</span><span class="sxs-lookup"><span data-stu-id="e3fcb-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="e3fcb-125">toooptimize tooknow vilka prefixet är från Azure oss Väst och vilka från Azure oss Öst måste routning för både användare av office.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="e3fcb-126">Vi kodar informationen genom att använda [BGP Community-värden](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="e3fcb-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="e3fcb-127">Vi har tilldelat en unik BGP Community värdet tooeach Azure-region, t.ex. ”12076:51004” för östra USA och ”12076:51006” för västra USA.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="e3fcb-128">Nu när du vet vilket prefix är från vilken Azure-region, kan du konfigurera de ExpressRoute-kretsar som ska användas.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="e3fcb-129">Eftersom vi använder hello BGP tooexchange routning information kan du använda BGPS lokala inställningar tooinfluence routning.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="e3fcb-130">Du kan tilldela en högre lokala inställningar värdet too13.100.0.0/16 i oss Väst än i oss East och på samma sätt kan en högre lokala inställningar värdet too23.100.0.0/16 i oss East än i oss Väst i vårt exempel.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="e3fcb-131">Den här konfigurationen säkerställer att, när båda sökvägar tooMicrosoft, användarna i Los Angeles tar hello ExpressRoute-krets i oss West tooconnect tooAzure oss Väst användarna i New York vidta hello ExpressRoute i oss Öst tooAzure oss Öst .</span><span class="sxs-lookup"><span data-stu-id="e3fcb-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="e3fcb-132">Routning är optimerad på båda sidorna.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-132">Routing is optimized on both sides.</span></span> 

![ExpressRoute fall 1 – Lösning: Använd BGP-communities](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="e3fcb-134">hello kan samma teknik som använder lokala inställningar vara tillämpade toorouting från kunden tooAzure virtuellt nätverk.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="e3fcb-135">Vi tagga inte BGP Community värdet toohello prefix som annonseras från Azure tooyour nätverk.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="e3fcb-136">Eftersom du vet vilket av distributionen av virtuella nätverk är nära toowhich av dina office, du kan dock konfigurera dina routrar därefter tooprefer en ExpressRoute-kretsen tooanother.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="e3fcb-137">Något sämre routning från Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="e3fcb-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="e3fcb-138">Här är ett annat exempel där anslutningar från Microsoft tar en längre sökväg tooreach nätverket.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="e3fcb-139">I detta fall måste du använda lokala Exchange-servrar och Exchange Online i en [hybridmiljö](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="e3fcb-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="e3fcb-140">Kontoret är anslutna tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="e3fcb-141">Du annonserar hello prefixen för dina lokala servrar i både din kontor tooMicrosoft via hello två ExpressRoute-kretsar.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="e3fcb-142">Exchange Online initierar anslutningar toohello lokala servrar i sådana fall postlåda migrering.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="e3fcb-143">Tyvärr är hello anslutning tooyour Los Angeles office routade toohello ExpressRoute-krets i oss East innan passerar hello hela kontinent tillbaka toohello någon annan.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="e3fcb-144">hello hello problemet beror på liknande toohello först en.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="e3fcb-145">Hello Microsoft network går inte att avgöra vilka kund-prefixet är nära tooUS Öst och vilket som ligger nära tooUS Väst utan några tips.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="e3fcb-146">Det händer toopick hello Felaktigt sökvägsformat tooyour office i Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute-fall 2 - något sämre routning från Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="e3fcb-148">Lösning: Använd AS PATH</span><span class="sxs-lookup"><span data-stu-id="e3fcb-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="e3fcb-149">Det finns två lösningar toohello problem.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="e3fcb-150">hello först är en att du helt enkelt annonsera lokala-prefix för kontoret Los Angeles 177.2.0.0/31 på hello ExpressRoute-krets i oss Väst och dina lokala prefix för kontoret New York 177.2.0.2/31 på hello ExpressRoute-krets i oss East.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="e3fcb-151">Det är därför bara en sökväg för Microsoft tooconnect tooeach på kontoret.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="e3fcb-152">Det finns inga tveksamheter och routningen optimeras.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="e3fcb-153">Med den här designen måste toothink om din strategi för växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="e3fcb-154">Hello händelse som hello sökvägen tooMicrosoft via ExpressRoute är bruten måste du toomake till att Exchange Online kan fortfarande Anslut tooyour lokala servrar.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="e3fcb-155">andra hello-lösning är att du fortsätter hello prefix tooadvertise både på både ExpressRoute-kretsar och dessutom du ger oss en ledtråd för vilka prefix är nära toowhich något av ditt kontor.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="e3fcb-156">Eftersom vi stöder BGP AS sökväg tillagt, kan du konfigurera hello som sökväg för din prefixet tooinfluence routning.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="e3fcb-157">I det här exemplet kan du förlänga hello som sökväg för 172.2.0.0/31 i oss East så att vi kommer att föredra hello ExpressRoute-krets i oss Väst för trafik till det här prefixet (som vårt nätverk kommer tror hello sökvägen toothis prefixet är kortare hello west).</span><span class="sxs-lookup"><span data-stu-id="e3fcb-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="e3fcb-158">På liknande sätt kan du förlänga hello som sökväg för 172.2.0.2/31 i oss Väst så att vi ska föredrar hello ExpressRoute-krets i oss East.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="e3fcb-159">Routning är optimerat för båda kontoren.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="e3fcb-160">Med den här designen kan Exchange Online fortfarande nå dig via en annan ExpressRoute-krets och ditt WAN om en ExpressRoute-krets bryts.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="e3fcb-161">Vi ta bort privata talen i hello som sökväg för hello prefix som tas emot på Microsoft-Peering.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="e3fcb-162">Du behöver tooappend offentliga som siffror i hello AS SÖKVÄGEN tooinfluence routning för Microsoft-Peering.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![ExpressRoute fall 2 – Lösning: Använd AS PATH-prepending](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="e3fcb-164">Medan hello-exempel som anges här är för Microsoft och offentliga peerkopplingar, vi stöder hello samma funktioner för hello privat peering.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="e3fcb-165">Hello AS sökväg tillagt fungerar också i en enda ExpressRoute-krets, tooinfluence hello val av hello primära och sekundära sökvägar.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="e3fcb-166">Icke-optimal routning mellan virtuella nätverk</span><span class="sxs-lookup"><span data-stu-id="e3fcb-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="e3fcb-167">Du kan aktivera tooVirtual virtuellt nätverk (som även kallas ”virtuella nätverk”) med ExpressRoute kommunikation genom att koppla tooan ExpressRoute-kretsen.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="e3fcb-168">När du länkar dem. toomultiple ExpressRoute-kretsar något sämre routning kan inträffa mellan hello Vnet.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="e3fcb-169">Vi tar ett exempel.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-169">Let's consider an example.</span></span> <span data-ttu-id="e3fcb-170">Anta att du har två ExpressRoute-kretsar, en i ”USA, västra” och en i ”USA, östra”.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="e3fcb-171">Du har två virtuella nätverk i varje region.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-171">In each region, you have two VNets.</span></span> <span data-ttu-id="e3fcb-172">Webbservrar har distribuerats i ett virtuellt nätverk och programservrar i hello andra.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="e3fcb-173">För redundans, länkar hello två Vnet i varje region tooboth hello lokala ExpressRoute-krets och hello remote ExpressRoute-kretsen.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="e3fcb-174">Som visas nedan, från varje VNet finns två sökvägar toohello andra VNet.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="e3fcb-175">Hej Vnet vet inte vilka ExpressRoute-kretsen är lokala och vilket som är fjärransluten.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="e3fcb-176">Därför som lika-kostnad-Multi-Path ECMP () routning tooload balans mellan VNet-trafik, vissa trafikflöden tar hello längre sökväg och hämta dirigeras på hello remote ExpressRoute-kretsen.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![ExpressRoute fall 3 – Icke-optimal routning mellan virtuella nätverk](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="e3fcb-178">Lösning: tilldela en hög vikt toolocal anslutning</span><span class="sxs-lookup"><span data-stu-id="e3fcb-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="e3fcb-179">hello-lösning är enkel.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-179">hello solution is simple.</span></span> <span data-ttu-id="e3fcb-180">Eftersom du vet var hello Vnet och hello kretsar finns, kan du berätta vilken sökväg du varje VNet ska föredrar.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="e3fcb-181">Specifikt för det här exemplet du tilldelar en högre vikt toohello lokal anslutning än toohello fjärranslutning (se hello configuration exempel [här](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="e3fcb-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="e3fcb-182">När ett VNet tar emot hello prefixet hello andra VNet på flera anslutningar som den kommer att föredra hello anslutning med hello högsta vikt toosend trafik till det prefixet.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![ExpressRoute fall 3 lösning – tilldela hög vikt toolocal anslutning](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="e3fcb-184">Du kan även påverka routning från VNet tooyour lokalt nätverk om du har flera ExpressRoute-kretsar genom att konfigurera hello vikten för en anslutning i stället för att tillämpa AS SÖKVÄGEN prepending, en teknik som beskrivs i hello andra scenariot ovan.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="e3fcb-185">För varje prefixet alltid beskrivs hello anslutning vikt innan hello AS sökvägslängden när du bestämmer hur toosend trafik.</span><span class="sxs-lookup"><span data-stu-id="e3fcb-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
