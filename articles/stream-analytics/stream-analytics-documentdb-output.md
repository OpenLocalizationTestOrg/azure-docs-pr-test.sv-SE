---
title: "aaaJSON utdata för Stream Analytics | Microsoft Docs"
description: "Lär dig hur Stream Analytics kan inrikta dig på Azure Cosmos DB för JSON-utdata för dataarkivering och låg latens frågor för Ostrukturerade JSON-data."
keywords: JSON-utdata
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="08bad-104">Mål Azure Cosmos DB för JSON-utdata från Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="08bad-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="08bad-105">Stream Analytics kan rikta [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) att aktivera arkivering och låg latens datafrågor på Ostrukturerade JSON-data för JSON-utdata.</span><span class="sxs-lookup"><span data-stu-id="08bad-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="08bad-106">Det här dokumentet beskrivs några metoder för att implementera den här konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="08bad-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="08bad-107">För de som inte är bekant med Cosmos DB, ta en titt på [Azure Cosmos DB Utbildningsväg](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget igång.</span><span class="sxs-lookup"><span data-stu-id="08bad-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="08bad-108">Obs: Mongo DB API-baserad Cosmos DB samlingar stöds inte för närvarande.</span><span class="sxs-lookup"><span data-stu-id="08bad-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="08bad-109">Grunderna i Cosmos DB som ett mål för utdata</span><span class="sxs-lookup"><span data-stu-id="08bad-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="08bad-110">hello Azure Cosmos DB utdata i Stream Analytics kan skriva strömmen bearbetning resultatet som JSON-utdata till Cosmos-DB-samling(ar).</span><span class="sxs-lookup"><span data-stu-id="08bad-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="08bad-111">Stream Analytics skapar inte samlingar i databasen, i stället att kräva att du toocreate dem gång.</span><span class="sxs-lookup"><span data-stu-id="08bad-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="08bad-112">Detta är så att hello fakturering kostnaderna för Cosmos DB samlingar är transparent tooyou och så att du kan finjustera hello prestanda, konsekvens och kapacitet för samlingar med direkt hello [Cosmos DB-API: er](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="08bad-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="08bad-113">Vi rekommenderar en Cosmos DB databas per streaming job toologically separata samlingar för ett direktuppspelningsjobb.</span><span class="sxs-lookup"><span data-stu-id="08bad-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="08bad-114">Vissa av hello Cosmos DB samling alternativ beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="08bad-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="08bad-115">Finjustera konsekvens, tillgänglighet och svarstid</span><span class="sxs-lookup"><span data-stu-id="08bad-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="08bad-116">toomatch din programkrav, Cosmos DB kan du toofine finjustera hello-databasen och samlingar och kontrollera avvägningarna mellan konsekvens, tillgänglighet och svarstid.</span><span class="sxs-lookup"><span data-stu-id="08bad-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="08bad-117">Beroende på vilka nivåer av läskonsekvens scenariot behov mot läsa och skriva latens, du kan välja en konsekvensnivå på ditt konto.</span><span class="sxs-lookup"><span data-stu-id="08bad-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="08bad-118">Som standard kan Cosmos DB också synkron indexering på varje CRUD åtgärden tooyour samling.</span><span class="sxs-lookup"><span data-stu-id="08bad-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="08bad-119">Det här är en annan användbar alternativet toocontrol hello skrivning/läsning prestanda i Cosmos-databasen.</span><span class="sxs-lookup"><span data-stu-id="08bad-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="08bad-120">Mer information om det här avsnittet granska hello [ändra din databas och fråga konsekvensnivåer](../documentdb/documentdb-consistency-levels.md) artikel.</span><span class="sxs-lookup"><span data-stu-id="08bad-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="08bad-121">Upserts från Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="08bad-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="08bad-122">Stream Analytics-integrering med Cosmos DB tillåter tooinsert eller uppdatera poster i din Cosmos-DB-samling baserat på en viss dokument-ID-kolumn.</span><span class="sxs-lookup"><span data-stu-id="08bad-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="08bad-123">Det är också hänvisade tooas en *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="08bad-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="08bad-124">Stream Analytics använder optimistisk Upsert lösning där uppdateringar görs endast när insert misslyckas på grund av tooa dokument-ID-konflikt.</span><span class="sxs-lookup"><span data-stu-id="08bad-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="08bad-125">Den här uppdateringen utförs av Stream Analytics som en korrigering, så gör deluppdateringar toohello dokument, t.ex. lägga till nya egenskaper eller ersätta en befintlig egenskap utförs inkrementellt.</span><span class="sxs-lookup"><span data-stu-id="08bad-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="08bad-126">Observera att ändringar i hello värdena i matrisen egenskaper i JSON-dokumentet medföra hello hela matrisen komma över, d.v.s. hello matrisen inte samman.</span><span class="sxs-lookup"><span data-stu-id="08bad-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="08bad-127">Datapartitionering i Cosmos-DB</span><span class="sxs-lookup"><span data-stu-id="08bad-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="08bad-128">Cosmos DB [partitionerade samlingar](../cosmos-db/partition-data.md) är hello rekommenderat tillvägagångssätt för partitionering av dina data.</span><span class="sxs-lookup"><span data-stu-id="08bad-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="08bad-129">För enkel Cosmos DB samlingar kan Stream Analytics du fortfarande toopartition dina data baserat på både hello frågemönster och prestanda för programmet.</span><span class="sxs-lookup"><span data-stu-id="08bad-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="08bad-130">Varje samling kan innehålla in too10GB av data (max) och för närvarande är det inget sätt tooscale (eller dataspill) en samling.</span><span class="sxs-lookup"><span data-stu-id="08bad-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="08bad-131">Skala ut Stream Analytics kan du för toowrite toomultiple samlingar med ett givet prefix (se användningsinformation nedan).</span><span class="sxs-lookup"><span data-stu-id="08bad-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="08bad-132">Stream Analytics använder hello konsekvent [hash-Partition matcharen](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategi baserat på hello användaren får PartitionKey kolumnen toopartition dess utdata-poster.</span><span class="sxs-lookup"><span data-stu-id="08bad-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="08bad-133">hello antal samlingar med hello ges prefix hello strömning jobbets starttid används som hello utdata partitionsantal toowhich hello jobbet skriver tooin parallell (Cosmos DB samlingar = utdata partitioner).</span><span class="sxs-lookup"><span data-stu-id="08bad-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="08bad-134">För en enda samling med lazy indexering detta endast infogar, om 0,4 som kan förväntas MB/s genomströmning för skrivning.</span><span class="sxs-lookup"><span data-stu-id="08bad-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="08bad-135">Med hjälp av flera samlingar kan du tooachieve högre genomflöde och bättre kapacitet.</span><span class="sxs-lookup"><span data-stu-id="08bad-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="08bad-136">Om du planerar tooincrease hello partitionsantal i hello framtida, kanske du måste toostop jobbet partitionera om hello data från din befintliga samlingar till nya samlingar och sedan starta om hello Stream Analytics-jobbet.</span><span class="sxs-lookup"><span data-stu-id="08bad-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="08bad-137">Mer information om att använda PartitionResolver och nytt partitionering tillsammans med exempelkod inkluderas i en e-post.</span><span class="sxs-lookup"><span data-stu-id="08bad-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="08bad-138">hello artikel [partitionering och skalning i Cosmos DB](../documentdb/documentdb-partition-data.md) innehåller även information om detta.</span><span class="sxs-lookup"><span data-stu-id="08bad-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="08bad-139">Cosmos DB inställningar för JSON-utdata</span><span class="sxs-lookup"><span data-stu-id="08bad-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="08bad-140">Skapa Cosmos DB som utdata i Stream Analytics genererar en fråga om information som visas nedan.</span><span class="sxs-lookup"><span data-stu-id="08bad-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="08bad-141">Det här avsnittet innehåller en förklaring av hello egenskaper definition.</span><span class="sxs-lookup"><span data-stu-id="08bad-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="08bad-142">Partitionerad samling</span><span class="sxs-lookup"><span data-stu-id="08bad-142">Partitioned Collection</span></span> | <span data-ttu-id="08bad-143">Flera ”enskild Partition” samlingar</span><span class="sxs-lookup"><span data-stu-id="08bad-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb stream analytics utdata skärmen](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb stream analytics utdata skärmen](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="08bad-146">Hej **flera ”enkel” partitionssamlingar** scenariot kräver en partitionsnyckel och är en konfiguration som stöds.</span><span class="sxs-lookup"><span data-stu-id="08bad-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="08bad-147">**Utdata Alias** – ett alias toorefer detta utdata i frågan ASA</span><span class="sxs-lookup"><span data-stu-id="08bad-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="08bad-148">**Kontonamn** – hello namn eller endpoint-URI för hello Cosmos-DB-konto.</span><span class="sxs-lookup"><span data-stu-id="08bad-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="08bad-149">**Kontot nyckeln** – hello delade åtkomstnyckeln för hello Cosmos-DB-konto.</span><span class="sxs-lookup"><span data-stu-id="08bad-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="08bad-150">**Databasen** – hello Cosmos-DB-databasnamn.</span><span class="sxs-lookup"><span data-stu-id="08bad-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="08bad-151">**Samlingsnamnsmönstret** – hello samlingens namn eller deras mönster för hello samlingar toobe används.</span><span class="sxs-lookup"><span data-stu-id="08bad-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="08bad-152">Hej samlingsnamnsformatet kan konstrueras med valfritt {partition}-token hello där partitionerna börjar från 0.</span><span class="sxs-lookup"><span data-stu-id="08bad-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="08bad-153">Följande är exempel giltiga indata:</span><span class="sxs-lookup"><span data-stu-id="08bad-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="08bad-154">1\) MyCollection – en samling med namnet ”MyCollection” måste finnas.</span><span class="sxs-lookup"><span data-stu-id="08bad-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="08bad-155">2\) MyCollection {partition} – dessa samlingar måste finnas – ”MyCollection0”, ”MyCollection1”, ”MyCollection2” och så vidare.</span><span class="sxs-lookup"><span data-stu-id="08bad-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="08bad-156">**Partitionera nyckeln** – det är valfritt.</span><span class="sxs-lookup"><span data-stu-id="08bad-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="08bad-157">Det här krävs bara om du använder en {partition}-token i din samlingsnamnsmönstret.</span><span class="sxs-lookup"><span data-stu-id="08bad-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="08bad-158">hello namnet på hello fält i utdata händelser som används toospecify hello nyckel för att partionera utdata över samlingarna.</span><span class="sxs-lookup"><span data-stu-id="08bad-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="08bad-159">Enda samling utdata för en godtycklig utdatakolumnen kan vara används t.ex. PartitionId.</span><span class="sxs-lookup"><span data-stu-id="08bad-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="08bad-160">**Dokumentera ID** – det är valfritt.</span><span class="sxs-lookup"><span data-stu-id="08bad-160">**Document ID** – Optional.</span></span> <span data-ttu-id="08bad-161">hello namnet på hello-fältet i utdatahändelserna används toospecify hello primärnyckel operations baseras på vilka insert eller update.</span><span class="sxs-lookup"><span data-stu-id="08bad-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  
