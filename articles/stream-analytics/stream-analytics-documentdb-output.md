---
title: "JSON-utdata för Stream Analytics | Microsoft Docs"
description: "Lär dig hur Stream Analytics kan inrikta dig på Azure Cosmos DB för JSON-utdata för dataarkivering och låg latens frågor för Ostrukturerade JSON-data."
keywords: JSON-utdata
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: cc80b0080c806541362a1ef2d71b95862bd51ca2
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="6df91-104">Mål Azure Cosmos DB för JSON-utdata från Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6df91-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="6df91-105">Stream Analytics kan rikta [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) att aktivera arkivering och låg latens datafrågor på Ostrukturerade JSON-data för JSON-utdata.</span><span class="sxs-lookup"><span data-stu-id="6df91-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="6df91-106">Det här dokumentet beskrivs några metoder för att implementera den här konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="6df91-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="6df91-107">För de som inte är bekant med Cosmos DB, ta en titt på [Azure Cosmos DB Utbildningsväg](https://azure.microsoft.com/documentation/learning-paths/documentdb/) att komma igång.</span><span class="sxs-lookup"><span data-stu-id="6df91-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) to get started.</span></span> 

<span data-ttu-id="6df91-108">Obs: Mongo DB API-baserad Cosmos DB samlingar stöds inte för närvarande.</span><span class="sxs-lookup"><span data-stu-id="6df91-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="6df91-109">Grunderna i Cosmos DB som ett mål för utdata</span><span class="sxs-lookup"><span data-stu-id="6df91-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="6df91-110">Azure DB som Cosmos-utdata i Stream Analytics kan skriva strömmen bearbetning resultatet som JSON-utdata till Cosmos-DB-samling(ar).</span><span class="sxs-lookup"><span data-stu-id="6df91-110">The Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="6df91-111">Stream Analytics skapar inte samlingar i databasen, i stället att du behöver skapa dem på en gång.</span><span class="sxs-lookup"><span data-stu-id="6df91-111">Stream Analytics does not create collections in your database, instead requiring you to create them upfront.</span></span> <span data-ttu-id="6df91-112">Detta är så att fakturering kostnaderna för Cosmos DB samlingar är transparent och så att du kan finjustera prestanda, konsekvens och kapacitet för samlingar direkt med den [Cosmos DB-API: er](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="6df91-112">This is so that the billing costs of Cosmos DB collections are transparent to you, and so that you can tune the performance, consistency and capacity of your collections directly using the [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="6df91-113">Vi rekommenderar en Cosmos-DB-databas per direktuppspelningsjobbet till logiskt separata samlingar för ett direktuppspelningsjobb.</span><span class="sxs-lookup"><span data-stu-id="6df91-113">We recommend using one Cosmos DB Database per streaming job to logically separate your collections for a streaming job.</span></span>

<span data-ttu-id="6df91-114">Cosmos DB samling alternativen beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="6df91-114">Some of the Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="6df91-115">Finjustera konsekvens, tillgänglighet och svarstid</span><span class="sxs-lookup"><span data-stu-id="6df91-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="6df91-116">Om du vill matcha ditt programkrav kan Cosmos DB du finjustera databasen och samlingar och kompromissa mellan konsekvens, tillgänglighet och svarstid.</span><span class="sxs-lookup"><span data-stu-id="6df91-116">To match your application requirements, Cosmos DB allows you to fine tune the database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="6df91-117">Beroende på vilka nivåer av läskonsekvens scenariot behov mot läsa och skriva latens, du kan välja en konsekvensnivå på ditt konto.</span><span class="sxs-lookup"><span data-stu-id="6df91-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="6df91-118">Som standard kan Cosmos DB också synkron indexering på varje CRUD-åtgärd i din samling.</span><span class="sxs-lookup"><span data-stu-id="6df91-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation to your collection.</span></span> <span data-ttu-id="6df91-119">Det här är ett annat bra alternativ för att ange skrivning/läsning prestanda i Cosmos-databasen.</span><span class="sxs-lookup"><span data-stu-id="6df91-119">This is another useful option to control the write/read performance in Cosmos DB.</span></span> <span data-ttu-id="6df91-120">Ytterligare information om det här avsnittet finns det [ändra din databas och fråga konsekvensnivåer](../documentdb/documentdb-consistency-levels.md) artikel.</span><span class="sxs-lookup"><span data-stu-id="6df91-120">For further information on this topic, review the [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="6df91-121">Upserts från Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6df91-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="6df91-122">Stream Analytics-integrering med Cosmos DB kan du infoga eller uppdatera poster i din Cosmos-DB-samling baserat på en viss dokument-ID-kolumn.</span><span class="sxs-lookup"><span data-stu-id="6df91-122">Stream Analytics integration with Cosmos DB allows you to insert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="6df91-123">Detta kallas även för som en *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="6df91-123">This is also referred to as an *Upsert*.</span></span>

<span data-ttu-id="6df91-124">Stream Analytics använder optimistisk Upsert lösning där uppdateringar görs endast när insert misslyckas på grund av ett dokument-ID-konflikter.</span><span class="sxs-lookup"><span data-stu-id="6df91-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due to a Document ID conflict.</span></span> <span data-ttu-id="6df91-125">Den här uppdateringen utförs av Stream Analytics som en korrigering, så gör deluppdateringar till dokument, t.ex. lägga till nya egenskaper eller ersätta en befintlig egenskap utförs inkrementellt.</span><span class="sxs-lookup"><span data-stu-id="6df91-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates to the document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="6df91-126">Observera att ändringar av värdena i matrisen egenskaper i JSON-dokument resultatet i hela matrisen komma över, d.v.s. matrisen samman inte.</span><span class="sxs-lookup"><span data-stu-id="6df91-126">Note that changes in the values of array properties in your JSON document result in the entire array getting overwritten, i.e. the array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="6df91-127">Datapartitionering i Cosmos-DB</span><span class="sxs-lookup"><span data-stu-id="6df91-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="6df91-128">Cosmos DB [partitionerade samlingar](../cosmos-db/partition-data.md) är den rekommenderade metoden för partitionering av dina data.</span><span class="sxs-lookup"><span data-stu-id="6df91-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are the recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="6df91-129">För enkel Cosmos DB samlingar kan Stream Analytics du fortfarande partitionera data baserat på både den frågemönster och prestanda för programmet.</span><span class="sxs-lookup"><span data-stu-id="6df91-129">For single Cosmos DB collections, Stream Analytics still allows you to partition your data based on both the query patterns and performance needs of your application.</span></span> <span data-ttu-id="6df91-130">Varje samling kan innehålla upp till 10GB data (max) och det finns för närvarande inget sätt att skala upp (eller dataspill) en samling.</span><span class="sxs-lookup"><span data-stu-id="6df91-130">Each collection may contain up to 10GB of data (maximum) and currently there is no way to scale up (or overflow) a collection.</span></span> <span data-ttu-id="6df91-131">För att skala ut Stream Analytics gör att du kan skriva till flera samlingar med ett givet prefix (se användningsinformation nedan).</span><span class="sxs-lookup"><span data-stu-id="6df91-131">For scaling out, Stream Analytics allows you to write to multiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="6df91-132">Stream Analytics använder det konsekvent [hash-Partition matcharen](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategi baserat på användaren som PartitionKey kolumnen partitionera dess utdata-poster.</span><span class="sxs-lookup"><span data-stu-id="6df91-132">Stream Analytics uses the consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on the user provided PartitionKey column to partition its output records.</span></span> <span data-ttu-id="6df91-133">Antal samlingar med det angivna prefixet vid strömning jobbets starttid används som utdata antalet partitioner, som jobbet skriver till parallellt (Cosmos DB samlingar = utdata partitioner).</span><span class="sxs-lookup"><span data-stu-id="6df91-133">The number of collections with the given prefix at the streaming job’s start time is used as the output partition count, to which the job writes to in parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="6df91-134">För en enda samling med lazy indexering detta endast infogar, om 0,4 som kan förväntas MB/s genomströmning för skrivning.</span><span class="sxs-lookup"><span data-stu-id="6df91-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="6df91-135">Med hjälp av flera samlingar kan du uppnå högre genomflöde och bättre kapacitet.</span><span class="sxs-lookup"><span data-stu-id="6df91-135">Using multiple collections can allow you to achieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="6df91-136">Om du vill öka antalet partitioner i framtiden, kan du behöva stoppa jobbet, där data från din befintliga samlingar till nya samlingar och starta sedan om Stream Analytics-jobbet.</span><span class="sxs-lookup"><span data-stu-id="6df91-136">If you intend to increase the partition count in the future, you may need to stop your job, repartition the data from your existing collections into new collections and then restart the Stream Analytics job.</span></span> <span data-ttu-id="6df91-137">Mer information om att använda PartitionResolver och nytt partitionering tillsammans med exempelkod inkluderas i en e-post.</span><span class="sxs-lookup"><span data-stu-id="6df91-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="6df91-138">Artikeln [partitionering och skalning i Cosmos DB](../documentdb/documentdb-partition-data.md) innehåller även information om detta.</span><span class="sxs-lookup"><span data-stu-id="6df91-138">The article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="6df91-139">Cosmos DB inställningar för JSON-utdata</span><span class="sxs-lookup"><span data-stu-id="6df91-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="6df91-140">Skapa Cosmos DB som utdata i Stream Analytics genererar en fråga om information som visas nedan.</span><span class="sxs-lookup"><span data-stu-id="6df91-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="6df91-141">Det här avsnittet innehåller en förklaring av egenskaper för definition.</span><span class="sxs-lookup"><span data-stu-id="6df91-141">This section provides an explanation of the properties definition.</span></span>

<span data-ttu-id="6df91-142">Partitionerad samling</span><span class="sxs-lookup"><span data-stu-id="6df91-142">Partitioned Collection</span></span> | <span data-ttu-id="6df91-143">Flera ”enskild Partition” samlingar</span><span class="sxs-lookup"><span data-stu-id="6df91-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb stream analytics utdata skärmen](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb stream analytics utdata skärmen](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="6df91-146">Den **flera ”enkel” partitionssamlingar** scenariot kräver en partitionsnyckel och är en konfiguration som stöds.</span><span class="sxs-lookup"><span data-stu-id="6df91-146">The **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="6df91-147">**Utdata Alias** – ett alias att referera den här utdata i frågan ASA</span><span class="sxs-lookup"><span data-stu-id="6df91-147">**Output Alias** – An alias to refer this output in your ASA query</span></span>  
* <span data-ttu-id="6df91-148">**Kontonamn** – namn eller endpoint-URI för Cosmos-DB-konto.</span><span class="sxs-lookup"><span data-stu-id="6df91-148">**Account Name** – The name or endpoint URI of the Cosmos DB account.</span></span>  
* <span data-ttu-id="6df91-149">**Kontot nyckeln** – den delade åtkomstnyckeln för kontot Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6df91-149">**Account Key** – The shared access key for the Cosmos DB account.</span></span>  
* <span data-ttu-id="6df91-150">**Databasen** – det Cosmos-DB-databasnamn.</span><span class="sxs-lookup"><span data-stu-id="6df91-150">**Database** – The Cosmos DB database name.</span></span>  
* <span data-ttu-id="6df91-151">**Samlingsnamnsmönstret** – namnet på samlingen eller deras mönster för samlingar som ska användas.</span><span class="sxs-lookup"><span data-stu-id="6df91-151">**Collection Name Pattern** – The collection name or their pattern for the collections to be used.</span></span> <span data-ttu-id="6df91-152">Samlingsnamnsformatet kan konstrueras med valfritt {partition}-token, där partitionerna börjar från 0.</span><span class="sxs-lookup"><span data-stu-id="6df91-152">The collection name format can be constructed using the optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="6df91-153">Följande är exempel giltiga indata:</span><span class="sxs-lookup"><span data-stu-id="6df91-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="6df91-154">1\) MyCollection – en samling med namnet ”MyCollection” måste finnas.</span><span class="sxs-lookup"><span data-stu-id="6df91-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="6df91-155">2\) MyCollection {partition} – dessa samlingar måste finnas – ”MyCollection0”, ”MyCollection1”, ”MyCollection2” och så vidare.</span><span class="sxs-lookup"><span data-stu-id="6df91-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="6df91-156">**Partitionera nyckeln** – det är valfritt.</span><span class="sxs-lookup"><span data-stu-id="6df91-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="6df91-157">Det här krävs bara om du använder en {partition}-token i din samlingsnamnsmönstret.</span><span class="sxs-lookup"><span data-stu-id="6df91-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="6df91-158">Namnet på fältet i utdatahändelserna används för att specificera nyckeln för att partionera utdata över samlingarna.</span><span class="sxs-lookup"><span data-stu-id="6df91-158">The name of the field in output events used to specify the key for partitioning output across collections.</span></span> <span data-ttu-id="6df91-159">Enda samling utdata för en godtycklig utdatakolumnen kan vara används t.ex. PartitionId.</span><span class="sxs-lookup"><span data-stu-id="6df91-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="6df91-160">**Dokumentera ID** – det är valfritt.</span><span class="sxs-lookup"><span data-stu-id="6df91-160">**Document ID** – Optional.</span></span> <span data-ttu-id="6df91-161">Namnet på fältet i utdatahändelserna används för att ange den primära nyckeln operations baseras på vilka insert eller update.</span><span class="sxs-lookup"><span data-stu-id="6df91-161">The name of the field in output events used to specify the primary key on which insert or update operations are based.</span></span>  
