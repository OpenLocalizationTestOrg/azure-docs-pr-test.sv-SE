---
title: "Felsökning av Disk Encryption aaaAzure | Microsoft Docs"
description: "Den här artikeln innehåller felsökningstips för Microsoft Azure Disk Encryption för Windows och Linux virtuella IaaS-datorer."
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 2ecb8df1fb869e3bf8f3be4be4494e6485e75695
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="3d86f-103">Felsökningsguide för Azure Disk Encryption</span><span class="sxs-lookup"><span data-stu-id="3d86f-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="3d86f-104">Den här guiden är för arbetet för IT-proffs, information säkerhetsanalytiker och problem som rör molnet administratörer vars organisationer som använder Azure disk encryption och måste vägledning tootroubleshoot-diskkryptering.</span><span class="sxs-lookup"><span data-stu-id="3d86f-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance tootroubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="3d86f-105">Felsökning av Linux OS-diskkryptering</span><span class="sxs-lookup"><span data-stu-id="3d86f-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="3d86f-106">Linux OS-diskkryptering måste demontera hello OS enheten tidigare toorunning det via hello fullständig krypteringsprocessen.</span><span class="sxs-lookup"><span data-stu-id="3d86f-106">Linux OS disk encryption must unmount hello OS drive prior toorunning it through hello full disk encryption process.</span></span>   <span data-ttu-id="3d86f-107">Om inte ett felmeddelande för ”kunde inte toounmount efter...”</span><span class="sxs-lookup"><span data-stu-id="3d86f-107">If it cannot, an error message of "failed toounmount after…"</span></span> <span data-ttu-id="3d86f-108">Felmeddelandet är sannolikt toooccur.</span><span class="sxs-lookup"><span data-stu-id="3d86f-108">error message is likely toooccur.</span></span>

<span data-ttu-id="3d86f-109">Detta är troligen när OS-diskkryptering görs på en målmiljön VM som har ändrats eller har ändrats från dess stöds lager galleriet avbildning.</span><span class="sxs-lookup"><span data-stu-id="3d86f-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="3d86f-110">Exempel på avvikelser från hello stöds avbildningen, som kan störa hello tillägget möjlighet toounmount hello OS enhet:</span><span class="sxs-lookup"><span data-stu-id="3d86f-110">Examples of deviations from hello supported image, which can interfere with hello extension’s ability toounmount hello OS drive include:</span></span>
- <span data-ttu-id="3d86f-111">Anpassade avbildningar som matchar inte längre ett filsystem som stöds och/eller partitioneringsschema.</span><span class="sxs-lookup"><span data-stu-id="3d86f-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="3d86f-112">Anpassade avbildningar med program, till exempel antivirusprogram, Docker, SAP, MongoDB eller Apache Cassandra körs i hello OS tidigare tooencryption.</span><span class="sxs-lookup"><span data-stu-id="3d86f-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in hello OS prior tooencryption.</span></span>  <span data-ttu-id="3d86f-113">Dessa program är svåra tooterminate och när de behåller öppna handtag toohello OS enhet hello enheten kan inte omonterade orsakar fel.</span><span class="sxs-lookup"><span data-stu-id="3d86f-113">These applications are difficult tooterminate, and when they retain open file handles toohello OS drive, hello drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="3d86f-114">Anpassade skript som körs i Stäng tid närhet toohello kryptering steg kan påverka och orsaka det här felet.</span><span class="sxs-lookup"><span data-stu-id="3d86f-114">Custom scripts that run in close time proximity toohello encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="3d86f-115">Detta kan inträffa när en Resource Manager-mall definierar flera tillägg tooexecute samtidigt, eller när tillägget för anpassat skript eller annan åtgärd körs samtidigt toodisk kryptering.</span><span class="sxs-lookup"><span data-stu-id="3d86f-115">This can happen when a Resource Manager template defines multiple extensions tooexecute simultaneously, or when a custom script extension or other action is run simultaneously toodisk encryption.</span></span>   <span data-ttu-id="3d86f-116">Serialisering och isolera sådana åtgärder kan lösa problemet med hello.</span><span class="sxs-lookup"><span data-stu-id="3d86f-116">Serializing and isolating such steps may resolve hello issue.</span></span>
- <span data-ttu-id="3d86f-117">När SELinux inte har inaktiverat tidigare tooenabling kryptering, demontera hello steget misslyckas.</span><span class="sxs-lookup"><span data-stu-id="3d86f-117">When SELinux has not been disabled prior tooenabling encryption, hello unmount step fails.</span></span>  <span data-ttu-id="3d86f-118">SELinux kan aktiveras igen efter kryptering har slutförts.</span><span class="sxs-lookup"><span data-stu-id="3d86f-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="3d86f-119">När hello OS-disken använder ett LVM schema (även om det finns stöd för diskar begränsad LVM data LVM OS-disken är inte)</span><span class="sxs-lookup"><span data-stu-id="3d86f-119">When hello OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="3d86f-120">När minimikraven på minne är inte uppfyllda (7GB rekommenderas för OS-diskkryptering)</span><span class="sxs-lookup"><span data-stu-id="3d86f-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="3d86f-121">När dataenheter har rekursivt monteras under /mnt/ katalog eller varandra (till exempel /mnt/data1, /mnt/data2, /data3 + /data3/data4 osv.)</span><span class="sxs-lookup"><span data-stu-id="3d86f-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="3d86f-122">När andra Azure Disk Encryption [krav](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) för Linux är inte uppfyllda</span><span class="sxs-lookup"><span data-stu-id="3d86f-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-tooencrypt"></a><span data-ttu-id="3d86f-123">Det går inte tooencrypt</span><span class="sxs-lookup"><span data-stu-id="3d86f-123">Unable tooencrypt</span></span>

<span data-ttu-id="3d86f-124">I vissa fall visas hello Linux-diskkryptering toobe fastnat på ”OS diskkryptering igång” och SSH är inaktiverat.</span><span class="sxs-lookup"><span data-stu-id="3d86f-124">In some cases, hello Linux disk encryption appears toobe stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="3d86f-125">Den här processen kan ta mellan toocomplete 3-16 timmar på en bild för lager galleriet.</span><span class="sxs-lookup"><span data-stu-id="3d86f-125">This process can take between 3-16 hours toocomplete on a stock gallery image.</span></span>  <span data-ttu-id="3d86f-126">Om flera TB datadiskar läggs kan hello ta dagar.</span><span class="sxs-lookup"><span data-stu-id="3d86f-126">If multi-TB size data disks are added, hello process may take days.</span></span> <span data-ttu-id="3d86f-127">hello Linux OS-disk kryptering sekvens demonterar hello OS enhet tillfälligt och utför block för block kryptering av hello hela OS-disk innan ommontering i det kryptera tillståndet.</span><span class="sxs-lookup"><span data-stu-id="3d86f-127">hello Linux OS disk encryption sequence unmounts hello OS drive temporarily, and performs block by block encryption of hello entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="3d86f-128">Till skillnad från Azure Disk Encryption i Windows tillåter Linux-diskkryptering inte samtidig användning av hello VM medan hello kryptering pågår.</span><span class="sxs-lookup"><span data-stu-id="3d86f-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of hello VM while hello encryption is in progress.</span></span>  <span data-ttu-id="3d86f-129">hello prestandaegenskaper för hello VM, bland annat hello storlek hello disken och om hello lagringskonto backas upp av standard- eller premium (SSD) lagring kan avsevärt påverka hello tid som krävs för toocomplete kryptering.</span><span class="sxs-lookup"><span data-stu-id="3d86f-129">hello performance characteristics of hello VM, including hello size of hello disk and whether hello storage account is backed by standard or premium (SSD) storage, can greatly influence hello time required toocomplete encryption.</span></span>

<span data-ttu-id="3d86f-130">status för toocheck hello ProgressMessage fält som returneras från hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) kommando kan användas.</span><span class="sxs-lookup"><span data-stu-id="3d86f-130">toocheck status, hello ProgressMessage field returned from hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="3d86f-131">Medan hello OS enheten krypteras hello VM försätts i tillståndet underhåll och SSH är också inaktiverade tooprevent avbrott toohello pågående processer.</span><span class="sxs-lookup"><span data-stu-id="3d86f-131">While hello OS drive is being encrypted, hello VM enters a servicing state, and SSH is also disabled tooprevent any disruption toohello ongoing process.</span></span>  <span data-ttu-id="3d86f-132">EncryptionInProgress rapporteras för hello merparten av hello tid medan kryptering pågår, följt av flera timmar senare med ett VMRestartPending-meddelande om att toorestart hello VM.</span><span class="sxs-lookup"><span data-stu-id="3d86f-132">EncryptionInProgress will be reported for hello majority of hello time while encryption is in progress, followed several hours later with a VMRestartPending message prompting toorestart hello VM.</span></span>  <span data-ttu-id="3d86f-133">Exempel:</span><span class="sxs-lookup"><span data-stu-id="3d86f-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot hello VM
```

<span data-ttu-id="3d86f-134">Du uppmanas när tooreboot hello VM och efter omstart hello VM, och ger 2 – 3 minuter för hello omstart och sista stegen toobe utförs på hello mål, hello statusmeddelande visar att kryptering slutligen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="3d86f-134">Once prompted tooreboot hello VM, and after restarting hello VM, and giving 2-3 minutes for hello reboot and for final steps toobe performed on hello target, hello status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="3d86f-135">När det här meddelandet är tillgänglig, hello krypterade OS-enheten är förväntade toobe redo för användning och hello VM toobe kan användas igen.</span><span class="sxs-lookup"><span data-stu-id="3d86f-135">Once this message is available, hello encrypted OS drive is expected toobe ready for use and for hello VM toobe usable again.</span></span>

<span data-ttu-id="3d86f-136">I fall där den här sekvensen inte påträffades, eller om boot information, pågående meddelande eller andra felindikatorer rapportera att OS-kryptering misslyckades hello mitten av den här processen (till exempel om du ser hello ”misslyckades toounmount” fel som beskrivs i den här guiden) Det rekommenderas toorestore hello VM tillbaka toohello ögonblicksbild eller säkerhetskopior som gjorts omedelbart före tooencryption.</span><span class="sxs-lookup"><span data-stu-id="3d86f-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in hello middle of this process (for example if you are seeing hello "failed toounmount" error described in this guide), it is recommended toorestore hello VM back toohello snapshot or backup taken immediately prior tooencryption.</span></span>  <span data-ttu-id="3d86f-137">Tidigare toohello nästa försök, är det föreslagna toore-utvärdera hello VM hello egenskaper och se till att alla krav är uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="3d86f-137">Prior toohello next attempt, it is suggested toore-evaluate hello characteristics of hello VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="3d86f-138">Felsöka Azure Disk Encryption bakom en brandvägg</span><span class="sxs-lookup"><span data-stu-id="3d86f-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="3d86f-139">När anslutningen begränsas av en brandvägg, proxy krav eller grupp (NSG) för nätverkssäkerhet, hello möjligheten för hello tillägget tooperform behövs uppgifter kan avbrytas.</span><span class="sxs-lookup"><span data-stu-id="3d86f-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, hello ability of hello extension tooperform needed tasks can be disrupted.</span></span>   <span data-ttu-id="3d86f-140">Detta kan resultera i statusmeddelanden, till exempel ”tillståndets status är inte tillgänglig på hello VM” och i förväntade scenarier misslyckas toofinish.</span><span class="sxs-lookup"><span data-stu-id="3d86f-140">This can result in status messages such as "Extension status not available on hello VM" and in expected scenarios failing toofinish.</span></span>  <span data-ttu-id="3d86f-141">hello avsnitten som följer har några vanliga brandväggsproblem som du kan undersöka.</span><span class="sxs-lookup"><span data-stu-id="3d86f-141">hello sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="3d86f-142">Nätverkssäkerhetsgrupper</span><span class="sxs-lookup"><span data-stu-id="3d86f-142">Network security groups</span></span>
<span data-ttu-id="3d86f-143">Nätverket grupp säkerhetsinställningar tillämpas fortfarande måste tillåta hello toomeet hello dokumenterade nätverket slutpunktskonfiguration [krav](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) för diskkryptering.</span><span class="sxs-lookup"><span data-stu-id="3d86f-143">Any network security group settings applied must still allow hello endpoint toomeet hello documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="3d86f-144">Azure Keyvault bakom brandväggen</span><span class="sxs-lookup"><span data-stu-id="3d86f-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="3d86f-145">hello VM måste vara kan tooaccess nyckelvalvet.</span><span class="sxs-lookup"><span data-stu-id="3d86f-145">hello VM must be able tooaccess key vault.</span></span> <span data-ttu-id="3d86f-146">Se tooguidance på åtkomst tookey fel finns bakom en brandvägg som underhålls av hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span><span class="sxs-lookup"><span data-stu-id="3d86f-146">Refer tooguidance on access tookey fault from behind a firewall that is maintained by hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="3d86f-147">Linux-paketet management bakom brandväggen</span><span class="sxs-lookup"><span data-stu-id="3d86f-147">Linux package management behind firewall</span></span>
<span data-ttu-id="3d86f-148">Azure Disk Encryption för Linux beroende hello mål distribution paketet management system tooinstall behövs nödvändiga komponenter tidigare tooenabling kryptering vid körning.</span><span class="sxs-lookup"><span data-stu-id="3d86f-148">At run time, Azure Disk Encryption for Linux relies on hello target distribution’s package management system tooinstall needed prerequisite components prior tooenabling encryption.</span></span>  <span data-ttu-id="3d86f-149">Om brandväggsinställningar förhindra hello VM kan toodownload och installera komponenterna, förväntas efterföljande försök.</span><span class="sxs-lookup"><span data-stu-id="3d86f-149">If firewall settings prevent hello VM from being able toodownload and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="3d86f-150">hello steg tooconfigure detta kan variera efter distributionen.</span><span class="sxs-lookup"><span data-stu-id="3d86f-150">hello steps tooconfigure this may vary by distribution.</span></span>  <span data-ttu-id="3d86f-151">På Red Hat säkerställer att prenumerationen manager och yum har ställts in korrekt det är viktigt att när en proxyserver krävs.</span><span class="sxs-lookup"><span data-stu-id="3d86f-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="3d86f-152">Se [detta](https://access.redhat.com/solutions/189533) Red Hat support-artikeln om det här avsnittet.</span><span class="sxs-lookup"><span data-stu-id="3d86f-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="3d86f-153">Felsöka Windows Server 2016 Server Core</span><span class="sxs-lookup"><span data-stu-id="3d86f-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="3d86f-154">Hej bdehdcfg komponenten är inte tillgängligt som standard på Windows Server 2016 Server Core.</span><span class="sxs-lookup"><span data-stu-id="3d86f-154">On Windows Server 2016 Server Core, hello bdehdcfg component is not available by default.</span></span> <span data-ttu-id="3d86f-155">Den här komponenten krävs av Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="3d86f-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="3d86f-156">tooworkaround problemet genom att kopiera hello följande 4 filer från en Windows Server 2016 Data Center VM toohello c:\windows\system32 mapp för hello Server Core bild:</span><span class="sxs-lookup"><span data-stu-id="3d86f-156">tooworkaround this issue, copy hello following 4 files from a Windows Server 2016 Data Center VM toohello c:\windows\system32 folder of hello Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="3d86f-157">Kör följande kommando hello:</span><span class="sxs-lookup"><span data-stu-id="3d86f-157">Then, run hello following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="3d86f-158">Detta skapar en partition 550MB och sedan efter en omstart, du kan använda Diskpart toocheck hello volymer och fortsätta.</span><span class="sxs-lookup"><span data-stu-id="3d86f-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart toocheck hello volumes, and proceed.</span></span>  

<span data-ttu-id="3d86f-159">Exempel:</span><span class="sxs-lookup"><span data-stu-id="3d86f-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="3d86f-160">Se även</span><span class="sxs-lookup"><span data-stu-id="3d86f-160">See also</span></span>
<span data-ttu-id="3d86f-161">I det här dokumentet du lära dig mer om några vanliga problem i Azure disk encryption och hur tootroubleshoot.</span><span class="sxs-lookup"><span data-stu-id="3d86f-161">In this document, you learned more about some common issues in Azure disk encryption, and how tootroubleshoot.</span></span> <span data-ttu-id="3d86f-162">Mer information om den här tjänsten och dess funktioner:</span><span class="sxs-lookup"><span data-stu-id="3d86f-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="3d86f-163">Tillämpa diskkryptering i Azure Security Center</span><span class="sxs-lookup"><span data-stu-id="3d86f-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="3d86f-164">Kryptera en virtuell Azure-dator</span><span class="sxs-lookup"><span data-stu-id="3d86f-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- [<span data-ttu-id="3d86f-165">Azure Data kryptering i vila</span><span class="sxs-lookup"><span data-stu-id="3d86f-165">Azure Data Encryption-at-Rest</span></span>](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)
