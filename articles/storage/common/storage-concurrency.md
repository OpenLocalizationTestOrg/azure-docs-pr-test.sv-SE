---
title: Hantera samtidighet i Microsoft Azure Storage
description: "Så här hanterar du samtidighet för Blob, kön, tabell och filen tjänster"
services: storage
documentationcenter: 
author: jasontang501
manager: tadb
editor: tysonn
ms.assetid: cc6429c4-23ee-46e3-b22d-50dd68bd4680
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/11/2017
ms.author: jasontang501
ms.openlocfilehash: 937cca66a0af0674b868e6a87681adbea330e91c
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/29/2017
---
# <a name="managing-concurrency-in-microsoft-azure-storage"></a><span data-ttu-id="6f8f1-103">Hantera samtidighet i Microsoft Azure Storage</span><span class="sxs-lookup"><span data-stu-id="6f8f1-103">Managing Concurrency in Microsoft Azure Storage</span></span>
## <a name="overview"></a><span data-ttu-id="6f8f1-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="6f8f1-104">Overview</span></span>
<span data-ttu-id="6f8f1-105">Moderna Internet-baserade program har vanligtvis flera användare visa och uppdatera data samtidigt.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-105">Modern Internet based applications usually have multiple users viewing and updating data simultaneously.</span></span> <span data-ttu-id="6f8f1-106">Detta kräver programutvecklare att tänka igenom hur du skapar en förutsägbar användarupplevelse till sina slutanvändare, särskilt för scenarier där flera användare kan uppdatera samma data.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-106">This requires application developers to think carefully about how to provide a predictable experience to their end users, particularly for scenarios where multiple users can update the same data.</span></span> <span data-ttu-id="6f8f1-107">Det finns tre huvudsakliga databassamtidighet strategier som utvecklare vanligtvis tänka på:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-107">There are three main data concurrency strategies that developers typically consider:</span></span>  

1. <span data-ttu-id="6f8f1-108">Optimistisk samtidighet – ett program som utför en uppdatering som en del av dess uppdatering verifierar om data har ändrats sedan programmet senast läsa data.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-108">Optimistic concurrency – An application performing an update will as part of its update verify if the data has changed since the application last read that data.</span></span> <span data-ttu-id="6f8f1-109">Till exempel om två användare som visar en wiki-sida gör en uppdatering på samma sida sedan wiki-plattformen måste se till att den andra uppdateringen inte skriver över den första uppdateringen – och att båda användarna förstår om uppdateringen lyckades eller inte.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-109">For example, if two users viewing a wiki page make an update to the same page then the wiki platform must ensure that the second update does not overwrite the first update – and that both users understand whether their update was successful or not.</span></span> <span data-ttu-id="6f8f1-110">Den här strategin används oftast i webbprogram.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-110">This strategy is most often used in web applications.</span></span>
2. <span data-ttu-id="6f8f1-111">Sämsta samtidighet – ett program behöver utföra en uppdatering tar ett lås på ett objekt som förhindrar att andra användare uppdaterar data förrän låset frigörs.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-111">Pessimistic concurrency – An application looking to perform an update will take a lock on an object preventing other users from updating the data until the lock is released.</span></span> <span data-ttu-id="6f8f1-112">Till exempel i över-/ underordnade data replikering scenario där endast master utför uppdateringar innehåller huvudservern vanligtvis ett exklusivt lås för en längre tidsperiod data för att se till att ingen annan kan uppdatera den.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-112">For example, in a master/slave data replication scenario where only the master will perform updates the master will typically hold an exclusive lock for an extended period of time on the data to ensure no one else can update it.</span></span>
3. <span data-ttu-id="6f8f1-113">Den senaste skrivaren wins – en metod som gör att alla uppdateringsåtgärder fortsätta utan att verifiera om något annat program har uppdaterats data eftersom programmet först läsa data.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-113">Last writer wins – An approach that allows any update operations to proceed without verifying if any other application has updated the data since the application first read the data.</span></span> <span data-ttu-id="6f8f1-114">Den här strategin (eller brist på en formell strategi) används vanligtvis när data är partitionerad så att det finns inga sannolikheten att flera användare får åtkomst till samma data.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-114">This strategy (or lack of a formal strategy) is usually used where data is partitioned in such a way that there is no likelihood that multiple users will access the same data.</span></span> <span data-ttu-id="6f8f1-115">Det kan också vara användbara där tillfällig dataströmmar bearbetas.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-115">It can also be useful where short-lived data streams are being processed.</span></span>  

<span data-ttu-id="6f8f1-116">Den här artikeln innehåller en översikt över hur Azure Storage-plattformen förenklar utvecklingen som har förstklassigt stöd för alla tre strategierna samtidighet.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-116">This article provides an overview of how the Azure Storage platform simplifies development by providing first class support for all three of these concurrency strategies.</span></span>  

## <a name="azure-storage--simplifies-cloud-development"></a><span data-ttu-id="6f8f1-117">Azure-lagring – förenklar utvecklingen i molnet</span><span class="sxs-lookup"><span data-stu-id="6f8f1-117">Azure Storage – Simplifies Cloud Development</span></span>
<span data-ttu-id="6f8f1-118">Azure storage-tjänst stöder alla tre strategier, men det är olika i förmåga att har fullständigt stöd för bästa och sämsta samtidighet eftersom den har utformats för att omfatta en stark konsekvens-modell som säkerställer att när lagringstjänsten genomför en data-insert eller update-åtgärden alla ytterligare har åtkomst till till att data kommer att se den senaste uppdateringen.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-118">The Azure storage service supports all three strategies, although it is distinctive in its ability to provide full support for optimistic and pessimistic concurrency because it was designed to embrace a strong consistency model which guarantees that when the Storage service commits a data insert or update operation all further accesses to that data will see the latest update.</span></span> <span data-ttu-id="6f8f1-119">Storage-plattformar som använder en modell för slutliga konsekvensen har en fördröjning mellan när en skrivning utförs av en användare och uppdaterade data kan ses av andra användare således vilket komplicerar utvecklingen av klientprogram för att förhindra att inkonsekvenser påverkar slutanvändarna.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-119">Storage platforms that use an eventual consistency model have a lag between when a write is performed by one user and when the updated data can be seen by other users thus complicating development of client applications in order to prevent inconsistencies from affecting end users.</span></span>  

<span data-ttu-id="6f8f1-120">Förutom att välja en lämplig samtidighetsstrategi bör utvecklare också känna till hur en plattform för lagring isolerar ändringar – särskilt ändringar till samma objekt över transaktioner.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-120">In addition to selecting an appropriate concurrency strategy developers should also be aware of how a storage platform isolates changes – particularly changes to the same object across transactions.</span></span> <span data-ttu-id="6f8f1-121">Azure storage-tjänst använder ögonblicksbildisolering för att tillåta läsåtgärder ske samtidigt skrivåtgärder inom en partition.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-121">The Azure storage service uses snapshot isolation to allow read operations to happen concurrently with write operations within a single partition.</span></span> <span data-ttu-id="6f8f1-122">Till skillnad från andra isoleringsnivåer garanterar ögonblicksbildisolering att alla Läs finns en programkonsekvent ögonblicksbild av data medan uppdateringar sker – i princip av returnerar de sista allokerat värdena när en uppdatering transaktion bearbetas.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-122">Unlike other isolation levels, snapshot isolation guarantees that all reads see a consistent snapshot of the data even while updates are occurring – essentially by returning the last committed values while an update transaction is being processed.</span></span>  

## <a name="managing-concurrency-in-blob-storage"></a><span data-ttu-id="6f8f1-123">Hantera samtidighet i Blob storage</span><span class="sxs-lookup"><span data-stu-id="6f8f1-123">Managing Concurrency in Blob storage</span></span>
<span data-ttu-id="6f8f1-124">Du kan välja för att använda antingen bästa eller sämsta samtidighet modeller för att hantera åtkomst till blobbar och behållare i blob-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-124">You can opt to use either optimistic or pessimistic concurrency models to manage access to blobs and containers in the blob service.</span></span> <span data-ttu-id="6f8f1-125">Om du inte uttryckligen anger en strategi för senaste skrivningar wins är standardinställningen.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-125">If you do not explicitly specify a strategy last writes wins is the default.</span></span>  

### <a name="optimistic-concurrency-for-blobs-and-containers"></a><span data-ttu-id="6f8f1-126">Optimistisk samtidighet för blobbar och behållare</span><span class="sxs-lookup"><span data-stu-id="6f8f1-126">Optimistic concurrency for blobs and containers</span></span>
<span data-ttu-id="6f8f1-127">Lagringstjänsten tilldelar varje objekt som lagras en identifierare.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-127">The Storage service assigns an identifier to every object stored.</span></span> <span data-ttu-id="6f8f1-128">Den här identifieraren uppdateras varje gång en update-åtgärd utförs på ett objekt.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-128">This identifier is updated every time an update operation is performed on an object.</span></span> <span data-ttu-id="6f8f1-129">Identifieraren returneras till klienten som en del av en HTTP GET-svar med rubriken ETag (entitetstaggen) som har angetts i HTTP-protokollet.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-129">The identifier is returned to the client as part of an HTTP GET response using the ETag (entity tag) header that is defined within the HTTP protocol.</span></span> <span data-ttu-id="6f8f1-130">En användare som utför en uppdatering på sådant objekt kan skicka i den ursprungliga ETag tillsammans med ett villkorat huvud så att en uppdatering görs bara om ett visst villkor har uppfyllts – i det här fallet villkoret är en ”If-Match”-huvudet som Storage Service-t krävs o Kontrollera värdet för ETag som anges i begäran om uppdatering är samma som lagras i lagringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-130">A user performing an update on such an object can send in the original ETag along with a conditional header to ensure that an update will only occur if a certain condition has been met – in this case the condition is an "If-Match" header, which requires the Storage Service to ensure the value of the ETag specified in the update request is the same as that stored in the Storage Service.</span></span>  

<span data-ttu-id="6f8f1-131">Beskrivning av den här processen är följande:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-131">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="6f8f1-132">Hämta en blob från lagringstjänsten, svaret innehåller ett HTTP-huvud för ETag-värde som anger den aktuella versionen av objektet i lagringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-132">Retrieve a blob from the storage service, the response includes an HTTP ETag Header value that identifies the current version of the object in the storage service.</span></span>
2. <span data-ttu-id="6f8f1-133">När du uppdaterar blob inkluderar ETag-värde som du fick i steg 1 i den **If-Match** villkorat huvud i begäran som du skickar till tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-133">When you update the blob, include the ETag value you received in step 1 in the **If-Match** conditional header of the request you send to the service.</span></span>
3. <span data-ttu-id="6f8f1-134">Tjänsten jämför ETag-värde i förfrågan med blob aktuella ETag-värde.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-134">The service compares the ETag value in the request with the current ETag value of the blob.</span></span>
4. <span data-ttu-id="6f8f1-135">Om det aktuella ETag-värdet för blobben är en annan version än ETag i den **If-Match** villkorat huvud i begäran, tjänsten returnerar 412 fel till klienten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-135">If the current ETag value of the blob is a different version than the ETag in the **If-Match** conditional header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="6f8f1-136">Detta anger att klienten en annan process har uppdaterat blob eftersom klienten hämtades.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-136">This indicates to the client that another process has updated the blob since the client retrieved it.</span></span>
5. <span data-ttu-id="6f8f1-137">Om det aktuella ETag-värdet för blobben är samma version som ETag i den **If-Match** villkorat huvud i begäran, tjänsten utför den begärda åtgärden och uppdaterar det aktuella ETag-värdet för blob att visa att det har skapat en ny version.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-137">If the current ETag value of the blob is the same version as the ETag in the **If-Match** conditional header in the request, the service performs the requested operation and updates the current ETag value of the blob to show that it has created a new version.</span></span>  

<span data-ttu-id="6f8f1-138">Följande på C# utdrag (med Storage-klientbiblioteket 4.2.0) visar ett enkelt exempel på hur du skapar en **If-Match AccessCondition** baserat på ETag-värde som används i egenskaperna för en blob som tagits tidigare hämtade eller infogas.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-138">The following C# snippet (using the Client Storage Library 4.2.0) shows a simple example of how to construct an **If-Match AccessCondition** based on the ETag value that is accessed from the properties of a blob that was previously either retrieved or inserted.</span></span> <span data-ttu-id="6f8f1-139">Därefter använder den **AccessCondition** objekt när den uppdaterar blob: den **AccessCondition** objekt lägger till den **If-Match** sidhuvud på begäran.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-139">It then uses the **AccessCondition** object when it updates the blob: the **AccessCondition** object adds the **If-Match** header to the request.</span></span> <span data-ttu-id="6f8f1-140">Om en annan process har uppdaterat blob, returnerar blob-tjänsten ett statusmeddelande HTTP 412 (villkor misslyckades).</span><span class="sxs-lookup"><span data-stu-id="6f8f1-140">If another process has updated the blob, the blob service returns an HTTP 412 (Precondition Failed) status message.</span></span> <span data-ttu-id="6f8f1-141">Du kan ladda ned i det fullständiga exemplet: [hantera samtidighet med hjälp av Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="6f8f1-141">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>  

```csharp
// Retrieve the ETag from the newly created blob
// Etag is already populated as UploadText should cause a PUT Blob call
// to storage blob service which returns the etag in response.
string orignalETag = blockBlob.Properties.ETag;

// This code simulates an update by a third party.
string helloText = "Blob updated by a third party.";

// No etag, provided so orignal blob is overwritten (thus generating a new etag)
blockBlob.UploadText(helloText);
Console.WriteLine("Blob updated. Updated ETag = {0}",
blockBlob.Properties.ETag);

// Now try to update the blob using the orignal ETag provided when the blob was created
try
{
    Console.WriteLine("Trying to update blob using orignal etag to generate if-match access condition");
    blockBlob.UploadText(helloText,accessCondition:
    AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
    {
        Console.WriteLine("Precondition failure as expected. Blob's orignal etag no longer matches");
        // TODO: client can decide on how it wants to handle the 3rd party updated content.
    }
    else
        throw;
}  
```

<span data-ttu-id="6f8f1-142">Lagringstjänsten finns också stöd för ytterligare villkorlig huvuden som **If-Modified-Since**, **If-Unmodified-Since** och **If-None-Match** samt kombinationer av dessa.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-142">The Storage Service also includes support for additional conditional headers such as **If-Modified-Since**, **If-Unmodified-Since** and **If-None-Match** as well as combinations thereof.</span></span> <span data-ttu-id="6f8f1-143">Mer information finns i [ange villkorlig huvuden för Blob-tjänståtgärder](http://msdn.microsoft.com/library/azure/dd179371.aspx) på MSDN.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-143">For more information, see [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) on MSDN.</span></span>  

<span data-ttu-id="6f8f1-144">I följande tabell sammanfattas åtgärderna behållare som accepterar villkorlig huvuden som **If-Match** begäran och som returnerar ett ETag-värde i svaret.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-144">The following table summarizes the container operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>  

| <span data-ttu-id="6f8f1-145">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="6f8f1-145">Operation</span></span> | <span data-ttu-id="6f8f1-146">Returnerar behållare ETag-värde</span><span class="sxs-lookup"><span data-stu-id="6f8f1-146">Returns Container ETag value</span></span> | <span data-ttu-id="6f8f1-147">Accepterar villkorlig rubriker</span><span class="sxs-lookup"><span data-stu-id="6f8f1-147">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="6f8f1-148">Skapa en behållare</span><span class="sxs-lookup"><span data-stu-id="6f8f1-148">Create Container</span></span> |<span data-ttu-id="6f8f1-149">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-149">Yes</span></span> |<span data-ttu-id="6f8f1-150">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-150">No</span></span> |
| <span data-ttu-id="6f8f1-151">Hämta egenskaper för behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-151">Get Container Properties</span></span> |<span data-ttu-id="6f8f1-152">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-152">Yes</span></span> |<span data-ttu-id="6f8f1-153">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-153">No</span></span> |
| <span data-ttu-id="6f8f1-154">Hämta Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-154">Get Container Metadata</span></span> |<span data-ttu-id="6f8f1-155">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-155">Yes</span></span> |<span data-ttu-id="6f8f1-156">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-156">No</span></span> |
| <span data-ttu-id="6f8f1-157">Ange Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-157">Set Container Metadata</span></span> |<span data-ttu-id="6f8f1-158">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-158">Yes</span></span> |<span data-ttu-id="6f8f1-159">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-159">Yes</span></span> |
| <span data-ttu-id="6f8f1-160">Hämta behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="6f8f1-160">Get Container ACL</span></span> |<span data-ttu-id="6f8f1-161">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-161">Yes</span></span> |<span data-ttu-id="6f8f1-162">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-162">No</span></span> |
| <span data-ttu-id="6f8f1-163">Ange behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="6f8f1-163">Set Container ACL</span></span> |<span data-ttu-id="6f8f1-164">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-164">Yes</span></span> |<span data-ttu-id="6f8f1-165">Ja (*)</span><span class="sxs-lookup"><span data-stu-id="6f8f1-165">Yes (*)</span></span> |
| <span data-ttu-id="6f8f1-166">Ta bort behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-166">Delete Container</span></span> |<span data-ttu-id="6f8f1-167">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-167">No</span></span> |<span data-ttu-id="6f8f1-168">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-168">Yes</span></span> |
| <span data-ttu-id="6f8f1-169">Lånet behållare</span><span class="sxs-lookup"><span data-stu-id="6f8f1-169">Lease Container</span></span> |<span data-ttu-id="6f8f1-170">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-170">Yes</span></span> |<span data-ttu-id="6f8f1-171">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-171">Yes</span></span> |
| <span data-ttu-id="6f8f1-172">Lista över Blobbar</span><span class="sxs-lookup"><span data-stu-id="6f8f1-172">List Blobs</span></span> |<span data-ttu-id="6f8f1-173">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-173">No</span></span> |<span data-ttu-id="6f8f1-174">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-174">No</span></span> |

<span data-ttu-id="6f8f1-175">(*) Behörigheter som definieras av SetContainerACL cachelagras och uppdateringar för dessa behörigheter ta 30 sekunder att sprida under vilka uppdateringar inte är garanterat stämma överens.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-175">(*) The permissions defined by SetContainerACL are cached and updates to these permissions take 30 seconds to propagate during which period updates are not guaranteed to be consistent.</span></span>  

<span data-ttu-id="6f8f1-176">I följande tabell sammanfattas blob-åtgärder som accepterar villkorlig huvuden som **If-Match** begäran och som returnerar ett ETag-värde i svaret.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-176">The following table summarizes the blob operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>

| <span data-ttu-id="6f8f1-177">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="6f8f1-177">Operation</span></span> | <span data-ttu-id="6f8f1-178">Returnerar ETag-värde</span><span class="sxs-lookup"><span data-stu-id="6f8f1-178">Returns ETag value</span></span> | <span data-ttu-id="6f8f1-179">Accepterar villkorlig rubriker</span><span class="sxs-lookup"><span data-stu-id="6f8f1-179">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="6f8f1-180">Placera Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-180">Put Blob</span></span> |<span data-ttu-id="6f8f1-181">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-181">Yes</span></span> |<span data-ttu-id="6f8f1-182">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-182">Yes</span></span> |
| <span data-ttu-id="6f8f1-183">Hämta Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-183">Get Blob</span></span> |<span data-ttu-id="6f8f1-184">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-184">Yes</span></span> |<span data-ttu-id="6f8f1-185">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-185">Yes</span></span> |
| <span data-ttu-id="6f8f1-186">Hämta Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="6f8f1-186">Get Blob Properties</span></span> |<span data-ttu-id="6f8f1-187">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-187">Yes</span></span> |<span data-ttu-id="6f8f1-188">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-188">Yes</span></span> |
| <span data-ttu-id="6f8f1-189">Ange Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="6f8f1-189">Set Blob Properties</span></span> |<span data-ttu-id="6f8f1-190">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-190">Yes</span></span> |<span data-ttu-id="6f8f1-191">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-191">Yes</span></span> |
| <span data-ttu-id="6f8f1-192">Hämta Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="6f8f1-192">Get Blob Metadata</span></span> |<span data-ttu-id="6f8f1-193">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-193">Yes</span></span> |<span data-ttu-id="6f8f1-194">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-194">Yes</span></span> |
| <span data-ttu-id="6f8f1-195">Ange Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="6f8f1-195">Set Blob Metadata</span></span> |<span data-ttu-id="6f8f1-196">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-196">Yes</span></span> |<span data-ttu-id="6f8f1-197">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-197">Yes</span></span> |
| <span data-ttu-id="6f8f1-198">Lånet Blob (*)</span><span class="sxs-lookup"><span data-stu-id="6f8f1-198">Lease Blob (*)</span></span> |<span data-ttu-id="6f8f1-199">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-199">Yes</span></span> |<span data-ttu-id="6f8f1-200">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-200">Yes</span></span> |
| <span data-ttu-id="6f8f1-201">Snapshot-Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-201">Snapshot Blob</span></span> |<span data-ttu-id="6f8f1-202">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-202">Yes</span></span> |<span data-ttu-id="6f8f1-203">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-203">Yes</span></span> |
| <span data-ttu-id="6f8f1-204">Kopiera Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-204">Copy Blob</span></span> |<span data-ttu-id="6f8f1-205">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-205">Yes</span></span> |<span data-ttu-id="6f8f1-206">Ja (för käll- och blob)</span><span class="sxs-lookup"><span data-stu-id="6f8f1-206">Yes (for source and destination blob)</span></span> |
| <span data-ttu-id="6f8f1-207">Avbryt kopiera Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-207">Abort Copy Blob</span></span> |<span data-ttu-id="6f8f1-208">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-208">No</span></span> |<span data-ttu-id="6f8f1-209">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-209">No</span></span> |
| <span data-ttu-id="6f8f1-210">Ta bort blobben</span><span class="sxs-lookup"><span data-stu-id="6f8f1-210">Delete Blob</span></span> |<span data-ttu-id="6f8f1-211">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-211">No</span></span> |<span data-ttu-id="6f8f1-212">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-212">Yes</span></span> |
| <span data-ttu-id="6f8f1-213">Placera Block</span><span class="sxs-lookup"><span data-stu-id="6f8f1-213">Put Block</span></span> |<span data-ttu-id="6f8f1-214">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-214">No</span></span> |<span data-ttu-id="6f8f1-215">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-215">No</span></span> |
| <span data-ttu-id="6f8f1-216">Placera Blockeringslista</span><span class="sxs-lookup"><span data-stu-id="6f8f1-216">Put Block List</span></span> |<span data-ttu-id="6f8f1-217">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-217">Yes</span></span> |<span data-ttu-id="6f8f1-218">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-218">Yes</span></span> |
| <span data-ttu-id="6f8f1-219">Hämta listan över blockerade</span><span class="sxs-lookup"><span data-stu-id="6f8f1-219">Get Block List</span></span> |<span data-ttu-id="6f8f1-220">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-220">Yes</span></span> |<span data-ttu-id="6f8f1-221">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-221">No</span></span> |
| <span data-ttu-id="6f8f1-222">Placera sida</span><span class="sxs-lookup"><span data-stu-id="6f8f1-222">Put Page</span></span> |<span data-ttu-id="6f8f1-223">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-223">Yes</span></span> |<span data-ttu-id="6f8f1-224">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-224">Yes</span></span> |
| <span data-ttu-id="6f8f1-225">Get-sidintervall</span><span class="sxs-lookup"><span data-stu-id="6f8f1-225">Get Page Ranges</span></span> |<span data-ttu-id="6f8f1-226">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-226">Yes</span></span> |<span data-ttu-id="6f8f1-227">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-227">Yes</span></span> |

<span data-ttu-id="6f8f1-228">(*) Lånet Blob ändras inte ETag i en blob.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-228">(*) Lease Blob does not change the ETag on a blob.</span></span>  

### <a name="pessimistic-concurrency-for-blobs"></a><span data-ttu-id="6f8f1-229">Sämsta samtidighet för blobbar</span><span class="sxs-lookup"><span data-stu-id="6f8f1-229">Pessimistic concurrency for blobs</span></span>
<span data-ttu-id="6f8f1-230">Om du vill låsa en blob för exklusiv användning, kan du hämta en [lån](http://msdn.microsoft.com/library/azure/ee691972.aspx) på den.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-230">To lock a blob for exclusive use, you can acquire a [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) on it.</span></span> <span data-ttu-id="6f8f1-231">När du skaffa en leasing anger du hur länge du behöver lånet: Detta kan vara för mellan 15 och 60 sekunder eller oändliga som motsvarar ett exklusivt lås.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-231">When you acquire a lease, you specify for how long you need the lease: this can be for between 15 to 60 seconds or infinite, which amounts to an exclusive lock.</span></span> <span data-ttu-id="6f8f1-232">Du kan förnya ett begränsat lån att utöka det och du kan släppa ett lån när du är klar med den.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-232">You can renew a finite lease to extend it, and you can release any lease when you are finished with it.</span></span> <span data-ttu-id="6f8f1-233">Blob-tjänsten Frigör ändligt lån automatiskt när de upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-233">The blob service automatically releases finite leases when they expire.</span></span>  

<span data-ttu-id="6f8f1-234">Lån Aktivera synkronisering av olika strategier för att stödjas, inklusive exklusiv skrivning / delade skrivskyddade, exklusiv skrivning / exklusiv Läs- och delade skrivning / läsa samtidigt.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-234">Leases enable different synchronization strategies to be supported, including exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read.</span></span> <span data-ttu-id="6f8f1-235">Om ett lån finns tillämpar lagringstjänsten exklusiv skrivningar (put, ange och delete-åtgärder) men säkerställt ensamrätt för läsåtgärder kräver utvecklare som gör att alla klientprogram ska använda ett lån-ID och att endast en klient i taget har ett giltigt adresslån-ID.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-235">Where a lease exists the storage service enforces exclusive writes (put, set and delete operations) however ensuring exclusivity for read operations requires the developer to ensure that all client applications use a lease ID and that only one client at a time has a valid lease ID.</span></span> <span data-ttu-id="6f8f1-236">Läs-och skrivåtgärder som inte innehåller ett lån ID resultat i delade läsningar.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-236">Read operations that do not include a lease ID result in shared reads.</span></span>  

<span data-ttu-id="6f8f1-237">Följande C# utdrag visar ett exempel på att erhålla ett exklusiv adresslån i 30 sekunder på en blob, uppdaterar innehållet i blob och släppa lånet.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-237">The following C# snippet shows an example of acquiring an exclusive lease for 30 seconds on a blob, updating the content of the blob, and then releasing the lease.</span></span> <span data-ttu-id="6f8f1-238">Om det finns redan ett giltigt lån på blob när du försöker hämta ett nytt adresslån, returnerar blob-tjänsten ett resultat för ”HTTP (409) konflikt” status.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-238">If there is already a valid lease on the blob when you try to acquire a new lease, the blob service returns an "HTTP (409) Conflict" status result.</span></span> <span data-ttu-id="6f8f1-239">Följande kodavsnitt använder en **AccessCondition** objekt kapsla in lease-information när den gör en begäran om att uppdatera blob storage-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-239">The following snippet uses an **AccessCondition** object to encapsulate the lease information when it makes a request to update the blob in the storage service.</span></span>  <span data-ttu-id="6f8f1-240">Du kan ladda ned i det fullständiga exemplet: [hantera samtidighet med hjälp av Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="6f8f1-240">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
// Acquire lease for 15 seconds
string lease = blockBlob.AcquireLease(TimeSpan.FromSeconds(15), null);
Console.WriteLine("Blob lease acquired. Lease = {0}", lease);

// Update blob using lease. This operation will succeed
const string helloText = "Blob updated";
var accessCondition = AccessCondition.GenerateLeaseCondition(lease);
blockBlob.UploadText(helloText, accessCondition: accessCondition);
Console.WriteLine("Blob updated using an exclusive lease");

//Simulate third party update to blob without lease
try
{
    // Below operation will fail as no valid lease provided
    Console.WriteLine("Trying to update blob without valid lease");
    blockBlob.UploadText("Update without lease, will fail");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
        Console.WriteLine("Precondition failure as expected. Blob's lease does not match");
    else
        throw;
}  
```

<span data-ttu-id="6f8f1-241">Om du försöker en skrivåtgärd i en blob-lånade utan att skicka lease-ID, misslyckas denna begäran med ett 412 fel.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-241">If you attempt a write operation on a leased blob without passing the lease ID, the request fails with a 412 error.</span></span> <span data-ttu-id="6f8f1-242">Observera att om lånet går ut innan du anropar den **UploadText** metoden men du fortfarande skicka lease-ID, även misslyckas begäran med en **412** fel.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-242">Note that if the lease expires before calling the **UploadText** method but you still pass the lease ID, the request also fails with a **412** error.</span></span> <span data-ttu-id="6f8f1-243">Mer information om hur du hanterar lånetid för förfallodatum och lånetiden ID: N finns i [lån Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST-dokumentationen.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-243">For more information about managing lease expiry times and lease IDs, see the [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST documentation.</span></span>  

<span data-ttu-id="6f8f1-244">Följande blob-åtgärder kan använda lån för att hantera sämsta samtidighet:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-244">The following blob operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="6f8f1-245">Placera Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-245">Put Blob</span></span>
* <span data-ttu-id="6f8f1-246">Hämta Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-246">Get Blob</span></span>
* <span data-ttu-id="6f8f1-247">Hämta Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="6f8f1-247">Get Blob Properties</span></span>
* <span data-ttu-id="6f8f1-248">Ange Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="6f8f1-248">Set Blob Properties</span></span>
* <span data-ttu-id="6f8f1-249">Hämta Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="6f8f1-249">Get Blob Metadata</span></span>
* <span data-ttu-id="6f8f1-250">Ange Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="6f8f1-250">Set Blob Metadata</span></span>
* <span data-ttu-id="6f8f1-251">Ta bort blobben</span><span class="sxs-lookup"><span data-stu-id="6f8f1-251">Delete Blob</span></span>
* <span data-ttu-id="6f8f1-252">Placera Block</span><span class="sxs-lookup"><span data-stu-id="6f8f1-252">Put Block</span></span>
* <span data-ttu-id="6f8f1-253">Placera Blockeringslista</span><span class="sxs-lookup"><span data-stu-id="6f8f1-253">Put Block List</span></span>
* <span data-ttu-id="6f8f1-254">Hämta listan över blockerade</span><span class="sxs-lookup"><span data-stu-id="6f8f1-254">Get Block List</span></span>
* <span data-ttu-id="6f8f1-255">Placera sida</span><span class="sxs-lookup"><span data-stu-id="6f8f1-255">Put Page</span></span>
* <span data-ttu-id="6f8f1-256">Get-sidintervall</span><span class="sxs-lookup"><span data-stu-id="6f8f1-256">Get Page Ranges</span></span>
* <span data-ttu-id="6f8f1-257">Ögonblicksbild Blob - lån-ID: T är valfri om ett lån finns</span><span class="sxs-lookup"><span data-stu-id="6f8f1-257">Snapshot Blob - lease ID optional if a lease exists</span></span>
* <span data-ttu-id="6f8f1-258">Kopiera Blob - lån ID krävs om det finns ett lån på mål-blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-258">Copy Blob - lease ID required if a lease exists on the destination blob</span></span>
* <span data-ttu-id="6f8f1-259">Avbryt kopiera Blob - lån ID krävs om det finns en oändlig lån på mål-blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-259">Abort Copy Blob - lease ID required if an infinite lease exists on the destination blob</span></span>
* <span data-ttu-id="6f8f1-260">Lånet Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-260">Lease Blob</span></span>  

### <a name="pessimistic-concurrency-for-containers"></a><span data-ttu-id="6f8f1-261">Sämsta samtidighet för behållare</span><span class="sxs-lookup"><span data-stu-id="6f8f1-261">Pessimistic concurrency for containers</span></span>
<span data-ttu-id="6f8f1-262">Lån på behållare aktivera men samma strategier synkroniseringen ska stödjas på blobbar (exklusiv Skriv- / delade skrivskyddade, exklusiv skrivning / exklusiv Läs- och delade skrivning / samtidigt läsa) men till skillnad från BLOB storage-tjänst endast tillämpar ensamrätt på delete-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-262">Leases on containers enable the same synchronization strategies to be supported as on blobs (exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read) however unlike blobs the storage service only enforces exclusivity on delete operations.</span></span> <span data-ttu-id="6f8f1-263">En klient måste innehålla ID för aktiva lån med begäran om borttagning för att ta bort en behållare med en aktiv livslängd.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-263">To delete a container with an active lease, a client must include the active lease ID with the delete request.</span></span> <span data-ttu-id="6f8f1-264">Alla andra åtgärder i behållaren lyckas på lånade behållaren utan att inkludera lease-ID då de delas åtgärder.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-264">All other container operations succeed on a leased container without including the lease ID in which case they are shared operations.</span></span> <span data-ttu-id="6f8f1-265">Om ensamrätt av update (put eller set) eller läsåtgärder krävs ska utvecklare Kontrollera alla klienter använder ett lån-ID och som endast en klient i taget har ett giltigt lease-ID.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-265">If exclusivity of update (put or set) or read operations is required then developers should ensure all clients use a lease ID and that only one client at a time has a valid lease ID.</span></span>  

<span data-ttu-id="6f8f1-266">Följande åtgärder för behållaren kan använda lån för att hantera sämsta samtidighet:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-266">The following container operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="6f8f1-267">Ta bort behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-267">Delete Container</span></span>
* <span data-ttu-id="6f8f1-268">Hämta egenskaper för behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-268">Get Container Properties</span></span>
* <span data-ttu-id="6f8f1-269">Hämta Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-269">Get Container Metadata</span></span>
* <span data-ttu-id="6f8f1-270">Ange Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="6f8f1-270">Set Container Metadata</span></span>
* <span data-ttu-id="6f8f1-271">Hämta behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="6f8f1-271">Get Container ACL</span></span>
* <span data-ttu-id="6f8f1-272">Ange behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="6f8f1-272">Set Container ACL</span></span>
* <span data-ttu-id="6f8f1-273">Lånet behållare</span><span class="sxs-lookup"><span data-stu-id="6f8f1-273">Lease Container</span></span>  

<span data-ttu-id="6f8f1-274">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-274">For more information, see:</span></span>  

* [<span data-ttu-id="6f8f1-275">Ange villkorlig huvuden för Blob-tjänståtgärder</span><span class="sxs-lookup"><span data-stu-id="6f8f1-275">Specifying Conditional Headers for Blob Service Operations</span></span>](http://msdn.microsoft.com/library/azure/dd179371.aspx)
* [<span data-ttu-id="6f8f1-276">Lånet behållare</span><span class="sxs-lookup"><span data-stu-id="6f8f1-276">Lease Container</span></span>](http://msdn.microsoft.com/library/azure/jj159103.aspx)
* [<span data-ttu-id="6f8f1-277">Lånet Blob</span><span class="sxs-lookup"><span data-stu-id="6f8f1-277">Lease Blob </span></span>](http://msdn.microsoft.com/library/azure/ee691972.aspx)

## <a name="managing-concurrency-in-the-table-service"></a><span data-ttu-id="6f8f1-278">Hantera samtidighet i Tabelltjänsten</span><span class="sxs-lookup"><span data-stu-id="6f8f1-278">Managing Concurrency in the Table Service</span></span>
<span data-ttu-id="6f8f1-279">Tabelltjänsten använder Optimistisk samtidighet kontrollerar som standard när du arbetar med entiteter, till skillnad från blob-tjänsten där du måste uttryckligen välja att utföra Optimistisk samtidighet kontroller.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-279">The table service uses optimistic concurrency checks as the default behavior when you are working with entities, unlike the blob service where you must explicitly choose to perform optimistic concurrency checks.</span></span> <span data-ttu-id="6f8f1-280">Skillnaden mellan tabellen och blob-tjänsterna är att du kan endast hantera samtidighet beteendet för entiteter i blob-tjänsten kan du hantera samtidighet på både behållare och blobbar.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-280">The other difference between the table and blob services is that you can only manage the concurrency behavior of entities whereas with the blob service you can manage the concurrency of both containers and blobs.</span></span>  

<span data-ttu-id="6f8f1-281">Använd Optimistisk samtidighet och kontrollera om en annan process har ändrats för en entitet eftersom hämtades från table storage-tjänsten, kan du använda ETag-värde som du får när tabelltjänsten returnerar en entitet.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-281">To use optimistic concurrency and to check if another process modified an entity since you retrieved it from the table storage service, you can use the ETag value you receive when the table service returns an entity.</span></span> <span data-ttu-id="6f8f1-282">Beskrivning av den här processen är följande:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-282">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="6f8f1-283">Hämta en entitet från tabelltjänsten för lagring, svaret innehåller ett ETag-värde som anger den aktuella identifieraren som är associerade med den entiteten i lagringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-283">Retrieve an entity from the table storage service, the response includes an ETag value that identifies the current identifier associated with that entity in the storage service.</span></span>
2. <span data-ttu-id="6f8f1-284">När du uppdaterar entiteten innehåller ETag-värde som du fick i steg 1 i obligatoriska **If-Match** huvudet i begäran som du skickar till tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-284">When you update the entity, include the ETag value you received in step 1 in the mandatory **If-Match** header of the request you send to the service.</span></span>
3. <span data-ttu-id="6f8f1-285">Tjänsten jämför ETag-värde i förfrågan med det aktuella ETag-värdet för entiteten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-285">The service compares the ETag value in the request with the current ETag value of the entity.</span></span>
4. <span data-ttu-id="6f8f1-286">Om det aktuella ETag-värdet för entiteten skiljer sig ETag i obligatoriska **If-Match** huvud i begäran tjänsten returnerar 412 fel till klienten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-286">If the current ETag value of the entity is different than the ETag in the mandatory **If-Match** header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="6f8f1-287">Detta anger att klienten en annan process har uppdaterat entiteten eftersom klienten hämtades.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-287">This indicates to the client that another process has updated the entity since the client retrieved it.</span></span>
5. <span data-ttu-id="6f8f1-288">Om det aktuella ETag-värdet för entiteten är samma som ETag i obligatoriska **If-Match** huvud i begäran eller **If-Match** huvudet innehåller jokertecken (*), tjänsten utför den begärda åtgärden och uppdaterar det aktuella ETag-värdet för entiteten ska visa att det har uppdaterats.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-288">If the current ETag value of the entity is the same as the ETag in the mandatory **If-Match** header in the request or the **If-Match** header contains the wildcard character (*), the service performs the requested operation and updates the current ETag value of the entity to show that it has been updated.</span></span>  

<span data-ttu-id="6f8f1-289">Observera att tabelltjänsten till skillnad från blob-tjänsten kräver att klienten kan innehålla en **If-Match** huvudet i begäranden om att uppdatera.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-289">Note that unlike the blob service, the table service requires the client to include an **If-Match** header in update requests.</span></span> <span data-ttu-id="6f8f1-290">Det är dock möjligt att framtvinga en ovillkorlig uppdatera (senaste skrivaren WINS-strategi) och kringgå samtidighet kontrollerar om klienten anger den **If-Match** sidhuvud till jokertecknet (*) i begäran.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-290">However, it is possible to force an unconditional update (last writer wins strategy) and bypass concurrency checks if the client sets the **If-Match** header to the wildcard character (*) in the request.</span></span>  

<span data-ttu-id="6f8f1-291">Följande C#-fragment visar en kundentitet som skapades tidigare antingen eller hämtas med deras e-postadress som uppdateras.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-291">The following C# snippet shows a customer entity that was previously either created or retrieved having their email address updated.</span></span> <span data-ttu-id="6f8f1-292">Första infoga eller hämta åtgärden lagrar ETag-värde i kund-objektet och eftersom samma objektinstansen används när den körs ersättningsåtgärden, skickas automatiskt ETag-värdet tillbaka till tabelltjänsten att aktivera tjänsten för att söka efter samtidighet överträdelser.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-292">The initial insert or retrieve operation stores the ETag value in the customer object, and because the sample uses the same object instance when it executes the replace operation, it automatically sends the ETag value back to the table service, enabling the service to check for concurrency violations.</span></span> <span data-ttu-id="6f8f1-293">Om en annan process har uppdaterat entiteten i table storage, returnerar tjänsten ett statusmeddelande HTTP 412 (villkor misslyckades).</span><span class="sxs-lookup"><span data-stu-id="6f8f1-293">If another process has updated the entity in table storage, the service returns an HTTP 412 (Precondition Failed) status message.</span></span>  <span data-ttu-id="6f8f1-294">Du kan ladda ned i det fullständiga exemplet: [hantera samtidighet med hjälp av Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="6f8f1-294">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
try
{
    customer.Email = "updatedEmail@contoso.org";
    TableOperation replaceCustomer = TableOperation.Replace(customer);
    customerTable.Execute(replaceCustomer);
    Console.WriteLine("Replace operation succeeded.");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == 412)
        Console.WriteLine("Optimistic concurrency violation – entity has changed since it was retrieved.");
    else
        throw;
}  
```

<span data-ttu-id="6f8f1-295">För att uttryckligen inaktivera kontrollen av samtidighet, bör du ange den **ETag** -egenskapen för den **medarbetare** objekt ”*” innan du kan köra ersättningsåtgärden.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-295">To explicitly disable the concurrency check, you should set the **ETag** property of the **employee** object to "*" before you execute the replace operation.</span></span>  

```csharp
customer.ETag = "*";  
```

<span data-ttu-id="6f8f1-296">I följande tabell sammanfattas hur entiteten tabellåtgärder använda ETag-värden:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-296">The following table summarizes how the table entity operations use ETag values:</span></span>

| <span data-ttu-id="6f8f1-297">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="6f8f1-297">Operation</span></span> | <span data-ttu-id="6f8f1-298">Returnerar ETag-värde</span><span class="sxs-lookup"><span data-stu-id="6f8f1-298">Returns ETag value</span></span> | <span data-ttu-id="6f8f1-299">Kräver If-Match huvudet i begäran</span><span class="sxs-lookup"><span data-stu-id="6f8f1-299">Requires If-Match request header</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="6f8f1-300">Fråga entiteter</span><span class="sxs-lookup"><span data-stu-id="6f8f1-300">Query Entities</span></span> |<span data-ttu-id="6f8f1-301">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-301">Yes</span></span> |<span data-ttu-id="6f8f1-302">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-302">No</span></span> |
| <span data-ttu-id="6f8f1-303">Infoga entitet</span><span class="sxs-lookup"><span data-stu-id="6f8f1-303">Insert Entity</span></span> |<span data-ttu-id="6f8f1-304">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-304">Yes</span></span> |<span data-ttu-id="6f8f1-305">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-305">No</span></span> |
| <span data-ttu-id="6f8f1-306">Uppdatera entitet</span><span class="sxs-lookup"><span data-stu-id="6f8f1-306">Update Entity</span></span> |<span data-ttu-id="6f8f1-307">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-307">Yes</span></span> |<span data-ttu-id="6f8f1-308">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-308">Yes</span></span> |
| <span data-ttu-id="6f8f1-309">Sammanfoga entitet</span><span class="sxs-lookup"><span data-stu-id="6f8f1-309">Merge Entity</span></span> |<span data-ttu-id="6f8f1-310">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-310">Yes</span></span> |<span data-ttu-id="6f8f1-311">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-311">Yes</span></span> |
| <span data-ttu-id="6f8f1-312">Ta bort entiteten</span><span class="sxs-lookup"><span data-stu-id="6f8f1-312">Delete Entity</span></span> |<span data-ttu-id="6f8f1-313">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-313">No</span></span> |<span data-ttu-id="6f8f1-314">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-314">Yes</span></span> |
| <span data-ttu-id="6f8f1-315">Infoga eller ersätta en entitet</span><span class="sxs-lookup"><span data-stu-id="6f8f1-315">Insert or Replace Entity</span></span> |<span data-ttu-id="6f8f1-316">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-316">Yes</span></span> |<span data-ttu-id="6f8f1-317">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-317">No</span></span> |
| <span data-ttu-id="6f8f1-318">Infoga- eller Merge-entitet</span><span class="sxs-lookup"><span data-stu-id="6f8f1-318">Insert or Merge Entity</span></span> |<span data-ttu-id="6f8f1-319">Ja</span><span class="sxs-lookup"><span data-stu-id="6f8f1-319">Yes</span></span> |<span data-ttu-id="6f8f1-320">Nej</span><span class="sxs-lookup"><span data-stu-id="6f8f1-320">No</span></span> |

<span data-ttu-id="6f8f1-321">Observera att den **infoga eller ersätta entiteten** och **Insert- eller Merge-entiteten** operations vill *inte* utföra några kontroller av samtidighet eftersom ett ETag-värde inte skickas till tabelltjänsten.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-321">Note that the **Insert or Replace Entity** and **Insert or Merge Entity** operations do *not* perform any concurrency checks because they do not send an ETag value to the table service.</span></span>  

<span data-ttu-id="6f8f1-322">I allmänhet utvecklare som använder tabeller bör förlitar sig på Optimistisk samtidighet när du utvecklar skalbara program.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-322">In general developers using tables should rely on optimistic concurrency when developing scalable applications.</span></span> <span data-ttu-id="6f8f1-323">Om sämsta låsning krävs kan en metod som utvecklare ta när åtkomst till tabeller är att koppla en avsedda blob för varje tabell och försök att ta ett lån på blob innan operativsystemet i tabellen.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-323">If pessimistic locking is needed, one approach developers can take when accessing Tables is to assign a designated blob for each table and try to take a lease on the blob before operating on the table.</span></span> <span data-ttu-id="6f8f1-324">Den här metoden kräver programmet för att se till att alla data access-sökvägar får lån innan operativsystemet i tabellen.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-324">This approach does require the application to ensure all data access paths obtain the lease prior to operating on the table.</span></span> <span data-ttu-id="6f8f1-325">Observera även som minsta lånetiden är 15 sekunder som kräver noggrant övervägande för skalbarhet.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-325">You should also note that the minimum lease time is 15 seconds which requires careful consideration for scalability.</span></span>  

<span data-ttu-id="6f8f1-326">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-326">For more information, see:</span></span>  

* [<span data-ttu-id="6f8f1-327">Åtgärder på enheter</span><span class="sxs-lookup"><span data-stu-id="6f8f1-327">Operations on Entities</span></span>](http://msdn.microsoft.com/library/azure/dd179375.aspx)  

## <a name="managing-concurrency-in-the-queue-service"></a><span data-ttu-id="6f8f1-328">Hantera samtidighet i kötjänsten</span><span class="sxs-lookup"><span data-stu-id="6f8f1-328">Managing Concurrency in the Queue Service</span></span>
<span data-ttu-id="6f8f1-329">Ett scenario i vilket concurrency är ett problem i tjänsten kö är där flera klienter hämtar meddelanden från en kö.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-329">One scenario in which concurrency is a concern in the queueing service is where multiple clients are retrieving messages from a queue.</span></span> <span data-ttu-id="6f8f1-330">När ett meddelande har hämtats från kön innehåller svaret meddelandet och ett pop inleverans-värde som krävs för att ta bort meddelandet.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-330">When a message is retrieved from the queue, the response includes the message and a pop receipt value, which is required to delete the message.</span></span> <span data-ttu-id="6f8f1-331">Meddelandet tas inte bort automatiskt från kön, men när den har hämtats, det är inte synliga för andra klienter i tidsintervall som anges av parametern visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-331">The message is not automatically deleted from the queue, but after it has been retrieved, it is not visible to other clients for the time interval specified by the visibilitytimeout parameter.</span></span> <span data-ttu-id="6f8f1-332">Klienten som hämtar meddelanden som förväntas ta bort meddelandet när den har bearbetats och innan den tid som anges av TimeNextVisible element i svaret, som beräknas baserat på värdet för parametern visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-332">The client that retrieves the message is expected to delete the message after it has been processed, and before the time specified by the TimeNextVisible element of the response, which is calculated based on the value of the visibilitytimeout parameter.</span></span> <span data-ttu-id="6f8f1-333">Värdet för visibilitytimeout har lagts till den tid då meddelandet hämtas för att fastställa värdet för TimeNextVisible.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-333">The value of visibilitytimeout is added to the time at which the message is retrieved to determine the value of TimeNextVisible.</span></span>  

<span data-ttu-id="6f8f1-334">Kötjänsten har inte stöd för bästa eller sämsta samtidighet och för den här orsak klienter bearbetar meddelanden som hämtas från en kö ska kontrollera meddelanden bearbetas på ett idempotent sätt.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-334">The queue service does not have support for either optimistic or pessimistic concurrency and for this reason clients processing messages retrieved from a queue should ensure messages are processed in an idempotent manner.</span></span> <span data-ttu-id="6f8f1-335">En senaste skrivaren WINS-strategi används för update-åtgärder som till exempel SetQueueServiceProperties, SetQueueMetaData, SetQueueACL och UpdateMessage.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-335">A last writer wins strategy is used for update operations such as SetQueueServiceProperties, SetQueueMetaData, SetQueueACL and UpdateMessage.</span></span>  

<span data-ttu-id="6f8f1-336">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-336">For more information, see:</span></span>  

* [<span data-ttu-id="6f8f1-337">Kön Service REST-API</span><span class="sxs-lookup"><span data-stu-id="6f8f1-337">Queue Service REST API</span></span>](http://msdn.microsoft.com/library/azure/dd179363.aspx)
* [<span data-ttu-id="6f8f1-338">Hämta meddelanden</span><span class="sxs-lookup"><span data-stu-id="6f8f1-338">Get Messages</span></span>](http://msdn.microsoft.com/library/azure/dd179474.aspx)  

## <a name="managing-concurrency-in-the-file-service"></a><span data-ttu-id="6f8f1-339">Hantera samtidighet i tjänsten</span><span class="sxs-lookup"><span data-stu-id="6f8f1-339">Managing Concurrency in the File Service</span></span>
<span data-ttu-id="6f8f1-340">Tjänsten kan nås med hjälp av två olika protokollslutpunkterna – SMB- och REST.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-340">The file service can be accessed using two different protocol endpoints – SMB and REST.</span></span> <span data-ttu-id="6f8f1-341">REST-tjänsten har inte stöd för antingen optimistisk låsning eller sämsta låser och alla uppdateringar följer en senaste skrivaren WINS-strategi.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-341">The REST service does not have support for either optimistic locking or pessimistic locking and all updates will follow a last writer wins strategy.</span></span> <span data-ttu-id="6f8f1-342">SMB-klienter som montera filresurser kan utnyttja filen system låsning mekanismer för att hantera åtkomst till delade filer – inklusive möjligheten att utföra sämsta låsning.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-342">SMB clients that mount file shares can leverage file system locking mechanisms to manage access to shared files – including the ability to perform pessimistic locking.</span></span> <span data-ttu-id="6f8f1-343">När en SMB-klienten öppnar en fil, anger både åtkomst till filen och dela läge.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-343">When an SMB client opens a file, it specifies both the file access and share mode.</span></span> <span data-ttu-id="6f8f1-344">Inställning åtkomst till filen för ”skriva” eller ”läsa/skriva” tillsammans med en filresurs läge ”NONE” resulterar i filen är låst av en SMB-klienten förrän filen är stängd.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-344">Setting a File Access option of "Write" or "Read/Write" along with a File Share mode of "None" will result in the file being locked by an SMB client until the file is closed.</span></span> <span data-ttu-id="6f8f1-345">Om REST-åtgärden utförs på en fil där en SMB-klient har låst filen returnerar REST-tjänsten statuskod 409 (konflikt) med felkoden SharingViolation.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-345">If REST operation is attempted on a file where an SMB client has the file locked the REST service will return status code 409 (Conflict) with error code SharingViolation.</span></span>  

<span data-ttu-id="6f8f1-346">När en SMB-klienten öppnar en fil att ta bort, markerar filen som väntar på borttagning förrän alla andra SMB-klienten med öppna referenser i filen är stängd.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-346">When an SMB client opens a file for delete, it marks the file as pending delete until all other SMB client open handles on that file are closed.</span></span> <span data-ttu-id="6f8f1-347">När en fil är markerad som väntar på borttagning, returneras alla REST-åtgärden på filen statuskod 409 (konflikt) med felkoden SMBDeletePending.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-347">While a file is marked as pending delete, any REST operation on that file will return status code 409 (Conflict) with error code SMBDeletePending.</span></span> <span data-ttu-id="6f8f1-348">Statuskod 404 (inget hittas) returneras inte eftersom det är möjligt för SMB-klienten att ta bort flaggan borttagning väntar innan denna fil stängdes.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-348">Status code 404 (Not Found) is not returned since it is possible for the SMB client to remove the pending deletion flag prior to closing the file.</span></span> <span data-ttu-id="6f8f1-349">Statuskod 404 (inget hittas) förväntas med andra ord bara när filen har tagits bort.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-349">In other words, status code 404 (Not Found) is only expected when the file has been removed.</span></span> <span data-ttu-id="6f8f1-350">Observera att när en fil i en SMB väntetillstånd ta bort den inte tas med i resultatet lista filer.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-350">Note that while a file is in an SMB pending delete state, it will not be included in the List Files results.</span></span> <span data-ttu-id="6f8f1-351">Observera också att åtgärderna REST ta bort fil- och REST ta bort genomförs automatiskt och inte resulterar i ett tillstånd med väntande borttagning.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-351">Also, note that the REST Delete File and REST Delete Directory operations are committed atomically and do not result in a pending delete state.</span></span>  

<span data-ttu-id="6f8f1-352">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-352">For more information, see:</span></span>  

* [<span data-ttu-id="6f8f1-353">Hantera filen låser</span><span class="sxs-lookup"><span data-stu-id="6f8f1-353">Managing File Locks</span></span>](http://msdn.microsoft.com/library/azure/dn194265.aspx)  

## <a name="summary-and-next-steps"></a><span data-ttu-id="6f8f1-354">Sammanfattning och nästa steg.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-354">Summary and Next Steps</span></span>
<span data-ttu-id="6f8f1-355">Microsoft Azure Storage-tjänsten har utformats för att uppfylla behoven hos de mest komplexa online program utan att utvecklare att kompromettera eller Tänk om viktiga designbeslut antaganden som samtidighet och data konsekvent som de kommer att ta beviljas.</span><span class="sxs-lookup"><span data-stu-id="6f8f1-355">The Microsoft Azure Storage service has been designed to meet the needs of the most complex online applications without forcing developers to compromise or rethink key design assumptions such as concurrency and data consistency that they have come to take for granted.</span></span>  

<span data-ttu-id="6f8f1-356">Fullständig exempelprogrammet som hänvisas till i den här bloggen:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-356">For the complete sample application referenced in this blog:</span></span>  

* [<span data-ttu-id="6f8f1-357">Hantera samtidighet med hjälp av Azure Storage - exempelprogram</span><span class="sxs-lookup"><span data-stu-id="6f8f1-357">Managing Concurrency using Azure Storage - Sample Application</span></span>](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114)  

<span data-ttu-id="6f8f1-358">Mer information om Azure Storage finns:</span><span class="sxs-lookup"><span data-stu-id="6f8f1-358">For more information on Azure Storage see:</span></span>  

* [<span data-ttu-id="6f8f1-359">Startsida för Microsoft Azure Storage</span><span class="sxs-lookup"><span data-stu-id="6f8f1-359">Microsoft Azure Storage Home Page</span></span>](https://azure.microsoft.com/services/storage/)
* [<span data-ttu-id="6f8f1-360">Introduktion till Azure Storage</span><span class="sxs-lookup"><span data-stu-id="6f8f1-360">Introduction to Azure Storage</span></span>](storage-introduction.md)
* <span data-ttu-id="6f8f1-361">Komma igång för lagring [Blob](../blobs/storage-dotnet-how-to-use-blobs.md), [tabell](../../cosmos-db/table-storage-how-to-use-dotnet.md), [köer](../storage-dotnet-how-to-use-queues.md), och [filer](../storage-dotnet-how-to-use-files.md)</span><span class="sxs-lookup"><span data-stu-id="6f8f1-361">Storage Getting Started for [Blob](../blobs/storage-dotnet-how-to-use-blobs.md), [Table](../../cosmos-db/table-storage-how-to-use-dotnet.md),  [Queues](../storage-dotnet-how-to-use-queues.md), and [Files](../storage-dotnet-how-to-use-files.md)</span></span>
* <span data-ttu-id="6f8f1-362">Lagringsarkitektur – [Azure Storage: en högtillgänglig Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span><span class="sxs-lookup"><span data-stu-id="6f8f1-362">Storage Architecture – [Azure Storage: A Highly Available Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span></span>

