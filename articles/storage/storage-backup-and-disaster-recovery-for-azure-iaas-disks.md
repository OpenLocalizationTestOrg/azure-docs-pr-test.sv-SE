---
title: "Säkerhetskopiering och katastrofåterställning återställning för Azure IaaS-diskar | Microsoft Docs"
description: "I den här artikeln förklarar vi hur du planerar för säkerhetskopiering och Disaster Recovery (DR) för IaaS-virtuella maskiner (VMs) och diskarna i Azure. Det här dokumentet beskriver både hanterade och ohanterade diskar"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 0de675e46dbd527148ac5fedcd35d81962adfb7e
ms.sourcegitcommit: 422efcbac5b6b68295064bd545132fcc98349d01
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/29/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="24279-104">Säkerhetskopiering och katastrofåterställning återställning för Azure IaaS-diskar</span><span class="sxs-lookup"><span data-stu-id="24279-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="24279-105">I den här artikeln förklarar vi hur du planerar för säkerhetskopiering och Disaster Recovery (DR) för IaaS-virtuella maskiner (VMs) och diskarna i Azure.</span><span class="sxs-lookup"><span data-stu-id="24279-105">In this article, we will explain how to plan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="24279-106">Det här dokumentet beskriver både hanterade och ohanterade diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="24279-107">Först ska vi tala om de inbyggda feltolerans i Azure-plattformen som bidrar till att skydda dig mot lokala fel.</span><span class="sxs-lookup"><span data-stu-id="24279-107">We’ll first talk about the built-in fault tolerance capabilities in the Azure platform which help guard against local failures.</span></span> <span data-ttu-id="24279-108">Sedan diskuterar vi katastrofåterställning-scenarier som inte omfattas av inbyggda funktioner som är hjälpavsnittet beskrivs i det här dokumentet.</span><span class="sxs-lookup"><span data-stu-id="24279-108">We’ll then discuss the disaster scenarios not fully covered by the built-in capabilities, which is the main topic addressed by this document.</span></span> <span data-ttu-id="24279-109">Dessutom lär flera exempel på arbetsbelastningsscenarier där olika överväganden för säkerhetskopiering och Katastrofåterställning kan tillkomma.</span><span class="sxs-lookup"><span data-stu-id="24279-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="24279-110">Vi ska granska möjliga lösningar för Katastrofåterställning för IaaS-diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="24279-111">Introduktion</span><span class="sxs-lookup"><span data-stu-id="24279-111">Introduction</span></span>

<span data-ttu-id="24279-112">Azure-plattformen använder olika metoder för redundans och feltolerans för att skydda kunder från lokaliserade maskinvarufel som kan uppstå.</span><span class="sxs-lookup"><span data-stu-id="24279-112">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="24279-113">Lokala fel kan omfatta problem med en Azure storage server-dator på servern som innehåller en del av data för en virtuell disk eller fel i en SSD och Hårddisk.</span><span class="sxs-lookup"><span data-stu-id="24279-113">Local failures may include problems with an Azure storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="24279-114">Sådana isolerade maskinvarufel för komponenten kan inträffa under normal drift och plattformen är avsedd att vara motståndskraftiga mot dessa fel.</span><span class="sxs-lookup"><span data-stu-id="24279-114">Such isolated hardware component failures can happen during normal operations and the platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="24279-115">Större katastrofer kan resultera i fel eller inaccessibility av stora mängder lagringsservrar eller ett helt datacenter.</span><span class="sxs-lookup"><span data-stu-id="24279-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="24279-116">Medan dina virtuella datorer och diskar skyddas normalt från lokaliserade fel, krävs ytterligare steg för att skydda din arbetsbelastning från region hela katastrofalt fel (till exempel en större katastrof) kan påverka den virtuella datorn och diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="24279-117">Utöver möjligheten att plattform fel kan uppstå problem med kunden program eller data.</span><span class="sxs-lookup"><span data-stu-id="24279-117">In addition to the possibility of platform failures, problems with the customer application or data can occur.</span></span> <span data-ttu-id="24279-118">En ny version av programmet kan till exempel oavsiktligen gör en ny ändra till data.</span><span class="sxs-lookup"><span data-stu-id="24279-118">For example, a new version of your application may inadvertently make a breaking change to the data.</span></span> <span data-ttu-id="24279-119">I så fall kanske du vill återställa programmet och data till en tidigare version som innehåller det senaste fungerande tillståndet.</span><span class="sxs-lookup"><span data-stu-id="24279-119">In that case, you may want to revert the application and the data to a prior version containing the last known good state.</span></span> <span data-ttu-id="24279-120">Detta kräver att underhålla regelbundna säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="24279-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="24279-121">För regional katastrofåterställning, måste du säkerhetskopiera din IaaS-VM-diskarna till en annan region.</span><span class="sxs-lookup"><span data-stu-id="24279-121">For regional disaster recovery, you must backup your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="24279-122">Innan vi tittar på alternativ för säkerhetskopiering och Katastrofåterställning Sammanfattningsvis vi några metoder för att hantera lokaliserade fel.</span><span class="sxs-lookup"><span data-stu-id="24279-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="24279-123">Azure IaaS återhämtning</span><span class="sxs-lookup"><span data-stu-id="24279-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="24279-124">*Återhämtning* refererar till tolerans för vanliga fel som uppstår i maskinvarukomponenter.</span><span class="sxs-lookup"><span data-stu-id="24279-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="24279-125">Återhämtning är möjligheten att återställa från fel och fortsätter att fungera.</span><span class="sxs-lookup"><span data-stu-id="24279-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="24279-126">Det är inte om att undvika fel, men svarar på fel i ett sätt som förhindrar avbrott eller dataförlust.</span><span class="sxs-lookup"><span data-stu-id="24279-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="24279-127">Målet med återhämtning är att returnera programmet till en fullt fungerande tillstånd efter fel.</span><span class="sxs-lookup"><span data-stu-id="24279-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="24279-128">Azure virtuella datorer och diskar som är avsedda att vara motståndskraftiga mot vanliga maskinvarufel.</span><span class="sxs-lookup"><span data-stu-id="24279-128">Azure Virtual Machines and Disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="24279-129">Låt oss titta på hur Azure IaaS-plattformen ger den här återhämtning.</span><span class="sxs-lookup"><span data-stu-id="24279-129">Let us look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="24279-130">En virtuell dator består i huvudsak av två delar: (1) A compute-servern och (2) beständiga diskarna.</span><span class="sxs-lookup"><span data-stu-id="24279-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) the persistent disks.</span></span> <span data-ttu-id="24279-131">Både påverkar feltolerans för en virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="24279-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="24279-132">Om Azure compute värdservern som innehåller den virtuella datorn får ett maskinvarufel (som är ovanligt), för Azure att automatiskt återställa den virtuella datorn på en annan server.</span><span class="sxs-lookup"><span data-stu-id="24279-132">If the Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="24279-133">Om det händer kan du får en omstart och den virtuella datorn kommer att säkerhetskopiera en stund.</span><span class="sxs-lookup"><span data-stu-id="24279-133">If this happens, you will experience a reboot, and the VM will be back up after some time.</span></span> <span data-ttu-id="24279-134">Azure automatiskt identifierar sådana maskinvarufel och kör återställningar för att säkerställa kunden VM blir tillgängliga så snart som möjligt.</span><span class="sxs-lookup"><span data-stu-id="24279-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="24279-135">Om IaaS-diskar är hållbarhet av data viktigt för beständig lagring-plattformen.</span><span class="sxs-lookup"><span data-stu-id="24279-135">Regarding IaaS disks, durability of data is critical for the persistent storage platform.</span></span> <span data-ttu-id="24279-136">Azure-kunder har viktiga business-program körs med IaaS och de är beroende av beständiga data.</span><span class="sxs-lookup"><span data-stu-id="24279-136">Azure customers have important business applications running on IaaS and they depend on the persistence of the data.</span></span> <span data-ttu-id="24279-137">Azure Designer skydd för dessa IaaS-diskar med tre redundanta kopior av data som lagras lokalt, ger hög hållbarhet mot lokala fel.</span><span class="sxs-lookup"><span data-stu-id="24279-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="24279-138">Om en av de maskinvarukomponenter som innehåller disken misslyckas påverkas inte den virtuella datorn eftersom det finns två ytterligare kopior som stöd för disk-begäranden.</span><span class="sxs-lookup"><span data-stu-id="24279-138">If one of the hardware components that holds your disk fails, your VM is not impacted because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="24279-139">Den fungerar även om två olika maskinvarukomponenter som stöd för en disk som inte samtidigt (som skulle vara mycket sällsynt).</span><span class="sxs-lookup"><span data-stu-id="24279-139">It works fine even if two different hardware components supporting a disk fail at the same time (which would be very rare).</span></span> <span data-ttu-id="24279-140">För att säkerställa att vi alltid har tre repliker, skapas Azure Storage-tjänsten automatiskt en ny kopia av data i bakgrunden om en av de tre kopiorna är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="24279-140">To help ensure we always maintain three replicas, the Azure Storage service automatically spawns a new copy of data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="24279-141">Det bör därför inte nödvändigt att använda RAID med Azure-diskar för feltolerans.</span><span class="sxs-lookup"><span data-stu-id="24279-141">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="24279-142">En enkel RAID 0-konfigurationen ska vara tillräcklig för striping diskar om det behövs för att skapa större volymer.</span><span class="sxs-lookup"><span data-stu-id="24279-142">A simple RAID 0 configuration should be sufficient for striping the disks if necessary to create larger volumes.</span></span>

<span data-ttu-id="24279-143">På grund av den här arkitekturen **Azure har konsekvent levereras företagsklass hållbarhet för IaaS-diskar, med ett branschledande noll % [medel Felintervall](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span><span class="sxs-lookup"><span data-stu-id="24279-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="24279-144">Lokaliserade maskinvarufel på beräknade värd eller i plattformen lagring kan ibland resultatet i tillfällig otillgänglighet för den virtuella datorn som omfattas av den [Azure-serviceavtalet](https://azure.microsoft.com/support/legal/sla/virtual-machines/) för VM-tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="24279-144">Localized hardware faults on the compute host or in the storage platform can sometimes result in temporary unavailability for the VM which is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="24279-145">Azure tillhandahåller också ett branschledande serviceavtal för enskild VM-instanser som använder Premiumlagring diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="24279-146">Kunder kan använda för att skydda arbetsbelastningar för program från avbrott på grund av temporär otillgänglighet en disk eller VM [Tillgänglighetsuppsättningar](../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="24279-146">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="24279-147">Två eller flera virtuella datorer i en tillgänglighetsuppsättning ger redundans för programmet.</span><span class="sxs-lookup"><span data-stu-id="24279-147">Two or more virtual machines in an availability set provides redundancy for the application.</span></span> <span data-ttu-id="24279-148">Azure skapar sedan dessa virtuella datorer och diskar i separata feldomäner med olika ström, nätverk och server-komponenter.</span><span class="sxs-lookup"><span data-stu-id="24279-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="24279-149">Därför påverkar lokaliserade maskinvarufel vanligtvis inte flera virtuella datorer i uppsättningen samtidigt, tillhandahåller hög tillgänglighet för ditt program.</span><span class="sxs-lookup"><span data-stu-id="24279-149">Thus, localized hardware failures typically do not affect multiple VMs in the set at the same time, providing high availability for your application.</span></span> <span data-ttu-id="24279-150">Den anses vara en bra idé att använda tillgänglighetsuppsättningar när hög tillgänglighet krävs.</span><span class="sxs-lookup"><span data-stu-id="24279-150">It is considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="24279-151">Mer information finns i Disaster Recovery-aspekter som beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="24279-151">For more information, see the Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="24279-152">Säkerhetskopiering och katastrofåterställning</span><span class="sxs-lookup"><span data-stu-id="24279-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="24279-153">Katastrofåterställning (DR) är möjligheten att återställa från sällsynt men större incidenter: uppstod, storskaligt fel, till exempel avbrott i tjänsten som påverkar en hel region.</span><span class="sxs-lookup"><span data-stu-id="24279-153">Disaster recovery (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="24279-154">Katastrofåterställning innehåller säkerhetskopiering och arkivering och kan innehålla manuella ingripanden, till exempel återställa en databas från en säkerhetskopia.</span><span class="sxs-lookup"><span data-stu-id="24279-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="24279-155">Plattformen Azure inbyggt skydd mot fel på lokaliserade skyddar kanske inte helt virtuella datorer/diskar vid större katastrofer vilket kan orsaka stora avbrott.</span><span class="sxs-lookup"><span data-stu-id="24279-155">The Azure platform’s built-in protection against localized failures may not fully protect the VMs/disks in the case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="24279-156">Detta inkluderar katastrofer, till exempel ett datacenter som träffas av en orkan jordbävning, fire eller stor skala enhet maskinvarufel.</span><span class="sxs-lookup"><span data-stu-id="24279-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="24279-157">Dessutom kan det uppstå fel som beror på programmet eller problem.</span><span class="sxs-lookup"><span data-stu-id="24279-157">In addition, you may encounter failures due to application or data issues.</span></span>

<span data-ttu-id="24279-158">För att skydda dina IaaS-arbetsbelastningar från avbrott, bör du planera för redundans och att aktivera återställning av säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="24279-158">To help protect your IaaS workloads from outages, you should plan for redundancy and backups to enable recovery.</span></span> <span data-ttu-id="24279-159">Du bör planera redundans och säkerhetskopiering på en annan geografisk plats från den primära platsen för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from the primary site.</span></span> <span data-ttu-id="24279-160">På så sätt försäkrar du dig säkerhetskopiorna inte påverkas av samma händelse som ursprungligen påverkas VM eller diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-160">This helps ensure your backup is not affected by the same event that originally impacted the VM or disks.</span></span> <span data-ttu-id="24279-161">Mer information finns i [katastrofåterställning för program som bygger på Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="24279-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="24279-162">DR-överväganden kan inkludera följande aspekter:</span><span class="sxs-lookup"><span data-stu-id="24279-162">Your DR considerations may include the following aspects:</span></span>

1. <span data-ttu-id="24279-163">Hög tillgänglighet är möjligheten för att fortsätta köras i ett felfritt tillstånd utan betydande driftavbrott.</span><span class="sxs-lookup"><span data-stu-id="24279-163">High Availability (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="24279-164">Med ”felfritt tillstånd”, menar vi programmet svarar och användare kan ansluta till programmet och interagera med den.</span><span class="sxs-lookup"><span data-stu-id="24279-164">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="24279-165">Vissa verksamhetskritiska program och databaser kan krävas ska vara tillgängliga alltid, även om det finns fel i plattformen.</span><span class="sxs-lookup"><span data-stu-id="24279-165">Certain mission-critical applications and databases may be required to be available always, even when there are failures in the platform.</span></span> <span data-ttu-id="24279-166">Du kan behöva planera redundans för programmet, samt data för dessa arbetsbelastningar.</span><span class="sxs-lookup"><span data-stu-id="24279-166">For these workloads, you may need to plan redundancy for the application as well as the data.</span></span>

2. <span data-ttu-id="24279-167">Data hållbarhet: I vissa fall kan den huvudsakliga ersättningen är att säkerställa att dina data bevaras vid en katastrof.</span><span class="sxs-lookup"><span data-stu-id="24279-167">Data Durability: In some cases, the main consideration is ensuring the data is preserved in the case of a disaster.</span></span> <span data-ttu-id="24279-168">Du måste därför kan en säkerhetskopia av dina data i en annan plats.</span><span class="sxs-lookup"><span data-stu-id="24279-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="24279-169">För dessa arbetsbelastningar, kanske du inte behöver fullständig redundans för programmet, men en regelbunden säkerhetskopiering av diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-169">For such workloads, you may not need full redundancy for the application, but a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="24279-170">Säkerhetskopiering och Katastrofåterställning scenarier</span><span class="sxs-lookup"><span data-stu-id="24279-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="24279-171">Nu ska vi titta på några exempel på arbetsbelastning Programscenarier och överväganden för planering av Disaster Recovery.</span><span class="sxs-lookup"><span data-stu-id="24279-171">Let’s look at a few typical examples of application workload scenarios and the considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="24279-172">Scenario 1: Större databas lösningar</span><span class="sxs-lookup"><span data-stu-id="24279-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="24279-173">Överväg att en produktionsserver databasen som SQL Server eller Oracle som har stöd för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="24279-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="24279-174">Kritiska produktionsprogram och användare beror på den här databasen.</span><span class="sxs-lookup"><span data-stu-id="24279-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="24279-175">Plan för katastrofåterställning för det här systemet kan behöva stöd för följande krav:</span><span class="sxs-lookup"><span data-stu-id="24279-175">The Disaster Recovery plan for this system may need to support the following requirements:</span></span>

1. <span data-ttu-id="24279-176">Data måste vara skyddade och återställas.</span><span class="sxs-lookup"><span data-stu-id="24279-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="24279-177">Servern måste vara tillgängliga för användning.</span><span class="sxs-lookup"><span data-stu-id="24279-177">Server must be available for use.</span></span>

<span data-ttu-id="24279-178">Du kan behöva underhålla en replik av databasen i en annan region som en säkerhetskopia.</span><span class="sxs-lookup"><span data-stu-id="24279-178">This may require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="24279-179">Beroende på kraven för servertillgänglighet och återställning av data kan lösningen röra sig om en plats för aktiv-aktiv eller aktivt-passivt replik till periodiska offline säkerhetskopior av data.</span><span class="sxs-lookup"><span data-stu-id="24279-179">Depending on the requirements for server availability and data recovery, the solution could range from an Active-Active or Active-Passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="24279-180">Relationsdatabaser, till exempel SQL Server och Oracle ger olika alternativ för replikering.</span><span class="sxs-lookup"><span data-stu-id="24279-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="24279-181">För SQL Server [SQL Server alltid på Tillgänglighetsgrupper](https://msdn.microsoft.com/library/hh510230.aspx) kan användas för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="24279-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="24279-182">Det stöder också NoSQL-databaser som MongoDB [repliker](https://docs.mongodb.com/manual/replication/) för redundans.</span><span class="sxs-lookup"><span data-stu-id="24279-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="24279-183">Du kan använda repliker för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="24279-183">The replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="24279-184">Scenario 2: Ett kluster med redundanta virtuella datorer</span><span class="sxs-lookup"><span data-stu-id="24279-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="24279-185">Överväg att en arbetsbelastning hanteras av ett kluster för virtuella datorer som ger redundans och belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="24279-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="24279-186">Ett exempel är ett Cassandra kluster som distribueras i en region.</span><span class="sxs-lookup"><span data-stu-id="24279-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="24279-187">Den här typen av arkitekturen innehåller redan en hög nivå av redundans i detta område.</span><span class="sxs-lookup"><span data-stu-id="24279-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="24279-188">Men om du vill skydda belastningen från ett regionalt nivån fel bör du sprida klustret mellan två regioner och regelbundna säkerhetskopieringar till en annan region.</span><span class="sxs-lookup"><span data-stu-id="24279-188">However, to protect the workload from a regional level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="24279-189">Scenario 3: IaaS programmet arbetsbelastning</span><span class="sxs-lookup"><span data-stu-id="24279-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="24279-190">Detta kan vara en produktionsögonblicksbild vid arbetsbelastningar som körs på en virtuell dator i Azure.</span><span class="sxs-lookup"><span data-stu-id="24279-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="24279-191">Det kan till exempel vara en webbserver eller filserver håller innehållet och andra resurser för en plats.</span><span class="sxs-lookup"><span data-stu-id="24279-191">For example, it could be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="24279-192">Det kan också vara ett specialbyggt affärsprogram som körs på en virtuell dator som lagras dess data, resurser och programtillstånd på VM-diskarna.</span><span class="sxs-lookup"><span data-stu-id="24279-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="24279-193">I det här fallet är det viktigt att se till att du kan göra säkerhetskopior med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="24279-193">In this case, it is important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="24279-194">Frekvens för säkerhetskopiering ska baseras på typ av VM-arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="24279-194">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="24279-195">Till exempel om programmet körs varje dag och ändrar data, bör sedan säkerhetskopieringen tas varje timme.</span><span class="sxs-lookup"><span data-stu-id="24279-195">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="24279-196">Ett annat exempel är en rapportserver som hämtar data från andra källor och genererar aggregerade rapporter.</span><span class="sxs-lookup"><span data-stu-id="24279-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="24279-197">Förlust av den här virtuella datorn eller diskar kommer att leda till förlust av rapporterna.</span><span class="sxs-lookup"><span data-stu-id="24279-197">Loss of this VM or disks will lead to the loss of the reports.</span></span> <span data-ttu-id="24279-198">Det kan dock vara möjligt att köra rapporterna och återskapa utdata.</span><span class="sxs-lookup"><span data-stu-id="24279-198">However, it may be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="24279-199">I så fall kan har du inte verkligen förlust av data även om rapportservern är träffa med katastrofåterställning, så du kan ha en högre nivå av feltolerans för att förlora en del av data på rapporteringsservern.</span><span class="sxs-lookup"><span data-stu-id="24279-199">In that case, you don’t really have a loss of data even if the reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="24279-200">I så fall mindre ofta återkommande säkerhetskopieringar är ett alternativ för att minska kostnaderna.</span><span class="sxs-lookup"><span data-stu-id="24279-200">In that case, less frequent backups is an option to reduce the cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="24279-201">Scenario 4: IaaS data programproblem</span><span class="sxs-lookup"><span data-stu-id="24279-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="24279-202">Du har ett program som beräknar, underhåller och levererar kritiska affärsdata, till exempel information om priser.</span><span class="sxs-lookup"><span data-stu-id="24279-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="24279-203">En ny version av programmet hade ett programfel för programvara som felaktigt beräknade prissättning och skadad befintliga commerce data som hanteras av plattformen.</span><span class="sxs-lookup"><span data-stu-id="24279-203">A new version of your application had a software bug which incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="24279-204">Här är att bästa loppet av åtgärden återgå till den tidigare versionen av programmet och data som först.</span><span class="sxs-lookup"><span data-stu-id="24279-204">Here, the best course of action would be to revert to the earlier version of the application and the data first.</span></span> <span data-ttu-id="24279-205">Om du vill aktivera det här ta periodiska säkerhetskopieringar av systemet.</span><span class="sxs-lookup"><span data-stu-id="24279-205">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="24279-206">Lösning för katastrofåterställning: Azure Backup-tjänsten</span><span class="sxs-lookup"><span data-stu-id="24279-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="24279-207">[Azure Backup-tjänsten](https://azure.microsoft.com/services/backup/) är kan användas för säkerhetskopiering och Katastrofåterställning och den fungerar med [hanterade diskar](storage-managed-disks-overview.md) samt [ohanterade diskar](storage-about-disks-and-vhds-windows.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="24279-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](storage-managed-disks-overview.md) as well as [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks).</span></span> <span data-ttu-id="24279-208">Du kan skapa en säkerhetskopiering med tidsbaserade säkerhetskopieringar, enkelt VM-återställning och säkerhetskopiering bevarandeprinciper.</span><span class="sxs-lookup"><span data-stu-id="24279-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="24279-209">Om du använder [Premium lagringsdiskar](storage-premium-storage.md), [hanterade diskar](storage-managed-disks-overview.md), eller andra disktyper med den [lokalt redundant lagring (LRS)](storage-redundancy.md#locally-redundant-storage) är särskilt viktigt att utnyttja periodiska DR-säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="24279-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](storage-managed-disks-overview.md), or other disk types with the [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important to leverage periodic DR backups.</span></span> <span data-ttu-id="24279-210">Azure-säkerhetskopiering lagrar data i Recovery Services-valvet för långsiktig kvarhållning.</span><span class="sxs-lookup"><span data-stu-id="24279-210">Azure Backup stores the data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="24279-211">Välj den [Geo-redundant lagring (GRS)](storage-redundancy.md#geo-redundant-storage) alternativ för säkerhetskopiering Recovery Services-valvet.</span><span class="sxs-lookup"><span data-stu-id="24279-211">Choose the [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for the Backup Recovery Services vault.</span></span> <span data-ttu-id="24279-212">Som säkerställer säkerhetskopieringar som replikeras till en annan Azure-region för att skydda från regionala katastrofer.</span><span class="sxs-lookup"><span data-stu-id="24279-212">That will ensure backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="24279-213">För [ohanterade diskar](storage-about-disks-and-vhds-windows.md#unmanaged-disks), du kan använda LRS lagringstypen för IaaS-diskar, men kontrollera att Azure Backup har aktiverats med alternativet GRS för Recovery Services-valvet.</span><span class="sxs-lookup"><span data-stu-id="24279-213">For [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks), you can use the LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with the GRS option for the Recovery Services Vault.</span></span>

<span data-ttu-id="24279-214">**Om du använder den [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) alternativet för ohanterade diskar kan du fortfarande behöver programkonsekventa ögonblicksbilder för säkerhetskopiering och Katastrofåterställning.**</span><span class="sxs-lookup"><span data-stu-id="24279-214">**If you use the [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="24279-215">Du måste använda antingen [Azure Backup-tjänsten](https://azure.microsoft.com/services/backup/) eller [programkonsekventa ögonblicksbilder](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="24279-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="24279-216">Följande är en översikt över lösningar för Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-216">The following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="24279-217">Scenario</span><span class="sxs-lookup"><span data-stu-id="24279-217">Scenario</span></span> | <span data-ttu-id="24279-218">Automatisk replikering</span><span class="sxs-lookup"><span data-stu-id="24279-218">Automatic Replication</span></span> | <span data-ttu-id="24279-219">Lösning för Katastrofåterställning</span><span class="sxs-lookup"><span data-stu-id="24279-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="24279-220">*Premium-lagringsdiskar*</span><span class="sxs-lookup"><span data-stu-id="24279-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="24279-221">Lokala ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="24279-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="24279-222">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="24279-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="24279-223">*Managed Disks*</span><span class="sxs-lookup"><span data-stu-id="24279-223">*Managed Disks*</span></span> | <span data-ttu-id="24279-224">Lokala ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="24279-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="24279-225">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="24279-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="24279-226">*Ohanterad LRS diskar*</span><span class="sxs-lookup"><span data-stu-id="24279-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="24279-227">Lokala ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="24279-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="24279-228">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="24279-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="24279-229">*Ohanterad GRS diskar*</span><span class="sxs-lookup"><span data-stu-id="24279-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="24279-230">Mellan region ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="24279-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="24279-231">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="24279-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="24279-232">Programkonsekventa ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="24279-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="24279-233">*Ohanterad RA-GRS-diskar*</span><span class="sxs-lookup"><span data-stu-id="24279-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="24279-234">Mellan region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="24279-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="24279-235">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="24279-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="24279-236">Programkonsekventa ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="24279-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="24279-237">Hög tillgänglighet kan bäst av uppfylls med hjälp av hanterade diskar i en Tillgänglighetsuppsättning tillsammans med Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="24279-237">High availability can best by met through the use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="24279-238">Om du använder ohanterade diskar, kan du fortfarande använda Azure Backup för Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="24279-239">Om det inte går att använda Azure Backup kan sedan ta [programkonsekventa ögonblicksbilder](#alternative-solution-consistent-snapshots) enligt beskrivningen i ett senare avsnitt är en alternativ lösning för säkerhetskopiering och Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-239">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="24279-240">Dina val för hög tillgänglighet, säkerhetskopiering och Katastrofåterställning på programmet eller infrastrukturen kan representeras som nedan:</span><span class="sxs-lookup"><span data-stu-id="24279-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="24279-241">*Nivå*</span><span class="sxs-lookup"><span data-stu-id="24279-241">*Level*</span></span> | <span data-ttu-id="24279-242">Hög tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="24279-242">High Availability</span></span>   | <span data-ttu-id="24279-243">Säkerhetskopiering / DR</span><span class="sxs-lookup"><span data-stu-id="24279-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="24279-244">*Programmet*</span><span class="sxs-lookup"><span data-stu-id="24279-244">*Application*</span></span> | <span data-ttu-id="24279-245">SQL Always On</span><span class="sxs-lookup"><span data-stu-id="24279-245">SQL Always On</span></span> | <span data-ttu-id="24279-246">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="24279-246">Azure Backup</span></span> |
| <span data-ttu-id="24279-247">*Infrastruktur*</span><span class="sxs-lookup"><span data-stu-id="24279-247">*Infrastructure*</span></span>  | <span data-ttu-id="24279-248">Tillgänglighetsuppsättning</span><span class="sxs-lookup"><span data-stu-id="24279-248">Availability Set</span></span>  | <span data-ttu-id="24279-249">GRS med programkonsekventa ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="24279-249">GRS with consistent snapshots</span></span> |

### <a name="using-the-azure-backup-service"></a><span data-ttu-id="24279-250">Med hjälp av Azure Backup-tjänsten</span><span class="sxs-lookup"><span data-stu-id="24279-250">Using the Azure Backup Service</span></span>

<span data-ttu-id="24279-251">[Azure-säkerhetskopiering](../backup/backup-azure-vms-introduction.md) kan säkerhetskopiera dina virtuella datorer som kör Windows eller Linux till Azure Recovery Services-valvet.</span><span class="sxs-lookup"><span data-stu-id="24279-251">[Azure Backup](../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux to the Azure Recovery Services Vault.</span></span> <span data-ttu-id="24279-252">Säkerhetskopiera och återställa verksamhetskritiska data är komplicerade av att verksamhetskritiska data måste säkerhetskopieras när de program som ger data körs.</span><span class="sxs-lookup"><span data-stu-id="24279-252">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="24279-253">För att lösa det ger Azure Backup programkonsekvent säkerhetskopiering för Microsoft-arbetsbelastningar med hjälp av Volume Shadow Service (VSS) så att data skrivs korrekt till lagring.</span><span class="sxs-lookup"><span data-stu-id="24279-253">To address this, Azure Backup provides application-consistent backups for Microsoft workloads by using the Volume Shadow Service (VSS) to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="24279-254">För Linux virtuella datorer kan är endast filkonsekventa säkerhetskopior möjligt eftersom Linux inte har funktioner som motsvarar VSS.</span><span class="sxs-lookup"><span data-stu-id="24279-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent to VSS.</span></span>

![][1]

<span data-ttu-id="24279-255">När Azure Backup initierar en säkerhetskopiering på den schemalagda tiden, utlöser reservanknytning installerad på den virtuella datorn att ta en ögonblicksbild i tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="24279-255">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="24279-256">En ögonblicksbild tas tillsammans med VSS att hämta en programkonsekvent ögonblicksbild diskar i den virtuella datorn utan att behöva stänga av.</span><span class="sxs-lookup"><span data-stu-id="24279-256">A snapshot is taken in coordination with VSS to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="24279-257">Säkerhetskopiering tillägget på den virtuella datorn tömmer alla skrivningar innan du tar programkonsekvent ögonblicksbild av alla diskar.</span><span class="sxs-lookup"><span data-stu-id="24279-257">The backup extension in the VM flushes all writes before taking the consistent snapshot of all the disks.</span></span> <span data-ttu-id="24279-258">När ögonblicksbilden tas data har överförts av Azure Backup till säkerhetskopieringsvalvet.</span><span class="sxs-lookup"><span data-stu-id="24279-258">After the snapshot is taken, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="24279-259">Om du vill att säkerhetskopieringen effektivare tjänsten identifierar och överför endast block av data som har ändrats sedan den senaste säkerhetskopieringen.</span><span class="sxs-lookup"><span data-stu-id="24279-259">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed since the last backup.</span></span>


<span data-ttu-id="24279-260">Om du vill återställa kan du visa tillgängliga säkerhetskopieringar via Azure Backup och startar sedan en återställning.</span><span class="sxs-lookup"><span data-stu-id="24279-260">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="24279-261">Du kan skapa och återställa Azure-säkerhetskopieringar via den [Azure-portalen](https://portal.azure.com/), [med hjälp av PowerShell](../backup/backup-azure-vms-automation.md ), eller med hjälp av den [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="24279-261">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), [using PowerShell](../backup/backup-azure-vms-automation.md ), or using the [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="24279-262">Mer information finns i Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="24279-262">For more information, see Azure Backup.</span></span>

### <a name="steps-to-enable-backup"></a><span data-ttu-id="24279-263">Steg för att aktivera säkerhetskopiering</span><span class="sxs-lookup"><span data-stu-id="24279-263">Steps to Enable Backup</span></span>

<span data-ttu-id="24279-264">Följande steg används vanligtvis för att aktivera säkerhetskopiering av dina virtuella datorer med hjälp av den [Azure Portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="24279-264">The following steps are typically used to enable backups of your VMs using the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="24279-265">Det blir vissa varianter beroende på exakt scenario.</span><span class="sxs-lookup"><span data-stu-id="24279-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="24279-266">Referera till den [Azure Backup](../backup/backup-azure-vms-introduction.md) dokumentationen för fullständig information.</span><span class="sxs-lookup"><span data-stu-id="24279-266">Refer to the [Azure Backup](../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="24279-267">Azure Backup också [stöder virtuella datorer med hanterade diskar](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="24279-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="24279-268">Skapa ett recovery services-valv för en virtuell dator med följande steg:</span><span class="sxs-lookup"><span data-stu-id="24279-268">Create a recovery services vault for a VM using the following steps:</span></span>

    <span data-ttu-id="24279-269">a.</span><span class="sxs-lookup"><span data-stu-id="24279-269">a.</span></span>  <span data-ttu-id="24279-270">Med hjälp av den [Azure-portalen](https://portal.azure.com/), bläddra alla resurser och hittar ”Recovery Services-valv”.</span><span class="sxs-lookup"><span data-stu-id="24279-270">Using the [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="24279-271">b.</span><span class="sxs-lookup"><span data-stu-id="24279-271">b.</span></span>  <span data-ttu-id="24279-272">Klicka på Lägg till och följ stegen för att skapa ett nytt valv i samma region som den virtuella datorn på menyn Recovery Services-valv.</span><span class="sxs-lookup"><span data-stu-id="24279-272">On the Recovery Services vaults menu, click Add and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="24279-273">Till exempel om den virtuella datorn finns i USA, västra region, Välj västra USA för valvet.</span><span class="sxs-lookup"><span data-stu-id="24279-273">For example, if your VM is in West US region, pick West US for the vault.</span></span>

2.  <span data-ttu-id="24279-274">Kontrollera Storage-replikering för nyskapade valvet.</span><span class="sxs-lookup"><span data-stu-id="24279-274">Verify the Storage replication for the newly created vault.</span></span> <span data-ttu-id="24279-275">Om du vill göra detta åt valvet från bladet Recovery Services-valv och gå till inställningar eller säkerhetskopiering konfiguration.</span><span class="sxs-lookup"><span data-stu-id="24279-275">To do this, access the vault from the Recovery Services vaults blade and go to the settings/Backup Configuration.</span></span> <span data-ttu-id="24279-276">Kontrollera GRS-alternativet är markerat som standard.</span><span class="sxs-lookup"><span data-stu-id="24279-276">Ensure the GRS option is selected by default.</span></span> <span data-ttu-id="24279-277">Se till att ditt valv replikeras automatiskt till ett sekundärt datacenter.</span><span class="sxs-lookup"><span data-stu-id="24279-277">This will ensure that your vault is automatically replicated to a secondary data center.</span></span> <span data-ttu-id="24279-278">Till exempel replikeras ditt valv i USA, västra automatiskt till östra USA.</span><span class="sxs-lookup"><span data-stu-id="24279-278">For example, your vault in West US will be automatically replicated to East US.</span></span>

3.  <span data-ttu-id="24279-279">Konfigurera principen för säkerhetskopiering och välj den virtuella datorn från samma användargränssnitt.</span><span class="sxs-lookup"><span data-stu-id="24279-279">Configure the backup policy and select the VM from the same UI.</span></span>

4.  <span data-ttu-id="24279-280">Kontrollera att Backup-agenten är installerad på den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-280">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="24279-281">Om den virtuella datorn skapas med hjälp av en Azure-galleriet bild, installerat Backup-agenten redan.</span><span class="sxs-lookup"><span data-stu-id="24279-281">If your VM is created using an Azure gallery image, then the Backup agent is already installed.</span></span> <span data-ttu-id="24279-282">Annars (om du använder en anpassad avbildning), använder du instruktionerna för att [installera VM-agenten på den virtuella datorn](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="24279-282">Otherwise (that is, if you are using a custom image), use instructions to [Install the VM Agent on the virtual machine](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="24279-283">Kontrollera att den virtuella datorn tillåter nätverksanslutningar för säkerhetskopieringstjänsten ska fungera.</span><span class="sxs-lookup"><span data-stu-id="24279-283">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="24279-284">Följ dessa instruktioner för [nätverksanslutningar](../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="24279-284">Follow these instructions for [Network connectivity](../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="24279-285">När ovanstående steg har slutförts, körs säkerhetskopieringen med regelbundna intervall som anges i principen för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="24279-285">Once the above steps are completed, the backup will run at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="24279-286">Om det behövs kan du utlösa den första säkerhetskopieringen manuellt från valvet instrumentpanelen på Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="24279-286">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="24279-287">För att automatisera Azure Backup med hjälp av skript, referera till [PowerShell-cmdletar för säkerhetskopiering](../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="24279-287">For automating Azure Backup using scripts, please refer to [PowerShell cmdlets for VM backup](../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="24279-288">Steg för återställning</span><span class="sxs-lookup"><span data-stu-id="24279-288">Steps for Recovery</span></span>

<span data-ttu-id="24279-289">Om du behöver reparera eller återskapa en virtuell dator kan du återställa den virtuella datorn från någon av återställningspunkter för säkerhetskopiering i valvet.</span><span class="sxs-lookup"><span data-stu-id="24279-289">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="24279-290">Det finns ett par olika alternativ för att utföra återställningen:</span><span class="sxs-lookup"><span data-stu-id="24279-290">There are a couple of different options for performing the recovery:</span></span>

1.  <span data-ttu-id="24279-291">Du kan skapa en ny virtuell dator som en tidpunkt i representation av den virtuella datorn med säkerhetskopierade.</span><span class="sxs-lookup"><span data-stu-id="24279-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="24279-292">Du kan återställa diskarna och sedan använda mallen för den virtuella datorn för att anpassa och återskapa den återställda virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-292">You can restore the disks and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="24279-293">Se anvisningar för att [Använd Azure-portalen för att återställa virtuella datorer](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="24279-293">See instructions to [Use Azure portal to restore virtual machines](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="24279-294">Dokumentet beskriver även hur för återställning av säkerhetskopierade virtuella datorer till parad datacenter med hjälp av din geo-redundant säkerhetskopieringsvalvet vid en katastrof på primära datacenter.</span><span class="sxs-lookup"><span data-stu-id="24279-294">The document also explains the specific steps for restoring backed-up VMs to the paired data center using your geo-redundant backup vault in the case of a disaster at the primary data center.</span></span> <span data-ttu-id="24279-295">I så fall använder Azure Backup beräknings-tjänsten från den sekundära regionen för att skapa den återställda virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-295">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="24279-296">Du kan också använda PowerShell för [återställa en virtuell dator](../backup/backup-azure-vms-automation.md#restore-an-azure-vm) eller för [skapar en ny virtuell dator från återställts diskar](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="24279-296">You can also use PowerShell for [restoring a VM](../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="24279-297">Alternativa lösningen: Programkonsekventa ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="24279-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="24279-298">Om det inte går att använda Azure Backup Service kan implementera du din egen mekanism för säkerhetskopiering med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="24279-298">If you are unable to use the Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="24279-299">Det är svårt att skapa programkonsekventa ögonblicksbilder för alla diskar som används av en virtuell dator och replikerar sedan dessa ögonblicksbilder till en annan region.</span><span class="sxs-lookup"><span data-stu-id="24279-299">It is complicated to create consistent snapshots for all disks used by a VM and then replicate those snapshots to another region.</span></span> <span data-ttu-id="24279-300">Därför överväger Azure utnyttja Backup-tjänsten ett bättre alternativ än att skapa en anpassad lösning.</span><span class="sxs-lookup"><span data-stu-id="24279-300">For this reason, Azure considers leveraging the Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="24279-301">Om du använder GRS-RA-GRS-lagring för diskar, replikeras ögonblicksbilder automatiskt till ett sekundärt datacenter.</span><span class="sxs-lookup"><span data-stu-id="24279-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated to a secondary data center.</span></span> <span data-ttu-id="24279-302">Om du använder LRS lagring för diskar måste replikera data själv.</span><span class="sxs-lookup"><span data-stu-id="24279-302">If you use LRS storage for disks, you will need to replicate the data yourself.</span></span> <span data-ttu-id="24279-303">Mer information finns i [säkerhetskopiera Azure ohanterade Virtuella diskar med inkrementell ögonblicksbilder](storage-incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="24279-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

<span data-ttu-id="24279-304">En ögonblicksbild är en representation av ett objekt vid en viss tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="24279-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="24279-305">En ögonblicksbild påförs fakturering för inkrementell storleken på data den innehåller.</span><span class="sxs-lookup"><span data-stu-id="24279-305">A snapshot will incur billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="24279-306">Mer information finns i [skapa en ögonblicksbild av blob](storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="24279-306">For more information, see [Create a blob snapshot](storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-the-vm-is-running"></a><span data-ttu-id="24279-307">Skapa ögonblicksbilder medan den virtuella datorn körs</span><span class="sxs-lookup"><span data-stu-id="24279-307">Creating snapshots while the VM is running</span></span>

<span data-ttu-id="24279-308">Medan du kan ta en ögonblicksbild när som helst om den virtuella datorn körs, fortfarande är data som strömmas till diskar och ögonblicksbilder kan innehålla delvis åtgärder som rör sig.</span><span class="sxs-lookup"><span data-stu-id="24279-308">While you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks, and the snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="24279-309">Även om det finns flera diskar, kan ögonblicksbilder av olika diskar ha uppstått vid olika tidpunkter, vilket innebär att dessa ögonblicksbilder inte kan samordnas.</span><span class="sxs-lookup"><span data-stu-id="24279-309">Also, if there are several disks involved, the snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="24279-310">Detta är särskilt problematiskt för stripe-volymer vars filer kan skadas om ändringar som gjordes under säkerhetskopieringen.</span><span class="sxs-lookup"><span data-stu-id="24279-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="24279-311">Om du vill undvika detta genomföra säkerhetskopieringsprocessen följande steg:</span><span class="sxs-lookup"><span data-stu-id="24279-311">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="24279-312">Låsa alla diskar</span><span class="sxs-lookup"><span data-stu-id="24279-312">Freeze all the disks</span></span>

2.  <span data-ttu-id="24279-313">Rensa alla väntande skrivningar</span><span class="sxs-lookup"><span data-stu-id="24279-313">Flush all the pending writes</span></span>

3.  <span data-ttu-id="24279-314">Sedan [skapa en ögonblicksbild av blob](storage-blob-snapshots.md) för alla diskar</span><span class="sxs-lookup"><span data-stu-id="24279-314">Then, [create a blob snapshot](storage-blob-snapshots.md) for all the disks</span></span>

<span data-ttu-id="24279-315">Vissa Windows-program som SQL Server innehåller en samordnad säkerhetskopiering funktion via VSS skapa programkonsekventa säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="24279-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS to create application-consistent backups.</span></span> <span data-ttu-id="24279-316">Du kan använda ett verktyg som fsfreeze för samordning av diskar som kommer att tillhandahålla filkonsekventa säkerhetskopieringar, men inte programkonsekventa ögonblicksbilder i Linux.</span><span class="sxs-lookup"><span data-stu-id="24279-316">On Linux, you can use a tool like fsfreeze for coordinating the disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="24279-317">Den här processen är komplicerad, så och du bör använda [Azure Backup](../backup/backup-azure-vms-introduction.md) eller en lösning för säkerhetskopiering från tredje part som redan implementerar det här.</span><span class="sxs-lookup"><span data-stu-id="24279-317">This process is complicated, so and you should consider using [Azure Backup](../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="24279-318">Ovanstående procedur resulterar i en samling samordnade ögonblicksbilder för alla Virtuella diskar, som representerar en specifik tidpunkt i vy för den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-318">The above process will result in a collection of coordinated snapshots for all the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="24279-319">Det här är en återställningspunkt för säkerhetskopiering för den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-319">This is a backup restore point for the VM.</span></span> <span data-ttu-id="24279-320">Du kan upprepa processen med schemalagda intervall för att skapa regelbundna säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="24279-320">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="24279-321">Nedan följer stegen för att [kopiera säkerhetskopieringar till en annan region](#copy-the-snapshots-to-another-region) för Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-321">See below for the steps to [copy the backups to another region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="24279-322">Skapa ögonblicksbilder medan den virtuella datorn är offline</span><span class="sxs-lookup"><span data-stu-id="24279-322">Creating snapshots while the VM is offline</span></span>

<span data-ttu-id="24279-323">Ett annat alternativ för att skapa konsekvent säkerhetskopior stänger av den virtuella datorn och tar blob ögonblicksbilder av varje disk.</span><span class="sxs-lookup"><span data-stu-id="24279-323">Another option to create consistent backups is shutting down the VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="24279-324">Detta är enklare än koordinerande ögonblicksbilder av en aktiv virtuell dator, men det krävs några minuter stillestånd.</span><span class="sxs-lookup"><span data-stu-id="24279-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="24279-325">Följ dessa steg för den här processen:</span><span class="sxs-lookup"><span data-stu-id="24279-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="24279-326">Stäng av den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-326">Shut down the VM.</span></span>

2. <span data-ttu-id="24279-327">Skapa en ögonblicksbild av varje VHD-blobben som tar bara några sekunder.</span><span class="sxs-lookup"><span data-stu-id="24279-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="24279-328">Du kan använda för att skapa en ögonblicksbild, [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), eller ett Azure Storage-klientbibliotek som [Storage-klientbiblioteket för .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="24279-328">To create a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), the [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of the Azure Storage Client Libraries such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="24279-329">Starta den virtuella datorn, vilket avslutar avbrottstiden.</span><span class="sxs-lookup"><span data-stu-id="24279-329">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="24279-330">Vanligtvis hela processen har slutförts inom några minuter.</span><span class="sxs-lookup"><span data-stu-id="24279-330">Typically the entire process completes within a few minutes.</span></span>

<span data-ttu-id="24279-331">Den här processen ger en uppsättning programkonsekventa ögonblicksbilder för alla diskar, vilket ger en återställningspunkt för säkerhetskopiering för den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="24279-331">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span> <span data-ttu-id="24279-332">Nedan visas stegen för att kopiera ögonblicksbilder till en annan region för Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-332">See below for the steps to copy the snapshots to another region for DR.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="24279-333">Kopiera ögonblicksbilder till en annan region</span><span class="sxs-lookup"><span data-stu-id="24279-333">Copy the snapshots to another region</span></span>

<span data-ttu-id="24279-334">Skapa ögonblicksbilder enbart räcker inte för Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="24279-334">Creation of the snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="24279-335">Du måste också replikeras säkerhetskopiorna av ögonblicksbilder till en annan region.</span><span class="sxs-lookup"><span data-stu-id="24279-335">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="24279-336">Om du använder GRS eller RA-GRS för diskarna sedan replikeras ögonblicksbilderna till den sekundära regionen automatiskt.</span><span class="sxs-lookup"><span data-stu-id="24279-336">If you are using GRS or RA-GRS for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="24279-337">Det kan finnas några minuter för fördröjning innan replikeringen och om primära Datacenter kraschar innan ögonblicksbilderna Slutför replikering kan du inte få åtkomst till ögonblicksbilder från den sekundära datacentralen.</span><span class="sxs-lookup"><span data-stu-id="24279-337">There can be a few minutes of lag before the replication, and if the primary data center goes down before the snapshots finish replicating, you will not be able to access the snapshots from the secondary data center.</span></span> <span data-ttu-id="24279-338">Sannolikheten för det här är liten.</span><span class="sxs-lookup"><span data-stu-id="24279-338">The likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="24279-339">Bara har diskarna i ett GRS eller RA-GRS-konto skydda inte den virtuella datorn från katastrofer.</span><span class="sxs-lookup"><span data-stu-id="24279-339">Only having the disks in a GRS or RA-GRS account does not protect the VM from disasters.</span></span> <span data-ttu-id="24279-340">Du måste också skapa samordnade ögonblicksbilder eller använda Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="24279-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="24279-341">Detta är nödvändigt att återställa en virtuell dator till ett konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="24279-341">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="24279-342">Om du använder LRS, måste du kopiera ögonblicksbilder till ett annat lagringskonto omedelbart efter att skapa ögonblicksbilden.</span><span class="sxs-lookup"><span data-stu-id="24279-342">If you are using LRS, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="24279-343">Kopiera mål kan vara ett LRS-lagringskonto i en annan region, vilket resulterar i kopian som i en fjärransluten region.</span><span class="sxs-lookup"><span data-stu-id="24279-343">The copy target could be an LRS storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="24279-344">Du kan också kopiera ögonblicksbilden till en RA-GRS-lagringskonto i samma region.</span><span class="sxs-lookup"><span data-stu-id="24279-344">You can also copy the snapshot to an RA-GRS storage account in the same region.</span></span> <span data-ttu-id="24279-345">I det här fallet replikeras ögonblicksbilden lazy till den fjärranslutna sekundära regionen.</span><span class="sxs-lookup"><span data-stu-id="24279-345">In this case, the snapshot will be lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="24279-346">Säkerhetskopian är skyddat från katastrofer på den primära platsen när kopieringen och replikeringen är klar.</span><span class="sxs-lookup"><span data-stu-id="24279-346">Your backup is protected from disasters at the primary site once the copying and replication is complete.</span></span>

<span data-ttu-id="24279-347">Om du vill kopiera ditt inkrementell ögonblicksbilder för Katastrofåterställning effektivt läser du anvisningarna i [säkerhetskopiera Azure ohanterade Virtuella diskar med inkrementell ögonblicksbilder](storage-incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="24279-347">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

![][2]

### <a name="recovery-from-snapshots"></a><span data-ttu-id="24279-348">Återställning från ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="24279-348">Recovery from Snapshots</span></span>

<span data-ttu-id="24279-349">Kopiera den för att skapa en ny blob för att hämta en ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="24279-349">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="24279-350">Om du vill kopiera ögonblicksbilden från det primära kontot, kan du kopiera ögonblicksbilden över till ögonblicksbilden grundläggande blob därför återställa disken till ögonblicksbilden; Detta kallas att främja ögonblicksbilden.</span><span class="sxs-lookup"><span data-stu-id="24279-350">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot, thus reverting the disk to the snapshot; this is known as promoting the snapshot.</span></span> <span data-ttu-id="24279-351">Om du kopierar ögonblicksbild av säkerhetskopian från ett sekundärt konto (för RA-GRS), måste den kopieras till primära konto.</span><span class="sxs-lookup"><span data-stu-id="24279-351">If you are copying the snapshot backup from a secondary account (in the case of RA-GRS), it must be copied to a primary account.</span></span> <span data-ttu-id="24279-352">Du kan kopiera en ögonblicksbild [med hjälp av PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) eller med hjälp av verktyget AzCopy.</span><span class="sxs-lookup"><span data-stu-id="24279-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using the AzCopy utility.</span></span> <span data-ttu-id="24279-353">Mer information finns i [överföra data med kommandoradsverktyget Azcopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="24279-353">For more information, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="24279-354">För virtuella datorer med flera diskar, måste du kopiera alla ögonblicksbilder som ingår i samma samordnade återställningspunkt.</span><span class="sxs-lookup"><span data-stu-id="24279-354">In the case of VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="24279-355">Du kan använda blobar för att återskapa den virtuella datorn med hjälp av mallen för den virtuella datorn när du kopierar ögonblicksbilder till skrivbara VHD-blobbar.</span><span class="sxs-lookup"><span data-stu-id="24279-355">Once you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="24279-356">Andra alternativ</span><span class="sxs-lookup"><span data-stu-id="24279-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="24279-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="24279-357">SQL Server</span></span>

<span data-ttu-id="24279-358">SQL Server som körs på en virtuell dator har sin egen inbyggda funktioner för att säkerhetskopiera SQL Server-databas till Azure Blob-lagring eller en filresurs.</span><span class="sxs-lookup"><span data-stu-id="24279-358">SQL Server running in a VM has its own built-in capabilities to backup your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="24279-359">Om lagringskontot är GRS eller RA-GRS, kan du komma åt säkerhetskopieringarna i storage-konto sekundärt Datacenter vid katastrofåterställning, med samma begränsningar som beskrivits tidigare.</span><span class="sxs-lookup"><span data-stu-id="24279-359">If the storage account is GRS or RA-GRS, you can access those backups in the storage account’s secondary data center in the event of a disaster, with the same restrictions as discussed previously.</span></span> <span data-ttu-id="24279-360">Mer information finns i [säkerhetskopiering och återställning av SQL Server i Azure Virtual Machines](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="24279-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="24279-361">Utöver säkerhetskopiering och återställning, [SQL Server alltid på Tillgänglighetsgrupper](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) kan upprätthålla sekundära repliker av databaser för att avsevärt minska tid som disaster recovery.</span><span class="sxs-lookup"><span data-stu-id="24279-361">In addition to backup and restore, [SQL Server Always On Availability Groups](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases to greatly reduce the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="24279-362">Andra överväganden</span><span class="sxs-lookup"><span data-stu-id="24279-362">Other considerations</span></span>

<span data-ttu-id="24279-363">Den här artikeln har beskrivs hur du säkerhetskopierar och ta ögonblicksbilder av dina virtuella datorer och deras diskar för att stödja katastrofåterställning och hur du använder dem för att återställa.</span><span class="sxs-lookup"><span data-stu-id="24279-363">This article has discussed how to backup or take snapshots of your VMs and their disks to support disaster recovery, and how to use those to recover.</span></span> <span data-ttu-id="24279-364">Många använder mallar för att skapa deras virtuella datorer och andra infrastruktur i Azure med Azure Resource Manager-modellen.</span><span class="sxs-lookup"><span data-stu-id="24279-364">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="24279-365">Du kan använda en mall för att skapa en virtuell dator som har samma konfiguration varje gång.</span><span class="sxs-lookup"><span data-stu-id="24279-365">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="24279-366">Om du använder anpassade avbildningar för att skapa dina virtuella datorer, måste du också kontrollera bilderna skyddas med en RA-GRS-konto för att lagra dem.</span><span class="sxs-lookup"><span data-stu-id="24279-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account to store them.</span></span>

<span data-ttu-id="24279-367">Säkerhetskopieringsprocessen kan därför vara en kombination av två saker:</span><span class="sxs-lookup"><span data-stu-id="24279-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="24279-368">Säkerhetskopiera data (diskar)</span><span class="sxs-lookup"><span data-stu-id="24279-368">Backup the data (disks)</span></span>
2. <span data-ttu-id="24279-369">Säkerhetskopiera konfiguration (mallar, anpassade avbildningar)</span><span class="sxs-lookup"><span data-stu-id="24279-369">Backup the configuration (templates, custom images)</span></span>

<span data-ttu-id="24279-370">Beroende på säkerhetskopiering alternativ du väljer du kan behöva hantera säkerhetskopiering av både data och konfiguration eller säkerhetskopieringstjänsten kan hantera all som du.</span><span class="sxs-lookup"><span data-stu-id="24279-370">Depending on the backup option you choose, you may have to handle the backup of both the data and the configuration, or the backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-the-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="24279-371">Tillägg – förstå konsekvenserna med LRS-, GRS- och RA-GRS</span><span class="sxs-lookup"><span data-stu-id="24279-371">Appendix - Understanding the impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="24279-372">Det finns tre typer av dataredundans som du bör tänka på avseende katastrofåterställning – lokalt redundant (LRS), geo-redundant (GRS), för storage-konton i Azure, eller geo-redundant med läsa åtkomst (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="24279-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="24279-373">Lokalt behåller Redundant lagring (LRS) tre kopior av data i samma datacenter.</span><span class="sxs-lookup"><span data-stu-id="24279-373">Locally Redundant Storage (LRS) retains three copies of the data in the same data center.</span></span> <span data-ttu-id="24279-374">När du skriver data uppdateras alla tre kopior innan lyckas returneras till anroparen, så att du vet att de är identiska.</span><span class="sxs-lookup"><span data-stu-id="24279-374">When writing the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="24279-375">Disken är skyddat från lokala fel eftersom det är mycket troligt att det skulle påverkas alla tre kopior på samma gång.</span><span class="sxs-lookup"><span data-stu-id="24279-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at the same time.</span></span> <span data-ttu-id="24279-376">LRS, om det finns ingen geo-redundans, så att disken inte är skyddat från katastrofalt fel som kan påverka en hela data center eller lagring enhet.</span><span class="sxs-lookup"><span data-stu-id="24279-376">In the case of LRS, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="24279-377">Med GRS och RA-GRS tre kopior av dina data finns kvar i den primära region (valt) och tre fler kopior av dina data bevaras i en motsvarande sekundär region (anges av Azure).</span><span class="sxs-lookup"><span data-stu-id="24279-377">With GRS and RA-GRS, three copies of your data are retained in the primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="24279-378">Om du lagrar data i USA, västra kommer data replikeras till östra USA.</span><span class="sxs-lookup"><span data-stu-id="24279-378">For example, if you store data in West US, the data will be replicated to East US.</span></span> <span data-ttu-id="24279-379">Detta görs asynkront, och det finns en kort fördröjning mellan uppdateringar till primära och sekundära.</span><span class="sxs-lookup"><span data-stu-id="24279-379">This is done asynchronously, and there is a small delay between updates to the primary and secondary.</span></span> <span data-ttu-id="24279-380">Repliker av diskar på den sekundära platsen är konsekvent på grundval av per disk (med fördröjning) men repliker av flera aktiva diskar är inte synkroniserade **med varandra**.</span><span class="sxs-lookup"><span data-stu-id="24279-380">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="24279-381">Om du vill ha konsekvent repliker över flera diskar, behövs programkonsekventa ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="24279-381">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="24279-382">Den största skillnaden mellan GRS och RA-GRS är med RA-GRS, du kan läsa den alternativa kopian när som helst.</span><span class="sxs-lookup"><span data-stu-id="24279-382">The main difference between GRS and RA-GRS is that with RA-GRS, you can read the secondary copy at any time.</span></span> <span data-ttu-id="24279-383">Om det finns ett problem som återger data i den primära regionen otillgänglig, gör Azure-teamet allt för att återställa åtkomsten.</span><span class="sxs-lookup"><span data-stu-id="24279-383">If there is a problem that renders the data in the primary region inaccessible, the Azure team will make every effort to restore access.</span></span> <span data-ttu-id="24279-384">När den primära servern är nere, om du har aktiverat RA-GRS kan du komma åt data i sekundära datacentret.</span><span class="sxs-lookup"><span data-stu-id="24279-384">While the primary is down, if you have RA-GRS enabled, you can access the data in the secondary data center.</span></span> <span data-ttu-id="24279-385">Därför, om du planerar att läsa från repliken när den primära servern inte är tillgänglig, sedan RA-GRS bör övervägas.</span><span class="sxs-lookup"><span data-stu-id="24279-385">Therefore, if you plan to read from the replica while the primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="24279-386">Om det visar sig vara en betydande avbrott, kan Azure-teamet utlösa en geo-redundans och ändra de primära DNS-posterna så att den pekar till den sekundära lagringsplatsen.</span><span class="sxs-lookup"><span data-stu-id="24279-386">If it turns out to be a significant outage, the Azure team may trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="24279-387">Om du har antingen GRS eller RA-GRS aktiverad, kan du nu komma åt data i den region som används för att vara sekundärt.</span><span class="sxs-lookup"><span data-stu-id="24279-387">At this point, if you have either GRS or RA-GRS enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="24279-388">Med andra ord om ditt lagringskonto är GRS och det finns ett problem, du kan komma åt den sekundära lagringsplatsen endast om det finns en geo-redundans.</span><span class="sxs-lookup"><span data-stu-id="24279-388">In other words, if your storage account is GRS and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="24279-389">Mer information finns i [vad du ska göra om ett Azure Storage-avbrott inträffar](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="24279-389">For more information, see [What to do if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="24279-390">Observera att Microsoft kontrollerar om det uppstår redundans.</span><span class="sxs-lookup"><span data-stu-id="24279-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="24279-391">Redundans inte styrs per lagringskonto, därför fattas inte av enskilda kunder.</span><span class="sxs-lookup"><span data-stu-id="24279-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="24279-392">Om du vill implementera Haveriberedskap för specifika storage-konton eller virtuella diskar, måste du använda de tekniker som beskrivs tidigare i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="24279-392">To implement Disaster Recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>



[1]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png
[2]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png