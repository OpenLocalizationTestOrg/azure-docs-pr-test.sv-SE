---
title: aaaManaging samtidighet i Microsoft Azure Storage
description: "Hur toomanage samtidighet för hello Blob, kön, tabell, och Filtjänster"
services: storage
documentationcenter: 
author: jasontang501
manager: tadb
editor: tysonn
ms.assetid: cc6429c4-23ee-46e3-b22d-50dd68bd4680
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/11/2017
ms.author: jasontang501
ms.openlocfilehash: 277fbbb880906da6be67b2267ed5c8e457455bd1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="managing-concurrency-in-microsoft-azure-storage"></a><span data-ttu-id="248a6-103">Hantera samtidighet i Microsoft Azure Storage</span><span class="sxs-lookup"><span data-stu-id="248a6-103">Managing Concurrency in Microsoft Azure Storage</span></span>
## <a name="overview"></a><span data-ttu-id="248a6-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="248a6-104">Overview</span></span>
<span data-ttu-id="248a6-105">Moderna Internet-baserade program har vanligtvis flera användare visa och uppdatera data samtidigt.</span><span class="sxs-lookup"><span data-stu-id="248a6-105">Modern Internet based applications usually have multiple users viewing and updating data simultaneously.</span></span> <span data-ttu-id="248a6-106">Detta kräver programmet utvecklare toothink noggrant om hur tooprovide en förutsägbar uppleva tootheir slutanvändare, särskilt för scenarier där flera användare kan uppdatera hello samma data.</span><span class="sxs-lookup"><span data-stu-id="248a6-106">This requires application developers toothink carefully about how tooprovide a predictable experience tootheir end users, particularly for scenarios where multiple users can update hello same data.</span></span> <span data-ttu-id="248a6-107">Det finns tre huvudsakliga databassamtidighet strategier beaktas vanligtvis utvecklare:</span><span class="sxs-lookup"><span data-stu-id="248a6-107">There are three main data concurrency strategies developers will typically consider:</span></span>  

1. <span data-ttu-id="248a6-108">Optimistisk samtidighet – ett program som utför en uppdatering som en del av dess uppdatering verifierar om hello data har ändrats sedan programmet hello senast läsa data.</span><span class="sxs-lookup"><span data-stu-id="248a6-108">Optimistic concurrency – An application performing an update will as part of its update verify if hello data has changed since hello application last read that data.</span></span> <span data-ttu-id="248a6-109">Till exempel om två användare som visar en wiki-sida gör en uppdatering toohello sidan samma hello wiki-plattformen måste se till att andra update hello inte över första uppdatering av hello- och båda användare att förstå om uppdateringen lyckades eller inte.</span><span class="sxs-lookup"><span data-stu-id="248a6-109">For example, if two users viewing a wiki page make an update toohello same page then hello wiki platform must ensure that hello second update does not overwrite hello first update – and that both users understand whether their update was successful or not.</span></span> <span data-ttu-id="248a6-110">Den här strategin används oftast i webbprogram.</span><span class="sxs-lookup"><span data-stu-id="248a6-110">This strategy is most often used in web applications.</span></span>
2. <span data-ttu-id="248a6-111">Sämsta samtidighet – ett program som söker tooperform en uppdatering tar ett lås på ett objekt som förhindrar att andra användare uppdaterar hello data förrän hello Lås släpps.</span><span class="sxs-lookup"><span data-stu-id="248a6-111">Pessimistic concurrency – An application looking tooperform an update will take a lock on an object preventing other users from updating hello data until hello lock is released.</span></span> <span data-ttu-id="248a6-112">Till exempel i över-/ underordnade data replikering scenario där endast hello master utför uppdateringar innehåller hello master vanligtvis ett exklusivt lås för en längre tid på hello data tooensure utan någon annan kan uppdatera den.</span><span class="sxs-lookup"><span data-stu-id="248a6-112">For example, in a master/slave data replication scenario where only hello master will perform updates hello master will typically hold an exclusive lock for an extended period of time on hello data tooensure no one else can update it.</span></span>
3. <span data-ttu-id="248a6-113">Den senaste skrivaren wins – en metod som gör att alla update operations tooproceed utan att verifiera om något annat program har uppdaterats hello data eftersom programmet hello först läsa hello data.</span><span class="sxs-lookup"><span data-stu-id="248a6-113">Last writer wins – An approach that allows any update operations tooproceed without verifying if any other application has updated hello data since hello application first read hello data.</span></span> <span data-ttu-id="248a6-114">Den här strategin (eller brist på en formell strategi) används vanligtvis när data är partitionerad så att det finns inga sannolikheten att flera användare kommer åt hello samma data.</span><span class="sxs-lookup"><span data-stu-id="248a6-114">This strategy (or lack of a formal strategy) is usually used where data is partitioned in such a way that there is no likelihood that multiple users will access hello same data.</span></span> <span data-ttu-id="248a6-115">Det kan också vara användbara där tillfällig dataströmmar bearbetas.</span><span class="sxs-lookup"><span data-stu-id="248a6-115">It can also be useful where short-lived data streams are being processed.</span></span>  

<span data-ttu-id="248a6-116">Den här artikeln innehåller en översikt över hur hello Azure Storage-plattformen förenklar utvecklingen som har förstklassigt stöd för alla tre strategierna samtidighet.</span><span class="sxs-lookup"><span data-stu-id="248a6-116">This article provides an overview of how hello Azure Storage platform simplifies development by providing first class support for all three of these concurrency strategies.</span></span>  

## <a name="azure-storage--simplifies-cloud-development"></a><span data-ttu-id="248a6-117">Azure-lagring – förenklar utvecklingen i molnet</span><span class="sxs-lookup"><span data-stu-id="248a6-117">Azure Storage – Simplifies Cloud Development</span></span>
<span data-ttu-id="248a6-118">hello Azure storage-tjänst stöder alla tre strategier, men det är olika i dess möjlighet tooprovide fullständigt stöd för bästa och sämsta samtidighet eftersom den var utformad tooembrace en stark konsekvens-modell som garanterar att om Hej Storage service incheckningar data infoga eller uppdatera alla ytterligare åtkomst till toothat data kommer att se hello uppdatera senaste åtgärden.</span><span class="sxs-lookup"><span data-stu-id="248a6-118">hello Azure storage service supports all three strategies, although it is distinctive in its ability tooprovide full support for optimistic and pessimistic concurrency because it was designed tooembrace a strong consistency model which guarantees that when hello Storage service commits a data insert or update operation all further accesses toothat data will see hello latest update.</span></span> <span data-ttu-id="248a6-119">Storage-plattformar som använder en modell för slutliga konsekvensen har en fördröjning mellan när en skrivning utförs av en användare och när hello uppdaterade data kan ses av andra användare således vilket komplicerar utvecklingen av klientprogram i ordning tooprevent inkonsekvenser från påverkar slutanvändarna.</span><span class="sxs-lookup"><span data-stu-id="248a6-119">Storage platforms that use an eventual consistency model have a lag between when a write is performed by one user and when hello updated data can be seen by other users thus complicating development of client applications in order tooprevent inconsistencies from affecting end users.</span></span>  

<span data-ttu-id="248a6-120">Dessutom tooselecting en lämplig samtidighet strategi utvecklare bör också känna till hur en plattform för lagring isolerar ändringar – särskilt ändringar toohello samma objekt över transaktioner.</span><span class="sxs-lookup"><span data-stu-id="248a6-120">In addition tooselecting an appropriate concurrency strategy developers should also be aware of how a storage platform isolates changes – particularly changes toohello same object across transactions.</span></span> <span data-ttu-id="248a6-121">hello Azure storage-tjänst använder ögonblicksbilden isolering tooallow läsa operations toohappen samtidigt skrivåtgärder inom en partition.</span><span class="sxs-lookup"><span data-stu-id="248a6-121">hello Azure storage service uses snapshot isolation tooallow read operations toohappen concurrently with write operations within a single partition.</span></span> <span data-ttu-id="248a6-122">Till skillnad från andra isoleringsnivåer garanterar ögonblicksbildisolering att alla Läs finns en programkonsekvent ögonblicksbild av hello data även när uppdateringar sker – i princip genom att returnera hello senast allokerat värdena medan en uppdateringstransaktion bearbetas.</span><span class="sxs-lookup"><span data-stu-id="248a6-122">Unlike other isolation levels, snapshot isolation guarantees that all reads see a consistent snapshot of hello data even while updates are occurring – essentially by returning hello last committed values while an update transaction is being processed.</span></span>  

## <a name="managing-concurrency-in-blob-storage"></a><span data-ttu-id="248a6-123">Hantera samtidighet i Blob storage</span><span class="sxs-lookup"><span data-stu-id="248a6-123">Managing Concurrency in Blob storage</span></span>
<span data-ttu-id="248a6-124">Du kan välja toouse antingen bästa eller sämsta samtidighet modeller toomanage åtkomst tooblobs och behållare i hello blob-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="248a6-124">You can opt toouse either optimistic or pessimistic concurrency models toomanage access tooblobs and containers in hello blob service.</span></span> <span data-ttu-id="248a6-125">Om du inte uttryckligen anger en strategi senast skriver wins är hello standard.</span><span class="sxs-lookup"><span data-stu-id="248a6-125">If you do not explicitly specify a strategy last writes wins is hello default.</span></span>  

### <a name="optimistic-concurrency-for-blobs-and-containers"></a><span data-ttu-id="248a6-126">Optimistisk samtidighet för blobbar och behållare</span><span class="sxs-lookup"><span data-stu-id="248a6-126">Optimistic concurrency for blobs and containers</span></span>
<span data-ttu-id="248a6-127">hello lagringstjänsten tilldelar ett identifierare tooevery objekt som lagras.</span><span class="sxs-lookup"><span data-stu-id="248a6-127">hello Storage service assigns an identifier tooevery object stored.</span></span> <span data-ttu-id="248a6-128">Den här identifieraren uppdateras varje gång en update-åtgärd utförs på ett objekt.</span><span class="sxs-lookup"><span data-stu-id="248a6-128">This identifier is updated every time an update operation is performed on an object.</span></span> <span data-ttu-id="248a6-129">hello identifierare returneras toohello klienten inom ramen för en HTTP GET-svar med hello ETag (entitetstaggen)-huvudet som har definierats inom hello HTTP-protokollet.</span><span class="sxs-lookup"><span data-stu-id="248a6-129">hello identifier is returned toohello client as part of an HTTP GET response using hello ETag (entity tag) header that is defined within hello HTTP protocol.</span></span> <span data-ttu-id="248a6-130">En användare som utför en uppdatering på sådana objekt kan skicka i hello ursprungliga ETag tillsammans med ett villkorat huvud tooensure som en uppdatering görs bara om ett visst villkor har uppfyllts – i det här fallet hello villkoret är ett ”If-Match”-huvud som kräver hello lagring Tjänsten tooensure hello värde hello ETag som anges i begäran om uppdatering hello är hello samma som lagras i hello Storage-tjänst.</span><span class="sxs-lookup"><span data-stu-id="248a6-130">A user performing an update on such an object can send in hello original ETag along with a conditional header tooensure that an update will only occur if a certain condition has been met – in this case hello condition is an "If-Match" header which requires hello Storage Service tooensure hello value of hello ETag specified in hello update request is hello same as that stored in hello Storage Service.</span></span>  

<span data-ttu-id="248a6-131">hello beskrivning av den här processen är följande:</span><span class="sxs-lookup"><span data-stu-id="248a6-131">hello outline of this process is as follows:</span></span>  

1. <span data-ttu-id="248a6-132">Hämta en blob från hello lagringstjänsten, hello svaret innehåller ett ETag-rubriken i HTTP-värde som anger hello nuvarande version av hello objekt i hello storage-tjänst.</span><span class="sxs-lookup"><span data-stu-id="248a6-132">Retrieve a blob from hello storage service, hello response includes an HTTP ETag Header value that identifies hello current version of hello object in hello storage service.</span></span>
2. <span data-ttu-id="248a6-133">När du uppdaterar hello blob inkluderar hello ETag-värde som du fick i steg 1 i hello **If-Match** villkorat huvud för hello-begäran som du skickar toohello service.</span><span class="sxs-lookup"><span data-stu-id="248a6-133">When you update hello blob, include hello ETag value you received in step 1 in hello **If-Match** conditional header of hello request you send toohello service.</span></span>
3. <span data-ttu-id="248a6-134">hello tjänsten jämför hello ETag-värde i hello begäran med hello aktuella ETag-värde hello-blob.</span><span class="sxs-lookup"><span data-stu-id="248a6-134">hello service compares hello ETag value in hello request with hello current ETag value of hello blob.</span></span>
4. <span data-ttu-id="248a6-135">Om hello aktuella ETag-värde hello blob är en annan version än hello ETag i hello **If-Match** villkorat huvud i begäran hello hello-tjänsten returnerar en 412 fel toohello klient.</span><span class="sxs-lookup"><span data-stu-id="248a6-135">If hello current ETag value of hello blob is a different version than hello ETag in hello **If-Match** conditional header in hello request, hello service returns a 412 error toohello client.</span></span> <span data-ttu-id="248a6-136">Detta anger toohello klienten en annan process har uppdaterat hello blob eftersom hello klienten hämtades.</span><span class="sxs-lookup"><span data-stu-id="248a6-136">This indicates toohello client that another process has updated hello blob since hello client retrieved it.</span></span>
5. <span data-ttu-id="248a6-137">Om hello aktuella hello ETag hello blob-värdet är samma version som hello ETag i hello **If-Match** villkorat huvud i begäran hello hello-tjänsten utför hello begärde åtgärden och uppdateringar hello hello blob aktuella ETag-värde tooshow att den har skapat en ny version.</span><span class="sxs-lookup"><span data-stu-id="248a6-137">If hello current ETag value of hello blob is hello same version as hello ETag in hello **If-Match** conditional header in hello request, hello service performs hello requested operation and updates hello current ETag value of hello blob tooshow that it has created a new version.</span></span>  

<span data-ttu-id="248a6-138">hello följande C# utdrag (med hello Storage-klientbiblioteket 4.2.0) visar ett enkelt exempel på hur tooconstruct en **If-Match AccessCondition** baserat på hello ETag-värde som öppnas från hello egenskaperna för en blob som var tidigare hämtade eller infogade.</span><span class="sxs-lookup"><span data-stu-id="248a6-138">hello following C# snippet (using hello Client Storage Library 4.2.0) shows a simple example of how tooconstruct an **If-Match AccessCondition** based on hello ETag value that is accessed from hello properties of a blob that was previously either retrieved or inserted.</span></span> <span data-ttu-id="248a6-139">Därefter använder hello **AccessCondition** objekt när den uppdaterar hello blob: hello **AccessCondition** objekt lägger till hello **If-Match** huvud toohello begäran.</span><span class="sxs-lookup"><span data-stu-id="248a6-139">It then uses hello **AccessCondition** object when it updating hello blob: hello **AccessCondition** object adds hello **If-Match** header toohello request.</span></span> <span data-ttu-id="248a6-140">Om en annan process har uppdaterat hello blob, returnerar hello blob-tjänsten ett statusmeddelande HTTP 412 (villkor misslyckades).</span><span class="sxs-lookup"><span data-stu-id="248a6-140">If another process has updated hello blob, hello blob service returns an HTTP 412 (Precondition Failed) status message.</span></span> <span data-ttu-id="248a6-141">Du kan hämta hello fullständigt exempel här: [hantera samtidighet med hjälp av Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="248a6-141">You can download hello full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>  

```csharp
// Retrieve hello ETag from hello newly created blob
// Etag is already populated as UploadText should cause a PUT Blob call
// toostorage blob service which returns hello etag in response.
string orignalETag = blockBlob.Properties.ETag;

// This code simulates an update by a third party.
string helloText = "Blob updated by a third party.";

// No etag, provided so orignal blob is overwritten (thus generating a new etag)
blockBlob.UploadText(helloText);
Console.WriteLine("Blob updated. Updated ETag = {0}",
blockBlob.Properties.ETag);

// Now try tooupdate hello blob using hello orignal ETag provided when hello blob was created
try
{
    Console.WriteLine("Trying tooupdate blob using orignal etag toogenerate if-match access condition");
    blockBlob.UploadText(helloText,accessCondition:
    AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
    {
        Console.WriteLine("Precondition failure as expected. Blob's orignal etag no longer matches");
        // TODO: client can decide on how it wants toohandle hello 3rd party updated content.
    }
    else
        throw;
}  
```

<span data-ttu-id="248a6-142">hello lagringstjänsten omfattar också stöd för ytterligare villkorlig huvuden som **If-Modified-Since**, **If-Unmodified-Since** och **If-None-Match** samt kombinationer av dessa.</span><span class="sxs-lookup"><span data-stu-id="248a6-142">hello Storage Service also includes support for additional conditional headers such as **If-Modified-Since**, **If-Unmodified-Since** and **If-None-Match** as well as combinations thereof.</span></span> <span data-ttu-id="248a6-143">Mer information finns i [ange villkorlig huvuden för Blob-tjänståtgärder](http://msdn.microsoft.com/library/azure/dd179371.aspx) på MSDN.</span><span class="sxs-lookup"><span data-stu-id="248a6-143">For more information see [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) on MSDN.</span></span>  

<span data-ttu-id="248a6-144">hello följande tabell sammanfattas hello behållaren åtgärder som accepterar villkorlig huvuden som **If-Match** hello begäran och som returnerar ett ETag-värde i hello svar.</span><span class="sxs-lookup"><span data-stu-id="248a6-144">hello following table summarizes hello container operations that accept conditional headers such as **If-Match** in hello request and that return an ETag value in hello response.</span></span>  

| <span data-ttu-id="248a6-145">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="248a6-145">Operation</span></span> | <span data-ttu-id="248a6-146">Returnerar behållare ETag-värde</span><span class="sxs-lookup"><span data-stu-id="248a6-146">Returns Container ETag value</span></span> | <span data-ttu-id="248a6-147">Accepterar villkorlig rubriker</span><span class="sxs-lookup"><span data-stu-id="248a6-147">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="248a6-148">Skapa en behållare</span><span class="sxs-lookup"><span data-stu-id="248a6-148">Create Container</span></span> |<span data-ttu-id="248a6-149">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-149">Yes</span></span> |<span data-ttu-id="248a6-150">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-150">No</span></span> |
| <span data-ttu-id="248a6-151">Hämta egenskaper för behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-151">Get Container Properties</span></span> |<span data-ttu-id="248a6-152">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-152">Yes</span></span> |<span data-ttu-id="248a6-153">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-153">No</span></span> |
| <span data-ttu-id="248a6-154">Hämta Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-154">Get Container Metadata</span></span> |<span data-ttu-id="248a6-155">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-155">Yes</span></span> |<span data-ttu-id="248a6-156">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-156">No</span></span> |
| <span data-ttu-id="248a6-157">Ange Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-157">Set Container Metadata</span></span> |<span data-ttu-id="248a6-158">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-158">Yes</span></span> |<span data-ttu-id="248a6-159">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-159">Yes</span></span> |
| <span data-ttu-id="248a6-160">Hämta behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="248a6-160">Get Container ACL</span></span> |<span data-ttu-id="248a6-161">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-161">Yes</span></span> |<span data-ttu-id="248a6-162">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-162">No</span></span> |
| <span data-ttu-id="248a6-163">Ange behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="248a6-163">Set Container ACL</span></span> |<span data-ttu-id="248a6-164">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-164">Yes</span></span> |<span data-ttu-id="248a6-165">Ja (*)</span><span class="sxs-lookup"><span data-stu-id="248a6-165">Yes (*)</span></span> |
| <span data-ttu-id="248a6-166">Ta bort behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-166">Delete Container</span></span> |<span data-ttu-id="248a6-167">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-167">No</span></span> |<span data-ttu-id="248a6-168">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-168">Yes</span></span> |
| <span data-ttu-id="248a6-169">Lånet behållare</span><span class="sxs-lookup"><span data-stu-id="248a6-169">Lease Container</span></span> |<span data-ttu-id="248a6-170">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-170">Yes</span></span> |<span data-ttu-id="248a6-171">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-171">Yes</span></span> |
| <span data-ttu-id="248a6-172">Lista över Blobbar</span><span class="sxs-lookup"><span data-stu-id="248a6-172">List Blobs</span></span> |<span data-ttu-id="248a6-173">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-173">No</span></span> |<span data-ttu-id="248a6-174">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-174">No</span></span> |

<span data-ttu-id="248a6-175">(*) hello behörigheter som definieras av SetContainerACL cachelagras och uppdateringar toothese behörighet ta 30 sekunder toopropagate under vilka uppdateringar inte är garanterat toobe konsekvent.</span><span class="sxs-lookup"><span data-stu-id="248a6-175">(*) hello permissions defined by SetContainerACL are cached and updates toothese permissions take 30 seconds toopropagate during which period updates are not guaranteed toobe consistent.</span></span>  

<span data-ttu-id="248a6-176">hello följande tabell sammanfattas hello blob-åtgärder som accepterar villkorlig huvuden som **If-Match** hello begäran och som returnerar ett ETag-värde i hello svar.</span><span class="sxs-lookup"><span data-stu-id="248a6-176">hello following table summarizes hello blob operations that accept conditional headers such as **If-Match** in hello request and that return an ETag value in hello response.</span></span>

| <span data-ttu-id="248a6-177">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="248a6-177">Operation</span></span> | <span data-ttu-id="248a6-178">Returnerar ETag-värde</span><span class="sxs-lookup"><span data-stu-id="248a6-178">Returns ETag value</span></span> | <span data-ttu-id="248a6-179">Accepterar villkorlig rubriker</span><span class="sxs-lookup"><span data-stu-id="248a6-179">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="248a6-180">Placera Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-180">Put Blob</span></span> |<span data-ttu-id="248a6-181">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-181">Yes</span></span> |<span data-ttu-id="248a6-182">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-182">Yes</span></span> |
| <span data-ttu-id="248a6-183">Hämta Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-183">Get Blob</span></span> |<span data-ttu-id="248a6-184">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-184">Yes</span></span> |<span data-ttu-id="248a6-185">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-185">Yes</span></span> |
| <span data-ttu-id="248a6-186">Hämta Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="248a6-186">Get Blob Properties</span></span> |<span data-ttu-id="248a6-187">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-187">Yes</span></span> |<span data-ttu-id="248a6-188">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-188">Yes</span></span> |
| <span data-ttu-id="248a6-189">Ange Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="248a6-189">Set Blob Properties</span></span> |<span data-ttu-id="248a6-190">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-190">Yes</span></span> |<span data-ttu-id="248a6-191">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-191">Yes</span></span> |
| <span data-ttu-id="248a6-192">Hämta Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="248a6-192">Get Blob Metadata</span></span> |<span data-ttu-id="248a6-193">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-193">Yes</span></span> |<span data-ttu-id="248a6-194">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-194">Yes</span></span> |
| <span data-ttu-id="248a6-195">Ange Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="248a6-195">Set Blob Metadata</span></span> |<span data-ttu-id="248a6-196">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-196">Yes</span></span> |<span data-ttu-id="248a6-197">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-197">Yes</span></span> |
| <span data-ttu-id="248a6-198">Lånet Blob (*)</span><span class="sxs-lookup"><span data-stu-id="248a6-198">Lease Blob (*)</span></span> |<span data-ttu-id="248a6-199">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-199">Yes</span></span> |<span data-ttu-id="248a6-200">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-200">Yes</span></span> |
| <span data-ttu-id="248a6-201">Snapshot-Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-201">Snapshot Blob</span></span> |<span data-ttu-id="248a6-202">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-202">Yes</span></span> |<span data-ttu-id="248a6-203">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-203">Yes</span></span> |
| <span data-ttu-id="248a6-204">Kopiera Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-204">Copy Blob</span></span> |<span data-ttu-id="248a6-205">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-205">Yes</span></span> |<span data-ttu-id="248a6-206">Ja (för käll- och blob)</span><span class="sxs-lookup"><span data-stu-id="248a6-206">Yes (for source and destination blob)</span></span> |
| <span data-ttu-id="248a6-207">Avbryt kopiera Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-207">Abort Copy Blob</span></span> |<span data-ttu-id="248a6-208">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-208">No</span></span> |<span data-ttu-id="248a6-209">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-209">No</span></span> |
| <span data-ttu-id="248a6-210">Ta bort blobben</span><span class="sxs-lookup"><span data-stu-id="248a6-210">Delete Blob</span></span> |<span data-ttu-id="248a6-211">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-211">No</span></span> |<span data-ttu-id="248a6-212">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-212">Yes</span></span> |
| <span data-ttu-id="248a6-213">Placera Block</span><span class="sxs-lookup"><span data-stu-id="248a6-213">Put Block</span></span> |<span data-ttu-id="248a6-214">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-214">No</span></span> |<span data-ttu-id="248a6-215">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-215">No</span></span> |
| <span data-ttu-id="248a6-216">Placera Blockeringslista</span><span class="sxs-lookup"><span data-stu-id="248a6-216">Put Block List</span></span> |<span data-ttu-id="248a6-217">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-217">Yes</span></span> |<span data-ttu-id="248a6-218">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-218">Yes</span></span> |
| <span data-ttu-id="248a6-219">Hämta listan över blockerade</span><span class="sxs-lookup"><span data-stu-id="248a6-219">Get Block List</span></span> |<span data-ttu-id="248a6-220">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-220">Yes</span></span> |<span data-ttu-id="248a6-221">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-221">No</span></span> |
| <span data-ttu-id="248a6-222">Placera sida</span><span class="sxs-lookup"><span data-stu-id="248a6-222">Put Page</span></span> |<span data-ttu-id="248a6-223">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-223">Yes</span></span> |<span data-ttu-id="248a6-224">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-224">Yes</span></span> |
| <span data-ttu-id="248a6-225">Get-sidintervall</span><span class="sxs-lookup"><span data-stu-id="248a6-225">Get Page Ranges</span></span> |<span data-ttu-id="248a6-226">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-226">Yes</span></span> |<span data-ttu-id="248a6-227">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-227">Yes</span></span> |

<span data-ttu-id="248a6-228">(*) Lånet Blob ändras inte hello ETag på en blob.</span><span class="sxs-lookup"><span data-stu-id="248a6-228">(*) Lease Blob does not change hello ETag on a blob.</span></span>  

### <a name="pessimistic-concurrency-for-blobs"></a><span data-ttu-id="248a6-229">Sämsta samtidighet för blobbar</span><span class="sxs-lookup"><span data-stu-id="248a6-229">Pessimistic concurrency for blobs</span></span>
<span data-ttu-id="248a6-230">toolock en blob för exklusiv användning, kan du hämta en [lån](http://msdn.microsoft.com/library/azure/ee691972.aspx) på den.</span><span class="sxs-lookup"><span data-stu-id="248a6-230">toolock a blob for exclusive use, you can acquire a [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) on it.</span></span> <span data-ttu-id="248a6-231">När du skaffa en leasing anger du hur länge du behöver hello lån: Detta kan vara för mellan 15 too60 sekunder eller oändlig vilka belopp tooan exklusivt lås.</span><span class="sxs-lookup"><span data-stu-id="248a6-231">When you acquire a lease, you specify for how long you need hello lease: this can be for between 15 too60 seconds or infinite which amounts tooan exclusive lock.</span></span> <span data-ttu-id="248a6-232">Du kan förnya ett begränsat lån tooextend den, och du kan släppa ett lån när du är klar med den.</span><span class="sxs-lookup"><span data-stu-id="248a6-232">You can renew a finite lease tooextend it, and you can release any lease when you are finished with it.</span></span> <span data-ttu-id="248a6-233">hello blob-tjänsten Frigör ändligt lån automatiskt när de upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="248a6-233">hello blob service automatically releases finite leases when they expire.</span></span>  

<span data-ttu-id="248a6-234">Lån Aktivera synkronisering av olika strategier toobe stöds, inklusive exklusiv skrivning / delade skrivskyddade, exklusiv skrivning / exklusiv Läs- och delade skrivning / läsa samtidigt.</span><span class="sxs-lookup"><span data-stu-id="248a6-234">Leases enable different synchronization strategies toobe supported, including exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read.</span></span> <span data-ttu-id="248a6-235">Om ett lån finns tillämpar hello lagringstjänsten exklusiv skrivningar (put, ange och delete-åtgärder) men säkerställt ensamrätt för läsåtgärder kräver hello developer tooensure att alla program använder ett lån-ID och att endast en klient i taget har ett giltigt lease-ID.</span><span class="sxs-lookup"><span data-stu-id="248a6-235">Where a lease exists hello storage service enforces exclusive writes (put, set and delete operations) however ensuring exclusivity for read operations requires hello developer tooensure that all client applications use a lease ID and that only one client at a time has a valid lease ID.</span></span> <span data-ttu-id="248a6-236">Läs-och skrivåtgärder som inte innehåller ett lån ID resultat i delade läsningar.</span><span class="sxs-lookup"><span data-stu-id="248a6-236">Read operations that do not include a lease ID result in shared reads.</span></span>  

<span data-ttu-id="248a6-237">hello visar följande C# fragment ett exempel för att erhålla ett exklusiv adresslån i 30 sekunder på en blob, uppdatera hello innehållet i hello blob och släppa hello lån.</span><span class="sxs-lookup"><span data-stu-id="248a6-237">hello following C# snippet shows an example of acquiring an exclusive lease for 30 seconds on a blob, updating hello content of hello blob, and then releasing hello lease.</span></span> <span data-ttu-id="248a6-238">Om det finns redan ett giltigt lån på hello blob när du försöker tooacquire ett nytt lån, returnerar hello blob-tjänsten ett resultat för ”HTTP (409) konflikt” status.</span><span class="sxs-lookup"><span data-stu-id="248a6-238">If there is already a valid lease on hello blob when you try tooacquire a new lease, hello blob service returns an "HTTP (409) Conflict" status result.</span></span> <span data-ttu-id="248a6-239">hello fragment nedan använder en **AccessCondition** objekt tooencapsulate hello lease-information när den är en begäran tooupdate hello blob med hello storage-tjänst.</span><span class="sxs-lookup"><span data-stu-id="248a6-239">hello snippet below uses an **AccessCondition** object tooencapsulate hello lease information when it makes a request tooupdate hello blob in hello storage service.</span></span>  <span data-ttu-id="248a6-240">Du kan hämta hello fullständigt exempel här: [hantera samtidighet med hjälp av Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="248a6-240">You can download hello full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
// Acquire lease for 15 seconds
string lease = blockBlob.AcquireLease(TimeSpan.FromSeconds(15), null);
Console.WriteLine("Blob lease acquired. Lease = {0}", lease);

// Update blob using lease. This operation will succeed
const string helloText = "Blob updated";
var accessCondition = AccessCondition.GenerateLeaseCondition(lease);
blockBlob.UploadText(helloText, accessCondition: accessCondition);
Console.WriteLine("Blob updated using an exclusive lease");

//Simulate third party update tooblob without lease
try
{
    // Below operation will fail as no valid lease provided
    Console.WriteLine("Trying tooupdate blob without valid lease");
    blockBlob.UploadText("Update without lease, will fail");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
        Console.WriteLine("Precondition failure as expected. Blob's lease does not match");
    else
        throw;
}  
```

<span data-ttu-id="248a6-241">Om du försöker en skrivåtgärd i en blob-lånade utan att skicka hello lån ID misslyckas hello begäran 412 fel.</span><span class="sxs-lookup"><span data-stu-id="248a6-241">If you attempt a write operation on a leased blob without passing hello lease ID, hello request fails with a 412 error.</span></span> <span data-ttu-id="248a6-242">Observera att om hello lånet går ut innan du anropar hello **UploadText** metoden men du fortfarande skicka hello lease-ID, hello begäran också misslyckas med en **412** fel.</span><span class="sxs-lookup"><span data-stu-id="248a6-242">Note that if hello lease expires before calling hello **UploadText** method but you still pass hello lease ID, hello request also fails with a **412** error.</span></span> <span data-ttu-id="248a6-243">Mer information om hur du hanterar lånetid för förfallodatum och lease-ID: n finns hello [lån Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST-dokumentationen.</span><span class="sxs-lookup"><span data-stu-id="248a6-243">For more information about managing lease expiry times and lease ids, see hello [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST documentation.</span></span>  

<span data-ttu-id="248a6-244">hello kan följande blob-åtgärder använda lån toomanage sämsta samtidighet:</span><span class="sxs-lookup"><span data-stu-id="248a6-244">hello following blob operations can use leases toomanage pessimistic concurrency:</span></span>  

* <span data-ttu-id="248a6-245">Placera Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-245">Put Blob</span></span>
* <span data-ttu-id="248a6-246">Hämta Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-246">Get Blob</span></span>
* <span data-ttu-id="248a6-247">Hämta Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="248a6-247">Get Blob Properties</span></span>
* <span data-ttu-id="248a6-248">Ange Blob-egenskaper</span><span class="sxs-lookup"><span data-stu-id="248a6-248">Set Blob Properties</span></span>
* <span data-ttu-id="248a6-249">Hämta Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="248a6-249">Get Blob Metadata</span></span>
* <span data-ttu-id="248a6-250">Ange Blobbmetadata</span><span class="sxs-lookup"><span data-stu-id="248a6-250">Set Blob Metadata</span></span>
* <span data-ttu-id="248a6-251">Ta bort blobben</span><span class="sxs-lookup"><span data-stu-id="248a6-251">Delete Blob</span></span>
* <span data-ttu-id="248a6-252">Placera Block</span><span class="sxs-lookup"><span data-stu-id="248a6-252">Put Block</span></span>
* <span data-ttu-id="248a6-253">Placera Blockeringslista</span><span class="sxs-lookup"><span data-stu-id="248a6-253">Put Block List</span></span>
* <span data-ttu-id="248a6-254">Hämta listan över blockerade</span><span class="sxs-lookup"><span data-stu-id="248a6-254">Get Block List</span></span>
* <span data-ttu-id="248a6-255">Placera sida</span><span class="sxs-lookup"><span data-stu-id="248a6-255">Put Page</span></span>
* <span data-ttu-id="248a6-256">Get-sidintervall</span><span class="sxs-lookup"><span data-stu-id="248a6-256">Get Page Ranges</span></span>
* <span data-ttu-id="248a6-257">Ögonblicksbild Blob - lån-ID: T är valfri om ett lån finns</span><span class="sxs-lookup"><span data-stu-id="248a6-257">Snapshot Blob - lease ID optional if a lease exists</span></span>
* <span data-ttu-id="248a6-258">Kopiera Blob - lån ID krävs om det finns ett lån på hello mål-blob</span><span class="sxs-lookup"><span data-stu-id="248a6-258">Copy Blob - lease ID required if a lease exists on hello destination blob</span></span>
* <span data-ttu-id="248a6-259">Avbryt kopiera Blob - lån ID krävs om det finns en oändlig lån på hello mål-blob</span><span class="sxs-lookup"><span data-stu-id="248a6-259">Abort Copy Blob - lease ID required if an infinite lease exists on hello destination blob</span></span>
* <span data-ttu-id="248a6-260">Lånet Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-260">Lease Blob</span></span>  

### <a name="pessimistic-concurrency-for-containers"></a><span data-ttu-id="248a6-261">Sämsta samtidighet för behållare</span><span class="sxs-lookup"><span data-stu-id="248a6-261">Pessimistic concurrency for containers</span></span>
<span data-ttu-id="248a6-262">Lån på behållare aktivera hello samma synkronisering strategier toobe stöds som på blobbar (exklusiv Skriv- / delade skrivskyddade, exklusiv skrivning / exklusiv Läs- och delade skrivning / samtidigt läsa) men till skillnad från BLOB storage-tjänst för hello endast tillämpar ensamrätt på delete-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="248a6-262">Leases on containers enable hello same synchronization strategies toobe supported as on blobs (exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read) however unlike blobs hello storage service only enforces exclusivity on delete operations.</span></span> <span data-ttu-id="248a6-263">en klient måste innehålla hello aktiv livslängd ID med hello raderingsbegäran toodelete en behållare med en aktiv livslängd.</span><span class="sxs-lookup"><span data-stu-id="248a6-263">toodelete a container with an active lease, a client must include hello active lease ID with hello delete request.</span></span> <span data-ttu-id="248a6-264">Alla andra åtgärder i behållaren lyckas på lånade behållaren utan att inkludera hello lån ID då de delas åtgärder.</span><span class="sxs-lookup"><span data-stu-id="248a6-264">All other container operations succeed on a leased container without including hello lease ID in which case they are shared operations.</span></span> <span data-ttu-id="248a6-265">Om ensamrätt av update (put eller set) eller läsåtgärder krävs ska utvecklare Kontrollera alla klienter använder ett lån-ID och som endast en klient i taget har ett giltigt lease-ID.</span><span class="sxs-lookup"><span data-stu-id="248a6-265">If exclusivity of update (put or set) or read operations is required then developers should ensure all clients use a lease ID and that only one client at a time has a valid lease ID.</span></span>  

<span data-ttu-id="248a6-266">hello kan följande åtgärder på en behållare använda lån toomanage sämsta samtidighet:</span><span class="sxs-lookup"><span data-stu-id="248a6-266">hello following container operations can use leases toomanage pessimistic concurrency:</span></span>  

* <span data-ttu-id="248a6-267">Ta bort behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-267">Delete Container</span></span>
* <span data-ttu-id="248a6-268">Hämta egenskaper för behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-268">Get Container Properties</span></span>
* <span data-ttu-id="248a6-269">Hämta Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-269">Get Container Metadata</span></span>
* <span data-ttu-id="248a6-270">Ange Metadata för behållaren</span><span class="sxs-lookup"><span data-stu-id="248a6-270">Set Container Metadata</span></span>
* <span data-ttu-id="248a6-271">Hämta behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="248a6-271">Get Container ACL</span></span>
* <span data-ttu-id="248a6-272">Ange behållar-ACL</span><span class="sxs-lookup"><span data-stu-id="248a6-272">Set Container ACL</span></span>
* <span data-ttu-id="248a6-273">Lånet behållare</span><span class="sxs-lookup"><span data-stu-id="248a6-273">Lease Container</span></span>  

<span data-ttu-id="248a6-274">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="248a6-274">For more information see:</span></span>  

* [<span data-ttu-id="248a6-275">Ange villkorlig huvuden för Blob-tjänståtgärder</span><span class="sxs-lookup"><span data-stu-id="248a6-275">Specifying Conditional Headers for Blob Service Operations</span></span>](http://msdn.microsoft.com/library/azure/dd179371.aspx)
* [<span data-ttu-id="248a6-276">Lånet behållare</span><span class="sxs-lookup"><span data-stu-id="248a6-276">Lease Container</span></span>](http://msdn.microsoft.com/library/azure/jj159103.aspx)
* [<span data-ttu-id="248a6-277">Lånet Blob</span><span class="sxs-lookup"><span data-stu-id="248a6-277">Lease Blob </span></span>](http://msdn.microsoft.com/library/azure/ee691972.aspx)

## <a name="managing-concurrency-in-hello-table-service"></a><span data-ttu-id="248a6-278">Hantera samtidighet i hello tabelltjänst</span><span class="sxs-lookup"><span data-stu-id="248a6-278">Managing Concurrency in hello Table Service</span></span>
<span data-ttu-id="248a6-279">Hej tabelltjänsten använder Optimistisk samtidighet kontrollerar som hello standardbeteendet när du arbetar med entiteter, till skillnad från hello blob-tjänsten där du måste uttryckligen välja tooperform Optimistisk samtidighet kontroller.</span><span class="sxs-lookup"><span data-stu-id="248a6-279">hello table service uses optimistic concurrency checks as hello default behavior when you are working with entities, unlike hello blob service where you must explicitly choose tooperform optimistic concurrency checks.</span></span> <span data-ttu-id="248a6-280">hello andra skillnaden mellan hello tabell och blob-tjänster är att du kan endast hantera hello samtidighet beteendet för entiteter medan hello blob-tjänsten kan du hantera hello samtidighet på både behållare och blobbar.</span><span class="sxs-lookup"><span data-stu-id="248a6-280">hello other difference between hello table and blob services is that you can only manage hello concurrency behavior of entities whereas with hello blob service you can manage hello concurrency of both containers and blobs.</span></span>  

<span data-ttu-id="248a6-281">Du kan använda hello ETag-värde som du får när hello tabelltjänsten returnerar en entitet toouse Optimistisk samtidighet och toocheck om en annan process har ändrat en entitet eftersom hämtades från hello table storage-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="248a6-281">toouse optimistic concurrency and toocheck if another process modified an entity since you retrieved it from hello table storage service, you can use hello ETag value you receive when hello table service returns an entity.</span></span> <span data-ttu-id="248a6-282">hello beskrivning av den här processen är följande:</span><span class="sxs-lookup"><span data-stu-id="248a6-282">hello outline of this process is as follows:</span></span>  

1. <span data-ttu-id="248a6-283">Hämta en entitet från hello table storage-tjänsten, hello svaret innehåller ett ETag-värde som anger hello aktuella identifierare som är associerad med den entiteten i hello storage-tjänst.</span><span class="sxs-lookup"><span data-stu-id="248a6-283">Retrieve an entity from hello table storage service, hello response includes an ETag value that identifies hello current identifier associated with that entity in hello storage service.</span></span>
2. <span data-ttu-id="248a6-284">När du uppdaterar hello entiteten innehåller hello ETag-värde som du fick i steg 1 i hello obligatoriska **If-Match** huvudet i hello-begäran som du skickar toohello service.</span><span class="sxs-lookup"><span data-stu-id="248a6-284">When you update hello entity, include hello ETag value you received in step 1 in hello mandatory **If-Match** header of hello request you send toohello service.</span></span>
3. <span data-ttu-id="248a6-285">hello tjänsten jämför hello ETag-värde i hello begäran med hello aktuella ETag-värde hello entitet.</span><span class="sxs-lookup"><span data-stu-id="248a6-285">hello service compares hello ETag value in hello request with hello current ETag value of hello entity.</span></span>
4. <span data-ttu-id="248a6-286">Om hello aktuella ETag-värde hello entitet skiljer sig hello ETag i hello obligatoriska **If-Match** huvudet i begäran hello hello-tjänsten returnerar en 412 fel toohello klient.</span><span class="sxs-lookup"><span data-stu-id="248a6-286">If hello current ETag value of hello entity is different than hello ETag in hello mandatory **If-Match** header in hello request, hello service returns a 412 error toohello client.</span></span> <span data-ttu-id="248a6-287">Detta anger toohello klienten en annan process har uppdaterat hello entiteten eftersom hello klienten hämtades.</span><span class="sxs-lookup"><span data-stu-id="248a6-287">This indicates toohello client that another process has updated hello entity since hello client retrieved it.</span></span>
5. <span data-ttu-id="248a6-288">Om hello aktuella ETag-värde hello entiteten är hello samma som hello ETag i hello obligatoriska **If-Match** huvudet i begäran hello eller hello **If-Match** huvudet innehåller hello jokertecknet (*) hello-tjänsten Utför hello begärde åtgärden och uppdateringar hello aktuella ETag-värde hello entiteten tooshow den har uppdaterats.</span><span class="sxs-lookup"><span data-stu-id="248a6-288">If hello current ETag value of hello entity is hello same as hello ETag in hello mandatory **If-Match** header in hello request or hello **If-Match** header contains hello wildcard character (*), hello service performs hello requested operation and updates hello current ETag value of hello entity tooshow that it has been updated.</span></span>  

<span data-ttu-id="248a6-289">Observera att hello tabelltjänsten till skillnad från hello blob-tjänsten kräver hello klienten tooinclude en **If-Match** huvudet i begäranden om att uppdatera.</span><span class="sxs-lookup"><span data-stu-id="248a6-289">Note that unlike hello blob service, hello table service requires hello client tooinclude an **If-Match** header in update requests.</span></span> <span data-ttu-id="248a6-290">Det är dock möjligt tooforce en ovillkorlig uppdatera (senaste skrivaren WINS-strategi) och kringgå samtidighet kontrollerar om hello klienten anger hello **If-Match** huvud jokertecken toohello (*) i hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="248a6-290">However, it is possible tooforce an unconditional update (last writer wins strategy) and bypass concurrency checks if hello client sets hello **If-Match** header toohello wildcard character (*) in hello request.</span></span>  

<span data-ttu-id="248a6-291">hello följande C# fragment visar en kundentitet som skapades tidigare antingen eller hämtas med deras e-postadress som uppdateras.</span><span class="sxs-lookup"><span data-stu-id="248a6-291">hello following C# snippet shows a customer entity that was previously either created or retrieved having their email address updated.</span></span> <span data-ttu-id="248a6-292">hello inledande infoga eller hämta åtgärden lagrar hello ETag-värde i hello kunden objekt och eftersom hello används hello samma objektinstansen när den körs hello ersättningsåtgärden, skickar automatiskt hello ETag-värdet tillbaka toohello tabellen service aktiverar hello service toocheck för samtidighet överträdelser.</span><span class="sxs-lookup"><span data-stu-id="248a6-292">hello initial insert or retrieve operation stores hello ETag value in hello customer object, and because hello sample uses hello same object instance when it executes hello replace operation, it automatically sends hello ETag value back toohello table service, enabling hello service toocheck for concurrency violations.</span></span> <span data-ttu-id="248a6-293">Om en annan process har uppdaterat hello entiteten i table storage, returnerar hello-tjänsten ett statusmeddelande HTTP 412 (villkor misslyckades).</span><span class="sxs-lookup"><span data-stu-id="248a6-293">If another process has updated hello entity in table storage, hello service returns an HTTP 412 (Precondition Failed) status message.</span></span>  <span data-ttu-id="248a6-294">Du kan hämta hello fullständigt exempel här: [hantera samtidighet med hjälp av Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="248a6-294">You can download hello full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
try
{
    customer.Email = "updatedEmail@contoso.org";
    TableOperation replaceCustomer = TableOperation.Replace(customer);
    customerTable.Execute(replaceCustomer);
    Console.WriteLine("Replace operation succeeded.");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == 412)
        Console.WriteLine("Optimistic concurrency violation – entity has changed since it was retrieved.");
    else
        throw;
}  
```

<span data-ttu-id="248a6-295">tooexplicitly inaktivera hello simultankontroll, bör du ange hello **ETag** -egenskapen för hello **medarbetare** objekt för ”*” innan du kan köra hello ersättningsåtgärden.</span><span class="sxs-lookup"><span data-stu-id="248a6-295">tooexplicitly disable hello concurrency check, you should set hello **ETag** property of hello **employee** object too"*" before you execute hello replace operation.</span></span>  

```csharp
customer.ETag = "*";  
```

<span data-ttu-id="248a6-296">hello följande tabell visas hur hello tabellåtgärder entitet använder ETag-värden:</span><span class="sxs-lookup"><span data-stu-id="248a6-296">hello following table summarizes how hello table entity operations use ETag values:</span></span>

| <span data-ttu-id="248a6-297">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="248a6-297">Operation</span></span> | <span data-ttu-id="248a6-298">Returnerar ETag-värde</span><span class="sxs-lookup"><span data-stu-id="248a6-298">Returns ETag value</span></span> | <span data-ttu-id="248a6-299">Kräver If-Match huvudet i begäran</span><span class="sxs-lookup"><span data-stu-id="248a6-299">Requires If-Match request header</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="248a6-300">Fråga entiteter</span><span class="sxs-lookup"><span data-stu-id="248a6-300">Query Entities</span></span> |<span data-ttu-id="248a6-301">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-301">Yes</span></span> |<span data-ttu-id="248a6-302">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-302">No</span></span> |
| <span data-ttu-id="248a6-303">Infoga entitet</span><span class="sxs-lookup"><span data-stu-id="248a6-303">Insert Entity</span></span> |<span data-ttu-id="248a6-304">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-304">Yes</span></span> |<span data-ttu-id="248a6-305">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-305">No</span></span> |
| <span data-ttu-id="248a6-306">Uppdatera entitet</span><span class="sxs-lookup"><span data-stu-id="248a6-306">Update Entity</span></span> |<span data-ttu-id="248a6-307">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-307">Yes</span></span> |<span data-ttu-id="248a6-308">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-308">Yes</span></span> |
| <span data-ttu-id="248a6-309">Sammanfoga entitet</span><span class="sxs-lookup"><span data-stu-id="248a6-309">Merge Entity</span></span> |<span data-ttu-id="248a6-310">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-310">Yes</span></span> |<span data-ttu-id="248a6-311">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-311">Yes</span></span> |
| <span data-ttu-id="248a6-312">Ta bort entiteten</span><span class="sxs-lookup"><span data-stu-id="248a6-312">Delete Entity</span></span> |<span data-ttu-id="248a6-313">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-313">No</span></span> |<span data-ttu-id="248a6-314">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-314">Yes</span></span> |
| <span data-ttu-id="248a6-315">Infoga eller ersätta en entitet</span><span class="sxs-lookup"><span data-stu-id="248a6-315">Insert or Replace Entity</span></span> |<span data-ttu-id="248a6-316">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-316">Yes</span></span> |<span data-ttu-id="248a6-317">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-317">No</span></span> |
| <span data-ttu-id="248a6-318">Infoga- eller Merge-entitet</span><span class="sxs-lookup"><span data-stu-id="248a6-318">Insert or Merge Entity</span></span> |<span data-ttu-id="248a6-319">Ja</span><span class="sxs-lookup"><span data-stu-id="248a6-319">Yes</span></span> |<span data-ttu-id="248a6-320">Nej</span><span class="sxs-lookup"><span data-stu-id="248a6-320">No</span></span> |

<span data-ttu-id="248a6-321">Observera att hello **infoga eller ersätta entiteten** och **Insert- eller Merge-entiteten** operations vill *inte* utföra alla kontroller av samtidighet eftersom de inte skicka en toohello för ETag-värde tabelltjänsten.</span><span class="sxs-lookup"><span data-stu-id="248a6-321">Note that hello **Insert or Replace Entity** and **Insert or Merge Entity** operations do *not* perform any concurrency checks because they do not send an ETag value toohello table service.</span></span>  

<span data-ttu-id="248a6-322">I allmänhet utvecklare som använder tabeller bör förlitar sig på Optimistisk samtidighet när du utvecklar skalbara program.</span><span class="sxs-lookup"><span data-stu-id="248a6-322">In general developers using tables should rely on optimistic concurrency when developing scalable applications.</span></span> <span data-ttu-id="248a6-323">Om sämsta låsning krävs en metod som utvecklare vidta när åtkomst till tabeller är tooassign avsedda blob för varje tabell och försök tootake ett lån på hello blob innan du arbetar hello tabell.</span><span class="sxs-lookup"><span data-stu-id="248a6-323">If pessimistic locking is needed, one approach developers can take when accessing Tables is tooassign a designated blob for each table and try tootake a lease on hello blob before operating on hello table.</span></span> <span data-ttu-id="248a6-324">Den här metoden kräver hello programmet tooensure alla dataåtkomst sökvägar hämta hello lån tidigare toooperating för hello tabellen.</span><span class="sxs-lookup"><span data-stu-id="248a6-324">This approach does require hello application tooensure all data access paths obtain hello lease prior toooperating on hello table.</span></span> <span data-ttu-id="248a6-325">Observera även att hello minsta lånetid är 15 sekunder som kräver noggrant övervägande för skalbarhet.</span><span class="sxs-lookup"><span data-stu-id="248a6-325">You should also note that hello minimum lease time is 15 seconds which requires careful consideration for scalability.</span></span>  

<span data-ttu-id="248a6-326">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="248a6-326">For more information see:</span></span>  

* [<span data-ttu-id="248a6-327">Åtgärder på enheter</span><span class="sxs-lookup"><span data-stu-id="248a6-327">Operations on Entities</span></span>](http://msdn.microsoft.com/library/azure/dd179375.aspx)  

## <a name="managing-concurrency-in-hello-queue-service"></a><span data-ttu-id="248a6-328">Hantera samtidighet i hello kötjänsten</span><span class="sxs-lookup"><span data-stu-id="248a6-328">Managing Concurrency in hello Queue Service</span></span>
<span data-ttu-id="248a6-329">Ett scenario som är ett problem i hello kö service i vilket concurrency är där flera klienter hämtar meddelanden från en kö.</span><span class="sxs-lookup"><span data-stu-id="248a6-329">One scenario in which concurrency is a concern in hello queueing service is where multiple clients are retrieving messages from a queue.</span></span> <span data-ttu-id="248a6-330">När ett meddelande har hämtats från hello kö innehåller hello svaret hello-meddelande och ett pop inleverans-värde som är nödvändiga toodelete hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="248a6-330">When a message is retrieved from hello queue, hello response includes hello message and a pop receipt value, which is required toodelete hello message.</span></span> <span data-ttu-id="248a6-331">hello-meddelande tas inte bort automatiskt från hello kön, men när den har hämtats, det är inte synliga tooother klienter för hello tidsintervall som anges av hello visibilitytimeout-parametern.</span><span class="sxs-lookup"><span data-stu-id="248a6-331">hello message is not automatically deleted from hello queue, but after it has been retrieved, it is not visible tooother clients for hello time interval specified by hello visibilitytimeout parameter.</span></span> <span data-ttu-id="248a6-332">hello-klienten som hämtar hello-meddelande är förväntade toodelete hello-meddelande när den har bearbetats och innan hello som anges av hello TimeNextVisible element hello svar, som beräknas utifrån hello värdet för hello visibilitytimeout parameter.</span><span class="sxs-lookup"><span data-stu-id="248a6-332">hello client that retrieves hello message is expected toodelete hello message after it has been processed, and before hello time specified by hello TimeNextVisible element of hello response, which is calculated based on hello value of hello visibilitytimeout parameter.</span></span> <span data-ttu-id="248a6-333">hello-värdet för visibilitytimeout läggs toohello tid vid vilken hello-meddelande är hämtade toodetermine hello värdet för TimeNextVisible.</span><span class="sxs-lookup"><span data-stu-id="248a6-333">hello value of visibilitytimeout is added toohello time at which hello message is retrieved toodetermine hello value of TimeNextVisible.</span></span>  

<span data-ttu-id="248a6-334">hello kötjänsten har inte stöd för bästa eller sämsta samtidighet och för den här orsak klienter bearbetar meddelanden som hämtas från en kö ska kontrollera meddelanden bearbetas på ett idempotent sätt.</span><span class="sxs-lookup"><span data-stu-id="248a6-334">hello queue service does not have support for either optimistic or pessimistic concurrency and for this reason clients processing messages retrieved from a queue should ensure messages are processed in an idempotent manner.</span></span> <span data-ttu-id="248a6-335">En senaste skrivaren WINS-strategi används för update-åtgärder som till exempel SetQueueServiceProperties, SetQueueMetaData, SetQueueACL och UpdateMessage.</span><span class="sxs-lookup"><span data-stu-id="248a6-335">A last writer wins strategy is used for update operations such as SetQueueServiceProperties, SetQueueMetaData, SetQueueACL and UpdateMessage.</span></span>  

<span data-ttu-id="248a6-336">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="248a6-336">For more information see:</span></span>  

* [<span data-ttu-id="248a6-337">Kön Service REST-API</span><span class="sxs-lookup"><span data-stu-id="248a6-337">Queue Service REST API</span></span>](http://msdn.microsoft.com/library/azure/dd179363.aspx)
* [<span data-ttu-id="248a6-338">Hämta meddelanden</span><span class="sxs-lookup"><span data-stu-id="248a6-338">Get Messages</span></span>](http://msdn.microsoft.com/library/azure/dd179474.aspx)  

## <a name="managing-concurrency-in-hello-file-service"></a><span data-ttu-id="248a6-339">Hantera samtidighet i hello Filtjänst</span><span class="sxs-lookup"><span data-stu-id="248a6-339">Managing Concurrency in hello File Service</span></span>
<span data-ttu-id="248a6-340">Hej filtjänst kan nås med hjälp av två olika protokollslutpunkterna – SMB- och REST.</span><span class="sxs-lookup"><span data-stu-id="248a6-340">hello file service can be accessed using two different protocol endpoints – SMB and REST.</span></span> <span data-ttu-id="248a6-341">hello REST-tjänst har inte stöd för antingen optimistisk låsning eller sämsta låser och alla uppdateringar följer en senaste skrivaren WINS-strategi.</span><span class="sxs-lookup"><span data-stu-id="248a6-341">hello REST service does not have support for either optimistic locking or pessimistic locking and all updates will follow a last writer wins strategy.</span></span> <span data-ttu-id="248a6-342">SMB-klienter som montera filresurser kan utnyttja filen låsning mekanismer toomanage åtkomst tooshared systemfiler – inklusive hello möjlighet tooperform sämsta låsning.</span><span class="sxs-lookup"><span data-stu-id="248a6-342">SMB clients that mount file shares can leverage file system locking mechanisms toomanage access tooshared files – including hello ability tooperform pessimistic locking.</span></span> <span data-ttu-id="248a6-343">När en SMB-klienten öppnar en fil, anger både hello filåtkomst och dela läge.</span><span class="sxs-lookup"><span data-stu-id="248a6-343">When an SMB client opens a file, it specifies both hello file access and share mode.</span></span> <span data-ttu-id="248a6-344">En filåtkomst alternativet för ”skriva” eller ”läsa/skriva” tillsammans med en filresurs läge ”NONE” leder hello-fil som låst av en SMB-klient tills hello-filen är stängd.</span><span class="sxs-lookup"><span data-stu-id="248a6-344">Setting a File Access option of "Write" or "Read/Write" along with a File Share mode of "None" will result in hello file being locked by an SMB client until hello file is closed.</span></span> <span data-ttu-id="248a6-345">Om REST-åtgärden utförs på en fil där en SMB-klienten har hello filen låst returnerar hello REST-tjänst statuskod 409 (konflikt) med felkoden SharingViolation.</span><span class="sxs-lookup"><span data-stu-id="248a6-345">If REST operation is attempted on a file where an SMB client has hello file locked hello REST service will return status code 409 (Conflict) with error code SharingViolation.</span></span>  

<span data-ttu-id="248a6-346">När en SMB-klienten öppnar en fil att ta bort, markerar hello-fil som väntar på borttagning förrän alla andra SMB-klienten med öppna referenser i filen är stängd.</span><span class="sxs-lookup"><span data-stu-id="248a6-346">When an SMB client opens a file for delete, it marks hello file as pending delete until all other SMB client open handles on that file are closed.</span></span> <span data-ttu-id="248a6-347">När en fil är markerad som väntar på borttagning, returneras alla REST-åtgärden på filen statuskod 409 (konflikt) med felkoden SMBDeletePending.</span><span class="sxs-lookup"><span data-stu-id="248a6-347">While a file is marked as pending delete, any REST operation on that file will return status code 409 (Conflict) with error code SMBDeletePending.</span></span> <span data-ttu-id="248a6-348">Statuskod 404 (inget hittas) returneras inte eftersom det är möjligt för hello SMB-klienten tooremove hello väntande borttagning flaggan tidigare tooclosing hello-filen.</span><span class="sxs-lookup"><span data-stu-id="248a6-348">Status code 404 (Not Found) is not returned since it is possible for hello SMB client tooremove hello pending deletion flag prior tooclosing hello file.</span></span> <span data-ttu-id="248a6-349">Statuskod 404 (inget hittas) förväntas med andra ord bara när hello-filen har tagits bort.</span><span class="sxs-lookup"><span data-stu-id="248a6-349">In other words, status code 404 (Not Found) is only expected when hello file has been removed.</span></span> <span data-ttu-id="248a6-350">Observera att när en fil är i en SMB väntetillstånd delete kan den inte inkluderas i hello lista filer resultat. Observera att hello REST ta bort fil- och REST ta bort åtgärder genomförs automatiskt och inte leder till väntande bort raderas även tillstånd.</span><span class="sxs-lookup"><span data-stu-id="248a6-350">Note that while a file is in a SMB pending delete state, it will not be included in hello List Files results.Also note that hello REST Delete File and REST Delete Directory operations are committed atomically and do not result in pending delete state.</span></span>  

<span data-ttu-id="248a6-351">Mer information finns i:</span><span class="sxs-lookup"><span data-stu-id="248a6-351">For more information see:</span></span>  

* [<span data-ttu-id="248a6-352">Hantera filen låser</span><span class="sxs-lookup"><span data-stu-id="248a6-352">Managing File Locks</span></span>](http://msdn.microsoft.com/library/azure/dn194265.aspx)  

## <a name="summary-and-next-steps"></a><span data-ttu-id="248a6-353">Sammanfattning och nästa steg.</span><span class="sxs-lookup"><span data-stu-id="248a6-353">Summary and Next Steps</span></span>
<span data-ttu-id="248a6-354">hello utformats Microsoft Azure Storage-tjänsten har för toomeet hello mest komplexa Onlineprogram hello behov utan att utvecklare toocompromise eller Tänk om viktiga designbeslut antaganden som samtidighet och data konsekvent att de kommer tootake för beviljas.</span><span class="sxs-lookup"><span data-stu-id="248a6-354">hello Microsoft Azure Storage service has been designed toomeet hello needs of hello most complex online applications without forcing developers toocompromise or rethink key design assumptions such as concurrency and data consistency that they have come tootake for granted.</span></span>  

<span data-ttu-id="248a6-355">Utför exempelprogram som refereras till i den här bloggen för hello:</span><span class="sxs-lookup"><span data-stu-id="248a6-355">For hello complete sample application referenced in this blog:</span></span>  

* [<span data-ttu-id="248a6-356">Hantera samtidighet med hjälp av Azure Storage - exempelprogram</span><span class="sxs-lookup"><span data-stu-id="248a6-356">Managing Concurrency using Azure Storage - Sample Application</span></span>](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114)  

<span data-ttu-id="248a6-357">Mer information om Azure Storage finns:</span><span class="sxs-lookup"><span data-stu-id="248a6-357">For more information on Azure Storage see:</span></span>  

* [<span data-ttu-id="248a6-358">Startsida för Microsoft Azure Storage</span><span class="sxs-lookup"><span data-stu-id="248a6-358">Microsoft Azure Storage Home Page</span></span>](https://azure.microsoft.com/services/storage/)
* [<span data-ttu-id="248a6-359">Introduktion tooAzure lagring</span><span class="sxs-lookup"><span data-stu-id="248a6-359">Introduction tooAzure Storage</span></span>](storage-introduction.md)
* <span data-ttu-id="248a6-360">Komma igång för lagring [Blob](storage-dotnet-how-to-use-blobs.md), [tabell](storage-dotnet-how-to-use-tables.md), [köer](storage-dotnet-how-to-use-queues.md), och [filer](storage-dotnet-how-to-use-files.md)</span><span class="sxs-lookup"><span data-stu-id="248a6-360">Storage Getting Started for [Blob](storage-dotnet-how-to-use-blobs.md), [Table](storage-dotnet-how-to-use-tables.md),  [Queues](storage-dotnet-how-to-use-queues.md), and [Files](storage-dotnet-how-to-use-files.md)</span></span>
* <span data-ttu-id="248a6-361">Lagringsarkitektur – [Azure Storage: en högtillgänglig Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span><span class="sxs-lookup"><span data-stu-id="248a6-361">Storage Architecture – [Azure Storage : A Highly Available Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span></span>

