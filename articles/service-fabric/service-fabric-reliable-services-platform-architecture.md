---
title: "Tillförlitlig service-arkitektur | Microsoft Docs"
description: "Översikt över arkitekturen tillförlitlig tjänst för tillståndskänsliga och tillståndslösa tjänster"
services: service-fabric
documentationcenter: .net
author: AlanWarwick
manager: timlt
editor: vturecek
ms.assetid: af002ae6-7f6d-4769-b049-82aa1ba0891b
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/30/2016
ms.author: alanwar
redirect_url: /azure/service-fabric/service-fabric-reliable-services-introduction
ms.openlocfilehash: a00a16945356b9731485554e06df46528b5c7bb2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="architecture-for-stateful-and-stateless-reliable-services"></a><span data-ttu-id="74367-103">Arkitektur för tillståndskänsliga och tillståndslösa Reliable Services</span><span class="sxs-lookup"><span data-stu-id="74367-103">Architecture for stateful and stateless Reliable Services</span></span>
<span data-ttu-id="74367-104">En tillförlitlig tjänst för Azure Service Fabric kanske tillståndskänslig eller tillståndslösa.</span><span class="sxs-lookup"><span data-stu-id="74367-104">An Azure Service Fabric Reliable Service may be stateful or stateless.</span></span> <span data-ttu-id="74367-105">Varje typ av tjänst körs inom en viss arkitektur.</span><span class="sxs-lookup"><span data-stu-id="74367-105">Each type of service runs within a specific architecture.</span></span> <span data-ttu-id="74367-106">Dessa arkitekturer beskrivs i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="74367-106">These architectures are described in this article.</span></span>
<span data-ttu-id="74367-107">Finns det [tillförlitliga översikt över](service-fabric-reliable-services-introduction.md) för mer information om skillnaderna mellan tillståndskänsliga och tillståndslösa tjänster.</span><span class="sxs-lookup"><span data-stu-id="74367-107">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) for more information about the differences between stateful and stateless services.</span></span>

## <a name="stateful-reliable-services"></a><span data-ttu-id="74367-108">Tillståndskänsliga Reliable Services</span><span class="sxs-lookup"><span data-stu-id="74367-108">Stateful Reliable Services</span></span>
### <a name="architecture-of-a-stateful-service"></a><span data-ttu-id="74367-109">Arkitekturen för en tillståndskänslig service</span><span class="sxs-lookup"><span data-stu-id="74367-109">Architecture of a stateful service</span></span>
![Arkitekturdiagram för en tillståndskänslig tjänst](./media/service-fabric-reliable-services-platform-architecture/reliable-stateful-service-architecture.png)

### <a name="stateful-reliable-service"></a><span data-ttu-id="74367-111">Tillståndskänsliga tillförlitlig tjänst</span><span class="sxs-lookup"><span data-stu-id="74367-111">Stateful Reliable Service</span></span>
<span data-ttu-id="74367-112">En tillståndskänslig tillförlitlig tjänst kan härledas från den StatefulService eller StatefulServiceBase klassen.</span><span class="sxs-lookup"><span data-stu-id="74367-112">A stateful Reliable Service can derive from either the StatefulService or StatefulServiceBase class.</span></span> <span data-ttu-id="74367-113">Båda dessa basklasser som tillhandahålls av Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="74367-113">Both of these base classes are provided by Service Fabric.</span></span> <span data-ttu-id="74367-114">De tillhandahåller olika nivåer av support och abstraktion för tjänsten tillståndskänslig att samverka med Service Fabric - och ingår som en tjänst i Service Fabric-kluster.</span><span class="sxs-lookup"><span data-stu-id="74367-114">They offer various levels of support and abstraction for the stateful service to interface with Service Fabric--and to participate as a service within the Service Fabric cluster.</span></span>

<span data-ttu-id="74367-115">StatefulService härleds från StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="74367-115">StatefulService derives from StatefulServiceBase.</span></span> <span data-ttu-id="74367-116">StatefulServiceBase ger bättre flexibilitet för tjänster, men kräver mer förståelse av innehållet i Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="74367-116">StatefulServiceBase offers services more flexibility, but requires more understanding of the internals of Service Fabric.</span></span>
<span data-ttu-id="74367-117">Finns det [översikt över tillförlitliga Service](service-fabric-reliable-services-introduction.md) och [tillförlitlig tjänst avancerade användning](service-fabric-reliable-services-advanced-usage.md) mer information om specifika för att skriva tjänster med hjälp av klasserna StatefulService och StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="74367-117">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) and [Reliable Service advanced usage](service-fabric-reliable-services-advanced-usage.md) for more information on the specifics of writing services by using the StatefulService and StatefulServiceBase classes.</span></span>

<span data-ttu-id="74367-118">Båda basklasser hantera livstid och rollen för tjänstimplementeringen.</span><span class="sxs-lookup"><span data-stu-id="74367-118">Both base classes manage the lifetime and role of the service implementation.</span></span> <span data-ttu-id="74367-119">Tjänstimplementeringen kan åsidosätta virtuella metoder av antingen basklass om tjänstimplementeringen har att göra vid dessa punkter i tjänsten implementering livscykel-- eller om den vill skapa en lyssnare Kommunikationsobjekt.</span><span class="sxs-lookup"><span data-stu-id="74367-119">The service implementation may override virtual methods of either base class if the service implementation has work to do at those points in the service implementation lifecycle--or if it wants to create a communication listener object.</span></span> <span data-ttu-id="74367-120">Att även om en implementering kan implementera sin egen Kommunikationsobjekt lyssnare exponera ICommunicationListener, i diagrammet ovan, lyssnaren kommunikation är implementeras av Service Fabric--som tjänsten implementering använder en kommunikation lyssnare som implementeras av Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="74367-120">Note that although a service implementation may implement its own communication listener object exposing ICommunicationListener, in the diagram above, the communication listener is implemented by Service Fabric--as the service implementation uses a communication listener that is implemented by Service Fabric.</span></span>

<span data-ttu-id="74367-121">En tillståndskänslig tillförlitlig tjänst använder hanteraren tillförlitliga tillstånd för att dra nytta av tillförlitliga samlingar.</span><span class="sxs-lookup"><span data-stu-id="74367-121">A stateful Reliable Service uses the reliable state manager to take advantage of reliable collections.</span></span> <span data-ttu-id="74367-122">Tillförlitliga samlingar är lokala datastrukturer som hög tillgänglighet till tjänsten--som är, de är alltid tillgängliga, oavsett service växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="74367-122">Reliable collections are local data structures that are highly available to the service--that is, they are always available, regardless of service failovers.</span></span> <span data-ttu-id="74367-123">Varje typ av tillförlitliga samling implementeras av en tillförlitlig tillståndsprovidern.</span><span class="sxs-lookup"><span data-stu-id="74367-123">Each type of reliable collection is implemented by a reliable state provider.</span></span>
<span data-ttu-id="74367-124">Mer information om tillförlitlig samlingar finns i [tillförlitliga samlingar översikt](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="74367-124">For more information on reliable collections, see the [reliable collections overview](service-fabric-reliable-services-reliable-collections.md).</span></span>

### <a name="reliable-state-manager-and-state-providers"></a><span data-ttu-id="74367-125">Tillförlitliga tillståndshanterare och leverantörer av tillstånd</span><span class="sxs-lookup"><span data-stu-id="74367-125">Reliable state manager and state providers</span></span>
<span data-ttu-id="74367-126">Hanteraren för tillförlitlig tillstånd är det objekt som hanterar tillförlitliga tillståndsprovidrar.</span><span class="sxs-lookup"><span data-stu-id="74367-126">The reliable state manager is the object that manages reliable state providers.</span></span> <span data-ttu-id="74367-127">Har funktioner för att skapa, ta bort, räkna upp och kontrollera att tillförlitliga tillståndsprovidrar är beständiga och hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="74367-127">It has the functionality to create, delete, enumerate, and ensure that the reliable state providers are persisted and highly available.</span></span> <span data-ttu-id="74367-128">En tillförlitlig tillstånd providerinstans representerar en instans av en beständig och hög tillgänglighet datastruktur, till exempel en ordlista eller en kö.</span><span class="sxs-lookup"><span data-stu-id="74367-128">A reliable state provider instance represents an instance of a persisted and highly available data structure, such as a dictionary or a queue.</span></span>

<span data-ttu-id="74367-129">Varje tillförlitliga tillståndsprovidern exponerar ett gränssnitt som används av en tillståndskänslig service för att interagera med tillförlitlig tillståndsprovidern.</span><span class="sxs-lookup"><span data-stu-id="74367-129">Each reliable state provider exposes an interface that is used by a stateful service to interact with the reliable state provider.</span></span> <span data-ttu-id="74367-130">Till exempel IReliableDictionary används gränssnittet med tillförlitlig ordlistan IReliableQueue används för gränssnittet med tillförlitlig kön.</span><span class="sxs-lookup"><span data-stu-id="74367-130">For example, IReliableDictionary is used to interface with the reliable dictionary, while IReliableQueue is used to interface with the reliable queue.</span></span> <span data-ttu-id="74367-131">Alla tillförlitliga tillståndsprovidrar implementera gränssnittet IReliableState.</span><span class="sxs-lookup"><span data-stu-id="74367-131">All reliable state providers implement the IReliableState interface.</span></span>

<span data-ttu-id="74367-132">Den tillförlitliga tillståndshanterare har gränssnittet IReliableStateManager, vilket ger åtkomst till den från en tillståndskänslig service.</span><span class="sxs-lookup"><span data-stu-id="74367-132">The reliable state manager has an interface named IReliableStateManager, which allows access to it from a stateful service.</span></span> <span data-ttu-id="74367-133">Gränssnitt för att tillförlitligt tillståndsprovidrar returneras via IReliableStateManager.</span><span class="sxs-lookup"><span data-stu-id="74367-133">Interfaces to reliable state providers are returned through IReliableStateManager.</span></span>

<span data-ttu-id="74367-134">Den tillförlitliga tillståndshanterare använder plugin arkitektur så att nya typer av tillförlitliga samlingar kan du ansluta dynamiskt.</span><span class="sxs-lookup"><span data-stu-id="74367-134">The reliable state manager uses a plug-in architecture so that new types of reliable collections can be plugged in dynamically.</span></span>

<span data-ttu-id="74367-135">Tillförlitliga ordlista och tillförlitlig kön bygger på implementering av en differentiell store hög prestanda, en ny version.</span><span class="sxs-lookup"><span data-stu-id="74367-135">The reliable dictionary and reliable queue are built upon the implementation of a high-performance, versioned differential store.</span></span>

### <a name="transactional-replicator"></a><span data-ttu-id="74367-136">Transaktionell replikatorn</span><span class="sxs-lookup"><span data-stu-id="74367-136">Transactional replicator</span></span>
<span data-ttu-id="74367-137">Den transaktionella replikatorkomponent ansvarar för att säkerställa att tillståndet för en tjänst (det vill säga tillstånd i hanteraren för tillförlitlig tillstånd och tillförlitlig samlingar) är konsekvent på alla repliker som kör tjänsten.</span><span class="sxs-lookup"><span data-stu-id="74367-137">The transactional replicator component is responsible for ensuring that the state of a service (that is, the state within the reliable state manager and the reliable collections) is consistent across all replicas running the service.</span></span> <span data-ttu-id="74367-138">Det innebär också att tillståndet sparas i loggen.</span><span class="sxs-lookup"><span data-stu-id="74367-138">It also ensures that the state is persisted in the log.</span></span> <span data-ttu-id="74367-139">Tillförlitliga tillstånd manager gränssnitt med transaktionella replikatorn via en mekanism för privat.</span><span class="sxs-lookup"><span data-stu-id="74367-139">The reliable state manager interfaces with the transactional replicator via a private mechanism.</span></span>

<span data-ttu-id="74367-140">Transaktionell replikatorn använder nätverksprotokoll för att kommunicera tillstånd med andra repliker i tjänstinstansen så att alla repliker har aktuell statusinformation.</span><span class="sxs-lookup"><span data-stu-id="74367-140">The transactional replicator uses a network protocol to communicate state with other replicas of the service instance so that all replicas have up-to-date state information.</span></span>

<span data-ttu-id="74367-141">Transaktionell replikatorn använder en logg för att spara information om tillstånd så att tillståndet kvarstår process eller noden kraschar.</span><span class="sxs-lookup"><span data-stu-id="74367-141">The transactional replicator uses a log to persist state information so that the state information survives process or node crashes.</span></span> <span data-ttu-id="74367-142">Gränssnittet i loggen är via en mekanism för privat.</span><span class="sxs-lookup"><span data-stu-id="74367-142">The interface to the log is via a private mechanism.</span></span>

### <a name="log"></a><span data-ttu-id="74367-143">Logga</span><span class="sxs-lookup"><span data-stu-id="74367-143">Log</span></span>
<span data-ttu-id="74367-144">Loggkomponenten innehåller en högpresterande beständiga arkivet som kan optimeras för skrivning till snurrande eller SSD-diskar.</span><span class="sxs-lookup"><span data-stu-id="74367-144">The log component provides a high-performance persistent store that can be optimized for writing to spinning or solid-state disks.</span></span>  <span data-ttu-id="74367-145">Design av loggen är för beständig lagring (d.v.s. hårddiskar) att de noder som kör tillståndskänslig service.</span><span class="sxs-lookup"><span data-stu-id="74367-145">The design of the log is for the persistent storage (i.e., hard disks) to be local to the nodes that are running the stateful service.</span></span> <span data-ttu-id="74367-146">Detta möjliggör låg latens och hög genomströmning jämfört med beständiga Fjärrlagring, som inte är lokal till noden.</span><span class="sxs-lookup"><span data-stu-id="74367-146">This allows for low latencies and high throughput, as compared to remote persistent storage, which is not local to the node.</span></span>

<span data-ttu-id="74367-147">Loggkomponenten använder flera loggfiler.</span><span class="sxs-lookup"><span data-stu-id="74367-147">The log component uses multiple log files.</span></span> <span data-ttu-id="74367-148">Det finns en nod hela delade loggfil med alla repliker som den kan ge svarstid för lägsta och högsta dataflöde för att lagra användartillståndsdata.</span><span class="sxs-lookup"><span data-stu-id="74367-148">There is a node-wide shared log file that all replicas use as it can provide the lowest latency and highest throughput for storing state data.</span></span> <span data-ttu-id="74367-149">Som standard delade loggen placeras i katalogen Service Fabric-noden fungerar, men den kan också konfigureras så att den placeras på en annan plats, helst på en disk som är reserverade för delade loggen.</span><span class="sxs-lookup"><span data-stu-id="74367-149">By default the shared log is placed in the Service Fabric node work directory but it may also be configured to be placed at another location, ideally on a disk reserved for only the shared log.</span></span> <span data-ttu-id="74367-150">Varje replik för tjänsten har också en dedikerad loggfil och dedikerad loggen placeras i tjänstens arbetskatalog.</span><span class="sxs-lookup"><span data-stu-id="74367-150">Each replica for the service also has a dedicated log file and the dedicated log is placed within the service's work directory.</span></span> <span data-ttu-id="74367-151">Det finns ingen mekanism för att konfigurera dedikerad loggen som ska placeras på en annan plats.</span><span class="sxs-lookup"><span data-stu-id="74367-151">There is no mechanism to configure the dedicated log to be placed at a different location.</span></span>

<span data-ttu-id="74367-152">Delade loggen är ett övergående område för repliken statusinformation medan dedikerade loggfilen är slutdestinationen där du sparade.</span><span class="sxs-lookup"><span data-stu-id="74367-152">The shared log is a transitional area for the replica's state information, while the dedicated log file is the final destination where it is persisted.</span></span> <span data-ttu-id="74367-153">I den här designen tillståndsinformationen först skrivs till delade loggfilen och sedan lazy flyttades till dedikerade loggfilen i bakgrunden.</span><span class="sxs-lookup"><span data-stu-id="74367-153">In this design, the state information is first written to the shared log file and then lazily moved to the dedicated log file in the background.</span></span> <span data-ttu-id="74367-154">På så sätt kan skulle skriva till delade loggen ha lägsta svarstid och högsta genomflödet som kan se förloppet snabbare-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="74367-154">In this way, the write to the shared log would have the lowest latency and highest throughput which allows the service to make progress faster.</span></span>

<span data-ttu-id="74367-155">Läser och skriver till delade loggen är klar via direkt i/o förallokerade utrymme på disken för delade loggfilen.</span><span class="sxs-lookup"><span data-stu-id="74367-155">Reads and writes to the shared log are done via direct IO to preallocated space on the disk for the shared log file.</span></span> <span data-ttu-id="74367-156">Om du vill tillåta optimal användning av diskutrymme på enheten med dedikerade loggar skapas dedikerade loggfilen som en NTFS-sparse-fil.</span><span class="sxs-lookup"><span data-stu-id="74367-156">To allow optimal use of disk space on the drive with dedicated logs, the dedicated log file is created as a NTFS sparse file.</span></span> <span data-ttu-id="74367-157">Observera att detta gör att överetablering diskutrymme och Operativsystemet visar de dedikerade loggfiler med mycket mer diskutrymme än vad som faktiskt används.</span><span class="sxs-lookup"><span data-stu-id="74367-157">Note that this will allow overprovisioning of disk space and the OS will show the dedicated log files using much more disk space than is actually used.</span></span>

<span data-ttu-id="74367-158">Utöver en minimal användarläge gränssnitt till loggen loggen skapas som en drivrutin för kernel-läge.</span><span class="sxs-lookup"><span data-stu-id="74367-158">Aside from a minimal user-mode interface to the log, the log is written as a kernel-mode driver.</span></span> <span data-ttu-id="74367-159">Loggen kan ge högsta prestanda till alla tjänster som använder den genom att köra som en drivrutin för kernel-läge.</span><span class="sxs-lookup"><span data-stu-id="74367-159">By running as a kernel-mode driver, the log can provide the highest performance to all services that use it.</span></span>

<span data-ttu-id="74367-160">Mer information om hur du konfigurerar loggen finns [konfigurera tillståndskänsliga Reliable Services](service-fabric-reliable-services-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="74367-160">For more information about configuring the log, see [Configuring stateful Reliable Services](service-fabric-reliable-services-configuration.md).</span></span>

## <a name="stateless-reliable-service"></a><span data-ttu-id="74367-161">Tillståndslösa tillförlitlig tjänst</span><span class="sxs-lookup"><span data-stu-id="74367-161">Stateless Reliable Service</span></span>
### <a name="architecture-of-a-stateless-service"></a><span data-ttu-id="74367-162">Arkitektur för tillståndslösa tjänsten</span><span class="sxs-lookup"><span data-stu-id="74367-162">Architecture of a stateless service</span></span>
![Arkitekturdiagram för tillståndslösa tjänsten](./media/service-fabric-reliable-services-platform-architecture/reliable-stateless-service-architecture.png)

### <a name="stateless-reliable-service"></a><span data-ttu-id="74367-164">Tillståndslösa tillförlitlig tjänst</span><span class="sxs-lookup"><span data-stu-id="74367-164">Stateless Reliable Service</span></span>
<span data-ttu-id="74367-165">Implementeringar av tillståndslösa tjänsten härleds från klassen StatelessService eller StatelessServiceBase.</span><span class="sxs-lookup"><span data-stu-id="74367-165">Stateless service implementations derive from the StatelessService or StatelessServiceBase class.</span></span> <span data-ttu-id="74367-166">Klassen StatelessServiceBase tillåter bättre flexibilitet än StatelessService-klassen.</span><span class="sxs-lookup"><span data-stu-id="74367-166">The StatelessServiceBase class allows more flexibility than the StatelessService class.</span></span>
<span data-ttu-id="74367-167">Båda basklasser hantera livstid och rollen för en tjänst.</span><span class="sxs-lookup"><span data-stu-id="74367-167">Both base classes manage the lifetime and role of a service.</span></span>

<span data-ttu-id="74367-168">Tjänstimplementeringen kan åsidosätta virtuella metoder av antingen basklass om tjänsten har att göra vid dessa punkter i livscykeln för tjänsten-- eller om den vill skapa en lyssnare Kommunikationsobjekt.</span><span class="sxs-lookup"><span data-stu-id="74367-168">The service implementation may override virtual methods of either base class if the service has work to do at those points in the service lifecycle--or if it wants to create a communication listener object.</span></span> <span data-ttu-id="74367-169">Observera att även om tjänsten kan implementera sin egen Kommunikationsobjekt lyssnare exponera ICommunicationListener, i diagrammet ovan, implementeras lyssnaren kommunikation av Service Fabric eftersom implementering av som använder en kommunikation lyssnare som implementeras av Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="74367-169">Note that although the service may implement its own communication listener object exposing ICommunicationListener, in the diagram above, the communication listener is implemented by Service Fabric, as that service implementation uses a communication listener that is implemented by Service Fabric.</span></span>

<span data-ttu-id="74367-170">Finns det [översikt över tillförlitliga Service](service-fabric-reliable-services-introduction.md) och [tillförlitlig tjänst avancerade användning](service-fabric-reliable-services-advanced-usage.md) mer information om specifika för att skriva tjänster med hjälp av klasserna StatelessService och StatelessServiceBase.</span><span class="sxs-lookup"><span data-stu-id="74367-170">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) and [Reliable Service advanced usage](service-fabric-reliable-services-advanced-usage.md) for more information on the specifics of writing services using the StatelessService and StatelessServiceBase classes.</span></span>

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## <a name="next-steps"></a><span data-ttu-id="74367-171">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="74367-171">Next steps</span></span>
<span data-ttu-id="74367-172">Mer information om Service Fabric finns:</span><span class="sxs-lookup"><span data-stu-id="74367-172">For more information about Service Fabric, see:</span></span>

[<span data-ttu-id="74367-173">Översikt över tillförlitliga service</span><span class="sxs-lookup"><span data-stu-id="74367-173">Reliable service overview</span></span>](service-fabric-reliable-services-introduction.md)

[<span data-ttu-id="74367-174">Snabbstart</span><span class="sxs-lookup"><span data-stu-id="74367-174">Quick start</span></span>](service-fabric-reliable-services-quick-start.md)

[<span data-ttu-id="74367-175">Översikt över tillförlitliga samlingar</span><span class="sxs-lookup"><span data-stu-id="74367-175">Reliable collections overview</span></span>](service-fabric-reliable-services-reliable-collections.md)

[<span data-ttu-id="74367-176">Tillförlitlig tjänst avancerad användning</span><span class="sxs-lookup"><span data-stu-id="74367-176">Reliable service advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)

[<span data-ttu-id="74367-177">Tillförlitliga tjänstkonfiguration</span><span class="sxs-lookup"><span data-stu-id="74367-177">Reliable service configuration</span></span>](service-fabric-reliable-services-configuration.md)  

