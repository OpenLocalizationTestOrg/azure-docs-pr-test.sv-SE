---
title: "aaaGuidelines & rekommendationer för tillförlitlig samlingar i Azure Service Fabric | Microsoft Docs"
description: "Riktlinjer och rekommendationer för att använda tillförlitliga samlingar för Service Fabric"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="f3546-103">Riktlinjer och rekommendationer för tillförlitlig samlingar i Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="f3546-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="f3546-104">Det här avsnittet innehåller riktlinjer för att använda tillförlitliga Tillståndshanterare och tillförlitlig samlingar.</span><span class="sxs-lookup"><span data-stu-id="f3546-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="f3546-105">hello målet är toohelp användare undvika vanliga fallgropar.</span><span class="sxs-lookup"><span data-stu-id="f3546-105">hello goal is toohelp users avoid common pitfalls.</span></span>

<span data-ttu-id="f3546-106">hello riktlinjer ordnas som enkel rekommendationer prefixet hello villkoren *gör*, *Överväg att*, *Undvik* och *inte*.</span><span class="sxs-lookup"><span data-stu-id="f3546-106">hello guidelines are organized as simple recommendations prefixed with hello terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="f3546-107">Ändra inte ett objekt av anpassade typer som returneras av läsåtgärder (till exempel `TryPeekAsync` eller `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="f3546-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="f3546-108">Tillförlitliga samlingar, precis som samtidiga samlingar returnerar en referens toohello objekt och inte en kopia.</span><span class="sxs-lookup"><span data-stu-id="f3546-108">Reliable Collections, just like Concurrent Collections, return a reference toohello objects and not a copy.</span></span>
* <span data-ttu-id="f3546-109">Göra djup kopia hello returnerade objekt av en anpassad typ innan du ändrar den.</span><span class="sxs-lookup"><span data-stu-id="f3546-109">Do deep copy hello returned object of a custom type before modifying it.</span></span> <span data-ttu-id="f3546-110">Eftersom strukturer och inbyggda typer är pass-av-värde, behöver inte toodo en djup kopia på dem.</span><span class="sxs-lookup"><span data-stu-id="f3546-110">Since structs and built-in types are pass-by-value, you do not need toodo a deep copy on them.</span></span>
* <span data-ttu-id="f3546-111">Använd inte `TimeSpan.MaxValue` för timeout.</span><span class="sxs-lookup"><span data-stu-id="f3546-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="f3546-112">Timeout ska använda toodetect deadlocks.</span><span class="sxs-lookup"><span data-stu-id="f3546-112">Time-outs should be used toodetect deadlocks.</span></span>
* <span data-ttu-id="f3546-113">Använd inte en transaktion när den har genomförts, avbröts eller tagits bort.</span><span class="sxs-lookup"><span data-stu-id="f3546-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="f3546-114">Använd inte en uppräkning utanför omfånget för hello transaktionen det skapades i.</span><span class="sxs-lookup"><span data-stu-id="f3546-114">Do not use an enumeration outside of hello transaction scope it was created in.</span></span>
* <span data-ttu-id="f3546-115">Skapa inte en transaktion i en annan transaktion `using` instruktionen eftersom det kan orsaka deadlocks.</span><span class="sxs-lookup"><span data-stu-id="f3546-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="f3546-116">Att din `IComparable<TKey>` -implementeringen är korrekt.</span><span class="sxs-lookup"><span data-stu-id="f3546-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="f3546-117">hello system tar beroende på `IComparable<TKey>` för sammanslagning kontrollpunkter och rader.</span><span class="sxs-lookup"><span data-stu-id="f3546-117">hello system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="f3546-118">Använd uppdateringslås vid läsning av ett objekt med en avsikt tooupdate den tooprevent en viss klass av deadlocks.</span><span class="sxs-lookup"><span data-stu-id="f3546-118">Do use Update lock when reading an item with an intention tooupdate it tooprevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="f3546-119">Fundera objekten (till exempel TKey + TValue för tillförlitlig ordlistan) under 80 kilobyte: mindre hello bättre.</span><span class="sxs-lookup"><span data-stu-id="f3546-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller hello better.</span></span> <span data-ttu-id="f3546-120">Detta minskar hello heapen för stora objekt användning samt disk- och -i/o-kraven.</span><span class="sxs-lookup"><span data-stu-id="f3546-120">This reduces hello amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="f3546-121">Det minskar ofta replikera dubblettdata när bara en liten del av hello värdet uppdateras.</span><span class="sxs-lookup"><span data-stu-id="f3546-121">Often, it reduces replicating duplicate data when only one small part of hello value is being updated.</span></span> <span data-ttu-id="f3546-122">Vanliga sätt tooachieve detta i tillförlitliga ordlistan är toobreak rader i toomultiple rader.</span><span class="sxs-lookup"><span data-stu-id="f3546-122">Common way tooachieve this in Reliable Dictionary, is toobreak your rows in toomultiple rows.</span></span>
* <span data-ttu-id="f3546-123">Överväg att använda säkerhetskopiering och återställning funktioner toohave katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="f3546-123">Consider using backup and restore functionality toohave disaster recovery.</span></span>
* <span data-ttu-id="f3546-124">Undvika enhet åtgärder och åtgärder för flera enheter (t.ex `GetCountAsync`, `CreateEnumerableAsync`) i hello samma transaktion på grund av toohello olika isoleringsnivåerna tillåter.</span><span class="sxs-lookup"><span data-stu-id="f3546-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in hello same transaction due toohello different isolation levels.</span></span>
* <span data-ttu-id="f3546-125">Hantera InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="f3546-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="f3546-126">Användartransaktioner kan avbrytas av hello system för många olika skäl.</span><span class="sxs-lookup"><span data-stu-id="f3546-126">User transactions can be aborted by hello system for variety of reasons.</span></span> <span data-ttu-id="f3546-127">Till exempel blockerar när hello tillförlitliga Tillståndshanterare ändrar sin roll utanför primära eller när en tidskrävande transaktion trunkering av hello transaktionella logg.</span><span class="sxs-lookup"><span data-stu-id="f3546-127">For example, when hello Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of hello transactional log.</span></span> <span data-ttu-id="f3546-128">I sådana fall kan användare få InvalidOperationException som anger deras transaktionen har redan avslutats.</span><span class="sxs-lookup"><span data-stu-id="f3546-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="f3546-129">Under förutsättning att, hello avslutning av hello transaktion begärdes inte av hello användaren, bästa sätt toohandle undantaget är toodispose hello transaktion, kontrollera om hello annullering token har har signalerat (eller hello roll hello replik har ändrats), och om inte Skapa en ny transaktion och försök igen.</span><span class="sxs-lookup"><span data-stu-id="f3546-129">Assuming, hello termination of hello transaction was not requested by hello user, best way toohandle this exception is toodispose hello transaction, check if hello cancellation token has been signaled (or hello role of hello replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="f3546-130">Här följer några saker tookeep i åtanke:</span><span class="sxs-lookup"><span data-stu-id="f3546-130">Here are some things tookeep in mind:</span></span>

* <span data-ttu-id="f3546-131">hello standardtidsgränsen är fyra sekunder för alla hello tillförlitliga samling API: er.</span><span class="sxs-lookup"><span data-stu-id="f3546-131">hello default time-out is four seconds for all hello Reliable Collection APIs.</span></span> <span data-ttu-id="f3546-132">De flesta användare bör använda hello standardtidsgränsen.</span><span class="sxs-lookup"><span data-stu-id="f3546-132">Most users should use hello default time-out.</span></span>
* <span data-ttu-id="f3546-133">hello standard annullering token är `CancellationToken.None` i alla tillförlitliga samlingar API: er.</span><span class="sxs-lookup"><span data-stu-id="f3546-133">hello default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="f3546-134">Hej nyckeltyp parametern (*TKey*) för en tillförlitlig ordlista korrekt måste implementera `GetHashCode()` och `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="f3546-134">hello key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="f3546-135">Nycklar måste vara ändras.</span><span class="sxs-lookup"><span data-stu-id="f3546-135">Keys must be immutable.</span></span>
* <span data-ttu-id="f3546-136">tooachieve hög tillgänglighet för hello tillförlitliga samlingar, varje tjänst bör ha minst ett mål och minsta replikuppsättningen storleken på 3.</span><span class="sxs-lookup"><span data-stu-id="f3546-136">tooachieve high availability for hello Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="f3546-137">Läsåtgärder på hello sekundära kan läsa versioner som inte är allokerade kvorum.</span><span class="sxs-lookup"><span data-stu-id="f3546-137">Read operations on hello secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="f3546-138">Det innebär att en version av data som läses från en enskild sekundär kan vara false nått.</span><span class="sxs-lookup"><span data-stu-id="f3546-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="f3546-139">Läser från primära är alltid stabila: kan aldrig vara false nått.</span><span class="sxs-lookup"><span data-stu-id="f3546-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="f3546-140">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="f3546-140">Next steps</span></span>
* [<span data-ttu-id="f3546-141">Arbeta med Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="f3546-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="f3546-142">Transaktioner och lås</span><span class="sxs-lookup"><span data-stu-id="f3546-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="f3546-143">Tillförlitliga tillstånd Manager och samling Internals</span><span class="sxs-lookup"><span data-stu-id="f3546-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="f3546-144">Datahantering</span><span class="sxs-lookup"><span data-stu-id="f3546-144">Managing Data</span></span>
  * [<span data-ttu-id="f3546-145">Säkerhetskopiering och återställning</span><span class="sxs-lookup"><span data-stu-id="f3546-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="f3546-146">Meddelanden</span><span class="sxs-lookup"><span data-stu-id="f3546-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="f3546-147">Serialisering och uppgradering</span><span class="sxs-lookup"><span data-stu-id="f3546-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="f3546-148">Konfigurationen för hanteraren för tillförlitlig tillstånd</span><span class="sxs-lookup"><span data-stu-id="f3546-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="f3546-149">Andra</span><span class="sxs-lookup"><span data-stu-id="f3546-149">Others</span></span>
  * [<span data-ttu-id="f3546-150">Snabbstart för Reliable Services</span><span class="sxs-lookup"><span data-stu-id="f3546-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="f3546-151">För utvecklare för tillförlitlig samlingar</span><span class="sxs-lookup"><span data-stu-id="f3546-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
