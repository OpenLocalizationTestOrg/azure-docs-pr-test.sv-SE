---
title: "Transaktioner och låslägen i Azure Service Fabric tillförlitliga samlingar | Microsoft Docs"
description: "Azure Service Fabric tillförlitliga tillstånd Manager och tillförlitlig samlingar transaktioner och låsa."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 3452473f5b2f86d29e46339c997193bc6403736a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="edcd9-103">Transaktioner och låslägen i Azure Service Fabric tillförlitliga samlingar</span><span class="sxs-lookup"><span data-stu-id="edcd9-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="edcd9-104">Transaktionen</span><span class="sxs-lookup"><span data-stu-id="edcd9-104">Transaction</span></span>
<span data-ttu-id="edcd9-105">En transaktion är en sekvens med åtgärder som utförs som en logisk enhet på arbetet.</span><span class="sxs-lookup"><span data-stu-id="edcd9-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="edcd9-106">En transaktion måste uppvisa följande ACID-egenskaper.</span><span class="sxs-lookup"><span data-stu-id="edcd9-106">A transaction must exhibit the following ACID properties.</span></span> <span data-ttu-id="edcd9-107">(se: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="edcd9-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="edcd9-108">**Odelbarhet**: en transaktion måste vara ett atomic arbetsenheten.</span><span class="sxs-lookup"><span data-stu-id="edcd9-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="edcd9-109">Med andra ord antingen alla dataändringar utförs eller ingen av dem har utförts.</span><span class="sxs-lookup"><span data-stu-id="edcd9-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="edcd9-110">**Konsekvenskontroll**: när du är klar, en transaktion måste lämna alla data i ett konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="edcd9-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="edcd9-111">Alla interna datastrukturer måste vara korrekt i slutet av transaktionen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-111">All internal data structures must be correct at the end of the transaction.</span></span>
* <span data-ttu-id="edcd9-112">**Isolering**: ändringar som görs av samtidiga transaktioner måste isoleras från de ändringar som gjorts av andra samtidiga transaktioner.</span><span class="sxs-lookup"><span data-stu-id="edcd9-112">**Isolation**: Modifications made by concurrent transactions must be isolated from the modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="edcd9-113">Isoleringsnivån som används för en åtgärd i en ITransaction bestäms av IReliableState utför åtgärden.</span><span class="sxs-lookup"><span data-stu-id="edcd9-113">The isolation level used for an operation within an ITransaction is determined by the IReliableState performing the operation.</span></span>
* <span data-ttu-id="edcd9-114">**Hållbarhet**: när en transaktion har slutförts effekterna permanent är på plats i systemet.</span><span class="sxs-lookup"><span data-stu-id="edcd9-114">**Durability**: After a transaction has completed, its effects are permanently in place in the system.</span></span> <span data-ttu-id="edcd9-115">Ändringarna sparas även i händelse av ett systemfel.</span><span class="sxs-lookup"><span data-stu-id="edcd9-115">The modifications persist even in the event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="edcd9-116">Isoleringsnivåer</span><span class="sxs-lookup"><span data-stu-id="edcd9-116">Isolation levels</span></span>
<span data-ttu-id="edcd9-117">Isoleringsnivå som definierar i vilken grad som transaktionen måste isoleras från ändringar som görs av andra transaktioner.</span><span class="sxs-lookup"><span data-stu-id="edcd9-117">Isolation level defines the degree to which the transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="edcd9-118">Det finns två isoleringsnivåer som stöds i tillförlitliga samlingar:</span><span class="sxs-lookup"><span data-stu-id="edcd9-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="edcd9-119">**Upprepbar läsning**: Anger att rapporterna inte kan läsa data som har ändrats, men ännu inte har skickats av andra transaktioner och att inga andra transaktioner kan ändra data som har lästs av den aktuella transaktionen tills den aktuella transaktionen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="edcd9-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by the current transaction until the current transaction finishes.</span></span> <span data-ttu-id="edcd9-120">Mer information finns i [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="edcd9-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="edcd9-121">**Ögonblicksbild**: Anger att data läses av någon instruktion i en transaktion är transaktionellt konsekvent versionen av informationen som fanns i början av transaktionen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-121">**Snapshot**: Specifies that data read by any statement in a transaction is the transactionally consistent version of the data that existed at the start of the transaction.</span></span>
  <span data-ttu-id="edcd9-122">Transaktionen kan identifiera endast dataändringar som har genomförts före början av transaktionen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-122">The transaction can recognize only data modifications that were committed before the start of the transaction.</span></span>
  <span data-ttu-id="edcd9-123">Dataändringar har gjorts av andra transaktioner efter starten av den aktuella transaktionen är inte synliga för instruktioner som körs i den aktuella transaktionen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-123">Data modifications made by other transactions after the start of the current transaction are not visible to statements executing in the current transaction.</span></span>
  <span data-ttu-id="edcd9-124">Effekten blir som om alla uttryck i en transaktion hämta en ögonblicksbild av den allokerade data som den såg i början av transaktionen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-124">The effect is as if the statements in a transaction get a snapshot of the committed data as it existed at the start of the transaction.</span></span>
  <span data-ttu-id="edcd9-125">Ögonblicksbilder är konsekventa för tillförlitlig samlingar.</span><span class="sxs-lookup"><span data-stu-id="edcd9-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="edcd9-126">Mer information finns i [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="edcd9-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="edcd9-127">Tillförlitliga samlingar väljer automatiskt Isoleringsnivån som ska användas för en viss Läsåtgärd beroende på åtgärden och rollen för repliken vid tidpunkten för skapandet av transaktionen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-127">Reliable Collections automatically choose the isolation level to use for a given read operation depending on the operation and the role of the replica at the time of transaction's creation.</span></span>
<span data-ttu-id="edcd9-128">Följande är den tabell som visar isolering nivån standardvärden för tillförlitlig ordlista och kön.</span><span class="sxs-lookup"><span data-stu-id="edcd9-128">Following is the table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="edcd9-129">Åtgärden \ roll</span><span class="sxs-lookup"><span data-stu-id="edcd9-129">Operation \ Role</span></span> | <span data-ttu-id="edcd9-130">Primär</span><span class="sxs-lookup"><span data-stu-id="edcd9-130">Primary</span></span> | <span data-ttu-id="edcd9-131">Sekundär</span><span class="sxs-lookup"><span data-stu-id="edcd9-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="edcd9-132">Läs för enhet</span><span class="sxs-lookup"><span data-stu-id="edcd9-132">Single Entity Read</span></span> |<span data-ttu-id="edcd9-133">Upprepbar läsning</span><span class="sxs-lookup"><span data-stu-id="edcd9-133">Repeatable Read</span></span> |<span data-ttu-id="edcd9-134">Ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="edcd9-134">Snapshot</span></span> |
| <span data-ttu-id="edcd9-135">Uppräkning, antal</span><span class="sxs-lookup"><span data-stu-id="edcd9-135">Enumeration, Count</span></span> |<span data-ttu-id="edcd9-136">Ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="edcd9-136">Snapshot</span></span> |<span data-ttu-id="edcd9-137">Ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="edcd9-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="edcd9-138">Vanliga exempel för den enda entiteten åtgärder är `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="edcd9-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="edcd9-139">Stöd för Läs din skriver både tillförlitliga ordlistan och tillförlitlig kön.</span><span class="sxs-lookup"><span data-stu-id="edcd9-139">Both the Reliable Dictionary and the Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="edcd9-140">Med andra ord visas alla skrivning i en transaktion för följande Läs som tillhör samma transaktion.</span><span class="sxs-lookup"><span data-stu-id="edcd9-140">In other words, any write within a transaction will be visible to a following read that belongs to the same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="edcd9-141">Lås</span><span class="sxs-lookup"><span data-stu-id="edcd9-141">Locks</span></span>
<span data-ttu-id="edcd9-142">I tillförlitliga samlingar alla transaktioner implementera rigorösa två fas låsning: en transaktion inte frigöra lås som den genererade tills transaktionen avslutas med ett avbrott eller ett genomförande.</span><span class="sxs-lookup"><span data-stu-id="edcd9-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release the locks it has acquired until the transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="edcd9-143">Tillförlitliga ordlista använder radnivå låsning för alla åtgärder för samma enhet.</span><span class="sxs-lookup"><span data-stu-id="edcd9-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="edcd9-144">Tillförlitliga kön användning av samtidighet för strikt transaktionella FIFO-egenskapen.</span><span class="sxs-lookup"><span data-stu-id="edcd9-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="edcd9-145">Tillförlitliga kön använder åtgärden nivån Lås så att en transaktion med `TryPeekAsync` och/eller `TryDequeueAsync` och en transaktion med `EnqueueAsync` i taget.</span><span class="sxs-lookup"><span data-stu-id="edcd9-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="edcd9-146">Observera att om du vill bevara FIFO, om en `TryPeekAsync` eller `TryDequeueAsync` någonsin iakttas att tillförlitliga kön är tom, låses också `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="edcd9-146">Note that to preserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that the Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="edcd9-147">Skriva operations alltid vidta exklusivt lås.</span><span class="sxs-lookup"><span data-stu-id="edcd9-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="edcd9-148">För läsåtgärder beror på låsning på ett antal faktorer.</span><span class="sxs-lookup"><span data-stu-id="edcd9-148">For read operations, the locking depends on a couple of factors.</span></span>
<span data-ttu-id="edcd9-149">Alla skrivskyddade åtgärd utfördes med ögonblicksbildisolering är låsfri.</span><span class="sxs-lookup"><span data-stu-id="edcd9-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="edcd9-150">Alla repeterbara Läsåtgärd som standard tar delade Lås.</span><span class="sxs-lookup"><span data-stu-id="edcd9-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="edcd9-151">Användaren kan dock be om något uppdateringslås i stället för det delade låset för alla skrivskyddade åtgärder som stöder Upprepbar läsning.</span><span class="sxs-lookup"><span data-stu-id="edcd9-151">However, for any read operation that supports Repeatable Read, the user can ask for an Update lock instead of the Shared lock.</span></span>
<span data-ttu-id="edcd9-152">Något uppdateringslås är ett asymmetriskt lås som används för att förhindra att en gemensam form av dödläge som uppstår när flera transaktioner låsa resurser för potentiella uppdateringar vid ett senare tillfälle.</span><span class="sxs-lookup"><span data-stu-id="edcd9-152">An Update lock is an asymmetric lock used to prevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="edcd9-153">Kompatibilitetsmatrix för lås finns i följande tabell:</span><span class="sxs-lookup"><span data-stu-id="edcd9-153">The lock compatibility matrix can be found in the following table:</span></span>

| <span data-ttu-id="edcd9-154">Begära \ beviljas</span><span class="sxs-lookup"><span data-stu-id="edcd9-154">Request \ Granted</span></span> | <span data-ttu-id="edcd9-155">Ingen</span><span class="sxs-lookup"><span data-stu-id="edcd9-155">None</span></span> | <span data-ttu-id="edcd9-156">Delad</span><span class="sxs-lookup"><span data-stu-id="edcd9-156">Shared</span></span> | <span data-ttu-id="edcd9-157">Uppdatering</span><span class="sxs-lookup"><span data-stu-id="edcd9-157">Update</span></span> | <span data-ttu-id="edcd9-158">Exklusivt</span><span class="sxs-lookup"><span data-stu-id="edcd9-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="edcd9-159">Delad</span><span class="sxs-lookup"><span data-stu-id="edcd9-159">Shared</span></span> |<span data-ttu-id="edcd9-160">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-160">No conflict</span></span> |<span data-ttu-id="edcd9-161">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-161">No conflict</span></span> |<span data-ttu-id="edcd9-162">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-162">Conflict</span></span> |<span data-ttu-id="edcd9-163">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-163">Conflict</span></span> |
| <span data-ttu-id="edcd9-164">Uppdatering</span><span class="sxs-lookup"><span data-stu-id="edcd9-164">Update</span></span> |<span data-ttu-id="edcd9-165">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-165">No conflict</span></span> |<span data-ttu-id="edcd9-166">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-166">No conflict</span></span> |<span data-ttu-id="edcd9-167">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-167">Conflict</span></span> |<span data-ttu-id="edcd9-168">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-168">Conflict</span></span> |
| <span data-ttu-id="edcd9-169">Exklusivt</span><span class="sxs-lookup"><span data-stu-id="edcd9-169">Exclusive</span></span> |<span data-ttu-id="edcd9-170">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-170">No conflict</span></span> |<span data-ttu-id="edcd9-171">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-171">Conflict</span></span> |<span data-ttu-id="edcd9-172">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-172">Conflict</span></span> |<span data-ttu-id="edcd9-173">Konflikt</span><span class="sxs-lookup"><span data-stu-id="edcd9-173">Conflict</span></span> |

<span data-ttu-id="edcd9-174">Timeout-argumentet i API: er för tillförlitlig samlingar används för identifiering av dödläge.</span><span class="sxs-lookup"><span data-stu-id="edcd9-174">Time-out argument in the Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="edcd9-175">Till exempel försöker två transaktioner (T1 och T2) läsa och uppdatera K1.</span><span class="sxs-lookup"><span data-stu-id="edcd9-175">For example, two transactions (T1 and T2) are trying to read and update K1.</span></span>
<span data-ttu-id="edcd9-176">Det är möjligt för dem att deadlock, eftersom de båda hamna med delade låset.</span><span class="sxs-lookup"><span data-stu-id="edcd9-176">It is possible for them to deadlock, because they both end up having the Shared lock.</span></span>
<span data-ttu-id="edcd9-177">I det här fallet gör en eller båda av åtgärderna timeout.</span><span class="sxs-lookup"><span data-stu-id="edcd9-177">In this case, one or both of the operations will time out.</span></span>

<span data-ttu-id="edcd9-178">Det här scenariot för deadlock är ett bra exempel på hur ett uppdateringslås kan förhindra deadlocks.</span><span class="sxs-lookup"><span data-stu-id="edcd9-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="edcd9-179">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="edcd9-179">Next steps</span></span>
* [<span data-ttu-id="edcd9-180">Arbeta med Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="edcd9-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="edcd9-181">Reliable Services-meddelanden</span><span class="sxs-lookup"><span data-stu-id="edcd9-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="edcd9-182">Tillförlitlig säkerhetskopiering och återställning (återställning)</span><span class="sxs-lookup"><span data-stu-id="edcd9-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="edcd9-183">Konfigurationen för hanteraren för tillförlitlig tillstånd</span><span class="sxs-lookup"><span data-stu-id="edcd9-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="edcd9-184">För utvecklare för tillförlitlig samlingar</span><span class="sxs-lookup"><span data-stu-id="edcd9-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

