---
title: "aaaTransactions och låslägen i Azure Service Fabric tillförlitliga samlingar | Microsoft Docs"
description: "Azure Service Fabric tillförlitliga tillstånd Manager och tillförlitlig samlingar transaktioner och låsa."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="0f6ed-103">Transaktioner och låslägen i Azure Service Fabric tillförlitliga samlingar</span><span class="sxs-lookup"><span data-stu-id="0f6ed-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="0f6ed-104">Transaktionen</span><span class="sxs-lookup"><span data-stu-id="0f6ed-104">Transaction</span></span>
<span data-ttu-id="0f6ed-105">En transaktion är en sekvens med åtgärder som utförs som en logisk enhet på arbetet.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="0f6ed-106">En transaktion måste ha hello följande ACID-egenskaper.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="0f6ed-107">(se: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="0f6ed-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="0f6ed-108">**Odelbarhet**: en transaktion måste vara ett atomic arbetsenheten.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="0f6ed-109">Med andra ord antingen alla dataändringar utförs eller ingen av dem har utförts.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="0f6ed-110">**Konsekvenskontroll**: när du är klar, en transaktion måste lämna alla data i ett konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="0f6ed-111">Alla interna datastrukturer måste vara rätt hello slutet av hello transaktion.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="0f6ed-112">**Isolering**: ändringar som görs av samtidiga transaktioner måste isoleras från hello ändringar har gjorts av andra samtidiga transaktioner.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="0f6ed-113">hello-Isoleringsnivån som används för en åtgärd i en ITransaction bestäms av hello IReliableState utför hello igen.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="0f6ed-114">**Hållbarhet**: när en transaktion har slutförts effekterna permanent är på plats i hello system.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="0f6ed-115">hello ändringar sparas även i hello händelse av ett systemfel.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="0f6ed-116">Isoleringsnivåer</span><span class="sxs-lookup"><span data-stu-id="0f6ed-116">Isolation levels</span></span>
<span data-ttu-id="0f6ed-117">Isoleringsnivå som definierar hello grad toowhich hello transaktion måste isoleras från ändringar som görs av andra transaktioner.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="0f6ed-118">Det finns två isoleringsnivåer som stöds i tillförlitliga samlingar:</span><span class="sxs-lookup"><span data-stu-id="0f6ed-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="0f6ed-119">**Upprepbar läsning**: Anger att rapporterna inte kan läsa data som har ändrats, men ännu inte har skickats av andra transaktioner och att inga andra transaktioner kan ändra data som har lästs av hello transaktionen tills hello aktuella transaktionen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="0f6ed-120">Mer information finns i [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f6ed-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="0f6ed-121">**Ögonblicksbild**: Anger att data läses av någon instruktion i en transaktion är hello transaktionellt konsekvens i hello data som fanns vid hello transaktionens hello början.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="0f6ed-122">hello transaktion kan identifiera endast dataändringar som har genomförts innan hello hello transaktion.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="0f6ed-123">Dataändringar har gjorts av andra transaktioner när hello början av hello transaktionen är inte synliga toostatements som körs i hello aktuella transaktionen.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="0f6ed-124">hello effekten är som om hello-satser i en transaktion hämta en ögonblicksbild av hello Allokerat data som den såg hello början av hello transaktion.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="0f6ed-125">Ögonblicksbilder är konsekventa för tillförlitlig samlingar.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="0f6ed-126">Mer information finns i [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f6ed-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="0f6ed-127">Tillförlitliga samlingar väljer automatiskt hello isolering nivå toouse för en viss Läsåtgärd beroende på hello igen och hello roll hello replik för närvarande hello transaktionens skapas.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="0f6ed-128">Följande är hello-tabell som visar isolering nivån standardvärden för tillförlitlig ordlista och kön.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="0f6ed-129">Åtgärden \ roll</span><span class="sxs-lookup"><span data-stu-id="0f6ed-129">Operation \ Role</span></span> | <span data-ttu-id="0f6ed-130">Primär</span><span class="sxs-lookup"><span data-stu-id="0f6ed-130">Primary</span></span> | <span data-ttu-id="0f6ed-131">Sekundär</span><span class="sxs-lookup"><span data-stu-id="0f6ed-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="0f6ed-132">Läs för enhet</span><span class="sxs-lookup"><span data-stu-id="0f6ed-132">Single Entity Read</span></span> |<span data-ttu-id="0f6ed-133">Upprepbar läsning</span><span class="sxs-lookup"><span data-stu-id="0f6ed-133">Repeatable Read</span></span> |<span data-ttu-id="0f6ed-134">Ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="0f6ed-134">Snapshot</span></span> |
| <span data-ttu-id="0f6ed-135">Uppräkning, antal</span><span class="sxs-lookup"><span data-stu-id="0f6ed-135">Enumeration, Count</span></span> |<span data-ttu-id="0f6ed-136">Ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="0f6ed-136">Snapshot</span></span> |<span data-ttu-id="0f6ed-137">Ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="0f6ed-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="0f6ed-138">Vanliga exempel för den enda entiteten åtgärder är `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="0f6ed-139">Både hello tillförlitliga ordlista och hello tillförlitliga kön stöd för Läs din skriver.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="0f6ed-140">Med andra ord skriva någon i en transaktion synliga tooa följande läses som tillhör toohello samma transaktion.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="0f6ed-141">Lås</span><span class="sxs-lookup"><span data-stu-id="0f6ed-141">Locks</span></span>
<span data-ttu-id="0f6ed-142">I tillförlitliga samlingar alla transaktioner implementera rigorösa två fas låsning: en transaktion inte släpptes hello lås som den genererade tills hello transaktion slutar med ett avbrott eller ett genomförande.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="0f6ed-143">Tillförlitliga ordlista använder radnivå låsning för alla åtgärder för samma enhet.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="0f6ed-144">Tillförlitliga kön användning av samtidighet för strikt transaktionella FIFO-egenskapen.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="0f6ed-145">Tillförlitliga kön använder åtgärden nivån Lås så att en transaktion med `TryPeekAsync` och/eller `TryDequeueAsync` och en transaktion med `EnqueueAsync` i taget.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="0f6ed-146">Observera att toopreserve FIFO, om en `TryPeekAsync` eller `TryDequeueAsync` någonsin iakttas att hello tillförlitliga kön är tom, låses också `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="0f6ed-147">Skriva operations alltid vidta exklusivt lås.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="0f6ed-148">För läsåtgärder beror hello låsning på ett antal faktorer.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="0f6ed-149">Alla skrivskyddade åtgärd utfördes med ögonblicksbildisolering är låsfri.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="0f6ed-150">Alla repeterbara Läsåtgärd som standard tar delade Lås.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="0f6ed-151">Men för alla skrivskyddade åtgärder som stöder Upprepbar läsning kan hello användare begära något uppdateringslås i stället för hello delade låset.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="0f6ed-152">Något uppdateringslås är ett asymmetriskt Lås används tooprevent en gemensam form av dödläge som uppstår när flera transaktioner låsa resurser för potentiella uppdateringar vid ett senare tillfälle.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="0f6ed-153">hello Lås kompatibilitetsmatrix finns i följande tabell hello:</span><span class="sxs-lookup"><span data-stu-id="0f6ed-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="0f6ed-154">Begära \ beviljas</span><span class="sxs-lookup"><span data-stu-id="0f6ed-154">Request \ Granted</span></span> | <span data-ttu-id="0f6ed-155">Ingen</span><span class="sxs-lookup"><span data-stu-id="0f6ed-155">None</span></span> | <span data-ttu-id="0f6ed-156">Delad</span><span class="sxs-lookup"><span data-stu-id="0f6ed-156">Shared</span></span> | <span data-ttu-id="0f6ed-157">Uppdatering</span><span class="sxs-lookup"><span data-stu-id="0f6ed-157">Update</span></span> | <span data-ttu-id="0f6ed-158">Exklusivt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="0f6ed-159">Delad</span><span class="sxs-lookup"><span data-stu-id="0f6ed-159">Shared</span></span> |<span data-ttu-id="0f6ed-160">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-160">No conflict</span></span> |<span data-ttu-id="0f6ed-161">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-161">No conflict</span></span> |<span data-ttu-id="0f6ed-162">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-162">Conflict</span></span> |<span data-ttu-id="0f6ed-163">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-163">Conflict</span></span> |
| <span data-ttu-id="0f6ed-164">Uppdatering</span><span class="sxs-lookup"><span data-stu-id="0f6ed-164">Update</span></span> |<span data-ttu-id="0f6ed-165">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-165">No conflict</span></span> |<span data-ttu-id="0f6ed-166">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-166">No conflict</span></span> |<span data-ttu-id="0f6ed-167">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-167">Conflict</span></span> |<span data-ttu-id="0f6ed-168">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-168">Conflict</span></span> |
| <span data-ttu-id="0f6ed-169">Exklusivt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-169">Exclusive</span></span> |<span data-ttu-id="0f6ed-170">Ingen konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-170">No conflict</span></span> |<span data-ttu-id="0f6ed-171">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-171">Conflict</span></span> |<span data-ttu-id="0f6ed-172">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-172">Conflict</span></span> |<span data-ttu-id="0f6ed-173">Konflikt</span><span class="sxs-lookup"><span data-stu-id="0f6ed-173">Conflict</span></span> |

<span data-ttu-id="0f6ed-174">Timeout-argument i hello tillförlitliga samlingar API: er används för identifiering av dödläge.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="0f6ed-175">Två transaktioner (T1 och T2) försöker tooread och uppdatera K1.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="0f6ed-176">Det är möjligt för dem toodeadlock, eftersom de båda hamna med hello delade låset.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="0f6ed-177">I det här fallet gör en eller båda av hello operations timeout.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="0f6ed-178">Det här scenariot för deadlock är ett bra exempel på hur ett uppdateringslås kan förhindra deadlocks.</span><span class="sxs-lookup"><span data-stu-id="0f6ed-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0f6ed-179">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="0f6ed-179">Next steps</span></span>
* [<span data-ttu-id="0f6ed-180">Arbeta med Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="0f6ed-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="0f6ed-181">Reliable Services-meddelanden</span><span class="sxs-lookup"><span data-stu-id="0f6ed-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="0f6ed-182">Tillförlitlig säkerhetskopiering och återställning (återställning)</span><span class="sxs-lookup"><span data-stu-id="0f6ed-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="0f6ed-183">Konfigurationen för hanteraren för tillförlitlig tillstånd</span><span class="sxs-lookup"><span data-stu-id="0f6ed-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="0f6ed-184">För utvecklare för tillförlitlig samlingar</span><span class="sxs-lookup"><span data-stu-id="0f6ed-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

