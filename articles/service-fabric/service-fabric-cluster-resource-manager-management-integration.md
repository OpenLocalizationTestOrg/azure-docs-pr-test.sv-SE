---
title: aaaService Fabric klustret Resource Manager - integrering | Microsoft Docs
description: "En översikt över hello integration punkter mellan hello klustret Resource Manager och Service Fabric."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 956cd0b8-b6e3-4436-a224-8766320e8cd7
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 9a24c9de121fbe2e8e5e8e4d117e64686918936a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="cluster-resource-manager-integration-with-service-fabric-cluster-management"></a><span data-ttu-id="6241d-103">Klustret resource manager-integrering med hantering av Service Fabric-kluster</span><span class="sxs-lookup"><span data-stu-id="6241d-103">Cluster resource manager integration with Service Fabric cluster management</span></span>
<span data-ttu-id="6241d-104">hello resurshanteraren för Service Fabric-klustret enheten inte uppgraderingar i Service Fabric, men den är inblandad.</span><span class="sxs-lookup"><span data-stu-id="6241d-104">hello Service Fabric Cluster Resource Manager doesn't drive upgrades in Service Fabric, but it is involved.</span></span> <span data-ttu-id="6241d-105">hello första sätt hello klustret Resource Manager hjälper dig med hantering av spårning hello önskade hello kluster och hello tjänster i den.</span><span class="sxs-lookup"><span data-stu-id="6241d-105">hello first way that hello Cluster Resource Manager helps with management is by tracking hello desired state of hello cluster and hello services inside it.</span></span> <span data-ttu-id="6241d-106">hello klustret Resource Manager skickar ut hälsorapporter när den inte kan försätta hello klustret i hello önskad konfiguration.</span><span class="sxs-lookup"><span data-stu-id="6241d-106">hello Cluster Resource Manager sends out health reports when it cannot put hello cluster into hello desired configuration.</span></span> <span data-ttu-id="6241d-107">Till exempel om det finns inte tillräckligt skickar kapacitet hello klustret Resource Manager ut hälsa varningar och fel som indikerar hello problem.</span><span class="sxs-lookup"><span data-stu-id="6241d-107">For example, if there is insufficient capacity hello Cluster Resource Manager sends out health warnings and errors indicating hello problem.</span></span> <span data-ttu-id="6241d-108">En annan typ av integrering har toodo med så här fungerar uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-108">Another piece of integration has toodo with how upgrades work.</span></span> <span data-ttu-id="6241d-109">hello klustret Resource Manager ändrar sitt beteende något under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-109">hello Cluster Resource Manager alters its behavior slightly during upgrades.</span></span>  

## <a name="health-integration"></a><span data-ttu-id="6241d-110">Integrering av hälsotillstånd</span><span class="sxs-lookup"><span data-stu-id="6241d-110">Health integration</span></span>
<span data-ttu-id="6241d-111">hello klustret Resource Manager spårar ständigt hello regler som har definierats för att placera dina tjänster.</span><span class="sxs-lookup"><span data-stu-id="6241d-111">hello Cluster Resource Manager constantly tracks hello rules you have defined for placing your services.</span></span> <span data-ttu-id="6241d-112">Den spårar också hello återstående kapacitet för varje mått på hello noder och i hello kluster och hello klustret som helhet.</span><span class="sxs-lookup"><span data-stu-id="6241d-112">It also tracks hello remaining capacity for each metric on hello nodes and in hello cluster and in hello cluster as a whole.</span></span> <span data-ttu-id="6241d-113">Om den inte kan uppfylla dessa regler eller om det finns tillräcklig kapacitet orsakat hälsa varningar och fel.</span><span class="sxs-lookup"><span data-stu-id="6241d-113">If it can't satisfy those rules or if there is insufficient capacity, health warnings and errors are emitted.</span></span> <span data-ttu-id="6241d-114">Till exempel om en nod är över kapacitet och hello försöker klustret Resource Manager toofix hello situationen genom att flytta tjänster.</span><span class="sxs-lookup"><span data-stu-id="6241d-114">For example, if a node is over capacity and hello Cluster Resource Manager will try toofix hello situation by moving services.</span></span> <span data-ttu-id="6241d-115">Om den inte kan korrigera hello situationen skickar en varning om hälsa som anger vilken nod är överbelastade och för vilka mått.</span><span class="sxs-lookup"><span data-stu-id="6241d-115">If it can't correct hello situation it emits a health warning indicating which node is over capacity, and for which metrics.</span></span>

<span data-ttu-id="6241d-116">Ett annat exempel på hello Resource Manager hälsovarningar är överträdelser av placeringsbegränsningar.</span><span class="sxs-lookup"><span data-stu-id="6241d-116">Another example of hello Resource Manager's health warnings is violations of placement constraints.</span></span> <span data-ttu-id="6241d-117">Till exempel om du har definierat begränsningen placering (som `“NodeColor == Blue”`) och hello Resource Manager identifierar ett brott mot denna begränsning, den genererar en varning om hälsa.</span><span class="sxs-lookup"><span data-stu-id="6241d-117">For example, if you have defined a placement constraint (such as `“NodeColor == Blue”`) and hello Resource Manager detects a violation of that constraint, it emits a health warning.</span></span> <span data-ttu-id="6241d-118">Detta gäller för anpassade villkor och hello standardbegränsningar (till exempel hello fel och uppgradera domänen begränsningar).</span><span class="sxs-lookup"><span data-stu-id="6241d-118">This is true for custom constraints and hello default constraints (like hello Fault Domain and Upgrade Domain constraints).</span></span>

<span data-ttu-id="6241d-119">Här är ett exempel på en sådan hälsorapport.</span><span class="sxs-lookup"><span data-stu-id="6241d-119">Here’s an example of one such health report.</span></span> <span data-ttu-id="6241d-120">I det här fallet är hello hälsorapport för en av hello systemtjänsten partitioner.</span><span class="sxs-lookup"><span data-stu-id="6241d-120">In this case, hello health report is for one of hello system service’s partitions.</span></span> <span data-ttu-id="6241d-121">hälsningsmeddelande hälsa anger hello repliker av den partitionen tillfälligt packas i för få uppgradera domäner.</span><span class="sxs-lookup"><span data-stu-id="6241d-121">hello health message indicates hello replicas of that partition are temporarily packed into too few Upgrade Domains.</span></span>

```posh
PS C:\Users\User > Get-WindowsFabricPartitionHealth -PartitionId '00000000-0000-0000-0000-000000000001'


PartitionId           : 00000000-0000-0000-0000-000000000001
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='System.PLB', Property='ReplicaConstraintViolation_UpgradeDomain', HealthState='Warning', ConsiderWarningAsError=false.

ReplicaHealthStates   :
                        ReplicaId             : 130766528804733380
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577821
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528854889931
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577822
                        AggregatedHealthState : Ok

                        ReplicaId             : 130837073190680024
                        AggregatedHealthState : Ok

HealthEvents          :
                        SourceId              : System.PLB
                        Property              : ReplicaConstraintViolation_UpgradeDomain
                        HealthState           : Warning
                        SequenceNumber        : 130837100116930204
                        SentAt                : 8/10/2015 7:53:31 PM
                        ReceivedAt            : 8/10/2015 7:53:33 PM
                        TTL                   : 00:01:05
                        Description           : hello Load Balancer has detected a Constraint Violation for this Replica: fabric:/System/FailoverManagerService Secondary Partition 00000000-0000-0000-0000-000000000001 is
                        violating hello Constraint: UpgradeDomain Details: UpgradeDomain ID -- 4, Replica on NodeName -- Node.8 Currently Upgrading -- false Distribution Policy -- Packing
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : Ok->Warning = 8/10/2015 7:13:02 PM, LastError = 1/1/0001 12:00:00 AM
```

<span data-ttu-id="6241d-122">Här är vad meddelandet hälsa tala om för oss är:</span><span class="sxs-lookup"><span data-stu-id="6241d-122">Here's what this health message is telling us is:</span></span>

1. <span data-ttu-id="6241d-123">Alla hello repliker själva är felfria: varje har AggregatedHealthState: Ok</span><span class="sxs-lookup"><span data-stu-id="6241d-123">All hello replicas themselves are healthy: Each has AggregatedHealthState : Ok</span></span>
2. <span data-ttu-id="6241d-124">hello uppgradera distributionsplatsen domänbegränsningar överskrids för närvarande.</span><span class="sxs-lookup"><span data-stu-id="6241d-124">hello Upgrade Domain distribution constraint is currently being violated.</span></span> <span data-ttu-id="6241d-125">Det innebär att en viss uppgradera domän har flera repliker från den här partitionen än den borde.</span><span class="sxs-lookup"><span data-stu-id="6241d-125">This means a particular Upgrade Domain has more replicas from this partition than it should.</span></span>
3. <span data-ttu-id="6241d-126">Vilken nod som innehåller hello replik orsakar hello överträdelse.</span><span class="sxs-lookup"><span data-stu-id="6241d-126">Which node contains hello replica causing hello violation.</span></span> <span data-ttu-id="6241d-127">I det här fallet är den hello noden med hello namnet ”Node.8”</span><span class="sxs-lookup"><span data-stu-id="6241d-127">In this case it's hello node with hello name "Node.8"</span></span>
4. <span data-ttu-id="6241d-128">Om en uppgradering för närvarande pågår för detta partitions (”för närvarande uppgradering--false”)</span><span class="sxs-lookup"><span data-stu-id="6241d-128">Whether an upgrade is currently happening for this partition ("Currently Upgrading -- false")</span></span>
5. <span data-ttu-id="6241d-129">hello principen för programdistribution för den här tjänsten: ”Distribution princip--packkorg”.</span><span class="sxs-lookup"><span data-stu-id="6241d-129">hello distribution policy for this service: "Distribution Policy -- Packing".</span></span> <span data-ttu-id="6241d-130">Detta styrs av hello `RequireDomainDistribution` [policy placering](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="6241d-130">This is governed by hello `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="6241d-131">”Packa” anger att i det här fallet DomainDistribution _inte_ krävs, så att vi vet att policy placering inte har angetts för den här tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6241d-131">"Packing" indicates that in this case DomainDistribution was _not_ required, so we know that placement policy was not specified for this service.</span></span> 
6. <span data-ttu-id="6241d-132">När hello rapporten har hänt - 8/10/2015 7:13:02 PM.</span><span class="sxs-lookup"><span data-stu-id="6241d-132">When hello report happened - 8/10/2015 7:13:02 PM</span></span>

<span data-ttu-id="6241d-133">Information som den här befogenheter aviseringar att brand i produktion toolet du vet att något är fel och är också används toodetect och stoppa felaktiga uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-133">Information like this powers alerts that fire in production toolet you know something has gone wrong and is also used toodetect and halt bad upgrades.</span></span> <span data-ttu-id="6241d-134">I det här fallet kan vi toosee om vi kan ta reda på varför hello Resource Manager hade toopack hello repliker i hello uppgraderingen domän.</span><span class="sxs-lookup"><span data-stu-id="6241d-134">In this case, we’d want toosee if we can figure out why hello Resource Manager had toopack hello replicas into hello Upgrade Domain.</span></span> <span data-ttu-id="6241d-135">Vanligtvis packa är tillfälligt eftersom hello noder i hello andra uppgradera domäner inte ned, t.ex.</span><span class="sxs-lookup"><span data-stu-id="6241d-135">Usually packing is transient because hello nodes in hello other Upgrade Domains were down, for example.</span></span>

<span data-ttu-id="6241d-136">Anta att hello klustret Resource Manager försöker tooplace vissa tjänster, men det inte finns några lösningar som fungerar.</span><span class="sxs-lookup"><span data-stu-id="6241d-136">Let’s say hello Cluster Resource Manager is trying tooplace some services, but there aren't any solutions that work.</span></span> <span data-ttu-id="6241d-137">När tjänster inte kan placeras, är det vanligtvis på något av följande orsaker hello:</span><span class="sxs-lookup"><span data-stu-id="6241d-137">When services can't be placed, it is usually for one of hello following reasons:</span></span>

1. <span data-ttu-id="6241d-138">Vissa övergående tillstånd har gjort det omöjligt tooplace den här tjänstinstansen eller replik korrekt</span><span class="sxs-lookup"><span data-stu-id="6241d-138">Some transient condition has made it impossible tooplace this service instance or replica correctly</span></span>
2. <span data-ttu-id="6241d-139">hello service placering kraven är unsatisfiable.</span><span class="sxs-lookup"><span data-stu-id="6241d-139">hello service’s placement requirements are unsatisfiable.</span></span>

<span data-ttu-id="6241d-140">I dessa fall kan hjälpa dig att avgöra varför hello-tjänsten kan inte placeras i hälsorapporter från hello klustret Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="6241d-140">In these cases, health reports from hello Cluster Resource Manager help you determine why hello service can’t be placed.</span></span> <span data-ttu-id="6241d-141">Vi kallar processen hello begränsningen eliminering sekvensen.</span><span class="sxs-lookup"><span data-stu-id="6241d-141">We call this process hello constraint elimination sequence.</span></span> <span data-ttu-id="6241d-142">Under den stegvisa hello system hello konfigurerade begränsningar som påverkar hello-tjänsten och poster de undanröjer.</span><span class="sxs-lookup"><span data-stu-id="6241d-142">During it, hello system walks through hello configured constraints affecting hello service and records what they eliminate.</span></span> <span data-ttu-id="6241d-143">Det här sättet när tjänster inte kan toobe placeras, du kan se vilka noder har tagits bort och varför.</span><span class="sxs-lookup"><span data-stu-id="6241d-143">This way when services aren’t able toobe placed, you can see which nodes were eliminated and why.</span></span>

## <a name="constraint-types"></a><span data-ttu-id="6241d-144">Villkorstyper</span><span class="sxs-lookup"><span data-stu-id="6241d-144">Constraint types</span></span>
<span data-ttu-id="6241d-145">Vi pratar om var och en av hello olika begränsningar i dessa rapporter om hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="6241d-145">Let’s talk about each of hello different constraints in these health reports.</span></span> <span data-ttu-id="6241d-146">Hälsotillstånd meddelanden relaterade toothese begränsningar visas när repliker inte kan placeras.</span><span class="sxs-lookup"><span data-stu-id="6241d-146">You will see health messages related toothese constraints when replicas can't be placed.</span></span>

* <span data-ttu-id="6241d-147">**ReplicaExclusionStatic** och **ReplicaExclusionDynamic**: dessa villkor anger att en lösning avvisades eftersom två tjänstobjekt från hello samma partition skulle ha toobe placerad hello samma nod.</span><span class="sxs-lookup"><span data-stu-id="6241d-147">**ReplicaExclusionStatic** and **ReplicaExclusionDynamic**: These constraints indicates that a solution was rejected because two service objects from hello same partition would have toobe placed on hello same node.</span></span> <span data-ttu-id="6241d-148">Detta är inte tillåten eftersom sedan fel på noden påverkar alltför partitionen.</span><span class="sxs-lookup"><span data-stu-id="6241d-148">This isn’t allowed because then failure of that node would overly impact that partition.</span></span> <span data-ttu-id="6241d-149">ReplicaExclusionStatic och ReplicaExclusionDynamic är nästan hello samma regel och hello skillnader inte verkligen är viktiga.</span><span class="sxs-lookup"><span data-stu-id="6241d-149">ReplicaExclusionStatic and ReplicaExclusionDynamic are almost hello same rule and hello differences don't really matter.</span></span> <span data-ttu-id="6241d-150">Om du ser en begränsning eliminering sekvens som innehåller antingen hello ReplicaExclusionStatic eller ReplicaExclusionDynamic begränsning, hello klustret Resource Manager tror att det inte finns tillräckligt med noder.</span><span class="sxs-lookup"><span data-stu-id="6241d-150">If you are seeing a constraint elimination sequence containing either hello ReplicaExclusionStatic or ReplicaExclusionDynamic constraint, hello Cluster Resource Manager thinks that there aren’t enough nodes.</span></span> <span data-ttu-id="6241d-151">Detta kräver återstående lösningar toouse dessa ogiltig placeringar som inte är tillåtet.</span><span class="sxs-lookup"><span data-stu-id="6241d-151">This requires remaining solutions toouse these invalid placements which are disallowed.</span></span> <span data-ttu-id="6241d-152">hello kommer andra begränsningar i hello sekvens vanligtvis berätta varför noder elimineras i hello första plats.</span><span class="sxs-lookup"><span data-stu-id="6241d-152">hello other constraints in hello sequence will usually tell us why nodes are being eliminated in hello first place.</span></span>
* <span data-ttu-id="6241d-153">**PlacementConstraint**: Om du ser det här meddelandet innebär att vi elimineras vissa noder eftersom de matchade hello service placeringen.</span><span class="sxs-lookup"><span data-stu-id="6241d-153">**PlacementConstraint**: If you see this message, it means that we eliminated some nodes because they didn’t match hello service’s placement constraints.</span></span> <span data-ttu-id="6241d-154">Vi spåra ut placeringen hello har konfigurerats som en del av det här meddelandet.</span><span class="sxs-lookup"><span data-stu-id="6241d-154">We trace out hello currently configured placement constraints as a part of this message.</span></span> <span data-ttu-id="6241d-155">Detta är normalt om du har en begränsning för placering som definierats.</span><span class="sxs-lookup"><span data-stu-id="6241d-155">This is normal if you have a placement constraint defined.</span></span> <span data-ttu-id="6241d-156">Men om placering begränsningen felaktigt orsakar för många noder toobe elimineras det här är hur du vill se.</span><span class="sxs-lookup"><span data-stu-id="6241d-156">However, if placement constraint is incorrectly causing too many nodes toobe eliminated this is how you would notice.</span></span>
* <span data-ttu-id="6241d-157">**NodeCapacity**: den här begränsningen innebär att hello klustret Resource Manager inte kunde placera hello repliker på hello anges noder eftersom som skulle placera dem över kapacitet.</span><span class="sxs-lookup"><span data-stu-id="6241d-157">**NodeCapacity**: This constraint means that hello Cluster Resource Manager couldn’t place hello replicas on hello indicated nodes because that would put them over capacity.</span></span>
* <span data-ttu-id="6241d-158">**Tillhörighet**: det här villkoret visar vi inte kunde placera hello replik på hello påverkas noder eftersom det skulle orsaka en överträdelse av hello tillhörighet begränsningen.</span><span class="sxs-lookup"><span data-stu-id="6241d-158">**Affinity**: This constraint indicates that we couldn’t place hello replica on hello affected nodes since it would cause a violation of hello affinity constraint.</span></span> <span data-ttu-id="6241d-159">Mer information om mappning mellan är i [i den här artikeln](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span><span class="sxs-lookup"><span data-stu-id="6241d-159">More information on affinity is in [this article](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span></span>
* <span data-ttu-id="6241d-160">**FaultDomain** och **UpgradeDomain**: den här begränsningen eliminerar noder om du placerar hello repliken på hello angett noder skulle orsaka packa i ett visst fel eller en domän.</span><span class="sxs-lookup"><span data-stu-id="6241d-160">**FaultDomain** and **UpgradeDomain**: This constraint eliminates nodes if placing hello replica on hello indicated nodes would cause packing in a particular fault or upgrade domain.</span></span> <span data-ttu-id="6241d-161">Flera exempel diskutera detta villkor visas i avsnittet hello på [fel- och begränsningar för domänen och resultatet](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="6241d-161">Several examples discussing this constraint are presented in hello topic on [fault and upgrade domain constraints and resulting behavior](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
* <span data-ttu-id="6241d-162">**PreferredLocation**: du normalt inte bör se den här begränsningen att ta bort noder från hello lösning eftersom den körs som en optimering som standard.</span><span class="sxs-lookup"><span data-stu-id="6241d-162">**PreferredLocation**: You shouldn’t normally see this constraint removing nodes from hello solution since it runs as an optimization by default.</span></span> <span data-ttu-id="6241d-163">hello önskade platsbegränsningen finns också under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-163">hello preferred location constraint is also present during upgrades.</span></span> <span data-ttu-id="6241d-164">Det är används toomove tjänster tillbaka toowhere när hello uppgraderingen igång under uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="6241d-164">During upgrade it is used toomove services back toowhere they were when hello upgrade started.</span></span>

## <a name="blocklisting-nodes"></a><span data-ttu-id="6241d-165">Blocklisting noder</span><span class="sxs-lookup"><span data-stu-id="6241d-165">Blocklisting Nodes</span></span>
<span data-ttu-id="6241d-166">Ett annat meddelande hello klustret Resource Manager hälsorapporter är när noder är blocklisted.</span><span class="sxs-lookup"><span data-stu-id="6241d-166">Another health message hello Cluster Resource Manager reports is when nodes are blocklisted.</span></span> <span data-ttu-id="6241d-167">Du kan se blocklisting som en tillfällig begränsning som tillämpas automatiskt åt dig.</span><span class="sxs-lookup"><span data-stu-id="6241d-167">You can think of blocklisting as a temporary constraint that is automatically applied for you.</span></span> <span data-ttu-id="6241d-168">Noder får blocklisted när de har upprepade fel när den startas instanser av den typ av tjänst.</span><span class="sxs-lookup"><span data-stu-id="6241d-168">Nodes get blocklisted when they experience repeated failures when launching instances of that service type.</span></span> <span data-ttu-id="6241d-169">Noderna är blocklisted på grundval av per tjänsttyp.</span><span class="sxs-lookup"><span data-stu-id="6241d-169">Nodes are blocklisted on a per-service-type basis.</span></span> <span data-ttu-id="6241d-170">En nod kan vara blocklisted för en tjänst men inte en annan.</span><span class="sxs-lookup"><span data-stu-id="6241d-170">A node may be blocklisted for one service type but not another.</span></span> 

<span data-ttu-id="6241d-171">Du ser blocklisting startar ofta under utveckling: vissa bugg orsakar toocrash din service-värden vid start.</span><span class="sxs-lookup"><span data-stu-id="6241d-171">You'll see blocklisting kick in often during development: some bug causes your service host toocrash on startup.</span></span> <span data-ttu-id="6241d-172">Service Fabric toocreate hello tjänstvärden några gånger och i hello felet kvarstår.</span><span class="sxs-lookup"><span data-stu-id="6241d-172">Service Fabric tries toocreate hello service host a few times, and hello failure keeps occurring.</span></span> <span data-ttu-id="6241d-173">Efter några försök hello nod hämtar blocklisted och hello klustret Resource Manager försöker toocreate hello service någon annanstans.</span><span class="sxs-lookup"><span data-stu-id="6241d-173">After a few attempts, hello node gets blocklisted, and hello Cluster Resource Manager will try toocreate hello service elsewhere.</span></span> <span data-ttu-id="6241d-174">Om felet upprepas på flera noder, är det möjligt att alla giltiga hello-noder i hello klustret hamnar blockeras.</span><span class="sxs-lookup"><span data-stu-id="6241d-174">If that failure keeps happening on multiple nodes, it's possible that all of hello valid nodes in hello cluster end up blocked.</span></span> <span data-ttu-id="6241d-175">Blocklisting kan också ta bort så många noder finns inte tillräckligt med kan har starta hello service toomeet hello önskad skala.</span><span class="sxs-lookup"><span data-stu-id="6241d-175">Blocklisting cna also remove so many nodes that not enough can successfully launch hello service toomeet hello desired scale.</span></span> <span data-ttu-id="6241d-176">Normalt visas ytterligare fel eller varningar från hello klustret Resource Manager som anger att hello service understiger hello önskade replik eller instansantal, samt hälsa meddelanden som anger vilket hello-felet är som leder toohello blocklisting hello första plats.</span><span class="sxs-lookup"><span data-stu-id="6241d-176">You'll typically see additional errors or warnings from hello Cluster Resource Manager indicating that hello service is below hello desired replica or instance count, as well as health messages indicating what hello failure is that's leading toohello blocklisting in hello first place.</span></span>

<span data-ttu-id="6241d-177">Blocklisting är inte ett permanent villkor.</span><span class="sxs-lookup"><span data-stu-id="6241d-177">Blocklisting is not a permanent condition.</span></span> <span data-ttu-id="6241d-178">Hello noden tas bort från hello blocklist och Service Fabric kan aktivera hello tjänster på noden igen efter några minuter.</span><span class="sxs-lookup"><span data-stu-id="6241d-178">After a few minutes, hello node is removed from hello blocklist and Service Fabric may activate hello services on that node again.</span></span> <span data-ttu-id="6241d-179">Om tjänster fortsätter toofail hello noden är blocklisted för tjänsten igen.</span><span class="sxs-lookup"><span data-stu-id="6241d-179">If services continue toofail, hello node is blocklisted for that service type again.</span></span> 

### <a name="constraint-priorities"></a><span data-ttu-id="6241d-180">Begränsningen prioriteter</span><span class="sxs-lookup"><span data-stu-id="6241d-180">Constraint priorities</span></span>

> [!WARNING]
> <span data-ttu-id="6241d-181">Ändra begränsningen prioriteter rekommenderas inte och kan ha betydande negativa effekter på klustret.</span><span class="sxs-lookup"><span data-stu-id="6241d-181">Changing constraint priorities is not recommended and may have significant adverse effects on your cluster.</span></span> <span data-ttu-id="6241d-182">hello informationen nedan ges för referens hello standard begränsningen prioriteringar och deras beteende.</span><span class="sxs-lookup"><span data-stu-id="6241d-182">hello below information is provided for reference of hello default constraint priorities and their behavior.</span></span> 
>

<span data-ttu-id="6241d-183">Med alla dessa villkor, kan du ha tänker ”Hej – jag tror att fel domän begränsningar är hello viktigaste i systemet.</span><span class="sxs-lookup"><span data-stu-id="6241d-183">With all of these constraints, you may have been thinking “Hey – I think that fault domain constraints are hello most important thing in my system.</span></span> <span data-ttu-id="6241d-184">I ordning tooensure hello fel domänbegränsningar inte bröt mot, jag är beredda tooviolate andra begränsningar ”.</span><span class="sxs-lookup"><span data-stu-id="6241d-184">In order tooensure hello fault domain constraint isn't violated, I’m willing tooviolate other constraints.”</span></span>

<span data-ttu-id="6241d-185">Begränsningar kan konfigureras med olika prioritet.</span><span class="sxs-lookup"><span data-stu-id="6241d-185">Constraints can be configured with different priority levels.</span></span> <span data-ttu-id="6241d-186">Dessa är:</span><span class="sxs-lookup"><span data-stu-id="6241d-186">These are:</span></span>

   - <span data-ttu-id="6241d-187">”hårda” (0)</span><span class="sxs-lookup"><span data-stu-id="6241d-187">“hard” (0)</span></span>
   - <span data-ttu-id="6241d-188">”soft” (1)</span><span class="sxs-lookup"><span data-stu-id="6241d-188">“soft” (1)</span></span>
   - <span data-ttu-id="6241d-189">”optimering” (2)</span><span class="sxs-lookup"><span data-stu-id="6241d-189">“optimization” (2)</span></span>
   - <span data-ttu-id="6241d-190">”off” (-1).</span><span class="sxs-lookup"><span data-stu-id="6241d-190">“off” (-1).</span></span> 
   
<span data-ttu-id="6241d-191">De flesta av hello villkor är som standard konfigurerade som hårda villkor.</span><span class="sxs-lookup"><span data-stu-id="6241d-191">Most of hello constraints are configured as hard constraints by default.</span></span>

<span data-ttu-id="6241d-192">Det är ovanligt att ändra hello prioritet med begränsningar.</span><span class="sxs-lookup"><span data-stu-id="6241d-192">Changing hello priority of constraints is uncommon.</span></span> <span data-ttu-id="6241d-193">Det har förekommit gånger där begränsningen prioriteter behövs toochange, vanligtvis toowork runt några fel eller beteende som påverkade hello-miljö.</span><span class="sxs-lookup"><span data-stu-id="6241d-193">There have been times where constraint priorities needed toochange, usually toowork around some other bug or behavior that was impacting hello environment.</span></span> <span data-ttu-id="6241d-194">Vanligtvis hello flexibilitet hello begränsningen prioritet infrastruktur har arbetat mycket bra, men det behövs inte ofta.</span><span class="sxs-lookup"><span data-stu-id="6241d-194">Generally hello flexibility of hello constraint priority infrastructure has worked very well, but it isn't needed often.</span></span> <span data-ttu-id="6241d-195">De flesta hello tid allt placeras på deras Standardprioriteter.</span><span class="sxs-lookup"><span data-stu-id="6241d-195">Most of hello time everything sits at their default priorities.</span></span> 

<span data-ttu-id="6241d-196">hello prioritetsnivå inte innebär att ett visst villkor _kommer_ ha brutits, eller som ska alltid vara uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="6241d-196">hello priority levels don't mean that a given constraint _will_ be violated, nor that it will always be met.</span></span> <span data-ttu-id="6241d-197">Begränsningen prioriteter definiera begränsningar är framtvingade i vilken ordning.</span><span class="sxs-lookup"><span data-stu-id="6241d-197">Constraint priorities define an order in which constraints are enforced.</span></span> <span data-ttu-id="6241d-198">Prioriteringar definiera hello kompromisser när det är omöjligt toosatisfy alla begränsningar.</span><span class="sxs-lookup"><span data-stu-id="6241d-198">Priorities define hello tradeoffs when it is impossible toosatisfy all constraints.</span></span> <span data-ttu-id="6241d-199">Vanligtvis uppfyllas alla hello villkor om det inte finns något annat i hello-miljö.</span><span class="sxs-lookup"><span data-stu-id="6241d-199">Usually all hello constraints can be satisfied unless there's something else going on in hello environment.</span></span> <span data-ttu-id="6241d-200">Några exempel på scenarier som dirigerar tooconstraint överträdelser är motstridiga villkor eller stort antal samtidiga fel.</span><span class="sxs-lookup"><span data-stu-id="6241d-200">Some examples of scenarios that will lead tooconstraint violations are conflicting constraints, or large numbers of concurrent failures.</span></span>

<span data-ttu-id="6241d-201">I avancerade fall kan ändra du hello begränsningen prioriteter.</span><span class="sxs-lookup"><span data-stu-id="6241d-201">In advanced situations, you can change hello constraint priorities.</span></span> <span data-ttu-id="6241d-202">Anta exempelvis att du vill ha tooensure att tillhörighet skulle alltid ha brutits när nödvändiga toosolve nod kapacitet.</span><span class="sxs-lookup"><span data-stu-id="6241d-202">For example, say you wanted tooensure that affinity would always be violated when necessary toosolve node capacity issues.</span></span> <span data-ttu-id="6241d-203">tooachieve, kan du ange hello prioritet för för ”soft” hello tillhörighet begränsningen (1) och lämna hello kapacitet villkor med värdet för ”svårt” (0).</span><span class="sxs-lookup"><span data-stu-id="6241d-203">tooachieve this, you could set hello priority of hello affinity constraint too“soft” (1) and leave hello capacity constraint set too“hard” (0).</span></span>

<span data-ttu-id="6241d-204">hello prioritet standardvärden för hello olika villkor har angetts i hello följande konfiguration:</span><span class="sxs-lookup"><span data-stu-id="6241d-204">hello default priority values for hello different constraints are specified in hello following config:</span></span>

<span data-ttu-id="6241d-205">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="6241d-205">ClusterManifest.xml</span></span>

```xml
        <Section Name="PlacementAndLoadBalancing">
            <Parameter Name="PlacementConstraintPriority" Value="0" />
            <Parameter Name="CapacityConstraintPriority" Value="0" />
            <Parameter Name="AffinityConstraintPriority" Value="0" />
            <Parameter Name="FaultDomainConstraintPriority" Value="0" />
            <Parameter Name="UpgradeDomainConstraintPriority" Value="1" />
            <Parameter Name="PreferredLocationConstraintPriority" Value="2" />
        </Section>
```

<span data-ttu-id="6241d-206">värdbaserade kluster via ClusterConfig.json för fristående distributioner eller Template.json för Azure:</span><span class="sxs-lookup"><span data-stu-id="6241d-206">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "PlacementConstraintPriority",
          "value": "0"
      },
      {
          "name": "CapacityConstraintPriority",
          "value": "0"
      },
      {
          "name": "AffinityConstraintPriority",
          "value": "0"
      },
      {
          "name": "FaultDomainConstraintPriority",
          "value": "0"
      },
      {
          "name": "UpgradeDomainConstraintPriority",
          "value": "1"
      },
      {
          "name": "PreferredLocationConstraintPriority",
          "value": "2"
      }
    ]
  }
]
```

## <a name="fault-domain-and-upgrade-domain-constraints"></a><span data-ttu-id="6241d-207">Fel domän- och begränsningar för domänen</span><span class="sxs-lookup"><span data-stu-id="6241d-207">Fault domain and upgrade domain constraints</span></span>
<span data-ttu-id="6241d-208">hello klustret Resource Manager vill tookeep services sprids ut bland fel- och domäner.</span><span class="sxs-lookup"><span data-stu-id="6241d-208">hello Cluster Resource Manager wants tookeep services spread out among fault and upgrade domains.</span></span> <span data-ttu-id="6241d-209">Den modeller detta som en begränsning i hello klustret Resource Manager-motorn.</span><span class="sxs-lookup"><span data-stu-id="6241d-209">It models this as a constraint inside hello Cluster Resource Manager’s engine.</span></span> <span data-ttu-id="6241d-210">För mer information om hur de används och deras specifika beteende, kolla hello artikel på [klusterkonfigurationen](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span><span class="sxs-lookup"><span data-stu-id="6241d-210">For more information on how they are used and their specific behavior, check out hello article on [cluster configuration](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span></span>

<span data-ttu-id="6241d-211">hello klustret Resource Manager behöva toopack några repliker i en uppgraderingsdomän i ordning toodeal med uppgraderingar, fel eller andra kränkningar begränsningen.</span><span class="sxs-lookup"><span data-stu-id="6241d-211">hello Cluster Resource Manager may need toopack a couple replicas into an upgrade domain in order toodeal with upgrades, failures, or other constraint violations.</span></span> <span data-ttu-id="6241d-212">Packa i fel eller uppgradera domäner normalt sker bara när det finns några fel eller andra omsättning i hello system förhindrar korrekt placering.</span><span class="sxs-lookup"><span data-stu-id="6241d-212">Packing into fault or upgrade domains normally happens only when there are several failures or other churn in hello system preventing correct placement.</span></span> <span data-ttu-id="6241d-213">Om du vill tooprevent packa även under sådana situationer kan du använda hello `RequireDomainDistribution` [policy placering](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="6241d-213">If you wish tooprevent packing even during these situations, you can utilize hello `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="6241d-214">Observera att detta kan påverka tjänstetillgänglighet och tillförlitlighet som en sidoeffekt, så den noggrant igenom.</span><span class="sxs-lookup"><span data-stu-id="6241d-214">Note that this may affect service availability and reliability as a side effect, so consider it carefully.</span></span>

<span data-ttu-id="6241d-215">Om hello-miljö är korrekt konfigurerade uppfylls alla begränsningar fullständigt, även under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-215">If hello environment is configured correctly, all constraints are fully respected, even during upgrades.</span></span> <span data-ttu-id="6241d-216">hello är nyckel att hello klustret Resource Manager bevakar för dina villkor.</span><span class="sxs-lookup"><span data-stu-id="6241d-216">hello key thing is that hello Cluster Resource Manager is watching out for your constraints.</span></span> <span data-ttu-id="6241d-217">När den identifierar en överträdelse det omedelbart rapporterar den och försöker toocorrect hello problemet.</span><span class="sxs-lookup"><span data-stu-id="6241d-217">When it detects a violation it immediately reports it and tries toocorrect hello issue.</span></span>

## <a name="hello-preferred-location-constraint"></a><span data-ttu-id="6241d-218">Hej prioriterade platsbegränsningen</span><span class="sxs-lookup"><span data-stu-id="6241d-218">hello preferred location constraint</span></span>
<span data-ttu-id="6241d-219">Hej PreferredLocation begränsningen är lite annorlunda eftersom den har två olika användningsområden.</span><span class="sxs-lookup"><span data-stu-id="6241d-219">hello PreferredLocation constraint is a little different, as it has two different uses.</span></span> <span data-ttu-id="6241d-220">En används för den här begränsningen under programuppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-220">One use of this constraint is during application upgrades.</span></span> <span data-ttu-id="6241d-221">hello klustret Resource Manager hanterar automatiskt den här begränsningen under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-221">hello Cluster Resource Manager automatically manages this constraint during upgrades.</span></span> <span data-ttu-id="6241d-222">Det är används tooensure när uppgraderingar är klara att repliker returnera tootheir ursprungliga platser.</span><span class="sxs-lookup"><span data-stu-id="6241d-222">It is used tooensure that when upgrades are complete that replicas return tootheir initial locations.</span></span> <span data-ttu-id="6241d-223">hello andra hello PreferredLocation begränsningen används för hello [ `PreferredPrimaryDomain` policy placering](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span><span class="sxs-lookup"><span data-stu-id="6241d-223">hello other use of hello PreferredLocation constraint is for hello [`PreferredPrimaryDomain` placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span></span> <span data-ttu-id="6241d-224">Båda dessa optimeringar och därför hello PreferredLocation begränsningen är hello endast villkor med värdet för ”optimering” som standard.</span><span class="sxs-lookup"><span data-stu-id="6241d-224">Both of these are optimizations, and hence hello PreferredLocation constraint is hello only constraint set too"Optimization" by default.</span></span>

## <a name="upgrades"></a><span data-ttu-id="6241d-225">Uppgraderingar</span><span class="sxs-lookup"><span data-stu-id="6241d-225">Upgrades</span></span>
<span data-ttu-id="6241d-226">hello klustret Resource Manager hjälper också under program- och klusteruppgradering under vilken den har två jobb:</span><span class="sxs-lookup"><span data-stu-id="6241d-226">hello Cluster Resource Manager also helps during application and cluster upgrades, during which it has two jobs:</span></span>

* <span data-ttu-id="6241d-227">Se till att hello regler för hello klustret inte äventyras</span><span class="sxs-lookup"><span data-stu-id="6241d-227">ensure that hello rules of hello cluster are not compromised</span></span>
* <span data-ttu-id="6241d-228">Försök toohelp hello uppgradera gå smidigt</span><span class="sxs-lookup"><span data-stu-id="6241d-228">try toohelp hello upgrade go smoothly</span></span>

### <a name="keep-enforcing-hello-rules"></a><span data-ttu-id="6241d-229">Att framtvinga hello regler</span><span class="sxs-lookup"><span data-stu-id="6241d-229">Keep enforcing hello rules</span></span>
<span data-ttu-id="6241d-230">hello huvudsakliga sak toobe medveten om är hello regler – strikt begränsningar som placeringen och kapacitet för hello - tillämpas fortfarande under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-230">hello main thing toobe aware of is that hello rules – hello strict constraints like placement constraints and capacities - are still enforced during upgrades.</span></span> <span data-ttu-id="6241d-231">Placeringen se till att dina arbetsbelastningar endast köras var de ska kunna, även under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="6241d-231">Placement constraints ensure that your workloads only run where they are allowed to, even during upgrades.</span></span> <span data-ttu-id="6241d-232">När tjänster är mycket begränsad, kan uppgraderingar ta längre tid.</span><span class="sxs-lookup"><span data-stu-id="6241d-232">When services are highly constrained, upgrades can take longer.</span></span> <span data-ttu-id="6241d-233">När tas tjänsten hello eller hello nod den körs på för en uppdatering som det kan finnas några alternativ för där du kan gå.</span><span class="sxs-lookup"><span data-stu-id="6241d-233">When hello service or hello node it is running on is brought down for an update there may be few options for where it can go.</span></span>

### <a name="smart-replacements"></a><span data-ttu-id="6241d-234">Smart ersättningar</span><span class="sxs-lookup"><span data-stu-id="6241d-234">Smart replacements</span></span>
<span data-ttu-id="6241d-235">När en uppgradering startar tar hello Resource Manager en ögonblicksbild av hello aktuella placering av hello klustret.</span><span class="sxs-lookup"><span data-stu-id="6241d-235">When an upgrade starts, hello Resource Manager takes a snapshot of hello current arrangement of hello cluster.</span></span> <span data-ttu-id="6241d-236">Eftersom varje uppgradera domän är klar försöker tooreturn hello tjänster som fanns i den ursprungliga sorteringsordningen uppgraderingen domän tootheir.</span><span class="sxs-lookup"><span data-stu-id="6241d-236">As each Upgrade Domain completes, it attempts tooreturn hello services that were in that Upgrade Domain tootheir original arrangement.</span></span> <span data-ttu-id="6241d-237">Det här sättet finns högst två övergångar för en tjänst under hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="6241d-237">This way there are at most two transitions for a service during hello upgrade.</span></span> <span data-ttu-id="6241d-238">Det finns en flyttas ut hello påverkas nod och en flytta tillbaka.</span><span class="sxs-lookup"><span data-stu-id="6241d-238">There is one move out of hello affected node and one move back in.</span></span> <span data-ttu-id="6241d-239">Returnerar hello klustret eller tjänst toohow innan hello uppgraderingen säkerställer också hello uppgraderingen påverkar inte hello layout hello-klustret.</span><span class="sxs-lookup"><span data-stu-id="6241d-239">Returning hello cluster or service toohow it was before hello upgrade also ensures hello upgrade doesn’t impact hello layout of hello cluster.</span></span> 

### <a name="reduced-churn"></a><span data-ttu-id="6241d-240">Minskad omsättning</span><span class="sxs-lookup"><span data-stu-id="6241d-240">Reduced churn</span></span>
<span data-ttu-id="6241d-241">En annan sak som sker under uppgraderingar är att hello klustret Resource Manager stängs av belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="6241d-241">Another thing that happens during upgrades is that hello Cluster Resource Manager turns off balancing.</span></span> <span data-ttu-id="6241d-242">Hindrar NLB förhindrar onödiga reaktioner toohello uppgradering, t.ex. Flytta tjänster till noder som har tömts för hello uppgradering.</span><span class="sxs-lookup"><span data-stu-id="6241d-242">Preventing balancing prevents unnecessary reactions toohello upgrade itself, like moving services into nodes that were emptied for hello upgrade.</span></span> <span data-ttu-id="6241d-243">Om hello uppgraderingen i fråga är en uppgradering av klustret, balanserade hello hela klustret inte under hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="6241d-243">If hello upgrade in question is a Cluster upgrade, then hello entire cluster is not balanced during hello upgrade.</span></span> <span data-ttu-id="6241d-244">Begränsningen kontrollerar förblir aktiv, endast transport baserat på hello proaktiv fördelningen av mått är inaktiverad.</span><span class="sxs-lookup"><span data-stu-id="6241d-244">Constraint checks stay active, only movement based on hello proactive balancing of metrics is disabled.</span></span>

### <a name="buffered-capacity--upgrade"></a><span data-ttu-id="6241d-245">Buffrat kapacitet och uppgradering</span><span class="sxs-lookup"><span data-stu-id="6241d-245">Buffered Capacity & Upgrade</span></span>
<span data-ttu-id="6241d-246">Vanligtvis vill hello uppgradera toocomplete även om hello klustret är begränsad eller Stäng toofull.</span><span class="sxs-lookup"><span data-stu-id="6241d-246">Generally you want hello upgrade toocomplete even if hello cluster is constrained or close toofull.</span></span> <span data-ttu-id="6241d-247">Hantera hello kapacitet hello klustret är även viktigare under uppgraderingar än vanligt.</span><span class="sxs-lookup"><span data-stu-id="6241d-247">Managing hello capacity of hello cluster is even more important during upgrades than usual.</span></span> <span data-ttu-id="6241d-248">Beroende på hello måste antal uppgraderingsdomäner mellan 5 och 20 procent av kapacitet migreras som hello uppgraderingen samlar via hello klustret.</span><span class="sxs-lookup"><span data-stu-id="6241d-248">Depending on hello number of upgrade domains, between 5 and 20 percent of capacity must be migrated as hello upgrade rolls through hello cluster.</span></span> <span data-ttu-id="6241d-249">Arbetet har toogo någonstans.</span><span class="sxs-lookup"><span data-stu-id="6241d-249">That work has toogo somewhere.</span></span> <span data-ttu-id="6241d-250">Det är där hello begreppet [buffras kapaciteter](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) är användbart.</span><span class="sxs-lookup"><span data-stu-id="6241d-250">This is where hello notion of [buffered capacities](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) is useful.</span></span> <span data-ttu-id="6241d-251">Buffrat kapacitet följs under normal drift.</span><span class="sxs-lookup"><span data-stu-id="6241d-251">Buffered capacity is respected during normal operation.</span></span> <span data-ttu-id="6241d-252">hello klustret Resource Manager kan fylla noder in tootheir total kapacitet (förbrukar hello buffert) under uppgraderingar om det behövs.</span><span class="sxs-lookup"><span data-stu-id="6241d-252">hello Cluster Resource Manager may fill nodes up tootheir total capacity (consuming hello buffer) during upgrades if necessary.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6241d-253">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="6241d-253">Next steps</span></span>
* <span data-ttu-id="6241d-254">Starta från början hello och [få en introduktion toohello resurshanteraren för Service Fabric-kluster](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="6241d-254">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
