---
title: Service Fabric klustret Resource Manager - integrering | Microsoft Docs
description: "En översikt över integreringspunkter mellan kluster Resource Manager och Service Fabric."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 956cd0b8-b6e3-4436-a224-8766320e8cd7
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 9601e758e1033b4e2f86c2c230d4f49479fe6f45
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="cluster-resource-manager-integration-with-service-fabric-cluster-management"></a><span data-ttu-id="f5b84-103">Klustret resource manager-integrering med hantering av Service Fabric-kluster</span><span class="sxs-lookup"><span data-stu-id="f5b84-103">Cluster resource manager integration with Service Fabric cluster management</span></span>
<span data-ttu-id="f5b84-104">Resurshanteraren för Service Fabric klustret enheten inte uppgraderingar i Service Fabric, men den är inblandad.</span><span class="sxs-lookup"><span data-stu-id="f5b84-104">The Service Fabric Cluster Resource Manager doesn't drive upgrades in Service Fabric, but it is involved.</span></span> <span data-ttu-id="f5b84-105">Det första sättet som klustret Resource Manager hjälper med management är genom att spåra tillståndet som klustret och tjänster i den.</span><span class="sxs-lookup"><span data-stu-id="f5b84-105">The first way that the Cluster Resource Manager helps with management is by tracking the desired state of the cluster and the services inside it.</span></span> <span data-ttu-id="f5b84-106">Klustret Resource Manager skickar ut hälsorapporter när den inte kan lägga till klustret i önskad konfiguration.</span><span class="sxs-lookup"><span data-stu-id="f5b84-106">The Cluster Resource Manager sends out health reports when it cannot put the cluster into the desired configuration.</span></span> <span data-ttu-id="f5b84-107">Till exempel om det inte finns tillräcklig kapacitet skickar klustret Resource Manager ut hälsa varningar och fel som tyder på problem.</span><span class="sxs-lookup"><span data-stu-id="f5b84-107">For example, if there is insufficient capacity the Cluster Resource Manager sends out health warnings and errors indicating the problem.</span></span> <span data-ttu-id="f5b84-108">En annan typ av integrering har att göra med så här fungerar uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-108">Another piece of integration has to do with how upgrades work.</span></span> <span data-ttu-id="f5b84-109">Klustret Resource Manager ändrar sitt beteende något under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-109">The Cluster Resource Manager alters its behavior slightly during upgrades.</span></span>  

## <a name="health-integration"></a><span data-ttu-id="f5b84-110">Integrering av hälsotillstånd</span><span class="sxs-lookup"><span data-stu-id="f5b84-110">Health integration</span></span>
<span data-ttu-id="f5b84-111">Klustret Resource Manager spårar ständigt regler som du har definierat placera dina tjänster.</span><span class="sxs-lookup"><span data-stu-id="f5b84-111">The Cluster Resource Manager constantly tracks the rules you have defined for placing your services.</span></span> <span data-ttu-id="f5b84-112">Den spårar också återstående kapacitet för varje mått på noderna i klustret och i klustret som helhet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-112">It also tracks the remaining capacity for each metric on the nodes and in the cluster and in the cluster as a whole.</span></span> <span data-ttu-id="f5b84-113">Om den inte kan uppfylla dessa regler eller om det finns tillräcklig kapacitet orsakat hälsa varningar och fel.</span><span class="sxs-lookup"><span data-stu-id="f5b84-113">If it can't satisfy those rules or if there is insufficient capacity, health warnings and errors are emitted.</span></span> <span data-ttu-id="f5b84-114">Om exempelvis en nod är över kapacitet och klustret Resource Manager kommer att försöka åtgärda situationen genom att flytta tjänster.</span><span class="sxs-lookup"><span data-stu-id="f5b84-114">For example, if a node is over capacity and the Cluster Resource Manager will try to fix the situation by moving services.</span></span> <span data-ttu-id="f5b84-115">Om den inte kan korrigera situationen skickar en varning om hälsa som anger vilken nod är överbelastade och för vilka mått.</span><span class="sxs-lookup"><span data-stu-id="f5b84-115">If it can't correct the situation it emits a health warning indicating which node is over capacity, and for which metrics.</span></span>

<span data-ttu-id="f5b84-116">Ett annat exempel på resurshanterare hälsovarningar är överträdelser av placeringsbegränsningar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-116">Another example of the Resource Manager's health warnings is violations of placement constraints.</span></span> <span data-ttu-id="f5b84-117">Till exempel om du har definierat begränsningen placering (som `“NodeColor == Blue”`) och Resource Manager identifierar ett brott mot denna begränsning, den genererar en varning om hälsa.</span><span class="sxs-lookup"><span data-stu-id="f5b84-117">For example, if you have defined a placement constraint (such as `“NodeColor == Blue”`) and the Resource Manager detects a violation of that constraint, it emits a health warning.</span></span> <span data-ttu-id="f5b84-118">Detta gäller för anpassade villkor och standardbegränsningar (till exempel fel och uppgradera domänen begränsningar).</span><span class="sxs-lookup"><span data-stu-id="f5b84-118">This is true for custom constraints and the default constraints (like the Fault Domain and Upgrade Domain constraints).</span></span>

<span data-ttu-id="f5b84-119">Här är ett exempel på en sådan hälsorapport.</span><span class="sxs-lookup"><span data-stu-id="f5b84-119">Here’s an example of one such health report.</span></span> <span data-ttu-id="f5b84-120">I det här fallet är hälsorapporten för en av systemtjänsten partitioner.</span><span class="sxs-lookup"><span data-stu-id="f5b84-120">In this case, the health report is for one of the system service’s partitions.</span></span> <span data-ttu-id="f5b84-121">Hälsotillstånd meddelandet anger repliker av den partitionen tillfälligt packas i för få uppgradera domäner.</span><span class="sxs-lookup"><span data-stu-id="f5b84-121">The health message indicates the replicas of that partition are temporarily packed into too few Upgrade Domains.</span></span>

```posh
PS C:\Users\User > Get-WindowsFabricPartitionHealth -PartitionId '00000000-0000-0000-0000-000000000001'


PartitionId           : 00000000-0000-0000-0000-000000000001
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='System.PLB', Property='ReplicaConstraintViolation_UpgradeDomain', HealthState='Warning', ConsiderWarningAsError=false.

ReplicaHealthStates   :
                        ReplicaId             : 130766528804733380
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577821
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528854889931
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577822
                        AggregatedHealthState : Ok

                        ReplicaId             : 130837073190680024
                        AggregatedHealthState : Ok

HealthEvents          :
                        SourceId              : System.PLB
                        Property              : ReplicaConstraintViolation_UpgradeDomain
                        HealthState           : Warning
                        SequenceNumber        : 130837100116930204
                        SentAt                : 8/10/2015 7:53:31 PM
                        ReceivedAt            : 8/10/2015 7:53:33 PM
                        TTL                   : 00:01:05
                        Description           : The Load Balancer has detected a Constraint Violation for this Replica: fabric:/System/FailoverManagerService Secondary Partition 00000000-0000-0000-0000-000000000001 is
                        violating the Constraint: UpgradeDomain Details: UpgradeDomain ID -- 4, Replica on NodeName -- Node.8 Currently Upgrading -- false Distribution Policy -- Packing
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : Ok->Warning = 8/10/2015 7:13:02 PM, LastError = 1/1/0001 12:00:00 AM
```

<span data-ttu-id="f5b84-122">Här är vad meddelandet hälsa tala om för oss är:</span><span class="sxs-lookup"><span data-stu-id="f5b84-122">Here's what this health message is telling us is:</span></span>

1. <span data-ttu-id="f5b84-123">Alla repliker själva är felfria: varje har AggregatedHealthState: Ok</span><span class="sxs-lookup"><span data-stu-id="f5b84-123">All the replicas themselves are healthy: Each has AggregatedHealthState : Ok</span></span>
2. <span data-ttu-id="f5b84-124">Uppgradera domän distribution villkoret överskrids för närvarande.</span><span class="sxs-lookup"><span data-stu-id="f5b84-124">The Upgrade Domain distribution constraint is currently being violated.</span></span> <span data-ttu-id="f5b84-125">Det innebär att en viss uppgradera domän har flera repliker från den här partitionen än den borde.</span><span class="sxs-lookup"><span data-stu-id="f5b84-125">This means a particular Upgrade Domain has more replicas from this partition than it should.</span></span>
3. <span data-ttu-id="f5b84-126">Vilken nod som innehåller repliken orsakar överträdelse.</span><span class="sxs-lookup"><span data-stu-id="f5b84-126">Which node contains the replica causing the violation.</span></span> <span data-ttu-id="f5b84-127">I det här fallet är den noden med namnet ”Node.8”</span><span class="sxs-lookup"><span data-stu-id="f5b84-127">In this case it's the node with the name "Node.8"</span></span>
4. <span data-ttu-id="f5b84-128">Om en uppgradering för närvarande pågår för detta partitions (”för närvarande uppgradering--false”)</span><span class="sxs-lookup"><span data-stu-id="f5b84-128">Whether an upgrade is currently happening for this partition ("Currently Upgrading -- false")</span></span>
5. <span data-ttu-id="f5b84-129">Principen för programdistribution för den här tjänsten: ”Distribution princip--packkorg”.</span><span class="sxs-lookup"><span data-stu-id="f5b84-129">The distribution policy for this service: "Distribution Policy -- Packing".</span></span> <span data-ttu-id="f5b84-130">Detta styrs av den `RequireDomainDistribution` [policy placering](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="f5b84-130">This is governed by the `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="f5b84-131">”Packa” anger att i det här fallet DomainDistribution _inte_ krävs, så att vi vet att policy placering inte har angetts för den här tjänsten.</span><span class="sxs-lookup"><span data-stu-id="f5b84-131">"Packing" indicates that in this case DomainDistribution was _not_ required, so we know that placement policy was not specified for this service.</span></span> 
6. <span data-ttu-id="f5b84-132">När rapporten har hänt - 8/10/2015 7:13:02 PM.</span><span class="sxs-lookup"><span data-stu-id="f5b84-132">When the report happened - 8/10/2015 7:13:02 PM</span></span>

<span data-ttu-id="f5b84-133">Information som den här befogenheter aviseringar som utlöses i produktion så att du vet något är fel och används också för att identifiera och stoppa felaktiga uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-133">Information like this powers alerts that fire in production to let you know something has gone wrong and is also used to detect and halt bad upgrades.</span></span> <span data-ttu-id="f5b84-134">I så fall skulle vi vill se om vi kan ta reda på varför resurshanteraren var tvungen att packa replikerna i domänen uppgradera.</span><span class="sxs-lookup"><span data-stu-id="f5b84-134">In this case, we’d want to see if we can figure out why the Resource Manager had to pack the replicas into the Upgrade Domain.</span></span> <span data-ttu-id="f5b84-135">Packa vanligtvis beror på tillfälliga noder i andra uppgradera domäner har ned, till exempel.</span><span class="sxs-lookup"><span data-stu-id="f5b84-135">Usually packing is transient because the nodes in the other Upgrade Domains were down, for example.</span></span>

<span data-ttu-id="f5b84-136">Att anta klustret Resource Manager försöker placera vissa tjänster, men det inte finns några lösningar som fungerar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-136">Let’s say the Cluster Resource Manager is trying to place some services, but there aren't any solutions that work.</span></span> <span data-ttu-id="f5b84-137">När tjänster inte kan placeras, är det vanligtvis av något av följande skäl:</span><span class="sxs-lookup"><span data-stu-id="f5b84-137">When services can't be placed, it is usually for one of the following reasons:</span></span>

1. <span data-ttu-id="f5b84-138">Vissa övergående tillstånd har gjort det omöjligt att placera den här tjänstinstansen eller replik korrekt</span><span class="sxs-lookup"><span data-stu-id="f5b84-138">Some transient condition has made it impossible to place this service instance or replica correctly</span></span>
2. <span data-ttu-id="f5b84-139">Tjänstens placering kraven är unsatisfiable.</span><span class="sxs-lookup"><span data-stu-id="f5b84-139">The service’s placement requirements are unsatisfiable.</span></span>

<span data-ttu-id="f5b84-140">I dessa fall kan hjälpa dig att avgöra varför tjänsten kan inte placeras i hälsorapporter från klustret Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f5b84-140">In these cases, health reports from the Cluster Resource Manager help you determine why the service can’t be placed.</span></span> <span data-ttu-id="f5b84-141">Den här processen kallas begränsningen eliminering sekvensen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-141">We call this process the constraint elimination sequence.</span></span> <span data-ttu-id="f5b84-142">Under den går systemet igenom konfigurerade begränsningar som påverkar tjänsten och poster de undanröjer.</span><span class="sxs-lookup"><span data-stu-id="f5b84-142">During it, the system walks through the configured constraints affecting the service and records what they eliminate.</span></span> <span data-ttu-id="f5b84-143">Det här sättet när tjänsterna inte kunna släppas, du kan se vilka noder har tagits bort och varför.</span><span class="sxs-lookup"><span data-stu-id="f5b84-143">This way when services aren’t able to be placed, you can see which nodes were eliminated and why.</span></span>

## <a name="constraint-types"></a><span data-ttu-id="f5b84-144">Villkorstyper</span><span class="sxs-lookup"><span data-stu-id="f5b84-144">Constraint types</span></span>
<span data-ttu-id="f5b84-145">Vi pratar om var och en av de olika begränsningarna i dessa rapporter om hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="f5b84-145">Let’s talk about each of the different constraints in these health reports.</span></span> <span data-ttu-id="f5b84-146">Du ser hälsa meddelanden relaterade till dessa villkor när repliker inte kan placeras.</span><span class="sxs-lookup"><span data-stu-id="f5b84-146">You will see health messages related to these constraints when replicas can't be placed.</span></span>

* <span data-ttu-id="f5b84-147">**ReplicaExclusionStatic** och **ReplicaExclusionDynamic**: dessa villkor anger att en lösning avvisades eftersom två tjänstobjekt från samma partition måste placeras på samma nod.</span><span class="sxs-lookup"><span data-stu-id="f5b84-147">**ReplicaExclusionStatic** and **ReplicaExclusionDynamic**: These constraints indicates that a solution was rejected because two service objects from the same partition would have to be placed on the same node.</span></span> <span data-ttu-id="f5b84-148">Detta är inte tillåten eftersom sedan fel på noden påverkar alltför partitionen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-148">This isn’t allowed because then failure of that node would overly impact that partition.</span></span> <span data-ttu-id="f5b84-149">ReplicaExclusionStatic och ReplicaExclusionDynamic är nästan samma regel och verkligen är viktiga inte skillnaderna.</span><span class="sxs-lookup"><span data-stu-id="f5b84-149">ReplicaExclusionStatic and ReplicaExclusionDynamic are almost the same rule and the differences don't really matter.</span></span> <span data-ttu-id="f5b84-150">Om du ser en begränsning eliminering sekvens som innehåller antingen ReplicaExclusionStatic eller ReplicaExclusionDynamic begränsningen tror klustret Resource Manager att det inte finns tillräckligt med noder.</span><span class="sxs-lookup"><span data-stu-id="f5b84-150">If you are seeing a constraint elimination sequence containing either the ReplicaExclusionStatic or ReplicaExclusionDynamic constraint, the Cluster Resource Manager thinks that there aren’t enough nodes.</span></span> <span data-ttu-id="f5b84-151">Detta kräver återstående lösningar för att använda dessa ogiltig placeringar som inte är tillåtet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-151">This requires remaining solutions to use these invalid placements which are disallowed.</span></span> <span data-ttu-id="f5b84-152">Begränsningarna i sekvensen kommer vanligtvis berätta varför noder som elimineras i första hand.</span><span class="sxs-lookup"><span data-stu-id="f5b84-152">The other constraints in the sequence will usually tell us why nodes are being eliminated in the first place.</span></span>
* <span data-ttu-id="f5b84-153">**PlacementConstraint**: Om du ser det här meddelandet innebär att vi elimineras vissa noder eftersom de inte matchar tjänstens placeringen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-153">**PlacementConstraint**: If you see this message, it means that we eliminated some nodes because they didn’t match the service’s placement constraints.</span></span> <span data-ttu-id="f5b84-154">Vi spåra ut konfigurerade placeringen som en del av det här meddelandet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-154">We trace out the currently configured placement constraints as a part of this message.</span></span> <span data-ttu-id="f5b84-155">Detta är normalt om du har en begränsning för placering som definierats.</span><span class="sxs-lookup"><span data-stu-id="f5b84-155">This is normal if you have a placement constraint defined.</span></span> <span data-ttu-id="f5b84-156">Men om placering begränsningen felaktigt orsakar för många noder elimineras det här är hur du vill se.</span><span class="sxs-lookup"><span data-stu-id="f5b84-156">However, if placement constraint is incorrectly causing too many nodes to be eliminated this is how you would notice.</span></span>
* <span data-ttu-id="f5b84-157">**NodeCapacity**: den här begränsningen innebär att klustret Resource Manager inte kunde placera replikerna på de angivna noderna eftersom som skulle placera dem över kapacitet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-157">**NodeCapacity**: This constraint means that the Cluster Resource Manager couldn’t place the replicas on the indicated nodes because that would put them over capacity.</span></span>
* <span data-ttu-id="f5b84-158">**Tillhörighet**: det här villkoret visar vi inte kunde placera repliken på de berörda noderna eftersom det skulle orsaka en överträdelse av begränsningen tillhörighet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-158">**Affinity**: This constraint indicates that we couldn’t place the replica on the affected nodes since it would cause a violation of the affinity constraint.</span></span> <span data-ttu-id="f5b84-159">Mer information om mappning mellan är i [i den här artikeln](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span><span class="sxs-lookup"><span data-stu-id="f5b84-159">More information on affinity is in [this article](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span></span>
* <span data-ttu-id="f5b84-160">**FaultDomain** och **UpgradeDomain**: den här begränsningen eliminerar noder om placera repliken på de angivna noderna skulle orsaka packa i ett visst fel eller en domän.</span><span class="sxs-lookup"><span data-stu-id="f5b84-160">**FaultDomain** and **UpgradeDomain**: This constraint eliminates nodes if placing the replica on the indicated nodes would cause packing in a particular fault or upgrade domain.</span></span> <span data-ttu-id="f5b84-161">Flera exempel diskutera detta villkor visas i avsnittet på [fel- och begränsningar för domänen och resultatet](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="f5b84-161">Several examples discussing this constraint are presented in the topic on [fault and upgrade domain constraints and resulting behavior](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
* <span data-ttu-id="f5b84-162">**PreferredLocation**: du normalt inte bör se den här begränsningen att ta bort noder från lösningen eftersom den körs som en optimering som standard.</span><span class="sxs-lookup"><span data-stu-id="f5b84-162">**PreferredLocation**: You shouldn’t normally see this constraint removing nodes from the solution since it runs as an optimization by default.</span></span> <span data-ttu-id="f5b84-163">Prioriterade platsbegränsningen finns under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-163">The preferred location constraint is also present during upgrades.</span></span> <span data-ttu-id="f5b84-164">Du uppgraderar används den för att flytta tjänster till där de fanns när uppgraderingen är igång.</span><span class="sxs-lookup"><span data-stu-id="f5b84-164">During upgrade it is used to move services back to where they were when the upgrade started.</span></span>

## <a name="blocklisting-nodes"></a><span data-ttu-id="f5b84-165">Blocklisting noder</span><span class="sxs-lookup"><span data-stu-id="f5b84-165">Blocklisting Nodes</span></span>
<span data-ttu-id="f5b84-166">Ett annat hälsa meddelande klustret Resource Manager-rapporter är när noder är blocklisted.</span><span class="sxs-lookup"><span data-stu-id="f5b84-166">Another health message the Cluster Resource Manager reports is when nodes are blocklisted.</span></span> <span data-ttu-id="f5b84-167">Du kan se blocklisting som en tillfällig begränsning som tillämpas automatiskt åt dig.</span><span class="sxs-lookup"><span data-stu-id="f5b84-167">You can think of blocklisting as a temporary constraint that is automatically applied for you.</span></span> <span data-ttu-id="f5b84-168">Noder får blocklisted när de har upprepade fel när den startas instanser av den typ av tjänst.</span><span class="sxs-lookup"><span data-stu-id="f5b84-168">Nodes get blocklisted when they experience repeated failures when launching instances of that service type.</span></span> <span data-ttu-id="f5b84-169">Noderna är blocklisted på grundval av per tjänsttyp.</span><span class="sxs-lookup"><span data-stu-id="f5b84-169">Nodes are blocklisted on a per-service-type basis.</span></span> <span data-ttu-id="f5b84-170">En nod kan vara blocklisted för en tjänst men inte en annan.</span><span class="sxs-lookup"><span data-stu-id="f5b84-170">A node may be blocklisted for one service type but not another.</span></span> 

<span data-ttu-id="f5b84-171">Du ser blocklisting startar ofta under utveckling: vissa bugg gör din tjänstvärden kraschar vid start.</span><span class="sxs-lookup"><span data-stu-id="f5b84-171">You'll see blocklisting kick in often during development: some bug causes your service host to crash on startup.</span></span> <span data-ttu-id="f5b84-172">Service Fabric försöker skapa tjänstevärden några gånger och felet kvarstår.</span><span class="sxs-lookup"><span data-stu-id="f5b84-172">Service Fabric tries to create the service host a few times, and the failure keeps occurring.</span></span> <span data-ttu-id="f5b84-173">Efter några försök noden hämtar blocklisted och klustret Resource Manager kommer att försöka skapa tjänsten någon annanstans.</span><span class="sxs-lookup"><span data-stu-id="f5b84-173">After a few attempts, the node gets blocklisted, and the Cluster Resource Manager will try to create the service elsewhere.</span></span> <span data-ttu-id="f5b84-174">Om felet upprepas på flera noder, är det möjligt att alla giltiga noder i klustret hamnar blockeras.</span><span class="sxs-lookup"><span data-stu-id="f5b84-174">If that failure keeps happening on multiple nodes, it's possible that all of the valid nodes in the cluster end up blocked.</span></span> <span data-ttu-id="f5b84-175">Blocklisting kan också ta bort så många noder att det finns inte tillräckligt med har starta tjänsten för att uppfylla önskade skalan.</span><span class="sxs-lookup"><span data-stu-id="f5b84-175">Blocklisting cna also remove so many nodes that not enough can successfully launch the service to meet the desired scale.</span></span> <span data-ttu-id="f5b84-176">Normalt visas ytterligare fel eller varningar från klustret Resource Manager som anger som tjänsten är lägre än den önskade replik eller instansantal, samt hälsa meddelanden som anger vad felet är som leder till blocklisting i först Placera.</span><span class="sxs-lookup"><span data-stu-id="f5b84-176">You'll typically see additional errors or warnings from the Cluster Resource Manager indicating that the service is below the desired replica or instance count, as well as health messages indicating what the failure is that's leading to the blocklisting in the first place.</span></span>

<span data-ttu-id="f5b84-177">Blocklisting är inte ett permanent villkor.</span><span class="sxs-lookup"><span data-stu-id="f5b84-177">Blocklisting is not a permanent condition.</span></span> <span data-ttu-id="f5b84-178">Noden tas bort från blocklist och Service Fabric kan aktivera tjänsterna på noden igen efter några minuter.</span><span class="sxs-lookup"><span data-stu-id="f5b84-178">After a few minutes, the node is removed from the blocklist and Service Fabric may activate the services on that node again.</span></span> <span data-ttu-id="f5b84-179">Om tjänster fortsätter att misslyckas, är noden blocklisted för tjänsten igen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-179">If services continue to fail, the node is blocklisted for that service type again.</span></span> 

### <a name="constraint-priorities"></a><span data-ttu-id="f5b84-180">Begränsningen prioriteter</span><span class="sxs-lookup"><span data-stu-id="f5b84-180">Constraint priorities</span></span>

> [!WARNING]
> <span data-ttu-id="f5b84-181">Ändra begränsningen prioriteter rekommenderas inte och kan ha betydande negativa effekter på klustret.</span><span class="sxs-lookup"><span data-stu-id="f5b84-181">Changing constraint priorities is not recommended and may have significant adverse effects on your cluster.</span></span> <span data-ttu-id="f5b84-182">I informationen nedan ges för referens för begränsningen standardegenskaper och deras beteende.</span><span class="sxs-lookup"><span data-stu-id="f5b84-182">The below information is provided for reference of the default constraint priorities and their behavior.</span></span> 
>

<span data-ttu-id="f5b84-183">Med alla dessa villkor, kan du ha tänker ”Hej – jag tror att fel domän begränsningar är viktigaste i systemet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-183">With all of these constraints, you may have been thinking “Hey – I think that fault domain constraints are the most important thing in my system.</span></span> <span data-ttu-id="f5b84-184">För att säkerställa domänbegränsningar fel inte bröt mot, jag vill bryta mot andra begränsningar ”.</span><span class="sxs-lookup"><span data-stu-id="f5b84-184">In order to ensure the fault domain constraint isn't violated, I’m willing to violate other constraints.”</span></span>

<span data-ttu-id="f5b84-185">Begränsningar kan konfigureras med olika prioritet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-185">Constraints can be configured with different priority levels.</span></span> <span data-ttu-id="f5b84-186">Dessa är:</span><span class="sxs-lookup"><span data-stu-id="f5b84-186">These are:</span></span>

   - <span data-ttu-id="f5b84-187">”hårda” (0)</span><span class="sxs-lookup"><span data-stu-id="f5b84-187">“hard” (0)</span></span>
   - <span data-ttu-id="f5b84-188">”soft” (1)</span><span class="sxs-lookup"><span data-stu-id="f5b84-188">“soft” (1)</span></span>
   - <span data-ttu-id="f5b84-189">”optimering” (2)</span><span class="sxs-lookup"><span data-stu-id="f5b84-189">“optimization” (2)</span></span>
   - <span data-ttu-id="f5b84-190">”off” (-1).</span><span class="sxs-lookup"><span data-stu-id="f5b84-190">“off” (-1).</span></span> 
   
<span data-ttu-id="f5b84-191">De flesta av begränsningarna som är konfigurerade som hårda begränsningar som standard.</span><span class="sxs-lookup"><span data-stu-id="f5b84-191">Most of the constraints are configured as hard constraints by default.</span></span>

<span data-ttu-id="f5b84-192">Det är ovanligt att ändra prioriteten för begränsningar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-192">Changing the priority of constraints is uncommon.</span></span> <span data-ttu-id="f5b84-193">Det har förekommit gånger där begränsningen prioriteter behövs för att ändra vanligtvis för att kringgå vissa fel eller problem som påverkade miljön.</span><span class="sxs-lookup"><span data-stu-id="f5b84-193">There have been times where constraint priorities needed to change, usually to work around some other bug or behavior that was impacting the environment.</span></span> <span data-ttu-id="f5b84-194">Normalt möjlighet att begränsningen prioritet infrastruktur har arbetat mycket bra, men det behövs inte ofta.</span><span class="sxs-lookup"><span data-stu-id="f5b84-194">Generally the flexibility of the constraint priority infrastructure has worked very well, but it isn't needed often.</span></span> <span data-ttu-id="f5b84-195">I de flesta fall är allt placerad på deras Standardprioriteter.</span><span class="sxs-lookup"><span data-stu-id="f5b84-195">Most of the time everything sits at their default priorities.</span></span> 

<span data-ttu-id="f5b84-196">Prioritetsnivå inte innebär att ett visst villkor _kommer_ ha brutits, eller som ska alltid vara uppfyllda.</span><span class="sxs-lookup"><span data-stu-id="f5b84-196">The priority levels don't mean that a given constraint _will_ be violated, nor that it will always be met.</span></span> <span data-ttu-id="f5b84-197">Begränsningen prioriteter definiera begränsningar är framtvingade i vilken ordning.</span><span class="sxs-lookup"><span data-stu-id="f5b84-197">Constraint priorities define an order in which constraints are enforced.</span></span> <span data-ttu-id="f5b84-198">Prioriteringar definiera kompromisser när är det omöjligt att uppfylla alla villkor.</span><span class="sxs-lookup"><span data-stu-id="f5b84-198">Priorities define the tradeoffs when it is impossible to satisfy all constraints.</span></span> <span data-ttu-id="f5b84-199">Vanligtvis uppfyllas alla villkor om det inte finns något annat i miljön.</span><span class="sxs-lookup"><span data-stu-id="f5b84-199">Usually all the constraints can be satisfied unless there's something else going on in the environment.</span></span> <span data-ttu-id="f5b84-200">Några exempel på scenarier som kommer att leda till överträdelser av villkor är i konflikt villkor eller stort antal samtidiga fel.</span><span class="sxs-lookup"><span data-stu-id="f5b84-200">Some examples of scenarios that will lead to constraint violations are conflicting constraints, or large numbers of concurrent failures.</span></span>

<span data-ttu-id="f5b84-201">I avancerade fall kan ändra du begränsningen prioriteter.</span><span class="sxs-lookup"><span data-stu-id="f5b84-201">In advanced situations, you can change the constraint priorities.</span></span> <span data-ttu-id="f5b84-202">Anta exempelvis att du vill se till att tillhörighet skulle alltid ha brutits när det är nödvändigt för att lösa problem med noden kapacitet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-202">For example, say you wanted to ensure that affinity would always be violated when necessary to solve node capacity issues.</span></span> <span data-ttu-id="f5b84-203">För att åstadkomma detta kan du ange prioritet för mappning mellan begränsningen på ”soft” (1) och lämna kapacitet begränsningen anges till ”hårda” (0).</span><span class="sxs-lookup"><span data-stu-id="f5b84-203">To achieve this, you could set the priority of the affinity constraint to “soft” (1) and leave the capacity constraint set to “hard” (0).</span></span>

<span data-ttu-id="f5b84-204">Standardvärden för prioritet för olika villkor anges i följande konfiguration:</span><span class="sxs-lookup"><span data-stu-id="f5b84-204">The default priority values for the different constraints are specified in the following config:</span></span>

<span data-ttu-id="f5b84-205">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="f5b84-205">ClusterManifest.xml</span></span>

```xml
        <Section Name="PlacementAndLoadBalancing">
            <Parameter Name="PlacementConstraintPriority" Value="0" />
            <Parameter Name="CapacityConstraintPriority" Value="0" />
            <Parameter Name="AffinityConstraintPriority" Value="0" />
            <Parameter Name="FaultDomainConstraintPriority" Value="0" />
            <Parameter Name="UpgradeDomainConstraintPriority" Value="1" />
            <Parameter Name="PreferredLocationConstraintPriority" Value="2" />
        </Section>
```

<span data-ttu-id="f5b84-206">värdbaserade kluster via ClusterConfig.json för fristående distributioner eller Template.json för Azure:</span><span class="sxs-lookup"><span data-stu-id="f5b84-206">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "PlacementConstraintPriority",
          "value": "0"
      },
      {
          "name": "CapacityConstraintPriority",
          "value": "0"
      },
      {
          "name": "AffinityConstraintPriority",
          "value": "0"
      },
      {
          "name": "FaultDomainConstraintPriority",
          "value": "0"
      },
      {
          "name": "UpgradeDomainConstraintPriority",
          "value": "1"
      },
      {
          "name": "PreferredLocationConstraintPriority",
          "value": "2"
      }
    ]
  }
]
```

## <a name="fault-domain-and-upgrade-domain-constraints"></a><span data-ttu-id="f5b84-207">Fel domän- och begränsningar för domänen</span><span class="sxs-lookup"><span data-stu-id="f5b84-207">Fault domain and upgrade domain constraints</span></span>
<span data-ttu-id="f5b84-208">Klustret Resource Manager vill hålla services sprids ut bland fel- och domäner.</span><span class="sxs-lookup"><span data-stu-id="f5b84-208">The Cluster Resource Manager wants to keep services spread out among fault and upgrade domains.</span></span> <span data-ttu-id="f5b84-209">Den modeller detta som en begränsning i klustret Resource Manager-motorn.</span><span class="sxs-lookup"><span data-stu-id="f5b84-209">It models this as a constraint inside the Cluster Resource Manager’s engine.</span></span> <span data-ttu-id="f5b84-210">Mer information om hur de används och deras specifika beteende, finns i artikeln på [klusterkonfigurationen](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span><span class="sxs-lookup"><span data-stu-id="f5b84-210">For more information on how they are used and their specific behavior, check out the article on [cluster configuration](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span></span>

<span data-ttu-id="f5b84-211">Klustret Resource Manager kan behöva packa några repliker i en uppgraderingsdomän för att kunna hantera uppgraderingar, fel eller andra kränkningar begränsningen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-211">The Cluster Resource Manager may need to pack a couple replicas into an upgrade domain in order to deal with upgrades, failures, or other constraint violations.</span></span> <span data-ttu-id="f5b84-212">Packa i fel eller uppgradera domäner normalt sker endast om det finns några fel eller andra omsättning i systemet som förhindrar korrekt placering.</span><span class="sxs-lookup"><span data-stu-id="f5b84-212">Packing into fault or upgrade domains normally happens only when there are several failures or other churn in the system preventing correct placement.</span></span> <span data-ttu-id="f5b84-213">Om du vill förhindra packkorg även under sådana situationer kan du använda den `RequireDomainDistribution` [policy placering](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="f5b84-213">If you wish to prevent packing even during these situations, you can utilize the `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="f5b84-214">Observera att detta kan påverka tjänstetillgänglighet och tillförlitlighet som en sidoeffekt, så den noggrant igenom.</span><span class="sxs-lookup"><span data-stu-id="f5b84-214">Note that this may affect service availability and reliability as a side effect, so consider it carefully.</span></span>

<span data-ttu-id="f5b84-215">Om miljön är korrekt konfigurerade uppfylls alla begränsningar fullständigt, även under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-215">If the environment is configured correctly, all constraints are fully respected, even during upgrades.</span></span> <span data-ttu-id="f5b84-216">Det viktiga är att klustret Resource Manager bevakar för dina villkor.</span><span class="sxs-lookup"><span data-stu-id="f5b84-216">The key thing is that the Cluster Resource Manager is watching out for your constraints.</span></span> <span data-ttu-id="f5b84-217">När den identifierar en överträdelse det omedelbart rapporterar den och försöker åtgärda problemet.</span><span class="sxs-lookup"><span data-stu-id="f5b84-217">When it detects a violation it immediately reports it and tries to correct the issue.</span></span>

## <a name="the-preferred-location-constraint"></a><span data-ttu-id="f5b84-218">Prioriterade platsbegränsningen</span><span class="sxs-lookup"><span data-stu-id="f5b84-218">The preferred location constraint</span></span>
<span data-ttu-id="f5b84-219">PreferredLocation-begränsning är lite annorlunda eftersom den har två olika användningsområden.</span><span class="sxs-lookup"><span data-stu-id="f5b84-219">The PreferredLocation constraint is a little different, as it has two different uses.</span></span> <span data-ttu-id="f5b84-220">En används för den här begränsningen under programuppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-220">One use of this constraint is during application upgrades.</span></span> <span data-ttu-id="f5b84-221">Klustret Resource Manager hanterar automatiskt den här begränsningen under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-221">The Cluster Resource Manager automatically manages this constraint during upgrades.</span></span> <span data-ttu-id="f5b84-222">Den används för att säkerställa att när uppgraderingar är klara att repliker gå tillbaka till sina ursprungliga platser.</span><span class="sxs-lookup"><span data-stu-id="f5b84-222">It is used to ensure that when upgrades are complete that replicas return to their initial locations.</span></span> <span data-ttu-id="f5b84-223">Andra PreferredLocation begränsningen används för den [ `PreferredPrimaryDomain` policy placering](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span><span class="sxs-lookup"><span data-stu-id="f5b84-223">The other use of the PreferredLocation constraint is for the [`PreferredPrimaryDomain` placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span></span> <span data-ttu-id="f5b84-224">Båda dessa är optimeringar och därför PreferredLocation begränsningen är den enda begränsningen inställd på ”optimering” som standard.</span><span class="sxs-lookup"><span data-stu-id="f5b84-224">Both of these are optimizations, and hence the PreferredLocation constraint is the only constraint set to "Optimization" by default.</span></span>

## <a name="upgrades"></a><span data-ttu-id="f5b84-225">Uppgraderingar</span><span class="sxs-lookup"><span data-stu-id="f5b84-225">Upgrades</span></span>
<span data-ttu-id="f5b84-226">Klustret Resource Manager hjälper också under program- och klusteruppgradering under vilken den har två jobb:</span><span class="sxs-lookup"><span data-stu-id="f5b84-226">The Cluster Resource Manager also helps during application and cluster upgrades, during which it has two jobs:</span></span>

* <span data-ttu-id="f5b84-227">Se till att reglerna för klustret inte äventyras</span><span class="sxs-lookup"><span data-stu-id="f5b84-227">ensure that the rules of the cluster are not compromised</span></span>
* <span data-ttu-id="f5b84-228">Försök att gå smidigt uppgraderingen</span><span class="sxs-lookup"><span data-stu-id="f5b84-228">try to help the upgrade go smoothly</span></span>

### <a name="keep-enforcing-the-rules"></a><span data-ttu-id="f5b84-229">Behåll tvingande regler</span><span class="sxs-lookup"><span data-stu-id="f5b84-229">Keep enforcing the rules</span></span>
<span data-ttu-id="f5b84-230">Det huvudsakliga bör vara medveten om är att tillämpas reglerna – strikt begränsningarna som placeringen och kapacitet - fortfarande under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-230">The main thing to be aware of is that the rules – the strict constraints like placement constraints and capacities - are still enforced during upgrades.</span></span> <span data-ttu-id="f5b84-231">Placeringen se till att dina arbetsbelastningar endast köras var de ska kunna, även under uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="f5b84-231">Placement constraints ensure that your workloads only run where they are allowed to, even during upgrades.</span></span> <span data-ttu-id="f5b84-232">När tjänster är mycket begränsad, kan uppgraderingar ta längre tid.</span><span class="sxs-lookup"><span data-stu-id="f5b84-232">When services are highly constrained, upgrades can take longer.</span></span> <span data-ttu-id="f5b84-233">När tjänsten eller den körs på noden tas för en uppdatering kan det finnas några alternativ för där du kan gå.</span><span class="sxs-lookup"><span data-stu-id="f5b84-233">When the service or the node it is running on is brought down for an update there may be few options for where it can go.</span></span>

### <a name="smart-replacements"></a><span data-ttu-id="f5b84-234">Smart ersättningar</span><span class="sxs-lookup"><span data-stu-id="f5b84-234">Smart replacements</span></span>
<span data-ttu-id="f5b84-235">När en uppgradering startar tar resurshanteraren en ögonblicksbild av den aktuella ordningen i klustret.</span><span class="sxs-lookup"><span data-stu-id="f5b84-235">When an upgrade starts, the Resource Manager takes a snapshot of the current arrangement of the cluster.</span></span> <span data-ttu-id="f5b84-236">Eftersom varje uppgradera domän är klar försöker den returnera de tjänster som fanns i uppgradera domänen till deras ursprungliga sortering.</span><span class="sxs-lookup"><span data-stu-id="f5b84-236">As each Upgrade Domain completes, it attempts to return the services that were in that Upgrade Domain to their original arrangement.</span></span> <span data-ttu-id="f5b84-237">Det här sättet finns högst två övergångar för en tjänst under uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-237">This way there are at most two transitions for a service during the upgrade.</span></span> <span data-ttu-id="f5b84-238">Det finns en flytta bort från den aktuella noden och en flytta tillbaka.</span><span class="sxs-lookup"><span data-stu-id="f5b84-238">There is one move out of the affected node and one move back in.</span></span> <span data-ttu-id="f5b84-239">Returnerar det kluster eller en tjänst till hur den var innan du uppgraderar betyder också uppgraderingen inte påverkar layouten för klustret.</span><span class="sxs-lookup"><span data-stu-id="f5b84-239">Returning the cluster or service to how it was before the upgrade also ensures the upgrade doesn’t impact the layout of the cluster.</span></span> 

### <a name="reduced-churn"></a><span data-ttu-id="f5b84-240">Minskad omsättning</span><span class="sxs-lookup"><span data-stu-id="f5b84-240">Reduced churn</span></span>
<span data-ttu-id="f5b84-241">En annan sak som sker under uppgraderingar är som klustret Resource Manager-stänger av belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="f5b84-241">Another thing that happens during upgrades is that the Cluster Resource Manager turns off balancing.</span></span> <span data-ttu-id="f5b84-242">Hindrar NLB förhindrar onödiga reaktioner uppgraderingen, som att flytta tjänster i noder som har tömts för uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-242">Preventing balancing prevents unnecessary reactions to the upgrade itself, like moving services into nodes that were emptied for the upgrade.</span></span> <span data-ttu-id="f5b84-243">Om uppgraderingen i fråga är en uppgradering av klustret, balanserade hela klustret inte under uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="f5b84-243">If the upgrade in question is a Cluster upgrade, then the entire cluster is not balanced during the upgrade.</span></span> <span data-ttu-id="f5b84-244">Begränsningen kontrollerar förblir aktiv, endast transport baserat på proaktiv fördelningen av mått är inaktiverad.</span><span class="sxs-lookup"><span data-stu-id="f5b84-244">Constraint checks stay active, only movement based on the proactive balancing of metrics is disabled.</span></span>

### <a name="buffered-capacity--upgrade"></a><span data-ttu-id="f5b84-245">Buffrat kapacitet och uppgradering</span><span class="sxs-lookup"><span data-stu-id="f5b84-245">Buffered Capacity & Upgrade</span></span>
<span data-ttu-id="f5b84-246">Vanligtvis vill du att uppgraderingen ska kunna slutföra även om klustret är begränsad eller nära full.</span><span class="sxs-lookup"><span data-stu-id="f5b84-246">Generally you want the upgrade to complete even if the cluster is constrained or close to full.</span></span> <span data-ttu-id="f5b84-247">Hantera kapacitet i klustret är även viktigare under uppgraderingar än vanligt.</span><span class="sxs-lookup"><span data-stu-id="f5b84-247">Managing the capacity of the cluster is even more important during upgrades than usual.</span></span> <span data-ttu-id="f5b84-248">Beroende på antalet uppgraderingsdomäner, måste mellan 5 och 20 procent av kapacitet migreras som uppgraderingen samlar i klustret.</span><span class="sxs-lookup"><span data-stu-id="f5b84-248">Depending on the number of upgrade domains, between 5 and 20 percent of capacity must be migrated as the upgrade rolls through the cluster.</span></span> <span data-ttu-id="f5b84-249">Arbetet har gå någonstans.</span><span class="sxs-lookup"><span data-stu-id="f5b84-249">That work has to go somewhere.</span></span> <span data-ttu-id="f5b84-250">Det är där begreppet [buffras kapaciteter](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) är användbart.</span><span class="sxs-lookup"><span data-stu-id="f5b84-250">This is where the notion of [buffered capacities](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) is useful.</span></span> <span data-ttu-id="f5b84-251">Buffrat kapacitet följs under normal drift.</span><span class="sxs-lookup"><span data-stu-id="f5b84-251">Buffered capacity is respected during normal operation.</span></span> <span data-ttu-id="f5b84-252">Klustret Resource Manager kan fylla noder upp till sina total kapacitet (förbrukar bufferten) under uppgraderingar om det behövs.</span><span class="sxs-lookup"><span data-stu-id="f5b84-252">The Cluster Resource Manager may fill nodes up to their total capacity (consuming the buffer) during upgrades if necessary.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f5b84-253">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="f5b84-253">Next steps</span></span>
* <span data-ttu-id="f5b84-254">Börja från början och [få en introduktion till Service Fabric klustret Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="f5b84-254">Start from the beginning and [get an Introduction to the Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
