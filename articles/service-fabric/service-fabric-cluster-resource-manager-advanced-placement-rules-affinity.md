---
title: "aaaService Fabric klustret Resource Manager - tillhörighet | Microsoft Docs"
description: "Översikt över hur du konfigurerar tillhörighet för Service Fabric-tjänster"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7dc9b6d9c18d9d615d39cff7de9d7cba1c040474
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a><span data-ttu-id="cb3fa-103">Konfigurera och använda tjänsten tillhörighet i Service Fabric</span><span class="sxs-lookup"><span data-stu-id="cb3fa-103">Configuring and using service affinity in Service Fabric</span></span>
<span data-ttu-id="cb3fa-104">Tillhörighet är en kontroll som tillhandahålls huvudsakligen toohelp enkel hello övergången av större gigantiska program i molnet och mikrotjänster hälsningsmeddelande.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-104">Affinity is a control that is provided mainly toohelp ease hello transition of larger monolithic applications into hello cloud and microservices world.</span></span> <span data-ttu-id="cb3fa-105">Det används också som en optimering för att förbättra hello prestanda för tjänster, även om detta kan ha sidoeffekter.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-105">It is also used as an optimization for improving hello performance of services, although doing so can have side effects.</span></span>

<span data-ttu-id="cb3fa-106">Anta att du tillämpar en större app eller en som bara inte utformad med mikrotjänster i åtanke, tooService Fabric (eller distribuerad miljö).</span><span class="sxs-lookup"><span data-stu-id="cb3fa-106">Let’s say you’re bringing a larger app, or one that just wasn’t designed with microservices in mind, tooService Fabric (or any distributed environment).</span></span> <span data-ttu-id="cb3fa-107">Den här typen av övergången är vanligt.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-107">This type of transition is common.</span></span> <span data-ttu-id="cb3fa-108">Börja med att lyfta hello hela appen till hello miljö, paketera den och gör att den körs utan problem.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-108">You start by lifting hello entire app into hello environment, packaging it, and making sure it is running smoothly.</span></span> <span data-ttu-id="cb3fa-109">Du startar sedan dela upp frågan i olika mindre tjänster att alla prata tooeach andra.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-109">Then you start breaking it down into different smaller services that all talk tooeach other.</span></span>

<span data-ttu-id="cb3fa-110">Slutligen kan du programmet hello har några problem.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-110">Eventually you may find that hello application is experiencing some issues.</span></span> <span data-ttu-id="cb3fa-111">hello problem indelas vanligtvis i dessa kategorier:</span><span class="sxs-lookup"><span data-stu-id="cb3fa-111">hello issues usually fall into one of these categories:</span></span>

1. <span data-ttu-id="cb3fa-112">Vissa komponenten X i hello monolitisk app hade ett odokumenterade beroende på komponenten Y och du har aktiverat precis dessa komponenter till separata tjänster.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-112">Some component X in hello monolithic app had an undocumented dependency on component Y, and you just turned those components into separate services.</span></span> <span data-ttu-id="cb3fa-113">Eftersom dessa tjänster körs nu på olika noder i klustret hello, är de bruten.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-113">Since these services are now running on different nodes in hello cluster, they're broken.</span></span>
2. <span data-ttu-id="cb3fa-114">Dessa komponenter kommunicerar (lokal namngivna pipes | delat minne | filer på disk) och de verkligen behöver toobe kan toowrite tooa delade lokal resurs av prestandaskäl just nu.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-114">These components communicate via (local named pipes | shared memory | files on disk) and they really need toobe able toowrite tooa shared local resource for performance reasons right now.</span></span> <span data-ttu-id="cb3fa-115">Hårda sambandet hämtar togs bort senare, kanske.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-115">That hard dependency gets removed later, maybe.</span></span>
3. <span data-ttu-id="cb3fa-116">Allt är bra, men det visar sig att dessa två komponenter är faktiskt chatty och prestanda känslig.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-116">Everything is fine, but it turns out that these two components are actually chatty/performance sensitive.</span></span> <span data-ttu-id="cb3fa-117">När de flyttas dem till olika tjänster övergripande programprestanda tanked eller latens ökade.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-117">When they moved them into separate services overall application performance tanked or latency increased.</span></span> <span data-ttu-id="cb3fa-118">Därför uppfyller hello övergripande inte förväntningar.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-118">As a result, hello overall application is not meeting expectations.</span></span>

<span data-ttu-id="cb3fa-119">I dessa fall kan vi vill inte toolose våra refaktoriseringsaktiviteter arbete och vill inte toogo tillbaka toohello monolitvolym.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-119">In these cases, we don’t want toolose our refactoring work, and don’t want toogo back toohello monolith.</span></span> <span data-ttu-id="cb3fa-120">hello senaste villkor kan även vara önskvärt som en vanlig optimering.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-120">hello last condition may even be desirable as a plain optimization.</span></span> <span data-ttu-id="cb3fa-121">Dock vi tills vi bearbeta hello komponenter toowork naturligt som tjänster (eller kan vi lösa hello prestandaförväntningarna något annat sätt) tooneed vissa uppfattning om ort.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-121">However, until we can redesign hello components toowork naturally as services (or until we can solve hello performance expectations some other way) we're going tooneed some sense of locality.</span></span>

<span data-ttu-id="cb3fa-122">Vilka toodo?</span><span class="sxs-lookup"><span data-stu-id="cb3fa-122">What toodo?</span></span> <span data-ttu-id="cb3fa-123">Dessutom kan du aktivera tillhörighet.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-123">Well, you could try turning on affinity.</span></span>

## <a name="how-tooconfigure-affinity"></a><span data-ttu-id="cb3fa-124">Hur tooconfigure tillhörighet</span><span class="sxs-lookup"><span data-stu-id="cb3fa-124">How tooconfigure affinity</span></span>
<span data-ttu-id="cb3fa-125">tooset in tillhörighet du definiera en tillhörigheten mellan två olika tjänster.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-125">tooset up affinity, you define an affinity relationship between two different services.</span></span> <span data-ttu-id="cb3fa-126">Du kan tänka dig tillhörighet som ”pekar” en-tjänst på en annan och säger ”den här tjänsten kan endast köras var att tjänsten körs”.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-126">You can think of affinity as “pointing” one service at another and saying “This service can only run where that service is running.”</span></span> <span data-ttu-id="cb3fa-127">Ibland refererar vi tooaffinity som en överordnad-underordnad relation (där du peka hello underordnade på hello överordnade).</span><span class="sxs-lookup"><span data-stu-id="cb3fa-127">Sometimes we refer tooaffinity as a parent/child relationship (where you point hello child at hello parent).</span></span> <span data-ttu-id="cb3fa-128">Det innebär att hello repliker eller instanser av en tjänst är placerade på hello samma noder som en annan tjänst.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-128">Affinity ensures that hello replicas or instances of one service are placed on hello same nodes as those of another service.</span></span>

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> <span data-ttu-id="cb3fa-129">En underordnad tjänst kan bara ingå i en enda tillhörigheten.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-129">A child service can only participate in a single affinity relationship.</span></span> <span data-ttu-id="cb3fa-130">Om du vill ha hello underordnade toobe tillhör tootwo överordnade tjänster samtidigt har flera olika alternativ:</span><span class="sxs-lookup"><span data-stu-id="cb3fa-130">If you wanted hello child toobe affinitized tootwo parent services at once you have a couple options:</span></span>
> - <span data-ttu-id="cb3fa-131">Omvänd hello relationer (har parentService1 och parentService2 som pekar på hello aktuella underordnade tjänster), eller</span><span class="sxs-lookup"><span data-stu-id="cb3fa-131">Reverse hello relationships (have parentService1 and parentService2 point at hello current child service), or</span></span>
> - <span data-ttu-id="cb3fa-132">Utse en hello överordnade som ett nav enligt konventionen och alla tjänster som pekar på den tjänsten.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-132">Designate one of hello parents as a hub by convention and have all services point at that service.</span></span> 
>
> <span data-ttu-id="cb3fa-133">hello resulterande placeringen i hello kluster bör hello samma.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-133">hello resulting placement behavior in hello cluster should be hello same.</span></span>
>

## <a name="different-affinity-options"></a><span data-ttu-id="cb3fa-134">Alternativ för olika tillhörighet</span><span class="sxs-lookup"><span data-stu-id="cb3fa-134">Different affinity options</span></span>
<span data-ttu-id="cb3fa-135">Tillhörighet representeras via en av flera scheman för korrelation och har två olika lägen.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-135">Affinity is represented via one of several correlation schemes, and has two different modes.</span></span> <span data-ttu-id="cb3fa-136">hello vanligaste läget för mappning mellan engelskans NonAlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-136">hello most common mode of affinity is what we call NonAlignedAffinity.</span></span> <span data-ttu-id="cb3fa-137">Hej repliker i NonAlignedAffinity, eller instanser av hello olika tjänster är placerad hello samma noder.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-137">In NonAlignedAffinity, hello replicas or instances of hello different services are placed on hello same nodes.</span></span> <span data-ttu-id="cb3fa-138">hello är andra läge AlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-138">hello other mode is AlignedAffinity.</span></span> <span data-ttu-id="cb3fa-139">Justerade tillhörighet är användbar bara med tillståndskänsliga tjänster.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-139">Aligned Affinity is useful only with stateful services.</span></span> <span data-ttu-id="cb3fa-140">Konfigurera två stateful services toohave justerad innebär att hello primärfärgerna av tjänsterna är placerade på hello samma noder som varje andra.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-140">Configuring two stateful services toohave aligned affinity ensures that hello primaries of those services are placed on hello same nodes as each other.</span></span> <span data-ttu-id="cb3fa-141">Det gör även varje par av sekundärservrar för dessa tjänster toobe placerad hello samma noder.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-141">It also causes each pair of secondaries for those services toobe placed on hello same nodes.</span></span> <span data-ttu-id="cb3fa-142">Det är också möjligt (dock mindre vanliga) tooconfigure NonAlignedAffinity för tillståndskänsliga tjänster.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-142">It is also possible (though less common) tooconfigure NonAlignedAffinity for stateful services.</span></span> <span data-ttu-id="cb3fa-143">Hello olika repliker av hello två tillståndskänsliga tjänster körs på hello samma noder för NonAlignedAffinity, men deras primärfärgerna kan hamna på olika noder.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-143">For NonAlignedAffinity, hello different replicas of hello two stateful services would run on hello same nodes, but their primaries could end up on different nodes.</span></span>

<span data-ttu-id="cb3fa-144"><center>
![Tillhörighet och deras effekter][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="cb3fa-144"><center>
![Affinity Modes and Their Effects][Image1]
</center></span></span>

### <a name="best-effort-desired-state"></a><span data-ttu-id="cb3fa-145">Bästa prestanda önskad tillstånd</span><span class="sxs-lookup"><span data-stu-id="cb3fa-145">Best effort desired state</span></span>
<span data-ttu-id="cb3fa-146">En mappningsrelation är bästa prestanda.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-146">An affinity relationship is best effort.</span></span> <span data-ttu-id="cb3fa-147">Ger inte hello samma garantier för samplacering eller tillförlitlighet som körs i hello samma körbara process.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-147">It does not provide hello same guarantees of collocation or reliability that running in hello same executable process does.</span></span> <span data-ttu-id="cb3fa-148">hello-tjänster i ett tillhörigheten är helt olika enheter som kan misslyckas och flyttas oberoende av varandra.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-148">hello services in an affinity relationship are fundamentally different entities that can fail and be moved independently.</span></span> <span data-ttu-id="cb3fa-149">En tillhörigheten kan också dela, även om dessa radbrytningar är tillfällig.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-149">An affinity relationship could also break, though these breaks are temporary.</span></span> <span data-ttu-id="cb3fa-150">Till exempel innebär kapacitetsbegränsningar att endast en del av hello tjänstobjekt i hello tillhörigheten får plats på en viss nod.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-150">For example, capacity limitations may mean that only some of hello service objects in hello affinity relationship can fit on a given node.</span></span> <span data-ttu-id="cb3fa-151">I dessa fall även om det finns en tillhörigheten på plats, den kan inte tillämpas på grund av toohello andra villkor.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-151">In these cases even though there's an affinity relationship in place, it can't be enforced due toohello other constraints.</span></span> <span data-ttu-id="cb3fa-152">Om det är möjligt toodo så korrigeras hello överträdelse senare.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-152">If it is possible toodo so, hello violation is automatically corrected later.</span></span>

### <a name="chains-vs-stars"></a><span data-ttu-id="cb3fa-153">Kedjor kontra stjärnor</span><span class="sxs-lookup"><span data-stu-id="cb3fa-153">Chains vs. stars</span></span>
<span data-ttu-id="cb3fa-154">Idag är hello klustret Resource Manager inte kan toomodel kedjor tillhörighet relationer.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-154">Today hello Cluster Resource Manager isn't able toomodel chains of affinity relationships.</span></span> <span data-ttu-id="cb3fa-155">Det innebär som en tjänst som är underordnat i en tillhörigheten får inte vara en förälder i en annan tillhörigheten.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-155">What this means is that a service that is a child in one affinity relationship can’t be a parent in another affinity relationship.</span></span> <span data-ttu-id="cb3fa-156">Om du vill toomodel den här typen av relation kan du effektivt har toomodel den som en stjärna i stället för en kedja.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-156">If you want toomodel this type of relationship, you effectively have toomodel it as a star, rather than a chain.</span></span> <span data-ttu-id="cb3fa-157">toomove från en kedja tooa stjärna, hello lägsta underordnade skulle vara överordnad toohello första underordnade överordnade i stället.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-157">toomove from a chain tooa star, hello bottommost child would be parented toohello first child’s parent instead.</span></span> <span data-ttu-id="cb3fa-158">Beroende på hello placering av dina tjänster kanske toodo detta flera gånger.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-158">Depending on hello arrangement of your services, you may have toodo this multiple times.</span></span> <span data-ttu-id="cb3fa-159">Om det finns ingen fysisk överordnade tjänst, kan du ha toocreate som fungerar som platshållare.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-159">If there's no natural parent service, you may have toocreate one that serves as a placeholder.</span></span> <span data-ttu-id="cb3fa-160">Beroende på dina krav kan du kanske också vill toolook till [programgrupper](service-fabric-cluster-resource-manager-application-groups.md).</span><span class="sxs-lookup"><span data-stu-id="cb3fa-160">Depending on your requirements, you may also want toolook into [Application Groups](service-fabric-cluster-resource-manager-application-groups.md).</span></span>

<span data-ttu-id="cb3fa-161"><center>
![Kedjor vs. Stjärnorna hello kontexten tillhörighet relationer][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="cb3fa-161"><center>
![Chains vs. Stars in hello Context of Affinity Relationships][Image2]
</center></span></span>

<span data-ttu-id="cb3fa-162">En annan sak toonote om mappning mellan relationer är idag att de är riktat.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-162">Another thing toonote about affinity relationships today is that they are directional.</span></span> <span data-ttu-id="cb3fa-163">Det innebär att hello tillhörighet regeln endast tillämpar den hello underordnade placeras med hello överordnad.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-163">This means that hello affinity rule only enforces that hello child placed with hello parent.</span></span> <span data-ttu-id="cb3fa-164">Det garanterar inte att hello överordnade finns med hello underordnade.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-164">It does not ensure that hello parent is located with hello child.</span></span> <span data-ttu-id="cb3fa-165">Det är också viktigt toonote som hello tillhörigheten inte kan perfekt eller direkt tillämpas eftersom olika tjänster har med olika livscykler kan misslyckas och flytta oberoende av varandra.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-165">It is also important toonote that hello affinity relationship can't be perfect or instantly enforced since different services have with different lifecycles and can fail and move independently.</span></span> <span data-ttu-id="cb3fa-166">Anta exempelvis att hello överordnade plötsligt att fungera över tooanother noden eftersom den har kraschat.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-166">For example, let's say hello parent suddenly fails over tooanother node because it crashed.</span></span> <span data-ttu-id="cb3fa-167">hello klustret Resource Manager och Failover Manager referensen du hello redundans först, eftersom hello tjänster, konsekvent och tillgängliga är hello prioritet.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-167">hello Cluster Resource Manager and Failover Manager handle hello failover first, since keeping hello services up, consistent, and available is hello priority.</span></span> <span data-ttu-id="cb3fa-168">När hello växling vid fel är klar hello tillhörigheten har brutits, men hello klustret Resource Manager tror att allt är bra tills den meddelanden den hello underordnat finns inte med hello överordnad.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-168">Once hello failover completes, hello affinity relationship is broken, but hello Cluster Resource Manager thinks everything is fine until it notices that hello child is not located with hello parent.</span></span> <span data-ttu-id="cb3fa-169">Dessa typer av kontroller som utförs med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-169">These sorts of checks are performed periodically.</span></span> <span data-ttu-id="cb3fa-170">Mer information om hur hello klustret Resource Manager utvärderar villkor finns i [i den här artikeln](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), och [den här](service-fabric-cluster-resource-manager-balancing.md) berättar mer om hur tooconfigure hello takt där dessa villkor är utvärdera.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-170">More information on how hello Cluster Resource Manager evaluates constraints is available in [this article](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), and [this one](service-fabric-cluster-resource-manager-balancing.md) talks more about how tooconfigure hello cadence on which these constraints are evaluated.</span></span>   


### <a name="partitioning-support"></a><span data-ttu-id="cb3fa-171">Partitionering</span><span class="sxs-lookup"><span data-stu-id="cb3fa-171">Partitioning support</span></span>
<span data-ttu-id="cb3fa-172">hello sista åtgärd toonotice om mappning mellan är att tillhörighet relationer inte stöds där hello överordnade är partitionerad.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-172">hello final thing toonotice about affinity is that affinity relationships aren’t supported where hello parent is partitioned.</span></span> <span data-ttu-id="cb3fa-173">Partitionerade överordnade tjänster kan stödjas förr eller senare, men idag är det inte tillåtet.</span><span class="sxs-lookup"><span data-stu-id="cb3fa-173">Partitioned parent services may be supported eventually, but today it is not allowed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cb3fa-174">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="cb3fa-174">Next steps</span></span>
- <span data-ttu-id="cb3fa-175">Mer information om hur du konfigurerar tjänster, [Lär dig mer om hur du konfigurerar tjänster](service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="cb3fa-175">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="cb3fa-176">toolimit services tooa liten uppsättning datorer eller aggregering hello belastningsutjämning för tjänster, Använd [programgrupper](service-fabric-cluster-resource-manager-application-groups.md)</span><span class="sxs-lookup"><span data-stu-id="cb3fa-176">toolimit services tooa small set of machines or aggregating hello load of services, use [Application Groups](service-fabric-cluster-resource-manager-application-groups.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png