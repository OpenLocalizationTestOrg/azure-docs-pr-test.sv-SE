---
title: "Lägg till anpassad Service Fabric-hälsorapporter | Microsoft Docs"
description: "Beskriver hur du skickar anpassade hälsorapporter till Azure Service Fabric hälsa entiteter. Ger rekommendationer för att utforma och implementera kvalitet hälsorapporter."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: ed10eef347d4d93012078456b3a145589e66d30e
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="30adf-104">Lägga till anpassade hälsorapporter i Service Fabric</span><span class="sxs-lookup"><span data-stu-id="30adf-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="30adf-105">Azure Service Fabric introducerar en [hälsomodell](service-fabric-health-introduction.md) utformats för att flaggan ohälsosamt klustret och villkoren för programmet på specifika enheter.</span><span class="sxs-lookup"><span data-stu-id="30adf-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed to flag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="30adf-106">Hälsomodell använder **hälsa rapportörer** (systemkomponenter och watchdogs).</span><span class="sxs-lookup"><span data-stu-id="30adf-106">The health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="30adf-107">Målet är enkelt och snabbt diagnos och reparation.</span><span class="sxs-lookup"><span data-stu-id="30adf-107">The goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="30adf-108">Service-skrivare måste du tänka igenom summa om hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="30adf-108">Service writers need to think upfront about health.</span></span> <span data-ttu-id="30adf-109">Eventuella villkor som kan påverka hälsa redovisas, särskilt om det kan hjälpa flaggan problem nära roten.</span><span class="sxs-lookup"><span data-stu-id="30adf-109">Any condition that can impact health should be reported on, especially if it can help flag problems close to the root.</span></span> <span data-ttu-id="30adf-110">Information om hälsa kan spara tid och pengar på felsökning och undersökning.</span><span class="sxs-lookup"><span data-stu-id="30adf-110">The health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="30adf-111">Användbarhet är särskilt tydligt när tjänsten är igång och körs i skala i molnet (privat eller Azure).</span><span class="sxs-lookup"><span data-stu-id="30adf-111">The usefulness is especially clear once the service is up and running at scale in the cloud (private or Azure).</span></span>

<span data-ttu-id="30adf-112">Service Fabric-rapportörer övervakaren identifieras villkor av intresse.</span><span class="sxs-lookup"><span data-stu-id="30adf-112">The Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="30adf-113">De rapport om dessa villkor baserat på deras lokala vyn.</span><span class="sxs-lookup"><span data-stu-id="30adf-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="30adf-114">Den [hälsoarkivet](service-fabric-health-introduction.md#health-store) samlar in hälsa data skickas av alla rapportörer för att avgöra om enheterna är globalt felfritt.</span><span class="sxs-lookup"><span data-stu-id="30adf-114">The [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters to determine whether entities are globally healthy.</span></span> <span data-ttu-id="30adf-115">Modellen är avsedd att vara omfattande, flexibla och enkla att använda.</span><span class="sxs-lookup"><span data-stu-id="30adf-115">The model is intended to be rich, flexible, and easy to use.</span></span> <span data-ttu-id="30adf-116">Kvaliteten på hälsorapporter anger korrektheten i vyn hälsa i klustret.</span><span class="sxs-lookup"><span data-stu-id="30adf-116">The quality of the health reports determines the accuracy of the health view of the cluster.</span></span> <span data-ttu-id="30adf-117">Falska positiva identifieringar som visar felaktigt ohälsosamt problem kan påverka uppgraderingar och andra tjänster som använder hälsa data.</span><span class="sxs-lookup"><span data-stu-id="30adf-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="30adf-118">Exempel på sådana tjänster är reparation och mekanismer för aviseringar.</span><span class="sxs-lookup"><span data-stu-id="30adf-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="30adf-119">Därför behövs tänka för att tillhandahålla rapporter som samlar in villkor för intresse för bästa möjliga sätt.</span><span class="sxs-lookup"><span data-stu-id="30adf-119">Therefore, some thought is needed to provide reports that capture conditions of interest in the best possible way.</span></span>

<span data-ttu-id="30adf-120">För att utforma och implementera hälsa reporting watchdogs och systemkomponenter måste:</span><span class="sxs-lookup"><span data-stu-id="30adf-120">To design and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="30adf-121">Definiera villkoret intressanta och hur den är övervakad inverkan på funktionen kluster eller ett program.</span><span class="sxs-lookup"><span data-stu-id="30adf-121">Define the condition they are interested in, the way it is monitored, and the impact on the cluster or application functionality.</span></span> <span data-ttu-id="30adf-122">Baserat på den här informationen kan besluta om hälsa rapportegenskap och hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="30adf-122">Based on this information, decide on the health report property and health state.</span></span>
* <span data-ttu-id="30adf-123">Ta reda på [entiteten](service-fabric-health-introduction.md#health-entities-and-hierarchy) som rapporten avser.</span><span class="sxs-lookup"><span data-stu-id="30adf-123">Determine the [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that the report applies to.</span></span>
* <span data-ttu-id="30adf-124">Avgöra var reporting är klart, från tjänsten eller från en intern eller extern watchdog.</span><span class="sxs-lookup"><span data-stu-id="30adf-124">Determine where the reporting is done, from within the service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="30adf-125">Definiera en datakälla som används för att identifiera personen.</span><span class="sxs-lookup"><span data-stu-id="30adf-125">Define a source used to identify the reporter.</span></span>
* <span data-ttu-id="30adf-126">Välj en reporting strategi regelbundet eller på övergångar.</span><span class="sxs-lookup"><span data-stu-id="30adf-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="30adf-127">Det rekommenderade sättet är att med jämna mellanrum, eftersom det kräver att enklare koden och är mindre risk för fel.</span><span class="sxs-lookup"><span data-stu-id="30adf-127">The recommended way is periodically, as it requires simpler code and is less prone to errors.</span></span>
* <span data-ttu-id="30adf-128">Avgör hur lång tid rapporten för ohälsosamt villkor ska vara i health store och hur det ska vara avmarkerade.</span><span class="sxs-lookup"><span data-stu-id="30adf-128">Determine how long the report for unhealthy conditions should stay in the health store and how it should be cleared.</span></span> <span data-ttu-id="30adf-129">Med den här informationen kan bestämma time to live-rapportens och ta bort på förfallodatum beteende.</span><span class="sxs-lookup"><span data-stu-id="30adf-129">Using this information, decide the report's time to live and remove-on-expiration behavior.</span></span>

<span data-ttu-id="30adf-130">Som tidigare nämnts kan kan reporting göras från:</span><span class="sxs-lookup"><span data-stu-id="30adf-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="30adf-131">Övervakade Service Fabric-tjänsten-repliken.</span><span class="sxs-lookup"><span data-stu-id="30adf-131">The monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="30adf-132">Internt watchdogs distribueras som en Service Fabric-tjänsten till exempel ett Service Fabric tillståndslös som övervakar villkor och skickar rapporter.</span><span class="sxs-lookup"><span data-stu-id="30adf-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="30adf-133">Watchdogs kan vara distribueras ett alla noder eller kan tillhöra den övervakade tjänsten.</span><span class="sxs-lookup"><span data-stu-id="30adf-133">The watchdogs can be deployed an all nodes or can be affinitized to the monitored service.</span></span>
* <span data-ttu-id="30adf-134">Internt watchdogs som körs på Service Fabric-noder, men som *inte* implementeras som Service Fabric-tjänster.</span><span class="sxs-lookup"><span data-stu-id="30adf-134">Internal watchdogs that run on the Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="30adf-135">Externa watchdogs som avsökning resurs från *utanför* Service Fabric-klustret (till exempel övervakningstjänsten som Gomez).</span><span class="sxs-lookup"><span data-stu-id="30adf-135">External watchdogs that probe the resource from *outside* the Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="30adf-136">Out of box fylls klustret med hälsorapporter som skickas av systemkomponenter.</span><span class="sxs-lookup"><span data-stu-id="30adf-136">Out of the box, the cluster is populated with health reports sent by the system components.</span></span> <span data-ttu-id="30adf-137">Läs mer på [med systemhälsa rapporter för felsökning](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="30adf-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="30adf-138">Rapporterna som användaren måste skickas [hälsa entiteter](service-fabric-health-introduction.md#health-entities-and-hierarchy) som redan har skapats av systemet.</span><span class="sxs-lookup"><span data-stu-id="30adf-138">The user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by the system.</span></span>
> 
> 

<span data-ttu-id="30adf-139">När hälsotillståndet reporting design är avmarkerad, hälsorapporter kan skickas enkelt.</span><span class="sxs-lookup"><span data-stu-id="30adf-139">Once the health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="30adf-140">Du kan använda [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) för rapporten hälsa om klustret inte [säker](service-fabric-cluster-security.md) eller om fabric-klienten har administratörsrättigheter.</span><span class="sxs-lookup"><span data-stu-id="30adf-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) to report health if the cluster is not [secure](service-fabric-cluster-security.md) or if the fabric client has admin privileges.</span></span> <span data-ttu-id="30adf-141">Rapportering kan göras via API: et genom att använda [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), via PowerShell eller via REST.</span><span class="sxs-lookup"><span data-stu-id="30adf-141">Reporting can be done through the API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="30adf-142">Konfigurationen rattar batch-rapporter för bättre prestanda.</span><span class="sxs-lookup"><span data-stu-id="30adf-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="30adf-143">Rapportera hälsa är synkron och representerar validering arbete på klientsidan.</span><span class="sxs-lookup"><span data-stu-id="30adf-143">Report health is synchronous, and it represents only the validation work on the client side.</span></span> <span data-ttu-id="30adf-144">Det faktum att rapporten har godkänts av klientens hälsa eller `Partition` eller `CodePackageActivationContext` objekt innebär inte att tillämpas i arkivet.</span><span class="sxs-lookup"><span data-stu-id="30adf-144">The fact that the report is accepted by the health client or the `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in the store.</span></span> <span data-ttu-id="30adf-145">Skickas asynkront och eventuellt batchar med andra rapporter.</span><span class="sxs-lookup"><span data-stu-id="30adf-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="30adf-146">Bearbetning på servern misslyckas fortfarande: sekvensnumret kan vara inaktuella, entiteten som rapporten ska tillämpas har tagits bort, osv.</span><span class="sxs-lookup"><span data-stu-id="30adf-146">The processing on the server may still fail: the sequence number could be stale, the entity on which the report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="30adf-147">Hälsotillstånd klienten</span><span class="sxs-lookup"><span data-stu-id="30adf-147">Health client</span></span>
<span data-ttu-id="30adf-148">Hälsorapporter skickas till hälsoarkivet via en hälsa-klient finns i fabric-klienten.</span><span class="sxs-lookup"><span data-stu-id="30adf-148">The health reports are sent to the health store through a health client, which lives inside the fabric client.</span></span> <span data-ttu-id="30adf-149">Klientens hälsa kan konfigureras med följande inställningar:</span><span class="sxs-lookup"><span data-stu-id="30adf-149">The health client can be configured with the following settings:</span></span>

* <span data-ttu-id="30adf-150">**HealthReportSendInterval**: fördröjning mellan då rapporten läggs till klienten och det skickas till arkivet hälsa.</span><span class="sxs-lookup"><span data-stu-id="30adf-150">**HealthReportSendInterval**: The delay between the time the report is added to the client and the time it is sent to the health store.</span></span> <span data-ttu-id="30adf-151">Används för batch-rapporter i ett enda meddelande, i stället för att skicka ett meddelande för varje rapport.</span><span class="sxs-lookup"><span data-stu-id="30adf-151">Used to batch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="30adf-152">Den batchbearbetning förbättrar prestanda.</span><span class="sxs-lookup"><span data-stu-id="30adf-152">The batching improves performance.</span></span> <span data-ttu-id="30adf-153">Standard: 30 sekunder.</span><span class="sxs-lookup"><span data-stu-id="30adf-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="30adf-154">**HealthReportRetrySendInterval**: intervallet då hälsa klienten skickar ackumulerade hälsa rapporterar till health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-154">**HealthReportRetrySendInterval**: The interval at which the health client resends accumulated health reports to the health store.</span></span> <span data-ttu-id="30adf-155">Standard: 30 sekunder.</span><span class="sxs-lookup"><span data-stu-id="30adf-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="30adf-156">**HealthOperationTimeout**: tidsgränsen för en rapport meddelandet som skickades till health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-156">**HealthOperationTimeout**: The timeout period for a report message sent to the health store.</span></span> <span data-ttu-id="30adf-157">Om ett meddelande på grund av timeout, klientens hälsa den tills health store bekräftar att rapporten har bearbetats.</span><span class="sxs-lookup"><span data-stu-id="30adf-157">If a message times out, the health client retries it until the health store confirms that the report has been processed.</span></span> <span data-ttu-id="30adf-158">Standard: två minuter.</span><span class="sxs-lookup"><span data-stu-id="30adf-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="30adf-159">När rapporterna grupperas fabric-klienten måste hållas aktiva för minst HealthReportSendInterval så att de skickas.</span><span class="sxs-lookup"><span data-stu-id="30adf-159">When the reports are batched, the fabric client must be kept alive for at least the HealthReportSendInterval to ensure that they are sent.</span></span> <span data-ttu-id="30adf-160">Om meddelandet försvinner eller health store kan inte använda dem på grund av tillfälliga fel fabric-klienten måste hållas aktiva längre att ge det en risk att försöka igen.</span><span class="sxs-lookup"><span data-stu-id="30adf-160">If the message is lost or the health store cannot apply them due to transient errors, the fabric client must be kept alive longer to give it a chance to retry.</span></span>
> 
> 

<span data-ttu-id="30adf-161">Buffring på klienten tar unika rapporterna i beräkningen.</span><span class="sxs-lookup"><span data-stu-id="30adf-161">The buffering on the client takes the uniqueness of the reports into consideration.</span></span> <span data-ttu-id="30adf-162">Till exempel om en viss felaktiga rapport rapporterar 100 rapporter per sekund på samma tillhör samma entitet ersätts rapporterna med den senaste versionen.</span><span class="sxs-lookup"><span data-stu-id="30adf-162">For example, if a particular bad reporter is reporting 100 reports per second on the same property of the same entity, the reports are replaced with the last version.</span></span> <span data-ttu-id="30adf-163">Högst en sådan rapport finns i kön för klienten.</span><span class="sxs-lookup"><span data-stu-id="30adf-163">At most one such report exists in the client queue.</span></span> <span data-ttu-id="30adf-164">Om batchbearbetning är konfigurerad, är antal rapporter som skickas till arkivet hälsa bara en per skicka intervall.</span><span class="sxs-lookup"><span data-stu-id="30adf-164">If batching is configured, the number of reports sent to the health store is just one per send interval.</span></span> <span data-ttu-id="30adf-165">Den här rapporten är sista tillagda rapporten som visar det senaste läget för entiteten.</span><span class="sxs-lookup"><span data-stu-id="30adf-165">This report is the last added report, which reflects the most current state of the entity.</span></span>
<span data-ttu-id="30adf-166">Ange konfigurationsparametrar när `FabricClient` har skapats genom att skicka [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) med önskade värden hälsa-relaterade poster.</span><span class="sxs-lookup"><span data-stu-id="30adf-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with the desired values for health-related entries.</span></span>

<span data-ttu-id="30adf-167">I följande exempel skapar en fabric-klienten och anger att rapporterna ska skickas när de har lagts till.</span><span class="sxs-lookup"><span data-stu-id="30adf-167">The following example creates a fabric client and specifies that the reports should be sent when they are added.</span></span> <span data-ttu-id="30adf-168">På timeout och fel som kan göras inträffa försök varje 40 sekunder.</span><span class="sxs-lookup"><span data-stu-id="30adf-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="30adf-169">Rekommenderar vi att fabric standardklient inställningar som anges för `HealthReportSendInterval` till 30 sekunder.</span><span class="sxs-lookup"><span data-stu-id="30adf-169">We recommend keeping the default fabric client settings, which set `HealthReportSendInterval` to 30 seconds.</span></span> <span data-ttu-id="30adf-170">Den här inställningen garanterar optimala prestanda på grund av batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="30adf-170">This setting ensures optimal performance due to batching.</span></span> <span data-ttu-id="30adf-171">Kritiska rapporter som måste skickas så snart som möjligt, använda `HealthReportSendOptions` med Immediate `true` i [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span><span class="sxs-lookup"><span data-stu-id="30adf-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="30adf-172">Omedelbar rapporter kringgå batching intervall.</span><span class="sxs-lookup"><span data-stu-id="30adf-172">Immediate reports bypass the batching interval.</span></span> <span data-ttu-id="30adf-173">Använd den här flaggan med försiktighet; Vi vill dra nytta av klientens hälsa batchbearbetning när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="30adf-173">Use this flag with care; we want to take advantage of the health client batching whenever possible.</span></span> <span data-ttu-id="30adf-174">Omedelbar skicka är också praktisk när du stänger fabric-klienten (t.ex, processen har fastställt ogiltigt tillstånd och måste stängas för att förhindra sidoeffekter).</span><span class="sxs-lookup"><span data-stu-id="30adf-174">Immediate send is also useful when the fabric client is closing (for example, the process has determined invalid state and needs to shut down to prevent side effects).</span></span> <span data-ttu-id="30adf-175">Det garanterar en bästa skicka ackumulerade rapporter.</span><span class="sxs-lookup"><span data-stu-id="30adf-175">It ensures a best-effort send of the accumulated reports.</span></span> <span data-ttu-id="30adf-176">När en rapport läggs med omedelbar flaggan batchar klientens hälsa alla ackumulerade rapporter sedan senaste överföringen.</span><span class="sxs-lookup"><span data-stu-id="30adf-176">When one report is added with Immediate flag, the health client batches all the accumulated reports since last send.</span></span>

<span data-ttu-id="30adf-177">Samma parametrar kan anges när en anslutning till ett kluster skapas med hjälp av PowerShell.</span><span class="sxs-lookup"><span data-stu-id="30adf-177">Same parameters can be specified when a connection to a cluster is created through PowerShell.</span></span> <span data-ttu-id="30adf-178">Följande exempel startar en anslutning till det lokala klustret:</span><span class="sxs-lookup"><span data-stu-id="30adf-178">The following example starts a connection to a local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="30adf-179">På liknande sätt API, rapporter kan skickas med `-Immediate` växeln ska skickas omedelbart, oavsett den `HealthReportSendInterval` värde.</span><span class="sxs-lookup"><span data-stu-id="30adf-179">Similarly to API, reports can be sent using `-Immediate` switch to be sent immediately, regardless of the `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="30adf-180">För övriga skickas rapporterna till Service Fabric-gatewayen, som har en intern fabric-klienten.</span><span class="sxs-lookup"><span data-stu-id="30adf-180">For REST, the reports are sent to the Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="30adf-181">Som standard den här klienten är konfigurerad för att skicka rapporter batchar med 30 sekunders mellanrum.</span><span class="sxs-lookup"><span data-stu-id="30adf-181">By default, this client is configured to send reports batched every 30 seconds.</span></span> <span data-ttu-id="30adf-182">Du kan ändra intervallet batch med klustret Konfigurationsinställningen `HttpGatewayHealthReportSendInterval` på `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="30adf-182">You can change the batch interval with the cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="30adf-183">Som tidigare nämnts kan ett bättre alternativ är att skicka rapporter med `Immediate` SANT.</span><span class="sxs-lookup"><span data-stu-id="30adf-183">As mentioned, a better option is to send the reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="30adf-184">Konfigurera servern för att godkänna begäranden endast från skyddade klienter för att säkerställa att obehörig services inte kan rapportera hälsa mot entiteter i klustret.</span><span class="sxs-lookup"><span data-stu-id="30adf-184">To ensure that unauthorized services can't report health against the entities in the cluster, configure the server to accept requests only from secured clients.</span></span> <span data-ttu-id="30adf-185">Den `FabricClient` används för rapportering måste ha Säkerhetsaktiverade för att kunna kommunicera med klustret (till exempel med Kerberos eller certifikat-autentisering).</span><span class="sxs-lookup"><span data-stu-id="30adf-185">The `FabricClient` used for reporting must have security enabled to be able to communicate with the cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="30adf-186">Läs mer om [kluster säkerhet](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="30adf-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="30adf-187">Rapport från i låg behörighet services</span><span class="sxs-lookup"><span data-stu-id="30adf-187">Report from within low privilege services</span></span>
<span data-ttu-id="30adf-188">Om Service Fabric-tjänster inte har administratörsåtkomst till klustret, kan du rapportera hälsan på enheter från den aktuella kontexten via `Partition` eller `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="30adf-188">If Service Fabric services do not have admin access to the cluster, you can report health on entities from the current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="30adf-189">För tillståndslösa tjänster använder [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) att rapportera om den aktuella tjänstinstansen.</span><span class="sxs-lookup"><span data-stu-id="30adf-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) to report on the current service instance.</span></span>
* <span data-ttu-id="30adf-190">Tillståndskänsliga tjänster använder [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) att rapportera om aktuella repliken.</span><span class="sxs-lookup"><span data-stu-id="30adf-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) to report on current replica.</span></span>
* <span data-ttu-id="30adf-191">Använd [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) att rapportera om den aktuella partition entiteten.</span><span class="sxs-lookup"><span data-stu-id="30adf-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) to report on the current partition entity.</span></span>
* <span data-ttu-id="30adf-192">Använd [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) att rapportera om aktuella programmet.</span><span class="sxs-lookup"><span data-stu-id="30adf-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) to report on current application.</span></span>
* <span data-ttu-id="30adf-193">Använd [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) att rapportera om det aktuella programmet har distribuerats på den aktuella noden.</span><span class="sxs-lookup"><span data-stu-id="30adf-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) to report on the current application deployed on the current node.</span></span>
* <span data-ttu-id="30adf-194">Använd [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) att rapportera om inget tjänstepaket för program som distribuerats på den aktuella noden.</span><span class="sxs-lookup"><span data-stu-id="30adf-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) to report on a service package for the application deployed on the current node.</span></span>

> [!NOTE]
> <span data-ttu-id="30adf-195">Internt, den `Partition` och `CodePackageActivationContext` håller en hälsa-klient som konfigurerats med standardinställningar.</span><span class="sxs-lookup"><span data-stu-id="30adf-195">Internally, the `Partition` and the `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="30adf-196">Enligt beskrivningen för den [hälsa klienten](service-fabric-report-health.md#health-client), rapporter batchbearbetas och skickas på en timer.</span><span class="sxs-lookup"><span data-stu-id="30adf-196">As explained for the [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="30adf-197">Objekten ska hållas aktiv att ha möjlighet att skicka rapporten.</span><span class="sxs-lookup"><span data-stu-id="30adf-197">The objects should be kept alive to have a chance to send the report.</span></span>
> 
> 

<span data-ttu-id="30adf-198">Du kan ange `HealthReportSendOptions` när du skickar rapporter via `Partition` och `CodePackageActivationContext` hälsa API: er.</span><span class="sxs-lookup"><span data-stu-id="30adf-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="30adf-199">Om du har kritiska rapporter som måste skickas så snart som möjligt, Använd `HealthReportSendOptions` med Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="30adf-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="30adf-200">Omedelbar rapporter kringgå batching intervallet för interna hälsa-klienten.</span><span class="sxs-lookup"><span data-stu-id="30adf-200">Immediate reports bypass the batching interval of the internal health client.</span></span> <span data-ttu-id="30adf-201">Som tidigare nämnts, Använd den här flaggan med försiktighet; Vi vill dra nytta av klientens hälsa batchbearbetning när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="30adf-201">As mentioned before, use this flag with care; we want to take advantage of the health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="30adf-202">Utforma hälsa reporting</span><span class="sxs-lookup"><span data-stu-id="30adf-202">Design health reporting</span></span>
<span data-ttu-id="30adf-203">Det första steget i skapa hög kvalitet rapporter identifierar de villkor som kan påverka hälsotillståndet för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="30adf-203">The first step in generating high-quality reports is identifying the conditions that can impact the health of the service.</span></span> <span data-ttu-id="30adf-204">Eventuella villkor som kan hjälpa flaggan problem med tjänsten eller klustret när den startar-- eller ännu bättre innan ett problem inträffar--kan potentiellt spara miljarder dollar.</span><span class="sxs-lookup"><span data-stu-id="30adf-204">Any condition that can help flag problems in the service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="30adf-205">Fördelarna innefattar mindre stillestånd, färre nattetid för att undersöka och reparera problem och högre nöjda.</span><span class="sxs-lookup"><span data-stu-id="30adf-205">The benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="30adf-206">När villkoren identifieras behöver watchdog skrivare ta reda på det bästa sättet att övervaka dem för balans mellan kostnader och användbarhet.</span><span class="sxs-lookup"><span data-stu-id="30adf-206">Once the conditions are identified, watchdog writers need to figure out the best way to monitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="30adf-207">Anta till exempel att en tjänst som utför komplexa beräkningar som använder vissa temporära filer på en nätverksresurs.</span><span class="sxs-lookup"><span data-stu-id="30adf-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="30adf-208">En watchdog kan övervaka resurs för att säkerställa att det finns tillräckligt med utrymme.</span><span class="sxs-lookup"><span data-stu-id="30adf-208">A watchdog could monitor the share to ensure that enough space is available.</span></span> <span data-ttu-id="30adf-209">Det kan lyssna efter meddelanden om ändringar av filen eller katalogen.</span><span class="sxs-lookup"><span data-stu-id="30adf-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="30adf-210">Det kan rapportera en varning om ett tröskelvärde för Summa har nåtts och rapportera ett fel om resursen är full.</span><span class="sxs-lookup"><span data-stu-id="30adf-210">It could report a warning if an upfront threshold is reached, and report an error if the share is full.</span></span> <span data-ttu-id="30adf-211">På en varning startade en reparation system Rensa äldre filer på resursen.</span><span class="sxs-lookup"><span data-stu-id="30adf-211">On a warning, a repair system could start cleaning up older files on the share.</span></span> <span data-ttu-id="30adf-212">På ett fel kan ett system för reparation flytta service repliken till en annan nod.</span><span class="sxs-lookup"><span data-stu-id="30adf-212">On an error, a repair system could move the service replica to another node.</span></span> <span data-ttu-id="30adf-213">Observera hur villkoret tillstånd beskrivs vad gäller hälsa: tillståndet för villkoret som kan uppfattas som Felfri (ok) eller ohälsosamt (varning eller fel).</span><span class="sxs-lookup"><span data-stu-id="30adf-213">Note how the condition states are described in terms of health: the state of the condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="30adf-214">Efter att övervaka information har angetts måste ta reda på hur du implementerar watchdog watchdog-skrivaren.</span><span class="sxs-lookup"><span data-stu-id="30adf-214">Once the monitoring details are set, a watchdog writer needs to figure out how to implement the watchdog.</span></span> <span data-ttu-id="30adf-215">Om villkoren kan fastställas från inom tjänsten, kan watchdog ingå i den övervakade tjänsten sig själv.</span><span class="sxs-lookup"><span data-stu-id="30adf-215">If the conditions can be determined from within the service, the watchdog can be part of the monitored service itself.</span></span> <span data-ttu-id="30adf-216">Kod som kan exempelvis kontrollera om resursen och rapportera varje gång den försöker att skriva en fil.</span><span class="sxs-lookup"><span data-stu-id="30adf-216">For example, the service code can check the share usage, and then report every time it tries to write a file.</span></span> <span data-ttu-id="30adf-217">Fördelen med den här metoden är att reporting är enkel.</span><span class="sxs-lookup"><span data-stu-id="30adf-217">The advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="30adf-218">Vara måste försiktig att förhindra att watchdog buggar påverka funktionen för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="30adf-218">Care must be taken to prevent watchdog bugs from impacting the service functionality.</span></span>

<span data-ttu-id="30adf-219">Rapportering inifrån är den övervakade tjänsten inte alltid ett alternativ.</span><span class="sxs-lookup"><span data-stu-id="30adf-219">Reporting from within the monitored service is not always an option.</span></span> <span data-ttu-id="30adf-220">En watchdog inom tjänsten kanske inte kan identifiera villkoren.</span><span class="sxs-lookup"><span data-stu-id="30adf-220">A watchdog within the service may not be able to detect the conditions.</span></span> <span data-ttu-id="30adf-221">Det kan inte ha logik och data att göra en avvägning.</span><span class="sxs-lookup"><span data-stu-id="30adf-221">It may not have the logic or data to make the determination.</span></span> <span data-ttu-id="30adf-222">Arbetet med att övervaka villkor som kan vara hög.</span><span class="sxs-lookup"><span data-stu-id="30adf-222">The overhead of monitoring the conditions may be high.</span></span> <span data-ttu-id="30adf-223">Villkor kan inte heller specifika för en tjänst, men i stället påverkar samverkan mellan tjänster.</span><span class="sxs-lookup"><span data-stu-id="30adf-223">The conditions also may not be specific to a service, but instead affect interactions between services.</span></span> <span data-ttu-id="30adf-224">Ett annat alternativ är att ha watchdogs i klustret som separata processer.</span><span class="sxs-lookup"><span data-stu-id="30adf-224">Another option is to have watchdogs in the cluster as separate processes.</span></span> <span data-ttu-id="30adf-225">Watchdogs övervaka villkor och rapport, utan att påverka tjänster på något sätt.</span><span class="sxs-lookup"><span data-stu-id="30adf-225">The watchdogs monitor the conditions and report, without affecting the main services in any way.</span></span> <span data-ttu-id="30adf-226">Till exempel kan dessa watchdogs implementeras som tillståndslösa tjänster i samma program som distribuerats på alla noder på samma noder som för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="30adf-226">For example, these watchdogs could be implemented as stateless services in the same application, deployed on all nodes or on the same nodes as the service.</span></span>

<span data-ttu-id="30adf-227">Ibland kan är en watchdog som körs i klustret inte ett alternativ antingen.</span><span class="sxs-lookup"><span data-stu-id="30adf-227">Sometimes, a watchdog running in the cluster is not an option either.</span></span> <span data-ttu-id="30adf-228">Om övervakade villkoret är tillgänglighet eller funktion som användarna ser det, är det bäst att watchdogs på samma plats som användaren-klienter.</span><span class="sxs-lookup"><span data-stu-id="30adf-228">If the monitored condition is the availability or functionality of the service as users see it, it's best to have the watchdogs in the same place as the user clients.</span></span> <span data-ttu-id="30adf-229">De kan det, testa åtgärder på samma sätt som användare ringa upp dem.</span><span class="sxs-lookup"><span data-stu-id="30adf-229">There, they can test the operations in the same way users call them.</span></span> <span data-ttu-id="30adf-230">Du kan till exempel ha en watchdog som finns utanför klustret, skickar begäranden till tjänsten och kontrollerar den latens och resultatet är korrekt.</span><span class="sxs-lookup"><span data-stu-id="30adf-230">For example, you can have a watchdog that lives outside the cluster, issues requests to the service, and checks the latency and correctness of the result.</span></span> <span data-ttu-id="30adf-231">(För en Kalkylatorn tjänst, till exempel 2 + 2 returnerar 4 inom en rimlig tid?)</span><span class="sxs-lookup"><span data-stu-id="30adf-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="30adf-232">När informationen watchdog har avslutats, måste du bestämma på en käll-ID som unikt identifierar den.</span><span class="sxs-lookup"><span data-stu-id="30adf-232">Once the watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="30adf-233">Om flera watchdogs av samma typ bor i klustret, måste rapporterar på olika enheter, eller om de rapporterar på samma enhet, ska du använda olika käll-ID eller egenskap.</span><span class="sxs-lookup"><span data-stu-id="30adf-233">If multiple watchdogs of the same type are living in the cluster, they must report on different entities, or, if they report on the same entity, use different source ID or property.</span></span> <span data-ttu-id="30adf-234">Det här sättet sina rapporter kan samexistera.</span><span class="sxs-lookup"><span data-stu-id="30adf-234">This way, their reports can coexist.</span></span> <span data-ttu-id="30adf-235">Egenskapen hälsorapporten ska avbilda övervakade villkoret.</span><span class="sxs-lookup"><span data-stu-id="30adf-235">The property of the health report should capture the monitored condition.</span></span> <span data-ttu-id="30adf-236">(Till exempel ovan egenskapen kunde **ShareSize**.) Om flera rapporter gäller samma villkor, bör egenskapen innehålla vissa dynamisk information som tillåter rapporter kan samexistera.</span><span class="sxs-lookup"><span data-stu-id="30adf-236">(For the example above, the property could be **ShareSize**.) If multiple reports apply to the same condition, the property should contain some dynamic information that allows reports to coexist.</span></span> <span data-ttu-id="30adf-237">Om flera resurser behöver övervakas egenskapsnamnet kan exempelvis **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="30adf-237">For example, if multiple shares need to be monitored, the property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="30adf-238">Gör *inte* använda health store för att hålla statusinformation.</span><span class="sxs-lookup"><span data-stu-id="30adf-238">Do *not* use the health store to keep status information.</span></span> <span data-ttu-id="30adf-239">Hälsorelaterade information ska rapporteras som hälsa, som den här informationen som påverkar hälsotillståndet utvärderingen av en entitet.</span><span class="sxs-lookup"><span data-stu-id="30adf-239">Only health-related information should be reported as health, as this information impacts the health evaluation of an entity.</span></span> <span data-ttu-id="30adf-240">Health store har inte utformats som ett allmänt Arkiv.</span><span class="sxs-lookup"><span data-stu-id="30adf-240">The health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="30adf-241">Logik för utvärdering av hälsotillstånd används för att aggregera alla data till hälsotillståndet.</span><span class="sxs-lookup"><span data-stu-id="30adf-241">It uses health evaluation logic to aggregate all data into the health state.</span></span> <span data-ttu-id="30adf-242">Skicka information som inte är relaterade till hälsa (som rapporterar status med ett hälsotillstånd OK) påverkar inte aggregerade hälsotillståndet, men det kan påverka prestanda för health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-242">Sending information unrelated to health (like reporting status with a health state of OK) doesn't impact the aggregated health state, but it can negatively affect the performance of the health store.</span></span>
> 
> 

<span data-ttu-id="30adf-243">Nästa Beslutspunkt är vilken entitet till rapporten på.</span><span class="sxs-lookup"><span data-stu-id="30adf-243">The next decision point is which entity to report on.</span></span> <span data-ttu-id="30adf-244">De flesta fall villkoret tydligt idetifies entiteten.</span><span class="sxs-lookup"><span data-stu-id="30adf-244">Most of the time, the condition clearly idetifies the entity.</span></span> <span data-ttu-id="30adf-245">Välj entiteten med bästa möjliga granularitet.</span><span class="sxs-lookup"><span data-stu-id="30adf-245">Choose the entity with best possible granularity.</span></span> <span data-ttu-id="30adf-246">Om ett villkor som påverkar alla repliker i en partition, en rapport om partitionen inte på tjänsten.</span><span class="sxs-lookup"><span data-stu-id="30adf-246">If a condition impacts all replicas in a partition, report on the partition, not on the service.</span></span> <span data-ttu-id="30adf-247">Det finns specialfall där flera tankar krävs dock.</span><span class="sxs-lookup"><span data-stu-id="30adf-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="30adf-248">Om villkoret påverkar en entitet, till exempel en replik, men att webbprogrammet är att ha villkoret som flaggats för fler än varaktigheten för replik livslängd och redovisas på partitionen.</span><span class="sxs-lookup"><span data-stu-id="30adf-248">If the condition impacts an entity, such as a replica, but the desire is to have the condition flagged for more than the duration of replica life, then it should be reported on the partition.</span></span> <span data-ttu-id="30adf-249">I annat fall när repliken tas bort rensar health store alla rapporter.</span><span class="sxs-lookup"><span data-stu-id="30adf-249">Otherwise, when the replica is deleted, the health store cleans up all its reports.</span></span> <span data-ttu-id="30adf-250">Watchdog-skrivare måste du tänka livslängd för entiteten och rapporten.</span><span class="sxs-lookup"><span data-stu-id="30adf-250">Watchdog writers must think about the lifetimes of the entity and the report.</span></span> <span data-ttu-id="30adf-251">Det måste vara tydlig när en rapport måste rensas från en butik (till exempel när ett fel rapporteras på en enhet inte längre gäller).</span><span class="sxs-lookup"><span data-stu-id="30adf-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="30adf-252">Nu ska vi titta på ett exempel som sätter ihop punkter I som beskrivs.</span><span class="sxs-lookup"><span data-stu-id="30adf-252">Let's look at an example that puts together the points I described.</span></span> <span data-ttu-id="30adf-253">Överväg ett Service Fabric-program består av en master tillståndskänslig beständig tjänst och sekundära tillståndslösa tjänster som distribueras på alla noder (en sekundär service typ för varje typ av aktivitet).</span><span class="sxs-lookup"><span data-stu-id="30adf-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="30adf-254">Huvudmålservern har en kö för bearbetning som innehåller kommandon för att köras av sekundärservrar.</span><span class="sxs-lookup"><span data-stu-id="30adf-254">The master has a processing queue that contains commands to be executed by secondaries.</span></span> <span data-ttu-id="30adf-255">Sekundära utför inkommande begäranden och skicka tillbaka bekräftelse signaler.</span><span class="sxs-lookup"><span data-stu-id="30adf-255">The secondaries execute the incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="30adf-256">Ett villkor som kan övervakas är längden på köns master bearbetning.</span><span class="sxs-lookup"><span data-stu-id="30adf-256">One condition that could be monitored is the length of the master processing queue.</span></span> <span data-ttu-id="30adf-257">Om master kölängden når ett tröskelvärde, rapporterade en varning.</span><span class="sxs-lookup"><span data-stu-id="30adf-257">If the master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="30adf-258">Varningen anger att sekundära inte kan hantera belastningen.</span><span class="sxs-lookup"><span data-stu-id="30adf-258">The warning indicates that the secondaries can't handle the load.</span></span> <span data-ttu-id="30adf-259">Om kön når maximal längd och kommandon släpps, ett fel rapporteras som tjänsten går inte att återställa.</span><span class="sxs-lookup"><span data-stu-id="30adf-259">If the queue reaches the maximum length and commands are dropped, an error is reported, as the service can't recover.</span></span> <span data-ttu-id="30adf-260">Rapporterna kan vara i egenskapen **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="30adf-260">The reports can be on the property **QueueStatus**.</span></span> <span data-ttu-id="30adf-261">Watchdog finns i tjänsten och det har skickats på master primära repliken.</span><span class="sxs-lookup"><span data-stu-id="30adf-261">The watchdog lives inside the service, and it's sent periodically on the master primary replica.</span></span> <span data-ttu-id="30adf-262">Time to live är två minuter och skickas regelbundet var 30: e sekund.</span><span class="sxs-lookup"><span data-stu-id="30adf-262">The time to live is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="30adf-263">Om den primära servern kraschar, rensas rapporten automatiskt från store.</span><span class="sxs-lookup"><span data-stu-id="30adf-263">If the primary goes down, the report is cleaned up automatically from store.</span></span> <span data-ttu-id="30adf-264">Om tjänsten repliken är in, men det är ett dödläge eller med andra problem, rapporten upphör att gälla i health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-264">If the service replica is up, but it is deadlocked or having other issues, the report expires in the health store.</span></span> <span data-ttu-id="30adf-265">I det här fallet utvärderas entiteten vid fel.</span><span class="sxs-lookup"><span data-stu-id="30adf-265">In this case, the entity is evaluated at error.</span></span>

<span data-ttu-id="30adf-266">Ytterligare villkor som kan övervakas är körningstid för aktiviteten.</span><span class="sxs-lookup"><span data-stu-id="30adf-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="30adf-267">Huvudservern distribuerar uppgifter till sekundärservrar baserat på aktivitetstyp.</span><span class="sxs-lookup"><span data-stu-id="30adf-267">The master distributes tasks to the secondaries based on the task type.</span></span> <span data-ttu-id="30adf-268">Beroende på utformning, kunde huvudservern avsöka sekundärservrar för aktivitetsstatus.</span><span class="sxs-lookup"><span data-stu-id="30adf-268">Depending on the design, the master could poll the secondaries for task status.</span></span> <span data-ttu-id="30adf-269">Det kan också vänta tills sekundärservrar för att skicka tillbaka bekräftelse signaler när de görs.</span><span class="sxs-lookup"><span data-stu-id="30adf-269">It could also wait for secondaries to send back acknowledgement signals when they are done.</span></span> <span data-ttu-id="30adf-270">I det andra fallet måste vara försiktig att identifiera situationer där sekundärservrar die eller meddelanden går förlorade.</span><span class="sxs-lookup"><span data-stu-id="30adf-270">In the second case, care must be taken to detect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="30adf-271">Ett alternativ är att skicka en ping-begäran till samma sekundär som skickar tillbaka dess status.</span><span class="sxs-lookup"><span data-stu-id="30adf-271">One option is for the master to send a ping request to the same secondary, which sends back its status.</span></span> <span data-ttu-id="30adf-272">Om ingen status tas emot huvudservern anser att det är ett fel och schemaläggs aktiviteten automatiskt på nytt.</span><span class="sxs-lookup"><span data-stu-id="30adf-272">If no status is received, the master considers it a failure and reschedules the task.</span></span> <span data-ttu-id="30adf-273">Det här beteendet förutsätts att aktiviteterna idempotent.</span><span class="sxs-lookup"><span data-stu-id="30adf-273">This behavior assumes that the tasks are idempotent.</span></span>

<span data-ttu-id="30adf-274">Övervakade villkoret kan översättas som en varning om aktiviteten inte har gjort i en viss tid (**t1**, till exempel 10 minuter).</span><span class="sxs-lookup"><span data-stu-id="30adf-274">The monitored condition can be translated as a warning if the task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="30adf-275">Om aktiviteten inte slutförs i tid (**t2**, till exempel 20 minuter), övervakade villkoret kan översättas som fel.</span><span class="sxs-lookup"><span data-stu-id="30adf-275">If the task is not completed in time (**t2**, for example 20 minutes), the monitored condition can be translated as Error.</span></span> <span data-ttu-id="30adf-276">Den här reporting kan du göra detta på flera olika sätt:</span><span class="sxs-lookup"><span data-stu-id="30adf-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="30adf-277">Den primära repliken master rapporter om sig själv med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="30adf-277">The master primary replica reports on itself periodically.</span></span> <span data-ttu-id="30adf-278">Du kan ha en egenskap för alla väntande aktiviteter i kön.</span><span class="sxs-lookup"><span data-stu-id="30adf-278">You can have one property for all pending tasks in the queue.</span></span> <span data-ttu-id="30adf-279">Om minst en uppgift tar längre tid, Rapportstatus på egenskapen **PendingTasks** är en varning eller fel efter behov.</span><span class="sxs-lookup"><span data-stu-id="30adf-279">If at least one task takes longer, the report status on the property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="30adf-280">Om det finns inga väntande aktiviteter eller alla aktiviteter startade körningen kan är rapportera status OK.</span><span class="sxs-lookup"><span data-stu-id="30adf-280">If there are no pending tasks or all tasks started execution, the report status is OK.</span></span> <span data-ttu-id="30adf-281">Uppgifter som är permanent.</span><span class="sxs-lookup"><span data-stu-id="30adf-281">The tasks are persistent.</span></span> <span data-ttu-id="30adf-282">Om den primära servern kraschar, kan den nyligen uppgraderat primärt fortsätta att rapportera korrekt.</span><span class="sxs-lookup"><span data-stu-id="30adf-282">If the primary goes down, the newly promoted primary can continue to report properly.</span></span>
* <span data-ttu-id="30adf-283">En annan watchdog processen (i molnet eller externa) kontrollerar aktiviteter (från utanför, baserat på resultatet aktiviteten) att se om de är slutförda.</span><span class="sxs-lookup"><span data-stu-id="30adf-283">Another watchdog process (in the cloud or external) checks the tasks (from outside, based on the desired task result) to see if they are completed.</span></span> <span data-ttu-id="30adf-284">Om de inte tar hänsyn till tröskelvärdena, skickas en rapport på tjänsten master.</span><span class="sxs-lookup"><span data-stu-id="30adf-284">If they do not respect the thresholds, a report is sent on the master service.</span></span> <span data-ttu-id="30adf-285">En rapport som också skickas med varje aktivitet som innehåller aktivitets-ID som **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="30adf-285">A report is also sent on each task that includes the task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="30adf-286">Rapporter ska skickas endast ohälsosamt tillstånd.</span><span class="sxs-lookup"><span data-stu-id="30adf-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="30adf-287">Ange tid att live några minuter och markera rapporterna som ska tas bort när de upphör att rensa.</span><span class="sxs-lookup"><span data-stu-id="30adf-287">Set time to live to a few minutes, and mark the reports to be removed when they expire to ensure cleanup.</span></span>
* <span data-ttu-id="30adf-288">Den sekundära som kör en uppgift rapporterar när det tar längre tid än väntat att köra den.</span><span class="sxs-lookup"><span data-stu-id="30adf-288">The secondary that is executing a task reports when it takes longer than expected to run it.</span></span> <span data-ttu-id="30adf-289">Rapporterar på tjänstinstansen i egenskapen **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="30adf-289">It reports on the service instance on the property **PendingTasks**.</span></span> <span data-ttu-id="30adf-290">Rapporten lokaliserar service-instans som har problem, men det fånga inte situation där instansen dör.</span><span class="sxs-lookup"><span data-stu-id="30adf-290">The report pinpoints the service instance that has issues, but it doesn't capture the situation where the instance dies.</span></span> <span data-ttu-id="30adf-291">Rapporterna rensas sedan.</span><span class="sxs-lookup"><span data-stu-id="30adf-291">The reports are cleaned up then.</span></span> <span data-ttu-id="30adf-292">Det kan rapportera om tjänsten secondary.</span><span class="sxs-lookup"><span data-stu-id="30adf-292">It could report on the secondary service.</span></span> <span data-ttu-id="30adf-293">Om sekundärt Slutför uppgiften rensar den sekundära instansen rapporten från store.</span><span class="sxs-lookup"><span data-stu-id="30adf-293">If the secondary completes the task, the secondary instance clears the report from the store.</span></span> <span data-ttu-id="30adf-294">Rapporten fånga inte situation där bekräftelsemeddelandet går förlorad och aktiviteten är inte klar ur den master.</span><span class="sxs-lookup"><span data-stu-id="30adf-294">The report doesn't capture the situation where the acknowledgement message is lost and the task is not finished from the master's point of view.</span></span>

<span data-ttu-id="30adf-295">Men reporting görs i de fall som beskrivs ovan, fångas rapporterna i programmets hälsotillstånd när hälsa utvärderas.</span><span class="sxs-lookup"><span data-stu-id="30adf-295">However the reporting is done in the cases described above, the reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="30adf-296">Rapport med jämna mellanrum kontra om övergång</span><span class="sxs-lookup"><span data-stu-id="30adf-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="30adf-297">Med hjälp av hälsotillstånd rapportmodellen skicka watchdogs rapporter med jämna mellanrum eller övergångar.</span><span class="sxs-lookup"><span data-stu-id="30adf-297">By using the health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="30adf-298">Det rekommenderade sättet för rapportering av watchdog är med jämna mellanrum, eftersom koden är mycket enklare och mindre känslig för fel.</span><span class="sxs-lookup"><span data-stu-id="30adf-298">The recommended way for watchdog reporting is periodically, because the code is much simpler and less prone to errors.</span></span> <span data-ttu-id="30adf-299">Watchdogs måste strävar efter att vara så enkelt som möjligt för att undvika buggar som utlöser felaktiga rapporter.</span><span class="sxs-lookup"><span data-stu-id="30adf-299">The watchdogs must strive to be as simple as possible to avoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="30adf-300">Felaktig *ohälsosamt* rapporter påverka hälsa utvärderingar och scenarier baserat på hälsa, inklusive uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="30adf-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="30adf-301">Felaktig *felfri* rapporter dölja problem i klustret, som inte används.</span><span class="sxs-lookup"><span data-stu-id="30adf-301">Incorrect *healthy* reports hide issues in the cluster, which is not desired.</span></span>

<span data-ttu-id="30adf-302">För periodiska rapportering, kan watchdog implementeras med en timer.</span><span class="sxs-lookup"><span data-stu-id="30adf-302">For periodic reporting, the watchdog can be implemented with a timer.</span></span> <span data-ttu-id="30adf-303">På en timer-återanrop i watchdog Kontrollera tillståndet och skicka en rapport baserad på det aktuella tillståndet.</span><span class="sxs-lookup"><span data-stu-id="30adf-303">On a timer callback, the watchdog can check the state and send a report based on the current state.</span></span> <span data-ttu-id="30adf-304">Det finns inget behov av att se vilka som skickats tidigare eller se alla optimeringar vad gäller meddelanden.</span><span class="sxs-lookup"><span data-stu-id="30adf-304">There is no need to see which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="30adf-305">Klienten hälsotillstånd har batchbearbetning logik för bättre prestanda.</span><span class="sxs-lookup"><span data-stu-id="30adf-305">The health client has batching logic to help with performance.</span></span> <span data-ttu-id="30adf-306">När klienten hälsa hålls alive, försöker den internt tills rapporten bekräftas av health store eller watchdog genererar en nyare rapport med samma entitet, egenskap och källa.</span><span class="sxs-lookup"><span data-stu-id="30adf-306">While the health client is kept alive, it retries internally until the report is acknowledged by the health store or the watchdog generates a newer report with the same entity, property, and source.</span></span>

<span data-ttu-id="30adf-307">Rapportering i övergångar krävs noggrann hantering av tillstånd.</span><span class="sxs-lookup"><span data-stu-id="30adf-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="30adf-308">Watchdog övervakar vissa villkor och rapporterar endast när villkor som ändrar.</span><span class="sxs-lookup"><span data-stu-id="30adf-308">The watchdog monitors some conditions and reports only when the conditions change.</span></span> <span data-ttu-id="30adf-309">Upp-och med den här metoden är att färre rapporter behövs.</span><span class="sxs-lookup"><span data-stu-id="30adf-309">The upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="30adf-310">Nackdelen är att logiken i watchdog komplexa.</span><span class="sxs-lookup"><span data-stu-id="30adf-310">The downside is that the logic of the watchdog is complex.</span></span> <span data-ttu-id="30adf-311">Watchdog måste upprätthålla villkoren eller rapporter, så att de kan kontrolleras för att avgöra tillstånd ändras.</span><span class="sxs-lookup"><span data-stu-id="30adf-311">The watchdog must maintain the conditions or the reports, so that they can be inspected to determine state changes.</span></span> <span data-ttu-id="30adf-312">På redundanskluster, måste vara försiktig med rapporter som har lagts till, men ännu inte skickats till health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-312">On failover, care must be taken with reports added, but not yet sent to the health store.</span></span> <span data-ttu-id="30adf-313">Sekvensnumret måste vara allt större.</span><span class="sxs-lookup"><span data-stu-id="30adf-313">The sequence number must be ever-increasing.</span></span> <span data-ttu-id="30adf-314">Om inte, avvisas rapporterna som föråldrade.</span><span class="sxs-lookup"><span data-stu-id="30adf-314">If not, the reports are rejected as stale.</span></span> <span data-ttu-id="30adf-315">I sällsynta fall där dataförlust uppstår kan synkronisering behövas mellan tillståndet för rapport och tillståndet för health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-315">In the rare cases where data loss is incurred, synchronization may be needed between the state of the reporter and the state of the health store.</span></span>

<span data-ttu-id="30adf-316">Rapportering av övergångar passar för tjänster som rapporterar på själva via `Partition` eller `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="30adf-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="30adf-317">När det lokala objektet (replikerings- eller distribuerat tjänstpaket / distribuerat program) är bort alla rapporter tas också bort.</span><span class="sxs-lookup"><span data-stu-id="30adf-317">When the local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="30adf-318">Den här automatisk rensning sänker behovet av att synkroniseringen mellan rapport och health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-318">This automatic cleanup relaxes the need for synchronization between reporter and health store.</span></span> <span data-ttu-id="30adf-319">Om rapporten avser överordnade partitionen eller det överordnade programmet, måste vara försiktig vid redundans att undvika inaktuella rapporter i health store.</span><span class="sxs-lookup"><span data-stu-id="30adf-319">If the report is for parent partition or parent application, care must be taken on failover to avoid stale reports in the health store.</span></span> <span data-ttu-id="30adf-320">Logik måste läggas till upprätthålla rätt tillstånd och ta bort rapporten från lagring när det inte behövs längre.</span><span class="sxs-lookup"><span data-stu-id="30adf-320">Logic must be added to maintain the correct state and clear the report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="30adf-321">Implementera hälsa reporting</span><span class="sxs-lookup"><span data-stu-id="30adf-321">Implement health reporting</span></span>
<span data-ttu-id="30adf-322">När entiteten och rapportera information är klar kan skickar hälsorapporter göras via API: et, PowerShell eller REST.</span><span class="sxs-lookup"><span data-stu-id="30adf-322">Once the entity and report details are clear, sending health reports can be done through the API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="30adf-323">API</span><span class="sxs-lookup"><span data-stu-id="30adf-323">API</span></span>
<span data-ttu-id="30adf-324">Om du vill rapportera via API, måste du skapa en hälsorapport specifika för entitetstypen som de vill rapportera om.</span><span class="sxs-lookup"><span data-stu-id="30adf-324">To report through the API, you need to create a health report specific to the entity type they want to report on.</span></span> <span data-ttu-id="30adf-325">Ge rapporten till en klient för hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="30adf-325">Give the report to a health client.</span></span> <span data-ttu-id="30adf-326">Du kan också skapa en hälsoinformation och skickar den för att åtgärda rapporteringsmetoder på `Partition` eller `CodePackageActivationContext` att rapportera om aktuella entiteter.</span><span class="sxs-lookup"><span data-stu-id="30adf-326">Alternatively, create a health information and pass it to correct reporting methods on `Partition` or `CodePackageActivationContext` to report on current entities.</span></span>

<span data-ttu-id="30adf-327">I följande exempel visas periodiska reporting från en watchdog i klustret.</span><span class="sxs-lookup"><span data-stu-id="30adf-327">The following example shows periodic reporting from a watchdog within the cluster.</span></span> <span data-ttu-id="30adf-328">Watchdog kontrollerar om en extern resurs kan nås inifrån en nod.</span><span class="sxs-lookup"><span data-stu-id="30adf-328">The watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="30adf-329">Resursen som krävs av en tjänstmanifestet i programmet.</span><span class="sxs-lookup"><span data-stu-id="30adf-329">The resource is needed by a service manifest within the application.</span></span> <span data-ttu-id="30adf-330">Om resursen är tillgänglig, kan andra tjänster i programmet fortfarande att fungera korrekt.</span><span class="sxs-lookup"><span data-stu-id="30adf-330">If the resource is unavailable, the other services within the application can still function properly.</span></span> <span data-ttu-id="30adf-331">Därför skickas rapporten på den distribuerade tjänst paketet entiteten med 30 sekunders mellanrum.</span><span class="sxs-lookup"><span data-stu-id="30adf-331">Therefore, the report is sent on the deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether the resource can be accessed from the node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as the connectivity is needed by the specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, the report is already queued on the health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until the report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="30adf-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="30adf-332">PowerShell</span></span>
<span data-ttu-id="30adf-333">Skicka hälsorapporter med  **skicka ServiceFabric*EntityType*HealthReport **.</span><span class="sxs-lookup"><span data-stu-id="30adf-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="30adf-334">I följande exempel visas periodiska rapportering om CPU-värden på en nod.</span><span class="sxs-lookup"><span data-stu-id="30adf-334">The following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="30adf-335">Rapporterna ska skickas med 30 sekunders mellanrum, och de har en livstiden på två minuter.</span><span class="sxs-lookup"><span data-stu-id="30adf-335">The reports should be sent every 30 seconds, and they have a time to live of two minutes.</span></span> <span data-ttu-id="30adf-336">Om de upphör att gälla har personen problem, så noden som ska utvärderas vid fel.</span><span class="sxs-lookup"><span data-stu-id="30adf-336">If they expire, the reporter has issues, so the node is evaluated at error.</span></span> <span data-ttu-id="30adf-337">När Processorn överskrider ett tröskelvärde har rapporten ett hälsotillstånd varning.</span><span class="sxs-lookup"><span data-stu-id="30adf-337">When the CPU is above a threshold, the report has a health state of warning.</span></span> <span data-ttu-id="30adf-338">När Processorn överskrider ett tröskelvärde för mer än den konfigurerade tidpunkten, rapporteras den som ett fel.</span><span class="sxs-lookup"><span data-stu-id="30adf-338">When the CPU remains above a threshold for more than the configured time, it's reported as an error.</span></span> <span data-ttu-id="30adf-339">Annars skickar personen ett hälsotillstånd OK.</span><span class="sxs-lookup"><span data-stu-id="30adf-339">Otherwise, the reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="30adf-340">I följande exempel rapporterar en varning om tillfälligt på en replik.</span><span class="sxs-lookup"><span data-stu-id="30adf-340">The following example reports a transient warning on a replica.</span></span> <span data-ttu-id="30adf-341">Först hämtar partitions-ID och replik-ID för tjänsten som den är intresserad av.</span><span class="sxs-lookup"><span data-stu-id="30adf-341">It first gets the partition ID and then the replica ID for the service it is interested in.</span></span> <span data-ttu-id="30adf-342">Skickar sedan en rapport från **PowershellWatcher** i egenskapen **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="30adf-342">It then sends a report from **PowershellWatcher** on the property **ResourceDependency**.</span></span> <span data-ttu-id="30adf-343">Rapporten är av intresse för bara två minuter och det bort automatiskt från arkivet.</span><span class="sxs-lookup"><span data-stu-id="30adf-343">The report is of interest for only two minutes, and it is removed from the store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "The external resource that the primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : The external resource that the primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="30adf-344">REST</span><span class="sxs-lookup"><span data-stu-id="30adf-344">REST</span></span>
<span data-ttu-id="30adf-345">Skicka hälsorapporter med POST-förfrågningar som går du till entitet och har i själva hälsa Rapportbeskrivning REST.</span><span class="sxs-lookup"><span data-stu-id="30adf-345">Send health reports using REST with POST requests that go to the desired entity and have in the body the health report description.</span></span> <span data-ttu-id="30adf-346">Till exempel visas hur du skickar REST [kluster hälsorapporter](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) eller [tjänsten hälsorapporter](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="30adf-346">For example, see how to send REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="30adf-347">Alla enheter som stöds.</span><span class="sxs-lookup"><span data-stu-id="30adf-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="30adf-348">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="30adf-348">Next steps</span></span>
<span data-ttu-id="30adf-349">Baserat på data i hälsa, kan service-skrivare och kluster/application-administratörer Se sätt att använda informationen.</span><span class="sxs-lookup"><span data-stu-id="30adf-349">Based on the health data, service writers and cluster/application administrators can think of ways to consume the information.</span></span> <span data-ttu-id="30adf-350">De kan till exempel konfigurera aviseringar baserat på hälsostatus för att fånga allvarliga problem innan de leda till avbrott.</span><span class="sxs-lookup"><span data-stu-id="30adf-350">For example, they can set up alerts based on health status to catch severe issues before they provoke outages.</span></span> <span data-ttu-id="30adf-351">Administratörer kan också ställa in reparera system för att åtgärda problem automatiskt.</span><span class="sxs-lookup"><span data-stu-id="30adf-351">Administrators can also set up repair systems to fix issues automatically.</span></span>

[<span data-ttu-id="30adf-352">Introduktion till Service Fabric hälsa övervakning</span><span class="sxs-lookup"><span data-stu-id="30adf-352">Introduction to Service Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="30adf-353">Visa Service Fabric-hälsorapporter</span><span class="sxs-lookup"><span data-stu-id="30adf-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="30adf-354">Hur du rapporten och kontrollera tjänstens hälsa</span><span class="sxs-lookup"><span data-stu-id="30adf-354">How to report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="30adf-355">Använda systemet hälsorapporter för felsökning</span><span class="sxs-lookup"><span data-stu-id="30adf-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="30adf-356">Övervaka och diagnostisera tjänster lokalt</span><span class="sxs-lookup"><span data-stu-id="30adf-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="30adf-357">Uppgradering av Service Fabric-programmet</span><span class="sxs-lookup"><span data-stu-id="30adf-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

