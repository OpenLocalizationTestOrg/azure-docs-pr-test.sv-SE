---
title: "aaaAdd anpassad Service Fabric-hälsorapporter | Microsoft Docs"
description: "Beskriver hur toosend anpassade hälsorapporter tooAzure Service Fabric hälsa entiteter. Ger rekommendationer för att utforma och implementera kvalitet hälsorapporter."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="183b2-104">Lägga till anpassade hälsorapporter i Service Fabric</span><span class="sxs-lookup"><span data-stu-id="183b2-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="183b2-105">Azure Service Fabric introducerar en [hälsomodell](service-fabric-health-introduction.md) utformad tooflag ohälsosamt kluster och villkoren för programmet på specifika enheter.</span><span class="sxs-lookup"><span data-stu-id="183b2-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="183b2-106">Hej hälsomodell använder **hälsa rapportörer** (systemkomponenter och watchdogs).</span><span class="sxs-lookup"><span data-stu-id="183b2-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="183b2-107">hello målet är enkelt och snabbt diagnos och reparation.</span><span class="sxs-lookup"><span data-stu-id="183b2-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="183b2-108">Service-skrivare måste toothink förskott om hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="183b2-109">Eventuella villkor som kan påverka hälsa redovisas, särskilt om kan hjälpa flaggan problem Stäng toohello rot.</span><span class="sxs-lookup"><span data-stu-id="183b2-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="183b2-110">hello hälsoinformation kan spara tid och pengar på felsökning och undersökning.</span><span class="sxs-lookup"><span data-stu-id="183b2-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="183b2-111">hello användbarhet är särskilt tydligt när hello-tjänsten är igång och körs i skala i hello molnet (privat eller Azure).</span><span class="sxs-lookup"><span data-stu-id="183b2-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="183b2-112">hello Service Fabric-rapportörer Övervakare identifiera villkor av intresse.</span><span class="sxs-lookup"><span data-stu-id="183b2-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="183b2-113">De rapport om dessa villkor baserat på deras lokala vyn.</span><span class="sxs-lookup"><span data-stu-id="183b2-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="183b2-114">Hej [hälsoarkivet](service-fabric-health-introduction.md#health-store) aggregerar hälsa data som skickas av alla rapportörer toodetermine om enheter är globalt felfria.</span><span class="sxs-lookup"><span data-stu-id="183b2-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="183b2-115">hello modellen är avsedda toobe omfattande, flexibel och enkel toouse.</span><span class="sxs-lookup"><span data-stu-id="183b2-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="183b2-116">hello kvaliteten på hello hälsorapporter anger hello riktighet hello hälsotillståndsvy hello-klustret.</span><span class="sxs-lookup"><span data-stu-id="183b2-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="183b2-117">Falska positiva identifieringar som visar felaktigt ohälsosamt problem kan påverka uppgraderingar och andra tjänster som använder hälsa data.</span><span class="sxs-lookup"><span data-stu-id="183b2-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="183b2-118">Exempel på sådana tjänster är reparation och mekanismer för aviseringar.</span><span class="sxs-lookup"><span data-stu-id="183b2-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="183b2-119">Därför tänka är nödvändiga tooprovide rapporter som samlar in villkor för intresse för hello bästa möjliga sättet.</span><span class="sxs-lookup"><span data-stu-id="183b2-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="183b2-120">toodesign och implementera hälsa reporting watchdogs komponenterna, och system måste:</span><span class="sxs-lookup"><span data-stu-id="183b2-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="183b2-121">Definiera villkor för hello intressanta, hello sättet som den är övervakad och hello inverkan på hello klustret eller programmet funktioner.</span><span class="sxs-lookup"><span data-stu-id="183b2-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="183b2-122">Baserat på den här informationen kan besluta om hello rapporten egenskapen och hälsa hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="183b2-123">Fastställa hello [entiteten](service-fabric-health-introduction.md#health-entities-and-hierarchy) hello rapporten avser.</span><span class="sxs-lookup"><span data-stu-id="183b2-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="183b2-124">Avgöra var reporting hello utförs, inifrån hello tjänsten eller från en intern eller extern watchdog.</span><span class="sxs-lookup"><span data-stu-id="183b2-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="183b2-125">Definiera en datakälla som används för tooidentify hello-rapport.</span><span class="sxs-lookup"><span data-stu-id="183b2-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="183b2-126">Välj en reporting strategi regelbundet eller på övergångar.</span><span class="sxs-lookup"><span data-stu-id="183b2-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="183b2-127">hello rekommenderat sätt är med jämna mellanrum, eftersom det kräver att enklare koden och är mindre risk tooerrors.</span><span class="sxs-lookup"><span data-stu-id="183b2-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="183b2-128">Avgör hur lång hello-rapport för ohälsosamt villkor ska vara i hello health store och hur det ska vara avmarkerade.</span><span class="sxs-lookup"><span data-stu-id="183b2-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="183b2-129">Med den här informationen kan bestämma hello rapporten tid toolive och ta bort på förfallodatum beteende.</span><span class="sxs-lookup"><span data-stu-id="183b2-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="183b2-130">Som tidigare nämnts kan kan reporting göras från:</span><span class="sxs-lookup"><span data-stu-id="183b2-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="183b2-131">hello övervakade replik för Service Fabric-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="183b2-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="183b2-132">Internt watchdogs distribueras som en Service Fabric-tjänsten till exempel ett Service Fabric tillståndslös som övervakar villkor och skickar rapporter.</span><span class="sxs-lookup"><span data-stu-id="183b2-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="183b2-133">Hej watchdogs kan vara distribueras ett alla noder eller kan vara tillhör toohello övervakas tjänst.</span><span class="sxs-lookup"><span data-stu-id="183b2-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="183b2-134">Internt watchdogs som körs på hello Service Fabric-noder, men som *inte* implementeras som Service Fabric-tjänster.</span><span class="sxs-lookup"><span data-stu-id="183b2-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="183b2-135">Externa watchdogs avsökningen hello resursen från *utanför* hello Service Fabric-klustret (till exempel övervakningstjänsten som Gomez).</span><span class="sxs-lookup"><span data-stu-id="183b2-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="183b2-136">Out of box hello fylls hello kluster med hälsorapporter som skickas av hello systemkomponenter.</span><span class="sxs-lookup"><span data-stu-id="183b2-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="183b2-137">Läs mer på [med systemhälsa rapporter för felsökning](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="183b2-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="183b2-138">hello Användarrapporter måste skickas [hälsa entiteter](service-fabric-health-introduction.md#health-entities-and-hierarchy) som redan har skapats av hello system.</span><span class="sxs-lookup"><span data-stu-id="183b2-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="183b2-139">En gång hello hälsa reporting design är avmarkerad, hälsorapporter kan skickas enkelt.</span><span class="sxs-lookup"><span data-stu-id="183b2-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="183b2-140">Du kan använda [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport hälsa om hello klustret inte [säker](service-fabric-cluster-security.md) eller om hello fabric-klienten har administratörsrättigheter.</span><span class="sxs-lookup"><span data-stu-id="183b2-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="183b2-141">Reporting kan göras via hello API med hjälp av [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), via PowerShell eller via REST.</span><span class="sxs-lookup"><span data-stu-id="183b2-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="183b2-142">Konfigurationen rattar batch-rapporter för bättre prestanda.</span><span class="sxs-lookup"><span data-stu-id="183b2-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="183b2-143">Rapporten hälsa är synkron och representerar endast hello validering arbete på hello på klientsidan.</span><span class="sxs-lookup"><span data-stu-id="183b2-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="183b2-144">hello att hello rapporten accepteras av hello hälsa klient eller hello `Partition` eller `CodePackageActivationContext` objekt innebär inte att tillämpas i hello store.</span><span class="sxs-lookup"><span data-stu-id="183b2-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="183b2-145">Skickas asynkront och eventuellt batchar med andra rapporter.</span><span class="sxs-lookup"><span data-stu-id="183b2-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="183b2-146">hello bearbetning på servern hello misslyckas fortfarande: hello sekvensnummer kan vara inaktuella, hello entiteten på vilka hello rapporten måste tillämpas har tagits bort, osv.</span><span class="sxs-lookup"><span data-stu-id="183b2-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="183b2-147">Hälsotillstånd klienten</span><span class="sxs-lookup"><span data-stu-id="183b2-147">Health client</span></span>
<span data-ttu-id="183b2-148">hello hälsorapporter skickas toohello health store via en hälsa-klient finns i hello fabric-klienten.</span><span class="sxs-lookup"><span data-stu-id="183b2-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="183b2-149">hello hälsa klient kan konfigureras med hello följande inställningar:</span><span class="sxs-lookup"><span data-stu-id="183b2-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="183b2-150">**HealthReportSendInterval**: hello fördröjning mellan hello tid hello rapporten är tillagda toohello klienten hello tid och det skickas toohello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="183b2-151">Använda toobatch rapporter i ett enda meddelande, i stället för att skicka ett meddelande för varje rapport.</span><span class="sxs-lookup"><span data-stu-id="183b2-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="183b2-152">hello batchbearbetning förbättrar prestanda.</span><span class="sxs-lookup"><span data-stu-id="183b2-152">hello batching improves performance.</span></span> <span data-ttu-id="183b2-153">Standard: 30 sekunder.</span><span class="sxs-lookup"><span data-stu-id="183b2-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="183b2-154">**HealthReportRetrySendInterval**: hello intervall på vilka hello hälsa klienten skickar ackumulerade hälsa rapporterar toohello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="183b2-155">Standard: 30 sekunder.</span><span class="sxs-lookup"><span data-stu-id="183b2-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="183b2-156">**HealthOperationTimeout**: hello tidsgränsen för ett rapportmeddelande skickas toohello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="183b2-157">Om ett meddelande på grund av timeout, klientens hello hälsa den tills hello hälsoarkivet bekräftar att hello rapporten har bearbetats.</span><span class="sxs-lookup"><span data-stu-id="183b2-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="183b2-158">Standard: två minuter.</span><span class="sxs-lookup"><span data-stu-id="183b2-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="183b2-159">När hello rapporter grupperas hello fabric-klienten måste hållas aktiva för minst hello HealthReportSendInterval tooensure som de skickas.</span><span class="sxs-lookup"><span data-stu-id="183b2-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="183b2-160">Om hello-meddelande försvinner eller hello health store kan inte använda dem på grund av fel tootransient hello fabric-klienten måste hållas alive längre toogive den en chansen tooretry.</span><span class="sxs-lookup"><span data-stu-id="183b2-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="183b2-161">hello buffring på hello klient tar hello unika hello rapporter i beräkningen.</span><span class="sxs-lookup"><span data-stu-id="183b2-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="183b2-162">Till exempel om en viss felaktiga rapport rapporterar 100 rapporter per sekund på hello samma egenskap för hello hello rapporter har ersatts med den senaste versionen av hello samma entitet.</span><span class="sxs-lookup"><span data-stu-id="183b2-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="183b2-163">Högst en sådan rapport finns i kön för hello-klienten.</span><span class="sxs-lookup"><span data-stu-id="183b2-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="183b2-164">Om batchbearbetning konfigureras, skickas hello antal rapporter toohello health store är bara en per skicka intervall.</span><span class="sxs-lookup"><span data-stu-id="183b2-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="183b2-165">Den här rapporten är hello senaste tillagda rapporten som visar hello hello entitet mest aktuella tillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="183b2-166">Ange konfigurationsparametrar när `FabricClient` har skapats genom att skicka [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) med hello önskade värden hälsa-relaterade poster.</span><span class="sxs-lookup"><span data-stu-id="183b2-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="183b2-167">hello följande exempel skapas en fabric-klienten och anger hello rapporter ska skickas när de har lagts till.</span><span class="sxs-lookup"><span data-stu-id="183b2-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="183b2-168">På timeout och fel som kan göras inträffa försök varje 40 sekunder.</span><span class="sxs-lookup"><span data-stu-id="183b2-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="183b2-169">Rekommenderar vi att hello standard fabric klientinställningar som angetts `HealthReportSendInterval` too30 sekunder.</span><span class="sxs-lookup"><span data-stu-id="183b2-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="183b2-170">Den här inställningen garanterar optimala prestanda på grund av toobatching.</span><span class="sxs-lookup"><span data-stu-id="183b2-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="183b2-171">Kritiska rapporter som måste skickas så snart som möjligt, använda `HealthReportSendOptions` med Immediate `true` i [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span><span class="sxs-lookup"><span data-stu-id="183b2-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="183b2-172">Omedelbar rapporter kringgå hello batchbearbetning intervall.</span><span class="sxs-lookup"><span data-stu-id="183b2-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="183b2-173">Använd den här flaggan med försiktighet; Vi vill tootake nytta av hello hälsa klienten batchbearbetning när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="183b2-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="183b2-174">Omedelbar skicka är också praktisk när du stänger hello fabric-klienten (till exempel hello processen har fastställt ogiltigt tillstånd och behöver tooshut ned tooprevent sidoeffekter).</span><span class="sxs-lookup"><span data-stu-id="183b2-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="183b2-175">Det garanterar en bästa skicka hello ackumulerade rapporter.</span><span class="sxs-lookup"><span data-stu-id="183b2-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="183b2-176">När en rapport läggs med omedelbar flaggan batchar hello hälsa klienten alla hello ackumulerade rapporter sedan senaste överföringen.</span><span class="sxs-lookup"><span data-stu-id="183b2-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="183b2-177">Samma parametrar kan anges när en anslutning tooa klustret har skapats med hjälp av PowerShell.</span><span class="sxs-lookup"><span data-stu-id="183b2-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="183b2-178">hello följande exempel startas en anslutning tooa lokala klustret:</span><span class="sxs-lookup"><span data-stu-id="183b2-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="183b2-179">På liknande sätt tooAPI, rapporter kan skickas med `-Immediate` växla toobe skickas direkt, oavsett hello `HealthReportSendInterval` värde.</span><span class="sxs-lookup"><span data-stu-id="183b2-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="183b2-180">För övriga skickas hello rapporterna toohello Service Fabric-gateway som har en intern fabric-klienten.</span><span class="sxs-lookup"><span data-stu-id="183b2-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="183b2-181">Den här klienten är som standard konfigurerade toosend rapporter batchar med 30 sekunders mellanrum.</span><span class="sxs-lookup"><span data-stu-id="183b2-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="183b2-182">Du kan ändra hello batch intervall med hello klustret Konfigurationsinställningen `HttpGatewayHealthReportSendInterval` på `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="183b2-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="183b2-183">Som tidigare nämnts kan ett bättre alternativ är toosend hello rapporter med `Immediate` SANT.</span><span class="sxs-lookup"><span data-stu-id="183b2-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="183b2-184">tooensure som obehörig services kan inte rapportera hälsa mot hello entiteter i hello kluster, konfigurera hello server tooaccept begäranden endast från skyddade klienter.</span><span class="sxs-lookup"><span data-stu-id="183b2-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="183b2-185">Hej `FabricClient` används för rapportering måste ha Säkerhetsaktiverade toobe kan toocommunicate med hello-kluster (till exempel med Kerberos eller certifikat-autentisering).</span><span class="sxs-lookup"><span data-stu-id="183b2-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="183b2-186">Läs mer om [kluster säkerhet](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="183b2-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="183b2-187">Rapport från i låg behörighet services</span><span class="sxs-lookup"><span data-stu-id="183b2-187">Report from within low privilege services</span></span>
<span data-ttu-id="183b2-188">Om Service Fabric-tjänster inte har admin åtkomst toohello kluster, kan du rapportera hälsa på entiteter från hello aktuell kontext via `Partition` eller `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="183b2-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="183b2-189">För tillståndslösa tjänster använder [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport på hello aktuella tjänstinstansen.</span><span class="sxs-lookup"><span data-stu-id="183b2-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="183b2-190">Tillståndskänsliga tjänster använder [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport på aktuella repliken.</span><span class="sxs-lookup"><span data-stu-id="183b2-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="183b2-191">Använd [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport på hello aktuell partition entitet.</span><span class="sxs-lookup"><span data-stu-id="183b2-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="183b2-192">Använd [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport på aktuella programmet.</span><span class="sxs-lookup"><span data-stu-id="183b2-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="183b2-193">Använd [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport på hello aktuella program som distribuerats på hello aktuella noden.</span><span class="sxs-lookup"><span data-stu-id="183b2-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="183b2-194">Använd [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport på inget tjänstepaket för hello-program som distribuerats på hello aktuella noden.</span><span class="sxs-lookup"><span data-stu-id="183b2-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="183b2-195">Internt hello `Partition` och hello `CodePackageActivationContext` håller en hälsa-klient som konfigurerats med standardinställningar.</span><span class="sxs-lookup"><span data-stu-id="183b2-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="183b2-196">Enligt beskrivningen för hello [hälsa klienten](service-fabric-report-health.md#health-client), rapporter batchbearbetas och skickas på en timer.</span><span class="sxs-lookup"><span data-stu-id="183b2-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="183b2-197">hello-objekt ska vara kvar alive toohave en chans toosend hello-rapport.</span><span class="sxs-lookup"><span data-stu-id="183b2-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="183b2-198">Du kan ange `HealthReportSendOptions` när du skickar rapporter via `Partition` och `CodePackageActivationContext` hälsa API: er.</span><span class="sxs-lookup"><span data-stu-id="183b2-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="183b2-199">Om du har kritiska rapporter som måste skickas så snart som möjligt, Använd `HealthReportSendOptions` med Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="183b2-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="183b2-200">Omedelbar rapporter kringgå hello batchbearbetning intervall på hello interna hälsa klienten.</span><span class="sxs-lookup"><span data-stu-id="183b2-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="183b2-201">Som tidigare nämnts, Använd den här flaggan med försiktighet; Vi vill tootake nytta av hello hälsa klienten batchbearbetning när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="183b2-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="183b2-202">Utforma hälsa reporting</span><span class="sxs-lookup"><span data-stu-id="183b2-202">Design health reporting</span></span>
<span data-ttu-id="183b2-203">hello identifierar första steget i att generera rapporter för hög kvalitet hello villkor som kan påverka hello hälsotillståndet för hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="183b2-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="183b2-204">Eventuella villkor som kan hjälpa flaggan problem i hello tjänst eller ett kluster när den startar-- eller ännu bättre innan ett problem inträffar--kan potentiellt spara miljarder dollar.</span><span class="sxs-lookup"><span data-stu-id="183b2-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="183b2-205">hello fördelar mindre stillestånd, färre nattetid för att undersöka och reparera problem och högre nöjda.</span><span class="sxs-lookup"><span data-stu-id="183b2-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="183b2-206">När hello villkor har identifierats, måste watchdog skrivare toofigure ut hello bästa sätt toomonitor dem för balans mellan kostnader och användbarhet.</span><span class="sxs-lookup"><span data-stu-id="183b2-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="183b2-207">Anta till exempel att en tjänst som utför komplexa beräkningar som använder vissa temporära filer på en nätverksresurs.</span><span class="sxs-lookup"><span data-stu-id="183b2-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="183b2-208">En watchdog kan övervaka hello resursen tooensure att det finns tillräckligt med utrymme.</span><span class="sxs-lookup"><span data-stu-id="183b2-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="183b2-209">Det kan lyssna efter meddelanden om ändringar av filen eller katalogen.</span><span class="sxs-lookup"><span data-stu-id="183b2-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="183b2-210">Det kan rapportera en varning om ett tröskelvärde för Summa har nåtts och rapportera ett fel om hello resursen är full.</span><span class="sxs-lookup"><span data-stu-id="183b2-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="183b2-211">På en varning startade en reparation system Rensa äldre filer på hello resursen.</span><span class="sxs-lookup"><span data-stu-id="183b2-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="183b2-212">En reparation system kan flytta hello-replik tooanother tjänstnoden på ett fel.</span><span class="sxs-lookup"><span data-stu-id="183b2-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="183b2-213">Observera hur hello villkoret tillstånd beskrivs vad gäller hälsa: hello hello villkor som kan uppfattas som Felfri (ok) eller ohälsosamt (varning eller fel).</span><span class="sxs-lookup"><span data-stu-id="183b2-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="183b2-214">Efter hello övervakning information har angetts måste en watchdog skrivare toofigure ut hur tooimplement hello watchdog.</span><span class="sxs-lookup"><span data-stu-id="183b2-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="183b2-215">Om hello villkor kan fastställas från inom hello service, kan hello watchdog ingå i själva hello övervakade tjänsten.</span><span class="sxs-lookup"><span data-stu-id="183b2-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="183b2-216">Hello-Tjänstkod kan exempelvis kontrollera hello resursen användning och rapportera varje gång den försöker toowrite en fil.</span><span class="sxs-lookup"><span data-stu-id="183b2-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="183b2-217">hello nytta av den här metoden är att reporting är enkel.</span><span class="sxs-lookup"><span data-stu-id="183b2-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="183b2-218">Vara måste försiktig tooprevent watchdog buggar från påverka hello-funktionerna.</span><span class="sxs-lookup"><span data-stu-id="183b2-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="183b2-219">Rapportering i hello övervakas service är inte alltid ett alternativ.</span><span class="sxs-lookup"><span data-stu-id="183b2-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="183b2-220">En watchdog inom hello-tjänsten kanske inte kan toodetect hello villkor.</span><span class="sxs-lookup"><span data-stu-id="183b2-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="183b2-221">Det får inte ha hello logik och data toomake hello bestämning.</span><span class="sxs-lookup"><span data-stu-id="183b2-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="183b2-222">hello arbetet med att övervaka hello villkor kan vara hög.</span><span class="sxs-lookup"><span data-stu-id="183b2-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="183b2-223">hello villkor får även inte vara specifika tooa service, men i stället påverkar samverkan mellan tjänster.</span><span class="sxs-lookup"><span data-stu-id="183b2-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="183b2-224">Ett annat alternativ är toohave watchdogs i hello kluster som separata processer.</span><span class="sxs-lookup"><span data-stu-id="183b2-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="183b2-225">Hej watchdogs övervaka hello villkor och rapport, utan att påverka hello tjänster på något sätt.</span><span class="sxs-lookup"><span data-stu-id="183b2-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="183b2-226">Till exempel dessa watchdogs kan genomföras som tillståndslösa tjänster i hello samma program som distribueras på alla noder eller hello samma noder som hello-tjänst.</span><span class="sxs-lookup"><span data-stu-id="183b2-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="183b2-227">Ibland kan är en watchdog som körs i klustret hello inte ett alternativ antingen.</span><span class="sxs-lookup"><span data-stu-id="183b2-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="183b2-228">Om hello övervakas villkoret är hello tillgänglighet eller funktionerna i hello tjänsten som användarna ser den, är det bästa toohave hello watchdogs i hello samma placera som hello användaren klienter.</span><span class="sxs-lookup"><span data-stu-id="183b2-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="183b2-229">Där de kan testa hello åtgärder i hello samma hur användare ringa upp dem.</span><span class="sxs-lookup"><span data-stu-id="183b2-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="183b2-230">Du kan till exempel ha en watchdog som finns utanför hello kluster utfärdar begäranden toohello tjänsten och kontrollerar hello svarstid och hello resultatet är korrekt.</span><span class="sxs-lookup"><span data-stu-id="183b2-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="183b2-231">(För en Kalkylatorn tjänst, till exempel 2 + 2 returnerar 4 inom en rimlig tid?)</span><span class="sxs-lookup"><span data-stu-id="183b2-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="183b2-232">När hello watchdog information har avslutats, bör du bestämma på en käll-ID som unikt identifierar den.</span><span class="sxs-lookup"><span data-stu-id="183b2-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="183b2-233">Om flera watchdogs av samma typ bor i hello hello kluster, måste de rapportera på olika enheter, eller om de rapporterar på hello samma entitet, Använd olika käll-ID eller egenskap.</span><span class="sxs-lookup"><span data-stu-id="183b2-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="183b2-234">Det här sättet sina rapporter kan samexistera.</span><span class="sxs-lookup"><span data-stu-id="183b2-234">This way, their reports can coexist.</span></span> <span data-ttu-id="183b2-235">hello-egenskapen för hello hälsorapport ska avbilda hello övervakas villkor.</span><span class="sxs-lookup"><span data-stu-id="183b2-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="183b2-236">(Exempelvis hello ovan hello egenskapen kunde **ShareSize**.) Om flera rapporter gäller toohello samma villkor, hello egenskapen innehålla vissa dynamisk information som tillåter toocoexist rapporter.</span><span class="sxs-lookup"><span data-stu-id="183b2-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="183b2-237">Om flera resurser behöver toobe övervakas, hello egenskapsnamn kan exempelvis **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="183b2-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="183b2-238">Gör *inte* Använd hello health store tookeep statusinformation.</span><span class="sxs-lookup"><span data-stu-id="183b2-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="183b2-239">Endast hälsa-relaterad information ska rapporteras som hälsa, som den här informationen påverkar hello hälsa utvärdering för en entitet.</span><span class="sxs-lookup"><span data-stu-id="183b2-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="183b2-240">hello health store har inte utformats som ett allmänt Arkiv.</span><span class="sxs-lookup"><span data-stu-id="183b2-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="183b2-241">Används hälsa utvärdering logik tooaggregate alla data i hello hälsotillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="183b2-242">Skicka information orelaterade toohealth (som rapporterar status med ett hälsotillstånd OK) inte påverkar hello samman hälsotillstånd, men det kan påverka hello prestanda för hello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="183b2-243">hello är nästa beslut vilken entitet tooreport på.</span><span class="sxs-lookup"><span data-stu-id="183b2-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="183b2-244">För mesta hello hello villkoret tydligt hello idetifies du entiteten.</span><span class="sxs-lookup"><span data-stu-id="183b2-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="183b2-245">Välja hello entitet med bästa möjliga granularitet.</span><span class="sxs-lookup"><span data-stu-id="183b2-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="183b2-246">Om ett villkor som påverkar alla repliker i en partition, en rapport om hello partition, inte på hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="183b2-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="183b2-247">Det finns specialfall där flera tankar krävs dock.</span><span class="sxs-lookup"><span data-stu-id="183b2-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="183b2-248">Om hello villkor påverkar en entitet, till exempel en replik, men hello är önskan toohave hello villkor som flaggats för mer än hello replik livslängd redovisas på hello partition.</span><span class="sxs-lookup"><span data-stu-id="183b2-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="183b2-249">I annat fall när hello repliken tas bort rensar hello hälsoarkivet alla rapporter.</span><span class="sxs-lookup"><span data-stu-id="183b2-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="183b2-250">Watchdog-skrivare måste du tänka hello livslängd hello enhetens och hello rapporten.</span><span class="sxs-lookup"><span data-stu-id="183b2-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="183b2-251">Det måste vara tydlig när en rapport måste rensas från en butik (till exempel när ett fel rapporteras på en enhet inte längre gäller).</span><span class="sxs-lookup"><span data-stu-id="183b2-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="183b2-252">Nu ska vi titta på ett exempel som sätter ihop hello punkter I som beskrivs.</span><span class="sxs-lookup"><span data-stu-id="183b2-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="183b2-253">Överväg ett Service Fabric-program består av en master tillståndskänslig beständig tjänst och sekundära tillståndslösa tjänster som distribueras på alla noder (en sekundär service typ för varje typ av aktivitet).</span><span class="sxs-lookup"><span data-stu-id="183b2-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="183b2-254">hello-hanteraren har en kö för bearbetning som innehåller kommandon toobe körs av sekundärservrar.</span><span class="sxs-lookup"><span data-stu-id="183b2-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="183b2-255">hello sekundärservrar utför hello inkommande begäranden och skicka tillbaka bekräftelse signaler.</span><span class="sxs-lookup"><span data-stu-id="183b2-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="183b2-256">Ett villkor som kan övervakas är hello hello master bearbetningskön.</span><span class="sxs-lookup"><span data-stu-id="183b2-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="183b2-257">Om hello master Kölängd når ett tröskelvärde, rapporterade en varning.</span><span class="sxs-lookup"><span data-stu-id="183b2-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="183b2-258">hello varning anger att hello sekundärservrar inte kan hantera hello belastning.</span><span class="sxs-lookup"><span data-stu-id="183b2-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="183b2-259">Om hello kön når hello maxlängd och kommandon släpps, ett fel rapporteras, som hello tjänsten går inte att återställa.</span><span class="sxs-lookup"><span data-stu-id="183b2-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="183b2-260">hello rapporter kan finnas på hello egenskapen **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="183b2-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="183b2-261">hello watchdog finns i hello-tjänsten och det har skickats på hello master primära repliken.</span><span class="sxs-lookup"><span data-stu-id="183b2-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="183b2-262">hello tid toolive är två minuter och skickas regelbundet var 30: e sekund.</span><span class="sxs-lookup"><span data-stu-id="183b2-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="183b2-263">Om hello primära kraschar rensas hello rapporten automatiskt från store.</span><span class="sxs-lookup"><span data-stu-id="183b2-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="183b2-264">Om hello service repliken är in, men det är ett dödläge eller andra problem med hello rapporten går ut i hello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="183b2-265">I det här fallet utvärderas hello entiteten vid fel.</span><span class="sxs-lookup"><span data-stu-id="183b2-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="183b2-266">Ytterligare villkor som kan övervakas är körningstid för aktiviteten.</span><span class="sxs-lookup"><span data-stu-id="183b2-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="183b2-267">hello master distribuerar uppgifter toohello sekundärservrar baserat på hello aktivitetstyp.</span><span class="sxs-lookup"><span data-stu-id="183b2-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="183b2-268">Beroende på hello design kunde hello master avsöka hello sekundärservrar för aktivitetsstatus.</span><span class="sxs-lookup"><span data-stu-id="183b2-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="183b2-269">Det kan också vänta tills sekundärservrar toosend tillbaka bekräftelse signaler när de görs.</span><span class="sxs-lookup"><span data-stu-id="183b2-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="183b2-270">I andra fall hello måste vara försiktig toodetect situationer där sekundärservrar die eller meddelanden går förlorade.</span><span class="sxs-lookup"><span data-stu-id="183b2-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="183b2-271">Ett alternativ är för hello master toosend toohello en ping-begäran samma sekundär som skickar tillbaka dess status.</span><span class="sxs-lookup"><span data-stu-id="183b2-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="183b2-272">Om ingen status tas emot hello master anser att det är ett fel och schemaläggs automatiskt hello uppgift på nytt.</span><span class="sxs-lookup"><span data-stu-id="183b2-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="183b2-273">Det här beteendet förutsätts att hello uppgifter idempotent.</span><span class="sxs-lookup"><span data-stu-id="183b2-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="183b2-274">hello övervakas villkor kan översättas som en varning om hello aktiviteten inte har gjort i en viss tid (**t1**, till exempel 10 minuter).</span><span class="sxs-lookup"><span data-stu-id="183b2-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="183b2-275">Om hello åtgärden inte slutförs i tid (**t2**, till exempel 20 minuter), hello övervakas villkor kan översättas som fel.</span><span class="sxs-lookup"><span data-stu-id="183b2-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="183b2-276">Den här reporting kan du göra detta på flera olika sätt:</span><span class="sxs-lookup"><span data-stu-id="183b2-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="183b2-277">hello master primära repliken rapporter om sig själv med jämna mellanrum.</span><span class="sxs-lookup"><span data-stu-id="183b2-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="183b2-278">Du kan ha en egenskap för alla väntande aktiviteter i hello kö.</span><span class="sxs-lookup"><span data-stu-id="183b2-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="183b2-279">Om minst en uppgift tar längre tid, hello rapportera status för hello egenskapen **PendingTasks** är en varning eller fel efter behov.</span><span class="sxs-lookup"><span data-stu-id="183b2-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="183b2-280">Om det finns inga väntande aktiviteter eller alla aktiviteter startade körningen är hello rapportera status OK.</span><span class="sxs-lookup"><span data-stu-id="183b2-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="183b2-281">hello uppgifter är beständiga.</span><span class="sxs-lookup"><span data-stu-id="183b2-281">hello tasks are persistent.</span></span> <span data-ttu-id="183b2-282">Om hello primära kraschar fortsätta hello nyligen upphöja primära tooreport korrekt.</span><span class="sxs-lookup"><span data-stu-id="183b2-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="183b2-283">En annan watchdog process (i hello molnet eller externa) kontrollerar hello uppgifter (från utanför, baserat på hello önskad aktivitet resultatet) toosee om de är slutförda.</span><span class="sxs-lookup"><span data-stu-id="183b2-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="183b2-284">Om de inte följa hello tröskelvärden, skickas en rapport på hello-huvudtjänsten.</span><span class="sxs-lookup"><span data-stu-id="183b2-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="183b2-285">En rapport som också skickas med varje aktivitet som innehåller hello aktivitets-ID som **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="183b2-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="183b2-286">Rapporter ska skickas endast ohälsosamt tillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="183b2-287">Ange tid toolive tooa några minuter och markera hello rapporter toobe tas bort när de upphör att gälla tooensure rensning.</span><span class="sxs-lookup"><span data-stu-id="183b2-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="183b2-288">sekundär hello som kör en uppgift rapporterar när det tar längre tid än förväntat toorun den.</span><span class="sxs-lookup"><span data-stu-id="183b2-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="183b2-289">Rapporterar på hello tjänstinstans för hello egenskapen **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="183b2-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="183b2-290">hello rapporten lokaliserar hello service-instans som har problem, men det fånga inte hello situation där hello instans dör.</span><span class="sxs-lookup"><span data-stu-id="183b2-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="183b2-291">hello rapporter rensas sedan.</span><span class="sxs-lookup"><span data-stu-id="183b2-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="183b2-292">Det kan rapportera om hello sekundär service.</span><span class="sxs-lookup"><span data-stu-id="183b2-292">It could report on hello secondary service.</span></span> <span data-ttu-id="183b2-293">Om hello sekundära är klar hello uppgiften rensar hello sekundära instans hello rapport från hello store.</span><span class="sxs-lookup"><span data-stu-id="183b2-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="183b2-294">hello rapporten fånga inte hello situation där hello bekräftelsemeddelande går förlorad och hello aktiviteten är inte klar hello master utgångspunkt från.</span><span class="sxs-lookup"><span data-stu-id="183b2-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="183b2-295">Men hello reporting görs i hello fall som beskrivs ovan, fångas hello rapporter i programmets hälsotillstånd när hälsa utvärderas.</span><span class="sxs-lookup"><span data-stu-id="183b2-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="183b2-296">Rapport med jämna mellanrum kontra om övergång</span><span class="sxs-lookup"><span data-stu-id="183b2-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="183b2-297">Med hjälp av modellen för hälsotillståndsrapportering hello skicka watchdogs rapporter med jämna mellanrum eller övergångar.</span><span class="sxs-lookup"><span data-stu-id="183b2-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="183b2-298">hello bör sätt för watchdog rapportering med jämna mellanrum, eftersom hello koden är mycket enklare och mindre känslig tooerrors.</span><span class="sxs-lookup"><span data-stu-id="183b2-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="183b2-299">Hej watchdogs måste arbetar toobe så enkelt som möjligt tooavoid buggar som utlöser felaktiga rapporter.</span><span class="sxs-lookup"><span data-stu-id="183b2-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="183b2-300">Felaktig *ohälsosamt* rapporter påverka hälsa utvärderingar och scenarier baserat på hälsa, inklusive uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="183b2-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="183b2-301">Felaktig *felfri* rapporter dölja problem i hello-kluster, vilket inte är önskvärd.</span><span class="sxs-lookup"><span data-stu-id="183b2-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="183b2-302">Hello watchdog kan implementeras med en timer för periodiska rapporteringen.</span><span class="sxs-lookup"><span data-stu-id="183b2-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="183b2-303">På en timer-återanrop hello watchdog Kontrollera hello tillstånd och skicka en rapport som baseras på hello aktuella tillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="183b2-304">Det finns inga behov toosee vilken rapport har skickats tidigare eller se alla optimeringar vad gäller meddelanden.</span><span class="sxs-lookup"><span data-stu-id="183b2-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="183b2-305">hello hälsa klienten har batchbearbetning logik toohelp med prestanda.</span><span class="sxs-lookup"><span data-stu-id="183b2-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="183b2-306">Medan hello hälsa klienten hålls alive, nytt försök internt tills hello rapporten bekräftas av hello health store eller hello watchdog genererar en nyare rapport med hello samma entitet, egenskap och källa.</span><span class="sxs-lookup"><span data-stu-id="183b2-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="183b2-307">Rapportering i övergångar krävs noggrann hantering av tillstånd.</span><span class="sxs-lookup"><span data-stu-id="183b2-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="183b2-308">hello watchdog övervakar vissa villkor och rapporterar endast när hello villkoren ändras.</span><span class="sxs-lookup"><span data-stu-id="183b2-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="183b2-309">hello upp och med den här metoden är att färre rapporter behövs.</span><span class="sxs-lookup"><span data-stu-id="183b2-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="183b2-310">hello Nackdelen är att hello logiken för hello watchdog komplexa.</span><span class="sxs-lookup"><span data-stu-id="183b2-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="183b2-311">hello watchdog måste upprätthålla hello villkor eller hello rapporter så att de kan vara inspekterade toodetermine tillstånd ändras.</span><span class="sxs-lookup"><span data-stu-id="183b2-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="183b2-312">På redundanskluster, måste vara försiktig med rapporter som har lagts till, men ännu inte skickats toohello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="183b2-313">hello sekvensnummer måste vara allt större.</span><span class="sxs-lookup"><span data-stu-id="183b2-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="183b2-314">Om inte, avvisas hello rapporter som inaktiva.</span><span class="sxs-lookup"><span data-stu-id="183b2-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="183b2-315">Synkroniseringen kan behövas mellan hello tillståndet för hello rapport och hello tillståndet för hello health store i hello sällsynta fall där dataförlust uppstår.</span><span class="sxs-lookup"><span data-stu-id="183b2-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="183b2-316">Rapportering av övergångar passar för tjänster som rapporterar på själva via `Partition` eller `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="183b2-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="183b2-317">När hello lokalt objekt (replikerings- eller distribuerat tjänstpaket / distribuerat program) är bort alla rapporter tas också bort.</span><span class="sxs-lookup"><span data-stu-id="183b2-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="183b2-318">Den här automatisk rensning sänker hello behovet av att synkroniseringen mellan rapport och health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="183b2-319">Om hello rapporten avser överordnade partitionen eller det överordnade programmet, iakttas försiktighet på redundans tooavoid inaktuella rapporter i hello health store.</span><span class="sxs-lookup"><span data-stu-id="183b2-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="183b2-320">Logik måste läggas toomaintain hello rätt tillstånd och avmarkera hello rapport från store när de inte behövs längre.</span><span class="sxs-lookup"><span data-stu-id="183b2-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="183b2-321">Implementera hälsa reporting</span><span class="sxs-lookup"><span data-stu-id="183b2-321">Implement health reporting</span></span>
<span data-ttu-id="183b2-322">När hello entiteten och rapportera information är klar, kan skickar hälsorapporter göras via hello API: et, PowerShell eller REST.</span><span class="sxs-lookup"><span data-stu-id="183b2-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="183b2-323">API</span><span class="sxs-lookup"><span data-stu-id="183b2-323">API</span></span>
<span data-ttu-id="183b2-324">tooreport via hello API du behöver toocreate hälsa specifika toohello entitet rapporttyp de vill tooreport på.</span><span class="sxs-lookup"><span data-stu-id="183b2-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="183b2-325">Ge hello rapporten tooa hälsa klienten.</span><span class="sxs-lookup"><span data-stu-id="183b2-325">Give hello report tooa health client.</span></span> <span data-ttu-id="183b2-326">Du kan också skapa en hälsoinformation och skickar den toocorrect rapporteringsmetoder på `Partition` eller `CodePackageActivationContext` tooreport på aktuella entiteter.</span><span class="sxs-lookup"><span data-stu-id="183b2-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="183b2-327">hello följande exempel visar periodiska reporting från en watchdog inom hello kluster.</span><span class="sxs-lookup"><span data-stu-id="183b2-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="183b2-328">hello watchdog kontrollerar om en extern resurs kan nås inifrån en nod.</span><span class="sxs-lookup"><span data-stu-id="183b2-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="183b2-329">hello resursen krävs av ett service manifest hello-programmet.</span><span class="sxs-lookup"><span data-stu-id="183b2-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="183b2-330">Om hello resursen är tillgänglig, kan hello andra tjänster inom hello program fortfarande fungerar korrekt.</span><span class="sxs-lookup"><span data-stu-id="183b2-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="183b2-331">Därför hello rapporten skickas på hello distribuerad tjänst paketet enhet var 30: e sekund.</span><span class="sxs-lookup"><span data-stu-id="183b2-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="183b2-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="183b2-332">PowerShell</span></span>
<span data-ttu-id="183b2-333">Skicka hälsorapporter med  **skicka ServiceFabric*EntityType*HealthReport **.</span><span class="sxs-lookup"><span data-stu-id="183b2-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="183b2-334">hello följande exempel visar periodiska rapportering om CPU-värden på en nod.</span><span class="sxs-lookup"><span data-stu-id="183b2-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="183b2-335">hello rapporter ska skickas med 30 sekunders mellanrum, och de har en tid toolive på två minuter.</span><span class="sxs-lookup"><span data-stu-id="183b2-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="183b2-336">Om de upphör att gälla har hello rapport problem, så hello nod utvärderas vid fel.</span><span class="sxs-lookup"><span data-stu-id="183b2-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="183b2-337">När hello CPU överskrider ett tröskelvärde har hello rapporten ett hälsotillstånd varning.</span><span class="sxs-lookup"><span data-stu-id="183b2-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="183b2-338">När hello CPU förblir överskrider ett tröskelvärde för mer än hello konfigurerats tid, rapporteras den som ett fel.</span><span class="sxs-lookup"><span data-stu-id="183b2-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="183b2-339">Annars skickar hello rapport ett hälsotillstånd OK.</span><span class="sxs-lookup"><span data-stu-id="183b2-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="183b2-340">hello rapporterar följande exempel en varning om tillfälligt på en replik.</span><span class="sxs-lookup"><span data-stu-id="183b2-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="183b2-341">Den först hämtar hello partitions-ID och hello replik-ID för hello-tjänsten som den är intresserad av.</span><span class="sxs-lookup"><span data-stu-id="183b2-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="183b2-342">Skickar sedan en rapport från **PowershellWatcher** på hello egenskapen **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="183b2-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="183b2-343">hello rapporten är av intresse för bara två minuter och det bort automatiskt från hello store.</span><span class="sxs-lookup"><span data-stu-id="183b2-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="183b2-344">REST</span><span class="sxs-lookup"><span data-stu-id="183b2-344">REST</span></span>
<span data-ttu-id="183b2-345">Skicka hälsorapporter med POST-förfrågningar som går toohello önskad entiteten och har i beskrivningen av rapporten hello brödtext hello hälsa REST.</span><span class="sxs-lookup"><span data-stu-id="183b2-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="183b2-346">Till exempel visas hur toosend REST- [kluster hälsorapporter](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) eller [tjänsten hälsorapporter](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="183b2-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="183b2-347">Alla enheter som stöds.</span><span class="sxs-lookup"><span data-stu-id="183b2-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="183b2-348">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="183b2-348">Next steps</span></span>
<span data-ttu-id="183b2-349">Baserat på hello hälsa data kan service-skrivare och kluster/application-administratörer Se sätt tooconsume hello information.</span><span class="sxs-lookup"><span data-stu-id="183b2-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="183b2-350">De kan exempelvis ställa in varningar baserat på status toocatch allvarliga problem innan de leda till avbrott.</span><span class="sxs-lookup"><span data-stu-id="183b2-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="183b2-351">Administratörer kan också ställa in reparera system toofix problem automatiskt.</span><span class="sxs-lookup"><span data-stu-id="183b2-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="183b2-352">Introduktion tooService hälsotillståndet för Infrastrukturresurser övervakning</span><span class="sxs-lookup"><span data-stu-id="183b2-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="183b2-353">Visa Service Fabric-hälsorapporter</span><span class="sxs-lookup"><span data-stu-id="183b2-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="183b2-354">Hur tooreport och kontrollera-tjänsten för hälsotillstånd</span><span class="sxs-lookup"><span data-stu-id="183b2-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="183b2-355">Använda systemet hälsorapporter för felsökning</span><span class="sxs-lookup"><span data-stu-id="183b2-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="183b2-356">Övervaka och diagnostisera tjänster lokalt</span><span class="sxs-lookup"><span data-stu-id="183b2-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="183b2-357">Uppgradering av Service Fabric-programmet</span><span class="sxs-lookup"><span data-stu-id="183b2-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

