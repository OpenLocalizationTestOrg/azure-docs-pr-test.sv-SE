---
title: "Avancerad användning av Reliable Services | Microsoft Docs"
description: "Mer information om avancerad användning av Service Fabric Reliable Services för ökad flexibilitet i dina tjänster."
services: Service-Fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: masnider
ms.assetid: f2942871-863d-47c3-b14a-7cdad9a742c7
ms.service: Service-Fabric
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: a87924faaf5c6c43716b06b6d70ab5100c61f097
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="advanced-usage-of-the-reliable-services-programming-model"></a><span data-ttu-id="04a72-103">Avancerad användning av tjänsterna tillförlitliga programmeringsmodellen</span><span class="sxs-lookup"><span data-stu-id="04a72-103">Advanced usage of the Reliable Services programming model</span></span>
<span data-ttu-id="04a72-104">Azure Service Fabric gör det enklare att skriva och hantera tillförlitliga tillståndslösa och tillståndskänsliga tjänster.</span><span class="sxs-lookup"><span data-stu-id="04a72-104">Azure Service Fabric simplifies writing and managing reliable stateless and stateful services.</span></span> <span data-ttu-id="04a72-105">Den här guiden handlar om avancerad användningar av Reliable Services för att få mer kontroll och flexibilitet över dina tjänster.</span><span class="sxs-lookup"><span data-stu-id="04a72-105">This guide talks about advanced usages of Reliable Services to gain more control and flexibility over your services.</span></span> <span data-ttu-id="04a72-106">Innan du läser den här guiden kan du bekanta dig med [Reliable Services programmeringsmodell](service-fabric-reliable-services-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="04a72-106">Prior to reading this guide, familiarize yourself with [the Reliable Services programming model](service-fabric-reliable-services-introduction.md).</span></span>

<span data-ttu-id="04a72-107">Både tillståndskänsliga och tillståndslösa tjänster har två primära startpunkter för användarkod:</span><span class="sxs-lookup"><span data-stu-id="04a72-107">Both stateful and stateless services have two primary entry points for user code:</span></span>

* <span data-ttu-id="04a72-108">`RunAsync(C#) / runAsync(Java)`är en generell startpunkt för koden för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="04a72-108">`RunAsync(C#) / runAsync(Java)` is a general-purpose entry point for your service code.</span></span>
* <span data-ttu-id="04a72-109">`CreateServiceReplicaListeners(C#)`och `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` är för att öppna kommunikationslyssnarna för klientbegäranden.</span><span class="sxs-lookup"><span data-stu-id="04a72-109">`CreateServiceReplicaListeners(C#)` and `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` is for opening communication listeners for client requests.</span></span>

<span data-ttu-id="04a72-110">Dessa två startpunkter räcker för de flesta tjänster.</span><span class="sxs-lookup"><span data-stu-id="04a72-110">For most services, these two entry points are sufficient.</span></span> <span data-ttu-id="04a72-111">I sällsynta fall när mer kontroll över livscykeln för en tjänst krävs är ytterligare Livscykelhändelser tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="04a72-111">In rare cases when more control over a service's lifecycle is required, additional lifecycle events are available.</span></span>

## <a name="stateless-service-instance-lifecycle"></a><span data-ttu-id="04a72-112">Tillståndslösa tjänsten instans livscykel</span><span class="sxs-lookup"><span data-stu-id="04a72-112">Stateless service instance lifecycle</span></span>
<span data-ttu-id="04a72-113">Tillståndslösa tjänsten livscykel är mycket enkelt.</span><span class="sxs-lookup"><span data-stu-id="04a72-113">A stateless service's lifecycle is very simple.</span></span> <span data-ttu-id="04a72-114">Tillståndslösa tjänsten kan bara öppnas, stängts eller avbrutits.</span><span class="sxs-lookup"><span data-stu-id="04a72-114">A stateless service can only be opened, closed, or aborted.</span></span> <span data-ttu-id="04a72-115">`RunAsync`i en tillståndslös tjänst körs när en instans av tjänsten öppnas och avbröts när en tjänstinstans stängts eller avbrutits.</span><span class="sxs-lookup"><span data-stu-id="04a72-115">`RunAsync` in a stateless service is executed when a service instance is opened, and canceled when a service instance is closed or aborted.</span></span>

<span data-ttu-id="04a72-116">Även om `RunAsync` bör vara tillräckligt nästan alla fall, öppna, Stäng och Avbryt händelser i en tillståndslös tjänst är också tillgängliga:</span><span class="sxs-lookup"><span data-stu-id="04a72-116">Although `RunAsync` should be sufficient in almost all cases, the open, close, and abort events in a stateless service are also available:</span></span>

* <span data-ttu-id="04a72-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java`OnOpenAsync kallas när instansen för tillståndslösa tjänsten ska användas.</span><span class="sxs-lookup"><span data-stu-id="04a72-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java` OnOpenAsync is called when the stateless service instance is about to be used.</span></span> <span data-ttu-id="04a72-118">Uppgifter för initiering av utökade tjänsten kan startas just nu.</span><span class="sxs-lookup"><span data-stu-id="04a72-118">Extended service initialization tasks can be started at this time.</span></span>
* <span data-ttu-id="04a72-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java`OnCloseAsync anropas när instansen för tillståndslösa tjänsten kommer att smidigt att stänga av.</span><span class="sxs-lookup"><span data-stu-id="04a72-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java` OnCloseAsync is called when the stateless service instance is going to be gracefully shut down.</span></span> <span data-ttu-id="04a72-120">Detta kan inträffa när tjänstens kod uppgraderas, tjänstinstansen flyttas på grund av belastningsutjämning eller ett tillfälligt fel har identifierats.</span><span class="sxs-lookup"><span data-stu-id="04a72-120">This can occur when the service's code is being upgraded, the service instance is being moved due to load balancing, or a transient fault is detected.</span></span> <span data-ttu-id="04a72-121">OnCloseAsync kan användas för att på ett säkert sätt Stäng några resurser stoppa behandling i bakgrunden, Slutför sparar externa tillstånd eller stänga ned befintliga anslutningar.</span><span class="sxs-lookup"><span data-stu-id="04a72-121">OnCloseAsync can be used to safely close any resources, stop any background processing, finish saving external state, or close down existing connections.</span></span>
* <span data-ttu-id="04a72-122">`void OnAbort() - C# / void onAbort() - Java`OnAbort anropas när instansen för tillståndslösa tjänsten tvång stängs.</span><span class="sxs-lookup"><span data-stu-id="04a72-122">`void OnAbort() - C# / void onAbort() - Java` OnAbort is called when the stateless service instance is being forcefully shut down.</span></span> <span data-ttu-id="04a72-123">Detta kallas vanligtvis när ett permanent fel identifieras på noden, eller när Service Fabric inte kan på ett tillförlitligt sätt hantera livscykeln för instansen för tjänsten på grund av ett internt fel.</span><span class="sxs-lookup"><span data-stu-id="04a72-123">This is generally called when a permanent fault is detected on the node, or when Service Fabric cannot reliably manage the service instance's lifecycle due to internal failures.</span></span>

## <a name="stateful-service-replica-lifecycle"></a><span data-ttu-id="04a72-124">Tillståndskänslig service replik livscykel</span><span class="sxs-lookup"><span data-stu-id="04a72-124">Stateful service replica lifecycle</span></span>

> [!NOTE]
> <span data-ttu-id="04a72-125">Tillståndskänsliga reliable services stöds inte i Java ännu.</span><span class="sxs-lookup"><span data-stu-id="04a72-125">Stateful reliable services are not supported in Java yet.</span></span>
>
>

<span data-ttu-id="04a72-126">En tillståndskänslig service replik livscykel är mycket mer komplexa än en instans av tillståndslösa tjänsten.</span><span class="sxs-lookup"><span data-stu-id="04a72-126">A stateful service replica's lifecycle is much more complex than a stateless service instance.</span></span> <span data-ttu-id="04a72-127">Dessutom för att öppna, stänga och avbryta händelser, görs en tillståndskänslig service replik ändringar i rollen under dess livslängd.</span><span class="sxs-lookup"><span data-stu-id="04a72-127">In addition to open, close, and abort events, a stateful service replica undergoes role changes during its lifetime.</span></span> <span data-ttu-id="04a72-128">När en tillståndskänslig service replik ändras rollen, de `OnChangeRoleAsync` händelsen utlöses:</span><span class="sxs-lookup"><span data-stu-id="04a72-128">When a stateful service replica changes role, the `OnChangeRoleAsync` event is triggered:</span></span>

* <span data-ttu-id="04a72-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)`OnChangeRoleAsync anropas när repliken tillståndskänslig service är rollen ändras, till exempel till primär eller sekundär.</span><span class="sxs-lookup"><span data-stu-id="04a72-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)` OnChangeRoleAsync is called when the stateful service replica is changing role, for example to primary or secondary.</span></span> <span data-ttu-id="04a72-130">Primära repliker får skrivstatus (ska kunna skapa och skriva till tillförlitliga samlingar).</span><span class="sxs-lookup"><span data-stu-id="04a72-130">Primary replicas are given write status (are allowed to create and write to Reliable Collections).</span></span> <span data-ttu-id="04a72-131">Sekundära repliker ges Lässtatus (kan bara läsa från befintliga tillförlitliga samlingar).</span><span class="sxs-lookup"><span data-stu-id="04a72-131">Secondary replicas are given read status (can only read from existing Reliable Collections).</span></span> <span data-ttu-id="04a72-132">De flesta arbetsobjekt i en tillståndskänslig service utförs på den primära repliken.</span><span class="sxs-lookup"><span data-stu-id="04a72-132">Most work in a stateful service is performed at the primary replica.</span></span> <span data-ttu-id="04a72-133">Sekundära repliker kan utföra skrivskyddade validering rapportgenerering, datautvinning eller andra skrivskyddade jobb.</span><span class="sxs-lookup"><span data-stu-id="04a72-133">Secondary replicas can perform read-only validation, report generation, data mining, or other read-only jobs.</span></span>

<span data-ttu-id="04a72-134">I en tillståndskänslig service bara den primära repliken har skrivbehörighet till tillstånd och är därför vanligtvis när tjänsten utförs verkligt arbete.</span><span class="sxs-lookup"><span data-stu-id="04a72-134">In a stateful service, only the primary replica has write access to state and thus is generally when the service is performing actual work.</span></span> <span data-ttu-id="04a72-135">Den `RunAsync` metoden i en tillståndskänslig service körs endast när repliken tillståndskänslig service är primär.</span><span class="sxs-lookup"><span data-stu-id="04a72-135">The `RunAsync` method in a stateful service is executed only when the stateful service replica is primary.</span></span> <span data-ttu-id="04a72-136">Den `RunAsync` metoden avbryts när en primär replik rollen ändras från primära samt under händelserna Stäng och ITransaction::Abort.</span><span class="sxs-lookup"><span data-stu-id="04a72-136">The `RunAsync` method is canceled when a primary replica's role changes away from primary, as well as during the close and abort events.</span></span>

<span data-ttu-id="04a72-137">Med den `OnChangeRoleAsync` händelsen kan du utföra arbetet beroende på replikroll även som svar på rolländring.</span><span class="sxs-lookup"><span data-stu-id="04a72-137">Using the `OnChangeRoleAsync` event allows you to perform work depending on replica role as well as in response to role change.</span></span>

<span data-ttu-id="04a72-138">En tillståndskänslig service innehåller också samma fyra livscykel händelser som en tillståndslös tjänst, med samma semantik och användningsområden:</span><span class="sxs-lookup"><span data-stu-id="04a72-138">A stateful service also provides the same four lifecycle events as a stateless service, with the same semantics and use cases:</span></span>

```csharp
* Task OnOpenAsync(IStatefulServicePartition, CancellationToken)
* Task OnCloseAsync(CancellationToken)
* void OnAbort()
```

## <a name="next-steps"></a><span data-ttu-id="04a72-139">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="04a72-139">Next steps</span></span>
<span data-ttu-id="04a72-140">Mer avancerade ämnen som är relaterade till Service Fabric, finns i följande artiklar:</span><span class="sxs-lookup"><span data-stu-id="04a72-140">For more advanced topics related to Service Fabric, see the following articles:</span></span>

* [<span data-ttu-id="04a72-141">Konfigurera tillståndskänsliga Reliable Services</span><span class="sxs-lookup"><span data-stu-id="04a72-141">Configuring stateful Reliable Services</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="04a72-142">Service Fabric hälsa introduktion</span><span class="sxs-lookup"><span data-stu-id="04a72-142">Service Fabric health introduction</span></span>](service-fabric-health-introduction.md)
* [<span data-ttu-id="04a72-143">Med hjälp av rapporter om hälsotillstånd för felsökning</span><span class="sxs-lookup"><span data-stu-id="04a72-143">Using system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
* [<span data-ttu-id="04a72-144">Konfigurera Services med Service Fabric klustret Resource Manager</span><span class="sxs-lookup"><span data-stu-id="04a72-144">Configuring Services with the Service Fabric Cluster Resource Manager</span></span>](service-fabric-cluster-resource-manager-configure-services.md)
