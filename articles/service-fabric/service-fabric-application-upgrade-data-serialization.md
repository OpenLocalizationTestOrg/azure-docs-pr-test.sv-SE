---
title: 'Uppgradering av programmet: dataserialisering | Microsoft Docs'
description: "Metodtips för dataserialisering och hur den påverkar rullande programuppgraderingar."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: a5f36366-a2ab-4ae3-bb08-bc2f9533bc5a
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 6aa3ac7842df4657fca7f6b4264e1c6fe52dc0c6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="how-data-serialization-affects-an-application-upgrade"></a><span data-ttu-id="46495-103">Hur dataserialisering påverkar en uppgradering av programmet</span><span class="sxs-lookup"><span data-stu-id="46495-103">How data serialization affects an application upgrade</span></span>
<span data-ttu-id="46495-104">I en [löpande uppgradering av programmet](service-fabric-application-upgrade.md), uppgraderingen tillämpas på en del noder, en domän i taget.</span><span class="sxs-lookup"><span data-stu-id="46495-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), the upgrade is applied to a subset of nodes, one upgrade domain at a time.</span></span> <span data-ttu-id="46495-105">Vissa uppgraderingsdomäner finns på den nya versionen av ditt program under den här processen och vissa uppgraderingsdomäner finns på den äldre versionen av programmet.</span><span class="sxs-lookup"><span data-stu-id="46495-105">During this process, some upgrade domains are on the newer version of your application, and some upgrade domains are on the older version of your application.</span></span> <span data-ttu-id="46495-106">Den nya versionen av programmet måste kunna läsa den tidigare versionen av data under driftsättningen, och den gamla versionen av programmet måste kunna läsa den nya versionen av dina data.</span><span class="sxs-lookup"><span data-stu-id="46495-106">During the rollout, the new version of your application must be able to read the old version of your data, and the old version of your application must be able to read the new version of your data.</span></span> <span data-ttu-id="46495-107">Om formatet inte är kompatibel med framåt och bakåt, misslyckas uppgraderingen eller värre, data kan försvinna eller skadas.</span><span class="sxs-lookup"><span data-stu-id="46495-107">If the data format is not forward and backward compatible, the upgrade may fail, or worse, data may be lost or corrupted.</span></span> <span data-ttu-id="46495-108">Den här artikeln beskrivs vad som utgör ditt dataformat och ger bästa praxis för att säkerställa att dina data är framåt och bakåt kompatibel.</span><span class="sxs-lookup"><span data-stu-id="46495-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span></span>

## <a name="what-makes-up-your-data-format"></a><span data-ttu-id="46495-109">Hur får din dataformat?</span><span class="sxs-lookup"><span data-stu-id="46495-109">What makes up your data format?</span></span>
<span data-ttu-id="46495-110">Azure Service Fabric kommer de data som är beständiga och replikeras från C#-klasser.</span><span class="sxs-lookup"><span data-stu-id="46495-110">In Azure Service Fabric, the data that is persisted and replicated comes from your C# classes.</span></span> <span data-ttu-id="46495-111">För program som använder [tillförlitliga samlingar](service-fabric-reliable-services-reliable-collections.md), att data är objekten i den tillförlitliga ordböcker och köer.</span><span class="sxs-lookup"><span data-stu-id="46495-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that data is the objects in the reliable dictionaries and queues.</span></span> <span data-ttu-id="46495-112">För program som använder [Reliable Actors](service-fabric-reliable-actors-introduction.md), som är stödjande tillståndet för aktören.</span><span class="sxs-lookup"><span data-stu-id="46495-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is the backing state for the actor.</span></span> <span data-ttu-id="46495-113">Dessa klasser i C# måste kunna serialiseras till beständiga och replikeras.</span><span class="sxs-lookup"><span data-stu-id="46495-113">These C# classes must be serializable to be persisted and replicated.</span></span> <span data-ttu-id="46495-114">Därför definieras dataformatet av fält och egenskaper som serialiseras, samt hur de serialiseras.</span><span class="sxs-lookup"><span data-stu-id="46495-114">Therefore, the data format is defined by the fields and properties that are serialized, as well as how they are serialized.</span></span> <span data-ttu-id="46495-115">Till exempel i en `IReliableDictionary<int, MyClass>` data är en serialiserad `int` och en serialiserad `MyClass`.</span><span class="sxs-lookup"><span data-stu-id="46495-115">For example, in an `IReliableDictionary<int, MyClass>` the data is a serialized `int` and a serialized `MyClass`.</span></span>

### <a name="code-changes-that-result-in-a-data-format-change"></a><span data-ttu-id="46495-116">Kod ändrar som resulterar i en data-formatändring</span><span class="sxs-lookup"><span data-stu-id="46495-116">Code changes that result in a data format change</span></span>
<span data-ttu-id="46495-117">Eftersom dataformatet bestäms av klasser i C#, kan ändringar till klasser medföra en formatändring data.</span><span class="sxs-lookup"><span data-stu-id="46495-117">Since the data format is determined by C# classes, changes to the classes may cause a data format change.</span></span> <span data-ttu-id="46495-118">Vara måste försiktig så att en uppgradering kan hantera formatändring data.</span><span class="sxs-lookup"><span data-stu-id="46495-118">Care must be taken to ensure that a rolling upgrade can handle the data format change.</span></span> <span data-ttu-id="46495-119">Exempel som kan orsaka dataändringar format:</span><span class="sxs-lookup"><span data-stu-id="46495-119">Examples that may cause data format changes:</span></span>

* <span data-ttu-id="46495-120">Lägga till eller ta bort fält eller egenskaper</span><span class="sxs-lookup"><span data-stu-id="46495-120">Adding or removing fields or properties</span></span>
* <span data-ttu-id="46495-121">Byta namn på fält eller egenskaper</span><span class="sxs-lookup"><span data-stu-id="46495-121">Renaming fields or properties</span></span>
* <span data-ttu-id="46495-122">Ändra vilka typer av fält eller egenskaper</span><span class="sxs-lookup"><span data-stu-id="46495-122">Changing the types of fields or properties</span></span>
* <span data-ttu-id="46495-123">Ändra namnet för klassen eller namnområdet</span><span class="sxs-lookup"><span data-stu-id="46495-123">Changing the class name or namespace</span></span>

### <a name="data-contract-as-the-default-serializer"></a><span data-ttu-id="46495-124">Datakontrakt som standard serialiseraren</span><span class="sxs-lookup"><span data-stu-id="46495-124">Data Contract as the default serializer</span></span>
<span data-ttu-id="46495-125">Serialiseraren är vanligtvis ansvarig för läsning av data och avserialisering av det till den aktuella versionen, även om data i en äldre eller *nyare* version.</span><span class="sxs-lookup"><span data-stu-id="46495-125">The serializer is generally responsible for reading the data and deserializing it into the current version, even if the data is in an older or *newer* version.</span></span> <span data-ttu-id="46495-126">Serialiseraren standard är den [datakontrakt serialiseraren](https://msdn.microsoft.com/library/ms733127.aspx), som har väldefinierade versionshantering regler.</span><span class="sxs-lookup"><span data-stu-id="46495-126">The default serializer is the [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span></span> <span data-ttu-id="46495-127">Tillförlitliga samlingar att serialiseraren som ska åsidosättas, men Reliable Actors för närvarande inte.</span><span class="sxs-lookup"><span data-stu-id="46495-127">Reliable Collections allow the serializer to be overridden, but Reliable Actors currently do not.</span></span> <span data-ttu-id="46495-128">Data serialiseraren spelar en viktig roll i att aktivera löpande uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="46495-128">The data serializer plays an important role in enabling rolling upgrades.</span></span> <span data-ttu-id="46495-129">Serialiseraren datakontrakt är serialiseraren som vi rekommenderar för Service Fabric-program.</span><span class="sxs-lookup"><span data-stu-id="46495-129">The Data Contract serializer is the serializer that we recommend for Service Fabric applications.</span></span>

## <a name="how-the-data-format-affects-a-rolling-upgrade"></a><span data-ttu-id="46495-130">Hur påverkar dataformatet löpande uppgradering</span><span class="sxs-lookup"><span data-stu-id="46495-130">How the data format affects a rolling upgrade</span></span>
<span data-ttu-id="46495-131">Det finns två huvudscenarier där serialiseraren kan stöta på en äldre under en uppgradering eller *nyare* version av dina data:</span><span class="sxs-lookup"><span data-stu-id="46495-131">During a rolling upgrade, there are two main scenarios where the serializer may encounter an older or *newer* version of your data:</span></span>

1. <span data-ttu-id="46495-132">När en nod har uppgraderats och börjar säkerhetskopiera, nya serialiseraren läser in de data som har kvar på disken av den gamla versionen.</span><span class="sxs-lookup"><span data-stu-id="46495-132">After a node is upgraded and starts back up, the new serializer will load the data that was persisted to disk by the old version.</span></span>
2. <span data-ttu-id="46495-133">Under uppgraderingen innehåller klustret en blandning av gamla och nya versioner av din kod.</span><span class="sxs-lookup"><span data-stu-id="46495-133">During the rolling upgrade, the cluster will contain a mix of the old and new versions of your code.</span></span> <span data-ttu-id="46495-134">Eftersom repliker kan placeras i olika uppgraderingsdomäner och repliker skicka data till varandra, kan den nya eller gamla versionen av dina data påträffas i den nya eller gamla versionen av din serialiserare.</span><span class="sxs-lookup"><span data-stu-id="46495-134">Since replicas may be placed in different upgrade domains, and replicas send data to each other, the new and/or old version of your data may be encountered by the new and/or old version of your serializer.</span></span>

> [!NOTE]
> <span data-ttu-id="46495-135">”Ny version” och ”gamla version” här avser versionen av din kod som körs.</span><span class="sxs-lookup"><span data-stu-id="46495-135">The "new version" and "old version" here refer to the version of your code that is running.</span></span> <span data-ttu-id="46495-136">”Nya serialiseraren” syftar på serialiserare-kod som körs i den nya versionen av programmet.</span><span class="sxs-lookup"><span data-stu-id="46495-136">The "new serializer" refers to the serializer code that is executing in the new version of your application.</span></span> <span data-ttu-id="46495-137">”Nya data” refererar till den serialiserade C#-klassen från den nya versionen av programmet.</span><span class="sxs-lookup"><span data-stu-id="46495-137">The "new data" refers to the serialized C# class from the new version of your application.</span></span>
> 
> 

<span data-ttu-id="46495-138">De två versionerna av koden och data måste vara både framåt och bakåt kompatibel.</span><span class="sxs-lookup"><span data-stu-id="46495-138">The two versions of code and data format must be both forward and backward compatible.</span></span> <span data-ttu-id="46495-139">Om de inte är kompatibla uppgraderingen misslyckas eller data kan gå förlorade.</span><span class="sxs-lookup"><span data-stu-id="46495-139">If they are not compatible, the rolling upgrade may fail or data may be lost.</span></span> <span data-ttu-id="46495-140">Uppgraderingen kan misslyckas om koden eller serialiseraren kan utlösa undantag eller ett fel när den stöter på den andra versionen.</span><span class="sxs-lookup"><span data-stu-id="46495-140">The rolling upgrade may fail because the code or serializer may throw exceptions or a fault when it encounters the other version.</span></span> <span data-ttu-id="46495-141">Data kan gå förlorade om du till exempel en ny egenskap har lagts till men gamla serialiseraren den under deserialisering.</span><span class="sxs-lookup"><span data-stu-id="46495-141">Data may be lost if, for example, a new property was added but the old serializer discards it during deserialization.</span></span>

<span data-ttu-id="46495-142">Datakontrakt är den rekommenderade lösningen för att säkerställa att dina data är kompatibel.</span><span class="sxs-lookup"><span data-stu-id="46495-142">Data Contract is the recommended solution for ensuring that your data is compatible.</span></span> <span data-ttu-id="46495-143">Det har väldefinierade versionshantering regler för att lägga till, ta bort och ändra fält.</span><span class="sxs-lookup"><span data-stu-id="46495-143">It has well-defined versioning rules for adding, removing, and changing fields.</span></span> <span data-ttu-id="46495-144">Det har också stöd för behandlar okänt fält och koppla upp i processen för serialisering och deserialisering samt hantera klassarv.</span><span class="sxs-lookup"><span data-stu-id="46495-144">It also has support for dealing with unknown fields, hooking into the serialization and deserialization process, and dealing with class inheritance.</span></span> <span data-ttu-id="46495-145">Mer information finns i [med datakontrakt](https://msdn.microsoft.com/library/ms733127.aspx).</span><span class="sxs-lookup"><span data-stu-id="46495-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="46495-146">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="46495-146">Next steps</span></span>
<span data-ttu-id="46495-147">[Uppgradera ditt program med hjälp av Visual Studio](service-fabric-application-upgrade-tutorial.md) vägleder dig genom en uppgradering av programmet med hjälp av Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="46495-147">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="46495-148">[Uppgradera ditt program med hjälp av Powershell](service-fabric-application-upgrade-tutorial-powershell.md) vägleder dig genom en uppgradering av programmet med hjälp av PowerShell.</span><span class="sxs-lookup"><span data-stu-id="46495-148">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="46495-149">Styra hur programmet ska uppgraderas med hjälp av [uppgradera parametrar](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="46495-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="46495-150">Lär dig hur du använder avancerade funktioner när du uppgraderar ditt program genom att referera till [avancerade ämnen](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="46495-150">Learn how to use advanced functionality while upgrading your application by referring to [Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="46495-151">Lösa vanliga problem i programuppgraderingar genom att referera till stegen i [felsökning programuppgraderingar ](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="46495-151">Fix common problems in application upgrades by referring to the steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span></span>

