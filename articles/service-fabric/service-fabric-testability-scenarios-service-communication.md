---
title: "Möjlighet att testa: Tjänsten kommunikation | Microsoft Docs"
description: "Service-to-service-kommunikation är en kritisk integrering av ett Service Fabric-program. Den här artikeln beskrivs överväganden vid utformning och tester tekniker."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: c182cc2062ada40029504de5b2b64b021c614ce6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="41422-104">Service Fabric möjlighet att testa scenarier: tjänsten kommunikation</span><span class="sxs-lookup"><span data-stu-id="41422-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="41422-105">Mikrotjänster och tjänstorienterad arkitektur formatmallar ytan naturligt i Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="41422-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="41422-106">I dessa typer av distribuerade arkitekturer består komponentbaserade mikrotjänster program vanligtvis av flera tjänster som behöver kommunicera med varandra.</span><span class="sxs-lookup"><span data-stu-id="41422-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need to talk to each other.</span></span> <span data-ttu-id="41422-107">I även de enklaste fall kan har du vanligtvis minst en tillståndslös webbtjänst och en tillståndskänslig data storage-tjänst som behöver kommunicera.</span><span class="sxs-lookup"><span data-stu-id="41422-107">In even the simplest cases, you generally have at least a stateless web service and a stateful data storage service that need to communicate.</span></span>

<span data-ttu-id="41422-108">Service-to-service-kommunikation är en kritisk integrering av ett program, eftersom varje tjänst Exponerar en fjärr-API till andra tjänster.</span><span class="sxs-lookup"><span data-stu-id="41422-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API to other services.</span></span> <span data-ttu-id="41422-109">Arbeta med en uppsättning API-gränser som innebär att i/o vanligtvis kräver viss precision med mycket testning och validering.</span><span class="sxs-lookup"><span data-stu-id="41422-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="41422-110">Det finns många saker du måste ta när dessa gränser för tjänsten wired tillsammans i ett distribuerat system:</span><span class="sxs-lookup"><span data-stu-id="41422-110">There are numerous considerations to make when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="41422-111">*Transport-protokollet*.</span><span class="sxs-lookup"><span data-stu-id="41422-111">*Transport protocol*.</span></span> <span data-ttu-id="41422-112">Ska du använda HTTP för ökad samverkan eller anpassade binära protokoll för maximalt dataflöde?</span><span class="sxs-lookup"><span data-stu-id="41422-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="41422-113">*Felhantering*.</span><span class="sxs-lookup"><span data-stu-id="41422-113">*Error handling*.</span></span> <span data-ttu-id="41422-114">Hur permanent och tillfälliga fel hanteras?</span><span class="sxs-lookup"><span data-stu-id="41422-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="41422-115">Vad händer när en tjänst som flyttar till en annan nod?</span><span class="sxs-lookup"><span data-stu-id="41422-115">What will happen when a service moves to a different node?</span></span>
* <span data-ttu-id="41422-116">*Tidsgränser och fördröjning*.</span><span class="sxs-lookup"><span data-stu-id="41422-116">*Timeouts and latency*.</span></span> <span data-ttu-id="41422-117">I multitiered program, hur varje tjänstnivå hanterar latens via stacken och för användaren?</span><span class="sxs-lookup"><span data-stu-id="41422-117">In multitiered applications, how will each service layer handle latency through the stack and to the user?</span></span>

<span data-ttu-id="41422-118">Om du använder en inbyggd tjänst kommunikation komponenter som tillhandahålls av Service Fabric eller om du skapar egna, tester samverkan mellan dina tjänster är kritiska för återhämtning i ditt program.</span><span class="sxs-lookup"><span data-stu-id="41422-118">Whether you use one of the built-in service communication components provided by Service Fabric or you build your own, testing the interactions between your services is critical to ensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-to-move"></a><span data-ttu-id="41422-119">Förbereda för services för att flytta</span><span class="sxs-lookup"><span data-stu-id="41422-119">Prepare for services to move</span></span>
<span data-ttu-id="41422-120">Instanser av tjänsten kan flytta över tid.</span><span class="sxs-lookup"><span data-stu-id="41422-120">Service instances may move around over time.</span></span> <span data-ttu-id="41422-121">Detta gäller särskilt när de är konfigurerade med belastningen anpassad skräddarsydda optimal Resursanvändning belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="41422-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="41422-122">Service Fabric flyttar instanser av tjänsten för att maximera deras tillgänglighet även under uppgraderingar, redundans, skalbara och andra situationer som sker över livslängden för ett distribuerat system.</span><span class="sxs-lookup"><span data-stu-id="41422-122">Service Fabric moves your service instances to maximize their availability even during upgrades, failovers, scale-out, and other situations that occur over the lifetime of a distributed system.</span></span>

<span data-ttu-id="41422-123">När tjänster flyttar i klustret, ska klienterna och andra tjänster förberedas för att hantera två scenarier när de kommunicerar med en tjänst:</span><span class="sxs-lookup"><span data-stu-id="41422-123">As services move around in the cluster, your clients and other services should be prepared to handle two scenarios when they talk to a service:</span></span>

* <span data-ttu-id="41422-124">Service-instans eller partition repliken har flyttats sedan förra gången du talade vi till den.</span><span class="sxs-lookup"><span data-stu-id="41422-124">The service instance or partition replica has moved since the last time you talked to it.</span></span> <span data-ttu-id="41422-125">Detta är en normal del av en livscykel för tjänsten och den bör förväntas under livslängden för ditt program.</span><span class="sxs-lookup"><span data-stu-id="41422-125">This is a normal part of a service lifecycle, and it should be expected to happen during the lifetime of your application.</span></span>
* <span data-ttu-id="41422-126">Service-instans eller partition repliken håller på att flytta.</span><span class="sxs-lookup"><span data-stu-id="41422-126">The service instance or partition replica is in the process of moving.</span></span> <span data-ttu-id="41422-127">Även om växling vid fel på en tjänst från en nod till en annan uppstår mycket snabbt i Service Fabric kan finnas det en fördröjning i tillgänglighet om kommunikationskomponenten av tjänsten tar lång tid att starta.</span><span class="sxs-lookup"><span data-stu-id="41422-127">Although failover of a service from one node to another occurs very quickly in Service Fabric, there may be a delay in availability if the communication component of your service is slow to start.</span></span>

<span data-ttu-id="41422-128">Hantering av dessa scenarier smidigt är viktigt för ett system för smooth körs.</span><span class="sxs-lookup"><span data-stu-id="41422-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="41422-129">Om du vill göra det måste du tänka på:</span><span class="sxs-lookup"><span data-stu-id="41422-129">To do so, keep in mind that:</span></span>

* <span data-ttu-id="41422-130">Varje tjänst som kan anslutas till har en *adress* att den lyssnar på (till exempel http- eller WebSockets).</span><span class="sxs-lookup"><span data-stu-id="41422-130">Every service that can be connected to has an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="41422-131">När du flyttar en tjänstinstans eller partition, ändrar sin adress-slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="41422-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="41422-132">(Den flyttas till en annan nod med en annan IP-adress.) Om du använder inbyggd kommunikationskomponenter hanterar de nytt lösa postadresser åt dig.</span><span class="sxs-lookup"><span data-stu-id="41422-132">(It moves to a different node with a different IP address.) If you're using the built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="41422-133">Det kan finnas en tillfällig ökning i tjänsten svarstid som startar tjänsten instans av dess lyssnare igen.</span><span class="sxs-lookup"><span data-stu-id="41422-133">There may be a temporary increase in service latency as the service instance starts up its listener again.</span></span> <span data-ttu-id="41422-134">Detta beror på hur snabbt tjänsten öppnar lyssnaren när tjänstinstansen flyttas.</span><span class="sxs-lookup"><span data-stu-id="41422-134">This depends on how quickly the service opens the listener after the service instance is moved.</span></span>
* <span data-ttu-id="41422-135">Alla befintliga anslutningar måste du stänga och öppna när tjänsten öppnas på en ny nod.</span><span class="sxs-lookup"><span data-stu-id="41422-135">Any existing connections need to be closed and reopened after the service opens on a new node.</span></span> <span data-ttu-id="41422-136">En korrekt nodavstängning eller omstart ger dig tid för befintliga anslutningar stängs avslutas.</span><span class="sxs-lookup"><span data-stu-id="41422-136">A graceful node shutdown or restart allows time for existing connections to be shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="41422-137">Testa den: flytta instanser av tjänsten</span><span class="sxs-lookup"><span data-stu-id="41422-137">Test it: Move service instances</span></span>
<span data-ttu-id="41422-138">Med hjälp av Service Fabric datatillgång verktyg kan skapa du ett Testscenario om du vill testa dessa situationer på olika sätt:</span><span class="sxs-lookup"><span data-stu-id="41422-138">By using Service Fabric's testability tools, you can author a test scenario to test these situations in different ways:</span></span>

1. <span data-ttu-id="41422-139">Flytta en tillståndskänslig service primära repliken.</span><span class="sxs-lookup"><span data-stu-id="41422-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="41422-140">Den primära repliken av en tillståndskänslig service partition kan flyttas av olika orsaker.</span><span class="sxs-lookup"><span data-stu-id="41422-140">The primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="41422-141">Används för att rikta den primära repliken av en specifik partition för att se hur dina tjänster reagerar på flytten på ett mycket kontrollerat sätt.</span><span class="sxs-lookup"><span data-stu-id="41422-141">Use this to target the primary replica of a specific partition to see how your services react to the move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="41422-142">Stoppa en nod.</span><span class="sxs-lookup"><span data-stu-id="41422-142">Stop a node.</span></span>
   
    <span data-ttu-id="41422-143">När en nod har stoppats, flyttar Service Fabric alla instanser av tjänsten eller partitioner som fanns på den noden till en av de andra tillgängliga noderna i klustret.</span><span class="sxs-lookup"><span data-stu-id="41422-143">When a node is stopped, Service Fabric moves all of the service instances or partitions that were on that node to one of the other available nodes in the cluster.</span></span> <span data-ttu-id="41422-144">Används för att testa en situation där en nod tappas bort från klustret och alla tjänstinstanser och repliker på noden måste flytta.</span><span class="sxs-lookup"><span data-stu-id="41422-144">Use this to test a situation where a node is lost from your cluster and all of the service instances and replicas on that node have to move.</span></span>
   
    <span data-ttu-id="41422-145">Du kan stoppa en nod med hjälp av PowerShell **stoppa ServiceFabricNode** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="41422-145">You can stop a node by using the PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="41422-146">Underhåll tjänsttillgänglighet för</span><span class="sxs-lookup"><span data-stu-id="41422-146">Maintain service availability</span></span>
<span data-ttu-id="41422-147">Service Fabric är utformad att ge hög tillgänglighet för dina tjänster som en plattform.</span><span class="sxs-lookup"><span data-stu-id="41422-147">As a platform, Service Fabric is designed to provide high availability of your services.</span></span> <span data-ttu-id="41422-148">Men i extrema fall underliggande infrastruktur kan fortfarande ha inte finns.</span><span class="sxs-lookup"><span data-stu-id="41422-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="41422-149">Det är viktigt att testa för dessa scenarier för.</span><span class="sxs-lookup"><span data-stu-id="41422-149">It is important to test for these scenarios, too.</span></span>

<span data-ttu-id="41422-150">Tillståndskänsliga tjänster använder en kvorum-dator för att replikera statusen för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="41422-150">Stateful services use a quorum-based system to replicate state for high availability.</span></span> <span data-ttu-id="41422-151">Det innebär att ett kvorum av repliker måste vara tillgängliga för att utföra skrivåtgärder.</span><span class="sxs-lookup"><span data-stu-id="41422-151">This means that a quorum of replicas needs to be available to perform write operations.</span></span> <span data-ttu-id="41422-152">Ett kvorum av repliker kanske inte tillgänglig i sällsynta fall, till exempel ett omfattande maskinvarufel.</span><span class="sxs-lookup"><span data-stu-id="41422-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="41422-153">Du kommer inte att kunna utföra skrivåtgärder i dessa fall, men du kommer fortfarande att kunna utföra läsåtgärder.</span><span class="sxs-lookup"><span data-stu-id="41422-153">In these cases, you will not be able to perform write operations, but you will still be able to perform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="41422-154">Testa den: skriva åtgärden otillgänglighet</span><span class="sxs-lookup"><span data-stu-id="41422-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="41422-155">Med hjälp av verktygen datatillgång i Service Fabric du mata in ett fel som startar förlorar kvorum som ett test.</span><span class="sxs-lookup"><span data-stu-id="41422-155">By using the testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="41422-156">Även om ett sådant scenario är sällsynt, är det viktigt att klienter och tjänster som är beroende av en tillståndskänslig service är beredd att hantera situationer där denne inte fatta skrivåtgärder till den.</span><span class="sxs-lookup"><span data-stu-id="41422-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared to handle situations where they cannot make write requests to it.</span></span> <span data-ttu-id="41422-157">Det är också viktigt att tillståndskänslig själva tjänsten känner till denna möjlighet och kan smidigt kommunicera till anropare.</span><span class="sxs-lookup"><span data-stu-id="41422-157">It is also important that the stateful service itself is aware of this possibility and can gracefully communicate it to callers.</span></span>

<span data-ttu-id="41422-158">Du kan ge upphov till förlorar kvorum med hjälp av PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="41422-158">You can induce quorum loss by using the PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="41422-159">I det här exemplet anger vi `QuorumLossMode` till `QuorumReplicas` att indikera att vi vill framkalla förlorar kvorum utan att stoppa alla repliker.</span><span class="sxs-lookup"><span data-stu-id="41422-159">In this example, we set `QuorumLossMode` to `QuorumReplicas` to indicate that we want to induce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="41422-160">Det här sättet läsåtgärder är fortfarande möjligt.</span><span class="sxs-lookup"><span data-stu-id="41422-160">This way, read operations are still possible.</span></span> <span data-ttu-id="41422-161">Om du vill testa ett scenario där en hel partition är tillgänglig, du kan ange den här växeln till `AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="41422-161">To test a scenario where an entire partition is unavailable, you can set this switch to `AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="41422-162">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="41422-162">Next steps</span></span>
[<span data-ttu-id="41422-163">Mer information om datatillgång åtgärder</span><span class="sxs-lookup"><span data-stu-id="41422-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="41422-164">Mer information om möjlighet att testa scenarier</span><span class="sxs-lookup"><span data-stu-id="41422-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

