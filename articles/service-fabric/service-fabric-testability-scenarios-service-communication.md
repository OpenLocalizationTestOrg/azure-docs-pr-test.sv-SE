---
title: "Möjlighet att testa: Tjänsten kommunikation | Microsoft Docs"
description: "Service-to-service-kommunikation är en kritisk integrering av ett Service Fabric-program. Den här artikeln beskrivs överväganden vid utformning och tester tekniker."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="1fca1-104">Service Fabric möjlighet att testa scenarier: tjänsten kommunikation</span><span class="sxs-lookup"><span data-stu-id="1fca1-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="1fca1-105">Mikrotjänster och tjänstorienterad arkitektur formatmallar ytan naturligt i Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="1fca1-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="1fca1-106">I dessa typer av distribuerade arkitekturer består komponentbaserade mikrotjänster program vanligtvis av flera tjänster som behöver tootalk tooeach andra.</span><span class="sxs-lookup"><span data-stu-id="1fca1-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="1fca1-107">I även hello enklaste fall kan har du vanligtvis minst en tillståndslös webbtjänst och en tillståndskänslig data storage-tjänst som behöver toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="1fca1-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="1fca1-108">Service-to-service-kommunikation är en kritisk integrering av ett program, eftersom varje tjänst Exponerar en fjärransluten tooother API-tjänster.</span><span class="sxs-lookup"><span data-stu-id="1fca1-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="1fca1-109">Arbeta med en uppsättning API-gränser som innebär att i/o vanligtvis kräver viss precision med mycket testning och validering.</span><span class="sxs-lookup"><span data-stu-id="1fca1-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="1fca1-110">Det finns många överväganden toomake när dessa gränser för tjänsten wired tillsammans i ett distribuerat system:</span><span class="sxs-lookup"><span data-stu-id="1fca1-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="1fca1-111">*Transport-protokollet*.</span><span class="sxs-lookup"><span data-stu-id="1fca1-111">*Transport protocol*.</span></span> <span data-ttu-id="1fca1-112">Ska du använda HTTP för ökad samverkan eller anpassade binära protokoll för maximalt dataflöde?</span><span class="sxs-lookup"><span data-stu-id="1fca1-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="1fca1-113">*Felhantering*.</span><span class="sxs-lookup"><span data-stu-id="1fca1-113">*Error handling*.</span></span> <span data-ttu-id="1fca1-114">Hur permanent och tillfälliga fel hanteras?</span><span class="sxs-lookup"><span data-stu-id="1fca1-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="1fca1-115">Vad händer när en tjänst flyttar tooa annan nod?</span><span class="sxs-lookup"><span data-stu-id="1fca1-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="1fca1-116">*Tidsgränser och fördröjning*.</span><span class="sxs-lookup"><span data-stu-id="1fca1-116">*Timeouts and latency*.</span></span> <span data-ttu-id="1fca1-117">I multitiered program, hur varje tjänstnivå hanterar latens via hello stacken och toohello användare?</span><span class="sxs-lookup"><span data-stu-id="1fca1-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="1fca1-118">Om du använder en av hello inbyggd kommunikation tjänstkomponenter som tillhandahålls av Service Fabric eller du skapar egna, är testa hello samverkan mellan dina tjänster kritiska tooensuring återhämtning i ditt program.</span><span class="sxs-lookup"><span data-stu-id="1fca1-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="1fca1-119">Förbereda för tjänster toomove</span><span class="sxs-lookup"><span data-stu-id="1fca1-119">Prepare for services toomove</span></span>
<span data-ttu-id="1fca1-120">Instanser av tjänsten kan flytta över tid.</span><span class="sxs-lookup"><span data-stu-id="1fca1-120">Service instances may move around over time.</span></span> <span data-ttu-id="1fca1-121">Detta gäller särskilt när de är konfigurerade med belastningen anpassad skräddarsydda optimal Resursanvändning belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="1fca1-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="1fca1-122">Service Fabric flyttar din tjänst instanser toomaximize deras tillgänglighet även under uppgraderingar, redundans, skalbara och andra situationer som sker över hello livslängden för ett distribuerat system.</span><span class="sxs-lookup"><span data-stu-id="1fca1-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="1fca1-123">När tjänster flyttar i hello kluster, ska klienterna och andra tjänster vara förberedda toohandle två scenarier när de talar tooa tjänsten:</span><span class="sxs-lookup"><span data-stu-id="1fca1-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="1fca1-124">hello service-instans eller partition replik har flyttats sedan hello senaste gången som du har talat tooit.</span><span class="sxs-lookup"><span data-stu-id="1fca1-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="1fca1-125">Detta är en normal del av en livscykel för tjänsten och det bör vara förväntade toohappen under hello livslängd för programmet.</span><span class="sxs-lookup"><span data-stu-id="1fca1-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="1fca1-126">hello service-instans eller partition repliken är i hello processen att flytta.</span><span class="sxs-lookup"><span data-stu-id="1fca1-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="1fca1-127">Även om växling vid fel på en tjänst från en nod tooanother uppstår mycket snabbt i Service Fabric kan finnas det en fördröjning i tillgänglighet om hello kommunikation del av din tjänst är långsam toostart.</span><span class="sxs-lookup"><span data-stu-id="1fca1-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="1fca1-128">Hantering av dessa scenarier smidigt är viktigt för ett system för smooth körs.</span><span class="sxs-lookup"><span data-stu-id="1fca1-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="1fca1-129">toodo så Tänk som:</span><span class="sxs-lookup"><span data-stu-id="1fca1-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="1fca1-130">Varje tjänst som kan vara anslutna toohas en *adress* att den lyssnar på (till exempel http- eller WebSockets).</span><span class="sxs-lookup"><span data-stu-id="1fca1-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="1fca1-131">När du flyttar en tjänstinstans eller partition, ändrar sin adress-slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="1fca1-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="1fca1-132">(Den flyttas tooa annan nod med en annan IP-adress.) Om du använder hello inbyggd kommunikationskomponenter hanterar de nytt lösa postadresser åt dig.</span><span class="sxs-lookup"><span data-stu-id="1fca1-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="1fca1-133">Det kan finnas en tillfällig ökning i tjänsten svarstid som hello service-instans startar upp dess lyssnare igen.</span><span class="sxs-lookup"><span data-stu-id="1fca1-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="1fca1-134">Detta beror på hur snabbt hello tjänsten öppnar hello lyssnare när hello tjänstinstans flyttas.</span><span class="sxs-lookup"><span data-stu-id="1fca1-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="1fca1-135">Alla befintliga anslutningar måste toobe stänga och öppna när hello service öppnas på en ny nod.</span><span class="sxs-lookup"><span data-stu-id="1fca1-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="1fca1-136">En korrekt nodavstängning eller omstart ger dig tid för befintliga anslutningar toobe avslutas på vanligt sätt.</span><span class="sxs-lookup"><span data-stu-id="1fca1-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="1fca1-137">Testa den: flytta instanser av tjänsten</span><span class="sxs-lookup"><span data-stu-id="1fca1-137">Test it: Move service instances</span></span>
<span data-ttu-id="1fca1-138">Med hjälp av Service Fabric datatillgång verktyg kan du skapa en test-scenario tootest situationerna på olika sätt:</span><span class="sxs-lookup"><span data-stu-id="1fca1-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="1fca1-139">Flytta en tillståndskänslig service primära repliken.</span><span class="sxs-lookup"><span data-stu-id="1fca1-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="1fca1-140">hello kan primär replik av en tillståndskänslig service-partitionen flyttas av olika orsaker.</span><span class="sxs-lookup"><span data-stu-id="1fca1-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="1fca1-141">Använd den här tootarget hello primära repliken av en specifik partition toosee hur dina tjänster reagerar toohello flytta på ett mycket kontrollerat sätt.</span><span class="sxs-lookup"><span data-stu-id="1fca1-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="1fca1-142">Stoppa en nod.</span><span class="sxs-lookup"><span data-stu-id="1fca1-142">Stop a node.</span></span>
   
    <span data-ttu-id="1fca1-143">När en nod har stoppats hello Service Fabric flyttar alla hello service instanser eller partitioner som fanns på den noden tooone av andra tillgängliga noder i klustret hello.</span><span class="sxs-lookup"><span data-stu-id="1fca1-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="1fca1-144">Använd den här tootest en situation där en nod har förlorats från ditt kluster och alla instanser av tjänsten hello och repliker på noden har toomove.</span><span class="sxs-lookup"><span data-stu-id="1fca1-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="1fca1-145">Du kan stoppa en nod med hjälp av hello PowerShell **stoppa ServiceFabricNode** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="1fca1-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="1fca1-146">Underhåll tjänsttillgänglighet för</span><span class="sxs-lookup"><span data-stu-id="1fca1-146">Maintain service availability</span></span>
<span data-ttu-id="1fca1-147">Service Fabric är utformad tooprovide hög tillgänglighet för dina tjänster som en plattform.</span><span class="sxs-lookup"><span data-stu-id="1fca1-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="1fca1-148">Men i extrema fall underliggande infrastruktur kan fortfarande ha inte finns.</span><span class="sxs-lookup"><span data-stu-id="1fca1-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="1fca1-149">Det är viktigt tootest för dessa scenarier för.</span><span class="sxs-lookup"><span data-stu-id="1fca1-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="1fca1-150">Tillståndskänsliga tjänster använder ett kvorum-baserat system tooreplicate tillstånd för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="1fca1-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="1fca1-151">Det innebär att ett kvorum av repliker måste toobe tillgängliga tooperform skrivåtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fca1-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="1fca1-152">Ett kvorum av repliker kanske inte tillgänglig i sällsynta fall, till exempel ett omfattande maskinvarufel.</span><span class="sxs-lookup"><span data-stu-id="1fca1-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="1fca1-153">I dessa fall kan du inte kan tooperform skrivåtgärder, men du kommer fortfarande att kunna tooperform läsåtgärder.</span><span class="sxs-lookup"><span data-stu-id="1fca1-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="1fca1-154">Testa den: skriva åtgärden otillgänglighet</span><span class="sxs-lookup"><span data-stu-id="1fca1-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="1fca1-155">Med hello datatillgång i Service Fabric kan du mata in ett fel som startar förlorar kvorum som ett test.</span><span class="sxs-lookup"><span data-stu-id="1fca1-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="1fca1-156">Även om ett sådant scenario är sällsynt, är det viktigt att klienter och tjänster som är beroende av en tillståndskänslig service förberetts toohandle situationer där denne inte fatta skriva begäranden tooit.</span><span class="sxs-lookup"><span data-stu-id="1fca1-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="1fca1-157">Det är också viktigt att hello tillståndskänslig själva tjänsten känner till denna möjlighet och smidigt kommunicera den toocallers.</span><span class="sxs-lookup"><span data-stu-id="1fca1-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="1fca1-158">Du kan ge upphov till förlorar kvorum med hjälp av hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="1fca1-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="1fca1-159">I det här exemplet anger vi `QuorumLossMode` för`QuorumReplicas` tooindicate som vi vill tooinduce kvorumförlust utan att stoppa alla repliker.</span><span class="sxs-lookup"><span data-stu-id="1fca1-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="1fca1-160">Det här sättet läsåtgärder är fortfarande möjligt.</span><span class="sxs-lookup"><span data-stu-id="1fca1-160">This way, read operations are still possible.</span></span> <span data-ttu-id="1fca1-161">tootest ett scenario där en hel partition är tillgänglig, kan du ange den här växeln för`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="1fca1-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1fca1-162">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="1fca1-162">Next steps</span></span>
[<span data-ttu-id="1fca1-163">Mer information om datatillgång åtgärder</span><span class="sxs-lookup"><span data-stu-id="1fca1-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="1fca1-164">Mer information om möjlighet att testa scenarier</span><span class="sxs-lookup"><span data-stu-id="1fca1-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

