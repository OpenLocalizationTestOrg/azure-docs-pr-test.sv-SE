---
title: "Azure Service Fabric API Management översikt | Microsoft Docs"
description: "Den här artikeln är en introduktion till Azure API Management som en gateway till Service Fabric-program."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 96176149-69bb-4b06-a72e-ebbfea84454b
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/22/2017
ms.author: vturecek
ms.openlocfilehash: a3eedacac5efb53f82e46a56285713dece56ffe8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="service-fabric-with-azure-api-management-overview"></a><span data-ttu-id="52707-103">Service Fabric med översikt över Azure API Management</span><span class="sxs-lookup"><span data-stu-id="52707-103">Service Fabric with Azure API Management overview</span></span>

<span data-ttu-id="52707-104">Molnprogram måste vanligtvis en frontend-gateway att tillhandahålla en enda åtkomstpunkt för inkommande trafik för användare, enheter eller andra program.</span><span class="sxs-lookup"><span data-stu-id="52707-104">Cloud applications typically need a front-end gateway to provide a single point of ingress for users, devices, or other applications.</span></span> <span data-ttu-id="52707-105">I Service Fabric en gateway kan alla tillståndslösa tjänster som en [ASP.NET Core programmet](service-fabric-reliable-services-communication-aspnetcore.md), eller en annan tjänst som utformats för trafik ingång [Händelsehubbar](https://docs.microsoft.com/azure/event-hubs/), [IoT-hubb](https://docs.microsoft.com/azure/iot-hub/), eller [Azure API Management](https://docs.microsoft.com/azure/api-management/).</span><span class="sxs-lookup"><span data-stu-id="52707-105">In Service Fabric, a gateway can be any stateless service such as an [ASP.NET Core application](service-fabric-reliable-services-communication-aspnetcore.md), or another service designed for traffic ingress, such as [Event Hubs](https://docs.microsoft.com/azure/event-hubs/), [IoT Hub](https://docs.microsoft.com/azure/iot-hub/), or [Azure API Management](https://docs.microsoft.com/azure/api-management/).</span></span>

<span data-ttu-id="52707-106">Den här artikeln är en introduktion till Azure API Management som en gateway till Service Fabric-program.</span><span class="sxs-lookup"><span data-stu-id="52707-106">This article is an introduction to using Azure API Management as a gateway to your Service Fabric applications.</span></span> <span data-ttu-id="52707-107">API Management integreras direkt med Service Fabric, så att du kan publicera API: er med en omfattande uppsättning regler för routning till backend-Service Fabric-tjänster.</span><span class="sxs-lookup"><span data-stu-id="52707-107">API Management integrates directly with Service Fabric, allowing you to publish APIs with a rich set of routing rules to your back-end Service Fabric services.</span></span> 

## <a name="architecture"></a><span data-ttu-id="52707-108">Arkitektur</span><span class="sxs-lookup"><span data-stu-id="52707-108">Architecture</span></span>
<span data-ttu-id="52707-109">En gemensam Service Fabric-arkitektur använder en enda sida webbprogram som anropar HTTP backend-tjänster som exponerar HTTP APIs.</span><span class="sxs-lookup"><span data-stu-id="52707-109">A common Service Fabric architecture uses a single-page web application that makes HTTP calls to back-end services that expose HTTP APIs.</span></span> <span data-ttu-id="52707-110">Den [Service Fabric-igång exempelprogrammet](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started) visar ett exempel på den här arkitekturen.</span><span class="sxs-lookup"><span data-stu-id="52707-110">The [Service Fabric getting-started sample application](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started) shows an example of this architecture.</span></span>

<span data-ttu-id="52707-111">I det här scenariot fungerar en tillståndslös webbtjänst som gateway till Service Fabric-programmet.</span><span class="sxs-lookup"><span data-stu-id="52707-111">In this scenario, a stateless web service serves as the gateway into the Service Fabric application.</span></span> <span data-ttu-id="52707-112">Den här metoden kräver att skriva en webbtjänst som kan proxy HTTP-begäranden till backend-tjänster som visas i följande diagram:</span><span class="sxs-lookup"><span data-stu-id="52707-112">This approach requires you to write a web service that can proxy HTTP requests to back-end services, as shown in the following diagram:</span></span>

![Service Fabric med översikt över Azure API Management-topologi][sf-web-app-stateless-gateway]

<span data-ttu-id="52707-114">Eftersom program växer komplexitet, så gör gateways som måste presentera ett API framför myriad backend-tjänster.</span><span class="sxs-lookup"><span data-stu-id="52707-114">As applications grow in complexity, so do the gateways that must present an API in front of myriad back-end services.</span></span> <span data-ttu-id="52707-115">Azure API Management är utformat för att hantera komplexa API: er med regler för routning, åtkomstkontroll, hastighetsbegränsning, övervakning, loggning och svar cachelagring med minimalt arbete från din sida.</span><span class="sxs-lookup"><span data-stu-id="52707-115">Azure API Management is designed to handle complex APIs with routing rules, access control, rate limiting, monitoring, event logging, and response caching with minimal work on your part.</span></span> <span data-ttu-id="52707-116">Azure API Management har stöd för identifiering av Service Fabric-tjänst, partition upplösning och val av replik för att dirigera Intelligent begäranden direkt till backend-tjänster i Service Fabric så att du inte behöver skriva tillståndslös API-gatewayen.</span><span class="sxs-lookup"><span data-stu-id="52707-116">Azure API Management supports Service Fabric service discovery, partition resolution, and replica selection to intelligently route requests directly to back-end services in Service Fabric so you don't have to write your own stateless API gateway.</span></span> 

<span data-ttu-id="52707-117">I det här scenariot webben UI fortfarande hanteras via en webbtjänst när HTTP-API-anrop hanteras och dirigeras via Azure API Management som visas i följande diagram:</span><span class="sxs-lookup"><span data-stu-id="52707-117">In this scenario, the web UI is still served through a web service, while HTTP API calls are managed and routed through Azure API Management, as shown in the following diagram:</span></span>

![Service Fabric med översikt över Azure API Management-topologi][sf-apim-web-app]

## <a name="application-scenarios"></a><span data-ttu-id="52707-119">Programscenarier</span><span class="sxs-lookup"><span data-stu-id="52707-119">Application scenarios</span></span>

<span data-ttu-id="52707-120">Tjänster i Service Fabric kan vara tillståndslösa och tillståndskänsliga och de kan partitioneras med någon av tre scheman: singleton, int-64-intervall och namngivna.</span><span class="sxs-lookup"><span data-stu-id="52707-120">Services in Service Fabric may be either stateless or stateful, and they may be partitioned using one of three schemes: singleton, int-64 range, and named.</span></span> <span data-ttu-id="52707-121">Tjänsten slutpunktsmappning kräver identifierar en specifik partition för en specifik tjänst-instans.</span><span class="sxs-lookup"><span data-stu-id="52707-121">Service endpoint resolution requires identifying a specific partition of a specific service instance.</span></span> <span data-ttu-id="52707-122">Vid matchning av en slutpunkt av en tjänst, både service instansnamnet (till exempel `fabric:/myapp/myservice`) samt viss partition i tjänsten måste anges, med undantag för singleton-partitionen.</span><span class="sxs-lookup"><span data-stu-id="52707-122">When resolving an endpoint of a service, both the service instance name (for example, `fabric:/myapp/myservice`) as well as the specific partition of the service must be specified, except in the case of singleton partition.</span></span>

<span data-ttu-id="52707-123">Azure API Management kan användas med valfri kombination av tillståndslösa tjänster, tillståndskänsliga tjänster och eventuella partitioneringsschema.</span><span class="sxs-lookup"><span data-stu-id="52707-123">Azure API Management can be used with any combination of stateless services, stateful services, and any partitioning scheme.</span></span>

## <a name="send-traffic-to-a-stateless-service"></a><span data-ttu-id="52707-124">Skicka trafik till en tillståndslös tjänst</span><span class="sxs-lookup"><span data-stu-id="52707-124">Send traffic to a stateless service</span></span>

<span data-ttu-id="52707-125">I det enklaste fallet vidarebefordras trafik till en instans av tillståndslösa tjänsten.</span><span class="sxs-lookup"><span data-stu-id="52707-125">In the simplest case, traffic is forwarded to a stateless service instance.</span></span> <span data-ttu-id="52707-126">För att uppnå innehåller en API Management-åtgärd en princip för inkommande bearbetning med ett Service Fabric-backend som mappar till en specifik tillståndslös tjänstinstans i Service Fabric-backend.</span><span class="sxs-lookup"><span data-stu-id="52707-126">To achieve this, an API Management operation contains an inbound processing policy with a Service Fabric back-end that maps to a specific stateless service instance in the Service Fabric back-end.</span></span> <span data-ttu-id="52707-127">Förfrågningar som skickas till tjänsten skickas till en slumpmässig replik av tillståndslösa tjänstinstansen.</span><span class="sxs-lookup"><span data-stu-id="52707-127">Requests sent to that service are sent to a random replica of the stateless service instance.</span></span>

#### <a name="example"></a><span data-ttu-id="52707-128">Exempel</span><span class="sxs-lookup"><span data-stu-id="52707-128">Example</span></span>
<span data-ttu-id="52707-129">I följande scenario ett Service Fabric-program innehåller en tillståndslös med namnet `fabric:/app/fooservice`, som Exponerar en intern HTTP-API.</span><span class="sxs-lookup"><span data-stu-id="52707-129">In the following scenario, a Service Fabric application contains a stateless service named `fabric:/app/fooservice`, that exposes an internal HTTP API.</span></span> <span data-ttu-id="52707-130">Namnet på instansen är kända och kan vara hårdkodade direkt i principen för API Management inkommande bearbetning.</span><span class="sxs-lookup"><span data-stu-id="52707-130">The service instance name is well known and can be hard-coded directly in the API Management inbound processing policy.</span></span> 

![Service Fabric med översikt över Azure API Management-topologi][sf-apim-static-stateless]

## <a name="send-traffic-to-a-stateful-service"></a><span data-ttu-id="52707-132">Skicka trafik till en tillståndskänslig service</span><span class="sxs-lookup"><span data-stu-id="52707-132">Send traffic to a stateful service</span></span>

<span data-ttu-id="52707-133">Liknar tillståndslösa tjänsten scenario, trafik ska kunna vidarebefordras till en tillståndskänslig service-instans.</span><span class="sxs-lookup"><span data-stu-id="52707-133">Similar to the stateless service scenario, traffic can be forwarded to a stateful service instance.</span></span> <span data-ttu-id="52707-134">I det här fallet en API Management-åtgärd innehåller en princip för inkommande bearbetning med ett Service Fabric-backend som mappar en begäran till en specifik partition för en specifik *stateful* tjänstinstansen.</span><span class="sxs-lookup"><span data-stu-id="52707-134">In this case, an API Management operation contains an inbound processing policy with a Service Fabric back-end that maps a request to a specific partition of a specific *stateful* service instance.</span></span> <span data-ttu-id="52707-135">Partitionen att mappa varje begäran att beräknas via ett lambda-metod som använder indata från inkommande HTTP-begäran, till exempel ett värde i en URL-sökväg.</span><span class="sxs-lookup"><span data-stu-id="52707-135">The partition to map each request to is computed via a lambda method using some input from the incoming HTTP request, such as a value in the URL path.</span></span> <span data-ttu-id="52707-136">Principen kan konfigureras för att skicka begäranden till den primära repliken eller till en slumpmässig replik för läsåtgärder.</span><span class="sxs-lookup"><span data-stu-id="52707-136">The policy may be configured to send requests to the primary replica only, or to a random replica for read operations.</span></span>

#### <a name="example"></a><span data-ttu-id="52707-137">Exempel</span><span class="sxs-lookup"><span data-stu-id="52707-137">Example</span></span>

<span data-ttu-id="52707-138">I följande scenario ett Service Fabric-program innehåller en partitionerad tillståndskänslig med namnet `fabric:/app/userservice` som Exponerar en intern HTTP-API.</span><span class="sxs-lookup"><span data-stu-id="52707-138">In the following scenario, a Service Fabric application contains a partitioned stateful service named `fabric:/app/userservice` that exposes an internal HTTP API.</span></span> <span data-ttu-id="52707-139">Namnet på instansen är kända och kan vara hårdkodade direkt i principen för API Management inkommande bearbetning.</span><span class="sxs-lookup"><span data-stu-id="52707-139">The service instance name is well known and can be hard-coded directly in the API Management inbound processing policy.</span></span>  

<span data-ttu-id="52707-140">Tjänsten är partitionerad med två partitioner och en nyckel intervall som sträcker sig över Int64 partitionsschemat `Int64.MinValue` till `Int64.MaxValue`.</span><span class="sxs-lookup"><span data-stu-id="52707-140">The service is partitioned using the Int64 partition scheme with two partitions and a key range that spans `Int64.MinValue` to `Int64.MaxValue`.</span></span> <span data-ttu-id="52707-141">Backend-principen beräknar en partitionsnyckel inom det intervallet genom att konvertera den `id` värden som anges i URL-begäran-sökvägen till en 64-bitars heltal, även om en algoritm kan användas här för att beräkna Partitionsnyckeln.</span><span class="sxs-lookup"><span data-stu-id="52707-141">The back-end policy computes a partition key within that range by converting the `id` value provided in the URL request path to a 64-bit integer, although any algorithm can be used here to compute the partition key.</span></span> 

![Service Fabric med översikt över Azure API Management-topologi][sf-apim-static-stateful]

## <a name="send-traffic-to-multiple-stateless-services"></a><span data-ttu-id="52707-143">Skicka trafik till flera tillståndslösa tjänster</span><span class="sxs-lookup"><span data-stu-id="52707-143">Send traffic to multiple stateless services</span></span>

<span data-ttu-id="52707-144">Du kan definiera en API Management-åtgärd som mappar begäranden till mer än en tjänstinstans i mer avancerade scenarier.</span><span class="sxs-lookup"><span data-stu-id="52707-144">In more advanced scenarios, you can define an API Management operation that maps requests to more than one service instance.</span></span> <span data-ttu-id="52707-145">I det här fallet innehåller varje åtgärd en princip som mappar begäranden till en specifik tjänst instanser baserade på värden från den inkommande HTTP-begäranden, till exempel URL-sträng för sökväg eller fråga och för tillståndskänsliga tjänster, en partition i tjänstinstansen.</span><span class="sxs-lookup"><span data-stu-id="52707-145">In this case, each operation contains a policy that maps requests to a specific service instance based on values from the incoming HTTP request, such as the URL path or query string, and in the case of stateful services, a partition within the service instance.</span></span> 

<span data-ttu-id="52707-146">För att uppnå innehåller en API Management-åtgärd en princip för inkommande bearbetning med ett Service Fabric-backend som mappar till en instans av tillståndslösa tjänsten i Service Fabric serverdel baserat på värden som hämtats från den inkommande HTTP-begäranden.</span><span class="sxs-lookup"><span data-stu-id="52707-146">To achieve this, an API Management operation contains an inbound processing policy with a Service Fabric back-end that maps to a stateless service instance in the Service Fabric back-end based on values retrieved from the incoming HTTP request.</span></span> <span data-ttu-id="52707-147">Begäranden till en instans av tjänsten skickas till en slumpmässig replik av tjänstinstansen.</span><span class="sxs-lookup"><span data-stu-id="52707-147">Requests to a service instance are sent to a random replica of the service instance.</span></span>

#### <a name="example"></a><span data-ttu-id="52707-148">Exempel</span><span class="sxs-lookup"><span data-stu-id="52707-148">Example</span></span>

<span data-ttu-id="52707-149">I det här exemplet skapas en ny instans av tillståndslösa tjänsten för varje användare i ett program med ett dynamiskt genererat namn med hjälp av följande formel:</span><span class="sxs-lookup"><span data-stu-id="52707-149">In this example, a new stateless service instance is created for each user of an application with a dynamically generated name using the following formula:</span></span>
 
 - `fabric:/app/users/<username>`

 <span data-ttu-id="52707-150">Varje tjänst har ett unikt namn, men de är inte känt direkta eftersom tjänsterna skapas som svar på användaren eller administratören indata och därför kan inte vara hårdkodat i APIM principer eller regler för routning.</span><span class="sxs-lookup"><span data-stu-id="52707-150">Each service has a unique name, but the names are not known up-front because the services are created in response to user or admin input and thus cannot be hard-coded into APIM policies or routing rules.</span></span> <span data-ttu-id="52707-151">I stället namnet på den tjänst som du vill skicka en begäran skapas i backend-principdefinitionen från den `name` värden som anges i URL-begäran-sökväg.</span><span class="sxs-lookup"><span data-stu-id="52707-151">Instead, the name of the service to which to send a request is generated in the back-end policy definition from the `name` value provided in the URL request path.</span></span> <span data-ttu-id="52707-152">Exempel:</span><span class="sxs-lookup"><span data-stu-id="52707-152">For example:</span></span>

  - <span data-ttu-id="52707-153">En begäran om att `/api/users/foo` dirigeras till tjänstinstans`fabric:/app/users/foo`</span><span class="sxs-lookup"><span data-stu-id="52707-153">A request to `/api/users/foo` is routed to service instance `fabric:/app/users/foo`</span></span>
  - <span data-ttu-id="52707-154">En begäran om att `/api/users/bar` dirigeras till tjänstinstans`fabric:/app/users/bar`</span><span class="sxs-lookup"><span data-stu-id="52707-154">A request to `/api/users/bar` is routed to service instance `fabric:/app/users/bar`</span></span>

![Service Fabric med översikt över Azure API Management-topologi][sf-apim-dynamic-stateless]

## <a name="send-traffic-to-multiple-stateful-services"></a><span data-ttu-id="52707-156">Skicka trafik till flera tillståndskänsliga tjänster</span><span class="sxs-lookup"><span data-stu-id="52707-156">Send traffic to multiple stateful services</span></span>

<span data-ttu-id="52707-157">Liknar tillståndslösa tjänsten exempel, en API Management-åtgärd kan du mappa begäranden till fler än en **stateful** tjänsten instans kan då du även behöva utföra partition matchning för varje tillståndskänslig service-instans.</span><span class="sxs-lookup"><span data-stu-id="52707-157">Similar to the stateless service example, an API Management operation can map requests to more than one **stateful** service instance, in which case you also may need to perform partition resolution for each stateful service instance.</span></span>

<span data-ttu-id="52707-158">För att uppnå innehåller en API Management-åtgärd en princip för inkommande bearbetning med ett Service Fabric-backend som mappar till en tillståndskänslig service-instans i Service Fabric serverdel baserat på värden som hämtats från den inkommande HTTP-begäranden.</span><span class="sxs-lookup"><span data-stu-id="52707-158">To achieve this, an API Management operation contains an inbound processing policy with a Service Fabric back-end that maps to a stateful service instance in the Service Fabric back-end based on values retrieved from the incoming HTTP request.</span></span> <span data-ttu-id="52707-159">Förutom att mappa en begäran till specifika tjänstinstans, kan begäran också mappas till en specifik partition inom tjänstinstansen och eventuellt den primära repliken eller en slumpmässig sekundär replik i partitionen.</span><span class="sxs-lookup"><span data-stu-id="52707-159">In addition to mapping a request to specific service instance, the request can also be mapped to a specific partition within the service instance, and optionally to either the primary replica or a random secondary replica within the partition.</span></span>

#### <a name="example"></a><span data-ttu-id="52707-160">Exempel</span><span class="sxs-lookup"><span data-stu-id="52707-160">Example</span></span>

<span data-ttu-id="52707-161">I det här exemplet skapas en ny tillståndskänslig service-instans för varje användare av programmet med ett dynamiskt genererat namn med hjälp av följande formel:</span><span class="sxs-lookup"><span data-stu-id="52707-161">In this example, a new stateful service instance is created for each user of the application with a dynamically generated name using the following formula:</span></span>
 
 - `fabric:/app/users/<username>`

 <span data-ttu-id="52707-162">Varje tjänst har ett unikt namn, men de är inte känt direkta eftersom tjänsterna skapas som svar på användaren eller administratören indata och därför kan inte vara hårdkodat i APIM principer eller regler för routning.</span><span class="sxs-lookup"><span data-stu-id="52707-162">Each service has a unique name, but the names are not known up-front because the services are created in response to user or admin input and thus cannot be hard-coded into APIM policies or routing rules.</span></span> <span data-ttu-id="52707-163">I stället namnet på den tjänst som du vill skicka en begäran skapas i backend-principdefinitionen från den `name` värdet som en URL-sökväg för begäran.</span><span class="sxs-lookup"><span data-stu-id="52707-163">Instead, the name of the service to which to send a request is generated in the back-end policy definition from the `name` value provided the URL request path.</span></span> <span data-ttu-id="52707-164">Exempel:</span><span class="sxs-lookup"><span data-stu-id="52707-164">For example:</span></span>

  - <span data-ttu-id="52707-165">En begäran om att `/api/users/foo` dirigeras till tjänstinstans`fabric:/app/users/foo`</span><span class="sxs-lookup"><span data-stu-id="52707-165">A request to `/api/users/foo` is routed to service instance `fabric:/app/users/foo`</span></span>
  - <span data-ttu-id="52707-166">En begäran om att `/api/users/bar` dirigeras till tjänstinstans`fabric:/app/users/bar`</span><span class="sxs-lookup"><span data-stu-id="52707-166">A request to `/api/users/bar` is routed to service instance `fabric:/app/users/bar`</span></span>

<span data-ttu-id="52707-167">Varje tjänstinstans är också partitionerad använder Int64 partitionsschema med två partitioner och flera nycklar som omfattar `Int64.MinValue` till `Int64.MaxValue`.</span><span class="sxs-lookup"><span data-stu-id="52707-167">Each service instance is also partitioned using the Int64 partition scheme with two partitions and a key range that spans `Int64.MinValue` to `Int64.MaxValue`.</span></span> <span data-ttu-id="52707-168">Backend-principen beräknar en partitionsnyckel inom det intervallet genom att konvertera den `id` värden som anges i URL-begäran-sökvägen till en 64-bitars heltal, även om en algoritm kan användas här för att beräkna Partitionsnyckeln.</span><span class="sxs-lookup"><span data-stu-id="52707-168">The back-end policy computes a partition key within that range by converting the `id` value provided in the URL request path to a 64-bit integer, although any algorithm can be used here to compute the partition key.</span></span> 

![Service Fabric med översikt över Azure API Management-topologi][sf-apim-dynamic-stateful]

## <a name="next-steps"></a><span data-ttu-id="52707-170">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="52707-170">Next steps</span></span>

<span data-ttu-id="52707-171">Följ den [snabbstartsguiden](service-fabric-api-management-quick-start.md) att ställa in din första Service Fabric-kluster med API-hantering och flödar förfrågningar via API-hantering till dina tjänster.</span><span class="sxs-lookup"><span data-stu-id="52707-171">Follow the [quick start guide](service-fabric-api-management-quick-start.md) to set up your first Service Fabric cluster with API Management and flow requests through API Management to your services.</span></span>

<!-- links -->

<!-- pics -->
[sf-apim-web-app]: ./media/service-fabric-api-management-overview/sf-apim-web-app.png
[sf-web-app-stateless-gateway]: ./media/service-fabric-api-management-overview/sf-web-app-stateless-gateway.png
[sf-apim-static-stateless]: ./media/service-fabric-api-management-overview/sf-apim-static-stateless.png
[sf-apim-static-stateful]: ./media/service-fabric-api-management-overview/sf-apim-static-stateful.png
[sf-apim-dynamic-stateless]: ./media/service-fabric-api-management-overview/sf-apim-dynamic-stateless.png
[sf-apim-dynamic-stateful]: ./media/service-fabric-api-management-overview/sf-apim-dynamic-stateful.png