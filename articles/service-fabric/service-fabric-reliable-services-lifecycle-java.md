---
title: "aaaOverview av hello livscykeln för Azure Service Fabric Reliable Services | Microsoft Docs"
description: "Lär dig mer om hello livscykeln för olika händelser i Service Fabric reliable services"
services: Service-Fabric
documentationcenter: java
author: PavanKunapareddyMSFT
manager: timlt
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: java
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/30/2017
ms.author: pakunapa;
ms.openlocfilehash: 6d48c217d12bc5248c2da57b544aac747cecd872
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="95b9e-103">Översikt över livscykeln Reliable services</span><span class="sxs-lookup"><span data-stu-id="95b9e-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="95b9e-104">C# i Windows</span><span class="sxs-lookup"><span data-stu-id="95b9e-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="95b9e-105">Java i Linux</span><span class="sxs-lookup"><span data-stu-id="95b9e-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="95b9e-106">När du tänker hello livscykler för Reliable Services är hello grunderna i hello livscykel hello viktigaste.</span><span class="sxs-lookup"><span data-stu-id="95b9e-106">When thinking about hello lifecycles of Reliable Services, hello basics of hello lifecycle are hello most important.</span></span> <span data-ttu-id="95b9e-107">I allmänhet:</span><span class="sxs-lookup"><span data-stu-id="95b9e-107">In general:</span></span>

* <span data-ttu-id="95b9e-108">Under Start</span><span class="sxs-lookup"><span data-stu-id="95b9e-108">During Startup</span></span>
  * <span data-ttu-id="95b9e-109">Tjänster är uppbyggda</span><span class="sxs-lookup"><span data-stu-id="95b9e-109">Services are constructed</span></span>
  * <span data-ttu-id="95b9e-110">De har en möjlighet tooconstruct och returnera noll eller flera lyssnare</span><span class="sxs-lookup"><span data-stu-id="95b9e-110">They have an opportunity tooconstruct and return zero or more listeners</span></span>
  * <span data-ttu-id="95b9e-111">Alla returnerade lyssnare öppnas kommunikation med hello-tjänsten</span><span class="sxs-lookup"><span data-stu-id="95b9e-111">Any returned listeners are opened, allowing communication with hello service</span></span>
  * <span data-ttu-id="95b9e-112">hello Service runAsync-metoden anropas, så att hello service toodo tidskrävande eller bakgrund arbete</span><span class="sxs-lookup"><span data-stu-id="95b9e-112">hello Service's runAsync method is called, allowing hello service toodo long running or background work</span></span>
* <span data-ttu-id="95b9e-113">Vid avstängning</span><span class="sxs-lookup"><span data-stu-id="95b9e-113">During shutdown</span></span>
  * <span data-ttu-id="95b9e-114">hello annullering token skickade toorunAsync avbryts och hello-lyssnare har stängts</span><span class="sxs-lookup"><span data-stu-id="95b9e-114">hello cancellation token passed toorunAsync is canceled, and hello listeners are closed</span></span>
  * <span data-ttu-id="95b9e-115">När detta är klar, hello service själva objektet är destructed</span><span class="sxs-lookup"><span data-stu-id="95b9e-115">Once that is complete, hello service object itself is destructed</span></span>

<span data-ttu-id="95b9e-116">Det finns information kring hello exakt sorteringen av dessa händelser.</span><span class="sxs-lookup"><span data-stu-id="95b9e-116">There are details around hello exact ordering of these events.</span></span> <span data-ttu-id="95b9e-117">I synnerhet kan hello ordningen för händelser ändras lite beroende på om hello tillförlitlig tjänst är Stateless eller Stateful.</span><span class="sxs-lookup"><span data-stu-id="95b9e-117">In particular, hello order of events may change slightly depending on whether hello Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="95b9e-118">Dessutom för tillståndskänsliga tjänster har vi toodeal med hello primära växlingen scenario.</span><span class="sxs-lookup"><span data-stu-id="95b9e-118">In addition, for stateful services, we have toodeal with hello Primary swap scenario.</span></span> <span data-ttu-id="95b9e-119">Under den här sekvensen hello rollen som primär är överförda tooanother replik (eller kommer tillbaka) utan hello-tjänsten avslutas.</span><span class="sxs-lookup"><span data-stu-id="95b9e-119">During this sequence, hello role of Primary is transferred tooanother replica (or comes back) without hello service shutting down.</span></span> <span data-ttu-id="95b9e-120">Slutligen har vi toothink om felet villkor.</span><span class="sxs-lookup"><span data-stu-id="95b9e-120">Finally, we have toothink about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="95b9e-121">Tillståndslösa tjänsten startades</span><span class="sxs-lookup"><span data-stu-id="95b9e-121">Stateless service startup</span></span>
<span data-ttu-id="95b9e-122">hello livscykeln för tillståndslösa tjänsten är ganska enkelt.</span><span class="sxs-lookup"><span data-stu-id="95b9e-122">hello lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="95b9e-123">Här är hello efter händelser:</span><span class="sxs-lookup"><span data-stu-id="95b9e-123">Here's hello order of events:</span></span>

1. <span data-ttu-id="95b9e-124">hello har tjänsten skapats</span><span class="sxs-lookup"><span data-stu-id="95b9e-124">hello Service is constructed</span></span>
2. <span data-ttu-id="95b9e-125">Görs sedan i parallella två saker:</span><span class="sxs-lookup"><span data-stu-id="95b9e-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="95b9e-126">`StatelessService.createServiceInstanceListeners()`har anropats och eventuella returnerade lyssnare öppnas (`CommunicationListener.openAsync()` anropas på varje lyssnare)</span><span class="sxs-lookup"><span data-stu-id="95b9e-126">`StatelessService.createServiceInstanceListeners()` is invoked and any returned listeners are Opened (`CommunicationListener.openAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="95b9e-127">Hej tjänstens runAsync metod (`StatelessService.runAsync()`) anropas</span><span class="sxs-lookup"><span data-stu-id="95b9e-127">hello service's runAsync method (`StatelessService.runAsync()`) is called</span></span>
3. <span data-ttu-id="95b9e-128">Om den finns hello tjänstens egna onOpenAsync metoden anropas (särskilt `StatelessService.onOpenAsync()` anropas.</span><span class="sxs-lookup"><span data-stu-id="95b9e-128">If present, hello service's own onOpenAsync method is called (Specifically, `StatelessService.onOpenAsync()` is called.</span></span> <span data-ttu-id="95b9e-129">Det här är en ovanligt åsidosättning men det är tillgängligt).</span><span class="sxs-lookup"><span data-stu-id="95b9e-129">This is an uncommon override but it is available).</span></span>

<span data-ttu-id="95b9e-130">Det är viktigt toonote att det finns ingen ordning mellan hello anrop toocreate och öppna hello-lyssnare och runAsync.</span><span class="sxs-lookup"><span data-stu-id="95b9e-130">It is important toonote that there is no ordering between hello calls toocreate and open hello listeners and runAsync.</span></span> <span data-ttu-id="95b9e-131">hello lyssnare kan öppna innan runAsync har startats.</span><span class="sxs-lookup"><span data-stu-id="95b9e-131">hello listeners may open before runAsync is started.</span></span> <span data-ttu-id="95b9e-132">På liknande sätt kan runAsync hamna anropas innan hello kommunikationslyssnarna är öppna eller även har skapats.</span><span class="sxs-lookup"><span data-stu-id="95b9e-132">Similarly, runAsync may end up invoked before hello communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="95b9e-133">Om ingen synkronisering krävs lämnas den som en övning toohello implementerare.</span><span class="sxs-lookup"><span data-stu-id="95b9e-133">If any synchronization is required, it is left as an exercise toohello implementer.</span></span> <span data-ttu-id="95b9e-134">Vanliga lösningar:</span><span class="sxs-lookup"><span data-stu-id="95b9e-134">Common solutions:</span></span>

* <span data-ttu-id="95b9e-135">Lyssnare fungerar ibland inte förrän annan information som har skapats eller arbete som gjorts.</span><span class="sxs-lookup"><span data-stu-id="95b9e-135">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="95b9e-136">För tillståndslösa tjänster som arbete kan vanligtvis utföras i hello service konstruktorn under hello `createServiceInstanceListeners()` anropar, eller som en del av hello konstruktionen av hello listener sig själv.</span><span class="sxs-lookup"><span data-stu-id="95b9e-136">For stateless services that work can usually be done in hello service's constructor, during hello `createServiceInstanceListeners()` call, or as a part of hello construction of hello listener itself.</span></span>
* <span data-ttu-id="95b9e-137">Ibland vill hello koden i runAsync inte toostart tills hello lyssnare är öppna.</span><span class="sxs-lookup"><span data-stu-id="95b9e-137">Sometimes hello code in runAsync does not want toostart until hello listeners are open.</span></span> <span data-ttu-id="95b9e-138">I så fall krävs ytterligare samordning.</span><span class="sxs-lookup"><span data-stu-id="95b9e-138">In this case additional coordination is necessary.</span></span> <span data-ttu-id="95b9e-139">En vanlig lösning är vissa flagga i hello lyssnare som anger när de har slutfört, som är markerad i runAsync innan du fortsätter tooactual arbete.</span><span class="sxs-lookup"><span data-stu-id="95b9e-139">One common solution is some flag within hello listeners indicating when they have completed, which is checked in runAsync before continuing tooactual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="95b9e-140">Tillståndslösa tjänsten avstängning</span><span class="sxs-lookup"><span data-stu-id="95b9e-140">Stateless service shutdown</span></span>
<span data-ttu-id="95b9e-141">När du stänger en tillståndslös tjänst hello samma mönster följs bara i omvänd:</span><span class="sxs-lookup"><span data-stu-id="95b9e-141">When shutting down a stateless service, hello same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="95b9e-142">Parallellt</span><span class="sxs-lookup"><span data-stu-id="95b9e-142">In parallel</span></span>
    - <span data-ttu-id="95b9e-143">Stängs alla öppna lyssnare (`CommunicationListener.closeAsync()` anropas på varje lyssnare)</span><span class="sxs-lookup"><span data-stu-id="95b9e-143">Any open listeners are Closed (`CommunicationListener.closeAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="95b9e-144">hello annullering token som skickades för`runAsync()` avbryts (kontrollerar hello annullering token `isCancelled` -egenskap returnerar true, och om den anropas hello token `throwIfCancellationRequested` metoden returnerar en `CancellationException`)</span><span class="sxs-lookup"><span data-stu-id="95b9e-144">hello cancellation token passed too`runAsync()` is canceled (checking hello cancellation token's `isCancelled` property returns true, and if called hello token's `throwIfCancellationRequested` method throws a `CancellationException`)</span></span>
2. <span data-ttu-id="95b9e-145">En gång `closeAsync()` har slutförts på varje lyssnare och `runAsync()` också har slutförts hello service `StatelessService.onCloseAsync()` metoden anropas, om det finns (igen det här är en ovanligt åsidosättning).</span><span class="sxs-lookup"><span data-stu-id="95b9e-145">Once `closeAsync()` completes on each listener and `runAsync()` also completes, hello service's `StatelessService.onCloseAsync()` method is called, if present (again this is an uncommon override).</span></span>
3. <span data-ttu-id="95b9e-146">När `StatelessService.onCloseAsync()` är klar hello webbtjänstobjektet destructed</span><span class="sxs-lookup"><span data-stu-id="95b9e-146">After `StatelessService.onCloseAsync()` completes, hello service object is destructed</span></span>

## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="95b9e-147">Information om tjänsten livscykel</span><span class="sxs-lookup"><span data-stu-id="95b9e-147">Notes on service lifecycle</span></span>
* <span data-ttu-id="95b9e-148">Båda hello `runAsync()` metod och hello `createServiceInstanceListeners` anrop är valfria.</span><span class="sxs-lookup"><span data-stu-id="95b9e-148">Both hello `runAsync()` method and hello `createServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="95b9e-149">En tjänst kan ha ett av dem, båda eller inget.</span><span class="sxs-lookup"><span data-stu-id="95b9e-149">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="95b9e-150">Till exempel om hello tjänsten gör allt arbete i svaret toouser anrop, det behövs ingen för den tooimplement `runAsync()`.</span><span class="sxs-lookup"><span data-stu-id="95b9e-150">For example, if hello service does all its work in response toouser calls, there is no need for it tooimplement `runAsync()`.</span></span> <span data-ttu-id="95b9e-151">Endast hello kommunikationslyssnarna och deras associerade kod krävs.</span><span class="sxs-lookup"><span data-stu-id="95b9e-151">Only hello communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="95b9e-152">På liknande sätt att skapa och returnera kommunikationslyssnarna är valfritt, eftersom hello service kanske bara bakgrunden fungerar toodo och så att endast måste tooimplement`runAsync()`</span><span class="sxs-lookup"><span data-stu-id="95b9e-152">Similarly, creating and returning communication listeners is optional, as hello service may have only background work toodo, and so only needs tooimplement `runAsync()`</span></span>
* <span data-ttu-id="95b9e-153">Det är giltigt för en tjänst toocomplete `runAsync()` har och RETUR från den.</span><span class="sxs-lookup"><span data-stu-id="95b9e-153">It is valid for a service toocomplete `runAsync()` successfully and return from it.</span></span> <span data-ttu-id="95b9e-154">Detta anses inte vara ett fel inträffar och representerar hello bakgrundsjobbet hello service slutföra.</span><span class="sxs-lookup"><span data-stu-id="95b9e-154">This is not considered a failure condition and would represent hello background work of hello service completing.</span></span> <span data-ttu-id="95b9e-155">För tillståndskänsliga reliable services `runAsync()` skulle anropas igen om hello tjänsten degraderades från primära och upphöja tillbaka tooprimary.</span><span class="sxs-lookup"><span data-stu-id="95b9e-155">For stateful reliable services `runAsync()` would be called again if hello service were demoted from primary and then promoted back tooprimary.</span></span>
* <span data-ttu-id="95b9e-156">Om en tjänst avslutas från `runAsync()` genom att vissa oväntade undantag, detta är ett fel och hello serviceobjektet är avstängd och ett hälsotillstånd fel rapporteras.</span><span class="sxs-lookup"><span data-stu-id="95b9e-156">If a service exits from `runAsync()` by throwing some unexpected exception, this is a failure and hello service object is shut down and a health error reported.</span></span>
* <span data-ttu-id="95b9e-157">När det finns ingen tidsgräns på returneras från dessa metoder kan du att förlora omedelbart hello möjlighet toowrite och därför slutföra inte något verkligt arbete.</span><span class="sxs-lookup"><span data-stu-id="95b9e-157">While there is no time limit on returning from these methods, you immediately lose hello ability toowrite and therefore cannot complete any real work.</span></span> <span data-ttu-id="95b9e-158">Vi rekommenderar att du returnera så snabbt som möjligt när hello annullering begäran tas emot.</span><span class="sxs-lookup"><span data-stu-id="95b9e-158">It is recommended that you return as quickly as possible upon receiving hello cancellation request.</span></span> <span data-ttu-id="95b9e-159">Om tjänsten inte svarar toothese API-anrop inom en rimlig tid Service Fabric kan framtvinga stänga av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="95b9e-159">If your service does not respond toothese API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="95b9e-160">Vanligtvis sker detta endast under programuppgraderingar eller när en tjänst tas bort.</span><span class="sxs-lookup"><span data-stu-id="95b9e-160">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="95b9e-161">Det här är 15 minuter som standard.</span><span class="sxs-lookup"><span data-stu-id="95b9e-161">This timeout is 15 minutes by default.</span></span>
* <span data-ttu-id="95b9e-162">Fel i hello `onCloseAsync()` sökväg resultatet i `onAbort()` anropas som är ett sista chansen bästa möjlighet för hello tjänsten tooclean upp och frigör alla resurser som de har begärts.</span><span class="sxs-lookup"><span data-stu-id="95b9e-162">Failures in hello `onCloseAsync()` path result in `onAbort()` being called which is a last-chance best-effort opportunity for hello service tooclean up and release any resources that they have claimed.</span></span>

> [!NOTE]
> <span data-ttu-id="95b9e-163">Tillståndskänsliga reliable services stöds inte i java ännu.</span><span class="sxs-lookup"><span data-stu-id="95b9e-163">Stateful reliable services are not supported in java yet.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="95b9e-164">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="95b9e-164">Next steps</span></span>
* [<span data-ttu-id="95b9e-165">Introduktion tooReliable tjänster</span><span class="sxs-lookup"><span data-stu-id="95b9e-165">Introduction tooReliable Services</span></span>](service-fabric-reliable-services-introduction.md)
* [<span data-ttu-id="95b9e-166">Snabbstart för Reliable Services</span><span class="sxs-lookup"><span data-stu-id="95b9e-166">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
* [<span data-ttu-id="95b9e-167">Reliable Services avancerade användning</span><span class="sxs-lookup"><span data-stu-id="95b9e-167">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
