---
title: "Hantera Azure mikrotjänster belastningen med hjälp av mätvärden | Microsoft Docs"
description: "Lär dig mer om hur du konfigurerar och använder mått i Service Fabric för att hantera tjänsten resursförbrukning."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 0d622ea6-a7c7-4bef-886b-06e6b85a97fb
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7e020bb6c02c80127e4225ba695017dff9b5a168
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="managing-resource-consumption-and-load-in-service-fabric-with-metrics"></a><span data-ttu-id="3f953-103">Hantera resursförbrukning och belastningen i Service Fabric med</span><span class="sxs-lookup"><span data-stu-id="3f953-103">Managing resource consumption and load in Service Fabric with metrics</span></span>
<span data-ttu-id="3f953-104">*Mått* är de resurser som din dig för tjänster och som tillhandahålls av noder i klustret.</span><span class="sxs-lookup"><span data-stu-id="3f953-104">*Metrics* are the resources that your services care about and which are provided by the nodes in the cluster.</span></span> <span data-ttu-id="3f953-105">Ett mått är något som du vill hantera för att förbättra eller övervaka prestanda för dina tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-105">A metric is anything that you want to manage in order to improve or monitor the performance of your services.</span></span> <span data-ttu-id="3f953-106">Exempelvis kan du titta på minnesförbrukning om du vill veta om din tjänst är överbelastad.</span><span class="sxs-lookup"><span data-stu-id="3f953-106">For example, you might watch memory consumption to know if your service is overloaded.</span></span> <span data-ttu-id="3f953-107">Ett annat syfte är att ta reda på om tjänsten kan flytta någon annanstans där minne är mindre begränsad för att få bättre prestanda.</span><span class="sxs-lookup"><span data-stu-id="3f953-107">Another use is to figure out whether the service could move elsewhere where memory is less constrained in order to get better performance.</span></span>

<span data-ttu-id="3f953-108">Till exempel minne, Disk och CPU-användning är exempel på mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-108">Things like Memory, Disk, and CPU usage are examples of metrics.</span></span> <span data-ttu-id="3f953-109">De här måtten är fysiska statistik, och resurser som motsvarar fysiska resurser på den nod som måste hanteras.</span><span class="sxs-lookup"><span data-stu-id="3f953-109">These metrics are physical metrics, resources that correspond to physical resources on the node that need to be managed.</span></span> <span data-ttu-id="3f953-110">Mått kan också vara (och ofta är) logiska mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-110">Metrics can also be (and commonly are) logical metrics.</span></span> <span data-ttu-id="3f953-111">Logisk är till exempel ”MyWorkQueueDepth” eller ”MessagesToProcess” eller ”TotalRecords”.</span><span class="sxs-lookup"><span data-stu-id="3f953-111">Logical metrics are things like “MyWorkQueueDepth” or "MessagesToProcess" or "TotalRecords".</span></span> <span data-ttu-id="3f953-112">Logiska mått är programdefinierade och motsvarar indirekt vissa fysiska resursförbrukning.</span><span class="sxs-lookup"><span data-stu-id="3f953-112">Logical metrics are application-defined and indirectly correspond to some physical resource consumption.</span></span> <span data-ttu-id="3f953-113">Logiska mått är vanliga eftersom det kan vara svårt att mått och rapportera förbrukning av fysiska resurser för per tjänst.</span><span class="sxs-lookup"><span data-stu-id="3f953-113">Logical metrics are common because it can be hard to measure and report consumption of physical resources on a per-service basis.</span></span> <span data-ttu-id="3f953-114">Komplexitet mäta och rapportera egna fysiska mått är också varför Service Fabric innehåller vissa siffror som standard.</span><span class="sxs-lookup"><span data-stu-id="3f953-114">The complexity of measuring and reporting your own physical metrics is also why Service Fabric provides some default metrics.</span></span>

## <a name="default-metrics"></a><span data-ttu-id="3f953-115">Standard-mått</span><span class="sxs-lookup"><span data-stu-id="3f953-115">Default metrics</span></span>
<span data-ttu-id="3f953-116">Anta att du vill börja skriva och distribuera din tjänst.</span><span class="sxs-lookup"><span data-stu-id="3f953-116">Let’s say that you want to get started writing and deploying your service.</span></span> <span data-ttu-id="3f953-117">Nu vet du inte vilka fysiska eller logiska resurser som den förbrukar.</span><span class="sxs-lookup"><span data-stu-id="3f953-117">At this point you don’t know what physical or logical resources it consumes.</span></span> <span data-ttu-id="3f953-118">Det är bra!</span><span class="sxs-lookup"><span data-stu-id="3f953-118">That’s fine!</span></span> <span data-ttu-id="3f953-119">Resurshanteraren för Service Fabric klustret använder vissa standard mått när inga andra mått har angetts.</span><span class="sxs-lookup"><span data-stu-id="3f953-119">The Service Fabric Cluster Resource Manager uses some default metrics when no other metrics are specified.</span></span> <span data-ttu-id="3f953-120">De är:</span><span class="sxs-lookup"><span data-stu-id="3f953-120">They are:</span></span>

  - <span data-ttu-id="3f953-121">PrimaryCount - antal primära repliker på noden</span><span class="sxs-lookup"><span data-stu-id="3f953-121">PrimaryCount - count of Primary replicas on the node</span></span> 
  - <span data-ttu-id="3f953-122">ReplicaCount - antal totala tillståndskänslig repliker på noden</span><span class="sxs-lookup"><span data-stu-id="3f953-122">ReplicaCount - count of total stateful replicas on the node</span></span>
  - <span data-ttu-id="3f953-123">Antal - antalet för alla service-objekt (tillståndslösa och tillståndskänsliga) på noden</span><span class="sxs-lookup"><span data-stu-id="3f953-123">Count - count of all service objects (stateless and stateful) on the node</span></span>

| <span data-ttu-id="3f953-124">Mått</span><span class="sxs-lookup"><span data-stu-id="3f953-124">Metric</span></span> | <span data-ttu-id="3f953-125">Läs in tillståndslös instans</span><span class="sxs-lookup"><span data-stu-id="3f953-125">Stateless Instance Load</span></span> | <span data-ttu-id="3f953-126">Tillståndskänsliga sekundära belastning</span><span class="sxs-lookup"><span data-stu-id="3f953-126">Stateful Secondary Load</span></span> | <span data-ttu-id="3f953-127">Tillståndskänsliga primära belastning</span><span class="sxs-lookup"><span data-stu-id="3f953-127">Stateful Primary Load</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="3f953-128">PrimaryCount</span><span class="sxs-lookup"><span data-stu-id="3f953-128">PrimaryCount</span></span> |<span data-ttu-id="3f953-129">0</span><span class="sxs-lookup"><span data-stu-id="3f953-129">0</span></span> |<span data-ttu-id="3f953-130">0</span><span class="sxs-lookup"><span data-stu-id="3f953-130">0</span></span> |<span data-ttu-id="3f953-131">1</span><span class="sxs-lookup"><span data-stu-id="3f953-131">1</span></span> |
| <span data-ttu-id="3f953-132">ReplicaCount</span><span class="sxs-lookup"><span data-stu-id="3f953-132">ReplicaCount</span></span> |<span data-ttu-id="3f953-133">0</span><span class="sxs-lookup"><span data-stu-id="3f953-133">0</span></span> |<span data-ttu-id="3f953-134">1</span><span class="sxs-lookup"><span data-stu-id="3f953-134">1</span></span> |<span data-ttu-id="3f953-135">1</span><span class="sxs-lookup"><span data-stu-id="3f953-135">1</span></span> |
| <span data-ttu-id="3f953-136">Antal</span><span class="sxs-lookup"><span data-stu-id="3f953-136">Count</span></span> |<span data-ttu-id="3f953-137">1</span><span class="sxs-lookup"><span data-stu-id="3f953-137">1</span></span> |<span data-ttu-id="3f953-138">1</span><span class="sxs-lookup"><span data-stu-id="3f953-138">1</span></span> |<span data-ttu-id="3f953-139">1</span><span class="sxs-lookup"><span data-stu-id="3f953-139">1</span></span> |

<span data-ttu-id="3f953-140">För grundläggande arbetsbelastningar anger mätvärdena som standard en hyfsad fördelning av arbete i klustret.</span><span class="sxs-lookup"><span data-stu-id="3f953-140">For basic workloads, the default metrics provide a decent distribution of work in the cluster.</span></span> <span data-ttu-id="3f953-141">I följande exempel, låt oss se vad som händer när vi skapar två tjänster och förlitar sig på standard-mätvärden för belastningsutjämning.</span><span class="sxs-lookup"><span data-stu-id="3f953-141">In the following example, let’s see what happens when we create two services and rely on the default metrics for balancing.</span></span> <span data-ttu-id="3f953-142">Den första tjänsten är en tillståndskänslig service med tre partitioner och ett mål replikuppsättningen storleken på tre.</span><span class="sxs-lookup"><span data-stu-id="3f953-142">The first service is a stateful service with three partitions and a target replica set size of three.</span></span> <span data-ttu-id="3f953-143">Andra tjänsten är en tillståndslös tjänst med en partition och instansantal av tre.</span><span class="sxs-lookup"><span data-stu-id="3f953-143">The second service is a stateless service with one partition and an instance count of three.</span></span>

<span data-ttu-id="3f953-144">Här är vad du får:</span><span class="sxs-lookup"><span data-stu-id="3f953-144">Here's what you get:</span></span>

<span data-ttu-id="3f953-145"><center>
![Klustret Layout med standard-mått][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="3f953-145"><center>
![Cluster Layout with Default Metrics][Image1]
</center></span></span>

<span data-ttu-id="3f953-146">Några saker att Observera:</span><span class="sxs-lookup"><span data-stu-id="3f953-146">Some things to note:</span></span>
  - <span data-ttu-id="3f953-147">Primära repliker för tjänsten tillståndskänslig distribueras över flera noder</span><span class="sxs-lookup"><span data-stu-id="3f953-147">Primary replicas for the stateful service are distributed across several nodes</span></span>
  - <span data-ttu-id="3f953-148">Repliker för samma partition som finns på olika noder</span><span class="sxs-lookup"><span data-stu-id="3f953-148">Replicas for the same partition are on different nodes</span></span>
  - <span data-ttu-id="3f953-149">Det totala antalet primärfärgerna och sekundärservrar distribueras i klustret</span><span class="sxs-lookup"><span data-stu-id="3f953-149">The total number of primaries and secondaries is distributed in the cluster</span></span>
  - <span data-ttu-id="3f953-150">Det totala antalet tjänstobjekt fördelas jämnt på varje nod</span><span class="sxs-lookup"><span data-stu-id="3f953-150">The total number of service objects are evenly allocated on each node</span></span>

<span data-ttu-id="3f953-151">Bra!</span><span class="sxs-lookup"><span data-stu-id="3f953-151">Good!</span></span>

<span data-ttu-id="3f953-152">Standard-mått fungera utmärkt som en start.</span><span class="sxs-lookup"><span data-stu-id="3f953-152">The default metrics work great as a start.</span></span> <span data-ttu-id="3f953-153">Men hanterar mätvärdena som standard endast du hittills.</span><span class="sxs-lookup"><span data-stu-id="3f953-153">However, the default metrics will only carry you so far.</span></span> <span data-ttu-id="3f953-154">Till exempel: Vad är sannolikheten för att partitionering schemat du plockats resultat i perfekt även användning av alla partitioner?</span><span class="sxs-lookup"><span data-stu-id="3f953-154">For example: What's the likelihood that the partitioning scheme you picked results in perfectly even utilization by all partitions?</span></span> <span data-ttu-id="3f953-155">Vad har du möjlighet att belastningen för en viss tjänst är konstant över tid eller ens över flera partitioner på samma sätt just nu?</span><span class="sxs-lookup"><span data-stu-id="3f953-155">What’s the chance that the load for a given service is constant over time, or even just the same across multiple partitions right now?</span></span>

<span data-ttu-id="3f953-156">Du kan köra med bara mätvärdena som standard.</span><span class="sxs-lookup"><span data-stu-id="3f953-156">You could run with just the default metrics.</span></span> <span data-ttu-id="3f953-157">Men om du gör det vanligtvis innebär att din klusteranvändning lägre och mer ojämn än du vill.</span><span class="sxs-lookup"><span data-stu-id="3f953-157">However, doing so usually means that your cluster utilization is lower and more uneven than you’d like.</span></span> <span data-ttu-id="3f953-158">Detta beror på att mätvärdena som standard inte anpassningsbar och förutsätter att allt är likvärdiga.</span><span class="sxs-lookup"><span data-stu-id="3f953-158">This is because the default metrics aren't adaptive and presume everything is equivalent.</span></span> <span data-ttu-id="3f953-159">Till exempel bidra en primär är upptagen och ett som inte är båda ”1” till PrimaryCount måttet.</span><span class="sxs-lookup"><span data-stu-id="3f953-159">For example, a Primary that is busy and one that is not both contribute "1" to the PrimaryCount metric.</span></span> <span data-ttu-id="3f953-160">I värsta fall kan med bara mätvärdena som standard också resultera i overscheduled noder, vilket resulterar i prestandaproblem.</span><span class="sxs-lookup"><span data-stu-id="3f953-160">In the worst case, using only the default metrics can also result in overscheduled nodes resulting in performance issues.</span></span> <span data-ttu-id="3f953-161">Om du är intresserad av att mest av klustret och undvika prestandaproblem måste du använda anpassade mått och dynamisk rapportering.</span><span class="sxs-lookup"><span data-stu-id="3f953-161">If you're interested in getting the most out of your cluster and avoiding performance issues, you need to use custom metrics and dynamic load reporting.</span></span>

## <a name="custom-metrics"></a><span data-ttu-id="3f953-162">Anpassade mått</span><span class="sxs-lookup"><span data-stu-id="3f953-162">Custom metrics</span></span>
<span data-ttu-id="3f953-163">Mått är konfigurerade på grundval av per med namnet-service-instans när du skapar tjänsten.</span><span class="sxs-lookup"><span data-stu-id="3f953-163">Metrics are configured on a per-named-service-instance basis when you’re creating the service.</span></span>

<span data-ttu-id="3f953-164">Alla mått har vissa egenskaper som beskriver den: ett namn, en vikt och en standard-belastning.</span><span class="sxs-lookup"><span data-stu-id="3f953-164">Any metric has some properties that describe it: a name, a weight, and a default load.</span></span>

* <span data-ttu-id="3f953-165">Måttnamnet: Namnet på måttet.</span><span class="sxs-lookup"><span data-stu-id="3f953-165">Metric Name: The name of the metric.</span></span> <span data-ttu-id="3f953-166">Måttnamnet är en unik identifierare för måttet inom klustret ur med Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="3f953-166">The metric name is a unique identifier for the metric within the cluster from the Resource Manager’s perspective.</span></span>
* <span data-ttu-id="3f953-167">Vikt: Tjänstmåttets vikt definierar hur viktigt det här måttet är i förhållande till andra mått för den här tjänsten.</span><span class="sxs-lookup"><span data-stu-id="3f953-167">Weight: Metric weight defines how important this metric is relative to the other metrics for this service.</span></span>
* <span data-ttu-id="3f953-168">Standard-belastning: Standard belastningen representeras på olika sätt beroende på om tjänsten är tillståndslösa och tillståndskänsliga.</span><span class="sxs-lookup"><span data-stu-id="3f953-168">Default Load: The default load is represented differently depending on whether the service is stateless or stateful.</span></span>
  * <span data-ttu-id="3f953-169">För tillståndslösa tjänster har varje mått en egenskap med namnet DefaultLoad</span><span class="sxs-lookup"><span data-stu-id="3f953-169">For stateless services, each metric has a single property named DefaultLoad</span></span>
  * <span data-ttu-id="3f953-170">För tillståndskänsliga tjänster ange du:</span><span class="sxs-lookup"><span data-stu-id="3f953-170">For stateful services you define:</span></span>
    * <span data-ttu-id="3f953-171">PrimaryDefaultLoad: Det här måttet standardmängden tjänsten förbrukar när det är en primär</span><span class="sxs-lookup"><span data-stu-id="3f953-171">PrimaryDefaultLoad: The default amount of this metric this service consumes when it is a Primary</span></span>
    * <span data-ttu-id="3f953-172">SecondaryDefaultLoad: Det här måttet standardmängden tjänsten förbrukar när det är en sekundär</span><span class="sxs-lookup"><span data-stu-id="3f953-172">SecondaryDefaultLoad: The default amount of this metric this service consumes when it is a Secondary</span></span>

> [!NOTE]
> <span data-ttu-id="3f953-173">Om du definiera anpassade mått och du vill _också_ använda mätvärdena som standard måste du _explicit_ lägga till mätvärdena som standard tillbaka och definiera vikterna och värden för dessa.</span><span class="sxs-lookup"><span data-stu-id="3f953-173">If you define custom metrics and you want to _also_ use the default metrics, you need to _explicitly_ add the default metrics back and define weights and values for them.</span></span> <span data-ttu-id="3f953-174">Det beror på att du måste definiera relationen mellan mätvärdena som är standard och din anpassade mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-174">This is because you must define the relationship between the default metrics and your custom metrics.</span></span> <span data-ttu-id="3f953-175">Till exempel kanske du bryr dig om ConnectionCount eller WorkQueueDepth mer än primära distributionsplatser.</span><span class="sxs-lookup"><span data-stu-id="3f953-175">For example, maybe you care about ConnectionCount or WorkQueueDepth more than Primary distribution.</span></span> <span data-ttu-id="3f953-176">Som standard är vikten av måttet PrimaryCount hög, så att du vill minska till mellan när du lägger till dina andra mått så de högre prioritet.</span><span class="sxs-lookup"><span data-stu-id="3f953-176">By default the weight of the PrimaryCount metric is High, so you want to reduce it to Medium when you add your other metrics to ensure they take precedence.</span></span>
>

### <a name="defining-metrics-for-your-service---an-example"></a><span data-ttu-id="3f953-177">Definiera mått för din tjänst - exempel</span><span class="sxs-lookup"><span data-stu-id="3f953-177">Defining metrics for your service - an example</span></span>
<span data-ttu-id="3f953-178">Anta att du vill konfigurera följande:</span><span class="sxs-lookup"><span data-stu-id="3f953-178">Let’s say you want the following configuration:</span></span>

  - <span data-ttu-id="3f953-179">Tjänsten rapporterar ett mått med namnet ”ConnectionCount”</span><span class="sxs-lookup"><span data-stu-id="3f953-179">Your service reports a metric named "ConnectionCount”</span></span>
  - <span data-ttu-id="3f953-180">Du vill använda standard-mått</span><span class="sxs-lookup"><span data-stu-id="3f953-180">You also want to use the default metrics</span></span> 
  - <span data-ttu-id="3f953-181">Du har gjort vissa mått och vet att en primär replik av den tjänsten tar normalt 20 enheter ”ConnectionCount”</span><span class="sxs-lookup"><span data-stu-id="3f953-181">You’ve done some measurements and know that normally a Primary replica of that service takes up 20 units of "ConnectionCount"</span></span>
  - <span data-ttu-id="3f953-182">Sekundärservrar använda 5 enheter i ”ConnectionCount”</span><span class="sxs-lookup"><span data-stu-id="3f953-182">Secondaries use 5 units of "ConnectionCount"</span></span>
  - <span data-ttu-id="3f953-183">Du vet att ”ConnectionCount” är det viktigaste måtten som hanterar prestandan för viss tjänsten</span><span class="sxs-lookup"><span data-stu-id="3f953-183">You know that "ConnectionCount" is the most important metric in terms of managing the performance of this particular service</span></span>
  - <span data-ttu-id="3f953-184">Du ändå vill primära repliker belastningsutjämnade.</span><span class="sxs-lookup"><span data-stu-id="3f953-184">You still want Primary replicas balanced.</span></span> <span data-ttu-id="3f953-185">NLB primära repliker är vanligtvis bra oavsett vad.</span><span class="sxs-lookup"><span data-stu-id="3f953-185">Balancing primary replicas is generally a good idea no matter what.</span></span> <span data-ttu-id="3f953-186">Detta förhindrar förlust av vissa nod eller fault domän påverkar en majoritet av primära repliker tillsammans med den.</span><span class="sxs-lookup"><span data-stu-id="3f953-186">This helps prevent the loss of some node or fault domain from impacting a majority of primary replicas along with it.</span></span> 
  - <span data-ttu-id="3f953-187">I annat fall är mätvärdena som standard bra</span><span class="sxs-lookup"><span data-stu-id="3f953-187">Otherwise, the default metrics are fine</span></span>

<span data-ttu-id="3f953-188">Här är koden som du skulle kunna skriva att skapa en tjänst med mått konfigurationen:</span><span class="sxs-lookup"><span data-stu-id="3f953-188">Here’s the code that you would write to create a service with that metric configuration:</span></span>

<span data-ttu-id="3f953-189">Kod:</span><span class="sxs-lookup"><span data-stu-id="3f953-189">Code:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
StatefulServiceLoadMetricDescription connectionMetric = new StatefulServiceLoadMetricDescription();
connectionMetric.Name = "ConnectionCount";
connectionMetric.PrimaryDefaultLoad = 20;
connectionMetric.SecondaryDefaultLoad = 5;
connectionMetric.Weight = ServiceLoadMetricWeight.High;

StatefulServiceLoadMetricDescription primaryCountMetric = new StatefulServiceLoadMetricDescription();
primaryCountMetric.Name = "PrimaryCount";
primaryCountMetric.PrimaryDefaultLoad = 1;
primaryCountMetric.SecondaryDefaultLoad = 0;
primaryCountMetric.Weight = ServiceLoadMetricWeight.Medium;

StatefulServiceLoadMetricDescription replicaCountMetric = new StatefulServiceLoadMetricDescription();
replicaCountMetric.Name = "ReplicaCount";
replicaCountMetric.PrimaryDefaultLoad = 1;
replicaCountMetric.SecondaryDefaultLoad = 1;
replicaCountMetric.Weight = ServiceLoadMetricWeight.Low;

StatefulServiceLoadMetricDescription totalCountMetric = new StatefulServiceLoadMetricDescription();
totalCountMetric.Name = "Count";
totalCountMetric.PrimaryDefaultLoad = 1;
totalCountMetric.SecondaryDefaultLoad = 1;
totalCountMetric.Weight = ServiceLoadMetricWeight.Low;

serviceDescription.Metrics.Add(connectionMetric);
serviceDescription.Metrics.Add(primaryCountMetric);
serviceDescription.Metrics.Add(replicaCountMetric);
serviceDescription.Metrics.Add(totalCountMetric);

await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="3f953-190">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="3f953-190">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ConnectionCount,High,20,5”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

> [!NOTE]
> <span data-ttu-id="3f953-191">Ovanstående exempel och resten av det här dokumentet beskriver du hantera mått på grundval av per-med namnet-tjänst.</span><span class="sxs-lookup"><span data-stu-id="3f953-191">The above examples and the rest of this document describe managing metrics on a per-named-service basis.</span></span> <span data-ttu-id="3f953-192">Det är också möjligt att definiera mätvärden för dina tjänster på tjänsten _typen_ nivå.</span><span class="sxs-lookup"><span data-stu-id="3f953-192">It is also possible to define metrics for your services at the service _type_ level.</span></span> <span data-ttu-id="3f953-193">Detta åstadkoms genom att ange dem i din service manifest.</span><span class="sxs-lookup"><span data-stu-id="3f953-193">This is accomplished by specifying them in your service manifests.</span></span> <span data-ttu-id="3f953-194">Definiera typ nivån mått rekommenderas inte av flera skäl.</span><span class="sxs-lookup"><span data-stu-id="3f953-194">Defining type level metrics is not recommended for several reasons.</span></span> <span data-ttu-id="3f953-195">Det första skälet är att mått namn är ofta miljöspecifikt.</span><span class="sxs-lookup"><span data-stu-id="3f953-195">The first reason is that metric names are frequently environment-specific.</span></span> <span data-ttu-id="3f953-196">Om det inte finns ett fast kontrakt på plats, kan du vara säker på att måttet ”kärnor” i en miljö är inte ”MiliCores” eller ”kärnor” i andra.</span><span class="sxs-lookup"><span data-stu-id="3f953-196">Unless there is a firm contract in place, you cannot be sure that the metric "Cores" in one environment isn't "MiliCores" or "CoReS" in others.</span></span> <span data-ttu-id="3f953-197">Om din mått har definierats i ditt manifest som du behöver skapa nya manifesten per miljö.</span><span class="sxs-lookup"><span data-stu-id="3f953-197">If your metrics are defined in your manifest you need to create new manifests per environment.</span></span> <span data-ttu-id="3f953-198">Detta leder vanligtvis till en ökande mängden av olika manifest med bara smärre skillnader, vilket kan leda till problem med hantering.</span><span class="sxs-lookup"><span data-stu-id="3f953-198">This usually leads to a proliferation of different manifests with only minor differences, which can lead to management difficulties.</span></span>  
>
> <span data-ttu-id="3f953-199">Mått belastningar tilldelas ofta på grundval av per med namnet-service-instans.</span><span class="sxs-lookup"><span data-stu-id="3f953-199">Metric loads are commonly assigned on a per-named-service-instance basis.</span></span> <span data-ttu-id="3f953-200">Anta exempelvis att du skapar en instans av tjänsten för CustomerA som planerar att använda den inte.</span><span class="sxs-lookup"><span data-stu-id="3f953-200">For example, let's say you create one instance of the service for CustomerA who plans to use it only lightly.</span></span> <span data-ttu-id="3f953-201">Anta också att du skapar en annan för CustomerB som har en större arbetsbelastning.</span><span class="sxs-lookup"><span data-stu-id="3f953-201">Let's also say you create another for CustomerB who has a larger workload.</span></span> <span data-ttu-id="3f953-202">I så fall måste vill du förmodligen justera belastningarna som standard för dessa tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-202">In this case, you'd probably want to tweak the default loads for those services.</span></span> <span data-ttu-id="3f953-203">Om du har mått och belastningar som anges via manifesten och du vill kunna använda det här scenariot kräver olika program och typer av tjänster för varje kund.</span><span class="sxs-lookup"><span data-stu-id="3f953-203">If you have metrics and loads defined via manifests and you want to support this scenario, it requires different application and service types for each customer.</span></span> <span data-ttu-id="3f953-204">De värden som definierats vid tidpunkten för skapandet av tjänsten åsidosätta de som anges i manifestet, så att du kan använda som kan ange specifika standardinställningar.</span><span class="sxs-lookup"><span data-stu-id="3f953-204">The values defined at service creation time override those defined in the manifest, so you could use that to set the specific defaults.</span></span> <span data-ttu-id="3f953-205">Dock gör gör de värden som deklarerats i tjänsten körs med manifesten till stämmer inte överens.</span><span class="sxs-lookup"><span data-stu-id="3f953-205">However, doing that causes the values declared in the manifests to not match those the service actually runs with.</span></span> <span data-ttu-id="3f953-206">Detta kan leda till förvirring.</span><span class="sxs-lookup"><span data-stu-id="3f953-206">This can lead to confusion.</span></span> 
>

<span data-ttu-id="3f953-207">Som en påminnelse: Om du vill använda mätvärdena som är standard, behöver du inte alls touch samlingen mått eller göra något speciellt när du skapar din tjänst.</span><span class="sxs-lookup"><span data-stu-id="3f953-207">As a reminder: if you just want to use the default metrics, you don’t need to touch the metrics collection at all or do anything special when creating your service.</span></span> <span data-ttu-id="3f953-208">Standard-mått hämta används automatiskt när inga andra definieras.</span><span class="sxs-lookup"><span data-stu-id="3f953-208">The default metrics get used automatically when no others are defined.</span></span> 

<span data-ttu-id="3f953-209">Nu går vi igenom de här inställningarna i detalj och talar om hur den inverkar.</span><span class="sxs-lookup"><span data-stu-id="3f953-209">Now, let's go through each of these settings in more detail and talk about the behavior that it influences.</span></span>

## <a name="load"></a><span data-ttu-id="3f953-210">Läsa in</span><span class="sxs-lookup"><span data-stu-id="3f953-210">Load</span></span>
<span data-ttu-id="3f953-211">Det hela definiera mått är representerar vissa belastningen.</span><span class="sxs-lookup"><span data-stu-id="3f953-211">The whole point of defining metrics is to represent some load.</span></span> <span data-ttu-id="3f953-212">*Läs in* är hur mycket av ett visst mått som används av vissa tjänstinstansen eller repliken på en viss nod.</span><span class="sxs-lookup"><span data-stu-id="3f953-212">*Load* is how much of a given metric is consumed by some service instance or replica on a given node.</span></span> <span data-ttu-id="3f953-213">Läs in kan konfigureras på nästan alla punkt.</span><span class="sxs-lookup"><span data-stu-id="3f953-213">Load can be configured at almost any point.</span></span> <span data-ttu-id="3f953-214">Exempel:</span><span class="sxs-lookup"><span data-stu-id="3f953-214">For example:</span></span>

  - <span data-ttu-id="3f953-215">Läs in kan definieras när en tjänst skapas.</span><span class="sxs-lookup"><span data-stu-id="3f953-215">Load can be defined when a service is created.</span></span> <span data-ttu-id="3f953-216">Detta kallas _standard belastningen_.</span><span class="sxs-lookup"><span data-stu-id="3f953-216">This is called _default load_.</span></span>
  - <span data-ttu-id="3f953-217">Mått information, inklusive standard belastning för en tjänst kan uppdateras när tjänsten har skapats.</span><span class="sxs-lookup"><span data-stu-id="3f953-217">The metric information, including default loads, for a service can updated after the service is created.</span></span> <span data-ttu-id="3f953-218">Detta kallas _uppdatera en tjänst_.</span><span class="sxs-lookup"><span data-stu-id="3f953-218">This is called _updating a service_.</span></span> 
  - <span data-ttu-id="3f953-219">Belastning för en given partition kan du återställa standardvärdena för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="3f953-219">The loads for a given partition can be reset to the default values for that service.</span></span> <span data-ttu-id="3f953-220">Detta kallas _återställa partitionsbelastning_.</span><span class="sxs-lookup"><span data-stu-id="3f953-220">This is called _resetting partition load_.</span></span>
  - <span data-ttu-id="3f953-221">Läs in rapporteras på en per service objektet bas dynamiskt vid körning.</span><span class="sxs-lookup"><span data-stu-id="3f953-221">Load can be reported on a per service object basis dynamically during runtime.</span></span> <span data-ttu-id="3f953-222">Detta kallas _reporting belastningen_.</span><span class="sxs-lookup"><span data-stu-id="3f953-222">This is called _reporting load_.</span></span> 
  
<span data-ttu-id="3f953-223">Alla dessa strategier kan användas inom samma tjänst under sin livslängd.</span><span class="sxs-lookup"><span data-stu-id="3f953-223">All of these strategies can be used within the same service over its lifetime.</span></span> 

## <a name="default-load"></a><span data-ttu-id="3f953-224">Standard-inläsning</span><span class="sxs-lookup"><span data-stu-id="3f953-224">Default load</span></span>
<span data-ttu-id="3f953-225">*Standard belastningen* är hur mycket av måttet förbrukar varje serviceobjektet (tillståndslös instans eller tillståndskänslig replik) för den här tjänsten.</span><span class="sxs-lookup"><span data-stu-id="3f953-225">*Default load* is how much of the metric each service object (stateless instance or stateful replica) of this service consumes.</span></span> <span data-ttu-id="3f953-226">Resurshanteraren klustret använder det här numret för belastningen på serviceobjektet tills det mottar annan information, till exempel en dynamisk rapport.</span><span class="sxs-lookup"><span data-stu-id="3f953-226">The Cluster Resource Manager uses this number for the load of the service object until it receives other information, such as a dynamic load report.</span></span> <span data-ttu-id="3f953-227">Standard-belastningen är en statisk definition för enklare tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-227">For simpler services, the default load is a static definition.</span></span> <span data-ttu-id="3f953-228">Standard-belastningen uppdateras aldrig och används för livslängden för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="3f953-228">The default load is never updated and is used for the lifetime of the service.</span></span> <span data-ttu-id="3f953-229">Standard laddar fungerar bra för enkel kapacitetsplanering scenarier där vissa mängder resurser är dedikerade till olika arbetsbelastningar och ändras inte.</span><span class="sxs-lookup"><span data-stu-id="3f953-229">Default loads works great for simple capacity planning scenarios where certain amounts of resources are dedicated to different workloads and do not change.</span></span>

> [!NOTE]
> <span data-ttu-id="3f953-230">Mer information om kapacitetshantering av och definiera kapacitet för noder i klustret finns [i den här artikeln](service-fabric-cluster-resource-manager-cluster-description.md#capacity).</span><span class="sxs-lookup"><span data-stu-id="3f953-230">For more information on capacity management and defining capacities for the nodes in your cluster, please see [this article](service-fabric-cluster-resource-manager-cluster-description.md#capacity).</span></span>
> 

<span data-ttu-id="3f953-231">Klustret Resource Manager tillåter tillståndskänsliga tjänster att ange en annan standard belastning för sina primärfärgerna och sekundärservrar.</span><span class="sxs-lookup"><span data-stu-id="3f953-231">The Cluster Resource Manager allows stateful services to specify a different default load for their Primaries and Secondaries.</span></span> <span data-ttu-id="3f953-232">Tillståndslösa tjänster kan bara ange ett värde som gäller för alla instanser.</span><span class="sxs-lookup"><span data-stu-id="3f953-232">Stateless services can only specify one value that applies to all instances.</span></span> <span data-ttu-id="3f953-233">Repliker är vanligtvis olika för tillståndskänsliga tjänster, standard-belastningen för primär och sekundär eftersom repliker har olika typer av resurser i varje roll.</span><span class="sxs-lookup"><span data-stu-id="3f953-233">For stateful services, the default load for Primary and Secondary replicas are typically different since replicas do different kinds of work in each role.</span></span> <span data-ttu-id="3f953-234">Till exempel primärfärgerna vanligtvis fungerar både läsningar och skrivningar och hantera de flesta av beräkningar belastningen medan sekundärservrar inte.</span><span class="sxs-lookup"><span data-stu-id="3f953-234">For example, Primaries usually serve both reads and writes, and handle most of the computational burden, while secondaries do not.</span></span> <span data-ttu-id="3f953-235">Vanligtvis är standard belastningen för en primär replik högre än standard belastningen för sekundära repliker.</span><span class="sxs-lookup"><span data-stu-id="3f953-235">Usually the default load for a primary replica is higher than the default load for secondary replicas.</span></span> <span data-ttu-id="3f953-236">Reellt tal bör beror på dina egna mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-236">The real numbers should depend on your own measurements.</span></span>

## <a name="dynamic-load"></a><span data-ttu-id="3f953-237">Dynamisk</span><span class="sxs-lookup"><span data-stu-id="3f953-237">Dynamic load</span></span>
<span data-ttu-id="3f953-238">Anta att du har kört din tjänst för en stund.</span><span class="sxs-lookup"><span data-stu-id="3f953-238">Let’s say that you’ve been running your service for a while.</span></span> <span data-ttu-id="3f953-239">Med viss övervakning upplever du som:</span><span class="sxs-lookup"><span data-stu-id="3f953-239">With some monitoring, you’ve noticed that:</span></span>

1. <span data-ttu-id="3f953-240">Några partitioner eller instanser av en viss tjänst förbruka mer resurser än andra</span><span class="sxs-lookup"><span data-stu-id="3f953-240">Some partitions or instances of a given service consume more resources than others</span></span>
2. <span data-ttu-id="3f953-241">Vissa tjänster ha belastningen varierar över tiden.</span><span class="sxs-lookup"><span data-stu-id="3f953-241">Some services have load that varies over time.</span></span>

<span data-ttu-id="3f953-242">Det finns många saker som kan leda till att dessa typer av belastningen variationer.</span><span class="sxs-lookup"><span data-stu-id="3f953-242">There's lots of things that could cause these types of load fluctuations.</span></span> <span data-ttu-id="3f953-243">Till exempel är olika tjänster eller partitioner associerade med olika kunder med olika krav.</span><span class="sxs-lookup"><span data-stu-id="3f953-243">For example, different services or partitions are associated with different customers with different requirements.</span></span> <span data-ttu-id="3f953-244">Läs in kan också ändra eftersom mängden arbete tjänsten varierar under loppet av dagen.</span><span class="sxs-lookup"><span data-stu-id="3f953-244">Load could also change because the amount of work the service does varies over the course of the day.</span></span> <span data-ttu-id="3f953-245">Oavsett orsak är det vanligtvis ingen tal som du kan använda för standardvärde.</span><span class="sxs-lookup"><span data-stu-id="3f953-245">Regardless of the reason, there’s usually no single number that you can use for default.</span></span> <span data-ttu-id="3f953-246">Detta gäller särskilt om du vill ha de flesta användning utanför klustret.</span><span class="sxs-lookup"><span data-stu-id="3f953-246">This is especially true if you want to get the most utilization out of the cluster.</span></span> <span data-ttu-id="3f953-247">Ett värde som du väljer för standard är felaktigt del av tiden.</span><span class="sxs-lookup"><span data-stu-id="3f953-247">Any value you pick for default load is wrong some of the time.</span></span> <span data-ttu-id="3f953-248">Felaktig standard läser in resultatet i klustret Resource Manager antingen över eller under fördela resurser.</span><span class="sxs-lookup"><span data-stu-id="3f953-248">Incorrect default loads result in the Cluster Resource Manager either over or under allocating resources.</span></span> <span data-ttu-id="3f953-249">Därför kan har du noder som över eller under används även om klustret Resource Manager tror att klustret är Balanserat.</span><span class="sxs-lookup"><span data-stu-id="3f953-249">As a result, you have nodes that are over or under utilized even though the Cluster Resource Manager thinks the cluster is balanced.</span></span> <span data-ttu-id="3f953-250">Standard-belastning är fortfarande bra eftersom de ger viss information för inledande placering, men de har inte en fullständig artikel för verkliga arbetsbelastningar.</span><span class="sxs-lookup"><span data-stu-id="3f953-250">Default loads are still good since they provide some information for initial placement, but they're not a complete story for real workloads.</span></span> <span data-ttu-id="3f953-251">För att avbilda korrekt ändra resursbehov, kan klustret Resource Manager varje serviceobjektet att uppdatera sin egen belastning under körningen.</span><span class="sxs-lookup"><span data-stu-id="3f953-251">To accurately capture changing resource requirements, the Cluster Resource Manager allows each service object to update its own load during runtime.</span></span> <span data-ttu-id="3f953-252">Detta kallas dynamisk reporting.</span><span class="sxs-lookup"><span data-stu-id="3f953-252">This is called dynamic load reporting.</span></span>

<span data-ttu-id="3f953-253">Dynamisk rapporter kan repliker eller instanser att justera sina allokering/rapporterade belastningen på mått under sin livslängd.</span><span class="sxs-lookup"><span data-stu-id="3f953-253">Dynamic load reports allow replicas or instances to adjust their allocation/reported load of metrics over their lifetime.</span></span> <span data-ttu-id="3f953-254">En replik för tjänsten eller instans som var kall och inte gör allt arbete rapporteras vanligtvis som använde små mängder av ett visst mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-254">A service replica or instance that was cold and not doing any work would usually report that it was using low amounts of a given metric.</span></span> <span data-ttu-id="3f953-255">En upptagen replik eller skulle rapporterar att de använder mer.</span><span class="sxs-lookup"><span data-stu-id="3f953-255">A busy replica or instance would report that they are using more.</span></span>

<span data-ttu-id="3f953-256">Belastningen per målrepliker eller instanser kan klustret resurshanteraren att ordna om enskilda service-objekt i klustret.</span><span class="sxs-lookup"><span data-stu-id="3f953-256">Reporting load per replica or instance allows the Cluster Resource Manager to reorganize the individual service objects in the cluster.</span></span> <span data-ttu-id="3f953-257">Organisera om tjänsterna säkerställer att de får de resurser som de behöver.</span><span class="sxs-lookup"><span data-stu-id="3f953-257">Reorganizing the services helps ensure that they get the resources they require.</span></span> <span data-ttu-id="3f953-258">Upptagen tjänster få effektivt ”frigöra” resurser från andra repliker eller instanser som är för närvarande kall eller göra mindre arbete.</span><span class="sxs-lookup"><span data-stu-id="3f953-258">Busy services effectively get to "reclaim" resources from other replicas or instances that are currently cold or doing less work.</span></span>

<span data-ttu-id="3f953-259">Inom Reliable Services kod för att rapportera belastning dynamiskt ser ut så här:</span><span class="sxs-lookup"><span data-stu-id="3f953-259">Within Reliable Services, the code to report load dynamically looks like this:</span></span>

<span data-ttu-id="3f953-260">Kod:</span><span class="sxs-lookup"><span data-stu-id="3f953-260">Code:</span></span>

```csharp
this.Partition.ReportLoad(new List<LoadMetric> { new LoadMetric("CurrentConnectionCount", 1234), new LoadMetric("metric1", 42) });
```

<span data-ttu-id="3f953-261">En tjänst kan rapportera på någon av de mätvärden som definierats för den vid skapandet.</span><span class="sxs-lookup"><span data-stu-id="3f953-261">A service can report on any of the metrics defined for it at creation time.</span></span> <span data-ttu-id="3f953-262">Om en tjänst rapporter belastning för ett mått som inte är konfigurerad för att använda, ignorerar Service Fabric rapporten.</span><span class="sxs-lookup"><span data-stu-id="3f953-262">If a service reports load for a metric that it is not configured to use, Service Fabric ignores that report.</span></span> <span data-ttu-id="3f953-263">Om det finns andra mått som rapporteras vid samma tidpunkt som är giltiga, godkänns rapporterna.</span><span class="sxs-lookup"><span data-stu-id="3f953-263">If there are other metrics reported at the same time that are valid, those reports are accepted.</span></span> <span data-ttu-id="3f953-264">Service-kod kan mäta och rapportera alla mått som vet hur till, och operatörer kan ange den mått konfigurationen som ska användas utan att ändra kod.</span><span class="sxs-lookup"><span data-stu-id="3f953-264">Service code can measure and report all the metrics it knows how to, and operators can specify the metric configuration to use without having to change the service code.</span></span> 

### <a name="updating-a-services-metric-configuration"></a><span data-ttu-id="3f953-265">Ett mått tjänstkonfigurationen uppdaterades</span><span class="sxs-lookup"><span data-stu-id="3f953-265">Updating a service's metric configuration</span></span>
<span data-ttu-id="3f953-266">Listan över mått som är associerad med tjänsten och egenskaperna för dessa mått kan uppdateras dynamiskt när tjänsten är aktiv.</span><span class="sxs-lookup"><span data-stu-id="3f953-266">The list of metrics associated with the service, and the properties of those metrics can be updated dynamically while the service is live.</span></span> <span data-ttu-id="3f953-267">Detta ger undersökningar och flexibilitet.</span><span class="sxs-lookup"><span data-stu-id="3f953-267">This allows for experimentation and flexibility.</span></span> <span data-ttu-id="3f953-268">Några exempel när det är praktiskt är:</span><span class="sxs-lookup"><span data-stu-id="3f953-268">Some examples of when this is useful are:</span></span>

  - <span data-ttu-id="3f953-269">inaktivera ett mått med en buggy rapport för en viss tjänst</span><span class="sxs-lookup"><span data-stu-id="3f953-269">disabling a metric with a buggy report for a particular service</span></span>
  - <span data-ttu-id="3f953-270">Konfigurera om vikten av mått baserat på önskat beteende</span><span class="sxs-lookup"><span data-stu-id="3f953-270">reconfiguring the weights of metrics based on desired behavior</span></span>
  - <span data-ttu-id="3f953-271">Aktivera ett nytt mått när koden har redan distribuerats och godkänts via andra mekanismer</span><span class="sxs-lookup"><span data-stu-id="3f953-271">enabling a new metric only after the code has already been deployed and validated via other mechanisms</span></span>
  - <span data-ttu-id="3f953-272">Ändra standard-belastningen för en tjänst baserat på observerade beteende och förbrukning</span><span class="sxs-lookup"><span data-stu-id="3f953-272">changing the default load for a service based on observed behavior and consumption</span></span>

<span data-ttu-id="3f953-273">De huvudsakliga API: er för att ändra mått konfiguration är `FabricClient.ServiceManagementClient.UpdateServiceAsync` i C# och `Update-ServiceFabricService` i PowerShell.</span><span class="sxs-lookup"><span data-stu-id="3f953-273">The main APIs for changing metric configuration are `FabricClient.ServiceManagementClient.UpdateServiceAsync` in C# and `Update-ServiceFabricService` in PowerShell.</span></span> <span data-ttu-id="3f953-274">Den information som du anger med dessa API: er ersätter befintliga mått information för tjänsten omedelbart.</span><span class="sxs-lookup"><span data-stu-id="3f953-274">Whatever information you specify with these APIs replaces the existing metric information for the service immediately.</span></span> 

## <a name="mixing-default-load-values-and-dynamic-load-reports"></a><span data-ttu-id="3f953-275">Blandning av belastningen standardvärden och dynamisk rapporter</span><span class="sxs-lookup"><span data-stu-id="3f953-275">Mixing default load values and dynamic load reports</span></span>
<span data-ttu-id="3f953-276">Standard belastning och dynamisk last kan användas för samma tjänst.</span><span class="sxs-lookup"><span data-stu-id="3f953-276">Default load and dynamic loads can be used for the same service.</span></span> <span data-ttu-id="3f953-277">När en tjänst använder både standard belastning och dynamisk rapporter, standard belastning som fungerar som en uppskattning tills dynamiska rapporter visas.</span><span class="sxs-lookup"><span data-stu-id="3f953-277">When a service utilizes both default load and dynamic load reports, default load serves as an estimate until dynamic reports show up.</span></span> <span data-ttu-id="3f953-278">Standard belastningen är bra eftersom den ger klustret Resource Manager något att arbeta med.</span><span class="sxs-lookup"><span data-stu-id="3f953-278">Default load is good because it gives the Cluster Resource Manager something to work with.</span></span> <span data-ttu-id="3f953-279">Standard belastningen kan klustret Resource Manager ska placeras service-objekt i god platser när de skapas.</span><span class="sxs-lookup"><span data-stu-id="3f953-279">The default load allows the Cluster Resource Manager to place the service objects in good locations when they are created.</span></span> <span data-ttu-id="3f953-280">Om ingen standard belastningen information tillhandahålls är placering av tjänster effektiv slumpmässiga.</span><span class="sxs-lookup"><span data-stu-id="3f953-280">If no default load information is provided, placement of services is effectively random.</span></span> <span data-ttu-id="3f953-281">När belastningen rapporter kommer senare inledande slumpmässiga placering är ofta fel och klustret Resource Manager har flytta tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-281">When load reports arrive later the initial random placement is often wrong and the Cluster Resource Manager has to move services.</span></span>

<span data-ttu-id="3f953-282">Vi tar det tidigare exemplet och se vad som händer när vi lägger till vissa anpassade mått och dynamisk rapportering.</span><span class="sxs-lookup"><span data-stu-id="3f953-282">Let’s take our previous example and see what happens when we add some custom metrics and dynamic load reporting.</span></span> <span data-ttu-id="3f953-283">I det här exemplet använder vi ”MemoryInMb” som ett exempel mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-283">In this example, we use “MemoryInMb” as an example metric.</span></span>

> [!NOTE]
> <span data-ttu-id="3f953-284">Minne är en system-mått som Service Fabric kan [resursen styr](service-fabric-resource-governance.md), och rapportering själv är vanligtvis svårt.</span><span class="sxs-lookup"><span data-stu-id="3f953-284">Memory is one of the system metrics that Service Fabric can [resource govern](service-fabric-resource-governance.md), and reporting it yourself is typically difficult.</span></span> <span data-ttu-id="3f953-285">Vi faktiskt inte förväntar dig att rapportera om minnesförbrukning; Minne används här som en hjälp att lära dig mer om funktionerna i klustret Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="3f953-285">We don't actually expect you to report on Memory consumption; Memory is used here as an aid to learning about the capabilities of the Cluster Resource Manager.</span></span>
>

<span data-ttu-id="3f953-286">Vi förutsätter att det ursprungligen skapades tillståndskänslig tjänsten med följande kommando:</span><span class="sxs-lookup"><span data-stu-id="3f953-286">Let’s presume that we initially created the stateful service with the following command:</span></span>

<span data-ttu-id="3f953-287">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="3f953-287">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("MemoryInMb,High,21,11”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

<span data-ttu-id="3f953-288">Som en påminnelse är den här syntaxen (”MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad”).</span><span class="sxs-lookup"><span data-stu-id="3f953-288">As a reminder, this syntax is ("MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad").</span></span>

<span data-ttu-id="3f953-289">Nu ska vi se vad en layout för möjliga klustret kan se ut så:</span><span class="sxs-lookup"><span data-stu-id="3f953-289">Let's see what one possible cluster layout could look like:</span></span>

<span data-ttu-id="3f953-290"><center>
![Kluster balanserad med både standard- och anpassade mått][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="3f953-290"><center>
![Cluster Balanced with both Default and Custom metrics][Image2]
</center></span></span>

<span data-ttu-id="3f953-291">Vissa saker som är noteras:</span><span class="sxs-lookup"><span data-stu-id="3f953-291">Some things that are worth noting:</span></span>

* <span data-ttu-id="3f953-292">Sekundära repliker inom en partition kan ha sina egna belastning</span><span class="sxs-lookup"><span data-stu-id="3f953-292">Secondary replicas within a partition can each have their own load</span></span>
* <span data-ttu-id="3f953-293">Mätvärdena leta övergripande belastningsutjämnade.</span><span class="sxs-lookup"><span data-stu-id="3f953-293">Overall the metrics look balanced.</span></span> <span data-ttu-id="3f953-294">För minne, är förhållandet mellan den högsta och lägsta lasten 1,75 (noden med mest belastningen är N3, minst är N2 och 28/16 = 1,75).</span><span class="sxs-lookup"><span data-stu-id="3f953-294">For Memory, the ratio between the maximum and minimum load is 1.75 (the node with the most load is N3, the least is N2, and 28/16 = 1.75).</span></span>

<span data-ttu-id="3f953-295">Det finns vissa saker som fortfarande behövs för att förklara:</span><span class="sxs-lookup"><span data-stu-id="3f953-295">There are some things that we still need to explain:</span></span>

* <span data-ttu-id="3f953-296">Vad fastställa om ett förhållande på 1,75 var rimliga?</span><span class="sxs-lookup"><span data-stu-id="3f953-296">What determined whether a ratio of 1.75 was reasonable or not?</span></span> <span data-ttu-id="3f953-297">Hur klustret Resource Manager vet om som är tillräckligt bra eller om det finns mer arbete att göra?</span><span class="sxs-lookup"><span data-stu-id="3f953-297">How does the Cluster Resource Manager know if that’s good enough or if there is more work to do?</span></span>
* <span data-ttu-id="3f953-298">När sker belastningsutjämning?</span><span class="sxs-lookup"><span data-stu-id="3f953-298">When does balancing happen?</span></span>
* <span data-ttu-id="3f953-299">Vad innebär det att minnet var viktas ”hög”?</span><span class="sxs-lookup"><span data-stu-id="3f953-299">What does it mean that Memory was weighted “High”?</span></span>

## <a name="metric-weights"></a><span data-ttu-id="3f953-300">Tjänstmåttets vikt</span><span class="sxs-lookup"><span data-stu-id="3f953-300">Metric weights</span></span>
<span data-ttu-id="3f953-301">Det är viktigt att spåra samma mått över olika tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-301">Tracking the same metrics across different services is important.</span></span> <span data-ttu-id="3f953-302">Den globala vyn är vad gör klustret Resource Manager kan spåra användning i klustret, balanserar förbrukning mellan noder och kontrollera att noderna inte gå igenom kapacitet.</span><span class="sxs-lookup"><span data-stu-id="3f953-302">That global view is what allows the Cluster Resource Manager to track consumption in the cluster, balance consumption across nodes, and ensure that nodes don’t go over capacity.</span></span> <span data-ttu-id="3f953-303">Tjänster kan dock ha olika vyer om vikten av samma mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-303">However, services may have different views as to the importance of the same metric.</span></span> <span data-ttu-id="3f953-304">Även i ett kluster med många mått och många tjänster finns perfekt belastningsutjämnade lösningar inte för alla.</span><span class="sxs-lookup"><span data-stu-id="3f953-304">Also, in a cluster with many metrics and lots of services, perfectly balanced solutions may not exist for all metrics.</span></span> <span data-ttu-id="3f953-305">Hur ska klustret Resource Manager hanterar sådana situationer?</span><span class="sxs-lookup"><span data-stu-id="3f953-305">How should the Cluster Resource Manager handle these situations?</span></span>

<span data-ttu-id="3f953-306">Tjänstmåttets vikt kan klustret resurshanteraren att bestämma hur du ska hantera klustret när det finns inget perfekta svar.</span><span class="sxs-lookup"><span data-stu-id="3f953-306">Metric weights allow the Cluster Resource Manager to decide how to balance the cluster when there’s no perfect answer.</span></span> <span data-ttu-id="3f953-307">Tjänstmåttets vikt kan också klustret resurshanteraren att balansera specifika tjänster på olika sätt.</span><span class="sxs-lookup"><span data-stu-id="3f953-307">Metric weights also allow the Cluster Resource Manager to balance specific services differently.</span></span> <span data-ttu-id="3f953-308">Mått kan ha fyra olika vikt nivåer: noll, lågt, Medium och hög.</span><span class="sxs-lookup"><span data-stu-id="3f953-308">Metrics can have four different weight levels: Zero, Low, Medium, and High.</span></span> <span data-ttu-id="3f953-309">Ett mått med en vikt på noll bidrar ingenting när du överväger saker är balanserade eller inte.</span><span class="sxs-lookup"><span data-stu-id="3f953-309">A metric with a weight of Zero contributes nothing when considering whether things are balanced or not.</span></span> <span data-ttu-id="3f953-310">Men bidrar belastningen fortfarande till kapacitetshantering av.</span><span class="sxs-lookup"><span data-stu-id="3f953-310">However, its load does still contribute to capacity management.</span></span> <span data-ttu-id="3f953-311">Mått med noll är användbar och används ofta som en del av tjänst och prestandaövervakning.</span><span class="sxs-lookup"><span data-stu-id="3f953-311">Metrics with Zero weight are still useful and are frequently used as a part of service behavior and performance monitoring.</span></span> <span data-ttu-id="3f953-312">[Den här artikeln](service-fabric-diagnostics-event-generation-infra.md) finns mer information om användning av mätvärden för övervakning och diagnostik-tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-312">[This article](service-fabric-diagnostics-event-generation-infra.md) provides more information on the use of metrics for monitoring and diagnostics of your services.</span></span> 

<span data-ttu-id="3f953-313">Den verkliga effekten av olika mått vikter i klustret är att klustret Resource Manager genererar olika lösningar.</span><span class="sxs-lookup"><span data-stu-id="3f953-313">The real impact of different metric weights in the cluster is that the Cluster Resource Manager generates different solutions.</span></span> <span data-ttu-id="3f953-314">Tjänstmåttets vikt berätta klustret Resource Manager för att vissa mått är viktigare än andra.</span><span class="sxs-lookup"><span data-stu-id="3f953-314">Metric weights tell the Cluster Resource Manager that certain metrics are more important than others.</span></span> <span data-ttu-id="3f953-315">När det finns ingen perfekt lösning föredrar klustret Resource Manager lösningar som balanserar högre viktat mätvärdena bättre.</span><span class="sxs-lookup"><span data-stu-id="3f953-315">When there's no perfect solution the Cluster Resource Manager can prefer solutions which balance the higher weighted metrics better.</span></span> <span data-ttu-id="3f953-316">Om en tjänst tror ett viss mått är oviktigt kan hittas deras användning av den måtten imbalanced.</span><span class="sxs-lookup"><span data-stu-id="3f953-316">If a service thinks a particular metric is unimportant, it may find their use of that metric imbalanced.</span></span> <span data-ttu-id="3f953-317">På så sätt kan en annan tjänsten för att hämta en jämn fördelning av vissa mått som är viktiga för den.</span><span class="sxs-lookup"><span data-stu-id="3f953-317">This allows another service to get an even distribution of some metric that is important to it.</span></span>

<span data-ttu-id="3f953-318">Nu ska vi titta på ett exempel på några belastningen rapporter och hur olika mått viktas resulterar i olika allokeringar i klustret.</span><span class="sxs-lookup"><span data-stu-id="3f953-318">Let’s look at an example of some load reports and how different metric weights results in different allocations in the cluster.</span></span> <span data-ttu-id="3f953-319">I det här exemplet finns att växla relativa viktade mätvärden gör att klustret resurshanteraren att skapa olika åtgärder av tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-319">In this example, we see that switching the relative weight of the metrics causes the Cluster Resource Manager to create different arrangements of services.</span></span>

<span data-ttu-id="3f953-320"><center>
![Tjänstmåttets vikt exempel och dess påverkan på NLB lösningar][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="3f953-320"><center>
![Metric Weight Example and Its Impact on Balancing Solutions][Image3]
</center></span></span>

<span data-ttu-id="3f953-321">I det här exemplet finns fyra olika tjänster, alla reporting olika värden för två olika mått, MetricA och MetricB.</span><span class="sxs-lookup"><span data-stu-id="3f953-321">In this example, there are four different services, all reporting different values for two different metrics, MetricA and MetricB.</span></span> <span data-ttu-id="3f953-322">Alla tjänster definiera MetricA i ett fall är det viktigaste (vikt = hög) och MetricB som oviktigt (vikt = låg).</span><span class="sxs-lookup"><span data-stu-id="3f953-322">In one case, all the services define MetricA is the most important one (Weight = High) and MetricB as unimportant (Weight = Low).</span></span> <span data-ttu-id="3f953-323">Därför kan vi kan se att klustret Resource Manager placerar tjänsterna så att MetricA balanseras bättre än MetricB.</span><span class="sxs-lookup"><span data-stu-id="3f953-323">As a result, we see that the Cluster Resource Manager places the services so that MetricA is better balanced than MetricB.</span></span> <span data-ttu-id="3f953-324">”Bättre belastningsutjämnade” innebär att MetricA har en lägre har en lägre standardavvikelse än MetricB.</span><span class="sxs-lookup"><span data-stu-id="3f953-324">"Better balanced" means that MetricA has a lower has a lower standard deviation than MetricB.</span></span> <span data-ttu-id="3f953-325">I det andra fallet omvända vi mått vikterna.</span><span class="sxs-lookup"><span data-stu-id="3f953-325">In the second case, we reverse the metric weights.</span></span> <span data-ttu-id="3f953-326">Därför växlingar klustret Resource Manager services A och B för att få fram en allokering där MetricB är bättre belastningsutjämnade än MetricA.</span><span class="sxs-lookup"><span data-stu-id="3f953-326">As a result, the Cluster Resource Manager swaps services A and B to come up with an allocation where MetricB is better balanced than MetricA.</span></span>

> [!NOTE]
> <span data-ttu-id="3f953-327">Tjänstmåttets vikt avgöra hur klustret Resource Manager ska utjämna, men inte när NLB ska hända.</span><span class="sxs-lookup"><span data-stu-id="3f953-327">Metric weights determine how the Cluster Resource Manager should balance, but not when balancing should happen.</span></span> <span data-ttu-id="3f953-328">Mer information om belastningsutjämning kolla [den här artikeln](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="3f953-328">For more information on balancing, check out [this article](service-fabric-cluster-resource-manager-balancing.md)</span></span>
>

### <a name="global-metric-weights"></a><span data-ttu-id="3f953-329">Globala mått vikterna</span><span class="sxs-lookup"><span data-stu-id="3f953-329">Global metric weights</span></span>
<span data-ttu-id="3f953-330">Anta att ServiceA definierar MetricA som vikt hög och ServiceB vikten för MetricA till låg eller noll.</span><span class="sxs-lookup"><span data-stu-id="3f953-330">Let's say ServiceA defines MetricA as weight High, and ServiceB sets the weight for MetricA to Low or Zero.</span></span> <span data-ttu-id="3f953-331">Vad är den faktiska vikten hamnar används?</span><span class="sxs-lookup"><span data-stu-id="3f953-331">What’s the actual weight that ends up getting used?</span></span>

<span data-ttu-id="3f953-332">Det finns flera vikter som spåras för varje mått.</span><span class="sxs-lookup"><span data-stu-id="3f953-332">There are multiple weights that are tracked for every metric.</span></span> <span data-ttu-id="3f953-333">Första vikten är den som angetts för måttet när tjänsten har skapats.</span><span class="sxs-lookup"><span data-stu-id="3f953-333">The first weight is the one defined for the metric when the service is created.</span></span> <span data-ttu-id="3f953-334">Andra vikten är en global vikt, som beräknas automatiskt.</span><span class="sxs-lookup"><span data-stu-id="3f953-334">The other weight is a global weight, which is computed automatically.</span></span> <span data-ttu-id="3f953-335">Klustret Resource Manager använder båda dessa vikter när bedömningen lösningar.</span><span class="sxs-lookup"><span data-stu-id="3f953-335">The Cluster Resource Manager uses both these weights when scoring solutions.</span></span> <span data-ttu-id="3f953-336">Det är viktigt att hänsyn tas till båda vikter.</span><span class="sxs-lookup"><span data-stu-id="3f953-336">Taking both weights into account is important.</span></span> <span data-ttu-id="3f953-337">Detta gör att klustret Resource Manager att balansera varje tjänst enligt sin egen prioriteter och se också till att klustret som helhet fördelas på rätt sätt.</span><span class="sxs-lookup"><span data-stu-id="3f953-337">This allows the Cluster Resource Manager to balance each service according to its own priorities, and also ensure that the cluster as a whole is allocated correctly.</span></span>

<span data-ttu-id="3f953-338">Vad som skulle hända om klustret Resource Manager inte bryr dig om både globala och lokala saldo?</span><span class="sxs-lookup"><span data-stu-id="3f953-338">What would happen if the Cluster Resource Manager didn’t care about both global and local balance?</span></span> <span data-ttu-id="3f953-339">Det är enkelt att skapa lösningar som balanseras globalt, men vilket kan resultera i sämre resursbalansen för enskilda tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-339">Well, it’s easy to construct solutions that are globally balanced, but which result in poor resource balance for individual services.</span></span> <span data-ttu-id="3f953-340">I följande exempel ska vi titta på en tjänst som konfigurerats med bara mätvärdena som standard och se vad som händer när endast globala saldo betraktas som:</span><span class="sxs-lookup"><span data-stu-id="3f953-340">In the following example, let’s look at a service configured with just the default metrics, and see what happens when only global balance is considered:</span></span>

<span data-ttu-id="3f953-341"><center>
![Effekten av en Global endast lösning][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="3f953-341"><center>
![The Impact of a Global Only Solution][Image4]
</center></span></span>

<span data-ttu-id="3f953-342">I översta exempel endast baseras på globalt saldo balanseras verkligen klustret som helhet.</span><span class="sxs-lookup"><span data-stu-id="3f953-342">In the top example based only on global balance, the cluster as a whole is indeed balanced.</span></span> <span data-ttu-id="3f953-343">Alla noder som har samma antal primärfärgerna och samma antal totala repliker.</span><span class="sxs-lookup"><span data-stu-id="3f953-343">All nodes have the same count of primaries and the same number total replicas.</span></span> <span data-ttu-id="3f953-344">Men om du tittar på faktiska effekten av den här allokeringen är det inte så bra: förlust av alla noder som påverkar en viss arbetsbelastning oproportionerligt, eftersom det tar bort all dess primärfärgerna.</span><span class="sxs-lookup"><span data-stu-id="3f953-344">However, if you look at the actual impact of this allocation it’s not so good: the loss of any node impacts a particular workload disproportionately, because it takes out all of its primaries.</span></span> <span data-ttu-id="3f953-345">Till exempel om den första noden misslyckas tre primärfärgerna för de tre olika partitionerna för tjänsten cirkel skulle vara förlorade.</span><span class="sxs-lookup"><span data-stu-id="3f953-345">For example, if the first node fails the three primaries for the three different partitions of the Circle service would all be lost.</span></span> <span data-ttu-id="3f953-346">Däremot har tjänsterna triangel och Sexhörning deras partitioner förlorar en replik.</span><span class="sxs-lookup"><span data-stu-id="3f953-346">Conversely, the Triangle and Hexagon services have their partitions lose a replica.</span></span> <span data-ttu-id="3f953-347">Detta medför att några avbrott än att återställa på repliken.</span><span class="sxs-lookup"><span data-stu-id="3f953-347">This causes no disruption, other than having to recover the down replica.</span></span>

<span data-ttu-id="3f953-348">I exemplet nedre har klustret Resource Manager distribuerade repliker baserat på båda globala och per service saldot.</span><span class="sxs-lookup"><span data-stu-id="3f953-348">In the bottom example, the Cluster Resource Manager has distributed the replicas based on both the global and per-service balance.</span></span> <span data-ttu-id="3f953-349">Vid beräkning av poängen för lösningen ger de flesta av vikten till globala lösningen och en (konfigureras) del enskilda tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-349">When calculating the score of the solution it gives most of the weight to the global solution, and a (configurable) portion to individual services.</span></span> <span data-ttu-id="3f953-350">Globala balansera för ett mått beräknas baserat på medelvärdet av mått vikterna från varje tjänst.</span><span class="sxs-lookup"><span data-stu-id="3f953-350">Global balance for a metric is calculated based on the average of the metric weights from each service.</span></span> <span data-ttu-id="3f953-351">Varje tjänst balanseras enligt sin egen definierade mått vikter.</span><span class="sxs-lookup"><span data-stu-id="3f953-351">Each service is balanced according to its own defined metric weights.</span></span> <span data-ttu-id="3f953-352">Detta säkerställer att tjänsterna är balanserade i själva efter egna behov.</span><span class="sxs-lookup"><span data-stu-id="3f953-352">This ensures that the services are balanced within themselves according to their own needs.</span></span> <span data-ttu-id="3f953-353">Därför distribueras om den första noden samma misslyckades för alla partitioner för alla tjänster.</span><span class="sxs-lookup"><span data-stu-id="3f953-353">As a result, if the same first node fails the failure is distributed across all partitions of all services.</span></span> <span data-ttu-id="3f953-354">Påverkan på varje är samma.</span><span class="sxs-lookup"><span data-stu-id="3f953-354">The impact to each is the same.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3f953-355">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="3f953-355">Next steps</span></span>
- <span data-ttu-id="3f953-356">Mer information om hur du konfigurerar tjänster, [Lär dig mer om hur du konfigurerar tjänster](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="3f953-356">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="3f953-357">Definiera defragmentering mått är ett sätt att konsolidera belastningen på noder i stället för att sprida. Om du vill veta hur du konfigurerar defragmentering avser [i den här artikeln](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="3f953-357">Defining Defragmentation Metrics is one way to consolidate load on nodes instead of spreading it out. To learn how to configure defragmentation, refer to [this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
- <span data-ttu-id="3f953-358">Om du vill veta mer om hur klustret Resource Manager hanterar och balanserar belastningen i klustret kan ta en titt i artikeln på [belastningsutjämning](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="3f953-358">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>
- <span data-ttu-id="3f953-359">Börja från början och [få en introduktion till Service Fabric klustret Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="3f953-359">Start from the beginning and [get an Introduction to the Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
- <span data-ttu-id="3f953-360">Förflyttningskostnad är ett sätt att signalering till klustret Resource Manager att vissa tjänster är dyrare att flytta än andra.</span><span class="sxs-lookup"><span data-stu-id="3f953-360">Movement Cost is one way of signaling to the Cluster Resource Manager that certain services are more expensive to move than others.</span></span> <span data-ttu-id="3f953-361">Mer information om förflyttningskostnad avser [i den här artikeln](service-fabric-cluster-resource-manager-movement-cost.md)</span><span class="sxs-lookup"><span data-stu-id="3f953-361">To learn more about movement cost, refer to [this article](service-fabric-cluster-resource-manager-movement-cost.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-cluster-layout-with-default-metrics.png
[Image2]:./media/service-fabric-cluster-resource-manager-metrics/Service-Fabric-Resource-Manager-Dynamic-Load-Reports.png
[Image3]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-metric-weights-impact.png
[Image4]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-global-vs-local-balancing.png
