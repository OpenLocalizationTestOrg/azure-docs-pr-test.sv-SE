---
title: "Begränsning i resurshanterare Service Fabric-kluster | Microsoft Docs"
description: "Lär dig hur du konfigurerar begränsningar som tillhandahålls av Service Fabric klustret Resource Manager."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 4a44678b-a5aa-4d30-958f-dc4332ebfb63
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 1be0beaf2e199a9c384187efd80b33c7dab5e87c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="throttling-the-service-fabric-cluster-resource-manager"></a><span data-ttu-id="31ab6-103">Begränsning av Service Fabric klustret Resource Manager</span><span class="sxs-lookup"><span data-stu-id="31ab6-103">Throttling the Service Fabric Cluster Resource Manager</span></span>
<span data-ttu-id="31ab6-104">Även om du har konfigurerat klustret Resource Manager korrekt kan kan klustret hämta upplöst.</span><span class="sxs-lookup"><span data-stu-id="31ab6-104">Even if you’ve configured the Cluster Resource Manager correctly, the cluster can get disrupted.</span></span> <span data-ttu-id="31ab6-105">Det kan till exempel vara samtidiga nod och feltolerans domän fel - vad som skulle hända om som uppstod under en uppgradering?</span><span class="sxs-lookup"><span data-stu-id="31ab6-105">For example, there could be simultaneous node and fault domain failures - what would happen if that occurred during an upgrade?</span></span> <span data-ttu-id="31ab6-106">Klustret Resource Manager försöker alltid åtgärda allt, förbrukar klusterresurser försök att ordna om och rätta till klustret.</span><span class="sxs-lookup"><span data-stu-id="31ab6-106">The Cluster Resource Manager always tries to fix everything, consuming the cluster's resources trying to reorganize and fix the cluster.</span></span> <span data-ttu-id="31ab6-107">Begränsningar ger en backstop så att klustret kan använda resurser för att hålla - noderna komma tillbaka, network-partitioner läka, korrigerade bits distribueras.</span><span class="sxs-lookup"><span data-stu-id="31ab6-107">Throttles help provide a backstop so that the cluster can use resources to stabilize - the nodes come back, the network partitions heal, corrected bits get deployed.</span></span>

<span data-ttu-id="31ab6-108">Om du vill hjälpa till med sådana här situationer, innehåller Service Fabric klustret Resource Manager flera begränsningar.</span><span class="sxs-lookup"><span data-stu-id="31ab6-108">To help with these sorts of situations, the Service Fabric Cluster Resource Manager includes several throttles.</span></span> <span data-ttu-id="31ab6-109">Dessa begränsningar är alla ganska stort hammare.</span><span class="sxs-lookup"><span data-stu-id="31ab6-109">These throttles are all fairly large hammers.</span></span> <span data-ttu-id="31ab6-110">I allmänhet de får inte ändras utan noggrann planering och testning.</span><span class="sxs-lookup"><span data-stu-id="31ab6-110">Generally they shouldn’t be changed without careful planning and testing.</span></span>

<span data-ttu-id="31ab6-111">Om du ändrar klustret Resource Manager begränsas, bör du finjustera dem till din förväntade faktiska belastningen.</span><span class="sxs-lookup"><span data-stu-id="31ab6-111">If you change the Cluster Resource Manager's throttles, you should tune them to your expected actual load.</span></span> <span data-ttu-id="31ab6-112">Du kan bestämma du behöver ha vissa begränsningar på plats, även om det innebär att klustret tar längre tid att hålla i vissa situationer.</span><span class="sxs-lookup"><span data-stu-id="31ab6-112">You may determine you need to have some throttles in place, even if it means the cluster takes longer to stabilize in some situations.</span></span> <span data-ttu-id="31ab6-113">Testa krävs för att fastställa korrekta värden för begränsas.</span><span class="sxs-lookup"><span data-stu-id="31ab6-113">Testing is required to determine the correct values for throttles.</span></span> <span data-ttu-id="31ab6-114">Begränsas måste vara tillräckligt högt för att klustret ska svara på ändringar i rimlig tid och låg nivå faktiskt att för mycket resursförbrukning.</span><span class="sxs-lookup"><span data-stu-id="31ab6-114">Throttles need to be high enough to allow the cluster to respond to changes in a reasonable amount of time, and low enough to actually prevent too much resource consumption.</span></span> 

<span data-ttu-id="31ab6-115">I de flesta fall har vi sett kunder använder begränsningar har eftersom de redan i en miljö med begränsad resurs.</span><span class="sxs-lookup"><span data-stu-id="31ab6-115">Most of the time we’ve seen customers use throttles it has been because they were already in a resource constrained environment.</span></span> <span data-ttu-id="31ab6-116">Några exempel är begränsad nätverksbandbredd för enskilda noder eller diskar som inte kan bygga många tillståndskänslig repliker parallellt på grund av begränsningar i genomflöde.</span><span class="sxs-lookup"><span data-stu-id="31ab6-116">Some examples would be limited network bandwidth for individual nodes, or disks that aren't able to build many stateful replicas in parallel due to throughput limitations.</span></span> <span data-ttu-id="31ab6-117">Utan begränsningar, kunde operations överväldigande resurserna orsakar åtgärder att misslyckas eller vara långsam.</span><span class="sxs-lookup"><span data-stu-id="31ab6-117">Without throttles, operations could overwhelm these resources, causing operations to fail or be slow.</span></span> <span data-ttu-id="31ab6-118">I sådana situationer kunder används begränsningar och känner de utöka hur lång tid tar det klustret för att nå ett stabilt tillstånd.</span><span class="sxs-lookup"><span data-stu-id="31ab6-118">In these situations customers used throttles and knew they were extending the amount of time it would take the cluster to reach a stable state.</span></span> <span data-ttu-id="31ab6-119">Kunder kan också förstått de kan hamna körs med lägre pålitlighet när de har begränsats.</span><span class="sxs-lookup"><span data-stu-id="31ab6-119">Customers also understood they could end up running at lower overall reliability while they were throttled.</span></span>


## <a name="configuring-the-throttles"></a><span data-ttu-id="31ab6-120">Konfigurera begränsningar</span><span class="sxs-lookup"><span data-stu-id="31ab6-120">Configuring the throttles</span></span>

<span data-ttu-id="31ab6-121">Service Fabric har två mekanismer för begränsning av antalet replik förflyttningar.</span><span class="sxs-lookup"><span data-stu-id="31ab6-121">Service Fabric has two mechanisms for throttling the number of replica movements.</span></span> <span data-ttu-id="31ab6-122">Standardmekanism som fanns före Service Fabric 5.7 representerar begränsning som ett absolut antal flyttar tillåts.</span><span class="sxs-lookup"><span data-stu-id="31ab6-122">The default mechanism that existed before Service Fabric 5.7 represents throttling as an absolute number of moves allowed.</span></span> <span data-ttu-id="31ab6-123">Detta fungerar inte för kluster i alla storlekar.</span><span class="sxs-lookup"><span data-stu-id="31ab6-123">This does not work for clusters of all sizes.</span></span> <span data-ttu-id="31ab6-124">I synnerhet för stora kluster kan standardvärdet vara för liten avsevärt långsammare belastningsutjämning även när det är nödvändigt, samtidigt som du har ingen effekt i mindre kluster.</span><span class="sxs-lookup"><span data-stu-id="31ab6-124">In particular, for large clusters the default value can be too small, significantly slowing down balancing even when it is necessary, while having no effect in smaller clusters.</span></span> <span data-ttu-id="31ab6-125">Denna mekanism för tidigare har ersatts av procent-baserade begränsning som skalas bättre med dynamiska kluster antalet tjänster och noder ändras regelbundet.</span><span class="sxs-lookup"><span data-stu-id="31ab6-125">This prior mechanism has been superseded by percentage-based throttling, which scales better with dynamic clusters in which the number of services and nodes change regularly.</span></span>

<span data-ttu-id="31ab6-126">Begränsas baseras på en procentandel av antalet repliker i kluster.</span><span class="sxs-lookup"><span data-stu-id="31ab6-126">The throttles are based on a percentage of the number of replicas in the clusters.</span></span> <span data-ttu-id="31ab6-127">Percetage baserat begränsas aktivera uttrycka regeln: ”inte flytta mer än 10% av repliker 10: e minut”, till exempel.</span><span class="sxs-lookup"><span data-stu-id="31ab6-127">Percetage based throttles enable expressing the rule: "do not move more than 10% of replicas in a 10 minute interval", for example.</span></span>

<span data-ttu-id="31ab6-128">Konfigurationsinställningarna för procent-baserade begränsning är:</span><span class="sxs-lookup"><span data-stu-id="31ab6-128">The configuration settings for percentage-based throttling are:</span></span>

  - <span data-ttu-id="31ab6-129">GlobalMovementThrottleThresholdPercentage - maximalt antal förflyttningar tillåts i klustret när som helst, uttryckt i procent av totalt antal repliker i klustret.</span><span class="sxs-lookup"><span data-stu-id="31ab6-129">GlobalMovementThrottleThresholdPercentage - Maximum number of movements allowed in cluster at any time, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="31ab6-130">0 anger att ingen gräns.</span><span class="sxs-lookup"><span data-stu-id="31ab6-130">0 indicates no limit.</span></span> <span data-ttu-id="31ab6-131">Standardvärdet är 0.</span><span class="sxs-lookup"><span data-stu-id="31ab6-131">The default value is 0.</span></span> <span data-ttu-id="31ab6-132">Om både den här inställningen och GlobalMovementThrottleThreshold anges, används mer konservativ gränsen.</span><span class="sxs-lookup"><span data-stu-id="31ab6-132">If both this setting and GlobalMovementThrottleThreshold are specified, then the more conservative limit is used.</span></span>
  - <span data-ttu-id="31ab6-133">GlobalMovementThrottleThresholdPercentageForPlacement - maximalt antal förflyttningar av typ får användas under fasen placering uttryckt i procent av totalt antal repliker i klustret.</span><span class="sxs-lookup"><span data-stu-id="31ab6-133">GlobalMovementThrottleThresholdPercentageForPlacement - Maximum number of movements allowed during the placement phase, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="31ab6-134">0 anger att ingen gräns.</span><span class="sxs-lookup"><span data-stu-id="31ab6-134">0 indicates no limit.</span></span> <span data-ttu-id="31ab6-135">Standardvärdet är 0.</span><span class="sxs-lookup"><span data-stu-id="31ab6-135">The default value is 0.</span></span> <span data-ttu-id="31ab6-136">Om både den här inställningen och GlobalMovementThrottleThresholdForPlacement anges, används mer konservativ gränsen.</span><span class="sxs-lookup"><span data-stu-id="31ab6-136">If both this setting and GlobalMovementThrottleThresholdForPlacement are specified, then the more conservative limit is used.</span></span>
  - <span data-ttu-id="31ab6-137">GlobalMovementThrottleThresholdPercentageForBalancing - maximalt antal förflyttningar av typ får användas under fasen belastningsutjämning uttryckt i procent av totalt antal repliker i klustret.</span><span class="sxs-lookup"><span data-stu-id="31ab6-137">GlobalMovementThrottleThresholdPercentageForBalancing - Maximum number of movements allowed during the balancing phase, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="31ab6-138">0 anger att ingen gräns.</span><span class="sxs-lookup"><span data-stu-id="31ab6-138">0 indicates no limit.</span></span> <span data-ttu-id="31ab6-139">Standardvärdet är 0.</span><span class="sxs-lookup"><span data-stu-id="31ab6-139">The default value is 0.</span></span> <span data-ttu-id="31ab6-140">Om både den här inställningen och GlobalMovementThrottleThresholdForBalancing anges, används mer konservativ gränsen.</span><span class="sxs-lookup"><span data-stu-id="31ab6-140">If both this setting and GlobalMovementThrottleThresholdForBalancing are specified, then the more conservative limit is used.</span></span>

<span data-ttu-id="31ab6-141">När du anger den begränsning i procent, anger du 5% som 0,05.</span><span class="sxs-lookup"><span data-stu-id="31ab6-141">When specifying the throttle percentage, you'd specify 5% as 0.05.</span></span> <span data-ttu-id="31ab6-142">Intervallet som dessa begränsningar regleras är GlobalMovementThrottleCountingInterval som anges i sekunder.</span><span class="sxs-lookup"><span data-stu-id="31ab6-142">The interval on which these throttles are governed is the GlobalMovementThrottleCountingInterval, which is specified in seconds.</span></span>


``` xml
<Section Name="PlacementAndLoadBalancing">
     <Parameter Name="GlobalMovementThrottleThresholdPercentage" Value="0" />
     <Parameter Name="GlobalMovementThrottleThresholdPercentageForPlacement" Value="0" />
     <Parameter Name="GlobalMovementThrottleThresholdPercentageForBalancing" Value="0" />
     <Parameter Name="GlobalMovementThrottleCountingInterval" Value="600" />
</Section>
```

<span data-ttu-id="31ab6-143">värdbaserade kluster via ClusterConfig.json för fristående distributioner eller Template.json för Azure:</span><span class="sxs-lookup"><span data-stu-id="31ab6-143">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "GlobalMovementThrottleThresholdPercentage",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleThresholdPercentageForPlacement",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleThresholdPercentageForBalancing",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleCountingInterval",
          "value": "600"
      }
    ]
  }
]
```

### <a name="default-count-based-throttles"></a><span data-ttu-id="31ab6-144">Standard antal baserat begränsningar</span><span class="sxs-lookup"><span data-stu-id="31ab6-144">Default count based throttles</span></span>
<span data-ttu-id="31ab6-145">Den här informationen anges om du har äldre kluster eller fortfarande behålla dessa konfigurationer i kluster som sedan har uppgraderats.</span><span class="sxs-lookup"><span data-stu-id="31ab6-145">This information is provided in case you have older clusters or still retain these configurations in clusters that have since been upgraded.</span></span> <span data-ttu-id="31ab6-146">I allmänhet rekommenderar vi att dessa ersätts med ovan procent-baserade begränsas.</span><span class="sxs-lookup"><span data-stu-id="31ab6-146">In general, it is recommended that these are replaced with the percentage-based throttles above.</span></span> <span data-ttu-id="31ab6-147">Eftersom procent-baserade begränsning är inaktiverad som standard förblir dessa begränsningar standard begränsningar för ett kluster tills de är inaktiverade och ersätts med procent-baserade begränsas.</span><span class="sxs-lookup"><span data-stu-id="31ab6-147">Since percentage-based throttling is disabled by default, these throttles remain the default throttles for a cluster until they are disabled and replaced with the percentage-based throttles.</span></span> 

  - <span data-ttu-id="31ab6-148">GlobalMovementThrottleThreshold – den här inställningen styr det totala antalet förflyttningar i klustret över tid.</span><span class="sxs-lookup"><span data-stu-id="31ab6-148">GlobalMovementThrottleThreshold – this setting controls the total number of movements in the cluster over some time.</span></span> <span data-ttu-id="31ab6-149">Hur lång tid har angetts i sekunder som GlobalMovementThrottleCountingInterval.</span><span class="sxs-lookup"><span data-stu-id="31ab6-149">The amount of time is specified in seconds as the GlobalMovementThrottleCountingInterval.</span></span> <span data-ttu-id="31ab6-150">Standardvärdet för GlobalMovementThrottleThreshold är 1000 och standardvärdet för GlobalMovementThrottleCountingInterval är 600.</span><span class="sxs-lookup"><span data-stu-id="31ab6-150">The default value for the GlobalMovementThrottleThreshold is 1000 and the default value for the GlobalMovementThrottleCountingInterval is 600.</span></span>
  - <span data-ttu-id="31ab6-151">MovementPerPartitionThrottleThreshold – den här inställningen styr det totala antalet förflyttningar för alla partitioner för tjänsten över tid.</span><span class="sxs-lookup"><span data-stu-id="31ab6-151">MovementPerPartitionThrottleThreshold – this setting controls the total number of movements for any service partition over some time.</span></span> <span data-ttu-id="31ab6-152">Hur lång tid har angetts i sekunder som MovementPerPartitionThrottleCountingInterval.</span><span class="sxs-lookup"><span data-stu-id="31ab6-152">The amount of time is specified in seconds as the MovementPerPartitionThrottleCountingInterval.</span></span> <span data-ttu-id="31ab6-153">Standardvärdet för MovementPerPartitionThrottleThreshold är 50 och standardvärdet för MovementPerPartitionThrottleCountingInterval är 600.</span><span class="sxs-lookup"><span data-stu-id="31ab6-153">The default value for the MovementPerPartitionThrottleThreshold is 50 and the default value for the MovementPerPartitionThrottleCountingInterval is 600.</span></span>

<span data-ttu-id="31ab6-154">Konfigurationen för dessa begränsningar följer samma mönster som procentandel-baserade begränsning.</span><span class="sxs-lookup"><span data-stu-id="31ab6-154">The configuration for these throttles follows the same pattern as the percentage-based throttling.</span></span>

## <a name="next-steps"></a><span data-ttu-id="31ab6-155">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="31ab6-155">Next steps</span></span>
- <span data-ttu-id="31ab6-156">Om du vill veta mer om hur klustret Resource Manager hanterar och balanserar belastningen i klustret kan ta en titt i artikeln på [belastningsutjämning](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="31ab6-156">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>
- <span data-ttu-id="31ab6-157">Klustret Resource Manager har många alternativ för att beskriva klustret.</span><span class="sxs-lookup"><span data-stu-id="31ab6-157">The Cluster Resource Manager has many options for describing the cluster.</span></span> <span data-ttu-id="31ab6-158">Kolla in den här artikeln om du vill veta mer om dem på [som beskriver ett Service Fabric-kluster](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="31ab6-158">To find out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
