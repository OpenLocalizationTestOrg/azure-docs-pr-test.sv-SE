---
title: "aaaUsing Elasticsearch som trace för Service Fabric programarkivet | Microsoft Docs"
description: "Beskriver hur Service Fabric-program kan använda Elasticsearch och Kibana toostore, index och Sök igenom programspårningar (loggarna)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="23d32-103">Använd Elasticsearch som en spårning i Service Fabric-programmet lagrar</span><span class="sxs-lookup"><span data-stu-id="23d32-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="23d32-104">Introduktion</span><span class="sxs-lookup"><span data-stu-id="23d32-104">Introduction</span></span>
<span data-ttu-id="23d32-105">Den här artikeln beskriver hur [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) program kan använda **Elasticsearch** och **Kibana** för programmet trace lagring, indexering och sökning.</span><span class="sxs-lookup"><span data-stu-id="23d32-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="23d32-106">[Elasticsearch](https://www.elastic.co/guide/index.html) är en öppen källkod, distribuerade och skalbar realtid Sök och analytics-motor som lämpar sig väl för den här uppgiften.</span><span class="sxs-lookup"><span data-stu-id="23d32-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="23d32-107">Den kan installeras på Windows- och Linux virtuella datorer som körs i Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="23d32-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="23d32-108">Elasticsearch effektivt kan bearbeta *strukturerade* spår som genereras med hjälp av teknik som **ETW Event Tracing for Windows ()**.</span><span class="sxs-lookup"><span data-stu-id="23d32-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="23d32-109">ETW används av Service Fabric runtime toosource diagnostisk information (spår).</span><span class="sxs-lookup"><span data-stu-id="23d32-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="23d32-110">Det är hello rekommenderad metod för Service Fabric program toosource sina diagnostisk information för.</span><span class="sxs-lookup"><span data-stu-id="23d32-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="23d32-111">Med hjälp av hello som gör att samma mekanism för korrelation mellan angivna runtime och tillämpningsprogrammet spår och gör felsökningen lättare.</span><span class="sxs-lookup"><span data-stu-id="23d32-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="23d32-112">Mallar för Service Fabric-projekt i Visual Studio omfattar en loggning API: T (baserat på hello .NET **EventSource** klassen) som skickar ETW-spårning som standard.</span><span class="sxs-lookup"><span data-stu-id="23d32-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="23d32-113">En allmän översikt över Service Fabric application spårning med ETW, se [övervakning och diagnos av tjänster i en inställning för lokal dator development](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="23d32-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="23d32-114">För hello spårningar tooshow in i Elasticsearch behöver de toobe hämtats vid hello Service Fabric-klusternoder i realtid (medan programmet hello körs) och skickas tooan Elasticsearch slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="23d32-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="23d32-115">Det finns två huvudsakliga alternativ för spårning fånga in:</span><span class="sxs-lookup"><span data-stu-id="23d32-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="23d32-116">**Processen spårning fånga in**</span><span class="sxs-lookup"><span data-stu-id="23d32-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="23d32-117">hello program eller mer exakt tjänstprocessen ansvarar för att skicka ut hello diagnostikdata toohello trace store (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="23d32-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="23d32-118">**Out-of-process spårning fånga in**</span><span class="sxs-lookup"><span data-stu-id="23d32-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="23d32-119">En separat agent fånga in spårningar från hello tjänstprocessen eller processer och skickar dem toohello trace store.</span><span class="sxs-lookup"><span data-stu-id="23d32-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="23d32-120">Nedan, beskriver vi hur tooset in Elasticsearch på Azure, diskutera hello-tekniker och nackdelar för både avbilda alternativ och förklara hur tooconfigure ett Service Fabric-tjänsten toosend data tooElasticsearch.</span><span class="sxs-lookup"><span data-stu-id="23d32-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="23d32-121">Ställ in Elasticsearch på Azure</span><span class="sxs-lookup"><span data-stu-id="23d32-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="23d32-122">hello enklaste sättet tooset hello Elasticsearch tjänsten i Azure är via [ **Azure Resource Manager-mallar**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="23d32-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="23d32-123">En omfattande [Quickstart Azure Resource Manager-mall för Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) är tillgänglig från lagringsplatsen för Azure Quickstart-mallar.</span><span class="sxs-lookup"><span data-stu-id="23d32-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="23d32-124">Den här mallen använder separata storage-konton för skalenheter (grupper av noder).</span><span class="sxs-lookup"><span data-stu-id="23d32-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="23d32-125">Det kan också etablera separata klient och server-noder med olika konfigurationer och olika mängder datadiskar som är anslutna.</span><span class="sxs-lookup"><span data-stu-id="23d32-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="23d32-126">Här kan vi använder en annan mall, kallas **ES MultiNode** från hello [Azure diagnostikverktyg](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="23d32-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="23d32-127">Den här mallen är enklare toouse och skapar ett Elasticsearch kluster som skyddas av grundläggande HTTP-autentisering.</span><span class="sxs-lookup"><span data-stu-id="23d32-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="23d32-128">Innan du fortsätter måste du hämta hello databasen från GitHub tooyour dator (genom att antingen kloning hello databasen eller hämtar en zip-fil).</span><span class="sxs-lookup"><span data-stu-id="23d32-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="23d32-129">hello ES MultiNode mall finns i hello mappen med hello samma namn.</span><span class="sxs-lookup"><span data-stu-id="23d32-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="23d32-130">Förbered en dator toorun Elasticsearch installationsskript</span><span class="sxs-lookup"><span data-stu-id="23d32-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="23d32-131">hello enklaste sättet toouse hello ES MultiNode mallen är via ett tillhandahållna Azure PowerShell-skript som heter `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="23d32-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="23d32-132">toouse det här skriptet kan du behöver tooinstall PowerShell-moduler och ett verktyg som kallas **openssl**.</span><span class="sxs-lookup"><span data-stu-id="23d32-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="23d32-133">hello senare krävs för att skapa en SSH-nyckel som kan använda tooadminister Elasticsearch klustret via fjärranslutning.</span><span class="sxs-lookup"><span data-stu-id="23d32-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="23d32-134">`CreateElasticSearchCluster`skript är utformad för enkel användning med hello ES MultiNode mall från en Windows-dator.</span><span class="sxs-lookup"><span data-stu-id="23d32-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="23d32-135">Det är möjligt toouse hello mall på en icke-Windows-dator, men det scenariot ligger utanför hello i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="23d32-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="23d32-136">Om du inte har installerat dem redan [ **Azure PowerShell-moduler**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="23d32-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="23d32-137">När du uppmanas, klickar du på **kör**, sedan **installera**.</span><span class="sxs-lookup"><span data-stu-id="23d32-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="23d32-138">Azure PowerShell 1.3 eller senare krävs.</span><span class="sxs-lookup"><span data-stu-id="23d32-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="23d32-139">Hej **openssl** tool ingår i hello fördelning av [ **Git för Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="23d32-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="23d32-140">Om du redan inte har gjort det, installera [Git för Windows](http://www.git-scm.com/downloads) nu.</span><span class="sxs-lookup"><span data-stu-id="23d32-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="23d32-141">(hello standard installationsalternativ är OK.)</span><span class="sxs-lookup"><span data-stu-id="23d32-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="23d32-142">Förutsatt att Git har installerats men ingår inte i systemsökvägen hello, öppna ett Microsoft Azure PowerShell-fönster och kör följande kommandon hello:</span><span class="sxs-lookup"><span data-stu-id="23d32-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="23d32-143">Ersätt hello `<Git installation folder>` med hello Git plats på din dator; hello standardvärdet är **”C:\Program Files\Git”**.</span><span class="sxs-lookup"><span data-stu-id="23d32-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="23d32-144">Observera hello semikolon hello början av hello första sökväg.</span><span class="sxs-lookup"><span data-stu-id="23d32-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="23d32-145">Kontrollera att du är inloggad på tooAzure (via [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) och att du har valt hello-prenumeration som ska användas toocreate elastisk Sök klustret.</span><span class="sxs-lookup"><span data-stu-id="23d32-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="23d32-146">Du kan kontrollera att korrekt prenumeration har valts med hjälp av `Get-AzureRmContext` och `Get-AzureRmSubscription` cmdlets.</span><span class="sxs-lookup"><span data-stu-id="23d32-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="23d32-147">Om du inte redan gjort det, kan du ändra hello aktuella toohello ES MultiNode katalogmapp.</span><span class="sxs-lookup"><span data-stu-id="23d32-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="23d32-148">Kör hello CreateElasticSearchCluster skript</span><span class="sxs-lookup"><span data-stu-id="23d32-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="23d32-149">Innan du kör skriptet hello öppna hello `azuredeploy-parameters.json` filen och verifiera eller ange värden för hello Skriptparametrar.</span><span class="sxs-lookup"><span data-stu-id="23d32-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="23d32-150">hello följande parametrar finns:</span><span class="sxs-lookup"><span data-stu-id="23d32-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="23d32-151">Parameternamn</span><span class="sxs-lookup"><span data-stu-id="23d32-151">Parameter Name</span></span> | <span data-ttu-id="23d32-152">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="23d32-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="23d32-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="23d32-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="23d32-154">hello namn som används toocreate hello synligt offentligt DNS-namn för hello elastisk Sök-kluster (genom att lägga till hello Azure-region toohello tillhandahålls domännamn).</span><span class="sxs-lookup"><span data-stu-id="23d32-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="23d32-155">Om det här parametervärdet är ”myBigCluster” och hello valt Azure-regionen är västra USA är hello resulterande DNS-namn för hello klustret myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="23d32-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="23d32-156">Det här namnet fungerar också som ett namn för skogsrotsdomänen för många artefakter som är associerade med hello elastisk Sök klustret, till exempel data nodnamn.</span><span class="sxs-lookup"><span data-stu-id="23d32-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="23d32-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="23d32-157">adminUsername</span></span> |<span data-ttu-id="23d32-158">hello namnet på hello administratörskonto för att hantera hello elastisk Sök kluster (motsvarande SSH-nycklar genereras automatiskt).</span><span class="sxs-lookup"><span data-stu-id="23d32-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="23d32-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="23d32-159">dataNodeCount</span></span> |<span data-ttu-id="23d32-160">hello antalet noder i klustret för hello elastisk sökning.</span><span class="sxs-lookup"><span data-stu-id="23d32-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="23d32-161">hello nuvarande version av hello skript skiljer inte mellan data och fråga noder. alla noder spela upp båda rollerna.</span><span class="sxs-lookup"><span data-stu-id="23d32-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="23d32-162">Standardvärden too3 noder.</span><span class="sxs-lookup"><span data-stu-id="23d32-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="23d32-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="23d32-163">dataDiskSize</span></span> |<span data-ttu-id="23d32-164">hello storleken på diskar (i GB) som har allokerats för varje datanod.</span><span class="sxs-lookup"><span data-stu-id="23d32-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="23d32-165">Varje nod som tar emot 4 datadiskar uteslutande dedikerade tooElastic Search-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="23d32-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="23d32-166">Region</span><span class="sxs-lookup"><span data-stu-id="23d32-166">region</span></span> |<span data-ttu-id="23d32-167">hello namnet på Azure-region där hello elastisk Sök klustret ska finnas.</span><span class="sxs-lookup"><span data-stu-id="23d32-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="23d32-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="23d32-168">esUserName</span></span> |<span data-ttu-id="23d32-169">hello konfigurerat användarnamnet för hello-användare som är toohave åtkomst tooES kluster (ämne tooHTTP grundläggande autentisering).</span><span class="sxs-lookup"><span data-stu-id="23d32-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="23d32-170">hello lösenord ingår inte i parameterfilen och måste anges när `CreateElasticSearchCluster` anropas skriptet.</span><span class="sxs-lookup"><span data-stu-id="23d32-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="23d32-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="23d32-171">vmSizeDataNodes</span></span> |<span data-ttu-id="23d32-172">hello Azure virtuell datorstorlek för elastiska Sök klusternoder.</span><span class="sxs-lookup"><span data-stu-id="23d32-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="23d32-173">Standardvärden tooStandard_D2.</span><span class="sxs-lookup"><span data-stu-id="23d32-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="23d32-174">Nu är du redo toorun hello skript.</span><span class="sxs-lookup"><span data-stu-id="23d32-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="23d32-175">Utfärda hello följande kommando:</span><span class="sxs-lookup"><span data-stu-id="23d32-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="23d32-176">där</span><span class="sxs-lookup"><span data-stu-id="23d32-176">where</span></span> 

| <span data-ttu-id="23d32-177">Parameternamn för skript</span><span class="sxs-lookup"><span data-stu-id="23d32-177">Script Parameter Name</span></span> | <span data-ttu-id="23d32-178">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="23d32-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="23d32-179">hello namnet på hello Azure-resursgrupp som innehåller alla elastisk Sök klusterresurser.</span><span class="sxs-lookup"><span data-stu-id="23d32-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="23d32-180">hello namnet på hello Azure-region där hello elastisk Sök klustret ska skapas.</span><span class="sxs-lookup"><span data-stu-id="23d32-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="23d32-181">hello lösenordet för hello elastisk Sök användare.</span><span class="sxs-lookup"><span data-stu-id="23d32-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="23d32-182">Om du får en NullReferenceException från hello Test-AzureResourceGroup cmdlet du har glömt toolog på tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="23d32-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="23d32-183">Om du får ett felmeddelande från hello-skript och du bestämma att hello felet orsakades av ett fel mall parametervärde, korrigera hello parameterfilen och kör hello skriptet igen med ett annat resursnamn för gruppen.</span><span class="sxs-lookup"><span data-stu-id="23d32-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="23d32-184">Du kan återanvända hello samma resursgruppens namn och har hello skript Rensa hello gamla genom att lägga till hello `-RemoveExistingResourceGroup` parametern toohello skript anrop.</span><span class="sxs-lookup"><span data-stu-id="23d32-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="23d32-185">Resultatet för hello CreateElasticSearchCluster skript som körs</span><span class="sxs-lookup"><span data-stu-id="23d32-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="23d32-186">När du har kört hello `CreateElasticSearchCluster` skript hello följande huvudsakliga artefakter kommer att skapas.</span><span class="sxs-lookup"><span data-stu-id="23d32-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="23d32-187">I det här exemplet förutsätter vi att du har använt ”myBigCluster” som hello värde för hello `dnsNameForLoadBalancerIP` parametern och hello regionen där du skapade hello är västra USA.</span><span class="sxs-lookup"><span data-stu-id="23d32-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="23d32-188">Artefakt</span><span class="sxs-lookup"><span data-stu-id="23d32-188">Artifact</span></span> | <span data-ttu-id="23d32-189">Namn, plats och kommentarer</span><span class="sxs-lookup"><span data-stu-id="23d32-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="23d32-190">SSH-nyckeln för fjärradministration</span><span class="sxs-lookup"><span data-stu-id="23d32-190">SSH key for remote administration</span></span> |<span data-ttu-id="23d32-191">myBigCluster.key fil (i hello från vilka hello CreateElasticSearchCluster kördes).</span><span class="sxs-lookup"><span data-stu-id="23d32-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="23d32-192">Nyckeln kan vara används tooconnect toohello Administratörsnod och (via hello Administratörsnod) toodata noder i klustret hello.</span><span class="sxs-lookup"><span data-stu-id="23d32-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="23d32-193">Admin-nod</span><span class="sxs-lookup"><span data-stu-id="23d32-193">Admin node</span></span> |<span data-ttu-id="23d32-194">myBigCluster admin.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="23d32-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="23d32-195">En särskild virtuell dator för Elasticsearch klustret fjärradministration--hello endast en som gör att externa SSH-anslutningar.</span><span class="sxs-lookup"><span data-stu-id="23d32-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="23d32-196">Den körs på hello har samma virtuella nätverk som alla klusternoder för hello Elasticsearch, men det inte att köra några Elasticsearch-tjänster.</span><span class="sxs-lookup"><span data-stu-id="23d32-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="23d32-197">Datanoder</span><span class="sxs-lookup"><span data-stu-id="23d32-197">Data nodes</span></span> |<span data-ttu-id="23d32-198">myBigCluster1...</span><span class="sxs-lookup"><span data-stu-id="23d32-198">myBigCluster1 …</span></span> <span data-ttu-id="23d32-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="23d32-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="23d32-200">Datanoder som kör Elasticsearch och Kibana tjänster.</span><span class="sxs-lookup"><span data-stu-id="23d32-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="23d32-201">Du kan ansluta via SSH tooeach noden, men endast via hello admin-nod.</span><span class="sxs-lookup"><span data-stu-id="23d32-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="23d32-202">Elasticsearch kluster</span><span class="sxs-lookup"><span data-stu-id="23d32-202">Elasticsearch cluster</span></span> |<span data-ttu-id="23d32-203">http://myBigCluster.westus.cloudapp.Azure.com/ES/</span><span class="sxs-lookup"><span data-stu-id="23d32-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="23d32-204">hello primär slutpunkt för hello Elasticsearch kluster (Obs hello /es suffix).</span><span class="sxs-lookup"><span data-stu-id="23d32-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="23d32-205">Den är skyddad av grundläggande HTTP-autentisering (hello autentiseringsuppgifter var hello angivna esUserName/esPassword parametrar för hello ES MultiNode mall).</span><span class="sxs-lookup"><span data-stu-id="23d32-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="23d32-206">hello-klustret har också hello head plugin-program installerat (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) för grundläggande klusteradministration.</span><span class="sxs-lookup"><span data-stu-id="23d32-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="23d32-207">Kibana service</span><span class="sxs-lookup"><span data-stu-id="23d32-207">Kibana service</span></span> |<span data-ttu-id="23d32-208">http://myBigCluster.westus.cloudapp.Azure.com</span><span class="sxs-lookup"><span data-stu-id="23d32-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="23d32-209">Hej Kibana tjänst har ställts in tooshow data från hello skapade Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="23d32-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="23d32-210">Den är skyddad av hello samma autentiseringsuppgifter som hello kluster sig själv.</span><span class="sxs-lookup"><span data-stu-id="23d32-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="23d32-211">I processen jämfört med out-of-process spårning fånga in</span><span class="sxs-lookup"><span data-stu-id="23d32-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="23d32-212">I hello introduktion nämndes två huvudsakliga sätt för att samla in diagnostikdata: i processen och out-of-process.</span><span class="sxs-lookup"><span data-stu-id="23d32-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="23d32-213">Varje har styrkor och svagheter.</span><span class="sxs-lookup"><span data-stu-id="23d32-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="23d32-214">Fördelarna med hello **pågående spårning fånga** omfattar:</span><span class="sxs-lookup"><span data-stu-id="23d32-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="23d32-215">*Enkel konfiguration och distribution*</span><span class="sxs-lookup"><span data-stu-id="23d32-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="23d32-216">hello konfigurationen av diagnostikdata samlingen har bara en del av hello tillämpningsprogrammets konfiguration.</span><span class="sxs-lookup"><span data-stu-id="23d32-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="23d32-217">Det är enkelt tooalways behålla det ”synkroniserad” med hello resten av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="23d32-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="23d32-218">Programspecifika eller per service configuration kan enkelt uppnås.</span><span class="sxs-lookup"><span data-stu-id="23d32-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="23d32-219">Out-of-process spårning fånga kräver vanligtvis en separat distributionen och konfigurationen av hello diagnostikagenten som är en extra administrativa uppgifter och en tänkbar orsak till fel.</span><span class="sxs-lookup"><span data-stu-id="23d32-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="23d32-220">hello viss agent teknologin tillåter ofta endast en instans av hello agent per virtuell dator (nod).</span><span class="sxs-lookup"><span data-stu-id="23d32-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="23d32-221">Det innebär att konfigurationen för hello samling hello diagnostikkonfiguration delas med alla program och tjänster som körs på noden.</span><span class="sxs-lookup"><span data-stu-id="23d32-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="23d32-222">*Flexibilitet*</span><span class="sxs-lookup"><span data-stu-id="23d32-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="23d32-223">hello-program kan skicka hello data oavsett var den måste toogo, så länge det finns ett klientbiblioteket som stöder hello riktade Datalagringssystemet.</span><span class="sxs-lookup"><span data-stu-id="23d32-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="23d32-224">Nya sänkor kan läggas till på önskat sätt.</span><span class="sxs-lookup"><span data-stu-id="23d32-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="23d32-225">Komplexa capture, filtrering och Datasammanställning regler kan implementeras.</span><span class="sxs-lookup"><span data-stu-id="23d32-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="23d32-226">En out-of-process spårning fånga in begränsas ofta av hello data sänkor som hello har stöd för agenten.</span><span class="sxs-lookup"><span data-stu-id="23d32-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="23d32-227">Vissa agenter är extensible.</span><span class="sxs-lookup"><span data-stu-id="23d32-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="23d32-228">*Åtkomst toointernal programdata och kontext*</span><span class="sxs-lookup"><span data-stu-id="23d32-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="23d32-229">hello diagnostiska undersystemet körs i processen för hello-program/tjänst kan enkelt utöka hello spårningar med relevant information.</span><span class="sxs-lookup"><span data-stu-id="23d32-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="23d32-230">Hello out-of-process inriktning måste hello data skickas tooan agent via någon mekanism för kommunikation mellan processer, till exempel händelsespårning för Windows.</span><span class="sxs-lookup"><span data-stu-id="23d32-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="23d32-231">Den här mekanismen kan införa ytterligare begränsningar.</span><span class="sxs-lookup"><span data-stu-id="23d32-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="23d32-232">Fördelarna med hello **out-of-process spårning fånga** omfattar:</span><span class="sxs-lookup"><span data-stu-id="23d32-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="23d32-233">*Hej möjlighet toomonitor hello program och samla in Dumpar krascher*</span><span class="sxs-lookup"><span data-stu-id="23d32-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="23d32-234">I processen spårning fånga kanske misslyckas om programmet hello misslyckas toostart eller kraschar.</span><span class="sxs-lookup"><span data-stu-id="23d32-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="23d32-235">En oberoende agent har mycket större möjlighet att samla in viktig information för felsökning.</span><span class="sxs-lookup"><span data-stu-id="23d32-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="23d32-236">*Förfall, stabilitet och beprövade prestanda*</span><span class="sxs-lookup"><span data-stu-id="23d32-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="23d32-237">En agent som utvecklats av en plattform leverantör (till exempel en agent för Microsoft Azure-diagnostik) har ämne toorigorous testning och slaget härdning.</span><span class="sxs-lookup"><span data-stu-id="23d32-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="23d32-238">Med pågående spårning fånga, iakttas försiktighet tooensure att hello aktiviteten för att skicka diagnostikdata från en process för programmet inte påverka hello programmets huvudsakliga aktiviteter eller införa tidsinställning eller prestanda.</span><span class="sxs-lookup"><span data-stu-id="23d32-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="23d32-239">En separat körs agent är mindre risk toothese problem och är särskilt utformad toolimit dess påverkan på hello system.</span><span class="sxs-lookup"><span data-stu-id="23d32-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="23d32-240">Det är möjligt toocombine och utnyttja båda metoderna.</span><span class="sxs-lookup"><span data-stu-id="23d32-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="23d32-241">Faktiskt kanske hello bästa lösningen för många program.</span><span class="sxs-lookup"><span data-stu-id="23d32-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="23d32-242">Här kan vi använda hello **Microsoft.Diagnostic.Listeners biblioteket** och hello pågående spårning fånga toosend data från ett Service Fabric application tooan Elasticsearch kluster.</span><span class="sxs-lookup"><span data-stu-id="23d32-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="23d32-243">Använd hello lyssnare biblioteket toosend diagnostikdata tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="23d32-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="23d32-244">hello Microsoft.Diagnostic.Listeners biblioteket är en del av PartyCluster exempelprogrammet Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="23d32-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="23d32-245">toouse den:</span><span class="sxs-lookup"><span data-stu-id="23d32-245">toouse it:</span></span>

1. <span data-ttu-id="23d32-246">Hämta [hello PartyCluster exempel](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) från GitHub.</span><span class="sxs-lookup"><span data-stu-id="23d32-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="23d32-247">Kopiera hello Microsoft.Diagnostics.Listeners och Microsoft.Diagnostics.Listeners.Fabric projekt (hela mappar) från hello PartyCluster directory toohello lösningsmapp för hello-program som ska toosend hello data tooElasticsearch .</span><span class="sxs-lookup"><span data-stu-id="23d32-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="23d32-248">Öppna hello mål lösningen, högerklickar du på hello lösning nod hello Solution Explorer och välj **lägga till befintliga projekt**.</span><span class="sxs-lookup"><span data-stu-id="23d32-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="23d32-249">Lägg till hello Microsoft.Diagnostics.Listeners projekt toohello lösning.</span><span class="sxs-lookup"><span data-stu-id="23d32-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="23d32-250">Upprepa hello samma för hello Microsoft.Diagnostics.Listeners.Fabric projekt.</span><span class="sxs-lookup"><span data-stu-id="23d32-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="23d32-251">Lägg till en projektreferens från tjänsten projektet toohello två tillagda projekt.</span><span class="sxs-lookup"><span data-stu-id="23d32-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="23d32-252">(Varje tjänst som ska toosend data tooElasticsearch ska referera till Microsoft.Diagnostics.EventListeners och Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="23d32-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Projektet refererar till tooMicrosoft.Diagnostics.EventListeners och Microsoft.Diagnostics.EventListeners.Fabric bibliotek][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="23d32-254">Versionen av Service Fabric allmän tillgänglighet och Microsoft.Diagnostics.Tracing Nuget-paketet</span><span class="sxs-lookup"><span data-stu-id="23d32-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="23d32-255">Program som skapats med versionen av Service Fabric allmän tillgänglighet (2.0.135, publicerat den 31 mars 2016) mål **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="23d32-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="23d32-256">Den här versionen är hello högsta version av hello .NET Framework som stöds av Azure när hello hello GA-versionen.</span><span class="sxs-lookup"><span data-stu-id="23d32-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="23d32-257">Tyvärr kan saknar den här versionen av hello framework vissa EventListener APIs som hello Microsoft.Diagnostics.Listeners bibliotek måste.</span><span class="sxs-lookup"><span data-stu-id="23d32-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="23d32-258">Eftersom EventSource (hello komponent som ligger hello grund för loggning av API: er i Fabric-program) och EventListener nära tillsammans, måste varje projekt som använder hello Microsoft.Diagnostics.Listeners bibliotek använda en alternativ implementering av EventSource.</span><span class="sxs-lookup"><span data-stu-id="23d32-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="23d32-259">Den här implementeringen tillhandahålls av hello **Microsoft.Diagnostics.Tracing Nuget-paketet**, skapade av Microsoft.</span><span class="sxs-lookup"><span data-stu-id="23d32-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="23d32-260">hello-paketet är fullt bakåtkompatibel med EventSource som ingår i hello framework, så inga kodändringar ska vara nödvändiga än refererade namnområde ändringar.</span><span class="sxs-lookup"><span data-stu-id="23d32-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="23d32-261">toostart med hello Microsoft.Diagnostics.Tracing implementering av hello EventSource klass, följer du dessa steg för varje service-projekt som behöver toosend data tooElasticsearch:</span><span class="sxs-lookup"><span data-stu-id="23d32-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="23d32-262">Högerklicka på hello service-projekt och välj **hantera Nuget-paket**.</span><span class="sxs-lookup"><span data-stu-id="23d32-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="23d32-263">Växla toohello nuget.org paketkällan (om den inte redan är markerad) och Sök efter ”**Microsoft.Diagnostics.Tracing**”.</span><span class="sxs-lookup"><span data-stu-id="23d32-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="23d32-264">Installera hello `Microsoft.Diagnostics.Tracing.EventSource` paketet (och dess beroenden).</span><span class="sxs-lookup"><span data-stu-id="23d32-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="23d32-265">Öppna hello **ServiceEventSource.cs** eller **ActorEventSource.cs** filen i projektet service och ersätter hello `using System.Diagnostics.Tracing` direktivet ovanpå hello-fil med hello `using Microsoft.Diagnostics.Tracing` direktiv.</span><span class="sxs-lookup"><span data-stu-id="23d32-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="23d32-266">Dessa steg behövs inte när hello **.NET Framework 4.6** stöds av Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="23d32-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="23d32-267">Elasticsearch lyssnare instansiering och konfiguration</span><span class="sxs-lookup"><span data-stu-id="23d32-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="23d32-268">hello sista steget för att skicka diagnostikdata tooElasticsearch är toocreate en instans av `ElasticSearchListener` och konfigurera den med Elasticsearch anslutningsdata.</span><span class="sxs-lookup"><span data-stu-id="23d32-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="23d32-269">hello lyssnare samlar automatiskt in alla händelser som samlats in via EventSource klasser som definieras i hello service-projekt.</span><span class="sxs-lookup"><span data-stu-id="23d32-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="23d32-270">Den måste toobe alive under hello livstid hello service så hello bästa placera toocreate i hello service initieringskod.</span><span class="sxs-lookup"><span data-stu-id="23d32-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="23d32-271">Här är hur hello initieringskoden för den tillståndslösa tjänsten kan du granska hello nödvändiga ändringar (tillägg pekas i kommentarer som börjar med `****`):</span><span class="sxs-lookup"><span data-stu-id="23d32-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="23d32-272">Elasticsearch anslutningsdata ska placeras i ett separat avsnitt i konfigurationsfilen för hello-tjänsten (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="23d32-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="23d32-273">hello namnet hello avsnitt måste överensstämma med toohello-värdet som skickas toohello `FabricConfigurationProvider` konstruktor, till exempel:</span><span class="sxs-lookup"><span data-stu-id="23d32-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="23d32-274">Hej värdena för `serviceUri`, `userName` och `password` parametrar motsvaras toohello Elasticsearch klusteradress slutpunkt, Elasticsearch användarnamn och lösenord.</span><span class="sxs-lookup"><span data-stu-id="23d32-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="23d32-275">`indexNamePrefix`hello-prefix för Elasticsearch index. Hej Microsoft.Diagnostics.Listeners biblioteket skapar ett nytt index för sina data varje dag.</span><span class="sxs-lookup"><span data-stu-id="23d32-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="23d32-276">Verifieringen</span><span class="sxs-lookup"><span data-stu-id="23d32-276">Verification</span></span>
<span data-ttu-id="23d32-277">Klart!</span><span class="sxs-lookup"><span data-stu-id="23d32-277">That's it!</span></span> <span data-ttu-id="23d32-278">Nu när hello-tjänsten körs startar skicka spårningar toohello Elasticsearch tjänst som anges i hello konfiguration.</span><span class="sxs-lookup"><span data-stu-id="23d32-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="23d32-279">Du kan kontrollera detta genom att öppna hello Kibana UI som är associerade med hello Elasticsearch målinstansen.</span><span class="sxs-lookup"><span data-stu-id="23d32-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="23d32-280">I vårt exempel är adressen hello http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="23d32-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="23d32-281">Kontrollera att index med hello namnprefix valt för hello `ElasticSearchListener` instans faktiskt har skapats och fylls med data.</span><span class="sxs-lookup"><span data-stu-id="23d32-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Kibana visar PartyCluster programhändelser][2]

## <a name="next-steps"></a><span data-ttu-id="23d32-283">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="23d32-283">Next steps</span></span>
* [<span data-ttu-id="23d32-284">Lär dig mer om hur du diagnostiserar och övervakningstjänsten Service Fabric</span><span class="sxs-lookup"><span data-stu-id="23d32-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
