---
title: aaaCluster Resource Manager klustret beskrivning | Microsoft Docs
description: "Som beskriver ett Service Fabric-kluster genom att ange Feldomäner, uppgradera domäner, nodegenskaper och noden kapaciteter för hello klustret Resource Manager."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 55f8ab37-9399-4c9a-9e6c-d2d859de6766
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: f2822075976bd54402af5ad56991b5b360dfb1d8
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="describing-a-service-fabric-cluster"></a><span data-ttu-id="7f686-103">Som beskriver ett service fabric-kluster</span><span class="sxs-lookup"><span data-stu-id="7f686-103">Describing a service fabric cluster</span></span>
<span data-ttu-id="7f686-104">hello resurshanteraren för Service Fabric-kluster tillhandahåller mekanismer för att beskriva ett kluster.</span><span class="sxs-lookup"><span data-stu-id="7f686-104">hello Service Fabric Cluster Resource Manager provides several mechanisms for describing a cluster.</span></span> <span data-ttu-id="7f686-105">Hello klustret Resource Manager använder information tooensure hög tillgänglighet hello-tjänster som körs i hello kluster under körning.</span><span class="sxs-lookup"><span data-stu-id="7f686-105">During runtime, hello Cluster Resource Manager uses this information tooensure high availability of hello services running in hello cluster.</span></span> <span data-ttu-id="7f686-106">Medan reglerna viktigt, försöker den också toooptimize hello resursförbrukning inom hello kluster.</span><span class="sxs-lookup"><span data-stu-id="7f686-106">While enforcing these important rules, it also attempts toooptimize hello resource consumption within hello cluster.</span></span>

## <a name="key-concepts"></a><span data-ttu-id="7f686-107">Viktiga begrepp</span><span class="sxs-lookup"><span data-stu-id="7f686-107">Key concepts</span></span>
<span data-ttu-id="7f686-108">hello hanteraren för filserverresurser stöder flera funktioner som beskriver ett kluster:</span><span class="sxs-lookup"><span data-stu-id="7f686-108">hello Cluster Resource Manager supports several features that describe a cluster:</span></span>

* <span data-ttu-id="7f686-109">Feldomäner</span><span class="sxs-lookup"><span data-stu-id="7f686-109">Fault Domains</span></span>
* <span data-ttu-id="7f686-110">Uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="7f686-110">Upgrade Domains</span></span>
* <span data-ttu-id="7f686-111">Nodegenskaper</span><span class="sxs-lookup"><span data-stu-id="7f686-111">Node Properties</span></span>
* <span data-ttu-id="7f686-112">Noden kapacitet</span><span class="sxs-lookup"><span data-stu-id="7f686-112">Node Capacities</span></span>

## <a name="fault-domains"></a><span data-ttu-id="7f686-113">Feldomäner</span><span class="sxs-lookup"><span data-stu-id="7f686-113">Fault domains</span></span>
<span data-ttu-id="7f686-114">En Feldomän är en del av samordnade fel.</span><span class="sxs-lookup"><span data-stu-id="7f686-114">A Fault Domain is any area of coordinated failure.</span></span> <span data-ttu-id="7f686-115">En enskild dator är en Feldomän (eftersom den kan misslyckas på en egen för olika skäl, från power ange fel toodrive fel toobad NIC firmware).</span><span class="sxs-lookup"><span data-stu-id="7f686-115">A single machine is a Fault Domain (since it can fail on its own for various reasons, from power supply failures toodrive failures toobad NIC firmware).</span></span> <span data-ttu-id="7f686-116">Datorer som är anslutna toohello samma Ethernet-switch finns i hello samma Feldomän som är datorer som delar en enda källa ström eller på en enda plats.</span><span class="sxs-lookup"><span data-stu-id="7f686-116">Machines connected toohello same Ethernet switch are in hello same Fault Domain, as are machines sharing a single source of power or in a single location.</span></span> <span data-ttu-id="7f686-117">Eftersom det är naturligt för maskinvara fel toooverlap Feldomäner är natur hierarkisk och visas i form av URI: er i Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="7f686-117">Since it's natural for hardware faults toooverlap, Fault Domains are inherently hierarchal and are represented as URIs in Service Fabric.</span></span>

<span data-ttu-id="7f686-118">Det är viktigt att Feldomäner har ställts in korrekt eftersom Service Fabric använder denna information toosafely plats tjänster.</span><span class="sxs-lookup"><span data-stu-id="7f686-118">It is important that Fault Domains are set up correctly since Service Fabric uses this information toosafely place services.</span></span> <span data-ttu-id="7f686-119">Service Fabric vill inte tooplace services så att hello förlust av en Feldomän (orsakas av hello misslyckades för vissa komponenten) orsakar en service toogo ned.</span><span class="sxs-lookup"><span data-stu-id="7f686-119">Service Fabric doesn't want tooplace services such that hello loss of a Fault Domain (caused by hello failure of some component) causes a service toogo down.</span></span> <span data-ttu-id="7f686-120">Konfigurera hello noder i klustret hello i hello Azure Service Fabric använder hello Feldomän information från hello miljö toocorrectly-miljön för din räkning.</span><span class="sxs-lookup"><span data-stu-id="7f686-120">In hello Azure environment Service Fabric uses hello Fault Domain information provided by hello environment toocorrectly configure hello nodes in hello cluster on your behalf.</span></span> <span data-ttu-id="7f686-121">För Service Fabric fristående, Feldomäner definieras när hello har hello klustret konfigurerats</span><span class="sxs-lookup"><span data-stu-id="7f686-121">For Service Fabric Standalone, Fault Domains are defined at hello time that hello cluster is set up</span></span> 

> [!WARNING]
> <span data-ttu-id="7f686-122">Det är viktigt att hello Feldomän information tillhandahålls tooService Fabric är korrekt.</span><span class="sxs-lookup"><span data-stu-id="7f686-122">It is important that hello Fault Domain information provided tooService Fabric is accurate.</span></span> <span data-ttu-id="7f686-123">Anta exempelvis att att din Service Fabric klusternoder körs inom 10 virtuella datorer som körs på fem fysiska värdar.</span><span class="sxs-lookup"><span data-stu-id="7f686-123">For example, let's say that your Service Fabric cluster's nodes are running inside 10 virtual machines, running on five physical hosts.</span></span> <span data-ttu-id="7f686-124">I det här fallet, även om det finns 10 virtuella datorer, det finns endast 5 olika (toppnivå) fault-domäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-124">In this case, even though there are 10 virtual machines, there's only 5 different (top level) fault domains.</span></span> <span data-ttu-id="7f686-125">Dela hello som gör att samma fysiska värd VMs tooshare hello samma roten feldomän eftersom hello VMs upplevelse koordineras fel om inte deras fysiska värden.</span><span class="sxs-lookup"><span data-stu-id="7f686-125">Sharing hello same physical host causes VMs tooshare hello same root fault domain, since hello VMs experience coordinated failure if their physical host fails.</span></span>  
>
> <span data-ttu-id="7f686-126">Eftersom Service Fabric förväntar hello Feldomän för en nod inte toochange.</span><span class="sxs-lookup"><span data-stu-id="7f686-126">Since Service Fabric expects hello Fault Domain of a node not toochange.</span></span> <span data-ttu-id="7f686-127">Andra mekanismer för att säkerställa hög tillgänglighet för hello virtuella datorer, t.ex [hög tillgänglighet för virtuella datorer](https://technet.microsoft.com/en-us/library/cc967323.aspx), Använd transparent migrering av virtuella datorer från en värd tooanother.</span><span class="sxs-lookup"><span data-stu-id="7f686-127">Other mechanisms of ensuring high availability of hello VMs, such as [HA-VMs](https://technet.microsoft.com/en-us/library/cc967323.aspx), use transparent migration of VMs from one host tooanother.</span></span> <span data-ttu-id="7f686-128">Dessa mekanismer inte konfigurera om eller meddela hello kör kod i hello VM.</span><span class="sxs-lookup"><span data-stu-id="7f686-128">These mechanisms do not reconfigure or notify hello running code inside hello VM.</span></span> <span data-ttu-id="7f686-129">Därför är **stöds inte** som miljöer för att köra Service Fabric-kluster.</span><span class="sxs-lookup"><span data-stu-id="7f686-129">As such, they are **not supported** as environments for running Service Fabric clusters.</span></span> <span data-ttu-id="7f686-130">Service Fabric ska hello endast hög tillgänglighet teknik anställda.</span><span class="sxs-lookup"><span data-stu-id="7f686-130">Service Fabric should be hello only high-availability technology employed.</span></span> <span data-ttu-id="7f686-131">Mekanismer som VM Direktmigrering, SAN-nätverk eller andra behövs inte.</span><span class="sxs-lookup"><span data-stu-id="7f686-131">Mechanisms like live VM migration, SANs, or others are not necessary.</span></span> <span data-ttu-id="7f686-132">Om används tillsammans med Service Fabric metoderna _minska_ programmets tillgänglighet och tillförlitlighet eftersom de införa ytterligare komplexitet, lägga till centraliserad källor till felet och använda tillförlitlighet och tillgänglighet strategier som står i konflikt med de i Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="7f686-132">If used in conjunction with Service Fabric, these mechanisms _reduce_ application availability and reliability because they introduce additional complexity, add centralized sources of failure, and utilize reliability and availability strategies that conflict with those in Service Fabric.</span></span> 
>
>

<span data-ttu-id="7f686-133">Vi färg alla hello entiteter som bidrar tooFault domäner och lista alla hello olika Feldomäner som resulterar i hello bilden nedan.</span><span class="sxs-lookup"><span data-stu-id="7f686-133">In hello graphic below we color all hello entities that contribute tooFault Domains and list all hello different Fault Domains that result.</span></span> <span data-ttu-id="7f686-134">I det här exemplet har vi datacenter (”DC”), rack (”R”) och blad (”B”).</span><span class="sxs-lookup"><span data-stu-id="7f686-134">In this example, we have datacenters ("DC"), racks ("R"), and blades ("B").</span></span> <span data-ttu-id="7f686-135">Möjligen, om varje bladet innehåller mer än en virtuell dator, kan det finnas ett annat skikt i hello Feldomän hierarki.</span><span class="sxs-lookup"><span data-stu-id="7f686-135">Conceivably, if each blade holds more than one virtual machine, there could be another layer in hello Fault Domain hierarchy.</span></span>

<span data-ttu-id="7f686-136"><center>
![Noder ordnade via Feldomäner][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-136"><center>
![Nodes organized via Fault Domains][Image1]
</center></span></span>

<span data-ttu-id="7f686-137">Under körning hello resurshanteraren för Service Fabric-klustret anser hello Feldomäner i hello kluster och planerar layouter.</span><span class="sxs-lookup"><span data-stu-id="7f686-137">During runtime, hello Service Fabric Cluster Resource Manager considers hello Fault Domains in hello cluster and plans layouts.</span></span> <span data-ttu-id="7f686-138">Hej tillståndskänslig repliker eller tillståndslösa instanser för en viss tjänst distribueras så att de är i separata Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-138">hello stateful replicas or stateless instances for a given service are distributed so they are in separate Fault Domains.</span></span> <span data-ttu-id="7f686-139">Distribuerar hello-tjänsten över feldomäner blir hello tillgänglighet av hello-tjänsten inte osäker när en feldomän på alla nivåer i hello hierarki.</span><span class="sxs-lookup"><span data-stu-id="7f686-139">Distributing hello service across fault domains ensures hello availability of hello service is not compromised when a Fault Domain fails at any level of hello hierarchy.</span></span>

<span data-ttu-id="7f686-140">Resurshanteraren för Service Fabric-klustret hand inte hur många lager i hello Feldomän hierarki.</span><span class="sxs-lookup"><span data-stu-id="7f686-140">Service Fabric’s Cluster Resource Manager doesn’t care how many layers there are in hello Fault Domain hierarchy.</span></span> <span data-ttu-id="7f686-141">Dock försöker programmet tooensure hello förlust av någon en del av hello hierarkin inte påverkar tjänster som körs i den.</span><span class="sxs-lookup"><span data-stu-id="7f686-141">However, it tries tooensure that hello loss of any one portion of hello hierarchy doesn’t impact services running in it.</span></span> 

<span data-ttu-id="7f686-142">Det är bäst om det finns hello samma antal noder på varje nivå på djupet i hello Feldomän hierarki.</span><span class="sxs-lookup"><span data-stu-id="7f686-142">It is best if there are hello same number of nodes at each level of depth in hello Fault Domain hierarchy.</span></span> <span data-ttu-id="7f686-143">Om hello ”träd” Feldomäner Obalanserat i klustret, gör det svårare för hello klustret Resource Manager toofigure ut hello bästa fördelning av tjänster.</span><span class="sxs-lookup"><span data-stu-id="7f686-143">If hello “tree” of Fault Domains is unbalanced in your cluster, it makes it harder for hello Cluster Resource Manager toofigure out hello best allocation of services.</span></span> <span data-ttu-id="7f686-144">Imbalanced Feldomäner layouter innebär att hello förlust av vissa domäner påverkan hello tillgängligheten för tjänster som är mer än andra domäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-144">Imbalanced Fault Domains layouts mean that hello loss of some domains impact hello availability of services more than other domains.</span></span> <span data-ttu-id="7f686-145">Därför hello klustret Resource Manager torn mellan två mål: den vill toouse hello datorer i domänen ”tunga” genom att placera tjänster på dem och det vill tooplace tjänster i andra domäner så att hello förlust av en domän inte orsaka problem.</span><span class="sxs-lookup"><span data-stu-id="7f686-145">As a result, hello Cluster Resource Manager is torn between two goals: It wants toouse hello machines in that “heavy” domain by placing services on them, and it wants tooplace services in other domains so that hello loss of a domain doesn’t cause problems.</span></span> 

<span data-ttu-id="7f686-146">Hur ser imbalanced domäner ut?</span><span class="sxs-lookup"><span data-stu-id="7f686-146">What do imbalanced domains look like?</span></span> <span data-ttu-id="7f686-147">I hello diagrammet nedan visar vi två olika kluster layouter.</span><span class="sxs-lookup"><span data-stu-id="7f686-147">In hello diagram below, we show two different cluster layouts.</span></span> <span data-ttu-id="7f686-148">I hello första exemplet jämnt hello noder över hello Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-148">In hello first example, hello nodes are distributed evenly across hello Fault Domains.</span></span> <span data-ttu-id="7f686-149">I andra exemplet hello har en Feldomän fler noder än hello andra Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-149">In hello second example, one Fault Domain has many more nodes than hello other Fault Domains.</span></span> 

<span data-ttu-id="7f686-150"><center>
![Två olika kluster layouter][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-150"><center>
![Two different cluster layouts][Image2]
</center></span></span>

<span data-ttu-id="7f686-151">I Azure hanteras hello val som Feldomän innehåller en nod åt dig.</span><span class="sxs-lookup"><span data-stu-id="7f686-151">In Azure, hello choice of which Fault Domain contains a node is managed for you.</span></span> <span data-ttu-id="7f686-152">Men, beroende på hello antalet noder som du etablerar du kan fortfarande få Feldomäner med flera noder i dem än andra.</span><span class="sxs-lookup"><span data-stu-id="7f686-152">However, depending on hello number of nodes that you provision you can still end up with Fault Domains with more nodes in them than others.</span></span> <span data-ttu-id="7f686-153">Anta exempelvis att du har fem Feldomäner i hello kluster men etablera sju noder för en given NodeType.</span><span class="sxs-lookup"><span data-stu-id="7f686-153">For example, say you have five Fault Domains in hello cluster but provision seven nodes for a given NodeType.</span></span> <span data-ttu-id="7f686-154">I det här fallet få hello två första Feldomäner fler noder.</span><span class="sxs-lookup"><span data-stu-id="7f686-154">In this case, hello first two Fault Domains end up with more nodes.</span></span> <span data-ttu-id="7f686-155">Om du fortsätter toodeploy mer nodetypes får med bara några instanser hämtar hello problemet försämras.</span><span class="sxs-lookup"><span data-stu-id="7f686-155">If you continue toodeploy more NodeTypes with only a couple instances, hello problem gets worse.</span></span> <span data-ttu-id="7f686-156">Därför rekommenderar vi att hello är antalet noder i varje nodtyp en multipel av hello antalet Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-156">For this reason it's recommended that hello number of nodes in each node type is a multiple of hello number of Fault Domains.</span></span>

## <a name="upgrade-domains"></a><span data-ttu-id="7f686-157">Uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="7f686-157">Upgrade domains</span></span>
<span data-ttu-id="7f686-158">Uppgradera domäner är en annan funktion som hjälper hello resurshanteraren för Service Fabric-klustret förstå hello layout hello-klustret.</span><span class="sxs-lookup"><span data-stu-id="7f686-158">Upgrade Domains are another feature that helps hello Service Fabric Cluster Resource Manager understand hello layout of hello cluster.</span></span> <span data-ttu-id="7f686-159">Uppgraderingsdomäner definiera uppsättningar av noder som uppgraderas vid hello samtidigt.</span><span class="sxs-lookup"><span data-stu-id="7f686-159">Upgrade Domains define sets of nodes that are upgraded at hello same time.</span></span> <span data-ttu-id="7f686-160">Uppgradera domäner hjälp hello klustret Resource Manager förstå och samordna hanteringsåtgärder som uppgraderingar.</span><span class="sxs-lookup"><span data-stu-id="7f686-160">Upgrade Domains help hello Cluster Resource Manager understand and orchestrate management operations like upgrades.</span></span>

<span data-ttu-id="7f686-161">Uppgradera domäner är mycket som Feldomäner, men med några viktiga skillnader.</span><span class="sxs-lookup"><span data-stu-id="7f686-161">Upgrade Domains are a lot like Fault Domains, but with a couple key differences.</span></span> <span data-ttu-id="7f686-162">Först definierar delar av samordnade maskinvarufel Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-162">First, areas of coordinated hardware failures define Fault Domains.</span></span> <span data-ttu-id="7f686-163">Uppgradera domäner, på andra sidan hello, definieras av principen.</span><span class="sxs-lookup"><span data-stu-id="7f686-163">Upgrade Domains, on hello other hand, are defined by policy.</span></span> <span data-ttu-id="7f686-164">Du får toodecide hur många du vill att, i stället för den som anges av hello-miljö.</span><span class="sxs-lookup"><span data-stu-id="7f686-164">You get toodecide how many you want, rather than it being dictated by hello environment.</span></span> <span data-ttu-id="7f686-165">Du kan ha valfritt antal uppgradera domäner som du har noder.</span><span class="sxs-lookup"><span data-stu-id="7f686-165">You could have as many Upgrade Domains as you do nodes.</span></span> <span data-ttu-id="7f686-166">En annan skillnaden mellan Feldomäner och uppgradera domäner är att uppgradera domäner inte är hierarkiska.</span><span class="sxs-lookup"><span data-stu-id="7f686-166">Another difference between Fault Domains and Upgrade Domains is that Upgrade Domains are not hierarchical.</span></span> <span data-ttu-id="7f686-167">De är däremot mer som en enkel tagg.</span><span class="sxs-lookup"><span data-stu-id="7f686-167">Instead, they are more like a simple tag.</span></span> 

<span data-ttu-id="7f686-168">hello följande diagram visar tre uppgradera domäner stripe över tre Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-168">hello following diagram shows three Upgrade Domains are striped across three Fault Domains.</span></span> <span data-ttu-id="7f686-169">Det visar också ett möjligt placering för tre olika repliker av tillståndskänsliga tjänster, där varje avslutas med olika fel- och uppgradera domäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-169">It also shows one possible placement for three different replicas of a stateful service, where each ends up in different Fault and Upgrade Domains.</span></span> <span data-ttu-id="7f686-170">Den här placering kan hello förlust av en Feldomän i hello mitten av en uppgradering av tjänsten och fortfarande har en kopia av hello kod och data.</span><span class="sxs-lookup"><span data-stu-id="7f686-170">This placement allows hello loss of a Fault Domain while in hello middle of a service upgrade and still have one copy of hello code and data.</span></span>  

<span data-ttu-id="7f686-171"><center>
![Placering med fel- och Uppgraderingsdomäner][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-171"><center>
![Placement With Fault and Upgrade Domains][Image3]
</center></span></span>

<span data-ttu-id="7f686-172">Det finns för- och nackdelar toohaving stort antal uppgradera domäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-172">There are pros and cons toohaving large numbers of Upgrade Domains.</span></span> <span data-ttu-id="7f686-173">Fler uppgradera domäner innebär varje steg i hello uppgraderingen är mer detaljerade och påverkar därför ett mindre antal noder eller tjänster.</span><span class="sxs-lookup"><span data-stu-id="7f686-173">More Upgrade Domains means each step of hello upgrade is more granular and therefore affects a smaller number of nodes or services.</span></span> <span data-ttu-id="7f686-174">Detta innebär färre tjänsterna har toomove samtidigt, införa mindre omsättning i hello system.</span><span class="sxs-lookup"><span data-stu-id="7f686-174">As a result, fewer services have toomove at a time, introducing less churn into hello system.</span></span> <span data-ttu-id="7f686-175">Detta brukar tooimprove tillförlitlighet, eftersom mindre hello service påverkas av eventuella problem som introduceras under hello uppgraderingen.</span><span class="sxs-lookup"><span data-stu-id="7f686-175">This tends tooimprove reliability, since less of hello service is impacted by any issue introduced during hello upgrade.</span></span> <span data-ttu-id="7f686-176">Fler uppgradera domäner innebär också att du behöver mindre tillgängliga bufferten på andra noder toohandle hello effekten av hello uppgraderar.</span><span class="sxs-lookup"><span data-stu-id="7f686-176">More Upgrade Domains also means that you need less available buffer on other nodes toohandle hello impact of hello upgrade.</span></span> <span data-ttu-id="7f686-177">Till exempel om du har fem uppgradera domäner hello noder i varje hanterar ungefär 20 procent av trafiken.</span><span class="sxs-lookup"><span data-stu-id="7f686-177">For example, if you have five Upgrade Domains, hello nodes in each are handling roughly 20% of your traffic.</span></span> <span data-ttu-id="7f686-178">Om du behöver tootake ned uppgradera domänen för en uppgradering måste att belastningen vanligtvis toogo någonstans.</span><span class="sxs-lookup"><span data-stu-id="7f686-178">If you need tootake down that Upgrade Domain for an upgrade, that load usually needs toogo somewhere.</span></span> <span data-ttu-id="7f686-179">Eftersom du har fyra återstående uppgradera domäner måste ha plats för cirka 5% av hello totala trafiken.</span><span class="sxs-lookup"><span data-stu-id="7f686-179">Since you have four remaining Upgrade Domains, each must have room for about 5% of hello total traffic.</span></span> <span data-ttu-id="7f686-180">Fler uppgradera domäner innebär att du behöver mindre buffert på hello noder i klustret hello.</span><span class="sxs-lookup"><span data-stu-id="7f686-180">More Upgrade Domains means you need less buffer on hello nodes in hello cluster.</span></span> <span data-ttu-id="7f686-181">Anta till exempel att om du har haft 10 uppgradera domäner i stället.</span><span class="sxs-lookup"><span data-stu-id="7f686-181">For example, consider if you had 10 Upgrade Domains instead.</span></span> <span data-ttu-id="7f686-182">Varje UD hanterar i så fall endast cirka 10% av totalt antal hello-trafik.</span><span class="sxs-lookup"><span data-stu-id="7f686-182">In that case, each UD would only be handling about 10% of hello total traffic.</span></span> <span data-ttu-id="7f686-183">När en uppgradering via hello klustret måste varje domän endast toohave utrymme för ungefär 1.1% av totalt antal hello-trafik.</span><span class="sxs-lookup"><span data-stu-id="7f686-183">When an upgrade steps through hello cluster, each domain would only need toohave room for about 1.1% of hello total traffic.</span></span> <span data-ttu-id="7f686-184">Fler uppgradera domäner kan du vanligtvis toorun noderna med högre användning, eftersom du behöver mindre reserverad kapacitet.</span><span class="sxs-lookup"><span data-stu-id="7f686-184">More Upgrade Domains generally allow you toorun your nodes at higher utilization, since you need less reserved capacity.</span></span> <span data-ttu-id="7f686-185">hello sak samma gäller för Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-185">hello same is true for Fault Domains.</span></span>  

<span data-ttu-id="7f686-186">hello Nackdelen med att ha många uppgradera domäner är att uppgraderingar tenderar tootake längre.</span><span class="sxs-lookup"><span data-stu-id="7f686-186">hello downside of having many Upgrade Domains is that upgrades tend tootake longer.</span></span> <span data-ttu-id="7f686-187">Service Fabric väntar en kort tidsperiod när en uppgradering domän är klar och utför kontroller innan du startar tooupgrade hello nästa.</span><span class="sxs-lookup"><span data-stu-id="7f686-187">Service Fabric waits a short period of time after an Upgrade Domain is completed and performs checks before starting tooupgrade hello next one.</span></span> <span data-ttu-id="7f686-188">Dessa fördröjningar kan identifiera problem som introducerades av hello uppgraderingen innan hello uppgraderingen fortsätter.</span><span class="sxs-lookup"><span data-stu-id="7f686-188">These delays enable detecting issues introduced by hello upgrade before hello upgrade proceeds.</span></span> <span data-ttu-id="7f686-189">hello förhållandet är acceptabelt eftersom den förhindrar att felaktiga ändringar påverkar för mycket av hello tjänst i taget.</span><span class="sxs-lookup"><span data-stu-id="7f686-189">hello tradeoff is acceptable because it prevents bad changes from affecting too much of hello service at a time.</span></span>

<span data-ttu-id="7f686-190">För få uppgradera domäner har många negativa sidoeffekter – när varje enskild uppgradera domän är nere och uppgraderas en stor del av den totala kapaciteten är inte tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="7f686-190">Too few Upgrade Domains has many negative side effects – while each individual Upgrade Domain is down and being upgraded a large portion of your overall capacity is unavailable.</span></span> <span data-ttu-id="7f686-191">Till exempel om du bara har tre uppgradera domäner tar du ned ungefär 1/3 av din övergripande tjänst eller ett kluster kapacitet i taget.</span><span class="sxs-lookup"><span data-stu-id="7f686-191">For example, if you only have three Upgrade Domains you are taking down about 1/3 of your overall service or cluster capacity at a time.</span></span> <span data-ttu-id="7f686-192">På samma gång med stor del av din tjänst ned inte önskvärt eftersom du har toohave tillräckligt med kapacitet i hello resten av klustret toohandle hello arbetsbelastningen.</span><span class="sxs-lookup"><span data-stu-id="7f686-192">Having so much of your service down at once isn’t desirable since you have toohave enough capacity in hello rest of your cluster toohandle hello workload.</span></span> <span data-ttu-id="7f686-193">Underhålla det buffert som innebär att under normal drift är de noderna mindre inlästa än de skulle vara annars.</span><span class="sxs-lookup"><span data-stu-id="7f686-193">Maintaining that buffer means that during normal operation those nodes are less loaded than they would be otherwise.</span></span> <span data-ttu-id="7f686-194">Detta ökar hello kostnaden för att köra din tjänst.</span><span class="sxs-lookup"><span data-stu-id="7f686-194">This increases hello cost of running your service.</span></span>

<span data-ttu-id="7f686-195">Det finns inget verkliga gränsen toohello Totalt antal fel eller uppgradera domäner i en miljö eller begränsningar för hur de överlappar varandra.</span><span class="sxs-lookup"><span data-stu-id="7f686-195">There’s no real limit toohello total number of fault or Upgrade Domains in an environment, or constraints on how they overlap.</span></span> <span data-ttu-id="7f686-196">Namn, det finns flera vanliga mönster:</span><span class="sxs-lookup"><span data-stu-id="7f686-196">That said, there are several common patterns:</span></span>

- <span data-ttu-id="7f686-197">Feldomäner och uppgradera domäner mappas 1:1</span><span class="sxs-lookup"><span data-stu-id="7f686-197">Fault Domains and Upgrade Domains mapped 1:1</span></span>
- <span data-ttu-id="7f686-198">En uppgradering domän per nod (fysisk eller virtuell OS instans)</span><span class="sxs-lookup"><span data-stu-id="7f686-198">One Upgrade Domain per Node (physical or virtual OS instance)</span></span>
- <span data-ttu-id="7f686-199">En modell för ”stripe” eller ”matris” där hello Feldomäner och uppgradera domäner utgör en matris med datorer som körs vanligtvis ned hello diagonala linjer</span><span class="sxs-lookup"><span data-stu-id="7f686-199">A “striped” or “matrix” model where hello Fault Domains and Upgrade Domains form a matrix with machines usually running down hello diagonals</span></span>

<span data-ttu-id="7f686-200"><center>
![Fel- och Uppgraderingsdomänen layouter][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-200"><center>
![Fault and Upgrade Domain Layouts][Image4]
</center></span></span>

<span data-ttu-id="7f686-201">Det finns inga bästa besvara vilken layout toochoose, var och en har vissa- och nackdelar.</span><span class="sxs-lookup"><span data-stu-id="7f686-201">There’s no best answer which layout toochoose, each has some pros and cons.</span></span> <span data-ttu-id="7f686-202">Hej 1FD:1UD modellen är till exempel enkel tooset upp.</span><span class="sxs-lookup"><span data-stu-id="7f686-202">For example, hello 1FD:1UD model is simple tooset up.</span></span> <span data-ttu-id="7f686-203">hello är 1 Uppgraderingsdomänen per nod modell de flesta som vad användare används för att.</span><span class="sxs-lookup"><span data-stu-id="7f686-203">hello 1 Upgrade Domain per Node model is most like what people are used to.</span></span> <span data-ttu-id="7f686-204">Under uppgraderingar uppdateras varje nod oberoende av varandra.</span><span class="sxs-lookup"><span data-stu-id="7f686-204">During upgrades each node is updated independently.</span></span> <span data-ttu-id="7f686-205">Detta påminner om toohow små mängder datorer har uppgraderats manuellt i hello tidigare.</span><span class="sxs-lookup"><span data-stu-id="7f686-205">This is similar toohow small sets of machines were upgraded manually in hello past.</span></span> 

<span data-ttu-id="7f686-206">hello vanligaste modellen är hello FD/UD matris, där hello FDs och UDs utgör en tabell och noder placeras startar längs hello diagonal.</span><span class="sxs-lookup"><span data-stu-id="7f686-206">hello most common model is hello FD/UD matrix, where hello FDs and UDs form a table and nodes are placed starting along hello diagonal.</span></span> <span data-ttu-id="7f686-207">Detta är hello-modell som används som standard i Service Fabric-kluster i Azure.</span><span class="sxs-lookup"><span data-stu-id="7f686-207">This is hello model used by default in Service Fabric clusters in Azure.</span></span> <span data-ttu-id="7f686-208">Kluster med flera noder hamnar allt ser ut som hello kompakta matris mönster ovan.</span><span class="sxs-lookup"><span data-stu-id="7f686-208">For clusters with many nodes everything ends up looking like hello dense matrix pattern above.</span></span>

## <a name="fault-and-upgrade-domain-constraints-and-resulting-behavior"></a><span data-ttu-id="7f686-209">Fel- och uppgradera domän begränsningar och resultatet</span><span class="sxs-lookup"><span data-stu-id="7f686-209">Fault and Upgrade Domain constraints and resulting behavior</span></span>
<span data-ttu-id="7f686-210">hello klustret Resource Manager behandlar hello önskan tookeep en tjänst belastningsutjämnade över fel och uppgradera domäner som en begränsning.</span><span class="sxs-lookup"><span data-stu-id="7f686-210">hello Cluster Resource Manager treats hello desire tookeep a service balanced across fault and Upgrade Domains as a constraint.</span></span> <span data-ttu-id="7f686-211">Du hittar mer information om begränsningar i [i den här artikeln](service-fabric-cluster-resource-manager-management-integration.md).</span><span class="sxs-lookup"><span data-stu-id="7f686-211">You can find out more about constraints in [this article](service-fabric-cluster-resource-manager-management-integration.md).</span></span> <span data-ttu-id="7f686-212">Hej fel- och uppgradera domän begränsningar tillstånd ”: för en viss tjänst partition det ska aldrig vara skillnad *större än ett* i hello antal tjänstobjekt (tillståndslös tjänstinstanser eller tillståndskänslig service repliker) mellan två domäner ”.</span><span class="sxs-lookup"><span data-stu-id="7f686-212">hello Fault and Upgrade Domain constraints state: "For a given service partition there should never be a difference *greater than one* in hello number of service objects (stateless service instances or stateful service replicas) between two domains."</span></span> <span data-ttu-id="7f686-213">Detta förhindrar att vissa flyttar eller åtgärder som strider mot den här begränsningen.</span><span class="sxs-lookup"><span data-stu-id="7f686-213">This prevents certain moves or arrangements that violate this constraint.</span></span>

<span data-ttu-id="7f686-214">Nu ska vi titta på ett exempel.</span><span class="sxs-lookup"><span data-stu-id="7f686-214">Let's look at one example.</span></span> <span data-ttu-id="7f686-215">Anta att vi har ett kluster med sex noder är konfigurerade med fem Feldomäner och fem uppgradera domäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-215">Let's say that we have a cluster with six nodes, configured with five Fault Domains and five Upgrade Domains.</span></span>

|  | <span data-ttu-id="7f686-216">FD0</span><span class="sxs-lookup"><span data-stu-id="7f686-216">FD0</span></span> | <span data-ttu-id="7f686-217">FD1</span><span class="sxs-lookup"><span data-stu-id="7f686-217">FD1</span></span> | <span data-ttu-id="7f686-218">FD2</span><span class="sxs-lookup"><span data-stu-id="7f686-218">FD2</span></span> | <span data-ttu-id="7f686-219">FD3</span><span class="sxs-lookup"><span data-stu-id="7f686-219">FD3</span></span> | <span data-ttu-id="7f686-220">FD4</span><span class="sxs-lookup"><span data-stu-id="7f686-220">FD4</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="7f686-221">**UD0**</span><span class="sxs-lookup"><span data-stu-id="7f686-221">**UD0**</span></span> |<span data-ttu-id="7f686-222">N1</span><span class="sxs-lookup"><span data-stu-id="7f686-222">N1</span></span> | | | | |
| <span data-ttu-id="7f686-223">**UD1**</span><span class="sxs-lookup"><span data-stu-id="7f686-223">**UD1**</span></span> |<span data-ttu-id="7f686-224">N6</span><span class="sxs-lookup"><span data-stu-id="7f686-224">N6</span></span> |<span data-ttu-id="7f686-225">N2</span><span class="sxs-lookup"><span data-stu-id="7f686-225">N2</span></span> | | | |
| <span data-ttu-id="7f686-226">**UD2**</span><span class="sxs-lookup"><span data-stu-id="7f686-226">**UD2**</span></span> | | |<span data-ttu-id="7f686-227">N3</span><span class="sxs-lookup"><span data-stu-id="7f686-227">N3</span></span> | | |
| <span data-ttu-id="7f686-228">**UD3**</span><span class="sxs-lookup"><span data-stu-id="7f686-228">**UD3**</span></span> | | | |<span data-ttu-id="7f686-229">N4</span><span class="sxs-lookup"><span data-stu-id="7f686-229">N4</span></span> | |
| <span data-ttu-id="7f686-230">**UD4**</span><span class="sxs-lookup"><span data-stu-id="7f686-230">**UD4**</span></span> | | | | |<span data-ttu-id="7f686-231">N5</span><span class="sxs-lookup"><span data-stu-id="7f686-231">N5</span></span> |

<span data-ttu-id="7f686-232">Nu anta att vi skapa en tjänst med en TargetReplicaSetSize (eller för den tillståndslösa tjänsten en InstanceCount) fem.</span><span class="sxs-lookup"><span data-stu-id="7f686-232">Now let's say that we create a service with a TargetReplicaSetSize (or, for a stateless service an InstanceCount) of five.</span></span> <span data-ttu-id="7f686-233">hello repliker mark på N1 N5.</span><span class="sxs-lookup"><span data-stu-id="7f686-233">hello replicas land on N1-N5.</span></span> <span data-ttu-id="7f686-234">I själva verket används N6 aldrig oavsett hur många tjänster så här du skapar.</span><span class="sxs-lookup"><span data-stu-id="7f686-234">In fact, N6 is never used no matter how many services like this you create.</span></span> <span data-ttu-id="7f686-235">Men varför?</span><span class="sxs-lookup"><span data-stu-id="7f686-235">But why?</span></span> <span data-ttu-id="7f686-236">Nu ska vi titta på hello skillnaden mellan hello aktuell layout och vad som skulle hända om N6 väljs.</span><span class="sxs-lookup"><span data-stu-id="7f686-236">Let's look at hello difference between hello current layout and what would happen if N6 is chosen.</span></span>

<span data-ttu-id="7f686-237">Här är hello layout vi har fått och hello totala antalet repliker per fel- och uppgradera domän:</span><span class="sxs-lookup"><span data-stu-id="7f686-237">Here's hello layout we got and hello total number of replicas per Fault and Upgrade Domain:</span></span>

|  | <span data-ttu-id="7f686-238">FD0</span><span class="sxs-lookup"><span data-stu-id="7f686-238">FD0</span></span> | <span data-ttu-id="7f686-239">FD1</span><span class="sxs-lookup"><span data-stu-id="7f686-239">FD1</span></span> | <span data-ttu-id="7f686-240">FD2</span><span class="sxs-lookup"><span data-stu-id="7f686-240">FD2</span></span> | <span data-ttu-id="7f686-241">FD3</span><span class="sxs-lookup"><span data-stu-id="7f686-241">FD3</span></span> | <span data-ttu-id="7f686-242">FD4</span><span class="sxs-lookup"><span data-stu-id="7f686-242">FD4</span></span> | <span data-ttu-id="7f686-243">UDTotal</span><span class="sxs-lookup"><span data-stu-id="7f686-243">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="7f686-244">**UD0**</span><span class="sxs-lookup"><span data-stu-id="7f686-244">**UD0**</span></span> |<span data-ttu-id="7f686-245">R1</span><span class="sxs-lookup"><span data-stu-id="7f686-245">R1</span></span> | | | | |<span data-ttu-id="7f686-246">1</span><span class="sxs-lookup"><span data-stu-id="7f686-246">1</span></span> |
| <span data-ttu-id="7f686-247">**UD1**</span><span class="sxs-lookup"><span data-stu-id="7f686-247">**UD1**</span></span> | |<span data-ttu-id="7f686-248">R2</span><span class="sxs-lookup"><span data-stu-id="7f686-248">R2</span></span> | | | |<span data-ttu-id="7f686-249">1</span><span class="sxs-lookup"><span data-stu-id="7f686-249">1</span></span> |
| <span data-ttu-id="7f686-250">**UD2**</span><span class="sxs-lookup"><span data-stu-id="7f686-250">**UD2**</span></span> | | |<span data-ttu-id="7f686-251">R3</span><span class="sxs-lookup"><span data-stu-id="7f686-251">R3</span></span> | | |<span data-ttu-id="7f686-252">1</span><span class="sxs-lookup"><span data-stu-id="7f686-252">1</span></span> |
| <span data-ttu-id="7f686-253">**UD3**</span><span class="sxs-lookup"><span data-stu-id="7f686-253">**UD3**</span></span> | | | |<span data-ttu-id="7f686-254">R4</span><span class="sxs-lookup"><span data-stu-id="7f686-254">R4</span></span> | |<span data-ttu-id="7f686-255">1</span><span class="sxs-lookup"><span data-stu-id="7f686-255">1</span></span> |
| <span data-ttu-id="7f686-256">**UD4**</span><span class="sxs-lookup"><span data-stu-id="7f686-256">**UD4**</span></span> | | | | |<span data-ttu-id="7f686-257">R5</span><span class="sxs-lookup"><span data-stu-id="7f686-257">R5</span></span> |<span data-ttu-id="7f686-258">1</span><span class="sxs-lookup"><span data-stu-id="7f686-258">1</span></span> |
| <span data-ttu-id="7f686-259">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="7f686-259">**FDTotal**</span></span> |<span data-ttu-id="7f686-260">1</span><span class="sxs-lookup"><span data-stu-id="7f686-260">1</span></span> |<span data-ttu-id="7f686-261">1</span><span class="sxs-lookup"><span data-stu-id="7f686-261">1</span></span> |<span data-ttu-id="7f686-262">1</span><span class="sxs-lookup"><span data-stu-id="7f686-262">1</span></span> |<span data-ttu-id="7f686-263">1</span><span class="sxs-lookup"><span data-stu-id="7f686-263">1</span></span> |<span data-ttu-id="7f686-264">1</span><span class="sxs-lookup"><span data-stu-id="7f686-264">1</span></span> |- |

<span data-ttu-id="7f686-265">Den här layouten balanseras vad gäller noder per fel och uppgradera domänen.</span><span class="sxs-lookup"><span data-stu-id="7f686-265">This layout is balanced in terms of nodes per Fault Domain and Upgrade Domain.</span></span> <span data-ttu-id="7f686-266">Det är också balanserad vad gäller hello antal repliker per fel- och uppgradera domän.</span><span class="sxs-lookup"><span data-stu-id="7f686-266">It is also balanced in terms of hello number of replicas per Fault and Upgrade Domain.</span></span> <span data-ttu-id="7f686-267">Varje domän har hello samma antal noder och hello samma antal repliker.</span><span class="sxs-lookup"><span data-stu-id="7f686-267">Each domain has hello same number of nodes and hello same number of replicas.</span></span>

<span data-ttu-id="7f686-268">Nu ska vi titta på vad som skulle hända om vi hade använt N6 i stället för N2.</span><span class="sxs-lookup"><span data-stu-id="7f686-268">Now, let's look at what would happen if we'd used N6 instead of N2.</span></span> <span data-ttu-id="7f686-269">Hur skulle hello repliker att distribueras sedan?</span><span class="sxs-lookup"><span data-stu-id="7f686-269">How would hello replicas be distributed then?</span></span>

|  | <span data-ttu-id="7f686-270">FD0</span><span class="sxs-lookup"><span data-stu-id="7f686-270">FD0</span></span> | <span data-ttu-id="7f686-271">FD1</span><span class="sxs-lookup"><span data-stu-id="7f686-271">FD1</span></span> | <span data-ttu-id="7f686-272">FD2</span><span class="sxs-lookup"><span data-stu-id="7f686-272">FD2</span></span> | <span data-ttu-id="7f686-273">FD3</span><span class="sxs-lookup"><span data-stu-id="7f686-273">FD3</span></span> | <span data-ttu-id="7f686-274">FD4</span><span class="sxs-lookup"><span data-stu-id="7f686-274">FD4</span></span> | <span data-ttu-id="7f686-275">UDTotal</span><span class="sxs-lookup"><span data-stu-id="7f686-275">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="7f686-276">**UD0**</span><span class="sxs-lookup"><span data-stu-id="7f686-276">**UD0**</span></span> |<span data-ttu-id="7f686-277">R1</span><span class="sxs-lookup"><span data-stu-id="7f686-277">R1</span></span> | | | | |<span data-ttu-id="7f686-278">1</span><span class="sxs-lookup"><span data-stu-id="7f686-278">1</span></span> |
| <span data-ttu-id="7f686-279">**UD1**</span><span class="sxs-lookup"><span data-stu-id="7f686-279">**UD1**</span></span> |<span data-ttu-id="7f686-280">R5</span><span class="sxs-lookup"><span data-stu-id="7f686-280">R5</span></span> | | | | |<span data-ttu-id="7f686-281">1</span><span class="sxs-lookup"><span data-stu-id="7f686-281">1</span></span> |
| <span data-ttu-id="7f686-282">**UD2**</span><span class="sxs-lookup"><span data-stu-id="7f686-282">**UD2**</span></span> | | |<span data-ttu-id="7f686-283">R2</span><span class="sxs-lookup"><span data-stu-id="7f686-283">R2</span></span> | | |<span data-ttu-id="7f686-284">1</span><span class="sxs-lookup"><span data-stu-id="7f686-284">1</span></span> |
| <span data-ttu-id="7f686-285">**UD3**</span><span class="sxs-lookup"><span data-stu-id="7f686-285">**UD3**</span></span> | | | |<span data-ttu-id="7f686-286">R3</span><span class="sxs-lookup"><span data-stu-id="7f686-286">R3</span></span> | |<span data-ttu-id="7f686-287">1</span><span class="sxs-lookup"><span data-stu-id="7f686-287">1</span></span> |
| <span data-ttu-id="7f686-288">**UD4**</span><span class="sxs-lookup"><span data-stu-id="7f686-288">**UD4**</span></span> | | | | |<span data-ttu-id="7f686-289">R4</span><span class="sxs-lookup"><span data-stu-id="7f686-289">R4</span></span> |<span data-ttu-id="7f686-290">1</span><span class="sxs-lookup"><span data-stu-id="7f686-290">1</span></span> |
| <span data-ttu-id="7f686-291">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="7f686-291">**FDTotal**</span></span> |<span data-ttu-id="7f686-292">2</span><span class="sxs-lookup"><span data-stu-id="7f686-292">2</span></span> |<span data-ttu-id="7f686-293">0</span><span class="sxs-lookup"><span data-stu-id="7f686-293">0</span></span> |<span data-ttu-id="7f686-294">1</span><span class="sxs-lookup"><span data-stu-id="7f686-294">1</span></span> |<span data-ttu-id="7f686-295">1</span><span class="sxs-lookup"><span data-stu-id="7f686-295">1</span></span> |<span data-ttu-id="7f686-296">1</span><span class="sxs-lookup"><span data-stu-id="7f686-296">1</span></span> |- |

<span data-ttu-id="7f686-297">Den här layouten strider mot vår definition för hello Feldomän begränsning.</span><span class="sxs-lookup"><span data-stu-id="7f686-297">This layout violates our definition for hello Fault Domain constraint.</span></span> <span data-ttu-id="7f686-298">FD0 har två repliker medan FD1 är noll, ringa hello skillnaden mellan FD0 och FD1 totalt två.</span><span class="sxs-lookup"><span data-stu-id="7f686-298">FD0 has two replicas, while FD1 has zero, making hello difference between FD0 and FD1 a total of two.</span></span> <span data-ttu-id="7f686-299">hello klustret Resource Manager tillåter inte den här ordningen.</span><span class="sxs-lookup"><span data-stu-id="7f686-299">hello Cluster Resource Manager does not allow this arrangement.</span></span> <span data-ttu-id="7f686-300">På liknande sätt om vi plockats N2 och N6 (i stället för N1 och N2) skulle vi få:</span><span class="sxs-lookup"><span data-stu-id="7f686-300">Similarly if we picked N2 and N6 (instead of N1 and N2) we'd get:</span></span>

|  | <span data-ttu-id="7f686-301">FD0</span><span class="sxs-lookup"><span data-stu-id="7f686-301">FD0</span></span> | <span data-ttu-id="7f686-302">FD1</span><span class="sxs-lookup"><span data-stu-id="7f686-302">FD1</span></span> | <span data-ttu-id="7f686-303">FD2</span><span class="sxs-lookup"><span data-stu-id="7f686-303">FD2</span></span> | <span data-ttu-id="7f686-304">FD3</span><span class="sxs-lookup"><span data-stu-id="7f686-304">FD3</span></span> | <span data-ttu-id="7f686-305">FD4</span><span class="sxs-lookup"><span data-stu-id="7f686-305">FD4</span></span> | <span data-ttu-id="7f686-306">UDTotal</span><span class="sxs-lookup"><span data-stu-id="7f686-306">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="7f686-307">**UD0**</span><span class="sxs-lookup"><span data-stu-id="7f686-307">**UD0**</span></span> | | | | | |<span data-ttu-id="7f686-308">0</span><span class="sxs-lookup"><span data-stu-id="7f686-308">0</span></span> |
| <span data-ttu-id="7f686-309">**UD1**</span><span class="sxs-lookup"><span data-stu-id="7f686-309">**UD1**</span></span> |<span data-ttu-id="7f686-310">R5</span><span class="sxs-lookup"><span data-stu-id="7f686-310">R5</span></span> |<span data-ttu-id="7f686-311">R1</span><span class="sxs-lookup"><span data-stu-id="7f686-311">R1</span></span> | | | |<span data-ttu-id="7f686-312">2</span><span class="sxs-lookup"><span data-stu-id="7f686-312">2</span></span> |
| <span data-ttu-id="7f686-313">**UD2**</span><span class="sxs-lookup"><span data-stu-id="7f686-313">**UD2**</span></span> | | |<span data-ttu-id="7f686-314">R2</span><span class="sxs-lookup"><span data-stu-id="7f686-314">R2</span></span> | | |<span data-ttu-id="7f686-315">1</span><span class="sxs-lookup"><span data-stu-id="7f686-315">1</span></span> |
| <span data-ttu-id="7f686-316">**UD3**</span><span class="sxs-lookup"><span data-stu-id="7f686-316">**UD3**</span></span> | | | |<span data-ttu-id="7f686-317">R3</span><span class="sxs-lookup"><span data-stu-id="7f686-317">R3</span></span> | |<span data-ttu-id="7f686-318">1</span><span class="sxs-lookup"><span data-stu-id="7f686-318">1</span></span> |
| <span data-ttu-id="7f686-319">**UD4**</span><span class="sxs-lookup"><span data-stu-id="7f686-319">**UD4**</span></span> | | | | |<span data-ttu-id="7f686-320">R4</span><span class="sxs-lookup"><span data-stu-id="7f686-320">R4</span></span> |<span data-ttu-id="7f686-321">1</span><span class="sxs-lookup"><span data-stu-id="7f686-321">1</span></span> |
| <span data-ttu-id="7f686-322">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="7f686-322">**FDTotal**</span></span> |<span data-ttu-id="7f686-323">1</span><span class="sxs-lookup"><span data-stu-id="7f686-323">1</span></span> |<span data-ttu-id="7f686-324">1</span><span class="sxs-lookup"><span data-stu-id="7f686-324">1</span></span> |<span data-ttu-id="7f686-325">1</span><span class="sxs-lookup"><span data-stu-id="7f686-325">1</span></span> |<span data-ttu-id="7f686-326">1</span><span class="sxs-lookup"><span data-stu-id="7f686-326">1</span></span> |<span data-ttu-id="7f686-327">1</span><span class="sxs-lookup"><span data-stu-id="7f686-327">1</span></span> |- |

<span data-ttu-id="7f686-328">Den här layouten balanseras vad gäller Feldomäner.</span><span class="sxs-lookup"><span data-stu-id="7f686-328">This layout is balanced in terms of Fault Domains.</span></span> <span data-ttu-id="7f686-329">Men nu den bryter mot hello uppgradera domänbegränsningar.</span><span class="sxs-lookup"><span data-stu-id="7f686-329">However, now it's violating hello Upgrade Domain constraint.</span></span> <span data-ttu-id="7f686-330">Det beror på att UD0 har noll repliker medan UD1 har två.</span><span class="sxs-lookup"><span data-stu-id="7f686-330">This is because UD0 has zero replicas while UD1 has two.</span></span> <span data-ttu-id="7f686-331">Därför den här layouten också är ogiltigt och nå inte hello klustret Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="7f686-331">Therefore, this layout is also invalid and won't be picked by hello Cluster Resource Manager.</span></span> 

## <a name="configuring-fault-and-upgrade-domains"></a><span data-ttu-id="7f686-332">Konfigurera fel- och uppgradera domäner</span><span class="sxs-lookup"><span data-stu-id="7f686-332">Configuring fault and Upgrade Domains</span></span>
<span data-ttu-id="7f686-333">Definiera Feldomäner och uppgradera domäner görs automatiskt i Azure värdbaserade Service Fabric-distributioner.</span><span class="sxs-lookup"><span data-stu-id="7f686-333">Defining Fault Domains and Upgrade Domains is done automatically in Azure hosted Service Fabric deployments.</span></span> <span data-ttu-id="7f686-334">Service Fabric hämtar och använder hello miljöinformation från Azure.</span><span class="sxs-lookup"><span data-stu-id="7f686-334">Service Fabric picks up and uses hello environment information from Azure.</span></span>

<span data-ttu-id="7f686-335">Om du skapar ditt eget kluster (eller vill toorun en viss topologi under utveckling) kan du ange hello fel och uppgradera domänen information själv.</span><span class="sxs-lookup"><span data-stu-id="7f686-335">If you’re creating your own cluster (or want toorun a particular topology in development), you can provide hello Fault Domain and Upgrade Domain information yourself.</span></span> <span data-ttu-id="7f686-336">I det här exemplet definierar vi nio lokal utveckling kluster med en nod som omfattar tre ”datacenter” (var och en med tre rack).</span><span class="sxs-lookup"><span data-stu-id="7f686-336">In this example, we define a nine node local development cluster that spans three “datacenters” (each with three racks).</span></span> <span data-ttu-id="7f686-337">Det här klustret har också tre uppgradera domäner stripe över de tre datacenter.</span><span class="sxs-lookup"><span data-stu-id="7f686-337">This cluster also has three Upgrade Domains striped across those three datacenters.</span></span> <span data-ttu-id="7f686-338">Ett exempel på hello configuration understiger:</span><span class="sxs-lookup"><span data-stu-id="7f686-338">An example of hello configuration is below:</span></span> 

<span data-ttu-id="7f686-339">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="7f686-339">ClusterManifest.xml</span></span>

```xml
  <Infrastructure>
    <!-- IsScaleMin indicates that this cluster runs on one-box /one single server -->
    <WindowsServer IsScaleMin="true">
      <NodeList>
        <Node NodeName="Node01" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType01" FaultDomain="fd:/DC01/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node02" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType02" FaultDomain="fd:/DC01/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node03" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType03" FaultDomain="fd:/DC01/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node04" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType04" FaultDomain="fd:/DC02/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node05" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType05" FaultDomain="fd:/DC02/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node06" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType06" FaultDomain="fd:/DC02/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node07" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType07" FaultDomain="fd:/DC03/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node08" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType08" FaultDomain="fd:/DC03/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node09" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType09" FaultDomain="fd:/DC03/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
      </NodeList>
    </WindowsServer>
  </Infrastructure>
```

<span data-ttu-id="7f686-340">via ClusterConfig.json för fristående distributioner</span><span class="sxs-lookup"><span data-stu-id="7f686-340">via ClusterConfig.json for Standalone deployments</span></span>

```json
"nodes": [
  {
    "nodeName": "vm1",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm2",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm3",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm4",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm5",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm6",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm7",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm8",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm9",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD3"
  }
],
```

> [!NOTE]
> <span data-ttu-id="7f686-341">När du definierar kluster via Azure Resource Manager tilldelas Feldomäner och uppgradera domäner av Azure.</span><span class="sxs-lookup"><span data-stu-id="7f686-341">When defining clusters via Azure Resource Manager, Fault Domains and Upgrade Domains are assigned by Azure.</span></span> <span data-ttu-id="7f686-342">Därför innehåller hello definition av din nodtyper och virtuella datorer i Azure Resource Manager-mallen inte Feldomän eller uppgradera domäninformation.</span><span class="sxs-lookup"><span data-stu-id="7f686-342">Therefore, hello definition of your Node Types and Virtual Machine Scale Sets in your Azure Resource Manager template does not include Fault Domain or Upgrade Domain information.</span></span>
>

## <a name="node-properties-and-placement-constraints"></a><span data-ttu-id="7f686-343">Egenskaper för en nod och placeringen</span><span class="sxs-lookup"><span data-stu-id="7f686-343">Node properties and placement constraints</span></span>
<span data-ttu-id="7f686-344">Ibland (faktum för hello mesta) ska toowant tooensure som vissa arbetsbelastningar som körs bara på vissa typer av noder i klustret hello.</span><span class="sxs-lookup"><span data-stu-id="7f686-344">Sometimes (in fact, most of hello time) you’re going toowant tooensure that certain workloads run only on certain types of nodes in hello cluster.</span></span> <span data-ttu-id="7f686-345">Exempelvis kanske vissa arbetsbelastning kräver GPU-kort eller SSD och andra inte.</span><span class="sxs-lookup"><span data-stu-id="7f686-345">For example, some workload may require GPUs or SSDs while others may not.</span></span> <span data-ttu-id="7f686-346">Ett bra exempel på mål maskinvara tooparticular arbetsbelastningar är i stort sett alla där n-nivå-arkitektur.</span><span class="sxs-lookup"><span data-stu-id="7f686-346">A great example of targeting hardware tooparticular workloads is almost every n-tier architecture out there.</span></span> <span data-ttu-id="7f686-347">Vissa datorer fungera som hello klientdelen eller betjänar sida av programmet hello-API och är utsatta toohello klienter eller hello internet.</span><span class="sxs-lookup"><span data-stu-id="7f686-347">Certain machines serve as hello front end or API serving side of hello application and are exposed toohello clients or hello internet.</span></span> <span data-ttu-id="7f686-348">Olika datorer, ofta med olika maskinvaruresurser hantera hello arbete hello beräkning eller lagring lager.</span><span class="sxs-lookup"><span data-stu-id="7f686-348">Different machines, often with different hardware resources, handle hello work of hello compute or storage layers.</span></span> <span data-ttu-id="7f686-349">Dessa är ofta _inte_ direkt exponerade tooclients eller hello internet.</span><span class="sxs-lookup"><span data-stu-id="7f686-349">These are usually _not_ directly exposed tooclients or hello internet.</span></span> <span data-ttu-id="7f686-350">Service Fabric förväntar att det finns fall där viss arbetsbelastning behöver toorun på specifika maskinvarukonfigurationer.</span><span class="sxs-lookup"><span data-stu-id="7f686-350">Service Fabric expects that there are cases where particular workloads need toorun on particular hardware configurations.</span></span> <span data-ttu-id="7f686-351">Exempel:</span><span class="sxs-lookup"><span data-stu-id="7f686-351">For example:</span></span>

* <span data-ttu-id="7f686-352">har ”lyfts och flyttat” i ett befintligt program i flera nivåer i en miljö med Service Fabric</span><span class="sxs-lookup"><span data-stu-id="7f686-352">an existing n-tier application has been “lifted and shifted” into a Service Fabric environment</span></span>
* <span data-ttu-id="7f686-353">en arbetsbelastning vill toorun på maskinvara för prestanda, skala och isolering av säkerhetsskäl</span><span class="sxs-lookup"><span data-stu-id="7f686-353">a workload wants toorun on specific hardware for performance, scale, or security isolation reasons</span></span>
* <span data-ttu-id="7f686-354">En arbetsbelastning isoleras från andra arbetsbelastningar för princip- eller förbrukning orsaker</span><span class="sxs-lookup"><span data-stu-id="7f686-354">A workload should be isolated from other workloads for policy or resource consumption reasons</span></span>

<span data-ttu-id="7f686-355">toosupport dessa typer av konfigurationer för Service Fabric har förstklassigt begreppet taggar som kan vara tillämpade toonodes.</span><span class="sxs-lookup"><span data-stu-id="7f686-355">toosupport these sorts of configurations, Service Fabric has a first class notion of tags that can be applied toonodes.</span></span> <span data-ttu-id="7f686-356">Dessa taggar kallas **nodegenskaper**.</span><span class="sxs-lookup"><span data-stu-id="7f686-356">These tags are called **node properties**.</span></span> <span data-ttu-id="7f686-357">**Placeringen** är hello instruktioner kopplade tooindividual tjänster väljer för en eller flera egenskaper i noden.</span><span class="sxs-lookup"><span data-stu-id="7f686-357">**Placement constraints** are hello statements attached tooindividual services that select for one or more node properties.</span></span> <span data-ttu-id="7f686-358">Placeringen definiera där tjänsterna ska köras.</span><span class="sxs-lookup"><span data-stu-id="7f686-358">Placement constraints define where services should run.</span></span> <span data-ttu-id="7f686-359">hello uppsättning begränsningar kan utökas - alla nyckel/värde-par fungerar.</span><span class="sxs-lookup"><span data-stu-id="7f686-359">hello set of constraints is extensible - any key/value pair can work.</span></span> 

<span data-ttu-id="7f686-360"><center>
![Klustret Layout olika arbetsbelastningar][Image5]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-360"><center>
![Cluster Layout Different Workloads][Image5]
</center></span></span>

### <a name="built-in-node-properties"></a><span data-ttu-id="7f686-361">Inbyggda nodegenskaper</span><span class="sxs-lookup"><span data-stu-id="7f686-361">Built in node properties</span></span>
<span data-ttu-id="7f686-362">Service Fabric definierar vissa standardegenskaper nod som automatiskt kan användas utan hello användaren har toodefine dem.</span><span class="sxs-lookup"><span data-stu-id="7f686-362">Service Fabric defines some default node properties that can be used automatically without hello user having toodefine them.</span></span> <span data-ttu-id="7f686-363">hello standardegenskaperna som definierats vid varje nod är hello **NodeType** och hello **nodnamn**.</span><span class="sxs-lookup"><span data-stu-id="7f686-363">hello default properties defined at each node are hello **NodeType** and hello **NodeName**.</span></span> <span data-ttu-id="7f686-364">Exempelvis så du kan skriva ett placering villkor som `"(NodeType == NodeType03)"`.</span><span class="sxs-lookup"><span data-stu-id="7f686-364">So for example you could write a placement constraint as `"(NodeType == NodeType03)"`.</span></span> <span data-ttu-id="7f686-365">Vi har vanligtvis hittat NodeType toobe en av de vanligaste hello egenskaper.</span><span class="sxs-lookup"><span data-stu-id="7f686-365">Generally we have found NodeType toobe one of hello most commonly used properties.</span></span> <span data-ttu-id="7f686-366">Det är användbart eftersom det motsvarar en typ av en dator 1:1.</span><span class="sxs-lookup"><span data-stu-id="7f686-366">It is useful since it corresponds 1:1 with a type of a machine.</span></span> <span data-ttu-id="7f686-367">Varje typ av dator motsvarar tooa typ av arbetsbelastning i ett program med traditionella n-nivå.</span><span class="sxs-lookup"><span data-stu-id="7f686-367">Each type of machine corresponds tooa type of workload in a traditional n-tier application.</span></span>

<span data-ttu-id="7f686-368"><center>
![Placeringen och nodegenskaper][Image6]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-368"><center>
![Placement Constraints and Node Properties][Image6]
</center></span></span>

## <a name="placement-constraint-and-node-property-syntax"></a><span data-ttu-id="7f686-369">Begränsning för placering och noden egenskapssyntax</span><span class="sxs-lookup"><span data-stu-id="7f686-369">Placement Constraint and Node Property Syntax</span></span> 
<span data-ttu-id="7f686-370">hello-värdet som anges i hello nodegenskap kan vara en sträng, bool, eller signerat länge.</span><span class="sxs-lookup"><span data-stu-id="7f686-370">hello value specified in hello node property can be a string, bool, or signed long.</span></span> <span data-ttu-id="7f686-371">hello-instruktion på hello tjänsten kallas en placering *begränsningen* eftersom den begränsar där hello kan köras i hello kluster.</span><span class="sxs-lookup"><span data-stu-id="7f686-371">hello statement at hello service is called a placement *constraint* since it constrains where hello service can run in hello cluster.</span></span> <span data-ttu-id="7f686-372">hello-begränsningen kan vara alla booleskt uttryck som körs på hello olika nodegenskaper i hello kluster.</span><span class="sxs-lookup"><span data-stu-id="7f686-372">hello constraint can be any Boolean statement that operates on hello different node properties in hello cluster.</span></span> <span data-ttu-id="7f686-373">hello giltig väljare i dessa booleskt uttryck är:</span><span class="sxs-lookup"><span data-stu-id="7f686-373">hello valid selectors in these boolean statements are:</span></span>

1) <span data-ttu-id="7f686-374">villkorliga kontroller för att skapa specifika instruktioner</span><span class="sxs-lookup"><span data-stu-id="7f686-374">conditional checks for creating particular statements</span></span>

| <span data-ttu-id="7f686-375">Instruktionen</span><span class="sxs-lookup"><span data-stu-id="7f686-375">Statement</span></span> | <span data-ttu-id="7f686-376">Syntax</span><span class="sxs-lookup"><span data-stu-id="7f686-376">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="7f686-377">”lika med”</span><span class="sxs-lookup"><span data-stu-id="7f686-377">"equal to"</span></span> | <span data-ttu-id="7f686-378">"=="</span><span class="sxs-lookup"><span data-stu-id="7f686-378">"=="</span></span> |
| <span data-ttu-id="7f686-379">”inte lika med”</span><span class="sxs-lookup"><span data-stu-id="7f686-379">"not equal to"</span></span> | <span data-ttu-id="7f686-380">"!="</span><span class="sxs-lookup"><span data-stu-id="7f686-380">"!="</span></span> |
| <span data-ttu-id="7f686-381">”större än”</span><span class="sxs-lookup"><span data-stu-id="7f686-381">"greater than"</span></span> | <span data-ttu-id="7f686-382">">"</span><span class="sxs-lookup"><span data-stu-id="7f686-382">">"</span></span> |
| <span data-ttu-id="7f686-383">”större än eller lika med”</span><span class="sxs-lookup"><span data-stu-id="7f686-383">"greater than or equal to"</span></span> | <span data-ttu-id="7f686-384">">="</span><span class="sxs-lookup"><span data-stu-id="7f686-384">">="</span></span> |
| <span data-ttu-id="7f686-385">”mindre än”</span><span class="sxs-lookup"><span data-stu-id="7f686-385">"less than"</span></span> | <span data-ttu-id="7f686-386">"<"</span><span class="sxs-lookup"><span data-stu-id="7f686-386">"<"</span></span> |
| <span data-ttu-id="7f686-387">”mindre än eller lika med”</span><span class="sxs-lookup"><span data-stu-id="7f686-387">"less than or equal to"</span></span> | <span data-ttu-id="7f686-388">"<="</span><span class="sxs-lookup"><span data-stu-id="7f686-388">"<="</span></span> |

2) <span data-ttu-id="7f686-389">Booleskt uttryck för gruppering och logiska åtgärder</span><span class="sxs-lookup"><span data-stu-id="7f686-389">boolean statements for grouping and logical operations</span></span>

| <span data-ttu-id="7f686-390">Instruktionen</span><span class="sxs-lookup"><span data-stu-id="7f686-390">Statement</span></span> | <span data-ttu-id="7f686-391">Syntax</span><span class="sxs-lookup"><span data-stu-id="7f686-391">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="7f686-392">”och”</span><span class="sxs-lookup"><span data-stu-id="7f686-392">"and"</span></span> | <span data-ttu-id="7f686-393">"&&"</span><span class="sxs-lookup"><span data-stu-id="7f686-393">"&&"</span></span> |
| <span data-ttu-id="7f686-394">”eller”</span><span class="sxs-lookup"><span data-stu-id="7f686-394">"or"</span></span> | <span data-ttu-id="7f686-395">"&#124;&#124;"</span><span class="sxs-lookup"><span data-stu-id="7f686-395">"&#124;&#124;"</span></span> |
| <span data-ttu-id="7f686-396">”inte”</span><span class="sxs-lookup"><span data-stu-id="7f686-396">"not"</span></span> | <span data-ttu-id="7f686-397">"!"</span><span class="sxs-lookup"><span data-stu-id="7f686-397">"!"</span></span> |
| <span data-ttu-id="7f686-398">”gruppen som enskild instruktion”</span><span class="sxs-lookup"><span data-stu-id="7f686-398">"group as single statement"</span></span> | <span data-ttu-id="7f686-399">"()"</span><span class="sxs-lookup"><span data-stu-id="7f686-399">"()"</span></span> |

<span data-ttu-id="7f686-400">Här följer några exempel på grundläggande begränsning instruktioner.</span><span class="sxs-lookup"><span data-stu-id="7f686-400">Here are some examples of basic constraint statements.</span></span>

  * `"Value >= 5"`
  * `"NodeColor != green"`
  * `"((OneProperty < 100) || ((AnotherProperty == false) && (OneProperty >= 100)))"`

<span data-ttu-id="7f686-401">Endast noder där hello övergripande placering begränsningen uttryck utvärderas för ”True” kan ha hello-tjänst som placeras på den.</span><span class="sxs-lookup"><span data-stu-id="7f686-401">Only nodes where hello overall placement constraint statement evaluates too“True” can have hello service placed on it.</span></span> <span data-ttu-id="7f686-402">Noder som inte har en definierad egenskap matchar inte någon placering begränsningen som innehåller egenskapen.</span><span class="sxs-lookup"><span data-stu-id="7f686-402">Nodes that do not have a property defined do not match any placement constraint containing that property.</span></span>

<span data-ttu-id="7f686-403">Anta att hello följande egenskaper har definierats för en viss nod nod:</span><span class="sxs-lookup"><span data-stu-id="7f686-403">Let’s say that hello following node properties were defined for a given node type:</span></span>

<span data-ttu-id="7f686-404">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="7f686-404">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType01">
      <PlacementProperties>
        <Property Name="HasSSD" Value="true"/>
        <Property Name="NodeColor" Value="green"/>
        <Property Name="SomeProperty" Value="5"/>
      </PlacementProperties>
    </NodeType>
```

<span data-ttu-id="7f686-405">värdbaserad kluster via ClusterConfig.json för fristående distributioner eller Template.json för Azure.</span><span class="sxs-lookup"><span data-stu-id="7f686-405">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

> [!NOTE]
> <span data-ttu-id="7f686-406">I noden Azure Resource Manager mallen hello parametriserade vanligtvis typen.</span><span class="sxs-lookup"><span data-stu-id="7f686-406">In your Azure Resource Manager template hello node type is usually parameterized.</span></span> <span data-ttu-id="7f686-407">Det skulle se ut som ”[parameters('vmNodeType1Name')]” i stället för ”NodeType01”.</span><span class="sxs-lookup"><span data-stu-id="7f686-407">It would look like "[parameters('vmNodeType1Name')]" rather than "NodeType01".</span></span>
>

```json
"nodeTypes": [
    {
        "name": "NodeType01",
        "placementProperties": {
            "HasSSD": "true",
            "NodeColor": "green",
            "SomeProperty": "5"
        },
    }
],
```

<span data-ttu-id="7f686-408">Du kan skapa tjänsten placering *begränsningar* för en tjänst som på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="7f686-408">You can create service placement *constraints* for a service like as follows:</span></span>

<span data-ttu-id="7f686-409">C#</span><span class="sxs-lookup"><span data-stu-id="7f686-409">C#</span></span>

```csharp
FabricClient fabricClient = new FabricClient();
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
serviceDescription.PlacementConstraints = "(HasSSD == true && SomeProperty >= 4)";
// add other required servicedescription fields
//...
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="7f686-410">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7f686-410">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceType -Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton -PlacementConstraint "HasSSD == true && SomeProperty >= 4"
```

<span data-ttu-id="7f686-411">Om alla noder i NodeType01 är giltiga, du kan också välja att nodtypen med hello begränsningen ”(NodeType == NodeType01)”.</span><span class="sxs-lookup"><span data-stu-id="7f686-411">If all nodes of NodeType01 are valid, you can also select that node type with hello constraint "(NodeType == NodeType01)".</span></span>

<span data-ttu-id="7f686-412">En av hello bästa sakerna placeringen för en tjänst är att de kan uppdateras dynamiskt vid körning.</span><span class="sxs-lookup"><span data-stu-id="7f686-412">One of hello cool things about a service’s placement constraints is that they can be updated dynamically during runtime.</span></span> <span data-ttu-id="7f686-413">Så om du behöver kan du flytta en tjänst i hello kluster, lägga till och ta bort krav, osv. Service Fabric hand tar om garanterar säkerheten hello service in och är tillgänglig även när dessa typer av ändringar görs.</span><span class="sxs-lookup"><span data-stu-id="7f686-413">So if you need to, you can move a service around in hello cluster, add and remove requirements, etc. Service Fabric takes care of ensuring that hello service stays up and available even when these types of changes are made.</span></span>

<span data-ttu-id="7f686-414">C#:</span><span class="sxs-lookup"><span data-stu-id="7f686-414">C#:</span></span>

```csharp
StatefulServiceUpdateDescription updateDescription = new StatefulServiceUpdateDescription();
updateDescription.PlacementConstraints = "NodeType == NodeType01";
await fabricClient.ServiceManager.UpdateServiceAsync(new Uri("fabric:/app/service"), updateDescription);
```

<span data-ttu-id="7f686-415">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7f686-415">Powershell:</span></span>

```posh
Update-ServiceFabricService -Stateful -ServiceName $serviceName -PlacementConstraints "NodeType == NodeType01"
```

<span data-ttu-id="7f686-416">Placeringen har angetts för varje olika namngivna service-instans.</span><span class="sxs-lookup"><span data-stu-id="7f686-416">Placement constraints are specified for every different named service instance.</span></span> <span data-ttu-id="7f686-417">Uppdateringar alltid ske hello av (Skriv över) det tidigare har angetts.</span><span class="sxs-lookup"><span data-stu-id="7f686-417">Updates always take hello place of (overwrite) what was previously specified.</span></span>

<span data-ttu-id="7f686-418">hello klustret definition definierar hello egenskaper på en nod.</span><span class="sxs-lookup"><span data-stu-id="7f686-418">hello cluster definition defines hello properties on a node.</span></span> <span data-ttu-id="7f686-419">Ändra egenskaper för en nod kräver en uppgradering för konfiguration av klustret.</span><span class="sxs-lookup"><span data-stu-id="7f686-419">Changing a node's properties requires a cluster configuration upgrade.</span></span> <span data-ttu-id="7f686-420">Uppgradera en nodegenskaper kräver varje påverkade noden toorestart tooreport dess nya egenskaper.</span><span class="sxs-lookup"><span data-stu-id="7f686-420">Upgrading a node's properties requires each affected node toorestart tooreport its new properties.</span></span> <span data-ttu-id="7f686-421">Dessa rullande uppgraderingar hanteras av Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="7f686-421">These rolling upgrades are managed by Service Fabric.</span></span>

## <a name="describing-and-managing-cluster-resources"></a><span data-ttu-id="7f686-422">Som beskriver och hantera klusterresurser</span><span class="sxs-lookup"><span data-stu-id="7f686-422">Describing and Managing Cluster Resources</span></span>
<span data-ttu-id="7f686-423">En av de viktigaste jobb av alla orchestrator är toohelp hello hantera resursförbrukning i hello klustret.</span><span class="sxs-lookup"><span data-stu-id="7f686-423">One of hello most important jobs of any orchestrator is toohelp manage resource consumption in hello cluster.</span></span> <span data-ttu-id="7f686-424">Hantera klusterresurser kan innebära ett antal olika saker.</span><span class="sxs-lookup"><span data-stu-id="7f686-424">Managing cluster resources can mean a couple of different things.</span></span> <span data-ttu-id="7f686-425">Först, det är att säkerställa att datorer inte är överbelastad.</span><span class="sxs-lookup"><span data-stu-id="7f686-425">First, there's ensuring that machines are not overloaded.</span></span> <span data-ttu-id="7f686-426">Det innebär att se till att datorer inte kör fler tjänster än de kan hantera.</span><span class="sxs-lookup"><span data-stu-id="7f686-426">This means making sure that machines aren't running more services than they can handle.</span></span> <span data-ttu-id="7f686-427">Det finns andra, belastningsutjämning och optimering som är kritiska toorunning services effektivt.</span><span class="sxs-lookup"><span data-stu-id="7f686-427">Second, there's balancing and optimization which is critical toorunning services efficiently.</span></span> <span data-ttu-id="7f686-428">Kostnad gällande eller prestanda känsliga Tjänsterbjudanden tillåta inte hot vissa noder toobe medan andra är Kall.</span><span class="sxs-lookup"><span data-stu-id="7f686-428">Cost effective or performance sensitive service offerings can't allow some nodes toobe hot while others are cold.</span></span> <span data-ttu-id="7f686-429">Varm noder leda tooresource konkurrens och sämre prestanda och kalla noder representerar gått förlorat resurser och ökade kostnader.</span><span class="sxs-lookup"><span data-stu-id="7f686-429">Hot nodes lead tooresource contention and poor performance, and cold nodes represent wasted resources and increased costs.</span></span> 

<span data-ttu-id="7f686-430">Service Fabric representerar resurser som `Metrics`.</span><span class="sxs-lookup"><span data-stu-id="7f686-430">Service Fabric represents resources as `Metrics`.</span></span> <span data-ttu-id="7f686-431">Mått är en logisk eller fysisk resurs som du vill toodescribe tooService Fabric.</span><span class="sxs-lookup"><span data-stu-id="7f686-431">Metrics are any logical or physical resource that you want toodescribe tooService Fabric.</span></span> <span data-ttu-id="7f686-432">Exempel på mått är till exempel ”WorkQueueDepth” eller ”MemoryInMb”.</span><span class="sxs-lookup"><span data-stu-id="7f686-432">Examples of metrics are things like “WorkQueueDepth” or “MemoryInMb”.</span></span> <span data-ttu-id="7f686-433">Information om hello fysiska resurser som Service Fabric kan styra på noder finns [resurs styrning](service-fabric-resource-governance.md).</span><span class="sxs-lookup"><span data-stu-id="7f686-433">For information about hello physical resources that Service Fabric can govern on nodes, see [resource governance](service-fabric-resource-governance.md).</span></span> <span data-ttu-id="7f686-434">Information om hur du konfigurerar anpassade mått och hur används finns i [i den här artikeln](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="7f686-434">For information on configuring custom metrics and their uses, see [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

<span data-ttu-id="7f686-435">Mått skiljer sig från placeringar begränsningar och egenskaper för en nod.</span><span class="sxs-lookup"><span data-stu-id="7f686-435">Metrics are different from placements constraints and node properties.</span></span> <span data-ttu-id="7f686-436">Nodegenskaper är statisk beskrivningar av själva hello noderna.</span><span class="sxs-lookup"><span data-stu-id="7f686-436">Node properties are static descriptors of hello nodes themselves.</span></span> <span data-ttu-id="7f686-437">Mått beskrivs resurser där noder och att tjänster ska använda när de körs på en nod.</span><span class="sxs-lookup"><span data-stu-id="7f686-437">Metrics describe resources that nodes have and that services consume when they are run on a node.</span></span> <span data-ttu-id="7f686-438">En nodegenskap kan vara ”HasSSD” och kan ställas in tootrue eller false.</span><span class="sxs-lookup"><span data-stu-id="7f686-438">A node property could be "HasSSD" and could be set tootrue or false.</span></span> <span data-ttu-id="7f686-439">hello mängden ledigt utrymme på den SSD och hur mycket som används av tjänster är ett mått som ”DriveSpaceInMb”.</span><span class="sxs-lookup"><span data-stu-id="7f686-439">hello amount of space available on that SSD and how much is consumed by services would be a metric like “DriveSpaceInMb”.</span></span> 

<span data-ttu-id="7f686-440">Det är viktigt toonote som precis som för placeringen och egenskaper för en nod, hello resurshanteraren för Service Fabric-klustret inte förstå vilka hello namnen på hello mått medelvärdet.</span><span class="sxs-lookup"><span data-stu-id="7f686-440">It is important toonote that just like for placement constraints and node properties, hello Service Fabric Cluster Resource Manager doesn't understand what hello names of hello metrics mean.</span></span> <span data-ttu-id="7f686-441">Tjänstmåttets namn är bara strängar.</span><span class="sxs-lookup"><span data-stu-id="7f686-441">Metric names are just strings.</span></span> <span data-ttu-id="7f686-442">Det är ett bra toodeclare enheter som en del av hello mått som du skapar när det kan vara tvetydig.</span><span class="sxs-lookup"><span data-stu-id="7f686-442">It is a good practice toodeclare units as a part of hello metric names that you create when it could be ambiguous.</span></span>

## <a name="capacity"></a><span data-ttu-id="7f686-443">Kapacitet</span><span class="sxs-lookup"><span data-stu-id="7f686-443">Capacity</span></span>
<span data-ttu-id="7f686-444">Om du har inaktiverat alla *NLB*, Service Fabric-klustret Resource Manager skulle fortfarande se till att ingen nod avslutas över sin kapacitet.</span><span class="sxs-lookup"><span data-stu-id="7f686-444">If you turned off all resource *balancing*, Service Fabric’s Cluster Resource Manager would still ensure that no node ended up over its capacity.</span></span> <span data-ttu-id="7f686-445">Det är möjligt att hantera kapacitet loggens överskrids såvida hello klustret är full eller hello arbetsbelastningen är större än en nod.</span><span class="sxs-lookup"><span data-stu-id="7f686-445">Managing capacity overruns is possible unless hello cluster is too full or hello workload is larger than any node.</span></span> <span data-ttu-id="7f686-446">Kapaciteten är en annan *begränsningen* som hello hanteraren för filserverresurser använder toounderstand hur mycket av en resurs en nod har.</span><span class="sxs-lookup"><span data-stu-id="7f686-446">Capacity is another *constraint* that hello Cluster Resource Manager uses toounderstand how much of a resource a node has.</span></span> <span data-ttu-id="7f686-447">Återstående kapacitet också spåras hello klustret som helhet.</span><span class="sxs-lookup"><span data-stu-id="7f686-447">Remaining capacity is also tracked for hello cluster as a whole.</span></span> <span data-ttu-id="7f686-448">Både hello kapacitet och hello förbrukning i hello servicenivå uttrycks i mått.</span><span class="sxs-lookup"><span data-stu-id="7f686-448">Both hello capacity and hello consumption at hello service level are expressed in terms of metrics.</span></span> <span data-ttu-id="7f686-449">Exempelvis hello mått kan vara ”ClientConnections” och en viss nod kan ha en kapacitet för ”ClientConnections” på 32768.</span><span class="sxs-lookup"><span data-stu-id="7f686-449">So for example, hello metric might be "ClientConnections" and a given Node may have a capacity for "ClientConnections" of 32768.</span></span> <span data-ttu-id="7f686-450">Andra noder kan har andra begränsningar vissa-tjänsten körs på den nod kan säga den för närvarande förbrukar 32256 av hello mått ”ClientConnections”.</span><span class="sxs-lookup"><span data-stu-id="7f686-450">Other nodes can have other limits Some service running on that node can say it is currently consuming 32256 of hello metric "ClientConnections".</span></span>

<span data-ttu-id="7f686-451">Under körning spårar hello klustret Resource Manager återstående kapacitet i hello klustret och på noder.</span><span class="sxs-lookup"><span data-stu-id="7f686-451">During runtime, hello Cluster Resource Manager tracks remaining capacity in hello cluster and on nodes.</span></span> <span data-ttu-id="7f686-452">I ordning tootrack subtraherar kapacitet hello klustret Resource Manager varje tjänst användning från nodens kapacitet där hello-tjänsten körs.</span><span class="sxs-lookup"><span data-stu-id="7f686-452">In order tootrack capacity hello Cluster Resource Manager subtracts each service's usage from node's capacity where hello service runs.</span></span> <span data-ttu-id="7f686-453">Med den här informationen hello resurshanteraren för Service Fabric-klustret kan ta reda på var tooplace eller flytta repliker så att noderna inte gå igenom kapacitet.</span><span class="sxs-lookup"><span data-stu-id="7f686-453">With this information, hello Service Fabric Cluster Resource Manager can figure out where tooplace or move replicas so that nodes don’t go over capacity.</span></span>

<span data-ttu-id="7f686-454"><center>
![Klusternoder och kapacitet][Image7]
</center></span><span class="sxs-lookup"><span data-stu-id="7f686-454"><center>
![Cluster nodes and capacity][Image7]
</center></span></span>

<span data-ttu-id="7f686-455">C#:</span><span class="sxs-lookup"><span data-stu-id="7f686-455">C#:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
ServiceLoadMetricDescription metric = new ServiceLoadMetricDescription();
metric.Name = "ClientConnections";
metric.PrimaryDefaultLoad = 1024;
metric.SecondaryDefaultLoad = 0;
metric.Weight = ServiceLoadMetricWeight.High;
serviceDescription.Metrics.Add(metric);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="7f686-456">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7f686-456">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ClientConnections,High,1024,0)
```

<span data-ttu-id="7f686-457">Du kan se de kapaciteter som definierats i klustermanifestet hello:</span><span class="sxs-lookup"><span data-stu-id="7f686-457">You can see capacities defined in hello cluster manifest:</span></span>

<span data-ttu-id="7f686-458">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="7f686-458">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType03">
      <Capacities>
        <Capacity Name="ClientConnections" Value="65536"/>
      </Capacities>
    </NodeType>
```

<span data-ttu-id="7f686-459">värdbaserad kluster via ClusterConfig.json för fristående distributioner eller Template.json för Azure.</span><span class="sxs-lookup"><span data-stu-id="7f686-459">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

```json
"nodeTypes": [
    {
        "name": "NodeType03",
        "capacities": {
            "ClientConnections": "65536",
        }
    }
],
```

<span data-ttu-id="7f686-460">Ofta en tjänst att läsa in ändras dynamiskt.</span><span class="sxs-lookup"><span data-stu-id="7f686-460">Commonly a service’s load changes dynamically.</span></span> <span data-ttu-id="7f686-461">Anta att en replik belastningen på ”ClientConnections” har ändrats från 1024 too2048 men hello nod kördes på därefter endast hade 512 kapacitet kvar för att mått.</span><span class="sxs-lookup"><span data-stu-id="7f686-461">Say that a replica's load of "ClientConnections" changed from 1024 too2048, but hello node it was running on then only had 512 capacity remaining for that metric.</span></span> <span data-ttu-id="7f686-462">Nu den repliken eller instansens placering är ogiltigt, eftersom det inte finns tillräckligt med utrymme på noden.</span><span class="sxs-lookup"><span data-stu-id="7f686-462">Now that replica or instance's placement is invalid, since there's not enough room on that node.</span></span> <span data-ttu-id="7f686-463">hello klustret Resource Manager har tookick i och få hello nod under kapacitet.</span><span class="sxs-lookup"><span data-stu-id="7f686-463">hello Cluster Resource Manager has tookick in and get hello node back below capacity.</span></span> <span data-ttu-id="7f686-464">Det minskar belastningen på hello-nod som är överbelastade genom att flytta en eller flera av hello repliker eller instanser från de nod tooother noderna.</span><span class="sxs-lookup"><span data-stu-id="7f686-464">It reduces load on hello node that is over capacity by moving one or more of hello replicas or instances from that node tooother nodes.</span></span> <span data-ttu-id="7f686-465">När du flyttar repliker försöker hello klustret Resource Manager toominimize hello kostnaden för dessa transporter.</span><span class="sxs-lookup"><span data-stu-id="7f686-465">When moving replicas, hello Cluster Resource Manager tries toominimize hello cost of those movements.</span></span> <span data-ttu-id="7f686-466">Förflyttningskostnad beskrivs i [i den här artikeln](service-fabric-cluster-resource-manager-movement-cost.md) mer om hello klustret Resource Manager ombalansering strategier och regler beskrivs [här](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="7f686-466">Movement cost is discussed in [this article](service-fabric-cluster-resource-manager-movement-cost.md) and more about hello Cluster Resource Manager's rebalancing strategies and rules is described [here](service-fabric-cluster-resource-manager-metrics.md).</span></span>

## <a name="cluster-capacity"></a><span data-ttu-id="7f686-467">Kluster-kapacitet</span><span class="sxs-lookup"><span data-stu-id="7f686-467">Cluster capacity</span></span>
<span data-ttu-id="7f686-468">Hur hello resurshanteraren för Service Fabric-klustret keep hello övergripande kluster från att vara full?</span><span class="sxs-lookup"><span data-stu-id="7f686-468">So how does hello Service Fabric Cluster Resource Manager keep hello overall cluster from being too full?</span></span> <span data-ttu-id="7f686-469">Dessutom med dynamiska belastning som det inte finns mycket du kan göra.</span><span class="sxs-lookup"><span data-stu-id="7f686-469">Well, with dynamic load there’s not a lot it can do.</span></span> <span data-ttu-id="7f686-470">Tjänster kan ha sina belastningen topp oberoende av åtgärder som vidtas av hello klustret Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="7f686-470">Services can have their load spike independently of actions taken by hello Cluster Resource Manager.</span></span> <span data-ttu-id="7f686-471">Klustret med tillräckligt med utrymme i dag kan därför vara underpowered när du blir berömda i morgon.</span><span class="sxs-lookup"><span data-stu-id="7f686-471">As a result, your cluster with plenty of headroom today may be underpowered when you become famous tomorrow.</span></span> <span data-ttu-id="7f686-472">Namn, det finns vissa kontroller som är inbyggd i tooprevent problem.</span><span class="sxs-lookup"><span data-stu-id="7f686-472">That said, there are some controls that are baked in tooprevent problems.</span></span> <span data-ttu-id="7f686-473">hello första vi kan göra är förhindra hello skapandet av nya arbetsbelastningar som skulle orsaka hello klustret toobecome fullständig.</span><span class="sxs-lookup"><span data-stu-id="7f686-473">hello first thing we can do is prevent hello creation of new workloads that would cause hello cluster toobecome full.</span></span>

<span data-ttu-id="7f686-474">Anta att du skapar en tillståndslös tjänst och den innehåller vissa som är kopplade till den.</span><span class="sxs-lookup"><span data-stu-id="7f686-474">Say that you create a stateless service and it has some load associated with it.</span></span> <span data-ttu-id="7f686-475">Anta att hello service mån om hello ”DiskSpaceInMb” mått.</span><span class="sxs-lookup"><span data-stu-id="7f686-475">Let’s say that hello service cares about hello "DiskSpaceInMb" metric.</span></span> <span data-ttu-id="7f686-476">Anta också att det är pågående tooconsume fem enheter av ”DiskSpaceInMb” för varje instans av hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="7f686-476">Let's also say that it is going tooconsume five units of "DiskSpaceInMb" for every instance of hello service.</span></span> <span data-ttu-id="7f686-477">Vill du toocreate tre instanser av hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="7f686-477">You want toocreate three instances of hello service.</span></span> <span data-ttu-id="7f686-478">Bra!</span><span class="sxs-lookup"><span data-stu-id="7f686-478">Great!</span></span> <span data-ttu-id="7f686-479">Så att innebär att vi behöver 15 enheter av ”DiskSpaceInMb” toobe i hello kluster för oss tooeven vara kan toocreate dessa instanser av tjänsten.</span><span class="sxs-lookup"><span data-stu-id="7f686-479">So that means that we need 15 units of "DiskSpaceInMb" toobe present in hello cluster in order for us tooeven be able toocreate these service instances.</span></span> <span data-ttu-id="7f686-480">hello klustret Resource Manager beräknar kontinuerligt hello kapacitet och användning av varje mått så att den kan se hello återstående kapacitet i hello klustret.</span><span class="sxs-lookup"><span data-stu-id="7f686-480">hello Cluster Resource Manager continually calculates hello capacity and consumption of each metric so it can determine hello remaining capacity in hello cluster.</span></span> <span data-ttu-id="7f686-481">Om det inte finns tillräckligt med utrymme, skapa hello klustret Resource Manager avvisar hello anropet till tjänsten.</span><span class="sxs-lookup"><span data-stu-id="7f686-481">If there isn't enough space, hello Cluster Resource Manager rejects hello create service call.</span></span>

<span data-ttu-id="7f686-482">Eftersom hello krävs endast att det finnas 15 enheter, kan detta utrymme allokeras många olika sätt.</span><span class="sxs-lookup"><span data-stu-id="7f686-482">Since hello requirement is only that there be 15 units available, this space could be allocated many different ways.</span></span> <span data-ttu-id="7f686-483">Till exempel, kan det finnas en återstående enhet av kapacitet på 15 olika noder eller tre återstående enheter av kapacitet på fem olika noder.</span><span class="sxs-lookup"><span data-stu-id="7f686-483">For example, there could be one remaining unit of capacity on 15 different nodes, or three remaining units of capacity on five different nodes.</span></span> <span data-ttu-id="7f686-484">Om hello klustret Resource Manager kan ordna om saker så att det finns fem enheter på tre noder, placerar hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="7f686-484">If hello Cluster Resource Manager can rearrange things so there's five units available on three nodes, it places hello service.</span></span> <span data-ttu-id="7f686-485">Ordna om hello-kluster är vanligtvis inte hello klustret är nästan full eller går inte att konsolidera hello befintliga tjänster av någon anledning.</span><span class="sxs-lookup"><span data-stu-id="7f686-485">Rearranging hello cluster is usually possible unless hello cluster is almost full or hello existing services can't be consolidated for some reason.</span></span>

## <a name="buffered-capacity"></a><span data-ttu-id="7f686-486">Buffrat kapacitet</span><span class="sxs-lookup"><span data-stu-id="7f686-486">Buffered Capacity</span></span>
<span data-ttu-id="7f686-487">Buffrat kapacitet är en annan funktion i hello klustret Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="7f686-487">Buffered capacity is another feature of hello Cluster Resource Manager.</span></span> <span data-ttu-id="7f686-488">Det tillåter reservation av en del av hello övergripande nodens kapacitet.</span><span class="sxs-lookup"><span data-stu-id="7f686-488">It allows reservation of some portion of hello overall node capacity.</span></span> <span data-ttu-id="7f686-489">Den här kapaciteten bufferten är endast använda tooplace tjänster under uppgraderingar och nodfel.</span><span class="sxs-lookup"><span data-stu-id="7f686-489">This capacity buffer is only used tooplace services during upgrades and node failures.</span></span> <span data-ttu-id="7f686-490">Buffrat kapacitet anges globalt per mått för alla noder.</span><span class="sxs-lookup"><span data-stu-id="7f686-490">Buffered Capacity is specified globally per metric for all nodes.</span></span> <span data-ttu-id="7f686-491">hello-värde som du väljer för hello reserverad kapacitet är en funktion av hello antal fel och uppgradera domäner som du har i hello kluster.</span><span class="sxs-lookup"><span data-stu-id="7f686-491">hello value you pick for hello reserved capacity is a function of hello number of Fault and Upgrade Domains you have in hello cluster.</span></span> <span data-ttu-id="7f686-492">Flera fel och uppgradera domäner innebär att du kan välja ett lägre värde för din buffrat kapacitet.</span><span class="sxs-lookup"><span data-stu-id="7f686-492">More Fault and Upgrade Domains means that you can pick a lower number for your buffered capacity.</span></span> <span data-ttu-id="7f686-493">Om du har flera domäner, du kan förvänta sig mindre mängder kluster-toobe otillgänglig under uppgraderingar och fel.</span><span class="sxs-lookup"><span data-stu-id="7f686-493">If you have more domains, you can expect smaller amounts of your cluster toobe unavailable during upgrades and failures.</span></span> <span data-ttu-id="7f686-494">Ange buffras kapacitet endast meningsfullt om du har angivna hello nod kapacitet för ett mått.</span><span class="sxs-lookup"><span data-stu-id="7f686-494">Specifying Buffered Capacity only makes sense if you have also specified hello node capacity for a metric.</span></span>

<span data-ttu-id="7f686-495">Här är ett exempel på hur toospecify buffras kapacitet:</span><span class="sxs-lookup"><span data-stu-id="7f686-495">Here's an example of how toospecify buffered capacity:</span></span>

<span data-ttu-id="7f686-496">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="7f686-496">ClusterManifest.xml</span></span>

```xml
        <Section Name="NodeBufferPercentage">
            <Parameter Name="SomeMetric" Value="0.15" />
            <Parameter Name="SomeOtherMetric" Value="0.20" />
        </Section>
```

<span data-ttu-id="7f686-497">värdbaserade kluster via ClusterConfig.json för fristående distributioner eller Template.json för Azure:</span><span class="sxs-lookup"><span data-stu-id="7f686-497">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "NodeBufferPercentage",
    "parameters": [
      {
          "name": "SomeMetric",
          "value": "0.15"
      },
      {
          "name": "SomeOtherMetric",
          "value": "0.20"
      }
    ]
  }
]
```

<span data-ttu-id="7f686-498">hello skapandet av nya tjänster misslyckas när hello klustret ligger utanför buffrat kapacitet för ett mått.</span><span class="sxs-lookup"><span data-stu-id="7f686-498">hello creation of new services fails when hello cluster is out of buffered capacity for a metric.</span></span> <span data-ttu-id="7f686-499">Hindrar hello skapandet av nya tjänster toopreserve hello bufferten säkerställer att uppgraderingar och fel inte orsaka noder toogo överbelastade.</span><span class="sxs-lookup"><span data-stu-id="7f686-499">Preventing hello creation of new services toopreserve hello buffer ensures that upgrades and failures don’t cause nodes toogo over capacity.</span></span> <span data-ttu-id="7f686-500">Buffrat kapacitet är valfritt men rekommenderas i ett kluster som definierar kapaciteten för ett mått.</span><span class="sxs-lookup"><span data-stu-id="7f686-500">Buffered capacity is optional but is recommended in any cluster that defines a capacity for a metric.</span></span>

<span data-ttu-id="7f686-501">hello klustret Resource Manager visar informationen belastningen.</span><span class="sxs-lookup"><span data-stu-id="7f686-501">hello Cluster Resource Manager exposes this load information.</span></span> <span data-ttu-id="7f686-502">Informationen omfattar för varje mått:</span><span class="sxs-lookup"><span data-stu-id="7f686-502">For each metric, this information includes:</span></span> 
  - <span data-ttu-id="7f686-503">hello buffras kapacitetsinställningarna</span><span class="sxs-lookup"><span data-stu-id="7f686-503">hello buffered capacity settings</span></span>
  - <span data-ttu-id="7f686-504">hello total kapacitet</span><span class="sxs-lookup"><span data-stu-id="7f686-504">hello total capacity</span></span>
  - <span data-ttu-id="7f686-505">hello strömförbrukningen</span><span class="sxs-lookup"><span data-stu-id="7f686-505">hello current consumption</span></span>
  - <span data-ttu-id="7f686-506">Anger om varje mått anses belastningsutjämnade eller inte</span><span class="sxs-lookup"><span data-stu-id="7f686-506">whether each metric is considered balanced or not</span></span>
  - <span data-ttu-id="7f686-507">statistik om hello standardavvikelse</span><span class="sxs-lookup"><span data-stu-id="7f686-507">statistics about hello standard deviation</span></span>
  - <span data-ttu-id="7f686-508">hello-noder som har hello belastning på de flesta och minst</span><span class="sxs-lookup"><span data-stu-id="7f686-508">hello nodes which have hello most and least load</span></span>  
  
<span data-ttu-id="7f686-509">Nedan finns det ett exempel på dessa utdata:</span><span class="sxs-lookup"><span data-stu-id="7f686-509">Below we see an example of that output:</span></span>

```posh
PS C:\Users\user> Get-ServiceFabricClusterLoadInformation
LastBalancingStartTimeUtc : 9/1/2016 12:54:59 AM
LastBalancingEndTimeUtc   : 9/1/2016 12:54:59 AM
LoadMetricInformation     :
                            LoadMetricName        : Metric1
                            IsBalancedBefore      : False
                            IsBalancedAfter       : False
                            DeviationBefore       : 0.192450089729875
                            DeviationAfter        : 0.192450089729875
                            BalancingThreshold    : 1
                            Action                : NoActionNeeded
                            ActivityThreshold     : 0
                            ClusterCapacity       : 189
                            ClusterLoad           : 45
                            ClusterRemainingCapacity : 144
                            NodeBufferPercentage  : 10
                            ClusterBufferedCapacity : 170
                            ClusterRemainingBufferedCapacity : 125
                            ClusterCapacityViolation : False
                            MinNodeLoadValue      : 0
                            MinNodeLoadNodeId     : 3ea71e8e01f4b0999b121abcbf27d74d
                            MaxNodeLoadValue      : 15
                            MaxNodeLoadNodeId     : 2cc648b6770be1bc9824fa995d5b68b1
```

## <a name="next-steps"></a><span data-ttu-id="7f686-510">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="7f686-510">Next steps</span></span>
* <span data-ttu-id="7f686-511">Information om hello arkitektur och information om flödet i hello klustret Resource Manager kolla [den här artikeln](service-fabric-cluster-resource-manager-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="7f686-511">For information on hello architecture and information flow within hello Cluster Resource Manager, check out [this article ](service-fabric-cluster-resource-manager-architecture.md)</span></span>
* <span data-ttu-id="7f686-512">Definiera defragmentering mått är ett sätt tooconsolidate belastningen på noder i stället för att sprida. toolearn hur tooconfigure defragmenteringen finns för[i den här artikeln](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="7f686-512">Defining Defragmentation Metrics is one way tooconsolidate load on nodes instead of spreading it out. toolearn how tooconfigure defragmentation, refer too[this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
* <span data-ttu-id="7f686-513">Starta från början hello och [få en introduktion toohello resurshanteraren för Service Fabric-kluster](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="7f686-513">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
* <span data-ttu-id="7f686-514">toofind ut om hur hello klustret Resource Manager hanterar och balanserar belastningen i hello kluster kolla hello artikel på [belastningsutjämning](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="7f686-514">toofind out about how hello Cluster Resource Manager manages and balances load in hello cluster, check out hello article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-domains.png
[Image2]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-uneven-fault-domain-layout.png
[Image3]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domains-with-placement.png
[Image4]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domain-layout-strategies.png
[Image5]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-layout-different-workloads.png
[Image6]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-placement-constraints-node-properties.png
[Image7]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-nodes-and-capacity.png
