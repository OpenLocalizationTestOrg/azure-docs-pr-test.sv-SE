---
title: "aaaHow tooconfigure en Kerberos-begränsad delegering med Application Proxy programmet toouse | Microsoft Docs"
description: "Hur tooconfigure Kerberos-begränsad delegering för ett program för Azure AD Application Proxy."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="1ff8d-103">Hur tooconfigure en programproxy programmet toouse Kerberos-begränsad delegering</span><span class="sxs-lookup"><span data-stu-id="1ff8d-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="1ff8d-104">hello tillgängliga metoder för att uppnå SSO toopublished program kan variera något från programmet tooapplication och en av hello alternativ som innehåller Azure Application Proxy hello omedelbart, är Kerberos-begränsad delegering (KCD).</span><span class="sxs-lookup"><span data-stu-id="1ff8d-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="1ff8d-105">Detta är där en koppling värd konfigurerade tooperform begränsad kerberos-autentisering toobackend program åt användare.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="1ff8d-106">hello faktiska proceduren för att aktivera KCD är relativt enkla och kräver normalt inte fler än en förståelse av hello olika komponenter och autentiseringsflödet som underlättar enkel inloggning.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="1ff8d-107">Hitta bra källor till information toohelp felsöka scenarier där KCD SSO inte fungerar som förväntat, kan vara null-optimerad.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="1ff8d-108">Den här artikeln försöker därför tooprovide en enda åtkomstpunkt för referens som bör underlätta felsökning och åtgärda själva hello de vanligaste problem som vi finns.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="1ff8d-109">Vid hello samma tid erbjudandet ytterligare vägledning för att diagnostisera hello mer komplex och skadade genomförande.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="1ff8d-110">Observera att den här artikeln gör hello följande förutsättningar:</span><span class="sxs-lookup"><span data-stu-id="1ff8d-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="1ff8d-111">Azure Application Proxy har distribuerats enligt våra [dokumentationen](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) och allmän åtkomst toonon KCD program fungerar som förväntat.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="1ff8d-112">hello baseras publicerade målprogrammet på IIS och Microsofts implementering av kerberos.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="1ff8d-113">Hej server- och värdar placeras i en enda Active Directory-domän.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="1ff8d-114">Detaljerad information om mellan domäner och skogar scenarier finns i vår [KCD whitepaper](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="1ff8d-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="1ff8d-115">hello programmet har publicerats i en Azure-klient med förautentisering aktiverade och användare förväntas tooauthenticate tooAzure via formulär-baserad autentisering.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="1ff8d-116">Rich-klient autentiseringsscenarier omfattas inte av den här artikeln, men läggas på någon punkt i hello framtida.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="1ff8d-117">Krav</span><span class="sxs-lookup"><span data-stu-id="1ff8d-117">Prerequisites</span></span>

<span data-ttu-id="1ff8d-118">Azure Application Proxy kan distribueras till nästan alla typer av infrastruktur eller miljö och hello arkitekturer säkert skilja sig från organisationen tooorganization.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="1ff8d-119">En av hello de vanligaste orsakerna till KCD relaterade problem inte är hello-miljöer, men ganska enkelt att konfigurationer eller allmänna tillsyn.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="1ff8d-120">Därför våra är alltid toostart genom att kontrollera att du har uppfyllt alla hello förutsättningar som anges i vår main [med KCD enkel inloggning med hello Application Proxy-artikel](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) innan du startar felsökning.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="1ff8d-121">Särskilt hello avsnitt om hur du konfigurerar KCD på 2012R2, eftersom det använder en helt olika tillvägagångssätt tooconfiguring KCD i tidigare versioner av Windows, utan även när du är uppmärksam på flera saker:</span><span class="sxs-lookup"><span data-stu-id="1ff8d-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="1ff8d-122">Det är inte ovanligt att en domän medlem server tooopen en säker kanal dialogruta med en specifik domänkontrollant.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="1ff8d-123">Flytta sedan tooanother dialogrutan samtidigt, så att anslutningen värdar inte ska i allmänhet vara begränsad toobeing kan toocommunicate med specifika lokala platsen domänkontrollanter.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="1ff8d-124">Liknande toohello över punkten över domäner scenarier som förlitar sig på referenser som en koppling värden tooDCs som kan finnas utanför hello lokala nätverket perimeternätverk direkt.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="1ff8d-125">I det här fallet är det lika viktigt att du också tillåter trafik och senare tooDCs som representerar andra respektive domäner, annars delegering toomake misslyckas.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="1ff8d-126">Om möjligt bör bör du inte släpps alla aktiva IP-adresser/ID: N mellan värddatorer för anslutningen och domänkontrollanter, eftersom dessa ibland över påträngande och störa core RPC-trafik</span><span class="sxs-lookup"><span data-stu-id="1ff8d-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="1ff8d-127">Så mycket som vi vill gärna tooresolve problem snabbt och effektivt, det kan ta tid, så om möjligt du försök och testa delegering i hello enklaste scenarier.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="1ff8d-128">Hej flera variabler som du lägger till, hello mer du kan ha toocontend med.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="1ff8d-129">Till exempel begränsa dina tester tooa enskild koppling kan spara värdefull tid och ytterligare kopplingar kan läggas till efter hello problem har lösts.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="1ff8d-130">Vissa miljöfaktorer kan även bidra tooan problemet så igen om möjligt försök och minimera hello arkitektur tooa minsta för testning.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="1ff8d-131">Till exempel felkonfigurerad intern brandvägg ACL: er är inte ovanliga, om möjligt har all trafik från en koppling tillåts rakt igenom toohello domänkontrollanter och backend-programmet.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="1ff8d-132">Hello absolut bästa plats tooposition kopplingar är faktiskt så nära tootheir mål kan vara.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="1ff8d-133">Med en brandvägg lö infogad medan testning bara lägger till onödiga komplexitet och kan bara förlänga din undersökningar.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="1ff8d-134">Så, vad som utgör en KCD problemet ändå?</span><span class="sxs-lookup"><span data-stu-id="1ff8d-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="1ff8d-135">Det flera klassiska indikationer på KCD SSO misslyckas och hello första tecken på ett problem visar sig i vanligtvis hello webbläsare.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Felaktig KCD-konfigurationsfel](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Auktorisering misslyckades på grund av toomissing behörigheter](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="1ff8d-138">alla som är försedda med hello samma symtom på misslyckas tooperform SSO och därför neka hello användarprogram åtkomst toohello.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="1ff8d-139">Felsökning</span><span class="sxs-lookup"><span data-stu-id="1ff8d-139">Troubleshooting</span></span>

<span data-ttu-id="1ff8d-140">Hur du Felsök sedan beroende hello problemet och observerade symptom.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="1ff8d-141">Innan du går någon skulle ytterligare föreslår vi hello följande länkar, eftersom de innehåller användbar information som du inte får ännu har komma över:</span><span class="sxs-lookup"><span data-stu-id="1ff8d-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="1ff8d-142">Felsökning av problem med Application Proxy och felmeddelanden</span><span class="sxs-lookup"><span data-stu-id="1ff8d-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="1ff8d-143">Kerberos-fel och problem</span><span class="sxs-lookup"><span data-stu-id="1ff8d-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="1ff8d-144">Arbeta med enkel inloggning när lokalt och i molnet identiteter är inte identiska</span><span class="sxs-lookup"><span data-stu-id="1ff8d-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="1ff8d-145">Om du har det hittills är korrekt och sedan hello huvudsakliga definitivt problem.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="1ff8d-146">Du behöver toodig djupare, så starta genom att avgränsa hello flödet i tre olika steg som du kan felsöka.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="1ff8d-147">**Förautentisering av klient** -hello externa användare autentiseras tooAzure via en webbläsare.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="1ff8d-148">Som kan toopre-autentisera tooAzure är absolut nödvändigt för KCD SSO toofunction.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="1ff8d-149">Detta bör testas och åtgärdas först om det uppstår några problem.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="1ff8d-150">Observera att hello förautentisering steget har ingen relation tooKCD eller hello publicerade program.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="1ff8d-151">Det bör vara ganska enkelt toocorrect skillnader med förstånd kontrollerar hello ämne kontot finns i Azure och att det inte är inaktiverad/blockeras.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="1ff8d-152">hello felsvar i hello webbläsare är vanligtvis tillräckligt beskrivande toounderstand hello orsaken.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="1ff8d-153">Du kan också kontrollera våra andra felsöka docs tooverify om du är osäker.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="1ff8d-154">**Delegering service** -hello Azure Proxy connector att få en kerberos-tjänstbiljett från en KDC (Kerberos Distribution Center) åt användare.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="1ff8d-155">hello extern kommunikation mellan hello-klienten och hello Azure klientdelen bör har ingen betydelse KCD över huvud taget, andra än att säkerställa att det fungerar.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="1ff8d-156">Detta är så hello Azure Proxy-tjänsten kan anges med ett giltigt användar-ID som kan använda tooobtain en kerberos-biljett.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="1ff8d-157">Utan den här KCD är inte möjligt och skulle misslyckas.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="1ff8d-158">Som tidigare nämnts innehåller hello webbläsare felmeddelanden normalt vissa tecken på varför saker inte.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="1ff8d-159">Gör att toonote hello aktivitets-ID och tidsstämpel hello svar som detta att du toocorrelate hello beteende tooactual händelser i händelseloggen för hello Azure Proxy.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Felaktig KCD-konfigurationsfel](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="1ff8d-161">Skulle adress hello motsvarande poster visas hello händelselogg som händelser 13019 eller 12027.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="1ff8d-162">Du kan hitta hello connector händelseloggar i **program- och tjänstloggar** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Händelsen 13019 från Application Proxy-händelseloggen](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Händelsen 12027 från Application Proxy-händelseloggen](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="1ff8d-165">Använd en A-post i din interna DNS för adressen hello application och inte en CNAME-post</span><span class="sxs-lookup"><span data-stu-id="1ff8d-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="1ff8d-166">Nytt bekräfta hello connector värden har beviljats hello rättigheter toodelegate toohello utses målkonto SPN, och som **Använd valfritt autentiseringsprotokoll** är markerad.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="1ff8d-167">Detta beskrivs i vår huvudsakliga [SSO configuration artikel](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="1ff8d-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="1ff8d-168">Kontrollera att det finns en instans av hello SPN finns i AD genom att utfärda en **setspn - x** från en kommandotolk på alla värddatorer för medlem av domänen</span><span class="sxs-lookup"><span data-stu-id="1ff8d-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="1ff8d-169">Kontrollera toosee om en domänprincip används tillämpas toolimit hello [max storlek på kerberos-utfärdade token](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), eftersom den här förhindra hello anslutningen från att erhålla en token om hitta toobe överdriven</span><span class="sxs-lookup"><span data-stu-id="1ff8d-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="1ff8d-170">En spårning i nätverket som avbildar hello utbyten mellan hello connector värd och en domän KDC blir hello nästa rekommenderade steg att få mer låg nivå information om hello problem.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="1ff8d-171">Du hittar det i [ingående felsöka papper](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="1ff8d-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="1ff8d-172">Du bör se en händelse i hello loggar som anger att autentiseringen misslyckades på grund av toohello program som returnerar ett 401 om biljetter ser bra ut.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="1ff8d-173">Detta tyder oftast på att hello målprogrammet avvisa din biljett, så gå vidare med hello efter nästa steg.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="1ff8d-174">**Målprogrammet** -hello konsumenter av hello kerberos-biljetten som tillhandahålls av hello-koppling</span><span class="sxs-lookup"><span data-stu-id="1ff8d-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="1ff8d-175">I det här steget hello connector skickas förväntade toohave en kerberos-tjänstbiljett toohello backend som rubrik i hello första programbegäran.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="1ff8d-176">Med hello program Intern URL som definierats i hello portal, verifiera att programmet hello är tillgänglig direkt från hello webbläsare på hello connector värden.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="1ff8d-177">Sedan du logga in utan problem.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-177">Then you can login successfully.</span></span> <span data-ttu-id="1ff8d-178">Information om hur du gör detta finns på hello connector felsöka sidan.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="1ff8d-179">Bekräfta att hello-autentisering mellan hello webbläsaren fortfarande på hello connector-värden och hello program använder kerberos, genom att göra något av följande hello:</span><span class="sxs-lookup"><span data-stu-id="1ff8d-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="1ff8d-180">Köra verktyg för utveckling (**F12**) i Internet Explorer eller Använd [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) från hello connector värden.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="1ff8d-181">Gå toohello program med hjälp av hello Intern URL, och inspektera hello erbjuds WWW auktorisering rubriker som returneras i hello-svar från hello program, tooensure antingen förhandla eller kerberos finns.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="1ff8d-182">En efterföljande kerberos-blob returnerade hello svar från hello webbläsare toohello programmet normalt börjar med **YII**, så det här är en bra indikation på kerberos som i play.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="1ff8d-183">NTLM hello andra sidan alltid starta med **TlRMTVNTUAAB**, som läser NTLMSSP när avkoda från Base64.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="1ff8d-184">Om du ser **TlRMTVNTUAAB** hello början av hello blob, det innebär att Kerberos **inte** tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="1ff8d-185">Om du inte ser detta Kerberos sannolikt tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="1ff8d-186">Observera att om du använder Fiddler, den här metoden kräver tillfälligt inaktivera utökat skydd på hello programmets konfiguration i IIS.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Webbläsarfönster Nätverkskontroll](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="1ff8d-188">*Bild:* eftersom det inte börjar med TIRMTVNTUAAB, detta är ett exempel som att Kerberos är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="1ff8d-189">Detta är ett exempel på en Kerberos-Blob som inte börjar med YII.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="1ff8d-190">Ta bort NTLM tillfälligt från listan med providers hello på IIS webbplats och åtkomst appen direkt från Internet Explorer på värden för anslutningen.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="1ff8d-191">Med NTLM inte längre i listan med providers hello bör du kunna tooaccess hello program med hjälp av Kerberos endast.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="1ff8d-192">Om detta misslyckas sedan som tyder på att det finns ett problem med hello programmets konfiguration och Kerberos-autentisering fungerar inte.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="1ff8d-193">Om Kerberos inte finns, är Kontrollera hello programmet autentisering inställningar i IIS toomake att förhandla listas översta med NTLM under den.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="1ff8d-194">(Inte förhandla: kerberos eller Negotiate: PKU2U).</span><span class="sxs-lookup"><span data-stu-id="1ff8d-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="1ff8d-195">Fortsätt bara om Kerberos fungerar.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-195">Only continue if Kerberos is functional.</span></span>

   ![Windows autentiseringsproviders](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="1ff8d-197">Med Kerberos- och NTLM på plats kan du tillfälligt inaktivera nu förautentisering för hello programmet hello-portalen.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="1ff8d-198">Se om du kan komma åt den från hello internet med hello externa URL: en.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="1ff8d-199">Du ska ange tooauthenticate och bör vara kan toodo så med hello samma konto används i hello föregående steg.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="1ff8d-200">Om inte det här tyder på problem med hello backend-programmet och inte KCD alls.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="1ff8d-201">Nu återaktivera förautentisering i hello portal och autentisering via Azure genom att försöka tooconnect toohello program via extern URL.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="1ff8d-202">Om enkel inloggning har misslyckats bör du se felmeddelandet otillåtna i hello webbläsare plus händelse 13022 i hello-loggen:</span><span class="sxs-lookup"><span data-stu-id="1ff8d-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="1ff8d-203">*Microsoft AAD Application Proxy Connector autentisera inte hello användaren eftersom hello backend-servern svarar tooKerberos autentiseringsförsök med ett HTTP 401-fel.*</span><span class="sxs-lookup"><span data-stu-id="1ff8d-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![HTTTP 401 förbjudet fel](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="1ff8d-205">Kontrollera hello IIS programmet tooensure hello konfigurerats programpoolen är konfigurerad toouse hello samma konto som hello SPN har konfigurerats mot i AD, genom att navigera i IIS som på bilden nedan</span><span class="sxs-lookup"><span data-stu-id="1ff8d-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![IIS-konfigurationsfönstret](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="1ff8d-207">När du vet hello identitet kan utfärda hello följande från en cmd-prompt toomake att det här kontot definitivt har konfigurerats med hello SPN i fråga.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="1ff8d-208">Till exempel **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="1ff8d-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![SetSPN-kommandofönster](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="1ff8d-210">Kontrollera att hello SPN definieras hello programmets inställningar i hello-portalen är hello samma SPN som är konfigurerad mot hello mål AD-konto används av programpoolen hello program</span><span class="sxs-lookup"><span data-stu-id="1ff8d-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![SPN-konfigurationen i Azure Portal](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="1ff8d-212">Gå till IIS och välj hello **Konfigurationsredigeraren** för programmet hello och navigera för**system.webServer/security/authentication/windowsAuthentication** toomake till att **UseAppPoolCredentials** anges tootrue</span><span class="sxs-lookup"><span data-stu-id="1ff8d-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![IIS-konfiguration app pooler autentiseringsuppgifter alternativet](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="1ff8d-214">Samtidigt som det är användbart i förbättra hello prestanda av Kerberos-åtgärder, även lämnar Kernel-läge har aktiverats gör hello biljett för hello begärda tjänsten toobe dekrypteras med hjälp av datorkontot.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="1ff8d-215">Detta kallas också hello lokalt system, så att den här uppsättningen tootrue break KCD när programmet hello finns över flera servrar i en grupp.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="1ff8d-216">Som ytterligare en kontroll, du kan också toodisable hello **utökad** skydd för.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="1ff8d-217">Det har förekommit påträffade scenarier där detta har visat toobreak KCD när aktiverat i mycket specifika konfigurationer där ett program publiceras som en undermapp hello standardwebbplatsen.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="1ff8d-218">Den här själva har konfigurerats för anonym autentisering, lämnar hello hela dialogrutor nedtonat tyder på underordnade objekt inte kan ärva active inställningar.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="1ff8d-219">Men om möjligt alltid rekommenderar vi med alternativet är aktiverat, så av alla menat testa, men glöm inte toorestore denna tooenabled.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="1ff8d-220">Dessa ytterligare kontroller bör ha spärra du spåra toostart använder ditt publicerade program.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="1ff8d-221">Du kan gå vidare och rotationsrutan upp ytterligare kopplingar som även är konfigurerat toodelegate, men om saker är ingen ytterligare sedan skulle föreslår vi en läsning av våra mer ingående tekniska genomgången [hello fullständig guide för felsökning av Azure AD-program Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="1ff8d-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="1ff8d-222">Om du fortfarande tooprogress problemet, support skulle vara större än Grattis tooassist och fortsätta härifrån.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="1ff8d-223">Skapa ett supportärende direkt i hello portal och våra tekniker ska nå ut tooyou.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="1ff8d-224">Andra scenarier</span><span class="sxs-lookup"><span data-stu-id="1ff8d-224">Other scenarios</span></span>

-   <span data-ttu-id="1ff8d-225">Azure Application Proxy begär en Kerberos-biljett innan du skickar dess begäran tooan program.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="1ff8d-226">Vissa 3 partsprogram, till exempel Tableau Server inte som den här metoden för att autentisera och snarare förväntar hello mer konventionella förhandlingar tootake plats.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="1ff8d-227">hello första begäran är anonyma, så att hello programmet toorespond med hello autentiseringstyper som stöds via ett 401.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="1ff8d-228">Dubbla hopp autentisering - ofta används i scenarier där ett program nivåer, med en serverdelen och front end båda kräver autentisering, till exempel SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="1ff8d-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1ff8d-229">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="1ff8d-229">Next steps</span></span>
[<span data-ttu-id="1ff8d-230">Konfigurera kerberos-begränsad delegering (KCD) på en hanterad domän</span><span class="sxs-lookup"><span data-stu-id="1ff8d-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
