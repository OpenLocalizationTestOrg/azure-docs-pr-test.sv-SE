---
title: "aaaDeveloper vägledning för Azure Active Directory villkorlig åtkomst | Microsoft Docs"
description: "Guide för utvecklare och scenarier för villkorlig åtkomst i Azure AD"
services: active-directory
keywords: 
author: danieldobalian
manager: mbaldwin
editor: PatAltimore
ms.author: dadobali
ms.date: 07/19/2017
ms.assetid: 115bdab2-e1fd-4403-ac15-d4195e24ac95
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.openlocfilehash: 589393f5d084d64872b372d895dc889f300592bf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="developer-guidance-for-azure-active-directory-conditional-access"></a><span data-ttu-id="aa9bc-103">Guide för utvecklare för villkorlig åtkomst i Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="aa9bc-103">Developer Guidance for Azure Active Directory Conditional Access</span></span>

<span data-ttu-id="aa9bc-104">Azure Active Directory (AD) och erbjuder flera sätt toosecure din app och skydda en tjänst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-104">Azure Active Directory (AD) offers several ways toosecure your app and protect a service.</span></span>  <span data-ttu-id="aa9bc-105">En av dessa unika funktioner är villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-105">One of these unique features is conditional access.</span></span>  <span data-ttu-id="aa9bc-106">Villkorlig åtkomst kan utvecklare och enterprise-kunder tooprotect tjänster i en mängd olika sätt, inklusive:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-106">Conditional access enables developers and enterprise customers tooprotect services in a multitude of ways including:</span></span>

* <span data-ttu-id="aa9bc-107">Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="aa9bc-107">Multi-factor authentication</span></span>
* <span data-ttu-id="aa9bc-108">Att tillåta att Intune endast registrerade enheter tooaccess specifika tjänster</span><span class="sxs-lookup"><span data-stu-id="aa9bc-108">Allowing only Intune enrolled devices tooaccess specific services</span></span>
* <span data-ttu-id="aa9bc-109">Begränsa användarplatser och IP-adressintervall</span><span class="sxs-lookup"><span data-stu-id="aa9bc-109">Restricting user locations and IP ranges</span></span>

<span data-ttu-id="aa9bc-110">Mer information om hello alla funktioner för villkorlig åtkomst finns [villkorlig åtkomst i hello klassiska Azure-portalen](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-110">For more information on hello full capabilities of conditional access, see [Conditional access in hello Azure classic portal](../active-directory-conditional-access.md).</span></span> 

<span data-ttu-id="aa9bc-111">I den här artikeln fokuserar vi på vilka villkorlig åtkomst: toodevelopers bygga appar för Azure AD.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-111">In this article, we focus on what conditional access means toodevelopers building apps for Azure AD.</span></span>  <span data-ttu-id="aa9bc-112">Den förutsätter kunskaper om [enda](active-directory-integrating-applications.md) och [flera innehavare](active-directory-devhowto-multi-tenant-overview.md) appar och [vanliga autentisering mönster](active-directory-authentication-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-112">It assumes knowledge of [single](active-directory-integrating-applications.md) and [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) apps and [common authentication patterns](active-directory-authentication-scenarios.md).</span></span>

<span data-ttu-id="aa9bc-113">Vi kommer fördjupa dig i hello effekten av att komma åt resurser som du inte har kontroll över och som kan ha principer för villkorlig åtkomst tillämpas.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-113">We'll dive into hello impact of accessing resources you don't have control over that may have conditional access policies applied.</span></span>  <span data-ttu-id="aa9bc-114">Dessutom undersöka vi hello villkorlig åtkomst i hello på-flöde, webbappar, komma åt hello Microsoft Graph och anropar API: er.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-114">Moreover, we explore hello implications of conditional access in hello on-behalf-of flow, web apps, accessing hello Microsoft Graph, and calling APIs.</span></span>

## <a name="how-does-conditional-access-impact-an-app"></a><span data-ttu-id="aa9bc-115">Hur påverkar en app av villkorlig åtkomst?</span><span class="sxs-lookup"><span data-stu-id="aa9bc-115">How does conditional access impact an app?</span></span>

### <a name="app-topologies-impacted"></a><span data-ttu-id="aa9bc-116">App-topologier som påverkas</span><span class="sxs-lookup"><span data-stu-id="aa9bc-116">App topologies impacted</span></span>

<span data-ttu-id="aa9bc-117">I de flesta vanliga fall villkorlig åtkomst ändra inte appens beteende, eller kräver ändringar från hello-utvecklare.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-117">In most common cases, conditional access does not change an app's behavior or requires any changes from hello developer.</span></span>  <span data-ttu-id="aa9bc-118">Endast i vissa fall när en app, indirekt eller obevakat begär en token för en tjänst, kräver en app kod ändrar toohandle villkorlig åtkomst ”utmaningar”.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-118">Only in certain cases when an app indirectly or silently requests a token for a service, an app requires code changes toohandle conditional access "challenges".</span></span>  <span data-ttu-id="aa9bc-119">Det kan vara så enkelt som att utföra en begäran för interaktiv inloggning.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-119">It may be as simple as performing an interactive sign-in request.</span></span> 

<span data-ttu-id="aa9bc-120">Mer specifikt hello följande scenarier kräver kod toohandle villkorlig åtkomst ”utmaningar”:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-120">Specifically, hello following scenarios require code toohandle conditional access "challenges":</span></span> 

* <span data-ttu-id="aa9bc-121">Appar som har åtkomst till hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="aa9bc-121">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="aa9bc-122">Appar som utför hello på-flöde</span><span class="sxs-lookup"><span data-stu-id="aa9bc-122">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="aa9bc-123">Appar som har åtkomst till flera services-resurser</span><span class="sxs-lookup"><span data-stu-id="aa9bc-123">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="aa9bc-124">Ensidesappar med ADAL.js</span><span class="sxs-lookup"><span data-stu-id="aa9bc-124">Single page apps using ADAL.js</span></span>

<span data-ttu-id="aa9bc-125">Principer för villkorlig åtkomst kan vara tillämpade toohello app, men kan även vara tillämpade tooa web API appen har åtkomst till.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-125">Conditional access policies can be applied toohello app, but also can be applied tooa web API your app accesses.</span></span> <span data-ttu-id="aa9bc-126">toolearn mer om hur tooconfigure en villkorlig åtkomstprincip finns [komma igång med Azure Active Directory villkorlig åtkomst](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-126">toolearn more about how tooconfigure a conditional access policy, please see [Getting started with Azure Active Directory Conditional Access](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span></span>

<span data-ttu-id="aa9bc-127">Beroende på scenario hello en enterprise-kund tillämpa och ta bort principer för villkorlig åtkomst när som helst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-127">Depending on hello scenario, an enterprise customer can apply and remove conditional access policies at any time.</span></span>  <span data-ttu-id="aa9bc-128">För att din app toocontinue fungerar när en ny princip används måste tooimplement hello ”challenge” hantering.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-128">In order for your app toocontinue functioning when a new policy is applied, you need tooimplement hello "challenge" handling.</span></span> <span data-ttu-id="aa9bc-129">hello följande exempel illustrerar challenge hantering.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-129">hello following examples illustrate challenge handling.</span></span> 

### <a name="conditional-access-examples"></a><span data-ttu-id="aa9bc-130">Exempel på villkorlig åtkomst</span><span class="sxs-lookup"><span data-stu-id="aa9bc-130">Conditional access examples</span></span>

<span data-ttu-id="aa9bc-131">Vissa scenarier kräver kod ändringar toohandle villkorlig åtkomst medan andra fungerar som är.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-131">Some scenarios require code changes toohandle conditional access whereas others work as is.</span></span>  <span data-ttu-id="aa9bc-132">Här följer några scenarier med hjälp av villkorlig åtkomst toodo multifaktorautentisering som ger viss insikt om hello skillnaden.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-132">Here are a few scenarios using conditional access toodo multi-factor authentication that gives some insight into hello difference.</span></span>

* <span data-ttu-id="aa9bc-133">Du skapar en enskild klient iOS-app och tillämpa en princip för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-133">You are building a single-tenant iOS app and apply a conditional access policy.</span></span>  <span data-ttu-id="aa9bc-134">hello appen loggar in en användare och begära inte åtkomst tooan API.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-134">hello app signs in a user and doesn't request access tooan API.</span></span>  <span data-ttu-id="aa9bc-135">När hello användaren loggar in, hello principen aktiveras automatiskt och hello användare behöver tooperform multifaktorautentisering (MFA).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-135">When hello user signs in, hello policy is automatically invoked and hello user needs tooperform multi-factor authentication (MFA).</span></span> 
* <span data-ttu-id="aa9bc-136">Du skapar ett webbprogram med flera innehavare som använder hello Microsoft Graph tooaccess Exchange, bland annat.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-136">You are building a multi-tenant web app that uses hello Microsoft Graph tooaccess Exchange, among other services.</span></span>  <span data-ttu-id="aa9bc-137">En enterprise-kunder som antar den här appen anger en princip för SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-137">An enterprise customer who adopts this app sets a policy on SharePoint Online.</span></span>  <span data-ttu-id="aa9bc-138">När hello webbprogrammet begär en token för MS Graph, används en princip på alla Microsoft Service (särskilt tjänster som kan nås via diagram).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-138">When hello web app requests a token for MS Graph, a policy on any Microsoft Service is applied (specifically services that can be accessed through graph).</span></span>  <span data-ttu-id="aa9bc-139">Slutanvändaren uppmanas att ange MFA.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-139">This end-user is prompted for MFA.</span></span> <span data-ttu-id="aa9bc-140">I fallet hello hello slutanvändaren har loggat in med ogiltig token, anspråk ”svårt” returneras toohello webbprogram.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-140">In hello case, hello end-user is signed in with valid tokens, a claims "challenge" is returned toohello web app.</span></span>  
* <span data-ttu-id="aa9bc-141">Du skapar en intern app som använder en mellannivå service tooaccess hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-141">You are building a native app that uses a middle tier service tooaccess hello Microsoft Graph.</span></span>  <span data-ttu-id="aa9bc-142">En enterprise-kund på hello företag som använder den här appen gäller en princip tooExchange Online.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-142">An enterprise customer at hello company using this app applies a policy tooExchange Online.</span></span>  <span data-ttu-id="aa9bc-143">När en slutanvändare loggar in visar hello inbyggda appen begär åtkomst toohello mellannivå och skickar hello-token.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-143">When an end-user signs in, hello native app requests access toohello middle tier and sends hello token.</span></span>  <span data-ttu-id="aa9bc-144">hello mellannivå utför på-flöde toorequest åtkomst toohello MS Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-144">hello middle tier performs on-behalf-of flow toorequest access toohello MS Graph.</span></span>  <span data-ttu-id="aa9bc-145">Nu visas en anspråk ”utmaning” toohello mellannivå.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-145">At this point, a claims "challenge" is presented toohello middle tier.</span></span> <span data-ttu-id="aa9bc-146">hello mellannivå skickar hello challenge tillbaka toohello inbyggda appen, som måste toocomply med hello principen för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-146">hello middle tier sends hello challenge back toohello native app, which needs toocomply with hello conditional access policy.</span></span>

### <a name="complying-with-a-conditional-access-policy"></a><span data-ttu-id="aa9bc-147">Uppfyller en princip för villkorlig åtkomst</span><span class="sxs-lookup"><span data-stu-id="aa9bc-147">Complying with a conditional access policy</span></span>

<span data-ttu-id="aa9bc-148">En princip för villkorlig åtkomst utvärderas för flera olika app topologier när hello-sessionen har upprättats.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-148">For several different app topologies, a conditional access policy is evaluated when hello session is established.</span></span>  <span data-ttu-id="aa9bc-149">Som en princip för villkorlig åtkomst fungerar på hello Granulariteten för appar och tjänster, hello punkt då den anropas kraftigt beror på hello scenario du försöker tooaccomplish.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-149">As a conditional access policy operates on hello granularity of apps and services, hello point at which it is invoked depends heavily on hello scenario you're trying tooaccomplish.</span></span>

<span data-ttu-id="aa9bc-150">Din app försöker tooaccess en tjänst med en princip för villkorlig åtkomst, kan det uppstå en utmaning för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-150">When your app attempts tooaccess a service with a conditional access policy, it may encounter a conditional access challenge.</span></span>  <span data-ttu-id="aa9bc-151">Denna utmaning har kodats i hello `claims` parameter som ingår i ett svar från Azure AD eller hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-151">This challenge is encoded in hello `claims` parameter that comes in a response from Azure AD or hello Microsoft Graph.</span></span>  <span data-ttu-id="aa9bc-152">Här är ett exempel på den här challenge-parametern:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-152">Here's an example of this challenge parameter:</span></span> 

```
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="aa9bc-153">Utvecklare kan ta denna utmaning och lägga till en ny begäran tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-153">Developers can take this challenge and append it onto a new request tooAzure AD.</span></span>  <span data-ttu-id="aa9bc-154">Skicka det här tillståndet uppmanar hello slutanvändarens tooperform någon åtgärd krävs toocomply med hello principen för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-154">Passing this state prompts hello end-user tooperform any action necessary toocomply with hello conditional access policy.</span></span> <span data-ttu-id="aa9bc-155">I följande scenarier hello, beskrivs specifika hello fel och hur tooextract hello parametern.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-155">In hello following scenarios, specifics of hello error and how tooextract hello parameter are explained.</span></span> 

## <a name="scenarios"></a><span data-ttu-id="aa9bc-156">Scenarier</span><span class="sxs-lookup"><span data-stu-id="aa9bc-156">Scenarios</span></span>

### <a name="prerequisites"></a><span data-ttu-id="aa9bc-157">Krav</span><span class="sxs-lookup"><span data-stu-id="aa9bc-157">Prerequisites</span></span>

<span data-ttu-id="aa9bc-158">Azure AD villkorlig åtkomst är en funktion som ingår i [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-158">Azure AD conditional access is a feature included in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span></span>  <span data-ttu-id="aa9bc-159">Du kan lära dig mer om licensiering krav i hello [olicensierad användningsrapporten](../active-directory-conditional-access-unlicensed-usage-report.md).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-159">You can learn more about licensing requirements in hello [unlicensed usage report](../active-directory-conditional-access-unlicensed-usage-report.md).</span></span>  <span data-ttu-id="aa9bc-160">Utvecklare kan ansluta till hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), som innehåller en kostnadsfri prenumeration toohello Enterprise Mobility Suite som innehåller Azure AD Premium.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-160">Developers can join hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), which includes a free subscription toohello Enterprise Mobility Suite which includes Azure AD Premium.</span></span>

### <a name="considerations-for-specific-scenarios"></a><span data-ttu-id="aa9bc-161">Överväganden för specifika scenarier</span><span class="sxs-lookup"><span data-stu-id="aa9bc-161">Considerations for specific scenarios</span></span>

<span data-ttu-id="aa9bc-162">hello efter endast gäller i dessa scenarier för villkorlig åtkomst:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-162">hello following information only applies in these conditional access scenarios:</span></span>

* <span data-ttu-id="aa9bc-163">Appar som har åtkomst till hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="aa9bc-163">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="aa9bc-164">Appar som utför hello på-flöde</span><span class="sxs-lookup"><span data-stu-id="aa9bc-164">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="aa9bc-165">Appar som har åtkomst till flera services-resurser</span><span class="sxs-lookup"><span data-stu-id="aa9bc-165">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="aa9bc-166">Ensidesappar med ADAL.js</span><span class="sxs-lookup"><span data-stu-id="aa9bc-166">Single page apps using ADAL.js</span></span>

<span data-ttu-id="aa9bc-167">I följande avsnitt hello, ska vi gå in vanliga scenarier som är mer komplexa.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-167">In hello following sections, we'll get into common scenarios in which are more complex.</span></span>  <span data-ttu-id="aa9bc-168">hello core fungerar principen är villkorlig åtkomst utvärderas principer för närvarande hello hello token har begärts för hello-tjänst som har en villkorlig åtkomstprincip som tillämpas om den som kan nås via hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-168">hello core operating principle is conditional access policies are evaluated at hello time hello token is requested for hello service that has a conditional access policy applied unless it's being accessed through hello Microsoft Graph.</span></span>

### <a name="scenario-app-accessing-hello-microsoft-graph"></a><span data-ttu-id="aa9bc-169">Scenario: App åtkomst till hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="aa9bc-169">Scenario: App accessing hello Microsoft Graph</span></span>

<span data-ttu-id="aa9bc-170">I det här scenariot går vi igenom hello fallet när ett webbprogram begär åtkomst toohello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-170">In this scenario, we walk through hello case when a web app requests access toohello Microsoft Graph.</span></span> <span data-ttu-id="aa9bc-171">hello principen för villkorlig åtkomst kunde i det här fallet tilldelas tooSharePoint, Exchange och andra tjänster som används som en arbetsbelastning via hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-171">hello conditional access policy in this case could be assigned tooSharePoint, Exchange, or some other service that is accessed as a workload through hello Microsoft Graph.</span></span>  <span data-ttu-id="aa9bc-172">I vårt exempel antar vi att det finns en princip för villkorlig åtkomst på Sharepoint Online.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-172">In this example, let's assume there's a conditional access policy on Sharepoint Online.</span></span>

![Appen åtkomst till hello Flödesdiagram för Microsoft Graph](media/active-directory-conditional-access-developer/app-accessing-microsoft-graph-scenario.png)

<span data-ttu-id="aa9bc-174">hello app först begär tillstånd toohello Microsoft Graph som kräver åtkomst till en underordnad arbetsbelastning utan villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-174">hello app first requests authorization toohello Microsoft Graph which requires accessing a downstream workload without conditional access.</span></span>  <span data-ttu-id="aa9bc-175">hello begäran lyckas utan att anropa princip och hello appen tar emot token för Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-175">hello request succeeds without invoking any policy and hello app receives tokens for Microsoft Graph.</span></span>  <span data-ttu-id="aa9bc-176">Hello appen kan nu använda hello åtkomst-token i en ägar-begäran för hello-slutpunkt som begärdes.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-176">At this point, hello app may use hello access token in a bearer request for hello endpoint requested.</span></span> <span data-ttu-id="aa9bc-177">Nu måste hello appen tooaccess en Sharepoint Online-slutpunkt för Microsoft Graph, till exempel:`https://graph.microsoft.com/v1.0/me/mySite`</span><span class="sxs-lookup"><span data-stu-id="aa9bc-177">Now, hello app needs tooaccess a Sharepoint Online endpoint of Microsoft Graph, for example: `https://graph.microsoft.com/v1.0/me/mySite`</span></span>

<span data-ttu-id="aa9bc-178">hello app har redan en giltig token för hello Microsoft Graph, så att den kan utföra hello ny begäran utan att utfärda en ny token.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-178">hello app already has a valid token for hello Microsoft Graph, so it can perform hello new request without being issued a new token.</span></span> <span data-ttu-id="aa9bc-179">Denna begäran misslyckas och en utmaning anspråk utfärdas från Microsoft Graph i hello form av en HTTP 403 Åtkomst nekas med en ```WWW-Authenticate``` utmaning.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-179">This request fails and a claims challenge is issued from Microsoft Graph in hello form of an HTTP 403 Forbidden with a ```WWW-Authenticate``` challenge.</span></span>
<span data-ttu-id="aa9bc-180">Här är ett exempel på hello svar:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-180">Here's an example of hello response:</span></span> 

```
HTTP 403; Forbidden 
error=insufficient_claims
www-authenticate="Bearer realm="", authorization_uri="https://login.windows.net/common/oauth2/authorize", client_id="<GUID>", error=insufficient_claims, claims={"access_token":{"polids":{"essential":true,"values":["<GUID>"]}}}"
```

<span data-ttu-id="aa9bc-181">hello anspråk utmaning är inuti hello ```WWW-Authenticate``` rubriken, som kan vara parsade tooextract hello anspråk parametern för hello nästa begäran.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-181">hello claims challenge is inside hello ```WWW-Authenticate``` header, which can be parsed tooextract hello claims parameter for hello next request.</span></span>  <span data-ttu-id="aa9bc-182">När det har lagts till toohello ny begäran vet tooevaluate hello principen för villkorlig åtkomst i Azure AD när du loggar in hello användar- och hello appen är nu efterlever hello principen för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-182">Once it's appended toohello new request, Azure AD knows tooevaluate hello conditional access policy when signing in hello user and hello app is now in compliance with hello conditional access policy.</span></span>  <span data-ttu-id="aa9bc-183">Upprepa hello begäran toohello Sharepoint Online lyckas endpoint.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-183">Repeating hello request toohello Sharepoint Online endpoint succeeds.</span></span>

<span data-ttu-id="aa9bc-184">Kodexempel som visar hur toohandle hello anspråk challenge finns toohello [.NET Desktop kodexemplet](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) för ADAL .NET eller hello [On-behalf-of kodexemplet](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) för ADAL .NET.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-184">For code samples that demonstrate how toohandle hello claims challenge, refer toohello [.NET Desktop code sample](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) for ADAL .NET or hello [On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) for ADAL .NET.</span></span>

### <a name="scenario-app-performing-hello-on-behalf-of-flow"></a><span data-ttu-id="aa9bc-185">Scenario: App utför hello på-flöde</span><span class="sxs-lookup"><span data-stu-id="aa9bc-185">Scenario: App performing hello on-behalf-of flow</span></span>

<span data-ttu-id="aa9bc-186">I det här scenariot går vi igenom hello fall där en intern app anropar en webbtjänstens/API.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-186">In this scenario, we walk through hello case in which a native app calls a web service/API.</span></span>  <span data-ttu-id="aa9bc-187">I sin tur den här tjänsten har [hello ”på-” flöde](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall en underordnad tjänst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-187">In turn, this service does [hello "on-behalf-of" flow](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall a downstream service.</span></span>  <span data-ttu-id="aa9bc-188">I vårt fall vi har använt våra villkorlig åtkomst princip toohello underordnade-tjänsten (Web API 2) och använder en intern app i stället för en server-daemon-app.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-188">In our case, we've applied our conditional access policy toohello downstream service (Web API 2) and are using a native app rather than a server/daemon app.</span></span> 

![Appen utför hello on-behalf-of flödesdiagram](media/active-directory-conditional-access-developer/app-performing-on-behalf-of-scenario.png)

<span data-ttu-id="aa9bc-190">hello inledande Tokenbegäran för Web API 1 frågar inte hello slutanvändarens för multifaktorautentisering som Web API 1 inte kanske alltid träffar hello underordnade API.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-190">hello initial token request for Web API 1 does not prompt hello end-user for multi-factor authentication as Web API 1 may not always hit hello downstream API.</span></span>  <span data-ttu-id="aa9bc-191">När Web API 1 försöker toorequest en token on-behalf-of-hello-användare för Web API 2, misslyckas hello begäran eftersom hello användaren inte har loggat in med multifaktorautentisering.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-191">Once Web API 1 tries toorequest a token on-behalf-of hello user for Web API 2, hello request fails since hello user has not signed in with multi-factor authentication.</span></span>

<span data-ttu-id="aa9bc-192">Azure AD returnerar ett HTTP-svar med vissa intressanta data:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-192">Azure AD returns an HTTP response with some interesting data:</span></span> 

> [!NOTE]
> <span data-ttu-id="aa9bc-193">I den här instansen är det en beskrivning för multifaktorautentisering fel, men det finns en mängd olika `interaction_required` möjliga tillhörande tooconditional åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-193">In this instance it's a multi-factor authentication error description, but there's a wide range of `interaction_required` possible pertaining tooconditional access.</span></span>  

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API 2 App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="aa9bc-194">I vår Web API-1 vi fånga hello fel `error=interaction_required`, och skickar tillbaka hello `claims` challenge toohello skrivbordsapp.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-194">In our Web API 1, we catch hello error `error=interaction_required`, and send back hello `claims` challenge toohello desktop app.</span></span>  <span data-ttu-id="aa9bc-195">Vid den punkten hello desktop-appen kan göra en ny `acquireToken()` anropa och Lägg till hello `claims`utmaning som en extra frågesträngparametern.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-195">At that point, hello desktop app can make a new `acquireToken()` call and append hello `claims`challenge as an extra query string parameter.</span></span>  <span data-ttu-id="aa9bc-196">Den här nya begäran kräver hello användaren toodo multifaktorautentisering och skicka den här nya token tillbaka tooWeb API-1 och fullständig hello på-flöde.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-196">This new request requires hello user toodo multi-factor authentication and then send this new token back tooWeb API 1 and complete hello on-behalf-of flow.</span></span>

<span data-ttu-id="aa9bc-197">tootry i det här scenariot finns våra [.NET kodexemplet](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-197">tootry out this scenario, see our [.NET code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="aa9bc-198">Den visar hur toopass hello anspråk challenge tillbaka från Web API 1 toohello inbyggda appen och skapa en ny begäran i hello-klientappen.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-198">It demonstrates how toopass hello claims challenge back from Web API 1 toohello native app and construct a new request inside hello client app.</span></span> 

### <a name="scenario-app-accessing-multiple-services"></a><span data-ttu-id="aa9bc-199">Scenario: App åtkomst till flera tjänster</span><span class="sxs-lookup"><span data-stu-id="aa9bc-199">Scenario: App accessing multiple services</span></span>

<span data-ttu-id="aa9bc-200">I det här scenariot går vi igenom hello fall där ett webbprogram har åtkomst till två tjänster som har en princip för villkorlig åtkomst som tilldelats.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-200">In this scenario, we walk through hello case in which a web app accesses two services one of which has a conditional access policy assigned.</span></span>  <span data-ttu-id="aa9bc-201">Beroende på din app-logik kan det finnas en sökväg som din app inte kräver åtkomst tooboth webbtjänster.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-201">Depending on your app logic, there may exist a path in which your app does not require access tooboth web services.</span></span>  <span data-ttu-id="aa9bc-202">I det här scenariot spelar hello ordning i vilken du begära en token en viktig roll i hello slutanvändarens upplevelse.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-202">In this scenario, hello order in which you request a token plays an important role in hello end-user experience.</span></span>

<span data-ttu-id="aa9bc-203">Antar vi att vi har webbtjänsten A och B och webbtjänsten B har vår principen för villkorlig åtkomst tillämpas.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-203">Let's assume we have web service A and B and web service B has our conditional access policy applied.</span></span>  <span data-ttu-id="aa9bc-204">Medan hello inledande interaktiva auth begäran kräver godkännande för båda tjänsterna, krävs inte hello principen för villkorlig åtkomst i samtliga fall.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-204">While hello initial interactive auth request requires consent for both services, hello conditional access policy is not required in all cases.</span></span>  <span data-ttu-id="aa9bc-205">Om hello app begär en token för webbtjänsten B, hello princip anropas och efterföljande förfrågningar för webbtjänsten A också lyckas på följande sätt.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-205">If hello app requests a token for web service B, then hello policy is invoked and subsequent requests for web service A also succeeds as follows.</span></span>

![Appen åtkomst till Flödesdiagram för flera tjänster](media/active-directory-conditional-access-developer/app-accessing-multiple-services-scenario.png)

<span data-ttu-id="aa9bc-207">Du kan också om hello app först begär en token för web service A, anropar hello slutanvändarens inte hello principen för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-207">Alternatively, if hello app initially requests a token for web service A, hello end-user does not invoke hello conditional access policy.</span></span>  <span data-ttu-id="aa9bc-208">Detta gör hello apputvecklaren toocontrol hello slutanvändarens upplevelse och tvinga inte hello villkorlig åtkomst princip toobe anropas i samtliga fall.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-208">This allows hello app developer toocontrol hello end-user experience and not force hello conditional access policy toobe invoked in all cases.</span></span> <span data-ttu-id="aa9bc-209">hello komplicerade fallet är om hello app därefter begär en token för webbtjänsten B. Nu måste slutanvändaren hello toocomply med hello principen för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-209">hello tricky case is if hello app subsequently requests a token for web service B. At this point, hello end-user needs toocomply with hello conditional access policy.</span></span>  <span data-ttu-id="aa9bc-210">När hello app försöker för`acquireToken`, det kan generera hello följande fel (illustreras i följande diagram hello):</span><span class="sxs-lookup"><span data-stu-id="aa9bc-210">When hello app tries too`acquireToken`, it may generate hello following error (illustrated in hello following diagram):</span></span> 

```
HTTP 400; Bad Request
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
``` 

![Appen åtkomst till flera tjänster som begär en ny token](media/active-directory-conditional-access-developer/app-accessing-multiple-services-new-token.png)

<span data-ttu-id="aa9bc-212">Om hello app använder ADAL hello-biblioteket, försöks alltid en token med fel tooacquire hello interaktivt.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-212">If hello app is using hello ADAL library, a failure tooacquire hello token is always retried interactively.</span></span>  <span data-ttu-id="aa9bc-213">När denna interaktiva begäran inträffar måste hello slutanvändaren hello möjlighet toocomply med hello villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-213">When this interactive request occurs, hello end-user has hello opportunity toocomply with hello conditional access.</span></span>  <span data-ttu-id="aa9bc-214">Är SANT om inte hello-begäran är en `AcquireTokenSilentAsync` eller `PromptBehavior.Never` då hello appen måste en interaktiv tooperform ```AcquireToken``` toogive hello slutanvändning hello möjlighet toocomply med hello princip för begäran.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-214">This is true unless hello request is a `AcquireTokenSilentAsync` or `PromptBehavior.Never` in which case hello app needs tooperform an interactive ```AcquireToken``` request toogive hello end use hello opportunity toocomply with hello policy.</span></span> 

### <a name="scenario-single-page-app-spa-using-adaljs"></a><span data-ttu-id="aa9bc-215">Scenario: Enkel sida App (SPA) med hjälp av ADAL.js</span><span class="sxs-lookup"><span data-stu-id="aa9bc-215">Scenario: Single Page App (SPA) using ADAL.js</span></span>

<span data-ttu-id="aa9bc-216">Vi går igenom hello fallet när vi har en enda sida app (SPA) i det här scenariot, villkorlig åtkomst med hjälp av ADAL.js toocall skyddade webb-API.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-216">In this scenario, we walk through hello case when we have a single page app (SPA), using ADAL.js toocall a conditional access protected web API.</span></span>  <span data-ttu-id="aa9bc-217">Detta är en enkel arkitektur men vissa olika delarna som behöver toobe beaktas när du utvecklar runt villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-217">This is a simple architecture but has some nuances that need toobe taken into account when developing around conditional access.</span></span>

<span data-ttu-id="aa9bc-218">ADAL.js, finns det några funktioner som hämta token: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, och `acquireTokenRedirect(…)`.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-218">In ADAL.js, there are a few functions that obtain tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, and `acquireTokenRedirect(…)`.</span></span> 

* <span data-ttu-id="aa9bc-219">`login()`hämtar en token ID via en interaktiv inloggning begäran men erhålla inte åtkomsttoken för alla tjänster (inklusive en villkorlig åtkomst i skyddade webb-API).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-219">`login()` obtains an ID token through an interactive sign-in request but does not obtain access tokens for any service (including a conditional access protected web API).</span></span>  
* <span data-ttu-id="aa9bc-220">`acquireToken(…)`använda toosilently att skaffa ett åtkomsttoken, vilket innebär att Användargränssnittet inte visas i några omständigheter.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-220">`acquireToken(…)` can then be used toosilently obtain an access token meaning it does not show UI in any circumstance.</span></span>  
* <span data-ttu-id="aa9bc-221">`acquireTokenPopup(…)`och `acquireTokenRedirect(…)` är båda används toointeractively begära en token för en resurs, vilket innebär att de alltid visar UI-inloggning.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-221">`acquireTokenPopup(…)` and `acquireTokenRedirect(…)` are both used toointeractively request a token for a resource meaning they always show sign-in UI.</span></span>

<span data-ttu-id="aa9bc-222">När en app måste en åtkomst-token toocall webb-API, försöker den en `acquireToken(…)`.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-222">When an app needs an access token toocall a Web API, it attempts an `acquireToken(…)`.</span></span>  <span data-ttu-id="aa9bc-223">Om token hello-sessionen har upphört att gälla eller måste toocomply med en princip för villkorlig åtkomst, sedan hello *acquireToken* fungera misslyckas och hello app använder `acquireTokenPopup()` eller `acquireTokenRedirect()`.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-223">If hello token session is expired or we need toocomply with a conditional access policy, then hello *acquireToken* function fails and hello app uses `acquireTokenPopup()` or `acquireTokenRedirect()`.</span></span>

![En sida-app med Flödesdiagram för ADAL](media/active-directory-conditional-access-developer/spa-using-adal-scenario.png)

<span data-ttu-id="aa9bc-225">Låt oss gå igenom ett exempel med vårt scenario för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-225">Let's walk through an example with our conditional access scenario.</span></span>  <span data-ttu-id="aa9bc-226">hello slutanvändarens bara landat på hello platsen och har inte en session.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-226">hello end-user just landed on hello site and doesn’t have a session.</span></span>  <span data-ttu-id="aa9bc-227">Vi utföra en `login()` anropa, hämta ett ID-token utan multifaktorautentisering.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-227">We perform a `login()` call, get an ID token without multi-factor authentication.</span></span>  <span data-ttu-id="aa9bc-228">Sedan träffar hello användaren en knapp som kräver hello toorequest AppData från ett webb-API.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-228">Then hello user hits a button that requires hello app toorequest data from a web API.</span></span>  <span data-ttu-id="aa9bc-229">hello app försöker toodo en `acquireToken()` anrop men misslyckas eftersom hello användaren inte har utfört multifaktorautentisering ännu och måste toocomply med hello principen för villkorlig åtkomst.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-229">hello app tries toodo an `acquireToken()` call but fails since hello user has not performed multi-factor authentication yet and needs toocomply with hello conditional access policy.</span></span>

<span data-ttu-id="aa9bc-230">Azure AD skickar tillbaka hello efter HTTP-svar:</span><span class="sxs-lookup"><span data-stu-id="aa9bc-230">Azure AD sends back hello following HTTP response:</span></span> 

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
```

<span data-ttu-id="aa9bc-231">Vår app måste toocatch hello `error=interaction_required`.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-231">Our app needs toocatch hello `error=interaction_required`.</span></span>  <span data-ttu-id="aa9bc-232">hello program kan sedan använda antingen `acquireTokenPopup()` eller `acquireTokenRedirect()` hello på samma resurs.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-232">hello application can then use either `acquireTokenPopup()` or `acquireTokenRedirect()` on hello same resource.</span></span>  <span data-ttu-id="aa9bc-233">hello användaren är framtvingad toodo multifaktorautentisering.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-233">hello user is forced toodo a multi-factor authentication.</span></span> <span data-ttu-id="aa9bc-234">När hello användaren är klar hello multifaktorautentisering hello app utfärdas en ny åtkomsttoken för hello begärd resurs.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-234">After hello user completes hello multi-factor authentication, hello app is issued a fresh access token for hello requested resource.</span></span>

<span data-ttu-id="aa9bc-235">tootry i det här scenariot finns våra [JS SPA On-behalf-of kodexemplet](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-235">tootry out this scenario, see our [JS SPA On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="aa9bc-236">Det här kodexemplet använder hello principen för villkorlig åtkomst och webb-API som du har registrerat tidigare med ett JS SPA toodemonstrate det här scenariot.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-236">This code sample uses hello conditional access policy and web API you registered earlier with a JS SPA toodemonstrate this scenario.</span></span> <span data-ttu-id="aa9bc-237">Den visar hur tooproperly referensen hello anspråk utmaning och få en åtkomsttoken som kan användas för webb-API.</span><span class="sxs-lookup"><span data-stu-id="aa9bc-237">It shows how tooproperly handle hello claims challenge and get an access token that can be used for your Web API.</span></span> <span data-ttu-id="aa9bc-238">Alternativt utcheckningen hello allmänna [Angular.js kodexemplet](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) vägledning om en vinkel SPA</span><span class="sxs-lookup"><span data-stu-id="aa9bc-238">Alternatively, checkout hello general [Angular.js code sample](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) for guidance on an Angular SPA</span></span>


## <a name="see-also"></a><span data-ttu-id="aa9bc-239">Se även</span><span class="sxs-lookup"><span data-stu-id="aa9bc-239">See also</span></span>

* <span data-ttu-id="aa9bc-240">toolearn mer om hello funktioner finns [villkorlig åtkomst i Azure AD](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-240">toolearn more about hello capabilities, see [Conditional Access in Azure AD](../active-directory-conditional-access.md).</span></span>
* <span data-ttu-id="aa9bc-241">Läs mer Azure AD-kodexempel [Github-Repo över kodexempel](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-241">For more Azure AD code samples, see [Github Repo of Code Samples](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span></span> 
* <span data-ttu-id="aa9bc-242">Mer information om hello ADAL SDK och åtkomst hello-referensdokumentation finns [biblioteket guiden](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-242">For more info on hello ADAL SDK's and access hello reference documentation, see [library guide](active-directory-authentication-libraries.md).</span></span>
* <span data-ttu-id="aa9bc-243">toolearn mer information om scenarier med flera innehavare finns [hur toosign användare hello flera innehavare mönster](active-directory-devhowto-multi-tenant-overview.md).</span><span class="sxs-lookup"><span data-stu-id="aa9bc-243">toolearn more about multi-tenant scenarios, see [How toosign in users using hello multi-tenant pattern](active-directory-devhowto-multi-tenant-overview.md).</span></span>
