---
title: "Autentiseringsscenarier för Azure AD | Microsoft Docs"
description: "En översikt över de fem vanligaste autentiseringsscenarier för Azure Active Directory (AAD)"
services: active-directory
documentationcenter: dev-center-name
author: skwan
manager: mbaldwin
editor: 
ms.assetid: 0c84e7d0-16aa-4897-82f2-f53c6c990fd9
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/27/2017
ms.author: skwan
ms.custom: aaddev
ms.openlocfilehash: 2f9410bdaa037f1839cf7c12c3532b51be669ed5
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/18/2017
---
# <a name="authentication-scenarios-for-azure-ad"></a><span data-ttu-id="cefca-103">Autentiseringsscenarier för Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-103">Authentication Scenarios for Azure AD</span></span>
<span data-ttu-id="cefca-104">Azure Active Directory (AD Azure) förenklar autentisering för utvecklare genom att tillhandahålla identitet som en tjänst med stöd för standardiserade protokoll, till exempel OAuth 2.0 och OpenID Connect, samt Öppna källa bibliotek för olika plattformar som hjälper dig att Börja koda snabbt.</span><span class="sxs-lookup"><span data-stu-id="cefca-104">Azure Active Directory (Azure AD) simplifies authentication for developers by providing identity as a service, with support for industry-standard protocols such as OAuth 2.0 and OpenID Connect, as well as open source libraries for different platforms to help you start coding quickly.</span></span> <span data-ttu-id="cefca-105">Det här dokumentet hjälper dig att förstå de olika scenarier för Azure AD stöder och visar hur du kommer igång.</span><span class="sxs-lookup"><span data-stu-id="cefca-105">This document will help you understand the various scenarios Azure AD supports and will show you how to get started.</span></span> <span data-ttu-id="cefca-106">Den är uppdelad i följande avsnitt:</span><span class="sxs-lookup"><span data-stu-id="cefca-106">It’s divided into the following sections:</span></span>

* [<span data-ttu-id="cefca-107">Grunderna för autentisering i Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-107">Basics of Authentication in Azure AD</span></span>](#basics-of-authentication-in-azure-ad)
* [<span data-ttu-id="cefca-108">Anspråk i säkerhetstoken för Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-108">Claims in Azure AD Security Tokens</span></span>](#claims-in-azure-ad-security-tokens)
* [<span data-ttu-id="cefca-109">Grunderna för att registrera ett program i Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-109">Basics of Registering an Application in Azure AD</span></span>](#basics-of-registering-an-application-in-azure-ad)
* [<span data-ttu-id="cefca-110">Programtyper och scenarier</span><span class="sxs-lookup"><span data-stu-id="cefca-110">Application Types and Scenarios</span></span>](#application-types-and-scenarios)
  
  * [<span data-ttu-id="cefca-111">Webbläsare till webbprogram</span><span class="sxs-lookup"><span data-stu-id="cefca-111">Web Browser to Web Application</span></span>](#web-browser-to-web-application)
  * [<span data-ttu-id="cefca-112">Sida program (SPA)</span><span class="sxs-lookup"><span data-stu-id="cefca-112">Single Page Application (SPA)</span></span>](#single-page-application-spa)
  * [<span data-ttu-id="cefca-113">Det ursprungliga programmet i webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-113">Native Application to Web API</span></span>](#native-application-to-web-api)
  * [<span data-ttu-id="cefca-114">Webbprogram i webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-114">Web Application to Web API</span></span>](#web-application-to-web-api)
  * [<span data-ttu-id="cefca-115">Daemon eller Server-program till webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-115">Daemon or Server Application to Web API</span></span>](#daemon-or-server-application-to-web-api)

## <a name="basics-of-authentication-in-azure-ad"></a><span data-ttu-id="cefca-116">Grunderna för autentisering i Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-116">Basics of Authentication in Azure AD</span></span>
<span data-ttu-id="cefca-117">Om du är bekant med grundläggande begrepp för autentisering i Azure AD kan läsa det här avsnittet.</span><span class="sxs-lookup"><span data-stu-id="cefca-117">If you are unfamiliar with basic concepts of authentication in Azure AD, read this section.</span></span> <span data-ttu-id="cefca-118">I annat fall kanske du vill hoppa över ned till [programtyper och scenarier](#application-types-and-scenarios).</span><span class="sxs-lookup"><span data-stu-id="cefca-118">Otherwise, you may want to skip down to [Application Types and Scenarios](#application-types-and-scenarios).</span></span>

<span data-ttu-id="cefca-119">Nu ska vi titta enklaste scenariot där identitet krävs: en användare i en webbläsare måste autentisera till ett webbprogram.</span><span class="sxs-lookup"><span data-stu-id="cefca-119">Let’s consider the most basic scenario where identity is required: a user in a web browser needs to authenticate to a web application.</span></span> <span data-ttu-id="cefca-120">Det här scenariot beskrivs mer detaljerat i den [webbläsare till webbprogrammet](#web-browser-to-web-application) avsnitt, men det är en bra utgångspunkt för att illustrera funktionerna i Azure AD och få en överblick hur scenariot fungerar.</span><span class="sxs-lookup"><span data-stu-id="cefca-120">This scenario is described in greater detail in the [Web Browser to Web Application](#web-browser-to-web-application) section, but it’s a useful starting point to illustrate the capabilities of Azure AD and conceptualize how the scenario works.</span></span> <span data-ttu-id="cefca-121">Överväg följande diagram i det här scenariot:</span><span class="sxs-lookup"><span data-stu-id="cefca-121">Consider the following diagram for this scenario:</span></span>

![Översikt över inloggning till webbprogram](./media/active-directory-authentication-scenarios/basics_of_auth_in_aad.png)

<span data-ttu-id="cefca-123">Diagrammet ovan i åtanke är här vad du behöver veta om dess olika komponenter:</span><span class="sxs-lookup"><span data-stu-id="cefca-123">With the diagram above in mind, here’s what you need to know about its various components:</span></span>

* <span data-ttu-id="cefca-124">Azure AD är identitetsleverantören som ansvarar för att verifiera identiteten för användare och program som finns i en organisation directory och slutligen utfärdar säkerhetstoken vid autentisering av användare och program.</span><span class="sxs-lookup"><span data-stu-id="cefca-124">Azure AD is the identity provider, responsible for verifying the identity of users and applications that exist in an organization’s directory, and ultimately issuing security tokens upon successful authentication of those users and applications.</span></span>
* <span data-ttu-id="cefca-125">Ett program som du vill flytta ut autentisering till Azure AD måste registreras i Azure AD, som registrerar och som unikt identifierar appen i katalogen.</span><span class="sxs-lookup"><span data-stu-id="cefca-125">An application that wants to outsource authentication to Azure AD must be registered in Azure AD, which registers and uniquely identifies the app in the directory.</span></span>
* <span data-ttu-id="cefca-126">Utvecklare kan använda öppen källkod Azure AD-autentiseringsbibliotek så att autentisering lättare genom att hantera protocol-information för dig.</span><span class="sxs-lookup"><span data-stu-id="cefca-126">Developers can use the open source Azure AD authentication libraries to make authentication easy by handling the protocol details for you.</span></span> <span data-ttu-id="cefca-127">Se [Azure Active Directory-Autentiseringsbibliotek](active-directory-authentication-libraries.md) för mer information.</span><span class="sxs-lookup"><span data-stu-id="cefca-127">See [Azure Active Directory Authentication Libraries](active-directory-authentication-libraries.md) for more information.</span></span>

<span data-ttu-id="cefca-128">• När en användare har autentiserats programmet måste verifiera användarens säkerhets-token för att säkerställa att autentiseringen lyckades för de avsedda parterna.</span><span class="sxs-lookup"><span data-stu-id="cefca-128">• Once a user has been authenticated, the application must validate the user’s security token to ensure that authentication was successful for the intended parties.</span></span> <span data-ttu-id="cefca-129">Utvecklare kan använda de angivna autentiseringsbibliotek ska hanteras verifieringen av en token från Azure AD, inklusive token JWT (JSON Web) eller SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="cefca-129">Developers can use the provided authentication libraries to handle validation of any token from Azure AD, including JSON Web Tokens (JWT) or SAML 2.0.</span></span> <span data-ttu-id="cefca-130">Om du vill utföra verifiering manuellt finns i [JWT-Token hanteraren](https://msdn.microsoft.com/library/dn205065.aspx) dokumentation.</span><span class="sxs-lookup"><span data-stu-id="cefca-130">If you want to perform validation manually, see the [JWT Token Handler](https://msdn.microsoft.com/library/dn205065.aspx) documentation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="cefca-131">Azure AD använder kryptering med offentlig nyckel för att signera token och kontrollera att de är giltiga.</span><span class="sxs-lookup"><span data-stu-id="cefca-131">Azure AD uses public key cryptography to sign tokens and verify that they are valid.</span></span> <span data-ttu-id="cefca-132">Se [viktig Information om signering nyckeln förnyelse i Azure AD](active-directory-signing-key-rollover.md) mer information om den nödvändiga logiken måste du ha i ditt program så uppdateras alltid med de senaste nycklarna.</span><span class="sxs-lookup"><span data-stu-id="cefca-132">See [Important Information About Signing Key Rollover in Azure AD](active-directory-signing-key-rollover.md) for more information on the necessary logic you must have in your application to ensure it’s always updated with the latest keys.</span></span>
> 
> 

<span data-ttu-id="cefca-133">• Flödet av begäranden och -svar för autentiseringsprocessen bestäms av autentiseringsprotokoll som används, till exempel OAuth 2.0, OpenID Connect WS-Federation och SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="cefca-133">• The flow of requests and responses for the authentication process is determined by the authentication protocol that was used, such as OAuth 2.0, OpenID Connect, WS-Federation, or SAML 2.0.</span></span> <span data-ttu-id="cefca-134">Dessa protokoll beskrivs i detalj i den [Azure Active Directory-autentiseringsprotokoll](active-directory-authentication-protocols.md) avsnittet och i avsnitten nedan.</span><span class="sxs-lookup"><span data-stu-id="cefca-134">These protocols are discussed in more detail in the [Azure Active Directory Authentication Protocols](active-directory-authentication-protocols.md) topic and in the sections below.</span></span>

> [!NOTE]
> <span data-ttu-id="cefca-135">Azure AD stöder OAuth 2.0 och OpenID Connect standarder som gör omfattande använder ägar-token, inklusive ägar-token som JWTs.</span><span class="sxs-lookup"><span data-stu-id="cefca-135">Azure AD supports the OAuth 2.0 and OpenID Connect standards that make extensive use of bearer tokens, including bearer tokens represented as JWTs.</span></span> <span data-ttu-id="cefca-136">Ett ägartoken är en förenklad säkerhetstoken som ger ”ägar” åtkomst till en skyddad resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-136">A bearer token is a lightweight security token that grants the “bearer” access to a protected resource.</span></span> <span data-ttu-id="cefca-137">På detta sätt är ”innehavaren” någon part som kan ge token.</span><span class="sxs-lookup"><span data-stu-id="cefca-137">In this sense, the “bearer” is any party that can present the token.</span></span> <span data-ttu-id="cefca-138">Även om en part måste de först autentisera med Azure AD ta emot ägartoken om de nödvändiga stegen inte vidtas för att skydda token i överföringen och lagringen, kan de snappas upp och används av en oavsiktlig part.</span><span class="sxs-lookup"><span data-stu-id="cefca-138">Though a party must first authenticate with Azure AD to receive the bearer token, if the required steps are not taken to secure the token in transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="cefca-139">Även om vissa säkerhetstoken har en inbyggd mekanism för att förhindra att obehöriga personer använder dem, ägar-token har inte den här mekanismen och måste transporteras i en säker kanal, till exempel transport layer security (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="cefca-139">While some security tokens have a built-in mechanism for preventing unauthorized parties from using them, bearer tokens do not have this mechanism and must be transported in a secure channel such as transport layer security (HTTPS).</span></span> <span data-ttu-id="cefca-140">Om ett ägartoken skickas i klartext, kan en man-i mitten-attack användas av skadliga part att hämta token och använda den för en obehörig åtkomst till en skyddad resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-140">If a bearer token is transmitted in the clear, a man-in the middle attack can be used by a malicious party to acquire the token and use it for an unauthorized access to a protected resource.</span></span> <span data-ttu-id="cefca-141">Samma säkerhetsprinciper tillämpas när lagring eller cachelagring ägar-token för senare användning.</span><span class="sxs-lookup"><span data-stu-id="cefca-141">The same security principles apply when storing or caching bearer tokens for later use.</span></span> <span data-ttu-id="cefca-142">Se alltid till att ditt program överför och lagrar ägar-token på ett säkert sätt.</span><span class="sxs-lookup"><span data-stu-id="cefca-142">Always ensure that your application transmits and stores bearer tokens in a secure manner.</span></span> <span data-ttu-id="cefca-143">Flera säkerheten på ägar-token finns [RFC 6750 avsnitt 5](http://tools.ietf.org/html/rfc6750).</span><span class="sxs-lookup"><span data-stu-id="cefca-143">For more security considerations on bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>
> 
> 

<span data-ttu-id="cefca-144">Nu när du har en översikt över grunderna kan du läsa nedanstående avsnitt för att förstå hur etablering fungerar i Azure AD och har stöd för vanliga scenarier för Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-144">Now that you have an overview of the basics, read the sections below to understand how provisioning works in Azure AD and the common scenarios Azure AD supports.</span></span>

## <a name="claims-in-azure-ad-security-tokens"></a><span data-ttu-id="cefca-145">Anspråk i säkerhetstoken för Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-145">Claims in Azure AD Security Tokens</span></span>
<span data-ttu-id="cefca-146">Säkerhetstoken som utfärdats av Azure AD innehåller anspråk eller intyg för information om ämnet som har verifierats.</span><span class="sxs-lookup"><span data-stu-id="cefca-146">Security tokens issued by Azure AD contain claims, or assertions of information about the subject that has been authenticated.</span></span> <span data-ttu-id="cefca-147">Dessa anspråk kan användas av programmet för olika aktiviteter.</span><span class="sxs-lookup"><span data-stu-id="cefca-147">These claims can be used by the application for various tasks.</span></span> <span data-ttu-id="cefca-148">Till exempel användas de för att validera token, identifiera ämnets directory-klient, Visa användarinformation, fastställa användarens tillstånd och så vidare.</span><span class="sxs-lookup"><span data-stu-id="cefca-148">For example, they can be used to validate the token, identify the subject's directory tenant, display user information, determine the subject's authorization, and so on.</span></span> <span data-ttu-id="cefca-149">Anspråk finns i alla angivna säkerhetstoken är beroende av typ av token, vilken typ av autentiseringsuppgift som används för att autentisera användaren och programkonfigurationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-149">The claims present in any given security token are dependent upon the type of token, the type of credential used to authenticate the user, and the application configuration.</span></span> <span data-ttu-id="cefca-150">En kort beskrivning av varje typ av anspråk som orsakat av Azure AD har angetts i tabellen nedan.</span><span class="sxs-lookup"><span data-stu-id="cefca-150">A brief description of each type of claim emitted by Azure AD is provided in the table below.</span></span> <span data-ttu-id="cefca-151">Mer information finns i [stöds Token och anspråkstyper](active-directory-token-and-claims.md).</span><span class="sxs-lookup"><span data-stu-id="cefca-151">For more information, refer to [Supported Token and Claim Types](active-directory-token-and-claims.md).</span></span>

| <span data-ttu-id="cefca-152">Begär</span><span class="sxs-lookup"><span data-stu-id="cefca-152">Claim</span></span> | <span data-ttu-id="cefca-153">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="cefca-153">Description</span></span> |
| --- | --- |
| <span data-ttu-id="cefca-154">Program-ID:t</span><span class="sxs-lookup"><span data-stu-id="cefca-154">Application ID</span></span> |<span data-ttu-id="cefca-155">Identifierar det program som använder token.</span><span class="sxs-lookup"><span data-stu-id="cefca-155">Identifies the application that is using the token.</span></span> |
| <span data-ttu-id="cefca-156">Målgrupp</span><span class="sxs-lookup"><span data-stu-id="cefca-156">Audience</span></span> |<span data-ttu-id="cefca-157">Identifierar mottagande resursen token är avsett för.</span><span class="sxs-lookup"><span data-stu-id="cefca-157">Identifies the recipient resource the token is intended for.</span></span> |
| <span data-ttu-id="cefca-158">Application Authentication Context Class Reference</span><span class="sxs-lookup"><span data-stu-id="cefca-158">Application Authentication Context Class Reference</span></span> |<span data-ttu-id="cefca-159">Anger hur klienten har autentiserat (offentliga klient kontra konfidentiell klienten).</span><span class="sxs-lookup"><span data-stu-id="cefca-159">Indicates how the client was authenticated (public client vs. confidential client).</span></span> |
| <span data-ttu-id="cefca-160">Autentisering snabbmeddelanden</span><span class="sxs-lookup"><span data-stu-id="cefca-160">Authentication Instant</span></span> |<span data-ttu-id="cefca-161">Registrerar datum och tid då autentiseringen inträffade.</span><span class="sxs-lookup"><span data-stu-id="cefca-161">Records the date and time when the authentication occurred.</span></span> |
| <span data-ttu-id="cefca-162">Autentiseringsmetod</span><span class="sxs-lookup"><span data-stu-id="cefca-162">Authentication Method</span></span> |<span data-ttu-id="cefca-163">Anger hur ämnet för token autentiserades (lösenord, certifikat, etc.).</span><span class="sxs-lookup"><span data-stu-id="cefca-163">Indicates how the subject of the token was authenticated (password, certificate, etc.).</span></span> |
| <span data-ttu-id="cefca-164">Förnamn</span><span class="sxs-lookup"><span data-stu-id="cefca-164">First Name</span></span> |<span data-ttu-id="cefca-165">Innehåller det angivna namnet för användaren som angetts i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-165">Provides the given name of the user as set in Azure AD.</span></span> |
| <span data-ttu-id="cefca-166">Grupper</span><span class="sxs-lookup"><span data-stu-id="cefca-166">Groups</span></span> |<span data-ttu-id="cefca-167">Innehåller objekt-ID: N för Azure AD-grupper som användaren är medlem i.</span><span class="sxs-lookup"><span data-stu-id="cefca-167">Contains object Ids of Azure AD groups the user is a member of.</span></span> |
| <span data-ttu-id="cefca-168">Identitetsprovider</span><span class="sxs-lookup"><span data-stu-id="cefca-168">Identity Provider</span></span> |<span data-ttu-id="cefca-169">Registrerar den identitetsleverantör som autentiserats föremål för token.</span><span class="sxs-lookup"><span data-stu-id="cefca-169">Records the identity provider that authenticated the subject of the token.</span></span> |
| <span data-ttu-id="cefca-170">Utfärdat till</span><span class="sxs-lookup"><span data-stu-id="cefca-170">Issued At</span></span> |<span data-ttu-id="cefca-171">Registrerar den tid då token har utfärdats, används ofta för token dokumentens.</span><span class="sxs-lookup"><span data-stu-id="cefca-171">Records the time at which the token was issued, often used for token freshness.</span></span> |
| <span data-ttu-id="cefca-172">Utfärdaren</span><span class="sxs-lookup"><span data-stu-id="cefca-172">Issuer</span></span> |<span data-ttu-id="cefca-173">Identifierar STS som orsakat token som Azure AD-klient.</span><span class="sxs-lookup"><span data-stu-id="cefca-173">Identifies the STS that emitted the token as well as the Azure AD tenant.</span></span> |
| <span data-ttu-id="cefca-174">Efternamn</span><span class="sxs-lookup"><span data-stu-id="cefca-174">Last Name</span></span> |<span data-ttu-id="cefca-175">Innehåller användarens efternamn som angetts i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-175">Provides the surname of the user as set in Azure AD.</span></span> |
| <span data-ttu-id="cefca-176">Namn</span><span class="sxs-lookup"><span data-stu-id="cefca-176">Name</span></span> |<span data-ttu-id="cefca-177">Ger en mänsklig läsbar värde som identifierar föremål för token.</span><span class="sxs-lookup"><span data-stu-id="cefca-177">Provides a human readable value that identifies the subject of the token.</span></span> |
| <span data-ttu-id="cefca-178">Objekt-Id</span><span class="sxs-lookup"><span data-stu-id="cefca-178">Object Id</span></span> |<span data-ttu-id="cefca-179">Innehåller en ändras, unik identifierare för ämnet i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-179">Contains an immutable, unique identifier of the subject in Azure AD.</span></span> |
| <span data-ttu-id="cefca-180">Roller</span><span class="sxs-lookup"><span data-stu-id="cefca-180">Roles</span></span> |<span data-ttu-id="cefca-181">Innehåller egna namnen på Azure AD Application roller som användaren har beviljats.</span><span class="sxs-lookup"><span data-stu-id="cefca-181">Contains friendly names of Azure AD Application Roles that the user has been granted.</span></span> |
| <span data-ttu-id="cefca-182">Omfång</span><span class="sxs-lookup"><span data-stu-id="cefca-182">Scope</span></span> |<span data-ttu-id="cefca-183">Anger behörigheterna för klientprogrammet.</span><span class="sxs-lookup"><span data-stu-id="cefca-183">Indicates the permissions granted to the client application.</span></span> |
| <span data-ttu-id="cefca-184">Ämne</span><span class="sxs-lookup"><span data-stu-id="cefca-184">Subject</span></span> |<span data-ttu-id="cefca-185">Anger huvudnamn som Assert token information.</span><span class="sxs-lookup"><span data-stu-id="cefca-185">Indicates the principal about which the token asserts information.</span></span> |
| <span data-ttu-id="cefca-186">Klient-Id</span><span class="sxs-lookup"><span data-stu-id="cefca-186">Tenant Id</span></span> |<span data-ttu-id="cefca-187">Innehåller en ändras, unik identifierare för directory-klient som utfärdade token.</span><span class="sxs-lookup"><span data-stu-id="cefca-187">Contains an immutable, unique identifier of the directory tenant that issued the token.</span></span> |
| <span data-ttu-id="cefca-188">Livslängd för token</span><span class="sxs-lookup"><span data-stu-id="cefca-188">Token Lifetime</span></span> |<span data-ttu-id="cefca-189">Definierar det tidsintervall inom vilket en token är giltig.</span><span class="sxs-lookup"><span data-stu-id="cefca-189">Defines the time interval within which a token is valid.</span></span> |
| <span data-ttu-id="cefca-190">Användarens huvudnamn</span><span class="sxs-lookup"><span data-stu-id="cefca-190">User Principal Name</span></span> |<span data-ttu-id="cefca-191">Innehåller användarens huvudnamn för ämnet.</span><span class="sxs-lookup"><span data-stu-id="cefca-191">Contains the user principal name of the subject.</span></span> |
| <span data-ttu-id="cefca-192">Version</span><span class="sxs-lookup"><span data-stu-id="cefca-192">Version</span></span> |<span data-ttu-id="cefca-193">Innehåller versionsnumret för token.</span><span class="sxs-lookup"><span data-stu-id="cefca-193">Contains the version number of the token.</span></span> |

## <a name="basics-of-registering-an-application-in-azure-ad"></a><span data-ttu-id="cefca-194">Grunderna för att registrera ett program i Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-194">Basics of Registering an Application in Azure AD</span></span>
<span data-ttu-id="cefca-195">Alla program som outsources autentisering till Azure AD måste registreras i en katalog.</span><span class="sxs-lookup"><span data-stu-id="cefca-195">Any application that outsources authentication to Azure AD must be registered in a directory.</span></span> <span data-ttu-id="cefca-196">Det här steget handlar om Azure AD om ditt program, inklusive URL: en där den finns, URL: en att skicka svar efter autentisering, URI: N för att identifiera ditt program och mycket mer.</span><span class="sxs-lookup"><span data-stu-id="cefca-196">This step involves telling Azure AD about your application, including the URL where it’s located, the URL to send replies after authentication, the URI to identify your application, and more.</span></span> <span data-ttu-id="cefca-197">Den här informationen krävs för några viktiga orsaker:</span><span class="sxs-lookup"><span data-stu-id="cefca-197">This information is required for a few key reasons:</span></span>

* <span data-ttu-id="cefca-198">Azure AD måste koordinater för att kommunicera med programmet när du arbetar med inloggning eller utbyte token.</span><span class="sxs-lookup"><span data-stu-id="cefca-198">Azure AD needs coordinates to communicate with the application when handling sign-on or exchanging tokens.</span></span> <span data-ttu-id="cefca-199">Dessa omfattar följande:</span><span class="sxs-lookup"><span data-stu-id="cefca-199">These include the following:</span></span>
  
  * <span data-ttu-id="cefca-200">Program-ID-URI: ID för ett program.</span><span class="sxs-lookup"><span data-stu-id="cefca-200">Application ID URI: The identifier for an application.</span></span> <span data-ttu-id="cefca-201">Det här värdet skickas till Azure AD under autentiseringen för att ange vilket program anroparen vill ha en token för.</span><span class="sxs-lookup"><span data-stu-id="cefca-201">This value is sent to Azure AD during authentication to indicate which application the caller wants a token for.</span></span> <span data-ttu-id="cefca-202">Det här värdet ingår dessutom i token så att programmet vet var avsedda mål.</span><span class="sxs-lookup"><span data-stu-id="cefca-202">Additionally, this value is included in the token so that the application knows it was the intended target.</span></span>
  * <span data-ttu-id="cefca-203">Svara URL och omdirigerings-URI: för web API eller webbprogram, svars-URL: en är den plats som Azure AD skickar autentiseringssvar, inklusive en token om autentiseringen lyckades.</span><span class="sxs-lookup"><span data-stu-id="cefca-203">Reply URL and Redirect URI: In the case of a web API or web application, the Reply URL is the location to which Azure AD will send the authentication response, including a token if authentication was successful.</span></span> <span data-ttu-id="cefca-204">När det gäller en programspecifika är omdirigerings-URI en unik identifierare som Azure AD att omdirigera användaragent i en OAuth 2.0-begäran.</span><span class="sxs-lookup"><span data-stu-id="cefca-204">In the case of a native application, the Redirect URI is a unique identifier to which Azure AD will redirect the user-agent in an OAuth 2.0 request.</span></span>
  * <span data-ttu-id="cefca-205">Program-ID: ID för ett program som genereras av Azure AD när programmet har registrerats.</span><span class="sxs-lookup"><span data-stu-id="cefca-205">Application ID: The ID for an application, which is generated by Azure AD when the application is registered.</span></span> <span data-ttu-id="cefca-206">När du begär en Auktoriseringskoden eller token, skickas det program-ID och nyckel till Azure AD under autentiseringen.</span><span class="sxs-lookup"><span data-stu-id="cefca-206">When requesting an authorization code or token, the Application ID and key are sent to Azure AD during authentication.</span></span>
  * <span data-ttu-id="cefca-207">Nyckel: Den nyckel som skickas tillsammans med ett program-ID när du autentiserar till Azure AD att anropa ett webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-207">Key: The key that is sent along with a Application ID when authenticating to Azure AD to call a web API.</span></span>
* <span data-ttu-id="cefca-208">Azure AD måste se till att programmet har behörighet att komma åt dina katalogdata, andra program i din organisation, och så vidare</span><span class="sxs-lookup"><span data-stu-id="cefca-208">Azure AD needs to ensure the application has the required permissions to access your directory data, other applications in your organization, and so on</span></span>

<span data-ttu-id="cefca-209">Etablering blir tydligare när du förstår att det finns två typer av program som utvecklats och integrerade med Azure AD:</span><span class="sxs-lookup"><span data-stu-id="cefca-209">Provisioning becomes clearer when you understand that there are two categories of applications that can be developed and integrated with Azure AD:</span></span>

* <span data-ttu-id="cefca-210">Enkel klient program: en enskild klient-programmet är avsett att användas i en organisation.</span><span class="sxs-lookup"><span data-stu-id="cefca-210">Single tenant application: A single tenant application is intended for use in one organization.</span></span> <span data-ttu-id="cefca-211">Detta är vanligtvis line-of-business (LoB)-appar som skrivits av en enterprise-utvecklare.</span><span class="sxs-lookup"><span data-stu-id="cefca-211">These are typically line-of-business (LoB) applications written by an enterprise developer.</span></span> <span data-ttu-id="cefca-212">En enskild klient behöver bara användas av användare i en katalog och därför bara behöver etableras i en katalog.</span><span class="sxs-lookup"><span data-stu-id="cefca-212">A single tenant application only needs to be accessed by users in one directory, and as a result, it only needs to be provisioned in one directory.</span></span> <span data-ttu-id="cefca-213">Programmen registreras vanligtvis av en utvecklare i organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-213">These applications are typically registered by a developer in the organization.</span></span>
* <span data-ttu-id="cefca-214">Flera innehavare program: ett program med flera innehavare är avsedd att användas i många organisationer är inte en organisation.</span><span class="sxs-lookup"><span data-stu-id="cefca-214">Multi-tenant application: A multi-tenant application is intended for use in many organizations, not just one organization.</span></span> <span data-ttu-id="cefca-215">Detta är vanligtvis programvara som en-tjänst (SaaS)-program som skrivits av en oberoende programvaruleverantör (ISV).</span><span class="sxs-lookup"><span data-stu-id="cefca-215">These are typically software-as-a-service (SaaS) applications written by an independent software vendor (ISV).</span></span> <span data-ttu-id="cefca-216">Program med flera klienter måste tillhandahållas i varje katalog där de kommer att användas, vilket kräver att användaren eller administratören tillstånd att registrera dem.</span><span class="sxs-lookup"><span data-stu-id="cefca-216">Multi-tenant applications need to be provisioned in each directory where they will be used, which requires user or administrator consent to register them.</span></span> <span data-ttu-id="cefca-217">Medgivande processen startas när ett program som har registrerats i katalogen och ges åtkomst till Graph API eller kanske en annan webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-217">This consent process starts when an application has been registered in the directory and is given access to the Graph API or perhaps another web API.</span></span> <span data-ttu-id="cefca-218">När en användare eller administratör från en annan organisation registrerar sig för att använda programmet, visas en dialogruta som visar de behörigheter som programmet kräver.</span><span class="sxs-lookup"><span data-stu-id="cefca-218">When a user or administrator from a different organization signs up to use the application, they are presented with a dialog that displays the permissions the application requires.</span></span> <span data-ttu-id="cefca-219">Användaren eller administratören kan sedan samtycka till programmet, vilket ger programmet tillgång till den angivna data och slutligen registrerar programmet i sina kataloger.</span><span class="sxs-lookup"><span data-stu-id="cefca-219">The user or administrator can then consent to the application, which gives the application access to the stated data, and finally registers the application in their directory.</span></span> <span data-ttu-id="cefca-220">Mer information finns i [översikt av Framework medgivande](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span><span class="sxs-lookup"><span data-stu-id="cefca-220">For more information, see [Overview of the Consent Framework](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span></span>

<span data-ttu-id="cefca-221">Vissa ytterligare överväganden uppstå när du utvecklar ett program med flera innehavare i stället för en enskild klient-program.</span><span class="sxs-lookup"><span data-stu-id="cefca-221">Some additional considerations arise when developing a multi-tenant application instead of a single tenant application.</span></span> <span data-ttu-id="cefca-222">Till exempel om du gör programmet tillgängligt för användare i flera kataloger, måste en mekanism för att avgöra vilken de inte finns i.</span><span class="sxs-lookup"><span data-stu-id="cefca-222">For example, if you are making your application available to users in multiple directories, you need a mechanism to determine which tenant they’re in.</span></span> <span data-ttu-id="cefca-223">En enskild klient behöver bara söka i en egen katalog för en användare när ett program med flera innehavare behöver identifiera en viss användare från alla kataloger i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-223">A single tenant application only needs to look in its own directory for a user, while a multi-tenant application needs to identify a specific user from all the directories in Azure AD.</span></span> <span data-ttu-id="cefca-224">Om du vill utföra den här uppgiften, innehåller Azure AD en gemensam autentisering ändpunkt där alla program med flera innehavare kan dirigera inloggning-förfrågningar, i stället för en klient-specifika slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="cefca-224">To accomplish this task, Azure AD provides a common authentication endpoint where any multi-tenant application can direct sign-in requests, instead of a tenant-specific endpoint.</span></span> <span data-ttu-id="cefca-225">Den här slutpunkten är https://login.microsoftonline.com/common för alla kataloger i Azure AD, medan en slutpunkt för klient kan vara https://login.microsoftonline.com/contoso.onmicrosoft.com. Vanliga slutpunkten är särskilt viktigt att tänka på när du utvecklar programmet eftersom du behöver den nödvändiga logiken för att hantera flera klienter under inloggning, utloggning, och token-verifiering.</span><span class="sxs-lookup"><span data-stu-id="cefca-225">This endpoint is https://login.microsoftonline.com/common for all directories in Azure AD, whereas a tenant-specific endpoint might be https://login.microsoftonline.com/contoso.onmicrosoft.com. The common endpoint is especially important to consider when developing your application because you’ll need the necessary logic to handle multiple tenants during sign-in, sign-out, and token validation.</span></span>

<span data-ttu-id="cefca-226">Om du utvecklar för närvarande en enskild klient programmet men vill göra den tillgänglig för många organisationer, kan du enkelt göra ändringar för programmet och dess konfiguration i Azure AD för att göra det med flera innehavare kompatibla.</span><span class="sxs-lookup"><span data-stu-id="cefca-226">If you are currently developing a single tenant application but want to make it available to many organizations, you can easily make changes to the application and its configuration in Azure AD to make it multi-tenant capable.</span></span> <span data-ttu-id="cefca-227">Dessutom använder Azure AD samma signeringsnyckeln för alla token i alla kataloger om du tillhandahåller autentisering i en enskild klient eller ett program för flera innehavare.</span><span class="sxs-lookup"><span data-stu-id="cefca-227">In addition, Azure AD uses the same signing key for all tokens in all directories, whether you are providing authentication in a single tenant or multi-tenant application.</span></span>

<span data-ttu-id="cefca-228">Varje scenario som beskrivs i det här dokumentet innehåller en del som beskriver etablering krav.</span><span class="sxs-lookup"><span data-stu-id="cefca-228">Each scenario listed in this document includes a sub-section that describes its provisioning requirements.</span></span> <span data-ttu-id="cefca-229">Mer detaljerad information om etablering av ett program i Azure AD och skillnaderna mellan enstaka och flera innehavare program finns [integrera program med Azure Active Directory](active-directory-integrating-applications.md) för mer information.</span><span class="sxs-lookup"><span data-stu-id="cefca-229">For more in-depth information about provisioning an application in Azure AD and the differences between single and multi-tenant applications, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md) for more information.</span></span> <span data-ttu-id="cefca-230">Fortsätt läsa för att förstå vanliga Programscenarier för i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-230">Continue reading to understand the common application scenarios in Azure AD.</span></span>

## <a name="application-types-and-scenarios"></a><span data-ttu-id="cefca-231">Programtyper och scenarier</span><span class="sxs-lookup"><span data-stu-id="cefca-231">Application Types and Scenarios</span></span>
<span data-ttu-id="cefca-232">Var och en av de scenarier som beskrivs i detta dokument kan utvecklats med olika språk och plattformar.</span><span class="sxs-lookup"><span data-stu-id="cefca-232">Each of the scenarios described in this document can be developed using various languages and platforms.</span></span> <span data-ttu-id="cefca-233">De är alla backas upp av fullständig kodexempel som är tillgängliga i vår [kodexempel guide](active-directory-code-samples.md), eller direkt från motsvarande [GitHub-lagringsplatser som exempel](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory).</span><span class="sxs-lookup"><span data-stu-id="cefca-233">They are all backed by complete code samples which are available in our [Code Samples guide](active-directory-code-samples.md), or directly from the corresponding [GitHub sample repositories](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory).</span></span> <span data-ttu-id="cefca-234">Dessutom, om ditt program måste en viss del eller segment i ett scenario för slutpunkt till slutpunkt, kan i de flesta fall funktionen läggas oberoende av varandra.</span><span class="sxs-lookup"><span data-stu-id="cefca-234">In addition, if your application needs a specific piece or segment of an end-to-end scenario, in most cases that functionality can be added independently.</span></span> <span data-ttu-id="cefca-235">Till exempel om du har en inbyggd program som anropar ett webb-API, du kan enkelt lägga till ett program som anropar också webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-235">For example, if you have a native application that calls a web API, you can easily add a web application that also calls the web API.</span></span> <span data-ttu-id="cefca-236">Följande diagram illustrerar dessa scenarier och programtyper, och hur olika komponenter kan läggas till:</span><span class="sxs-lookup"><span data-stu-id="cefca-236">The following diagram illustrates these scenarios and application types, and how different components can be added:</span></span>

![Programtyper och scenarier](./media/active-directory-authentication-scenarios/application_types_and_scenarios.png)

<span data-ttu-id="cefca-238">Dessa är de fem primära programmet scenarier som stöds av Azure AD:</span><span class="sxs-lookup"><span data-stu-id="cefca-238">These are the five primary application scenarios supported by Azure AD:</span></span>

* <span data-ttu-id="cefca-239">[Webbläsaren till webbprogrammet](#web-browser-to-web-application): en användare behöver att logga in på ett program som skyddas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-239">[Web Browser to Web Application](#web-browser-to-web-application): A user needs to sign in to a web application that is secured by Azure AD.</span></span>
* <span data-ttu-id="cefca-240">[Enkel sida program (SPA)](#single-page-application-spa): en användare behöver att logga in på en enstaka sida-program som skyddas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-240">[Single Page Application (SPA)](#single-page-application-spa): A user needs to sign in to a single page application that is secured by Azure AD.</span></span>
* <span data-ttu-id="cefca-241">[Det ursprungliga programmet webb-API: et](#native-application-to-web-api): en intern program som körs på en mobiltelefon, surfplatta eller dator måste autentisera en användare för att hämta resurser från ett webb-API som skyddas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-241">[Native Application to Web API](#native-application-to-web-api): A native application that runs on a phone, tablet, or PC needs to authenticate a user to get resources from a web API that is secured by Azure AD.</span></span>
* <span data-ttu-id="cefca-242">[Webbprogrammet webb-API: et](#web-application-to-web-api): ett webbprogram måste hämta resurser från ett webb-API som skyddas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-242">[Web Application to Web API](#web-application-to-web-api): A web application needs to get resources from a web API secured by Azure AD.</span></span>
* <span data-ttu-id="cefca-243">[Daemon eller Server-program till webb-API](#daemon-or-server-application-to-web-api): en daemon-program eller ett serverprogram utan användargränssnitt för web måste hämta resurser från ett webb-API som skyddas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-243">[Daemon or Server Application to Web API](#daemon-or-server-application-to-web-api): A daemon application or a server application with no web user interface needs to get resources from a web API secured by Azure AD.</span></span>

### <a name="web-browser-to-web-application"></a><span data-ttu-id="cefca-244">Webbläsare till webbprogram</span><span class="sxs-lookup"><span data-stu-id="cefca-244">Web Browser to Web Application</span></span>
<span data-ttu-id="cefca-245">Det här avsnittet beskrivs ett program som autentiserar användare i en webbläsare till ett webbprogram.</span><span class="sxs-lookup"><span data-stu-id="cefca-245">This section describes an application that authenticates a user in a web browser to a web application.</span></span> <span data-ttu-id="cefca-246">I det här scenariot dirigerar webbprogrammet användarens webbläsare för att logga in dem på Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-246">In this scenario, the web application directs the user’s browser to sign them in to Azure AD.</span></span> <span data-ttu-id="cefca-247">Azure AD returnerar ett svar till användarens webbläsare, som innehåller anspråk om användaren i en säkerhetstoken.</span><span class="sxs-lookup"><span data-stu-id="cefca-247">Azure AD returns a sign-in response through the user’s browser, which contains claims about the user in a security token.</span></span> <span data-ttu-id="cefca-248">Det här scenariot stöder inloggning med WS-Federation, SAML 2.0 och OpenID Connect-protokoll.</span><span class="sxs-lookup"><span data-stu-id="cefca-248">This scenario supports sign-on using the WS-Federation, SAML 2.0, and OpenID Connect protocols.</span></span>

#### <a name="diagram"></a><span data-ttu-id="cefca-249">Diagram</span><span class="sxs-lookup"><span data-stu-id="cefca-249">Diagram</span></span>
![Autentiseringsflödet för webbläsaren till webbprogram](./media/active-directory-authentication-scenarios/web_browser_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="cefca-251">Beskrivning av protokollet flöde</span><span class="sxs-lookup"><span data-stu-id="cefca-251">Description of Protocol Flow</span></span>
1. <span data-ttu-id="cefca-252">När en användare besöker programmet och behöver logga in, omdirigeras via en begäran till autentiseringsslutpunkten i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-252">When a user visits the application and needs to sign in, they are redirected via a sign-in request to the authentication endpoint in Azure AD.</span></span>
2. <span data-ttu-id="cefca-253">Användaren loggar in på sidan logga in.</span><span class="sxs-lookup"><span data-stu-id="cefca-253">The user signs in on the sign-in page.</span></span>
3. <span data-ttu-id="cefca-254">Om autentiseringen lyckas skapar en autentiseringstoken Azure AD och returnerar ett svar till programmets Reply URL som har konfigurerats i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="cefca-254">If authentication is successful, Azure AD creates an authentication token and returns a sign-in response to the application’s Reply URL that was configured in the Azure Portal.</span></span> <span data-ttu-id="cefca-255">För ett produktionsprogram vara svars-URL: en HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cefca-255">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="cefca-256">Returnerade token innehåller anspråk om användaren och Azure AD som krävs av programmet för att validera token.</span><span class="sxs-lookup"><span data-stu-id="cefca-256">The returned token includes claims about the user and Azure AD that are required by the application to validate the token.</span></span>
4. <span data-ttu-id="cefca-257">Programmet validerar token med hjälp av en offentlig signeringsnyckel och information om utfärdare tillgänglig federation metadata dokumentet för Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-257">The application validates the token by using a public signing key and issuer information available at the federation metadata document for Azure AD.</span></span> <span data-ttu-id="cefca-258">När programmet validerar token, startar en ny session med användaren i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-258">After the application validates the token, Azure AD starts a new session with the user.</span></span> <span data-ttu-id="cefca-259">Den här sessionen kan användare komma åt programmet tills den förfaller.</span><span class="sxs-lookup"><span data-stu-id="cefca-259">This session allows the user to access the application until it expires.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="cefca-260">Kodexempel</span><span class="sxs-lookup"><span data-stu-id="cefca-260">Code Samples</span></span>
<span data-ttu-id="cefca-261">Se kodexempel för webbläsaren till webbprogrammet scenarier.</span><span class="sxs-lookup"><span data-stu-id="cefca-261">See the code samples for Web Browser to Web Application scenarios.</span></span> <span data-ttu-id="cefca-262">Och kom tillbaka ofta--vi lägga till nya prov hela tiden.</span><span class="sxs-lookup"><span data-stu-id="cefca-262">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="cefca-263">[Webbläsaren till webbprogrammet](active-directory-code-samples.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="cefca-263">[Web Browser to Web Application](active-directory-code-samples.md#web-browser-to-web-application).</span></span>

#### <a name="registering"></a><span data-ttu-id="cefca-264">Registrera</span><span class="sxs-lookup"><span data-stu-id="cefca-264">Registering</span></span>
* <span data-ttu-id="cefca-265">Enskild klient: Om du skapar ett program för din organisation, den måste registreras i företagets katalog med hjälp av Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="cefca-265">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using the Azure Portal.</span></span>
* <span data-ttu-id="cefca-266">Flera innehavare: Om du skapar ett program som kan användas av användare utanför organisationen, den måste vara registrerat i företagets katalog, men även måste registreras i varje organisations katalog som kommer att använda programmet.</span><span class="sxs-lookup"><span data-stu-id="cefca-266">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using the application.</span></span> <span data-ttu-id="cefca-267">Om du vill att ditt program finns i deras katalog, kan du inkludera en registreringsprocessen för dina kunder som gör det möjligt för dem att samtycka till ditt program.</span><span class="sxs-lookup"><span data-stu-id="cefca-267">To make your application available in their directory, you can include a sign-up process for your customers that enables them to consent to your application.</span></span> <span data-ttu-id="cefca-268">När de registrerar sig för ditt program, kommer de att visas en dialogruta som visar de behörigheter som krävs för programmet och sedan på alternativet för att godkänna.</span><span class="sxs-lookup"><span data-stu-id="cefca-268">When they sign up for your application, they will be presented with a dialog that shows the permissions the application requires, and then the option to consent.</span></span> <span data-ttu-id="cefca-269">Beroende på behörigheterna som krävs kan en administratör i den andra organisationen krävas för att ge ditt medgivande.</span><span class="sxs-lookup"><span data-stu-id="cefca-269">Depending on the required permissions, an administrator in the other organization may be required to give consent.</span></span> <span data-ttu-id="cefca-270">När användaren eller administratören godkänner, registreras programmet i sina kataloger.</span><span class="sxs-lookup"><span data-stu-id="cefca-270">When the user or administrator consents, the application is registered in their directory.</span></span> <span data-ttu-id="cefca-271">Mer information finns i [integrera program med Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="cefca-271">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="cefca-272">Token upphör att gälla</span><span class="sxs-lookup"><span data-stu-id="cefca-272">Token Expiration</span></span>
<span data-ttu-id="cefca-273">Användarens session upphör att gälla när livslängd för token som utfärdas av Azure AD upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="cefca-273">The user’s session expires when the lifetime of the token issued by Azure AD expires.</span></span> <span data-ttu-id="cefca-274">Programmet kan förkorta denna tidsperiod om så önskas, till exempel logga ut användare baserat på en period av inaktivitet.</span><span class="sxs-lookup"><span data-stu-id="cefca-274">Your application can shorten this time period if desired, such as signing out users based on a period of inactivity.</span></span> <span data-ttu-id="cefca-275">När sessionen upphör att gälla, uppmanas användaren att logga in igen.</span><span class="sxs-lookup"><span data-stu-id="cefca-275">When the session expires, the user will be prompted to sign in again.</span></span>

### <a name="single-page-application-spa"></a><span data-ttu-id="cefca-276">Sida program (SPA)</span><span class="sxs-lookup"><span data-stu-id="cefca-276">Single Page Application (SPA)</span></span>
<span data-ttu-id="cefca-277">Det här avsnittet beskrivs autentisering för ett enskilt sidan program som använder Azure AD och OAuth 2.0 implicit auktorisering bevilja för att skydda dess webb-API: N tillbaka avslutas.</span><span class="sxs-lookup"><span data-stu-id="cefca-277">This section describes authentication for a Single Page Application, that uses Azure AD and the OAuth 2.0 implicit authorization grant to secure its web API back end.</span></span> <span data-ttu-id="cefca-278">Den enda sidan program är vanligtvis strukturerade som ett JavaScript presentation lager (klientdel) som körs i webbläsaren och en serverdel för webb-API som körs på en server och implementerar affärslogiken för programmet.</span><span class="sxs-lookup"><span data-stu-id="cefca-278">Single Page Applications are typically structured as a JavaScript presentation layer (front end) that runs in the browser and a Web API back end that runs on a server and implements the application’s business logic.</span></span> <span data-ttu-id="cefca-279">Mer information om implicit authorization grant och hjälpa dig att avgöra om det är bäst för ditt program-scenario genom att se [förstå OAuth2 implicit bevilja flödet i Azure Active Directory](active-directory-dev-understanding-oauth2-implicit-grant.md).</span><span class="sxs-lookup"><span data-stu-id="cefca-279">To learn more about the implicit authorization grant, and help you decide whether it's right for your application scenario, see [Understanding the OAuth2 implicit grant flow in Azure Active Directory](active-directory-dev-understanding-oauth2-implicit-grant.md).</span></span>

<span data-ttu-id="cefca-280">I det här scenariot, när användaren loggar in, JavaScript front end använder [Active Directory Authentication Library för JavaScript (ADAL. JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) och implicit tillstånd att hämta en token med ID (id_token) från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-280">In this scenario, when the user signs in, the JavaScript front end uses [Active Directory Authentication Library for JavaScript (ADAL.JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) and the implicit authorization grant to obtain an ID token (id_token) from Azure AD.</span></span> <span data-ttu-id="cefca-281">Token cachelagras och klienten kopplas till begäran som ägartoken när du anropar dess Web API serverdel som skyddas med OWIN-mellanprogram.</span><span class="sxs-lookup"><span data-stu-id="cefca-281">The token is cached and the client attaches it to the request as the bearer token when making calls to its Web API back end, which is secured using the OWIN middleware.</span></span> 

#### <a name="diagram"></a><span data-ttu-id="cefca-282">Diagram</span><span class="sxs-lookup"><span data-stu-id="cefca-282">Diagram</span></span>
![Den enda Page Application diagram](./media/active-directory-authentication-scenarios/single_page_app.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="cefca-284">Beskrivning av protokollet flöde</span><span class="sxs-lookup"><span data-stu-id="cefca-284">Description of Protocol Flow</span></span>
1. <span data-ttu-id="cefca-285">Användaren navigerar till webbprogrammet.</span><span class="sxs-lookup"><span data-stu-id="cefca-285">The user navigates to the web application.</span></span>
2. <span data-ttu-id="cefca-286">Programmet returnerar JavaScript klientdelen (presentation layer) till webbläsaren.</span><span class="sxs-lookup"><span data-stu-id="cefca-286">The application returns the JavaScript front end (presentation layer) to the browser.</span></span>
3. <span data-ttu-id="cefca-287">Användaren initierar inloggning, till exempel genom att klicka på ett tecken i länken.</span><span class="sxs-lookup"><span data-stu-id="cefca-287">The user initiates sign in, for example by clicking a sign in link.</span></span> <span data-ttu-id="cefca-288">Webbläsaren skickar en GET till Azure AD-autentiseringsslutpunkt att begära en ID-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-288">The browser sends a GET to the Azure AD authorization endpoint to request an ID token.</span></span> <span data-ttu-id="cefca-289">Denna begäran innehåller program-ID och reply URL: en i Frågeparametrar.</span><span class="sxs-lookup"><span data-stu-id="cefca-289">This request includes the application ID and reply URL in the query parameters.</span></span>
4. <span data-ttu-id="cefca-290">Azure AD verifierar Reply-URL mot registrerade svars-URL: en som konfigurerats i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="cefca-290">Azure AD validates the Reply URL against the registered Reply URL that was configured in the Azure Portal.</span></span>
5. <span data-ttu-id="cefca-291">Användaren loggar in på sidan logga in.</span><span class="sxs-lookup"><span data-stu-id="cefca-291">The user signs in on the sign-in page.</span></span>
6. <span data-ttu-id="cefca-292">Om autentiseringen lyckas skapar en ID-token Azure AD och returneras som ett URL-fragment (#) till programmets Reply-URL.</span><span class="sxs-lookup"><span data-stu-id="cefca-292">If authentication is successful, Azure AD creates an ID token and returns it as a URL fragment (#) to the application’s Reply URL.</span></span> <span data-ttu-id="cefca-293">För ett produktionsprogram vara svars-URL: en HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cefca-293">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="cefca-294">Returnerade token innehåller anspråk om användaren och Azure AD som krävs av programmet för att validera token.</span><span class="sxs-lookup"><span data-stu-id="cefca-294">The returned token includes claims about the user and Azure AD that are required by the application to validate the token.</span></span>
7. <span data-ttu-id="cefca-295">JavaScript-klientkoden körs i webbläsaren extraherar token från svaret som ska användas i att skydda anrop till programmets web API tillbaka avslutas.</span><span class="sxs-lookup"><span data-stu-id="cefca-295">The JavaScript client code running in the browser extracts the token from the response to use in securing calls to the application’s web API back end.</span></span>
8. <span data-ttu-id="cefca-296">Webbläsaren anropar programmets webb-API: N tillbaka avslutas med åtkomst-token i auktoriseringshuvudet.</span><span class="sxs-lookup"><span data-stu-id="cefca-296">The browser calls the application’s web API back end with the access token in the authorization header.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="cefca-297">Kodexempel</span><span class="sxs-lookup"><span data-stu-id="cefca-297">Code Samples</span></span>
<span data-ttu-id="cefca-298">Se kodexempel för scenarier med enda sidan program (SPA).</span><span class="sxs-lookup"><span data-stu-id="cefca-298">See the code samples for Single Page Application (SPA) scenarios.</span></span> <span data-ttu-id="cefca-299">Se till att Kom tillbaka ofta – vi lägga till nya prov hela tiden.</span><span class="sxs-lookup"><span data-stu-id="cefca-299">Be sure to check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="cefca-300">[Enkel Page Application (SPA)](active-directory-code-samples.md#single-page-application-spa).</span><span class="sxs-lookup"><span data-stu-id="cefca-300">[Single Page Application (SPA)](active-directory-code-samples.md#single-page-application-spa).</span></span>

#### <a name="registering"></a><span data-ttu-id="cefca-301">Registrera</span><span class="sxs-lookup"><span data-stu-id="cefca-301">Registering</span></span>
* <span data-ttu-id="cefca-302">Enskild klient: Om du skapar ett program för din organisation, den måste registreras i företagets katalog med hjälp av Azure-portalen.</span><span class="sxs-lookup"><span data-stu-id="cefca-302">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using the Azure Portal.</span></span>
* <span data-ttu-id="cefca-303">Flera innehavare: Om du skapar ett program som kan användas av användare utanför organisationen, den måste vara registrerat i företagets katalog, men även måste registreras i varje organisations katalog som kommer att använda programmet.</span><span class="sxs-lookup"><span data-stu-id="cefca-303">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using the application.</span></span> <span data-ttu-id="cefca-304">Om du vill att ditt program finns i deras katalog, kan du inkludera en registreringsprocessen för dina kunder som gör det möjligt för dem att samtycka till ditt program.</span><span class="sxs-lookup"><span data-stu-id="cefca-304">To make your application available in their directory, you can include a sign-up process for your customers that enables them to consent to your application.</span></span> <span data-ttu-id="cefca-305">När de registrerar sig för ditt program, kommer de att visas en dialogruta som visar de behörigheter som krävs för programmet och sedan på alternativet för att godkänna.</span><span class="sxs-lookup"><span data-stu-id="cefca-305">When they sign up for your application, they will be presented with a dialog that shows the permissions the application requires, and then the option to consent.</span></span> <span data-ttu-id="cefca-306">Beroende på behörigheterna som krävs kan en administratör i den andra organisationen krävas för att ge ditt medgivande.</span><span class="sxs-lookup"><span data-stu-id="cefca-306">Depending on the required permissions, an administrator in the other organization may be required to give consent.</span></span> <span data-ttu-id="cefca-307">När användaren eller administratören godkänner, registreras programmet i sina kataloger.</span><span class="sxs-lookup"><span data-stu-id="cefca-307">When the user or administrator consents, the application is registered in their directory.</span></span> <span data-ttu-id="cefca-308">Mer information finns i [integrera program med Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="cefca-308">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

<span data-ttu-id="cefca-309">När du har registrerat programmet måste den konfigureras för att använda OAuth 2.0 Implicit Grant-protokollet.</span><span class="sxs-lookup"><span data-stu-id="cefca-309">After registering the application, it must be configured to use OAuth 2.0 Implicit Grant protocol.</span></span> <span data-ttu-id="cefca-310">Det här protokollet är inaktiverat för program som standard.</span><span class="sxs-lookup"><span data-stu-id="cefca-310">By default, this protocol is disabled for applications.</span></span> <span data-ttu-id="cefca-311">Redigera dess programmanifestet från Azure Portal och anger du ”oauth2AllowImplicitFlow”-värdet till true om du vill aktivera OAuth2 Implicit Grant-protokollet för ditt program.</span><span class="sxs-lookup"><span data-stu-id="cefca-311">To enable the OAuth2 Implicit Grant protocol for your application, edit its application manifest from the Azure Portal and set the “oauth2AllowImplicitFlow” value to true.</span></span> <span data-ttu-id="cefca-312">Detaljerade instruktioner finns [aktiverar OAuth 2.0 Implicit Grant för den enda sidan program](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="cefca-312">For detailed instructions, see [Enabling OAuth 2.0 Implicit Grant for Single Page Applications](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="cefca-313">Token upphör att gälla</span><span class="sxs-lookup"><span data-stu-id="cefca-313">Token Expiration</span></span>
<span data-ttu-id="cefca-314">När du använder ADAL.js för att hantera autentisering med Azure AD kan du dra nytta av flera funktioner som underlättar uppdatera en utgången token samt hämta token för ytterligare web API-resurser som kan anropas av programmet.</span><span class="sxs-lookup"><span data-stu-id="cefca-314">When you use ADAL.js to manage authentication with Azure AD, you benefit from several features that facilitate refreshing an expired token as well as getting tokens for additional web API resources that may be called by the application.</span></span> <span data-ttu-id="cefca-315">När användaren autentiseras korrekt med Azure AD, upprätta en session som skyddas av en cookie för användaren mellan webbläsaren och Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-315">When the user successfully authenticates with Azure AD, a session secured by a cookie is established for the user between the browser and Azure AD.</span></span> <span data-ttu-id="cefca-316">Det är viktigt att notera att sessionen finns mellan användare och Azure AD och inte mellan användaren och webbprogram som körs på servern.</span><span class="sxs-lookup"><span data-stu-id="cefca-316">It’s important to note that the session exists between the user and Azure AD and not between the user and the web application running on the server.</span></span> <span data-ttu-id="cefca-317">När en token upphör att gälla använder ADAL.js den här sessionen tyst få en annan token.</span><span class="sxs-lookup"><span data-stu-id="cefca-317">When a token expires, ADAL.js uses this session to silently obtain another token.</span></span> <span data-ttu-id="cefca-318">Detta sker med hjälp av en dold iFrame skicka och ta emot begäran med hjälp av OAuth Implicit Grant-protokollet.</span><span class="sxs-lookup"><span data-stu-id="cefca-318">It does this by using a hidden iFrame to send and receive the request using the OAuth Implicit Grant protocol.</span></span> <span data-ttu-id="cefca-319">ADAL.js kan också använda samma mekanism tyst hämta åtkomsttoken från Azure AD för andra web API-resurser att programmet anrop så länge dessa resurser stöder resursdelning för korsande ursprung (CORS) är registrerade i katalogen för den användaren och alla krävs godkännande har angetts av användaren under inloggning.</span><span class="sxs-lookup"><span data-stu-id="cefca-319">ADAL.js can also use this same mechanism to silently obtain access tokens from Azure AD for other web API resources that the application calls as long as these resources support cross-origin resource sharing (CORS), are registered in the user’s directory, and any required consent was given by the user during sign-in.</span></span>

### <a name="native-application-to-web-api"></a><span data-ttu-id="cefca-320">Det ursprungliga programmet i webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-320">Native Application to Web API</span></span>
<span data-ttu-id="cefca-321">Det här avsnittet beskrivs en programspecifika som anropar ett webb-API för en användares räkning.</span><span class="sxs-lookup"><span data-stu-id="cefca-321">This section describes a native application that calls a web API on behalf of a user.</span></span> <span data-ttu-id="cefca-322">Det här scenariot bygger på OAuth 2.0 auktorisering kodtypen bevilja med en offentlig klient enligt beskrivningen i avsnittet 4.1 i den [OAuth 2.0-specifikationen](http://tools.ietf.org/html/rfc6749).</span><span class="sxs-lookup"><span data-stu-id="cefca-322">This scenario is built on the OAuth 2.0 authorization code grant type with a public client, as described in section 4.1 of the [OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span></span> <span data-ttu-id="cefca-323">Det ursprungliga programmet hämtar en åtkomst-token för användaren med hjälp av OAuth 2.0-protokollet.</span><span class="sxs-lookup"><span data-stu-id="cefca-323">The native application obtains an access token for the user by using the OAuth 2.0 protocol.</span></span> <span data-ttu-id="cefca-324">Åtkomsttoken som sedan skickas i förfrågan till ditt webb-API som ger användaren och returnerar en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-324">This access token is then sent in the request to the web API, which authorizes the user and returns the desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="cefca-325">Diagram</span><span class="sxs-lookup"><span data-stu-id="cefca-325">Diagram</span></span>
![Det ursprungliga programmet för API-Diagram](./media/active-directory-authentication-scenarios/native_app_to_web_api.png)

#### <a name="authentication-flow-for-native-application-to-api"></a><span data-ttu-id="cefca-327">Autentiseringsflödet för det ursprungliga programmet till API: T</span><span class="sxs-lookup"><span data-stu-id="cefca-327">Authentication flow for native application to API</span></span>
#### <a name="description-of-protocol-flow"></a><span data-ttu-id="cefca-328">Beskrivning av protokollet flöde</span><span class="sxs-lookup"><span data-stu-id="cefca-328">Description of Protocol Flow</span></span>
<span data-ttu-id="cefca-329">Om du använder AD-Autentiseringsbibliotek hanteras de flesta av protokollet informationen som beskrivs nedan, till exempel popup-fönster i webbläsaren, tokencachelagring och hantering av uppdaterings-tokens.</span><span class="sxs-lookup"><span data-stu-id="cefca-329">If you are using the AD Authentication Libraries, most of the protocol details described below are handled for you, such as the browser pop-up, token caching, and handling of refresh tokens.</span></span>

1. <span data-ttu-id="cefca-330">Med en webbläsare som popup det ursprungliga programmet gör en begäran till slutpunkten för auktorisering i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-330">Using a browser pop-up, the native application makes a request to the authorization endpoint in Azure AD.</span></span> <span data-ttu-id="cefca-331">Denna begäran innehåller program-ID och omdirigerings-URI för det ursprungliga programmet som visas i Azure Portal och program-ID URI för webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-331">This request includes the Application ID and the redirect URI of the native application as shown in the Azure Portal, and the application ID URI for the web API.</span></span> <span data-ttu-id="cefca-332">Om användaren inte har redan är inloggad uppmanas de att logga in igen</span><span class="sxs-lookup"><span data-stu-id="cefca-332">If the user hasn’t already signed in, they are prompted to sign in again</span></span>
2. <span data-ttu-id="cefca-333">Azure AD autentiserar användaren.</span><span class="sxs-lookup"><span data-stu-id="cefca-333">Azure AD authenticates the user.</span></span> <span data-ttu-id="cefca-334">Om det är ett program med flera innehavare och medgivande som krävs för att använda programmet, måste användaren tillstånd om de inte redan gjort det..</span><span class="sxs-lookup"><span data-stu-id="cefca-334">If it is a multi-tenant application and consent is required to use the application, the user will be required to consent if they haven’t already done so.</span></span> <span data-ttu-id="cefca-335">Efter att godkänna och vid autentiseringen, utfärdar Azure AD en auktorisering kod svar tillbaka till klientprogrammets omdirigerings-URI.</span><span class="sxs-lookup"><span data-stu-id="cefca-335">After granting consent and upon successful authentication, Azure AD issues an authorization code response back to the client application’s redirect URI.</span></span>
3. <span data-ttu-id="cefca-336">När Azure AD utfärdar en auktorisering kod svar tillbaka till omdirigerings-URI, stoppar webbläsare interaktion klientprogrammet och extraherar Auktoriseringskoden från svaret.</span><span class="sxs-lookup"><span data-stu-id="cefca-336">When Azure AD issues an authorization code response back to the redirect URI, the client application stops browser interaction and extracts the authorization code from the response.</span></span> <span data-ttu-id="cefca-337">Med den här auktoriseringskod klientprogrammet skickar en begäran till tokenslutpunkten för Azure AD som innehåller Auktoriseringskoden, information om klientprogrammet (program-ID och omdirigerings-URI) och en resurs (program-ID URI för den webb-API).</span><span class="sxs-lookup"><span data-stu-id="cefca-337">Using this authorization code, the client application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
4. <span data-ttu-id="cefca-338">Auktoriseringskoden och information om klienten program och API: et verifieras av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-338">The authorization code and information about the client application and web API are validated by Azure AD.</span></span> <span data-ttu-id="cefca-339">När valideringen har lyckats, Azure AD returnerar två token: en JWT-åtkomsttoken och en uppdatering JWT-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-339">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span> <span data-ttu-id="cefca-340">Dessutom kan returnerar Azure AD grundläggande information om användare, till exempel deras visas namnet och klient-ID.</span><span class="sxs-lookup"><span data-stu-id="cefca-340">In addition, Azure AD returns basic information about the user, such as their display name and tenant ID.</span></span>
5. <span data-ttu-id="cefca-341">Via HTTPS använder klientprogrammet returnerade JWT åtkomsttoken att lägga till JWT-sträng med en ”ägar” beteckning i Authorization-huvud för begäran i webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-341">Over HTTPS, the client application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="cefca-342">Webb-API validerar JWT-token och om verifieringen lyckas, returnerar du en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-342">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>
6. <span data-ttu-id="cefca-343">När den åtkomst-token upphör att gälla kommer klientprogrammet ett felmeddelande som anger användaren måste autentiseras igen.</span><span class="sxs-lookup"><span data-stu-id="cefca-343">When the access token expires, the client application will receive an error that indicates the user needs to authenticate again.</span></span> <span data-ttu-id="cefca-344">Om programmet har en giltig uppdateringstoken kan användas den för att hämta en ny åtkomsttoken utan att användaren uppmanas att logga in igen.</span><span class="sxs-lookup"><span data-stu-id="cefca-344">If the application has a valid refresh token, it can be used to acquire a new access token without prompting the user to sign in again.</span></span> <span data-ttu-id="cefca-345">Om uppdateringstoken upphör att gälla, måste programmet att interaktivt autentisera användaren igen.</span><span class="sxs-lookup"><span data-stu-id="cefca-345">If the refresh token expires, the application will need to interactively authenticate the user once again.</span></span>

> [!NOTE]
> <span data-ttu-id="cefca-346">Den uppdateringstoken som utfärdats av Azure AD kan användas för åtkomst till flera resurser.</span><span class="sxs-lookup"><span data-stu-id="cefca-346">The refresh token issued by Azure AD can be used to access multiple resources.</span></span> <span data-ttu-id="cefca-347">Om du har ett klientprogram som har behörighet att anropa två webb-API: er, kan uppdateringstoken användas att hämta en åtkomst-token i den andra webben-API samt.</span><span class="sxs-lookup"><span data-stu-id="cefca-347">For example, if you have a client application that has permission to call two web APIs, the refresh token can be used to get an access token to the other web API as well.</span></span>
> 
> 

#### <a name="code-samples"></a><span data-ttu-id="cefca-348">Kodexempel</span><span class="sxs-lookup"><span data-stu-id="cefca-348">Code Samples</span></span>
<span data-ttu-id="cefca-349">Se kodexempel för programspecifika Web API-scenarier.</span><span class="sxs-lookup"><span data-stu-id="cefca-349">See the code samples for Native Application to Web API scenarios.</span></span> <span data-ttu-id="cefca-350">Och kom tillbaka ofta--vi lägga till nya prov hela tiden.</span><span class="sxs-lookup"><span data-stu-id="cefca-350">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="cefca-351">[Det ursprungliga programmet i webb-API](active-directory-code-samples.md#native-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="cefca-351">[Native Application to Web API](active-directory-code-samples.md#native-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="cefca-352">Registrera</span><span class="sxs-lookup"><span data-stu-id="cefca-352">Registering</span></span>
* <span data-ttu-id="cefca-353">Enskild klient: Både överordnade länkens interna program och webb-API som måste registreras i samma katalog i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-353">Single Tenant: Both the native application and the web API must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="cefca-354">Webb-API kan konfigureras för att exponera en uppsättning behörigheter som används för att begränsa interna programmet åtkomst till resurser.</span><span class="sxs-lookup"><span data-stu-id="cefca-354">The web API can be configured to expose a set of permissions, which are used to limit the native application’s access to its resources.</span></span> <span data-ttu-id="cefca-355">Klientprogrammet sedan markerar du önskade behörigheter från listrutan ”behörigheter till andra program” i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="cefca-355">The client application then selects the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span>
* <span data-ttu-id="cefca-356">Flera innehavare: Först det ursprungliga programmet bara registrerad i utvecklaren eller utgivarens katalog.</span><span class="sxs-lookup"><span data-stu-id="cefca-356">Multi-Tenant: First, the native application only ever registered in the developer or publisher’s directory.</span></span> <span data-ttu-id="cefca-357">Andra har till det ursprungliga programmet konfigurerats för att ange de behörigheter som krävs för att fungera korrekt.</span><span class="sxs-lookup"><span data-stu-id="cefca-357">Second, the native application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="cefca-358">Den här listan med behörigheter som krävs visas i en dialogruta när en användare eller administratör i målmappen ger du ditt medgivande till programmet, vilket gör den tillgänglig för organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-358">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="cefca-359">Vissa program kräver bara användarnivå behörigheter som kan godkänna alla användare i organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-359">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="cefca-360">Andra applikationer kräver på administratörsnivå som en användare i organisationen inte kan samtycka till.</span><span class="sxs-lookup"><span data-stu-id="cefca-360">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="cefca-361">Endast directory-administratören kan ge ditt medgivande till program som kräver den här nivån av behörigheter.</span><span class="sxs-lookup"><span data-stu-id="cefca-361">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="cefca-362">När användaren eller administratören godkänner, registreras endast webb-API i sina kataloger.</span><span class="sxs-lookup"><span data-stu-id="cefca-362">When the user or administrator consents, only the web API is registered in their directory.</span></span> <span data-ttu-id="cefca-363">Mer information finns i [integrera program med Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="cefca-363">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="cefca-364">Token upphör att gälla</span><span class="sxs-lookup"><span data-stu-id="cefca-364">Token Expiration</span></span>
<span data-ttu-id="cefca-365">När det ursprungliga programmet använder dess auktoriseringskod för att hämta en JWT åtkomsttoken, emot tas även en uppdatering JWT-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-365">When the native application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="cefca-366">Uppdateringstoken som kan användas för att autentisera användaren igen utan att de behöver logga in igen när den åtkomst-token upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="cefca-366">When the access token expires, the refresh token can be used to re-authenticate the user without requiring them to sign in again.</span></span> <span data-ttu-id="cefca-367">Den här uppdateringstoken används sedan för att autentisera användaren, vilket leder till en ny åtkomsttoken och uppdateringstoken.</span><span class="sxs-lookup"><span data-stu-id="cefca-367">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

### <a name="web-application-to-web-api"></a><span data-ttu-id="cefca-368">Webbprogram i webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-368">Web Application to Web API</span></span>
<span data-ttu-id="cefca-369">Det här avsnittet beskrivs ett webbprogram som behöver få resurser från ett webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-369">This section describes a web application that needs to get resources from a web API.</span></span> <span data-ttu-id="cefca-370">I det här scenariot är två identitetstyper som webbprogrammet kan använda för att autentisera och anropa webb-API: en Programidentitet eller en delegerad användaridentitet.</span><span class="sxs-lookup"><span data-stu-id="cefca-370">In this scenario, there are two identity types that the web application can use to authenticate and call the web API: an application identity, or a delegated user identity.</span></span>

<span data-ttu-id="cefca-371">*Tillämpningsprogrammets identitet:* det här scenariot använder OAuth 2.0 klientens autentiseringsuppgifter bevilja att autentisera som programmet och få åtkomst till webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-371">*Application identity:* This scenario uses OAuth 2.0 client credentials grant to authenticate as the application and access the web API.</span></span> <span data-ttu-id="cefca-372">När du använder en Programidentitet, webb-API kan endast upptäcka att webbprogrammet anropar den, som webb får API inte någon information om användaren.</span><span class="sxs-lookup"><span data-stu-id="cefca-372">When using an application identity, the web API can only detect that the web application is calling it, as the web API does not receive any information about the user.</span></span> <span data-ttu-id="cefca-373">Om programmet får information om användaren kan skickas via programprotokollet och den inte är signerad av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-373">If the application receives information about the user, it will be sent via the application protocol, and it is not signed by Azure AD.</span></span> <span data-ttu-id="cefca-374">Webb-API förtroenden att webbprogrammet autentiserade användaren.</span><span class="sxs-lookup"><span data-stu-id="cefca-374">The web API trusts that the web application authenticated the user.</span></span> <span data-ttu-id="cefca-375">Därför kan kallas det här mönstret betrodda undersystemet.</span><span class="sxs-lookup"><span data-stu-id="cefca-375">For this reason, this pattern is called a trusted subsystem.</span></span>

<span data-ttu-id="cefca-376">*Delegerad användaridentitet:* det här scenariot kan utföras på två sätt: OpenID Connect och OAuth 2.0 auktorisering kod bevilja en konfidentiell klient.</span><span class="sxs-lookup"><span data-stu-id="cefca-376">*Delegated user identity:* This scenario can be accomplished in two ways: OpenID Connect, and OAuth 2.0 authorization code grant with a confidential client.</span></span> <span data-ttu-id="cefca-377">Webbprogrammet hämtar en åtkomsttoken för den användaren, vilket bevisar för webb-API som användaren har autentiserats till webbprogrammet och att webbprogrammet kunde erhålla en delegerad användaridentitet för att anropa webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-377">The web application obtains an access token for the user, which proves to the web API that the user successfully authenticated to the web application and that the web application was able to obtain a delegated user identity to call the web API.</span></span> <span data-ttu-id="cefca-378">Åtkomsttoken skickas i förfrågan till ditt webb-API som ger användaren och returnerar en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-378">This access token is sent in the request to the web API, which authorizes the user and returns the desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="cefca-379">Diagram</span><span class="sxs-lookup"><span data-stu-id="cefca-379">Diagram</span></span>
![Webbprogram i Web API-diagram](./media/active-directory-authentication-scenarios/web_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="cefca-381">Beskrivning av protokollet flöde</span><span class="sxs-lookup"><span data-stu-id="cefca-381">Description of Protocol Flow</span></span>
<span data-ttu-id="cefca-382">Både Programidentitet och delegerade identitet användartyper diskuteras nedan flödet.</span><span class="sxs-lookup"><span data-stu-id="cefca-382">Both the application identity and delegated user identity types are discussed in the flow below.</span></span> <span data-ttu-id="cefca-383">Den viktigaste skillnaden mellan dem är att delegerad användaridentiteten först skaffa ett auktoriseringskod innan användaren kan logga in och få åtkomst till webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-383">The key difference between them is that the delegated user identity must first acquire an authorization code before the user can sign-in and gain access to the web API.</span></span>

##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="cefca-384">Tillämpningsprogrammets identitet med OAuth 2.0-klienten autentiseringsuppgifter bevilja</span><span class="sxs-lookup"><span data-stu-id="cefca-384">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="cefca-385">En användare är inloggad i Azure AD i webbprogrammet (finns i [webbläsare till webbprogrammet](#web-browser-to-web-application) ovan).</span><span class="sxs-lookup"><span data-stu-id="cefca-385">A user is signed in to Azure AD in the web application (see the [Web Browser to Web Application](#web-browser-to-web-application) above).</span></span>
2. <span data-ttu-id="cefca-386">Webbprogrammet måste få en åtkomst-token så att den kan autentisera till webb-API och hämta en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-386">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span></span> <span data-ttu-id="cefca-387">Den gör en begäran till tokenslutpunkten för Azure AD, att tillhandahålla autentiseringsuppgifter, program-ID och API: er webbprogrammet ID URI.</span><span class="sxs-lookup"><span data-stu-id="cefca-387">It makes a request to Azure AD’s token endpoint, providing the credential, Application ID, and web API’s application ID URI.</span></span>
3. <span data-ttu-id="cefca-388">Azure AD autentiserar programmet och returnerar en JWT åtkomst-token som används för att anropa webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-388">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
4. <span data-ttu-id="cefca-389">Via HTTPS används webbprogrammet returnerade JWT åtkomsttoken att lägga till JWT-sträng med en ”ägar” beteckning i Authorization-huvud i begäran webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-389">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="cefca-390">Webb-API validerar JWT-token och om verifieringen lyckas, returnerar du en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-390">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-openid-connect"></a><span data-ttu-id="cefca-391">Delegerad användaridentiteter med OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="cefca-391">Delegated User Identity with OpenID Connect</span></span>
1. <span data-ttu-id="cefca-392">En användare är inloggad på ett webbprogram med hjälp av Azure AD (finns i [webbläsare till webbprogrammet](#web-browser-to-web-application) ovan).</span><span class="sxs-lookup"><span data-stu-id="cefca-392">A user is signed in to a web application using Azure AD (see the [Web Browser to Web Application](#web-browser-to-web-application) section above).</span></span> <span data-ttu-id="cefca-393">Om användaren av webbprogrammet inte har ännu godkänt för att tillåta att webbprogrammet anropa webb-API i dess ställe, måste användaren att godkänna.</span><span class="sxs-lookup"><span data-stu-id="cefca-393">If the user of the web application has not yet consented to allowing the web application to call the web API on its behalf, the user will need to consent.</span></span> <span data-ttu-id="cefca-394">Programmet visas de behörigheter som krävs och om någon av dessa finns på administratörsnivå normal användare i katalogen inte kommer att kunna godkänna.</span><span class="sxs-lookup"><span data-stu-id="cefca-394">The application will display the permissions it requires, and if any of these are administrator-level permissions, a normal user in the directory will not be able to consent.</span></span> <span data-ttu-id="cefca-395">Medgivande processen gäller bara för program med flera klienter, inte en organisation program som programmet redan har behörigheterna som krävs.</span><span class="sxs-lookup"><span data-stu-id="cefca-395">This consent process only applies to multi-tenant applications, not single tenant applications, as the application will already have the necessary permissions.</span></span> <span data-ttu-id="cefca-396">När användaren är inloggad webbprogrammet tog emot en ID-token med information om användaren, samt en Auktoriseringskoden.</span><span class="sxs-lookup"><span data-stu-id="cefca-396">When the user signed in, the web application received an ID token with information about the user, as well as an authorization code.</span></span>
2. <span data-ttu-id="cefca-397">Med auktoriseringskod som utfärdats av Azure AD skickar webbprogrammet en begäran till tokenslutpunkten för Azure AD som innehåller Auktoriseringskoden information om klientprogrammet (program-ID och omdirigerings-URI) och en resurs (program-ID URI för webb-API).</span><span class="sxs-lookup"><span data-stu-id="cefca-397">Using the authorization code issued by Azure AD, the web application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
3. <span data-ttu-id="cefca-398">Auktoriseringskoden och information om webbprogram och webb-API verifieras av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-398">The authorization code and information about the web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="cefca-399">När valideringen har lyckats, Azure AD returnerar två token: en JWT-åtkomsttoken och en uppdatering JWT-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-399">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
4. <span data-ttu-id="cefca-400">Via HTTPS används webbprogrammet returnerade JWT åtkomsttoken att lägga till JWT-sträng med en ”ägar” beteckning i Authorization-huvud i begäran webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-400">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="cefca-401">Webb-API validerar JWT-token och om verifieringen lyckas, returnerar du en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-401">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-authorization-code-grant"></a><span data-ttu-id="cefca-402">Delegerad användaridentiteter med OAuth 2.0 Authorization kod Grant</span><span class="sxs-lookup"><span data-stu-id="cefca-402">Delegated User Identity with OAuth 2.0 Authorization Code Grant</span></span>
1. <span data-ttu-id="cefca-403">En användare har redan loggat in till ett webbprogram vars autentiseringsmekanism är oberoende av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-403">A user is already signed in to a web application, whose authentication mechanism is independent of Azure AD.</span></span>
2. <span data-ttu-id="cefca-404">Webbprogrammet kräver en auktoriseringskod att förvärva en åtkomst-token så att den skickar en begäran via webbläsaren till Azure AD autentiseringsslutpunkt att tillhandahålla det program-ID och omdirigerings-URI för webbprogrammet efter en lyckad autentisering.</span><span class="sxs-lookup"><span data-stu-id="cefca-404">The web application requires an authorization code to acquire an access token, so it issues a request through the browser to Azure AD’s authorization endpoint, providing the Application ID and redirect URI for the web application after successful authentication.</span></span> <span data-ttu-id="cefca-405">Användaren loggar in på Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-405">The user signs in to Azure AD.</span></span>
3. <span data-ttu-id="cefca-406">Om användaren av webbprogrammet inte har ännu godkänt för att tillåta att webbprogrammet anropa webb-API i dess ställe, måste användaren att godkänna.</span><span class="sxs-lookup"><span data-stu-id="cefca-406">If the user of the web application has not yet consented to allowing the web application to call the web API on its behalf, the user will need to consent.</span></span> <span data-ttu-id="cefca-407">Programmet visas de behörigheter som krävs och om någon av dessa finns på administratörsnivå normal användare i katalogen inte kommer att kunna godkänna.</span><span class="sxs-lookup"><span data-stu-id="cefca-407">The application will display the permissions it requires, and if any of these are administrator-level permissions, a normal user in the directory will not be able to consent.</span></span> <span data-ttu-id="cefca-408">Den här medgivande gäller både enkla och flera innehavare program.</span><span class="sxs-lookup"><span data-stu-id="cefca-408">This consent applies to both single and multi-tenant application.</span></span>  <span data-ttu-id="cefca-409">Om en organisation kan administratör utföra admin medgivande medgivande åt sina användare.</span><span class="sxs-lookup"><span data-stu-id="cefca-409">In the single tenant case, an admin can perform admin consent to consent on behalf of their users.</span></span>  <span data-ttu-id="cefca-410">Detta kan göras med hjälp av den `Grant Permissions` knappen i den [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="cefca-410">This can be done using the `Grant Permissions` button in the [Azure Portal](https://portal.azure.com).</span></span> 
4. <span data-ttu-id="cefca-411">När användaren har godkänt får webbprogrammet Auktoriseringskoden som behöver få åtkomst-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-411">After the user has consented, the web application receives the authorization code that it needs to acquire an access token.</span></span>
5. <span data-ttu-id="cefca-412">Med auktoriseringskod som utfärdats av Azure AD skickar webbprogrammet en begäran till tokenslutpunkten för Azure AD som innehåller Auktoriseringskoden information om klientprogrammet (program-ID och omdirigerings-URI) och en resurs (program-ID URI för webb-API).</span><span class="sxs-lookup"><span data-stu-id="cefca-412">Using the authorization code issued by Azure AD, the web application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
6. <span data-ttu-id="cefca-413">Auktoriseringskoden och information om webbprogram och webb-API verifieras av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-413">The authorization code and information about the web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="cefca-414">När valideringen har lyckats, Azure AD returnerar två token: en JWT-åtkomsttoken och en uppdatering JWT-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-414">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
7. <span data-ttu-id="cefca-415">Via HTTPS används webbprogrammet returnerade JWT åtkomsttoken att lägga till JWT-sträng med en ”ägar” beteckning i Authorization-huvud i begäran webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-415">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="cefca-416">Webb-API validerar JWT-token och om verifieringen lyckas, returnerar du en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-416">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="cefca-417">Kodexempel</span><span class="sxs-lookup"><span data-stu-id="cefca-417">Code Samples</span></span>
<span data-ttu-id="cefca-418">Se kodexempel för webbprogram för Web API-scenarier.</span><span class="sxs-lookup"><span data-stu-id="cefca-418">See the code samples for Web Application to Web API scenarios.</span></span> <span data-ttu-id="cefca-419">Och kom tillbaka ofta--vi lägga till nya prov hela tiden.</span><span class="sxs-lookup"><span data-stu-id="cefca-419">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="cefca-420">Web [programmet till webb-API](active-directory-code-samples.md#web-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="cefca-420">Web [Application to Web API](active-directory-code-samples.md#web-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="cefca-421">Registrera</span><span class="sxs-lookup"><span data-stu-id="cefca-421">Registering</span></span>
* <span data-ttu-id="cefca-422">Enskild klient: För både Programidentitet och delegerad användare identitet fall kan webbprogrammet och webb-API måste registreras i samma katalog i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-422">Single Tenant: For both the application identity and delegated user identity cases, the web application and the web API must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="cefca-423">Webb-API kan konfigureras för att exponera en uppsättning behörigheter som används för att begränsa webbprogrammets åtkomst till resurser.</span><span class="sxs-lookup"><span data-stu-id="cefca-423">The web API can be configured to expose a set of permissions, which are used to limit the web application’s access to its resources.</span></span> <span data-ttu-id="cefca-424">Om en delegerad användaridentitetstypen används måste webbprogrammet du välja önskad behörigheter från listrutan ”behörigheter till andra program” i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="cefca-424">If a delegated user identity type is being used, the web application needs to select the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span> <span data-ttu-id="cefca-425">Det här steget är inte nödvändigt om identitetstyp programmet används.</span><span class="sxs-lookup"><span data-stu-id="cefca-425">This step is not required if the application identity type is being used.</span></span>
* <span data-ttu-id="cefca-426">Flera innehavare: Först webbprogrammet har konfigurerats för att ange de behörigheter som krävs för att fungera korrekt.</span><span class="sxs-lookup"><span data-stu-id="cefca-426">Multi-Tenant: First, the web application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="cefca-427">Den här listan med behörigheter som krävs visas i en dialogruta när en användare eller administratör i målmappen ger du ditt medgivande till programmet, vilket gör den tillgänglig för organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-427">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="cefca-428">Vissa program kräver bara användarnivå behörigheter som kan godkänna alla användare i organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-428">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="cefca-429">Andra applikationer kräver på administratörsnivå som en användare i organisationen inte kan samtycka till.</span><span class="sxs-lookup"><span data-stu-id="cefca-429">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="cefca-430">Endast directory-administratören kan ge ditt medgivande till program som kräver den här nivån av behörigheter.</span><span class="sxs-lookup"><span data-stu-id="cefca-430">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="cefca-431">När användaren eller administratören godkänner, registreras webbprogrammet och webb-API både i sina kataloger.</span><span class="sxs-lookup"><span data-stu-id="cefca-431">When the user or administrator consents, the web application and the web API are both registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="cefca-432">Token upphör att gälla</span><span class="sxs-lookup"><span data-stu-id="cefca-432">Token Expiration</span></span>
<span data-ttu-id="cefca-433">När webbprogrammet använder dess auktoriseringskod för att hämta en JWT åtkomsttoken, emot tas även en uppdatering JWT-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-433">When the web application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="cefca-434">Uppdateringstoken som kan användas för att autentisera användaren igen utan att de behöver logga in igen när den åtkomst-token upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="cefca-434">When the access token expires, the refresh token can be used to re-authenticate the user without requiring them to sign in again.</span></span> <span data-ttu-id="cefca-435">Den här uppdateringstoken används sedan för att autentisera användaren, vilket leder till en ny åtkomsttoken och uppdateringstoken.</span><span class="sxs-lookup"><span data-stu-id="cefca-435">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

### <a name="daemon-or-server-application-to-web-api"></a><span data-ttu-id="cefca-436">Daemon eller Server-program till webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-436">Daemon or Server Application to Web API</span></span>
<span data-ttu-id="cefca-437">Det här avsnittet beskrivs ett daemon eller server-program som behöver få resurser från ett webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-437">This section describes a daemon or server application that needs to get resources from a web API.</span></span> <span data-ttu-id="cefca-438">Det finns två underordnade scenarier som gäller för det här avsnittet: en daemon som måste anropa ett webb-API som bygger på OAuth 2.0 autentiseringsuppgifter bevilja klienttyp; och ett serverprogram (till exempel ett webb-API) som måste anropa ett webb-API som bygger på OAuth 2.0 On-Behalf-Of utkast till en specifikation.</span><span class="sxs-lookup"><span data-stu-id="cefca-438">There are two sub-scenarios that apply to this section: A daemon that needs to call a web API, built on OAuth 2.0 client credentials grant type; and a server application (such as a web API) that needs to call a web API, built on OAuth 2.0 On-Behalf-Of draft specification.</span></span>

<span data-ttu-id="cefca-439">För scenariot när en daemon programmet behöver anropa ett webb-API, är det viktigt att förstå några saker.</span><span class="sxs-lookup"><span data-stu-id="cefca-439">For the scenario when a daemon application needs to call a web API, it’s important to understand a few things.</span></span> <span data-ttu-id="cefca-440">Först är interaktion från användaren inte möjligt med ett daemon-program som kräver att applikationen har sin egen identitet.</span><span class="sxs-lookup"><span data-stu-id="cefca-440">First, user interaction is not possible with a daemon application, which requires the application to have its own identity.</span></span> <span data-ttu-id="cefca-441">Ett exempel på en daemon-program är batchjobb eller en tjänst i operativsystemet som körs i bakgrunden.</span><span class="sxs-lookup"><span data-stu-id="cefca-441">An example of a daemon application is a batch job, or an operating system service running in the background.</span></span> <span data-ttu-id="cefca-442">Den här typen av program begär en åtkomst-token med hjälp av dess Programidentitet och presentera dess program-ID och autentiseringsuppgifter (lösenordet eller certifikatet) program-ID URI till Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-442">This type of application requests an access token by using its application identity and presenting its Application ID, credential (password or certificate), and application ID URI to Azure AD.</span></span> <span data-ttu-id="cefca-443">Efter en lyckad autentisering får daemon en åtkomst-token från Azure AD, som sedan används för att anropa webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-443">After successful authentication, the daemon receives an access token from Azure AD, which is then used to call the web API.</span></span>

<span data-ttu-id="cefca-444">För scenariot när ett serverprogram måste anropa ett webb-API, är det bra att använda ett exempel.</span><span class="sxs-lookup"><span data-stu-id="cefca-444">For the scenario when a server application needs to call a web API, it’s helpful to use an example.</span></span> <span data-ttu-id="cefca-445">Anta att en användare har autentiserats på det ursprungliga programmet och interna programmet behöver anropa ett webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-445">Imagine that a user has authenticated on a native application, and this native application needs to call a web API.</span></span> <span data-ttu-id="cefca-446">Azure AD utfärdar en JWT åtkomsttoken att anropa webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-446">Azure AD issues a JWT access token to call the web API.</span></span> <span data-ttu-id="cefca-447">Om webb-API måste anropa ett annat underordnat webb-API, använda den on-behalf-of-flöde för att delegera användarens identitet och autentisera till andra nivån webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-447">If the web API needs to call another downstream web API, it can use the on-behalf-of flow to delegate the user’s identity and authenticate to the second-tier web API.</span></span>

#### <a name="diagram"></a><span data-ttu-id="cefca-448">Diagram</span><span class="sxs-lookup"><span data-stu-id="cefca-448">Diagram</span></span>
![Daemon eller serverprogrammet Web API-diagram](./media/active-directory-authentication-scenarios/daemon_server_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="cefca-450">Beskrivning av protokollet flöde</span><span class="sxs-lookup"><span data-stu-id="cefca-450">Description of Protocol Flow</span></span>
##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="cefca-451">Tillämpningsprogrammets identitet med OAuth 2.0-klienten autentiseringsuppgifter bevilja</span><span class="sxs-lookup"><span data-stu-id="cefca-451">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="cefca-452">Serverprogrammet måste först autentisera med Azure AD som själva, utan att någon mänsklig interaktion, till exempel en dialogruta för interaktiv inloggning.</span><span class="sxs-lookup"><span data-stu-id="cefca-452">First, the server application needs to authenticate with Azure AD as itself, without any human interaction such as an interactive sign-on dialog.</span></span> <span data-ttu-id="cefca-453">Den gör en begäran till tokenslutpunkten för Azure AD, att tillhandahålla autentiseringsuppgifter, program-ID och program-ID-URI.</span><span class="sxs-lookup"><span data-stu-id="cefca-453">It makes a request to Azure AD’s token endpoint, providing the credential, Application ID, and application ID URI.</span></span>
2. <span data-ttu-id="cefca-454">Azure AD autentiserar programmet och returnerar en JWT åtkomst-token som används för att anropa webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-454">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
3. <span data-ttu-id="cefca-455">Via HTTPS används webbprogrammet returnerade JWT åtkomsttoken att lägga till JWT-sträng med en ”ägar” beteckning i Authorization-huvud i begäran webb-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-455">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="cefca-456">Webb-API validerar JWT-token och om verifieringen lyckas, returnerar du en resurs.</span><span class="sxs-lookup"><span data-stu-id="cefca-456">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-on-behalf-of-draft-specification"></a><span data-ttu-id="cefca-457">Delegerad användaridentiteter med OAuth 2.0-specifikationen för On-Behalf-Of utkast</span><span class="sxs-lookup"><span data-stu-id="cefca-457">Delegated User Identity with OAuth 2.0 On-Behalf-Of Draft Specification</span></span>
<span data-ttu-id="cefca-458">Flödet beskrivs nedan förutsätter att en användare har autentiserats på ett annat program (till exempel programspecifika) och deras användar-ID som har använts för att erhålla en åtkomst-token i den första nivån webben-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-458">The flow discussed below assumes that a user has been authenticated on another application (such as a native application), and their user identity has been used to acquire an access token to the first-tier web API.</span></span>

1. <span data-ttu-id="cefca-459">Det ursprungliga programmet skickar den åtkomst-token till den första nivån webben-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-459">The native application sends the access token to the first-tier web API.</span></span>
2. <span data-ttu-id="cefca-460">Den första nivån webben-API skickar en begäran till tokenslutpunkten för Azure AD, tillhandahåller dess program-ID och autentiseringsuppgifter, samt användarens åtkomsttoken.</span><span class="sxs-lookup"><span data-stu-id="cefca-460">The first-tier web API sends a request to Azure AD’s token endpoint, providing its Application ID and credentials, as well as the user’s access token.</span></span> <span data-ttu-id="cefca-461">Dessutom begäran skickas med en on_behalf_of parameter som anger web API begär nya tokens för att anropa en underordnad webb-API för den ursprungliga användaren.</span><span class="sxs-lookup"><span data-stu-id="cefca-461">In addition, the request is sent with an on_behalf_of parameter that indicates the web API is requesting new tokens to call a downstream web API on behalf of the original user.</span></span>
3. <span data-ttu-id="cefca-462">Azure AD verifierar att den första nivån webben-API har åtkomstbehörighet till den andra nivån webben-API och verifierar begäran returnerar en JWT-åtkomsttoken och en JWT uppdatera token i den första nivån webben-API.</span><span class="sxs-lookup"><span data-stu-id="cefca-462">Azure AD verifies that the first-tier web API has permissions to access the second-tier web API and validates the request, returning a JWT access token and a JWT refresh token to the first-tier web API.</span></span>
4. <span data-ttu-id="cefca-463">Via HTTPS anropar den första nivån web API andra nivån webb-API genom att lägga till token strängen i Authorization-huvud i begäran.</span><span class="sxs-lookup"><span data-stu-id="cefca-463">Over HTTPS, the first-tier web API then calls the second-tier web API by appending the token string in the Authorization header in the request.</span></span> <span data-ttu-id="cefca-464">Den första nivån webben-API kan fortsätta att anropa den andra nivån webben-API som åtkomst-token och uppdateringstoken är giltiga.</span><span class="sxs-lookup"><span data-stu-id="cefca-464">The first-tier web API can continue to call the second-tier web API as long as the access token and refresh tokens are valid.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="cefca-465">Kodexempel</span><span class="sxs-lookup"><span data-stu-id="cefca-465">Code Samples</span></span>
<span data-ttu-id="cefca-466">Se kodexempel för Daemon eller serverprogrammet Web API-scenarier.</span><span class="sxs-lookup"><span data-stu-id="cefca-466">See the code samples for Daemon or Server Application to Web API scenarios.</span></span> <span data-ttu-id="cefca-467">Och kom tillbaka ofta--vi lägga till nya prov hela tiden.</span><span class="sxs-lookup"><span data-stu-id="cefca-467">And, check back frequently -- we add new samples all the time.</span></span> [<span data-ttu-id="cefca-468">Servern eller Daemon programmet till webb-API</span><span class="sxs-lookup"><span data-stu-id="cefca-468">Server or Daemon Application to Web API</span></span>](active-directory-code-samples.md#server-or-daemon-application-to-web-api)

#### <a name="registering"></a><span data-ttu-id="cefca-469">Registrera</span><span class="sxs-lookup"><span data-stu-id="cefca-469">Registering</span></span>
* <span data-ttu-id="cefca-470">Enskild klient: För både Programidentitet och delegerad användare identitet fall, daemon eller server-programmet måste registreras i samma katalog i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cefca-470">Single Tenant: For both the application identity and delegated user identity cases, the daemon or server application must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="cefca-471">Webb-API kan konfigureras för att exponera en uppsättning behörigheter som används för att begränsa daemon eller serveråtkomst till dess resurser.</span><span class="sxs-lookup"><span data-stu-id="cefca-471">The web API can be configured to expose a set of permissions, which are used to limit the daemon or server’s access to its resources.</span></span> <span data-ttu-id="cefca-472">Om en delegerad användaridentitetstypen används måste serverprogrammet Välj önskade behörigheter från listrutan ”behörigheter till andra program” i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="cefca-472">If a delegated user identity type is being used, the server application needs to select the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span> <span data-ttu-id="cefca-473">Det här steget är inte nödvändigt om identitetstyp programmet används.</span><span class="sxs-lookup"><span data-stu-id="cefca-473">This step is not required if the application identity type is being used.</span></span>
* <span data-ttu-id="cefca-474">Flera innehavare: Först programmet daemon eller server har konfigurerats för att ange de behörigheter som krävs för att fungera korrekt.</span><span class="sxs-lookup"><span data-stu-id="cefca-474">Multi-Tenant: First, the daemon or server application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="cefca-475">Den här listan med behörigheter som krävs visas i en dialogruta när en användare eller administratör i målmappen ger du ditt medgivande till programmet, vilket gör den tillgänglig för organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-475">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="cefca-476">Vissa program kräver bara användarnivå behörigheter som kan godkänna alla användare i organisationen.</span><span class="sxs-lookup"><span data-stu-id="cefca-476">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="cefca-477">Andra applikationer kräver på administratörsnivå som en användare i organisationen inte kan samtycka till.</span><span class="sxs-lookup"><span data-stu-id="cefca-477">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="cefca-478">Endast directory-administratören kan ge ditt medgivande till program som kräver den här nivån av behörigheter.</span><span class="sxs-lookup"><span data-stu-id="cefca-478">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="cefca-479">När användaren eller administratören godkänner, är både web API: er registrerade i sina kataloger.</span><span class="sxs-lookup"><span data-stu-id="cefca-479">When the user or administrator consents, both of the web APIs are registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="cefca-480">Token upphör att gälla</span><span class="sxs-lookup"><span data-stu-id="cefca-480">Token Expiration</span></span>
<span data-ttu-id="cefca-481">När det första programmet använder dess auktoriseringskod för att hämta en JWT åtkomsttoken, emot tas även en uppdatering JWT-token.</span><span class="sxs-lookup"><span data-stu-id="cefca-481">When the first application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="cefca-482">Uppdateringstoken som kan användas för att autentisera användaren igen utan att fråga efter autentiseringsuppgifter när den åtkomst-token upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="cefca-482">When the access token expires, the refresh token can be used to re-authenticate the user without prompting for credentials.</span></span> <span data-ttu-id="cefca-483">Den här uppdateringstoken används sedan för att autentisera användaren, vilket leder till en ny åtkomsttoken och uppdateringstoken.</span><span class="sxs-lookup"><span data-stu-id="cefca-483">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

## <a name="see-also"></a><span data-ttu-id="cefca-484">Se även</span><span class="sxs-lookup"><span data-stu-id="cefca-484">See Also</span></span>
[<span data-ttu-id="cefca-485">Azure Active Directory-Guide för utvecklare</span><span class="sxs-lookup"><span data-stu-id="cefca-485">Azure Active Directory Developer's Guide</span></span>](active-directory-developers-guide.md)

[<span data-ttu-id="cefca-486">Azure Active Directory-kodexempel</span><span class="sxs-lookup"><span data-stu-id="cefca-486">Azure Active Directory Code Samples</span></span>](active-directory-code-samples.md)

[<span data-ttu-id="cefca-487">Viktig Information om att signera nyckelförnyelse i Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-487">Important Information About Signing Key Rollover in Azure AD</span></span>](active-directory-signing-key-rollover.md)

[<span data-ttu-id="cefca-488">OAuth 2.0 i Azure AD</span><span class="sxs-lookup"><span data-stu-id="cefca-488">OAuth 2.0 in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn645545.aspx)

