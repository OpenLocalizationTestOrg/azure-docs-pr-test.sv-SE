---
title: "aaaHow toobuild en app som kan logga in alla Azure AD-användare | Microsoft Docs"
description: "Stegvisa kan anvisningar för att skapa ett program som logga in en användare från en Azure Active Directory-klient, även kallat ett program med flera innehavare."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 123ea8125fa3c308ce0f124cc58e85ec28d476d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="how-toosign-in-any-azure-active-directory-ad-user-using-hello-multi-tenant-application-pattern"></a><span data-ttu-id="bcf91-103">Hur toosign i alla Azure Active Directory (AD) användaren med hello programmönster för flera innehavare</span><span class="sxs-lookup"><span data-stu-id="bcf91-103">How toosign in any Azure Active Directory (AD) user using hello multi-tenant application pattern</span></span>
<span data-ttu-id="bcf91-104">Om du tillhandahåller en programvara som en tjänst programmet toomany organisationer bör konfigurera du ditt program tooaccept inloggningar från Azure AD-klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-104">If you offer a Software as a Service application toomany organizations, you can configure your application tooaccept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="bcf91-105">Detta kallas att göra ditt program med flera innehavare i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="bcf91-106">Användare i Azure AD-klient ska kunna toosign i tooyour program efter principer toouse sitt konto med ditt program.</span><span class="sxs-lookup"><span data-stu-id="bcf91-106">Users in any Azure AD tenant will be able toosign in tooyour application after consenting toouse their account with your application.</span></span>  

<span data-ttu-id="bcf91-107">Om du har ett befintligt program som har ett eget konto eller andra typer av logga in från andra molntjänstleverantörer av har stöd för är att lägga till Azure AD-inloggning från en klient enkelt.</span><span class="sxs-lookup"><span data-stu-id="bcf91-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="bcf91-108">Bara registrera din app, Lägg till kod logga in via OAuth2, OpenID Connect eller SAML och placera en ”logga In med Microsoft”-knappen i ditt program.</span><span class="sxs-lookup"><span data-stu-id="bcf91-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="bcf91-109">Klicka på följande knapp toolearn mer om anpassning av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="bcf91-109">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="bcf91-110">[! [Logga in knappen] [AAD-inloggning]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="bcf91-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="bcf91-111">Den här artikeln förutsätter att du redan är bekant med att skapa en enskild klient program för Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="bcf91-112">Om du inte head säkerhetskopiera toohello [developer guide webbsida] [ AAD-Dev-Guide] och prova en av våra snabbstarter!</span><span class="sxs-lookup"><span data-stu-id="bcf91-112">If you’re not, head back up toohello [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="bcf91-113">Det finns fyra enkla steg tooconvert ditt program i en app för flera innehavare av Azure AD:</span><span class="sxs-lookup"><span data-stu-id="bcf91-113">There are four simple steps tooconvert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="bcf91-114">Uppdatera ditt program registrering toobe flera innehavare</span><span class="sxs-lookup"><span data-stu-id="bcf91-114">Update your application registration toobe multi-tenant</span></span>
2. <span data-ttu-id="bcf91-115">Uppdatera din kod toosend begäranden toohello/Common slutpunkt</span><span class="sxs-lookup"><span data-stu-id="bcf91-115">Update your code toosend requests toohello /common endpoint</span></span> 
3. <span data-ttu-id="bcf91-116">Uppdatera din kod toohandle flera utfärdaren värden</span><span class="sxs-lookup"><span data-stu-id="bcf91-116">Update your code toohandle multiple issuer values</span></span>
4. <span data-ttu-id="bcf91-117">Förstå användare och admin medgivande och göra ändringar av lämplig kod</span><span class="sxs-lookup"><span data-stu-id="bcf91-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="bcf91-118">Nu ska vi titta på varje steg i detalj.</span><span class="sxs-lookup"><span data-stu-id="bcf91-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="bcf91-119">Du kan även gå direkt för[den här listan med flera innehavare exempel][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="bcf91-119">You can also jump straight too[this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-toobe-multi-tenant"></a><span data-ttu-id="bcf91-120">Uppdatera registreringen toobe flera innehavare</span><span class="sxs-lookup"><span data-stu-id="bcf91-120">Update registration toobe multi-tenant</span></span>
<span data-ttu-id="bcf91-121">Som standard är web app/API registreringar i Azure AD enda innehavare.</span><span class="sxs-lookup"><span data-stu-id="bcf91-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="bcf91-122">Du kan göra registreringen flera innehavare genom att söka efter hello ”med flera innehavare” växla hello sidan med egenskaper för programmet registreringen i hello [Azure-portalen] [ AZURE-portal] och ange värdet för ”Ja”.</span><span class="sxs-lookup"><span data-stu-id="bcf91-122">You can make your registration multi-tenant by finding hello “Multi-Tenanted” switch on hello properties page of your application registration in hello [Azure portal][AZURE-portal] and setting it too“Yes”.</span></span>

<span data-ttu-id="bcf91-123">Observera även, innan ett program kan göras med flera innehavare, Azure AD kräver hello App-ID-URI för hello programmet toobe globalt unika.</span><span class="sxs-lookup"><span data-stu-id="bcf91-123">Also note, before an application can be made multi-tenant, Azure AD requires hello App ID URI of hello application toobe globally unique.</span></span> <span data-ttu-id="bcf91-124">hello App-ID URI är en av hello sätt som ett program har identifierats i protokollmeddelanden.</span><span class="sxs-lookup"><span data-stu-id="bcf91-124">hello App ID URI is one of hello ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="bcf91-125">Det är tillräcklig för hello App-ID URI toobe unikt inom den klienten för en enskild klient-program.</span><span class="sxs-lookup"><span data-stu-id="bcf91-125">For a single tenant application, it is sufficient for hello App ID URI toobe unique within that tenant.</span></span>  <span data-ttu-id="bcf91-126">För ett program med flera innehavare, måste det vara globalt unikt så att Azure AD kan hitta hello program över alla klienter.</span><span class="sxs-lookup"><span data-stu-id="bcf91-126">For a multi-tenant application, it must be globally unique so Azure AD can find hello application across all tenants.</span></span>  <span data-ttu-id="bcf91-127">Globala unika tillämpas genom att kräva hello App-ID URI toohave ett värdnamn som matchar en verifierad domän till hello Azure AD-klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-127">Global uniqueness is enforced by requiring hello App ID URI toohave a host name that matches a verified domain of hello Azure AD tenant.</span></span>  <span data-ttu-id="bcf91-128">Till exempel om hello namn för din klient har contoso.onmicrosoft.com sedan en giltig URI för App-ID är `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="bcf91-128">For example, if hello name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="bcf91-129">Om din klient har en verifierad domän i `contoso.com`, och sedan en giltig URI för App-ID kan även vara `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="bcf91-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="bcf91-130">Ange ett program som flera innehavare misslyckas om hello App-ID URI inte följer detta mönster.</span><span class="sxs-lookup"><span data-stu-id="bcf91-130">Setting an application as multi-tenant will fail if hello App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="bcf91-131">-Klientregistreringar finns flera innehavare som standard.</span><span class="sxs-lookup"><span data-stu-id="bcf91-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="bcf91-132">Du behöver inte tootake någon åtgärd toomake en native client programmet registrering flera innehavare.</span><span class="sxs-lookup"><span data-stu-id="bcf91-132">You don’t need tootake any action toomake a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-toosend-requests-toocommon"></a><span data-ttu-id="bcf91-133">Uppdatera din kod toosend begäranden för/common</span><span class="sxs-lookup"><span data-stu-id="bcf91-133">Update your code toosend requests too/common</span></span>
<span data-ttu-id="bcf91-134">I ett program som en organisation skickas inloggningsförfrågningar toohello klient inloggning slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="bcf91-134">In a single tenant application, sign-in requests are sent toohello tenant’s sign-in endpoint.</span></span> <span data-ttu-id="bcf91-135">Till exempel för contoso.onmicrosoft.com hello slutpunkten skulle vara:</span><span class="sxs-lookup"><span data-stu-id="bcf91-135">For example, for contoso.onmicrosoft.com hello endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="bcf91-136">Begäranden skickade tooa tenant-slutpunkten kan logga in användare (eller gäster) i den klient tooapplications i den klienten.</span><span class="sxs-lookup"><span data-stu-id="bcf91-136">Requests sent tooa tenant’s endpoint can sign in users (or guests) in that tenant tooapplications in that tenant.</span></span>  <span data-ttu-id="bcf91-137">Med ett program med flera innehavare, hello program inte vet vilken klient hello användaren tillhör, så du inte kan skicka direkt begär tooa tenant-slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="bcf91-137">With a multi-tenant application, hello application doesn’t know up front what tenant hello user is from, so you can’t send requests tooa tenant’s endpoint.</span></span>  <span data-ttu-id="bcf91-138">Begäranden skickas i stället tooan slutpunkt som multiplexes över alla Azure AD-klienter:</span><span class="sxs-lookup"><span data-stu-id="bcf91-138">Instead, requests are sent tooan endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="bcf91-139">När Azure AD tar emot en begäran på hello/vanliga endpoint den hello användaren loggar in och som en följd identifierar vilken klient hello användare kommer från.</span><span class="sxs-lookup"><span data-stu-id="bcf91-139">When Azure AD receives a request on hello /common endpoint, it signs hello user in and as a consequence discovers which tenant hello user is from.</span></span>  <span data-ttu-id="bcf91-140">Hej/vanliga slutpunkt som fungerar med alla hello autentiseringsprotokoll som stöds av Azure AD: OpenID Connect, OAuth 2.0, SAML 2.0 och WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="bcf91-140">hello /common endpoint works with all of hello authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="bcf91-141">hello inloggning svar toohello programmet sedan innehåller en token som representerar hello användare.</span><span class="sxs-lookup"><span data-stu-id="bcf91-141">hello sign-in response toohello application then contains a token representing hello user.</span></span>  <span data-ttu-id="bcf91-142">hello utfärdaren värdet i hello token visar ett program vilken klient hello användaren tillhör.</span><span class="sxs-lookup"><span data-stu-id="bcf91-142">hello issuer value in hello token tells an application what tenant hello user is from.</span></span>  <span data-ttu-id="bcf91-143">När ett svar returneras från hello/vanliga slutpunkt, hello utfärdaren värdet i hello token motsvarar toohello användarens klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-143">When a response returns from hello /common endpoint, hello issuer value in hello token will correspond toohello user’s tenant.</span></span>  <span data-ttu-id="bcf91-144">Det är viktigt toonote hello/vanliga slutpunkt är inte en klient och är inte en utfärdare, är det bara en multiplexor.</span><span class="sxs-lookup"><span data-stu-id="bcf91-144">It’s important toonote hello /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="bcf91-145">När du använder/Common behov hello logiken i dina program toovalidate token toobe uppdateras tootake detta hänsyn.</span><span class="sxs-lookup"><span data-stu-id="bcf91-145">When using /common, hello logic in your application toovalidate tokens needs toobe updated tootake this into account.</span></span> 

<span data-ttu-id="bcf91-146">Som nämnts tidigare och flera innehavare program bör också ge en konsekvent inloggningsupplevelse för användare, hello följande Azure AD-program företagsanpassning riktlinjer.</span><span class="sxs-lookup"><span data-stu-id="bcf91-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following hello Azure AD application branding guidelines.</span></span> <span data-ttu-id="bcf91-147">Klicka på följande knapp toolearn mer om anpassning av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="bcf91-147">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="bcf91-148">[! [Logga in knappen] [AAD-inloggning]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="bcf91-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="bcf91-149">Låt oss ta en titt på hello användning av hello/Common slutpunkt och implementeringen koden i detalj.</span><span class="sxs-lookup"><span data-stu-id="bcf91-149">Let’s take a look at hello use of hello /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-toohandle-multiple-issuer-values"></a><span data-ttu-id="bcf91-150">Uppdatera din kod toohandle flera utfärdaren värden</span><span class="sxs-lookup"><span data-stu-id="bcf91-150">Update your code toohandle multiple issuer values</span></span>
<span data-ttu-id="bcf91-151">Webbprogram och webb-API: er får och validera token från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="bcf91-152">Intern klientprogram begära och ta emot token från Azure AD, de gör så toosend dem tooAPIs, där de verifieras.</span><span class="sxs-lookup"><span data-stu-id="bcf91-152">While native client applications request and receive tokens from Azure AD, they do so toosend them tooAPIs, where they are validated.</span></span>  <span data-ttu-id="bcf91-153">Interna program validera inte token och hantera dem som täckande.</span><span class="sxs-lookup"><span data-stu-id="bcf91-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="bcf91-154">Nu ska vi titta på hur ett program validerar token tas emot från Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="bcf91-155">En enskild klient-program tar normalt en slutpunktsvärde som:</span><span class="sxs-lookup"><span data-stu-id="bcf91-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="bcf91-156">och använda den tooconstruct som en URL för tjänstmetadata (i det här fallet OpenID Connect):</span><span class="sxs-lookup"><span data-stu-id="bcf91-156">and use it tooconstruct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="bcf91-157">toodownload två viktiga uppgifter som används toovalidate token: hello-klient signering nycklar och utfärdaren värde.</span><span class="sxs-lookup"><span data-stu-id="bcf91-157">toodownload two critical pieces of information that are used toovalidate tokens:  hello tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="bcf91-158">Varje Azure AD-klient har unika utfärdaren värdet hello formuläret:</span><span class="sxs-lookup"><span data-stu-id="bcf91-158">Each Azure AD tenant has a unique issuer value of hello form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="bcf91-159">hello GUID-värde är där hello rename-säkert version av hello klient-ID för hello-klienten.</span><span class="sxs-lookup"><span data-stu-id="bcf91-159">where hello GUID value is hello rename-safe version of hello tenant ID of hello tenant.</span></span>  <span data-ttu-id="bcf91-160">Om du klickar på hello föregående länk metadata för `contoso.onmicrosoft.com`, du kan se den här utfärdaren värde i hello dokumentet.</span><span class="sxs-lookup"><span data-stu-id="bcf91-160">If you click on hello preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in hello document.</span></span>

<span data-ttu-id="bcf91-161">När en enskild klient program validerar token, kontrollerar hello signaturen för hello token mot hello Signeringsnycklar från hello metadata dokument.</span><span class="sxs-lookup"><span data-stu-id="bcf91-161">When a single tenant application validates a token, it checks hello signature of hello token against hello signing keys from hello metadata document.</span></span> <span data-ttu-id="bcf91-162">Detta gör det toomake att hello utfärdaren värdet hello token matchar hello något som hittades i hello Metadatadokumentet.</span><span class="sxs-lookup"><span data-stu-id="bcf91-162">This allows it toomake sure hello issuer value in hello token matches hello one that was found in hello metadata document.</span></span>

<span data-ttu-id="bcf91-163">Eftersom hello/vanliga slutpunkten överensstämmer inte tooa klient och är inte en utfärdare när du undersöker hello utfärdaren värdet i hello metadata för/vanliga har en mallbaserat URL i stället för ett faktiskt värde:</span><span class="sxs-lookup"><span data-stu-id="bcf91-163">Since hello /common endpoint doesn’t correspond tooa tenant and isn’t an issuer, when you examine hello issuer value in hello metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="bcf91-164">Därför kan ett program med flera innehavare kan inte verifiera token genom att bara matchar hello utfärdaren värdet i hello metadata med hello `issuer` värdet i hello-token.</span><span class="sxs-lookup"><span data-stu-id="bcf91-164">Therefore, a multi-tenant application can’t validate tokens just by matching hello issuer value in hello metadata with hello `issuer` value in hello token.</span></span>  <span data-ttu-id="bcf91-165">Ett program med flera innehavare behöver logik toodecide utfärdaren värden som är giltiga och är inte, baserat på hello klient-ID delen av hello utfärdaren värde.</span><span class="sxs-lookup"><span data-stu-id="bcf91-165">A multi-tenant application needs logic toodecide which issuer values are valid and which are not, based on hello tenant ID portion of hello issuer value.</span></span>  

<span data-ttu-id="bcf91-166">Till exempel om ett program med flera innehavare kan bara logga in från specifika klienter som har registrerat dig för tjänsten, sedan det måste kontrollera hello utfärdaren värde eller hello `tid` anspråksvärde i hello token toomake att den klienten som är i sin lista över prenumeranter.</span><span class="sxs-lookup"><span data-stu-id="bcf91-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either hello issuer value or hello `tid` claim value in hello token toomake sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="bcf91-167">Om ett program med flera innehavare endast behandlar enskilda användare och inte göra någon åtkomst beslut baserat på klienter, kan den Ignorera hello utfärdaren värde helt och hållet.</span><span class="sxs-lookup"><span data-stu-id="bcf91-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore hello issuer value altogether.</span></span>

<span data-ttu-id="bcf91-168">I hello flera innehavare prover i hello [relaterade innehåll](#related-content) avsnittet hello slutet av den här artikeln utfärdaren validering är inaktiverat tooenable alla Azure AD-klient toosign i.</span><span class="sxs-lookup"><span data-stu-id="bcf91-168">In hello multi-tenant samples in hello [Related Content](#related-content) section at hello end of this article, issuer validation is disabled tooenable any Azure AD tenant toosign in.</span></span>

<span data-ttu-id="bcf91-169">Nu ska vi titta på hello användarupplevelsen för användare som loggar in program toomulti-klienter.</span><span class="sxs-lookup"><span data-stu-id="bcf91-169">Now let’s look at hello user experience for users that are signing in toomulti-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="bcf91-170">Förstå användare och admin-medgivande</span><span class="sxs-lookup"><span data-stu-id="bcf91-170">Understanding user and admin consent</span></span>
<span data-ttu-id="bcf91-171">Hello program måste vara representerad i hello användarens klient för en användare toosign i tooan program i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-171">For a user toosign in tooan application in Azure AD, hello application must be represented in hello user’s tenant.</span></span>  <span data-ttu-id="bcf91-172">Detta gör hello organisation toodo exempelvis tillämpa unika principer när användare från deras klient loggar in toohello program.</span><span class="sxs-lookup"><span data-stu-id="bcf91-172">This allows hello organization toodo things like apply unique policies when users from their tenant sign in toohello application.</span></span>  <span data-ttu-id="bcf91-173">För en enskild klient programmet är registreringen enkel; Det har hello som händer när du registrerar hello program i hello [Azure-portalen][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="bcf91-173">For a single tenant application, this registration is simple; it’s hello one that happens when you register hello application in hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="bcf91-174">För ett program med flera innehavare bor hello registreringen för programmet hello i hello Azure AD-klient används av hello-utvecklare.</span><span class="sxs-lookup"><span data-stu-id="bcf91-174">For a multi-tenant application, hello initial registration for hello application lives in hello Azure AD tenant used by hello developer.</span></span>  <span data-ttu-id="bcf91-175">När en användare från en annan klient loggar in toohello program för hello första gången, frågar Azure AD dem tooconsent toohello behörigheter som begärs av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="bcf91-175">When a user from a different tenant signs in toohello application for hello first time, Azure AD asks them tooconsent toohello permissions requested by hello application.</span></span>  <span data-ttu-id="bcf91-176">Om de accepterar och sedan en representation av programmet hello kallas en *tjänstens huvudnamn* skapas i hello användarens klient och inloggningen kan fortsätta.</span><span class="sxs-lookup"><span data-stu-id="bcf91-176">If they consent, then a representation of hello application called a *service principal* is created in hello user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="bcf91-177">Hello-katalog som innehåller hello användarens medgivande toohello program skapas också en delegering.</span><span class="sxs-lookup"><span data-stu-id="bcf91-177">A delegation is also created in hello directory that records hello user’s consent toohello application.</span></span> <span data-ttu-id="bcf91-178">Se [program och tjänstens huvudnamn objekt] [ AAD-App-SP-Objects] information om hello programmet program och ServicePrincipal objekt och hur de hör ihop tooeach andra.</span><span class="sxs-lookup"><span data-stu-id="bcf91-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on hello application's Application and ServicePrincipal objects, and how they relate tooeach other.</span></span>

![Medgivande toosingle skikt app][Consent-Single-Tier] 

<span data-ttu-id="bcf91-180">Den här medgivande upplevelse påverkas av hello behörigheter som begärs av programmet hello.</span><span class="sxs-lookup"><span data-stu-id="bcf91-180">This consent experience is affected by hello permissions requested by hello application.</span></span>  <span data-ttu-id="bcf91-181">Azure AD stöder två typer av endast app- och delegera behörigheter:</span><span class="sxs-lookup"><span data-stu-id="bcf91-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="bcf91-182">En delegerad behörighet ger en programmet hello möjlighet tooact som en inloggad användare för en delmängd av hello saker hello användare kan göra.</span><span class="sxs-lookup"><span data-stu-id="bcf91-182">A delegated permission grants an application hello ability tooact as a signed in user for a subset of hello things hello user can do.</span></span>  <span data-ttu-id="bcf91-183">Exempelvis kan du bevilja en programmet hello delegerad behörighet tooread hello inloggad användares kalender.</span><span class="sxs-lookup"><span data-stu-id="bcf91-183">For example, you can grant an application hello delegated permission tooread hello signed in user’s calendar.</span></span>
* <span data-ttu-id="bcf91-184">En app bara behörigheten direkt toohello hello programmets identitet.</span><span class="sxs-lookup"><span data-stu-id="bcf91-184">An app-only permission is granted directly toohello identity of hello application.</span></span>  <span data-ttu-id="bcf91-185">Exempelvis kan du bevilja en programmet hello endast app-tooread hello behörighetslistan för användare i en klient oavsett vem som har loggat in toohello program.</span><span class="sxs-lookup"><span data-stu-id="bcf91-185">For example, you can grant an application hello app-only permission tooread hello list of users in a tenant, regardless of who is signed in toohello application.</span></span>

<span data-ttu-id="bcf91-186">Vissa behörigheter kan vara tilllåten tooby en vanlig användare, medan andra kräver en Innehavaradministratör medgivande.</span><span class="sxs-lookup"><span data-stu-id="bcf91-186">Some permissions can be consented tooby a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="bcf91-187">Admin-medgivande</span><span class="sxs-lookup"><span data-stu-id="bcf91-187">Admin consent</span></span>
<span data-ttu-id="bcf91-188">Behörigheter endast appen kräver alltid en Innehavaradministratör medgivande.</span><span class="sxs-lookup"><span data-stu-id="bcf91-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="bcf91-189">Om ditt program begär en endast app-behörighet och en användare försöker toosign i toohello program, visas ett felmeddelande om hello användaren inte kan tooconsent.</span><span class="sxs-lookup"><span data-stu-id="bcf91-189">If your application requests an app-only permission and a user tries toosign in toohello application, an error message will be displayed saying hello user isn’t able tooconsent.</span></span>

<span data-ttu-id="bcf91-190">Vissa delegerade behörigheter kräver också en Innehavaradministratör medgivande.</span><span class="sxs-lookup"><span data-stu-id="bcf91-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="bcf91-191">Till exempel kräver hello möjlighet toowrite tillbaka tooAzure AD som hello inloggad användare en Innehavaradministratör medgivande.</span><span class="sxs-lookup"><span data-stu-id="bcf91-191">For example, hello ability toowrite back tooAzure AD as hello signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="bcf91-192">Som endast app-behörigheter, om en vanlig användare försöker toosign i tooan program som kräver en delegerad behörighet som kräver att administratören medgivande får programmet ett fel.</span><span class="sxs-lookup"><span data-stu-id="bcf91-192">Like app-only permissions, if an ordinary user tries toosign in tooan application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="bcf91-193">Huruvida en behörighet kräver admin samtycke bestäms av hello utvecklare som publicerats hello resurs och kan vara finns i dokumentationen för hello för hello resurs.</span><span class="sxs-lookup"><span data-stu-id="bcf91-193">Whether or not a permission requires admin consent is determined by hello developer that published hello resource, and can be found in hello documentation for hello resource.</span></span>  <span data-ttu-id="bcf91-194">Länkar tootopics som beskriver hello tillgängliga behörigheter för hello Azure AD Graph API och Microsoft Graph API är i hello [relaterade innehåll](#related-content) i den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="bcf91-194">Links tootopics describing hello available permissions for hello Azure AD Graph API and Microsoft Graph API are in hello [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="bcf91-195">Om programmet använder behörigheter som kräver godkännande av administratören, måste toohave en gest, till exempel en knapp eller en länk där Hej administratör kan starta hello åtgärden.</span><span class="sxs-lookup"><span data-stu-id="bcf91-195">If your application uses permissions that require admin consent, you need toohave a gesture such as a button or link where hello admin can initiate hello action.</span></span>  <span data-ttu-id="bcf91-196">hello-begäran som programmet skickar den här åtgärden är ett vanligt OAuth2/OpenID Connect auktoriseringsbegäran, men som också innehåller hello `prompt=admin_consent` frågesträngparametern.</span><span class="sxs-lookup"><span data-stu-id="bcf91-196">hello request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes hello `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="bcf91-197">När Hej administratör har godkänt och hello tjänstens huvudnamn skapas i hello kundens klienten behöver inte efterföljande inloggning förfrågningar hello `prompt=admin_consent` parameter.</span><span class="sxs-lookup"><span data-stu-id="bcf91-197">Once hello admin has consented and hello service principal is created in hello customer’s tenant, subsequent sign-in requests do not need hello `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="bcf91-198">Eftersom Hej administratör har beslutat hello begärt behörigheter accepteras uppmanas inga andra användare i hello-klient för godkännande från den tidpunkten och framåt.</span><span class="sxs-lookup"><span data-stu-id="bcf91-198">Since hello administrator has decided hello requested permissions are acceptable, no other users in hello tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="bcf91-199">Hej `prompt=admin_consent` parameter kan även användas av program som begär behörighet som inte kräver godkännande av administratören.</span><span class="sxs-lookup"><span data-stu-id="bcf91-199">hello `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="bcf91-200">Detta görs när hello programobjekt kräver en upplevelse där hello innehavaradministration ”registrerar sig” en tid och ingen användare tillfrågas om samtycke från den tidpunkten på.</span><span class="sxs-lookup"><span data-stu-id="bcf91-200">This is done when hello applicaton requires an experience where hello tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="bcf91-201">Om ett program kräver godkännande av administratören och en administratör loggar i men hello `prompt=admin_consent` parametern skickas inte, Hej administratör kommer har medgivande toohello programmet **endast för sitt användarkonto**.</span><span class="sxs-lookup"><span data-stu-id="bcf91-201">If an application requires admin consent, and an admin signs in but hello `prompt=admin_consent` parameter is not sent, hello admin will successfully consent toohello application **only for their user account**.</span></span>  <span data-ttu-id="bcf91-202">Vanliga användare fortfarande inte kan toosign i och medgivande toohello program.</span><span class="sxs-lookup"><span data-stu-id="bcf91-202">Regular users will still not be able toosign in and consent toohello application.</span></span>  <span data-ttu-id="bcf91-203">Detta är användbart om du vill att toogive hello klient administratör hello möjlighet tooexplore programmet innan andra användare åtkomst.</span><span class="sxs-lookup"><span data-stu-id="bcf91-203">This is useful if you want toogive hello tenant administrator hello ability tooexplore your application before allowing other users access.</span></span>

<span data-ttu-id="bcf91-204">En Innehavaradministratör kan inaktivera hello möjligheten för vanliga användare tooconsent tooapplications.</span><span class="sxs-lookup"><span data-stu-id="bcf91-204">A tenant administrator can disable hello ability for regular users tooconsent tooapplications.</span></span>  <span data-ttu-id="bcf91-205">Om den här funktionen är inaktiverad krävs alltid admin medgivande för hello programmet toobe i hello-klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-205">If this capability is disabled, admin consent is always required for hello application toobe set up in hello tenant.</span></span>  <span data-ttu-id="bcf91-206">Om du vill tootest ditt program med vanlig användare samtycke inaktiverad, hittar du hello konfigurationsväxel i hello Azure AD-klient konfigurationsavsnittet för hello [Azure-portalen][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="bcf91-206">If you want tootest your application with regular user consent disabled, you can find hello configuration switch in hello Azure AD tenant configuration section of hello [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="bcf91-207">Vissa program vill en upplevelse där vanliga användare kan tooconsent från början, och senare hello-programmet kan omfatta hello administratören och begär behörighet som kräver godkännande av administratören.</span><span class="sxs-lookup"><span data-stu-id="bcf91-207">Some applications want an experience where regular users are able tooconsent initially, and later hello application can involve hello administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="bcf91-208">Det finns inget sätt toodo detta med en enda programregistrering i Azure AD idag.</span><span class="sxs-lookup"><span data-stu-id="bcf91-208">There is no way toodo this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="bcf91-209">hello kommande Azure AD v2 endpoint kan program toorequest behörigheter vid körning, i stället för närvarande registreringen, vilket gör att det här scenariot.</span><span class="sxs-lookup"><span data-stu-id="bcf91-209">hello upcoming Azure AD v2 endpoint will allow applications toorequest permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="bcf91-210">Mer information finns i hello [Utvecklarhandbok för Azure AD App Model v2][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="bcf91-210">For more information, see hello [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="bcf91-211">Medgivande och flera nivåer program</span><span class="sxs-lookup"><span data-stu-id="bcf91-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="bcf91-212">Programmet kan ha flera nivåer, var och en representeras av dess egna registrering i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="bcf91-213">Till exempel ett enhetligt program som anropar ett webb-API eller ett webbprogram som anropar ett webb-API.</span><span class="sxs-lookup"><span data-stu-id="bcf91-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="bcf91-214">I båda dessa fall hello klienten (inbyggda appen eller webbprogram) begär behörighet toocall hello resurs (webb-API).</span><span class="sxs-lookup"><span data-stu-id="bcf91-214">In both of these cases, hello client (native app or web app) requests permissions toocall hello resource (web API).</span></span>  <span data-ttu-id="bcf91-215">För hello klienten toobe har samtyckt till en kund-klient, måste alla resurser toowhich begär behörighet redan finnas i hello kundens klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-215">For hello client toobe successfully consented into a customer’s tenant, all resources toowhich it requests permissions must already exist in hello customer’s tenant.</span></span>  <span data-ttu-id="bcf91-216">Om detta inte är uppfyllt, returneras Azure AD ett fel som hello resursen måste läggas till först.</span><span class="sxs-lookup"><span data-stu-id="bcf91-216">If this condition isn’t met, Azure AD will return an error that hello resource must be added first.</span></span>

<span data-ttu-id="bcf91-217">**Flera nivåer i en enskild klient**</span><span class="sxs-lookup"><span data-stu-id="bcf91-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="bcf91-218">Detta kan vara ett problem om tillämpningsprogrammet logiska består av två eller flera program registreringar, till exempel en separat klient och resurs.</span><span class="sxs-lookup"><span data-stu-id="bcf91-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="bcf91-219">Hur du får hello resurs i hello kunden klient första?</span><span class="sxs-lookup"><span data-stu-id="bcf91-219">How do you get hello resource into hello customer tenant first?</span></span>  <span data-ttu-id="bcf91-220">Azure AD omfattar det här fallet genom att aktivera klienten och resursen toobe godkänt i ett enda steg.</span><span class="sxs-lookup"><span data-stu-id="bcf91-220">Azure AD covers this case by enabling client and resource toobe consented in a single step.</span></span> <span data-ttu-id="bcf91-221">hello användaren ser hello totalsumman av hello behörigheter som begärs av både hello-klienten och resursen på hello medgivande sida.</span><span class="sxs-lookup"><span data-stu-id="bcf91-221">hello user sees hello sum total of hello permissions requested by both hello client and resource on hello consent page.</span></span>  <span data-ttu-id="bcf91-222">tooenable det här beteendet hello resursens appregistrering måste innehålla hello klienten App-ID som en `knownClientApplications` i sitt applikationsmanifest.</span><span class="sxs-lookup"><span data-stu-id="bcf91-222">tooenable this behavior, hello resource’s application registration must include hello client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="bcf91-223">Exempel:</span><span class="sxs-lookup"><span data-stu-id="bcf91-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="bcf91-224">Den här egenskapen kan uppdateras via hello resurs [programmets manifest][AAD-App-Manifest].</span><span class="sxs-lookup"><span data-stu-id="bcf91-224">This property can be updated via hello resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="bcf91-225">Detta visas i en-klienten på flera nivåer anropa webb-API-exemplet i hello [relaterade innehåll](#related-content) avsnittet hello slutet av den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="bcf91-225">This is demonstrated in a multi-tier native client calling web API sample in hello [Related Content](#related-content) section at hello end of this article.</span></span> <span data-ttu-id="bcf91-226">hello ger följande diagram en översikt av medgivande för en flernivåapp som registrerats i en enskild klient:</span><span class="sxs-lookup"><span data-stu-id="bcf91-226">hello following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Medgivande toomulti skikt kända-klientappen][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="bcf91-228">**Flera nivåer i flera innehavare**</span><span class="sxs-lookup"><span data-stu-id="bcf91-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="bcf91-229">Liknande fall händer om hello olika nivåer av ett program som har registrerats i olika klienter.</span><span class="sxs-lookup"><span data-stu-id="bcf91-229">A similar case happens if hello different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="bcf91-230">Anta till exempel att hello fall för att skapa en native client-program som anropar hello Office 365 Exchange Online-API.</span><span class="sxs-lookup"><span data-stu-id="bcf91-230">For example, consider hello case of building a native client application that calls hello Office 365 Exchange Online API.</span></span>  <span data-ttu-id="bcf91-231">toodevelop hello inbyggt, och senare för hello programspecifika toorun i en kund-klient, hello Exchange Online tjänstens huvudnamn måste finnas.</span><span class="sxs-lookup"><span data-stu-id="bcf91-231">toodevelop hello native application, and later for hello native application toorun in a customer’s tenant, hello Exchange Online service principal must be present.</span></span>  <span data-ttu-id="bcf91-232">I det här fallet måste hello utvecklare och kunden köpa Exchange Online för hello service principal toobe skapas i sina klienter.</span><span class="sxs-lookup"><span data-stu-id="bcf91-232">In this case, hello developer and customer must purchase Exchange Online for hello service principal toobe created in their tenants.</span></span>  

<span data-ttu-id="bcf91-233">Hello gäller en API som skapats av en organisation än Microsoft, behöver hello utvecklaren av hello API tooprovide ett sätt för sina kunder tooconsent hello program till sina kunder innehavare.</span><span class="sxs-lookup"><span data-stu-id="bcf91-233">In hello case of an API built by an organization other than Microsoft, hello developer of hello API needs tooprovide a way for their customers tooconsent hello application into their customers' tenants.</span></span> <span data-ttu-id="bcf91-234">hello rekommenderas design är för hello 3 part developer toobuild hello API så att den kan också fungera som en web klienten tooimplement registrering:</span><span class="sxs-lookup"><span data-stu-id="bcf91-234">hello recommended design is for hello 3rd party developer toobuild hello API such that it can also function as a web client tooimplement sign-up :</span></span>

1. <span data-ttu-id="bcf91-235">Följ hello tidigare avsnitt tooensure hello API implementerar hello flera innehavare registrering/kod programkrav</span><span class="sxs-lookup"><span data-stu-id="bcf91-235">Follow hello earlier sections tooensure hello API implements hello multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="bcf91-236">Dessutom tooexposing hello API: er scope och roller, kontrollera hello registrering innehåller hello ”logga in och Läs användarprofil” Azure AD-behörigheten (som standard)</span><span class="sxs-lookup"><span data-stu-id="bcf91-236">In addition tooexposing hello API's scopes/roles, ensure hello registration includes hello "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="bcf91-237">Implementera en logga-i/sign-upp sida i hello webbklienten följande hello [admin medgivande](#admin-consent) vägledning nämnts tidigare</span><span class="sxs-lookup"><span data-stu-id="bcf91-237">Implement a sign-in/sign-up page in hello web client, following hello [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="bcf91-238">När hello användaren godkänner toohello program, hello service principal och samtycke delegering kopplingarna i klientorganisationen och hello det ursprungliga programmet kan hämta token för hello API</span><span class="sxs-lookup"><span data-stu-id="bcf91-238">Once hello user consents toohello application, hello service principal and consent delegation links are created in their tenant, and hello native application can get tokens for hello API</span></span>

<span data-ttu-id="bcf91-239">hello följande diagram ger en översikt av medgivande för en flernivåapp som registrerats i olika klienter:</span><span class="sxs-lookup"><span data-stu-id="bcf91-239">hello following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Medgivande toomulti skikt med flera app][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="bcf91-241">Återkalla medgivande</span><span class="sxs-lookup"><span data-stu-id="bcf91-241">Revoking Consent</span></span>
<span data-ttu-id="bcf91-242">Användare och administratörer kan återkalla medgivande tooyour program när som helst:</span><span class="sxs-lookup"><span data-stu-id="bcf91-242">Users and administrators can revoke consent tooyour application at any time:</span></span>

* <span data-ttu-id="bcf91-243">Användare återkalla åtkomst tooindividual program genom att ta bort dem från sina [åtkomst panelen program] [ AAD-Access-Panel] lista.</span><span class="sxs-lookup"><span data-stu-id="bcf91-243">Users revoke access tooindividual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="bcf91-244">Administratörer återkalla åtkomst tooapplications genom att ta bort dem från Azure AD med hjälp av hello Azure AD management avsnitt i hello [Azure-portalen][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="bcf91-244">Administrators revoke access tooapplications by removing them from Azure AD using hello Azure AD management section of hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="bcf91-245">Om en administratör godkänner tooan program för alla användare i en klient, kan användare kan inte återkalla åtkomst individuellt.</span><span class="sxs-lookup"><span data-stu-id="bcf91-245">If an administrator consents tooan application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="bcf91-246">Endast Hej administratör kan återkalla åtkomst och endast för hela programmet hello.</span><span class="sxs-lookup"><span data-stu-id="bcf91-246">Only hello administrator can revoke access, and only for hello whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="bcf91-247">Medgivande och protokollstöd</span><span class="sxs-lookup"><span data-stu-id="bcf91-247">Consent and Protocol Support</span></span>
<span data-ttu-id="bcf91-248">Medgivande stöds i Azure AD via OpenID Connect hello OAuth WS-Federation och SAML-protokoll.</span><span class="sxs-lookup"><span data-stu-id="bcf91-248">Consent is supported in Azure AD via hello OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="bcf91-249">hello SAML och WS-Federation-protokollen stöder inte hello `prompt=admin_consent` parameter, så admin medgivande är endast möjligt via OAuth och OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="bcf91-249">hello SAML and WS-Federation protocols do not support hello `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="bcf91-250">Program med flera klienter och cachelagring åtkomst-token</span><span class="sxs-lookup"><span data-stu-id="bcf91-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="bcf91-251">Program med flera klienter kan också få åtkomst-token toocall API: er som skyddas av Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bcf91-251">Multi-tenant applications can also get access tokens toocall APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="bcf91-252">Ett vanligt fel när du använder hello Active Directory Authentication Library (ADAL) med ett program med flera innehavare, är tooinitially begäran en token för en användare som använder/Common, ett svar och sedan begära en efterföljande token för samma användare också använder/Common.</span><span class="sxs-lookup"><span data-stu-id="bcf91-252">A common error when using hello Active Directory Authentication Library (ADAL) with a multi-tenant application, is tooinitially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="bcf91-253">Eftersom hello svaret från Azure AD inte kommer från en klient/gemensamma ADAL cachelagrar hello token som från hello-klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-253">Since hello response from Azure AD comes from a tenant, not /common, ADAL caches hello token as being from hello tenant.</span></span> <span data-ttu-id="bcf91-254">hello efterföljande anrop för/common tooget är en åtkomst-token för hello användaren missar hello cacheposten och hello användaren tillfrågas toosign i igen.</span><span class="sxs-lookup"><span data-stu-id="bcf91-254">hello subsequent call too/common tooget an access token for hello user misses hello cache entry, and hello user is prompted toosign in again.</span></span>  <span data-ttu-id="bcf91-255">tooavoid saknas hello-cache, se till att följande anrop för en redan inloggad användare görs toohello tenant-slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="bcf91-255">tooavoid missing hello cache, make sure subsequent calls for an already signed in user are made toohello tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bcf91-256">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="bcf91-256">Next steps</span></span>
<span data-ttu-id="bcf91-257">I den här artikeln har du lärt dig hur toobuild ett program som kan logga in en användare från en Azure Active Directory-klient.</span><span class="sxs-lookup"><span data-stu-id="bcf91-257">In this article, you learned how toobuild an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="bcf91-258">Du kan också uppdatera ditt program tooaccess API: er som exponeras av Microsoft-resurser, t.ex. Office 365 för att aktivera enkel inloggning mellan din app och Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="bcf91-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application tooaccess APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="bcf91-259">Så kan du erbjuda en anpassad upplevelse i ditt program, till exempel visar kontextuella information toohello användare som deras profilbild eller deras nästa möte i kalendern.</span><span class="sxs-lookup"><span data-stu-id="bcf91-259">So you can offer a personalized experience in your application, for example showing contextual information toohello users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="bcf91-260">toolearn mer om hur du gör API anropar tooAzure Active Directory och Office 365-tjänster som Exchange, SharePoint, OneDrive, OneNote, Planner, Excel och mer finns: [Microsoft Graph API][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="bcf91-260">toolearn more about making API calls tooAzure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="bcf91-261">Relaterat innehåll</span><span class="sxs-lookup"><span data-stu-id="bcf91-261">Related content</span></span>
* <span data-ttu-id="bcf91-262">[Exempel på program för flera innehavare][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="bcf91-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="bcf91-263">[Riktlinjer för varumärkesanpassning för program][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="bcf91-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="bcf91-264">[Azure AD-Guide för utvecklare][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="bcf91-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="bcf91-265">[Program och tjänstens huvudnamn objekt][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="bcf91-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="bcf91-266">[Integrera program med Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="bcf91-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="bcf91-267">[Översikt över hello medgivande Framework][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="bcf91-267">[Overview of hello Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="bcf91-268">[Behörighetsomfattningen för Microsoft Graph API][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="bcf91-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="bcf91-269">[Azure AD Graph API Behörighetsomfattningen][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="bcf91-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="bcf91-270">Använd hello följande kommentarer avsnittet tooprovide feedback och hjälp oss att förfina och utforma innehållet.</span><span class="sxs-lookup"><span data-stu-id="bcf91-270">Please use hello following comments section tooprovide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














