---
title: "Azure AD Connect: Hur du återställer LocalDB 10 GB gränsen problemet | Microsoft Docs"
description: "Det här avsnittet beskriver hur du återställer Azure AD Connect-synkroniseringstjänsten vid LocalDB 10GB begränsa problemet."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="ce65f-103">Azure AD Connect: Så här återställer du från LocalDB 10 GB gränsen</span><span class="sxs-lookup"><span data-stu-id="ce65f-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="ce65f-104">Azure AD Connect kräver en SQL Server-databas för att lagra identitetsdata.</span><span class="sxs-lookup"><span data-stu-id="ce65f-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="ce65f-105">Du kan antingen använda SQL Server 2012 Express LocalDB som är installerat som standard med Azure AD Connect eller använda din egen fullständiga SQL.</span><span class="sxs-lookup"><span data-stu-id="ce65f-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="ce65f-106">SQL Server Express har en storleksgräns på 10 GB.</span><span class="sxs-lookup"><span data-stu-id="ce65f-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="ce65f-107">När du använder LocalDB och gränsen har uppnåtts kan synkroniseringstjänsten för Azure AD Connect inte längre starta eller synkronisera korrekt.</span><span class="sxs-lookup"><span data-stu-id="ce65f-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="ce65f-108">Den här artikeln innehåller steg för återställning.</span><span class="sxs-lookup"><span data-stu-id="ce65f-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="ce65f-109">Symtom</span><span class="sxs-lookup"><span data-stu-id="ce65f-109">Symptoms</span></span>
<span data-ttu-id="ce65f-110">Det finns två vanliga problem:</span><span class="sxs-lookup"><span data-stu-id="ce65f-110">There are two common symptoms:</span></span>

* <span data-ttu-id="ce65f-111">Azure AD Connect-synkroniseringstjänsten **körs** men inte kan synkronisera med *”stoppats databas-disk-fullständiga”* fel.</span><span class="sxs-lookup"><span data-stu-id="ce65f-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="ce65f-112">Azure AD Connect-synkroniseringstjänsten **går inte att starta**.</span><span class="sxs-lookup"><span data-stu-id="ce65f-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="ce65f-113">När du försöker starta tjänsten misslyckas med händelse 6323 och felmeddelandet *”servern påträffade ett fel eftersom SQLServer är slut på diskutrymme”.*</span><span class="sxs-lookup"><span data-stu-id="ce65f-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="ce65f-114">Kortsiktig steg för återställning</span><span class="sxs-lookup"><span data-stu-id="ce65f-114">Short-term recovery steps</span></span>
<span data-ttu-id="ce65f-115">Det här avsnittet innehåller steg för att återfå DB-utrymme som krävs för Azure AD Connect-synkroniseringstjänsten att återuppta åtgärden.</span><span class="sxs-lookup"><span data-stu-id="ce65f-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="ce65f-116">Stegen omfattar:</span><span class="sxs-lookup"><span data-stu-id="ce65f-116">The steps include:</span></span>
1. [<span data-ttu-id="ce65f-117">Ta reda på status för synkroniseringstjänsten</span><span class="sxs-lookup"><span data-stu-id="ce65f-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="ce65f-118">Minska databasen</span><span class="sxs-lookup"><span data-stu-id="ce65f-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="ce65f-119">Ta bort kör historikdata</span><span class="sxs-lookup"><span data-stu-id="ce65f-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="ce65f-120">Ange ett kortare kvarhållningsperiod för körningshistorik data</span><span class="sxs-lookup"><span data-stu-id="ce65f-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="ce65f-121">Ta reda på status för synkroniseringstjänsten</span><span class="sxs-lookup"><span data-stu-id="ce65f-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="ce65f-122">Bestäm först om synkroniseringstjänsten körs fortfarande eller inte:</span><span class="sxs-lookup"><span data-stu-id="ce65f-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="ce65f-123">Logga in på Azure AD Connect-servern som administratör.</span><span class="sxs-lookup"><span data-stu-id="ce65f-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="ce65f-124">Gå till **Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="ce65f-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="ce65f-125">Kontrollera status för **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="ce65f-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="ce65f-126">Om den körs inte stoppa eller starta om tjänsten.</span><span class="sxs-lookup"><span data-stu-id="ce65f-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="ce65f-127">Hoppa över [krympa databasen](#shrink-the-database) steget och gå till [ta bort kör historikdata](#delete-run-history-data) steg.</span><span class="sxs-lookup"><span data-stu-id="ce65f-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="ce65f-128">Om den inte körs, försök att starta tjänsten.</span><span class="sxs-lookup"><span data-stu-id="ce65f-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="ce65f-129">Om tjänsten startar hoppa över [krympa databasen](#shrink-the-database) steget och gå till [ta bort kör historikdata](#delete-run-history-data) steg.</span><span class="sxs-lookup"><span data-stu-id="ce65f-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="ce65f-130">Annars fortsätter du med [krympa databasen](#shrink-the-database) steg.</span><span class="sxs-lookup"><span data-stu-id="ce65f-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="ce65f-131">Minska databasen</span><span class="sxs-lookup"><span data-stu-id="ce65f-131">Shrink the database</span></span>
<span data-ttu-id="ce65f-132">Använd komprimeringsåtgärden för att frigöra tillräckligt med utrymme för DB att starta synkroniseringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="ce65f-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="ce65f-133">Det Frigör DB-utrymme genom att ta bort blanksteg i databasen.</span><span class="sxs-lookup"><span data-stu-id="ce65f-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="ce65f-134">Det här steget är bästa eftersom det inte är säkert att du alltid återställa utrymme.</span><span class="sxs-lookup"><span data-stu-id="ce65f-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="ce65f-135">Om du vill veta mer om komprimeringsåtgärden kan den här artikeln [krympa en databas](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce65f-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ce65f-136">Hoppa över det här steget om du får synkroniseringstjänsten ska köras.</span><span class="sxs-lookup"><span data-stu-id="ce65f-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="ce65f-137">Det rekommenderas inte att krympa SQL-databas som den kan leda till dåliga prestanda på grund av ökade fragmentering.</span><span class="sxs-lookup"><span data-stu-id="ce65f-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="ce65f-138">Namnet på den databas som har skapats för Azure AD Connect är **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="ce65f-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="ce65f-139">Om du vill utföra en komprimeringsåtgärden måste du logga in antingen som sysadmin eller DBO av databasen.</span><span class="sxs-lookup"><span data-stu-id="ce65f-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="ce65f-140">Följande konton har beviljats sysadmin-rättigheter under installationen av Azure AD Connect:</span><span class="sxs-lookup"><span data-stu-id="ce65f-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="ce65f-141">Lokala administratörer</span><span class="sxs-lookup"><span data-stu-id="ce65f-141">Local Administrators</span></span>
* <span data-ttu-id="ce65f-142">Det användarkonto som användes för att köra Azure AD Connect-installationen.</span><span class="sxs-lookup"><span data-stu-id="ce65f-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="ce65f-143">Synkronisera tjänstkontot som används som kontexten av Azure AD Connect-synkroniseringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="ce65f-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="ce65f-144">Den lokala gruppen ADSyncAdmins som skapades under installationen.</span><span class="sxs-lookup"><span data-stu-id="ce65f-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="ce65f-145">Säkerhetskopiera databasen genom att kopiera **ADSync.mdf** och **ADSync_log.ldf** filer som finns `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` på en säker plats.</span><span class="sxs-lookup"><span data-stu-id="ce65f-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="ce65f-146">Starta en ny PowerShell-session.</span><span class="sxs-lookup"><span data-stu-id="ce65f-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="ce65f-147">Navigera till mappen `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="ce65f-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="ce65f-148">Starta **sqlcmd** utility genom att köra kommandot `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, med hjälp av autentiseringsuppgifter i en sysadmin eller databasens DBO.</span><span class="sxs-lookup"><span data-stu-id="ce65f-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="ce65f-149">Att krympa databasen på sqlcmd-kommandotolk (1 >), ange `DBCC Shrinkdatabase(ADSync,1);`, följt av `GO` på nästa rad.</span><span class="sxs-lookup"><span data-stu-id="ce65f-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="ce65f-150">Om åtgärden lyckas försök starta synkroniseringstjänsten igen.</span><span class="sxs-lookup"><span data-stu-id="ce65f-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="ce65f-151">Om du kan starta synkroniseringstjänsten, gå till [ta bort kör historikdata](#delete-run-history-data) steg.</span><span class="sxs-lookup"><span data-stu-id="ce65f-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="ce65f-152">Om inte, kontakta supporten.</span><span class="sxs-lookup"><span data-stu-id="ce65f-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="ce65f-153">Ta bort kör historikdata</span><span class="sxs-lookup"><span data-stu-id="ce65f-153">Delete run history data</span></span>
<span data-ttu-id="ce65f-154">Som standard behåller Azure AD Connect upp till sju dagar som kör historikdata.</span><span class="sxs-lookup"><span data-stu-id="ce65f-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="ce65f-155">I det här steget bort vi körningshistorik data om du vill frigöra utrymme i databasen så att Azure AD Connect-synkroniseringstjänsten kan starta synkronisera igen.</span><span class="sxs-lookup"><span data-stu-id="ce65f-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="ce65f-156">Starta **Synchronization Service Manager** genom att gå till START → synkroniseringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="ce65f-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="ce65f-157">Gå till den **Operations** fliken.</span><span class="sxs-lookup"><span data-stu-id="ce65f-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="ce65f-158">Under **åtgärder**väljer **Rensa körs**...</span><span class="sxs-lookup"><span data-stu-id="ce65f-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="ce65f-159">Du kan antingen välja **avmarkera alla körningar** eller **Rensa körs innan... <date>**  alternativet.</span><span class="sxs-lookup"><span data-stu-id="ce65f-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="ce65f-160">Vi rekommenderar att du börjar genom att avmarkera kör historikdata som är äldre än två dagar.</span><span class="sxs-lookup"><span data-stu-id="ce65f-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="ce65f-161">Om du fortsätter att köra i DB storlek problemet, välj sedan den **avmarkera alla körningar** alternativet.</span><span class="sxs-lookup"><span data-stu-id="ce65f-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="ce65f-162">Ange ett kortare kvarhållningsperiod för körningshistorik data</span><span class="sxs-lookup"><span data-stu-id="ce65f-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="ce65f-163">Det här steget är att minska sannolikheten för att köra till 10 GB gränsen problemet efter flera synkroniseringscyklerna.</span><span class="sxs-lookup"><span data-stu-id="ce65f-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="ce65f-164">Öppna en ny PowerShell-session.</span><span class="sxs-lookup"><span data-stu-id="ce65f-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="ce65f-165">Kör `Get-ADSyncScheduler` och anteckna egenskapen PurgeRunHistoryInterval, som anger den aktuella bevarandeperioden.</span><span class="sxs-lookup"><span data-stu-id="ce65f-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="ce65f-166">Kör `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` att ställa in kvarhållningsperioden på två dagar.</span><span class="sxs-lookup"><span data-stu-id="ce65f-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="ce65f-167">Justera kvarhållningsperioden efter behov.</span><span class="sxs-lookup"><span data-stu-id="ce65f-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="ce65f-168">Långsiktig lösning – migrera till en fullständig SQL</span><span class="sxs-lookup"><span data-stu-id="ce65f-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="ce65f-169">I allmänhet är problemet jämförbar 10 GB-databasens storlek är inte längre tillräckligt för Azure AD Connect att synkronisera din lokala Active Directory till Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ce65f-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="ce65f-170">Vi rekommenderar att du istället använda den fullständiga versionen av SQLServer.</span><span class="sxs-lookup"><span data-stu-id="ce65f-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="ce65f-171">Du kan inte direkt ersätta en LocalDB i en befintlig Azure AD Connect-distribution med den fullständiga SQL-versionens databas.</span><span class="sxs-lookup"><span data-stu-id="ce65f-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="ce65f-172">Istället måste du distribuera en ny Azure AD Connect-server med den fullständiga versionen av SQL.</span><span class="sxs-lookup"><span data-stu-id="ce65f-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="ce65f-173">Vi rekommenderar att du gör en swingmigrering med den nya Azure AD Connect-servern (med SQL DB) distribuerad som en mellanlagringsserver bredvid den befintliga Azure AD Connect-servern (med LocalDB).</span><span class="sxs-lookup"><span data-stu-id="ce65f-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="ce65f-174">Instruktioner för hur du konfigurerar fjärr-SQL med Azure AD Connect finns i artikeln [Anpassad installation av Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="ce65f-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="ce65f-175">I artikeln [Azure AD Connect: Uppgradera från en tidigare version till den senaste](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration) finns det information om swingmigrering för Azure AD Connect-uppgradering.</span><span class="sxs-lookup"><span data-stu-id="ce65f-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ce65f-176">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="ce65f-176">Next steps</span></span>
<span data-ttu-id="ce65f-177">Läs mer om hur du [integrerar dina lokala identiteter med Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="ce65f-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
