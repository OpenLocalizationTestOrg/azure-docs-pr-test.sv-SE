---
title: "Azure AD Connect: Hur toorecover från LocalDB 10GB begränsa problemet | Microsoft Docs"
description: "Det här avsnittet beskrivs hur toorecover Azure AD Connect-synkronisering-tjänsten när den stöter på LocalDB 10GB begränsa problemet."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 7b8ce6e19b68837639017bb0315eda4b924d525a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-how-toorecover-from-localdb-10-gb-limit"></a><span data-ttu-id="0d4e2-103">Azure AD Connect: Hur toorecover från LocalDB 10 GB gränsen</span><span class="sxs-lookup"><span data-stu-id="0d4e2-103">Azure AD Connect: How toorecover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="0d4e2-104">Azure AD Connect kräver en SQL Server-databasen toostore identity-data.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-104">Azure AD Connect requires a SQL Server database toostore identity data.</span></span> <span data-ttu-id="0d4e2-105">Du kan använda hello standard SQL Server 2012 Express LocalDB installerad med Azure AD Connect, eller så kan du använda din egen fullständig SQL.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-105">You can either use hello default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="0d4e2-106">SQL Server Express har en storleksgräns på 10 GB.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="0d4e2-107">När du använder LocalDB och gränsen har uppnåtts kan synkroniseringstjänsten för Azure AD Connect inte längre starta eller synkronisera korrekt.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="0d4e2-108">Den här artikeln innehåller steg för återställning av hello.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-108">This article provides hello recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="0d4e2-109">Symtom</span><span class="sxs-lookup"><span data-stu-id="0d4e2-109">Symptoms</span></span>
<span data-ttu-id="0d4e2-110">Det finns två vanliga problem:</span><span class="sxs-lookup"><span data-stu-id="0d4e2-110">There are two common symptoms:</span></span>

* <span data-ttu-id="0d4e2-111">Azure AD Connect-synkroniseringstjänsten **körs** men inte toosynchronize med *”stoppats databas-disk-fullständiga”* fel.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-111">Azure AD Connect Synchronization Service **is running** but fails toosynchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="0d4e2-112">Azure AD Connect-synkroniseringstjänsten **är toostart**.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-112">Azure AD Connect Synchronization Service **is unable toostart**.</span></span> <span data-ttu-id="0d4e2-113">När du försöker toostart hello-tjänsten misslyckas med händelse 6323 och felmeddelandet *”hello servern påträffade ett fel eftersom SQLServer är slut på diskutrymme”.*</span><span class="sxs-lookup"><span data-stu-id="0d4e2-113">When you attempt toostart hello service, it fails with event 6323 and error message *"hello server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="0d4e2-114">Kortsiktig steg för återställning</span><span class="sxs-lookup"><span data-stu-id="0d4e2-114">Short-term recovery steps</span></span>
<span data-ttu-id="0d4e2-115">Det här avsnittet innehåller hello steg tooreclaim DB-utrymme som krävs för Azure AD Connect-synkroniseringstjänsten tooresume igen.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-115">This section provides hello steps tooreclaim DB space required for Azure AD Connect Synchronization Service tooresume operation.</span></span> <span data-ttu-id="0d4e2-116">hello stegen innefattar:</span><span class="sxs-lookup"><span data-stu-id="0d4e2-116">hello steps include:</span></span>
1. [<span data-ttu-id="0d4e2-117">Identifiera hello synkroniseringstjänsten status</span><span class="sxs-lookup"><span data-stu-id="0d4e2-117">Determine hello Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="0d4e2-118">Minska hello-databas</span><span class="sxs-lookup"><span data-stu-id="0d4e2-118">Shrink hello database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="0d4e2-119">Ta bort kör historikdata</span><span class="sxs-lookup"><span data-stu-id="0d4e2-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="0d4e2-120">Ange ett kortare kvarhållningsperiod för körningshistorik data</span><span class="sxs-lookup"><span data-stu-id="0d4e2-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-hello-synchronization-service-status"></a><span data-ttu-id="0d4e2-121">Identifiera hello synkroniseringstjänsten status</span><span class="sxs-lookup"><span data-stu-id="0d4e2-121">Determine hello Synchronization Service status</span></span>
<span data-ttu-id="0d4e2-122">Bestäm först om hello-synkroniseringstjänsten körs fortfarande eller inte:</span><span class="sxs-lookup"><span data-stu-id="0d4e2-122">First, determine whether hello Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="0d4e2-123">Logga in tooyour Azure AD Connect-servern som administratör.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-123">Log in tooyour Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="0d4e2-124">Gå för**Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-124">Go too**Service Control Manager**.</span></span>

3. <span data-ttu-id="0d4e2-125">Kontrollera hello status **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-125">Check hello status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="0d4e2-126">Om den körs inte stoppa eller starta om hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-126">If it is running, do not stop or restart hello service.</span></span> <span data-ttu-id="0d4e2-127">Hoppa över [förminskas hello databasen](#shrink-the-database) steget och gå för[ta bort kör historikdata](#delete-run-history-data) steg.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-127">Skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="0d4e2-128">Om den inte körs försöker du toostart hello service.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-128">If it is not running, try toostart hello service.</span></span> <span data-ttu-id="0d4e2-129">Om hello-tjänsten startar hoppa över [förminskas hello databasen](#shrink-the-database) steget och gå för[ta bort kör historikdata](#delete-run-history-data) steg.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-129">If hello service starts successfully, skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="0d4e2-130">Annars fortsätter du med [förminskas hello databasen](#shrink-the-database) steg.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-130">Otherwise, continue with [Shrink hello database](#shrink-the-database) step.</span></span>

### <a name="shrink-hello-database"></a><span data-ttu-id="0d4e2-131">Minska hello-databas</span><span class="sxs-lookup"><span data-stu-id="0d4e2-131">Shrink hello database</span></span>
<span data-ttu-id="0d4e2-132">Använd hello förminskas åtgärden toofree in tillräckligt med DB utrymme toostart hello synkroniseringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-132">Use hello Shrink operation toofree up enough DB space toostart hello Synchronization Service.</span></span> <span data-ttu-id="0d4e2-133">Det Frigör DB-utrymme genom att ta bort blanksteg i hello-databasen.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-133">It frees up DB space by removing whitespaces in hello database.</span></span> <span data-ttu-id="0d4e2-134">Det här steget är bästa eftersom det inte är säkert att du alltid återställa utrymme.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="0d4e2-135">toolearn mer om komprimeringsåtgärden igen den här artikeln [krympa en databas](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d4e2-135">toolearn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0d4e2-136">Hoppa över det här steget om du kan hämta hello synkroniseringstjänsten toorun.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-136">Skip this step if you can get hello Synchronization Service toorun.</span></span> <span data-ttu-id="0d4e2-137">Det rekommenderas inte tooshrink hello SQL-databas som den kan leda toopoor prestanda på grund av fragmentering av tooincreased.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-137">It is not recommended tooshrink hello SQL DB as it can lead toopoor performance due tooincreased fragmentation.</span></span>

<span data-ttu-id="0d4e2-138">hello hello-databas som skapats för Azure AD Connect heter **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-138">hello name of hello database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="0d4e2-139">tooperform en komprimeringsåtgärden, måste du logga antingen som hello sysadmin eller DBO hello-databasen.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-139">tooperform a Shrink operation, you must log in either as hello sysadmin or DBO of hello database.</span></span> <span data-ttu-id="0d4e2-140">Under installationen av Azure AD Connect har hello följande konton beviljats sysadmin-behörighet:</span><span class="sxs-lookup"><span data-stu-id="0d4e2-140">During Azure AD Connect installation, hello following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="0d4e2-141">Lokala administratörer</span><span class="sxs-lookup"><span data-stu-id="0d4e2-141">Local Administrators</span></span>
* <span data-ttu-id="0d4e2-142">hello-användarkonto som har använt toorun Azure AD Connect-installationen.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-142">hello user account that was used toorun Azure AD Connect installation.</span></span>
* <span data-ttu-id="0d4e2-143">hello Sync-tjänstkontot som används som hello operativsystem kontexten för Azure AD Connect-synkroniseringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-143">hello Sync Service account that is used as hello operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="0d4e2-144">hello gruppen ADSyncAdmins som skapades under installationen.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-144">hello local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="0d4e2-145">Säkerhetskopiera hello databasen genom att kopiera **ADSync.mdf** och **ADSync_log.ldf** filer som finns `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa säker plats.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-145">Back up hello database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa safe location.</span></span>

2. <span data-ttu-id="0d4e2-146">Starta en ny PowerShell-session.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="0d4e2-147">Navigera toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-147">Navigate toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="0d4e2-148">Starta **sqlcmd** utility genom att köra kommandot hello `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, med hjälp av hello autentiseringsuppgifter i en sysadmin eller hello databasen DBO.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-148">Start **sqlcmd** utility by running hello command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using hello credential of a sysadmin or hello database DBO.</span></span>

5. <span data-ttu-id="0d4e2-149">tooshrink hello databasen på hello sqlcmd-kommandotolk (1 >), ange `DBCC Shrinkdatabase(ADSync,1);`, följt av `GO` hello nästa rad.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-149">tooshrink hello database, at hello sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in hello next line.</span></span>

6. <span data-ttu-id="0d4e2-150">Försök igen toostart hello synkroniseringstjänsten om hello åtgärden lyckas.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-150">If hello operation is successful, try toostart hello Synchronization Service again.</span></span> <span data-ttu-id="0d4e2-151">Om du kan starta hello synkroniseringstjänsten gå för[ta bort kör historikdata](#delete-run-history-data) steg.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-151">If you can start hello Synchronization Service, go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="0d4e2-152">Om inte, kontakta supporten.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="0d4e2-153">Ta bort kör historikdata</span><span class="sxs-lookup"><span data-stu-id="0d4e2-153">Delete run history data</span></span>
<span data-ttu-id="0d4e2-154">Som standard behåller Azure AD Connect upp tooseven dagars kör historikdata.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-154">By default, Azure AD Connect retains up tooseven days’ worth of run history data.</span></span> <span data-ttu-id="0d4e2-155">I det här steget vi med att ta bort hello kör historik datautrymme tooreclaim DB så att Azure AD Connect-synkroniseringstjänsten kan starta synkronisera igen.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-155">In this step, we delete hello run history data tooreclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="0d4e2-156">Starta **Synchronization Service Manager** genom att gå tooSTART → synkroniseringstjänsten.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-156">Start **Synchronization Service Manager** by going tooSTART → Synchronization Service.</span></span>

2.  <span data-ttu-id="0d4e2-157">Gå toohello **Operations** fliken.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-157">Go toohello **Operations** tab.</span></span>

3.  <span data-ttu-id="0d4e2-158">Under **åtgärder**väljer **Rensa körs**...</span><span class="sxs-lookup"><span data-stu-id="0d4e2-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="0d4e2-159">Du kan antingen välja **avmarkera alla körningar** eller **Rensa körs innan... <date>**  alternativet.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="0d4e2-160">Vi rekommenderar att du börjar genom att avmarkera kör historikdata som är äldre än två dagar.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="0d4e2-161">Om du fortsätter toorun i DB storlek problemet och välj sedan hello **avmarkera alla körningar** alternativet.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-161">If you continue toorun into DB size issue, then choose hello **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="0d4e2-162">Ange ett kortare kvarhållningsperiod för körningshistorik data</span><span class="sxs-lookup"><span data-stu-id="0d4e2-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="0d4e2-163">Det här steget är tooreduce hello sannolikheten för att köra i hello 10 GB gränsen problemet efter flera synkroniseringscyklerna.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-163">This step is tooreduce hello likelihood of running into hello 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="0d4e2-164">Öppna en ny PowerShell-session.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="0d4e2-165">Kör `Get-ADSyncScheduler` och anteckna hello PurgeRunHistoryInterval-egenskap som anger hello aktuella Bevarandeperiod.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-165">Run `Get-ADSyncScheduler` and take note of hello PurgeRunHistoryInterval property, which specifies hello current retention period.</span></span>

3. <span data-ttu-id="0d4e2-166">Kör `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello kvarhållning period tootwo dagar.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello retention period tootwo days.</span></span> <span data-ttu-id="0d4e2-167">Justera hello kvarhållningsperiod efter behov.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-167">Adjust hello retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-toofull-sql"></a><span data-ttu-id="0d4e2-168">Långsiktig lösning – migrera toofull SQL</span><span class="sxs-lookup"><span data-stu-id="0d4e2-168">Long-term solution – Migrate toofull SQL</span></span>
<span data-ttu-id="0d4e2-169">I allmänhet hello problemet är jämförbar 10 GB-databasens storlek är inte längre tillräckliga för Azure AD Connect toosynchronize din lokala Active Directory tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-169">In general, hello issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect toosynchronize your on-premises Active Directory tooAzure AD.</span></span> <span data-ttu-id="0d4e2-170">Vi rekommenderar att du växla toousing hello fullständig version av SQLServer.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-170">It is recommended that you switch toousing hello full version of SQL server.</span></span> <span data-ttu-id="0d4e2-171">Du kan inte direkt ersätta hello LocalDB av en befintlig distribution av Azure AD Connect med hello-databas med hello fullständig version av SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-171">You cannot directly replace hello LocalDB of an existing Azure AD Connect deployment with hello database of hello full version of SQL.</span></span> <span data-ttu-id="0d4e2-172">I stället måste du distribuera en ny Azure AD Connect-server med hello fullständig version av SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0d4e2-172">Instead, you must deploy a new Azure AD Connect server with hello full version of SQL.</span></span> <span data-ttu-id="0d4e2-173">Vi rekommenderar att du gör en öppning migrering där hello ny Azure AD Connect-server (med SQL DB) distribueras som en fristående server, nästa toohello befintlig Azure AD Connect-server (med LocalDB).</span><span class="sxs-lookup"><span data-stu-id="0d4e2-173">It is recommended that you do a swing migration where hello new Azure AD Connect server (with SQL DB) is deployed as a staging server, next toohello existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="0d4e2-174">Anvisningar om hur tooconfigure fjärr-SQL med Azure AD Connect finns tooarticle [anpassad installation av Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="0d4e2-174">For instruction on how tooconfigure remote SQL with Azure AD Connect, refer tooarticle [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="0d4e2-175">Anvisningar för migrering av öppning för uppgraderingen av Azure AD Connect finns tooarticle [Azure AD Connect: uppgradera från en tidigare version toohello senaste](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="0d4e2-175">For instructions on swing migration for Azure AD Connect upgrade, refer tooarticle [Azure AD Connect: Upgrade from a previous version toohello latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0d4e2-176">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="0d4e2-176">Next steps</span></span>
<span data-ttu-id="0d4e2-177">Läs mer om hur du [integrerar dina lokala identiteter med Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="0d4e2-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
