---
title: "Certifikat förnyas för Office 365 och Azure AD-användare | Microsoft Docs"
description: "Den här artikeln förklarar hur du löser problem med e-postmeddelanden som meddelar dem om att förnya ett certifikat till Office 365-användare."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 7f1a3303eff9c413602e745b702baa659343eba6
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="f4fac-103">Förnya federationscertifikat för Office 365 och Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="f4fac-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="f4fac-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="f4fac-104">Overview</span></span>
<span data-ttu-id="f4fac-105">För lyckad federation mellan Azure Active Directory (Azure AD) och Active Directory Federation Services (AD FS) matchar de certifikat som används av AD FS för att signera säkerhetstoken till Azure AD det som har konfigurerats i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f4fac-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), the certificates used by AD FS to sign security tokens to Azure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="f4fac-106">Några matchningsfel kan leda till brutet förtroende.</span><span class="sxs-lookup"><span data-stu-id="f4fac-106">Any mismatch can lead to broken trust.</span></span> <span data-ttu-id="f4fac-107">Azure AD ser till att den här informationen hålls synkroniserade när du distribuerar AD FS och Webbprogramproxy (för åtkomst till extranät).</span><span class="sxs-lookup"><span data-stu-id="f4fac-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="f4fac-108">Den här artikeln innehåller ytterligare information för att hantera certifikat för tokensignering och hålla dem synkroniserade med Azure AD i följande fall:</span><span class="sxs-lookup"><span data-stu-id="f4fac-108">This article provides you additional information to manage your token signing certificates and keep them in sync with Azure AD, in the following cases:</span></span>

* <span data-ttu-id="f4fac-109">Du distribuerar inte Web Application Proxy och federationsmetadata är därför inte tillgänglig i extranätet.</span><span class="sxs-lookup"><span data-stu-id="f4fac-109">You are not deploying the Web Application Proxy, and therefore the federation metadata is not available in the extranet.</span></span>
* <span data-ttu-id="f4fac-110">Du använder inte standardkonfigurationen för AD FS för certifikat för tokensignering.</span><span class="sxs-lookup"><span data-stu-id="f4fac-110">You are not using the default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="f4fac-111">Du använder en tredjeparts identitetsprovider.</span><span class="sxs-lookup"><span data-stu-id="f4fac-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="f4fac-112">Standardkonfigurationen för AD FS för certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="f4fac-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="f4fac-113">Certifikat för tokensignering och token-dekryptering certifikat är vanligtvis självsignerade certifikat och är bra för ett år.</span><span class="sxs-lookup"><span data-stu-id="f4fac-113">The token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="f4fac-114">Som standard AD FS innehåller en automatisk förnyelse process som kallas **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="f4fac-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="f4fac-115">Om du använder AD FS 2.0 eller senare, Office 365 och Azure AD automatiskt uppdatera ditt certifikat innan den upphör.</span><span class="sxs-lookup"><span data-stu-id="f4fac-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-the-office-365-portal-or-an-email"></a><span data-ttu-id="f4fac-116">Förnyelse meddelande från Office 365-portalen eller ett e-postmeddelande</span><span class="sxs-lookup"><span data-stu-id="f4fac-116">Renewal notification from the Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="f4fac-117">Om du har fått ett e-postmeddelande eller en portal meddelande som ber dig att förnya certifikatet för Office finns [hantera ändringar i certifikat för tokensignering](#managecerts) att kontrollera om du behöver göra något.</span><span class="sxs-lookup"><span data-stu-id="f4fac-117">If you received an email or a portal notification asking you to renew your certificate for Office, see [Managing changes to token signing certificates](#managecerts) to check if you need to take any action.</span></span> <span data-ttu-id="f4fac-118">Microsoft är medveten om ett eventuellt problem som kan leda till meddelanden för förnyelse av certifikat som skickas, även om ingen åtgärd krävs.</span><span class="sxs-lookup"><span data-stu-id="f4fac-118">Microsoft is aware of a possible issue that can lead to notifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="f4fac-119">Azure AD försöker övervaka federationsmetadata och uppdatera certifikaten för tokensignering, som anges av dessa metadata.</span><span class="sxs-lookup"><span data-stu-id="f4fac-119">Azure AD attempts to monitor the federation metadata, and update the token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="f4fac-120">30 dagar före förfallodatum för certifikat för tokensignering kontrollerar Azure AD om nya certifikat är tillgängliga genom att avsöka federationsmetadata.</span><span class="sxs-lookup"><span data-stu-id="f4fac-120">30 days before the expiration of the token signing certificates, Azure AD checks if new certificates are available by polling the federation metadata.</span></span>

* <span data-ttu-id="f4fac-121">Om den kan har avsöka federationsmetadata och hämta de nya certifikaten, utfärdas utan e-postmeddelande eller en varning i Office 365-portalen för användaren.</span><span class="sxs-lookup"><span data-stu-id="f4fac-121">If it can successfully poll the federation metadata and retrieve the new certificates, no email notification or warning in the Office 365 portal is issued to the user.</span></span>
* <span data-ttu-id="f4fac-122">Om det går inte att hämta nya certifikat för tokensignering, antingen eftersom federationsmetadata kan inte nås eller automatisk förnyelse inte är aktiverat Azure AD utfärdar ett e-postmeddelande och en varning i Office 365-portalen.</span><span class="sxs-lookup"><span data-stu-id="f4fac-122">If it cannot retrieve the new token signing certificates, either because the federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in the Office 365 portal.</span></span>

![Office 365-portalen meddelande](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="f4fac-124">Om du använder AD FS för att garantera kontinuitet för företag, kontrollerar du att servrarna har följande uppdateringar så att autentiseringsfel för kända problem, inte sker.</span><span class="sxs-lookup"><span data-stu-id="f4fac-124">If you are using AD FS, to ensure business continuity, please verify that your servers have the following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="f4fac-125">Detta minskar kända AD FS-proxy serverproblem för förnyelse och framtida förnyelse punkter:</span><span class="sxs-lookup"><span data-stu-id="f4fac-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="f4fac-126">Server 2012 R2 - [Windows Server kan 2014-uppdateringen](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="f4fac-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="f4fac-127">Server 2008 R2 och 2012 - [autentisering via proxy misslyckas i Windows Server 2012 eller Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="f4fac-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="f4fac-128">Kontrollera om certifikat som behöver uppdateras<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="f4fac-128">Check if the certificates need to be updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-the-autocertificaterollover-state"></a><span data-ttu-id="f4fac-129">Steg 1: Kontrollera AutoCertificateRollover tillstånd</span><span class="sxs-lookup"><span data-stu-id="f4fac-129">Step 1: Check the AutoCertificateRollover state</span></span>
<span data-ttu-id="f4fac-130">Öppna PowerShell på AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="f4fac-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="f4fac-131">Kontrollera att värdet för AutoCertificateRollover har angetts till True.</span><span class="sxs-lookup"><span data-stu-id="f4fac-131">Check that the AutoCertificateRollover value is set to True.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="f4fac-133">Om du använder AD FS 2.0 kan du först köra Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="f4fac-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="f4fac-134">Steg 2: Kontrollera att AD FS och Azure AD är synkroniserade</span><span class="sxs-lookup"><span data-stu-id="f4fac-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="f4fac-135">Öppna Azure AD PowerShell-Kommandotolken på AD FS-servern och Anslut till Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f4fac-135">On your AD FS server, open the Azure AD PowerShell prompt, and connect to Azure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="f4fac-136">Du kan ladda ned Azure AD PowerShell [här](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4fac-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="f4fac-137">Kontrollera de certifikat som konfigurerats i AD FS och Azure AD litar på egenskaperna för den angivna domänen.</span><span class="sxs-lookup"><span data-stu-id="f4fac-137">Check the certificates configured in AD FS and Azure AD trust properties for the specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="f4fac-139">Om tumavtrycken i båda utdata matchar är ditt certifikat synkroniserade med Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f4fac-139">If the thumbprints in both the outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-to-expire"></a><span data-ttu-id="f4fac-140">Steg 3: Kontrollera om ditt certifikat upphör snart att gälla</span><span class="sxs-lookup"><span data-stu-id="f4fac-140">Step 3: Check if your certificate is about to expire</span></span>
<span data-ttu-id="f4fac-141">I resultatet av Get-MsolFederationProperty eller Get-AdfsCertificate, kontrollera datum under ”inte efter”.</span><span class="sxs-lookup"><span data-stu-id="f4fac-141">In the output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for the date under "Not After."</span></span> <span data-ttu-id="f4fac-142">Om datumet är mindre än 30 dagar direkt, bör du vidta åtgärder.</span><span class="sxs-lookup"><span data-stu-id="f4fac-142">If the date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="f4fac-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="f4fac-143">AutoCertificateRollover</span></span> | <span data-ttu-id="f4fac-144">Certifikat som är synkroniserade med Azure AD</span><span class="sxs-lookup"><span data-stu-id="f4fac-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="f4fac-145">Federationsmetadata är offentligt tillgänglig</span><span class="sxs-lookup"><span data-stu-id="f4fac-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="f4fac-146">Giltighetsperiod</span><span class="sxs-lookup"><span data-stu-id="f4fac-146">Validity</span></span> | <span data-ttu-id="f4fac-147">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="f4fac-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="f4fac-148">Ja</span><span class="sxs-lookup"><span data-stu-id="f4fac-148">Yes</span></span> |<span data-ttu-id="f4fac-149">Ja</span><span class="sxs-lookup"><span data-stu-id="f4fac-149">Yes</span></span> |<span data-ttu-id="f4fac-150">Ja</span><span class="sxs-lookup"><span data-stu-id="f4fac-150">Yes</span></span> |- |<span data-ttu-id="f4fac-151">Ingen åtgärd krävs.</span><span class="sxs-lookup"><span data-stu-id="f4fac-151">No action needed.</span></span> <span data-ttu-id="f4fac-152">Se [förnya certifikat för tokensignering certifikat automatiskt](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="f4fac-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="f4fac-153">Ja</span><span class="sxs-lookup"><span data-stu-id="f4fac-153">Yes</span></span> |<span data-ttu-id="f4fac-154">Nej</span><span class="sxs-lookup"><span data-stu-id="f4fac-154">No</span></span> |- |<span data-ttu-id="f4fac-155">Mindre än 15 dagar</span><span class="sxs-lookup"><span data-stu-id="f4fac-155">Less than 15 days</span></span> |<span data-ttu-id="f4fac-156">Förnya omedelbart.</span><span class="sxs-lookup"><span data-stu-id="f4fac-156">Renew immediately.</span></span> <span data-ttu-id="f4fac-157">Se [förnya certifikat för tokensignering certifikat manuellt](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="f4fac-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="f4fac-158">Nej</span><span class="sxs-lookup"><span data-stu-id="f4fac-158">No</span></span> |- |- |<span data-ttu-id="f4fac-159">Mindre än 30 dagar</span><span class="sxs-lookup"><span data-stu-id="f4fac-159">Less than 30 days</span></span> |<span data-ttu-id="f4fac-160">Förnya omedelbart.</span><span class="sxs-lookup"><span data-stu-id="f4fac-160">Renew immediately.</span></span> <span data-ttu-id="f4fac-161">Se [förnya certifikat för tokensignering certifikat manuellt](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="f4fac-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="f4fac-162">\[-] Spelar ingen roll</span><span class="sxs-lookup"><span data-stu-id="f4fac-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="f4fac-163">Förnya certifikatet för tokensignering automatiskt (rekommenderas)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="f4fac-163">Renew the token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="f4fac-164">Du behöver inte utföra några manuella steg om båda av följande stämmer:</span><span class="sxs-lookup"><span data-stu-id="f4fac-164">You don't need to perform any manual steps if both of the following are true:</span></span>

* <span data-ttu-id="f4fac-165">Du har distribuerat Web Application Proxy som kan ge åtkomst till federationsmetadata från extranätet.</span><span class="sxs-lookup"><span data-stu-id="f4fac-165">You have deployed Web Application Proxy, which can enable access to the federation metadata from the extranet.</span></span>
* <span data-ttu-id="f4fac-166">Du använder standardkonfigurationen för AD FS (AutoCertificateRollover är aktiverat).</span><span class="sxs-lookup"><span data-stu-id="f4fac-166">You are using the AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="f4fac-167">Kontrollera följande för att bekräfta att certifikatet kan uppdateras automatiskt.</span><span class="sxs-lookup"><span data-stu-id="f4fac-167">Check the following to confirm that the certificate can be automatically updated.</span></span>

<span data-ttu-id="f4fac-168">**1. AD FS-egenskapen AutoCertificateRollover måste anges till True.**</span><span class="sxs-lookup"><span data-stu-id="f4fac-168">**1. The AD FS property AutoCertificateRollover must be set to True.**</span></span> <span data-ttu-id="f4fac-169">Detta anger att AD FS kommer automatiskt att generera nya certifikat för tokensignering och tokendekryptering certifikat, innan gammalt de som går ut.</span><span class="sxs-lookup"><span data-stu-id="f4fac-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before the old ones expire.</span></span>

<span data-ttu-id="f4fac-170">**2. Metadata för AD FS-federation är offentligt tillgänglig.**</span><span class="sxs-lookup"><span data-stu-id="f4fac-170">**2. The AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="f4fac-171">Kontrollera att din federationsmetadata är offentligt tillgänglig genom att navigera till följande URL från en dator på internet (utanför företagsnätverket):</span><span class="sxs-lookup"><span data-stu-id="f4fac-171">Check that your federation metadata is publicly accessible by navigating to the following URL from a computer on the public internet (off of the corporate network):</span></span>

<span data-ttu-id="f4fac-172">https:// (your_FS_name) /federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="f4fac-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="f4fac-173">där `(your_FS_name) `ersätts med värden federationstjänstnamnet används i din organisation, till exempel fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="f4fac-173">where `(your_FS_name) `is replaced with the federation service host name your organization uses, such as fs.contoso.com.</span></span>  <span data-ttu-id="f4fac-174">Om du ska kunna kontrollera båda av de här inställningarna, du behöver inte göra något annat.</span><span class="sxs-lookup"><span data-stu-id="f4fac-174">If you are able to verify both of these settings successfully, you do not have to do anything else.</span></span>  

<span data-ttu-id="f4fac-175">Exempel: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="f4fac-175">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="f4fac-176">Förnya certifikatet för tokensignering manuellt<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="f4fac-176">Renew the token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="f4fac-177">Du kan välja att förnya certifikaten för tokensignering manuellt.</span><span class="sxs-lookup"><span data-stu-id="f4fac-177">You may choose to renew the token signing certificates manually.</span></span> <span data-ttu-id="f4fac-178">Till exempel kan följande scenarier fungera bättre för manuell förnyelse:</span><span class="sxs-lookup"><span data-stu-id="f4fac-178">For example, the following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="f4fac-179">Token signera certifikat är inte självsignerade certifikat.</span><span class="sxs-lookup"><span data-stu-id="f4fac-179">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="f4fac-180">Den vanligaste orsaken till detta är att din organisation hanterar AD FS-certifikat som registrerats från en organisations certifikatutfärdare.</span><span class="sxs-lookup"><span data-stu-id="f4fac-180">The most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="f4fac-181">Nätverkssäkerhet tillåter inte federationsmetadata ska vara offentligt tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="f4fac-181">Network security does not allow the federation metadata to be publicly available.</span></span>

<span data-ttu-id="f4fac-182">I dessa scenarier varje gång du uppdaterar certifikat för tokensignering måste du uppdatera din Office 365-domän med hjälp av PowerShell-kommando, Update-MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="f4fac-182">In these scenarios, every time you update the token signing certificates, you must also update your Office 365 domain by using the PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="f4fac-183">Steg 1: Kontrollera att AD FS har nya certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="f4fac-183">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="f4fac-184">**Icke-standardkonfigurationen**</span><span class="sxs-lookup"><span data-stu-id="f4fac-184">**Non-default configuration**</span></span>

<span data-ttu-id="f4fac-185">Om du använder en icke-förvalt konfiguration av AD FS (där **AutoCertificateRollover** är inställd på **FALSKT**), använder du troligtvis anpassade certifikat (inte självsignerade).</span><span class="sxs-lookup"><span data-stu-id="f4fac-185">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set to **False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="f4fac-186">Mer information om hur du förnyar AD FS-certifikat för tokensignering finns [vägledning för kunder som inte använder AD FS självsignerade certifikat](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="f4fac-186">For more information about how to renew the AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="f4fac-187">**Federationsmetadata är inte tillgänglig**</span><span class="sxs-lookup"><span data-stu-id="f4fac-187">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="f4fac-188">Å andra sidan, om **AutoCertificateRollover** är inställd på **SANT**, men din federationsmetadata är inte offentligt tillgänglig, kontrollera först att nya certifikat för tokensignering har genererats av AD FS.</span><span class="sxs-lookup"><span data-stu-id="f4fac-188">On the other hand, if **AutoCertificateRollover** is set to **True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="f4fac-189">Bekräfta att du har nya certifikaten för tokensignering genom att utföra följande steg:</span><span class="sxs-lookup"><span data-stu-id="f4fac-189">Confirm you have new token signing certificates by taking the following steps:</span></span>

1. <span data-ttu-id="f4fac-190">Kontrollera att du har loggat in till den primära AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="f4fac-190">Verify that you are logged on to the primary AD FS server.</span></span>
2. <span data-ttu-id="f4fac-191">Kontrollera de aktuella signeringscertifikat i AD FS genom att öppna ett PowerShell-kommandofönster och köra följande kommando:</span><span class="sxs-lookup"><span data-stu-id="f4fac-191">Check the current signing certificates in AD FS by opening a PowerShell command window, and running the following command:</span></span>

    <span data-ttu-id="f4fac-192">PS C:\>Get-ADFSCertificate – CertificateType certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="f4fac-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="f4fac-193">Om du använder AD FS 2.0, bör du köra Add-Pssnapin Microsoft.Adfs.Powershell först.</span><span class="sxs-lookup"><span data-stu-id="f4fac-193">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="f4fac-194">Granska kommandoutdata på alla certifikat i listan.</span><span class="sxs-lookup"><span data-stu-id="f4fac-194">Look at the command output at any certificates listed.</span></span> <span data-ttu-id="f4fac-195">Om AD FS har genererat ett nytt certifikat, bör du se två certifikat i utdata: för vilka den **IsPrimary** värdet är **True** och **NotAfter** datumet ligger inom fem dagar och ett som **IsPrimary** är **FALSKT** och **NotAfter** handlar om ett år i framtiden.</span><span class="sxs-lookup"><span data-stu-id="f4fac-195">If AD FS has generated a new certificate, you should see two certificates in the output: one for which the **IsPrimary** value is **True** and the **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in the future.</span></span>
4. <span data-ttu-id="f4fac-196">Om du bara ser ett certifikat och **NotAfter** datumet ligger inom fem dagar, måste du generera ett nytt certifikat.</span><span class="sxs-lookup"><span data-stu-id="f4fac-196">If you only see one certificate, and the **NotAfter** date is within 5 days, you need to generate a new certificate.</span></span>
5. <span data-ttu-id="f4fac-197">Om du vill skapa ett nytt certifikat kör du följande kommando i Kommandotolken PowerShell: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="f4fac-197">To generate a new certificate, execute the following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="f4fac-198">Kontrollera uppdateringen genom att köra följande kommando igen: PS C:\>Get-ADFSCertificate – CertificateType certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="f4fac-198">Verify the update by running the following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="f4fac-199">Två certifikat ska visas nu, ett som har en **NotAfter** datumet ungefär ett år i framtiden, och som den **IsPrimary** värdet är **FALSKT**.</span><span class="sxs-lookup"><span data-stu-id="f4fac-199">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in the future, and for which the **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-the-new-token-signing-certificates-for-the-office-365-trust"></a><span data-ttu-id="f4fac-200">Steg 2: Uppdatera den nya token som signerar certifikat för Office 365-förtroende</span><span class="sxs-lookup"><span data-stu-id="f4fac-200">Step 2: Update the new token signing certificates for the Office 365 trust</span></span>
<span data-ttu-id="f4fac-201">Uppdatera Office 365 med den nya token som signerar certifikat som ska användas för förtroendet på följande sätt.</span><span class="sxs-lookup"><span data-stu-id="f4fac-201">Update Office 365 with the new token signing certificates to be used for the trust, as follows.</span></span>

1. <span data-ttu-id="f4fac-202">Öppna Microsoft Azure Active Directory-modulen för Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f4fac-202">Open the Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="f4fac-203">Kör $cred = Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="f4fac-203">Run $cred=Get-Credential.</span></span> <span data-ttu-id="f4fac-204">När denna cmdlet efterfrågar autentiseringsuppgifter, skriver du cloud service administratörskontots autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="f4fac-204">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="f4fac-205">Kör Anslut MsolService – autentiseringsuppgifter $cred.</span><span class="sxs-lookup"><span data-stu-id="f4fac-205">Run Connect-MsolService –Credential $cred.</span></span> <span data-ttu-id="f4fac-206">Denna cmdlet ansluter till Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="f4fac-206">This cmdlet connects you to the cloud service.</span></span> <span data-ttu-id="f4fac-207">Skapa en kontext som ansluter till Molntjänsten krävs innan du kör ytterligare cmdlets som installerats av verktyget.</span><span class="sxs-lookup"><span data-stu-id="f4fac-207">Creating a context that connects you to the cloud service is required before running any of the additional cmdlets installed by the tool.</span></span>
4. <span data-ttu-id="f4fac-208">Om du kör kommandona på en dator som inte är den primära federationsservern i AD FS, kör Set-MSOLAdfscontext-datorn <AD FS primary server>, där <AD FS primary server> är det interna FQDN-namnet på den primära AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="f4fac-208">If you are running these commands on a computer that is not the AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is the internal FQDN name of the primary AD FS server.</span></span> <span data-ttu-id="f4fac-209">Denna cmdlet skapar en kontext som ansluter till AD FS.</span><span class="sxs-lookup"><span data-stu-id="f4fac-209">This cmdlet creates a context that connects you to AD FS.</span></span>
5. <span data-ttu-id="f4fac-210">Kör Update MSOLFederatedDomain – DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="f4fac-210">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="f4fac-211">Denna cmdlet uppdaterar inställningarna från AD FS i Molntjänsten och konfigurerar en förtroenderelation mellan två.</span><span class="sxs-lookup"><span data-stu-id="f4fac-211">This cmdlet updates the settings from AD FS into the cloud service, and configures the trust relationship between the two.</span></span>

> [!NOTE]
> <span data-ttu-id="f4fac-212">Om du behöver stöd för flera toppnivådomäner, till exempel contoso.com och fabrikam.com, måste du använda den **SupportMultipleDomain** växel med alla cmdlets.</span><span class="sxs-lookup"><span data-stu-id="f4fac-212">If you need to support multiple top-level domains, such as contoso.com and fabrikam.com, you must use the **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="f4fac-213">Mer information finns i [stöd för flera domäner på översta nivån](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="f4fac-213">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="f4fac-214">Reparera Azure AD-förtroende med hjälp av Azure AD Connect<a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="f4fac-214">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="f4fac-215">Om du har konfigurerat dina AD FS-servergrupp och Azure AD-förtroende med hjälp av Azure AD Connect kan du använda Azure AD Connect för att identifiera om du behöver vidta några åtgärder för certifikat för tokensignering.</span><span class="sxs-lookup"><span data-stu-id="f4fac-215">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect to detect if you need to take any action for your token signing certificates.</span></span> <span data-ttu-id="f4fac-216">Du kan använda Azure AD Connect för att göra det om du behöver förnya certifikat.</span><span class="sxs-lookup"><span data-stu-id="f4fac-216">If you need to renew the certificates, you can use Azure AD Connect to do so.</span></span>

<span data-ttu-id="f4fac-217">Mer information finns i [reparera förtroendet](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="f4fac-217">For more information, see [Repairing the trust](active-directory-aadconnect-federation-management.md).</span></span>
