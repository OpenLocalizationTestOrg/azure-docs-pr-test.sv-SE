---
title: "aaaCertificate förnyelse för Office 365 och Azure AD-användare | Microsoft Docs"
description: "Den här artikeln förklarar tooOffice 365 användare hur tooresolve problem med e-postmeddelanden som meddelar dem om att förnya ett certifikat."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b9b309e06949dc5488cd628650be413f366ed347
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="86695-103">Förnya federationscertifikat för Office 365 och Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="86695-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="86695-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="86695-104">Overview</span></span>
<span data-ttu-id="86695-105">För lyckad federation mellan Azure Active Directory (Azure AD) och Active Directory Federation Services (AD FS) matchar hello-certifikat som används av AD FS toosign säkerhet token tooAzure AD det som har konfigurerats i Azure AD.</span><span class="sxs-lookup"><span data-stu-id="86695-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), hello certificates used by AD FS toosign security tokens tooAzure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="86695-106">Några matchningsfel kan leda toobroken förtroende.</span><span class="sxs-lookup"><span data-stu-id="86695-106">Any mismatch can lead toobroken trust.</span></span> <span data-ttu-id="86695-107">Azure AD ser till att den här informationen hålls synkroniserade när du distribuerar AD FS och Webbprogramproxy (för åtkomst till extranät).</span><span class="sxs-lookup"><span data-stu-id="86695-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="86695-108">Den här artikeln innehåller ytterligare information toomanage certifikat för tokensignering och hålla dem synkroniserade med Azure AD i hello följande fall:</span><span class="sxs-lookup"><span data-stu-id="86695-108">This article provides you additional information toomanage your token signing certificates and keep them in sync with Azure AD, in hello following cases:</span></span>

* <span data-ttu-id="86695-109">Du distribuerar inte hello Web Application Proxy och därför hello federationsmetadata är inte tillgänglig i hello extranät.</span><span class="sxs-lookup"><span data-stu-id="86695-109">You are not deploying hello Web Application Proxy, and therefore hello federation metadata is not available in hello extranet.</span></span>
* <span data-ttu-id="86695-110">Du använder inte hello standardkonfigurationen av AD FS för certifikat för tokensignering.</span><span class="sxs-lookup"><span data-stu-id="86695-110">You are not using hello default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="86695-111">Du använder en tredjeparts identitetsprovider.</span><span class="sxs-lookup"><span data-stu-id="86695-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="86695-112">Standardkonfigurationen för AD FS för certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="86695-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="86695-113">hello tokensignering token dekryptera certifikat är vanligtvis självsignerade certifikat och är bra för ett år.</span><span class="sxs-lookup"><span data-stu-id="86695-113">hello token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="86695-114">Som standard AD FS innehåller en automatisk förnyelse process som kallas **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="86695-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="86695-115">Om du använder AD FS 2.0 eller senare, Office 365 och Azure AD automatiskt uppdatera ditt certifikat innan den upphör.</span><span class="sxs-lookup"><span data-stu-id="86695-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-hello-office-365-portal-or-an-email"></a><span data-ttu-id="86695-116">Förnyelse meddelande från hello Office 365-portalen eller ett e-postmeddelande</span><span class="sxs-lookup"><span data-stu-id="86695-116">Renewal notification from hello Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="86695-117">Om du har fått ett e-postmeddelande eller en portal meddelande som ber dig toorenew ditt certifikat för Office, se [hantera ändras tootoken signeringscertifikat](#managecerts) toocheck om du behöver tootake något.</span><span class="sxs-lookup"><span data-stu-id="86695-117">If you received an email or a portal notification asking you toorenew your certificate for Office, see [Managing changes tootoken signing certificates](#managecerts) toocheck if you need tootake any action.</span></span> <span data-ttu-id="86695-118">Microsoft är medveten om ett eventuellt problem som kan leda till toonotifications för förnyelse av certifikat som skickas, även om ingen åtgärd krävs.</span><span class="sxs-lookup"><span data-stu-id="86695-118">Microsoft is aware of a possible issue that can lead toonotifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="86695-119">Azure AD försöker toomonitor hello federationsmetadata och uppdatera hello certifikaten för tokensignering som anges av dessa metadata.</span><span class="sxs-lookup"><span data-stu-id="86695-119">Azure AD attempts toomonitor hello federation metadata, and update hello token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="86695-120">30 dagar före hello förfallodatum för certifikat för tokensignering hello kontrollerar Azure AD om nya certifikat är tillgängliga genom att avsöka hello federationsmetadata.</span><span class="sxs-lookup"><span data-stu-id="86695-120">30 days before hello expiration of hello token signing certificates, Azure AD checks if new certificates are available by polling hello federation metadata.</span></span>

* <span data-ttu-id="86695-121">Om den kan har avsöka hello federationsmetadata och hämta hello nya certifikat, utfärdas utan e-postmeddelande eller en varning i hello Office 365-portalen toohello användare.</span><span class="sxs-lookup"><span data-stu-id="86695-121">If it can successfully poll hello federation metadata and retrieve hello new certificates, no email notification or warning in hello Office 365 portal is issued toohello user.</span></span>
* <span data-ttu-id="86695-122">Om det går inte att hämta hello nya certifikaten för tokensignering, antingen eftersom hello federationsmetadata kan inte nås eller automatisk förnyelse inte är aktiverat Azure AD utfärdar ett e-postmeddelande och en varning i hello Office 365-portalen.</span><span class="sxs-lookup"><span data-stu-id="86695-122">If it cannot retrieve hello new token signing certificates, either because hello federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in hello Office 365 portal.</span></span>

![Office 365-portalen meddelande](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="86695-124">Om du använder AD FS, tooensure affärskontinuitet, kontrollerar du att servrarna har hello efter uppdateringar så att autentiseringsfel för kända problem, inte sker.</span><span class="sxs-lookup"><span data-stu-id="86695-124">If you are using AD FS, tooensure business continuity, please verify that your servers have hello following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="86695-125">Detta minskar kända AD FS-proxy serverproblem för förnyelse och framtida förnyelse punkter:</span><span class="sxs-lookup"><span data-stu-id="86695-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="86695-126">Server 2012 R2 - [Windows Server kan 2014-uppdateringen](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="86695-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="86695-127">Server 2008 R2 och 2012 - [autentisering via proxy misslyckas i Windows Server 2012 eller Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="86695-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="86695-128">Kontrollera om hello certifikat måste toobe uppdateras<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="86695-128">Check if hello certificates need toobe updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-hello-autocertificaterollover-state"></a><span data-ttu-id="86695-129">Steg 1: Kontrollera hello AutoCertificateRollover tillstånd</span><span class="sxs-lookup"><span data-stu-id="86695-129">Step 1: Check hello AutoCertificateRollover state</span></span>
<span data-ttu-id="86695-130">Öppna PowerShell på AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="86695-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="86695-131">Kontrollera att hello AutoCertificateRollover har värdet tooTrue.</span><span class="sxs-lookup"><span data-stu-id="86695-131">Check that hello AutoCertificateRollover value is set tooTrue.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="86695-133">Om du använder AD FS 2.0 kan du först köra Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="86695-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="86695-134">Steg 2: Kontrollera att AD FS och Azure AD är synkroniserade</span><span class="sxs-lookup"><span data-stu-id="86695-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="86695-135">Öppna hello Azure AD PowerShell-Kommandotolken på AD FS-servern och Anslut tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="86695-135">On your AD FS server, open hello Azure AD PowerShell prompt, and connect tooAzure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="86695-136">Du kan ladda ned Azure AD PowerShell [här](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="86695-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="86695-137">Kontrollera hello certifikat i AD FS och Azure AD-förtroende egenskaper för hello angiven domän.</span><span class="sxs-lookup"><span data-stu-id="86695-137">Check hello certificates configured in AD FS and Azure AD trust properties for hello specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="86695-139">Om hello tumavtryck i både hello utdata matchning certifikaten är synkroniserade med Azure AD.</span><span class="sxs-lookup"><span data-stu-id="86695-139">If hello thumbprints in both hello outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-tooexpire"></a><span data-ttu-id="86695-140">Steg 3: Kontrollera om ditt certifikat är om tooexpire</span><span class="sxs-lookup"><span data-stu-id="86695-140">Step 3: Check if your certificate is about tooexpire</span></span>
<span data-ttu-id="86695-141">Hello utdata av Get-MsolFederationProperty eller Get-AdfsCertificate och kontrollera hello datum under ”inte efter”.</span><span class="sxs-lookup"><span data-stu-id="86695-141">In hello output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for hello date under "Not After."</span></span> <span data-ttu-id="86695-142">Om hello datum är mindre än 30 dagar direkt, bör du vidta åtgärder.</span><span class="sxs-lookup"><span data-stu-id="86695-142">If hello date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="86695-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="86695-143">AutoCertificateRollover</span></span> | <span data-ttu-id="86695-144">Certifikat som är synkroniserade med Azure AD</span><span class="sxs-lookup"><span data-stu-id="86695-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="86695-145">Federationsmetadata är offentligt tillgänglig</span><span class="sxs-lookup"><span data-stu-id="86695-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="86695-146">Giltighetsperiod</span><span class="sxs-lookup"><span data-stu-id="86695-146">Validity</span></span> | <span data-ttu-id="86695-147">Åtgärd</span><span class="sxs-lookup"><span data-stu-id="86695-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="86695-148">Ja</span><span class="sxs-lookup"><span data-stu-id="86695-148">Yes</span></span> |<span data-ttu-id="86695-149">Ja</span><span class="sxs-lookup"><span data-stu-id="86695-149">Yes</span></span> |<span data-ttu-id="86695-150">Ja</span><span class="sxs-lookup"><span data-stu-id="86695-150">Yes</span></span> |- |<span data-ttu-id="86695-151">Ingen åtgärd krävs.</span><span class="sxs-lookup"><span data-stu-id="86695-151">No action needed.</span></span> <span data-ttu-id="86695-152">Se [förnya certifikat för tokensignering certifikat automatiskt](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="86695-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="86695-153">Ja</span><span class="sxs-lookup"><span data-stu-id="86695-153">Yes</span></span> |<span data-ttu-id="86695-154">Nej</span><span class="sxs-lookup"><span data-stu-id="86695-154">No</span></span> |- |<span data-ttu-id="86695-155">Mindre än 15 dagar</span><span class="sxs-lookup"><span data-stu-id="86695-155">Less than 15 days</span></span> |<span data-ttu-id="86695-156">Förnya omedelbart.</span><span class="sxs-lookup"><span data-stu-id="86695-156">Renew immediately.</span></span> <span data-ttu-id="86695-157">Se [förnya certifikat för tokensignering certifikat manuellt](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="86695-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="86695-158">Nej</span><span class="sxs-lookup"><span data-stu-id="86695-158">No</span></span> |- |- |<span data-ttu-id="86695-159">Mindre än 30 dagar</span><span class="sxs-lookup"><span data-stu-id="86695-159">Less than 30 days</span></span> |<span data-ttu-id="86695-160">Förnya omedelbart.</span><span class="sxs-lookup"><span data-stu-id="86695-160">Renew immediately.</span></span> <span data-ttu-id="86695-161">Se [förnya certifikat för tokensignering certifikat manuellt](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="86695-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="86695-162">\[-] Spelar ingen roll</span><span class="sxs-lookup"><span data-stu-id="86695-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="86695-163">Förnya hello certifikatet för tokensignering automatiskt (rekommenderas)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="86695-163">Renew hello token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="86695-164">Du behöver inte tooperform alla manuella steg om båda hello följande är sant:</span><span class="sxs-lookup"><span data-stu-id="86695-164">You don't need tooperform any manual steps if both of hello following are true:</span></span>

* <span data-ttu-id="86695-165">Du har distribuerat Web Application Proxy, vilket kan ge åtkomst toohello federationsmetadata från hello extranät.</span><span class="sxs-lookup"><span data-stu-id="86695-165">You have deployed Web Application Proxy, which can enable access toohello federation metadata from hello extranet.</span></span>
* <span data-ttu-id="86695-166">Du använder standardkonfigurationen för hello AD FS (AutoCertificateRollover är aktiverat).</span><span class="sxs-lookup"><span data-stu-id="86695-166">You are using hello AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="86695-167">Kontrollera hello följande tooconfirm som hello certifikat kan uppdateras automatiskt.</span><span class="sxs-lookup"><span data-stu-id="86695-167">Check hello following tooconfirm that hello certificate can be automatically updated.</span></span>

<span data-ttu-id="86695-168">**1. hello AD FS-egenskapen AutoCertificateRollover måste anges tooTrue.**</span><span class="sxs-lookup"><span data-stu-id="86695-168">**1. hello AD FS property AutoCertificateRollover must be set tooTrue.**</span></span> <span data-ttu-id="86695-169">Detta anger att AD FS kommer automatiskt att generera nya certifikat för tokensignering och tokendekryptering certifikat innan hello gamla de som går ut.</span><span class="sxs-lookup"><span data-stu-id="86695-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before hello old ones expire.</span></span>

<span data-ttu-id="86695-170">**2. hello AD FS-federationsmetadata är allmänt tillgänglig.**</span><span class="sxs-lookup"><span data-stu-id="86695-170">**2. hello AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="86695-171">Kontrollera att din federationsmetadata är offentligt tillgänglig genom att gå toohello följande URL: en från en dator hello offentliga internet (från hello företagsnätverket):</span><span class="sxs-lookup"><span data-stu-id="86695-171">Check that your federation metadata is publicly accessible by navigating toohello following URL from a computer on hello public internet (off of hello corporate network):</span></span>

<span data-ttu-id="86695-172">https:// (your_FS_name) /federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="86695-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="86695-173">där `(your_FS_name) `ersätts med hello federation service värdnamn används i din organisation, till exempel fs.contoso.com.  Om du kan tooverify båda av de här inställningarna, behöver du inte toodo någonting annat.</span><span class="sxs-lookup"><span data-stu-id="86695-173">where `(your_FS_name) `is replaced with hello federation service host name your organization uses, such as fs.contoso.com.  If you are able tooverify both of these settings successfully, you do not have toodo anything else.</span></span>  

<span data-ttu-id="86695-174">Exempel: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="86695-174">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="86695-175">Förnya hello certifikatet för tokensignering manuellt<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="86695-175">Renew hello token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="86695-176">Du kan välja toorenew hello certifikat för tokensignering manuellt.</span><span class="sxs-lookup"><span data-stu-id="86695-176">You may choose toorenew hello token signing certificates manually.</span></span> <span data-ttu-id="86695-177">Till exempel kan hello följande scenarier fungera bättre för manuell förnyelse:</span><span class="sxs-lookup"><span data-stu-id="86695-177">For example, hello following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="86695-178">Token signera certifikat är inte självsignerade certifikat.</span><span class="sxs-lookup"><span data-stu-id="86695-178">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="86695-179">hello vanligaste anledningen är att din organisation hanterar AD FS-certifikat som registrerats från en organisations certifikatutfärdare.</span><span class="sxs-lookup"><span data-stu-id="86695-179">hello most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="86695-180">Nätverkssäkerhet tillåter inte hello federation metadata toobe offentligt tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="86695-180">Network security does not allow hello federation metadata toobe publicly available.</span></span>

<span data-ttu-id="86695-181">I dessa scenarier varje gång du uppdaterar hello-certifikat för tokensignering måste du uppdatera din Office 365-domän med hjälp av hello PowerShell-kommando uppdatering MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="86695-181">In these scenarios, every time you update hello token signing certificates, you must also update your Office 365 domain by using hello PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="86695-182">Steg 1: Kontrollera att AD FS har nya certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="86695-182">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="86695-183">**Icke-standardkonfigurationen**</span><span class="sxs-lookup"><span data-stu-id="86695-183">**Non-default configuration**</span></span>

<span data-ttu-id="86695-184">Om du använder en icke-förvalt konfiguration av AD FS (där **AutoCertificateRollover** har angetts för**FALSKT**), använder du troligtvis anpassade certifikat (inte självsignerade).</span><span class="sxs-lookup"><span data-stu-id="86695-184">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set too**False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="86695-185">Mer information om hur toorenew hello AD FS-tokensignering certifikat finns [vägledning för kunder som inte använder AD FS självsignerade certifikat](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="86695-185">For more information about how toorenew hello AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="86695-186">**Federationsmetadata är inte tillgänglig**</span><span class="sxs-lookup"><span data-stu-id="86695-186">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="86695-187">Hej å andra sidan, om **AutoCertificateRollover** har angetts för**SANT**, men din federationsmetadata är inte offentligt tillgänglig, kontrollera först att nya certifikat för tokensignering har genererats av AD FS.</span><span class="sxs-lookup"><span data-stu-id="86695-187">On hello other hand, if **AutoCertificateRollover** is set too**True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="86695-188">Bekräfta att du har nya certifikaten för tokensignering av tar hello följande steg:</span><span class="sxs-lookup"><span data-stu-id="86695-188">Confirm you have new token signing certificates by taking hello following steps:</span></span>

1. <span data-ttu-id="86695-189">Kontrollera att du är inloggad på toohello primär AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="86695-189">Verify that you are logged on toohello primary AD FS server.</span></span>
2. <span data-ttu-id="86695-190">Kontrollera hello aktuella signeringscertifikat i AD FS genom att öppna ett PowerShell-kommandofönster och kör följande kommando hello:</span><span class="sxs-lookup"><span data-stu-id="86695-190">Check hello current signing certificates in AD FS by opening a PowerShell command window, and running hello following command:</span></span>

    <span data-ttu-id="86695-191">PS C:\>Get-ADFSCertificate – CertificateType certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="86695-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="86695-192">Om du använder AD FS 2.0, bör du köra Add-Pssnapin Microsoft.Adfs.Powershell först.</span><span class="sxs-lookup"><span data-stu-id="86695-192">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="86695-193">Titta på hello kommandoutdata på alla certifikat i listan.</span><span class="sxs-lookup"><span data-stu-id="86695-193">Look at hello command output at any certificates listed.</span></span> <span data-ttu-id="86695-194">Om AD FS har genererat ett nytt certifikat, bör du se två certifikat i hello utdata: en för vilka hello **IsPrimary** värdet är **SANT** och hello **NotAfter** datum är inom fem dagar och ett som **IsPrimary** är **FALSKT** och **NotAfter** handlar om ett år i hello framtida.</span><span class="sxs-lookup"><span data-stu-id="86695-194">If AD FS has generated a new certificate, you should see two certificates in hello output: one for which hello **IsPrimary** value is **True** and hello **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in hello future.</span></span>
4. <span data-ttu-id="86695-195">Om du bara finns ett certifikat och hello **NotAfter** datumet ligger inom fem dagar, måste du toogenerate ett nytt certifikat.</span><span class="sxs-lookup"><span data-stu-id="86695-195">If you only see one certificate, and hello **NotAfter** date is within 5 days, you need toogenerate a new certificate.</span></span>
5. <span data-ttu-id="86695-196">toogenerate ett nytt certifikat, kör följande kommando i Kommandotolken PowerShell hello: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="86695-196">toogenerate a new certificate, execute hello following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="86695-197">Kontrollera hello uppdateringen genom att köra följande kommando igen hello: PS C:\>Get-ADFSCertificate – CertificateType certifikat för tokensignering</span><span class="sxs-lookup"><span data-stu-id="86695-197">Verify hello update by running hello following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="86695-198">Två certifikat ska visas nu, ett som har en **NotAfter** datum ungefär ett år i hello framtida och för vilka hello **IsPrimary** värdet är **FALSKT**.</span><span class="sxs-lookup"><span data-stu-id="86695-198">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in hello future, and for which hello **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-hello-new-token-signing-certificates-for-hello-office-365-trust"></a><span data-ttu-id="86695-199">Steg 2: Uppdatera hello nya certifikaten för tokensignering för hello Office 365-förtroende</span><span class="sxs-lookup"><span data-stu-id="86695-199">Step 2: Update hello new token signing certificates for hello Office 365 trust</span></span>
<span data-ttu-id="86695-200">Uppdatera Office 365 med hello nya token signering certifikat toobe används för hello förtroende på följande sätt.</span><span class="sxs-lookup"><span data-stu-id="86695-200">Update Office 365 with hello new token signing certificates toobe used for hello trust, as follows.</span></span>

1. <span data-ttu-id="86695-201">Öppna hello Microsoft Azure Active Directory-modulen för Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="86695-201">Open hello Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="86695-202">Kör $cred = Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="86695-202">Run $cred=Get-Credential.</span></span> <span data-ttu-id="86695-203">När denna cmdlet efterfrågar autentiseringsuppgifter, skriver du cloud service administratörskontots autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="86695-203">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="86695-204">Kör Anslut MsolService – autentiseringsuppgifter $cred. Denna cmdlet ansluter toohello Molntjänsten.</span><span class="sxs-lookup"><span data-stu-id="86695-204">Run Connect-MsolService –Credential $cred. This cmdlet connects you toohello cloud service.</span></span> <span data-ttu-id="86695-205">Skapa en kontext som ansluter du toohello Molntjänsten krävs innan du kör hello ytterligare cmdlets som installerats av hello-verktyget.</span><span class="sxs-lookup"><span data-stu-id="86695-205">Creating a context that connects you toohello cloud service is required before running any of hello additional cmdlets installed by hello tool.</span></span>
4. <span data-ttu-id="86695-206">Om du kör kommandona på en dator som inte är primär hello AD FS-federationsserver, kör Set-MSOLAdfscontext-datorn <AD FS primary server>, där <AD FS primary server> är hello interna FQDN-namnet för hello primär AD FS-servern.</span><span class="sxs-lookup"><span data-stu-id="86695-206">If you are running these commands on a computer that is not hello AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is hello internal FQDN name of hello primary AD FS server.</span></span> <span data-ttu-id="86695-207">Denna cmdlet skapar en kontext som ansluter du tooAD FS.</span><span class="sxs-lookup"><span data-stu-id="86695-207">This cmdlet creates a context that connects you tooAD FS.</span></span>
5. <span data-ttu-id="86695-208">Kör Update MSOLFederatedDomain – DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="86695-208">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="86695-209">Denna cmdlet hello inställningar från AD FS i hello Molntjänsten för uppdateringar och konfigurerar hello förtroenderelation mellan hello två.</span><span class="sxs-lookup"><span data-stu-id="86695-209">This cmdlet updates hello settings from AD FS into hello cloud service, and configures hello trust relationship between hello two.</span></span>

> [!NOTE]
> <span data-ttu-id="86695-210">Om du behöver toosupport flera toppnivådomäner, till exempel contoso.com och fabrikam.com, måste du använda hello **SupportMultipleDomain** växel med alla cmdlets.</span><span class="sxs-lookup"><span data-stu-id="86695-210">If you need toosupport multiple top-level domains, such as contoso.com and fabrikam.com, you must use hello **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="86695-211">Mer information finns i [stöd för flera domäner på översta nivån](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="86695-211">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="86695-212">Reparera Azure AD-förtroende med hjälp av Azure AD Connect<a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="86695-212">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="86695-213">Om du har konfigurerat dina AD FS-servergrupp och Azure AD-förtroende med hjälp av Azure AD Connect kan du använda Azure AD Connect toodetect om du behöver tootake någon åtgärd för certifikat för tokensignering.</span><span class="sxs-lookup"><span data-stu-id="86695-213">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect toodetect if you need tootake any action for your token signing certificates.</span></span> <span data-ttu-id="86695-214">Om du behöver toorenew hello certifikat kan använda du Azure AD Connect toodo så.</span><span class="sxs-lookup"><span data-stu-id="86695-214">If you need toorenew hello certificates, you can use Azure AD Connect toodo so.</span></span>

<span data-ttu-id="86695-215">Mer information finns i [reparera hello förtroende](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="86695-215">For more information, see [Repairing hello trust](active-directory-aadconnect-federation-management.md).</span></span>
