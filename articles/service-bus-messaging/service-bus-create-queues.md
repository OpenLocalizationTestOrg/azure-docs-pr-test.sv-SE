---
title: "aaaWrite program som använder Azure Service Bus-köer | Microsoft Docs"
description: "Hur toowrite en enkel kö-baserade program som använder Azure Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 754d91b3-1426-405e-84b4-fd36d65b114a
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/07/2017
ms.author: sethm
ms.openlocfilehash: 93b75902a06becd6e33e05298e09f5669d0e2aef
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="create-applications-that-use-service-bus-queues"></a><span data-ttu-id="66119-103">Skapa appar som använder Service Bus-köer</span><span class="sxs-lookup"><span data-stu-id="66119-103">Create applications that use Service Bus queues</span></span>
<span data-ttu-id="66119-104">Det här avsnittet beskriver Service Bus-köer och visar hur toowrite en enkel kö-baserade program som använder Service Bus.</span><span class="sxs-lookup"><span data-stu-id="66119-104">This topic describes Service Bus queues and shows how toowrite a simple queue-based application that uses Service Bus.</span></span>

<span data-ttu-id="66119-105">Anta från hello world varor där försäljningsdata från enskilda Point-of-Sale (POS) terminaler måste vara dirigeras tooan lagersystem som använder hello data toodetermine när börs har toobe fylls i.</span><span class="sxs-lookup"><span data-stu-id="66119-105">Consider a scenario from hello world of retail in which sales data from individual Point-of-Sale (POS) terminals must be routed tooan inventory management system that uses hello data toodetermine when stock has toobe replenished.</span></span> <span data-ttu-id="66119-106">Den här lösningen använder Service Bus-meddelanden för hello kommunikation mellan hello terminaler och hello lagersystem, enligt beskrivningen i följande bild hello:</span><span class="sxs-lookup"><span data-stu-id="66119-106">This solution uses Service Bus messaging for hello communication between hello terminals and hello inventory management system, as illustrated in hello following figure:</span></span>

![Bild 1-Service Bus-köer](./media/service-bus-create-queues/IC657161.gif)

<span data-ttu-id="66119-108">Varje POS terminal rapporterar försäljning data genom att skicka meddelanden toohello **DataCollectionQueue**.</span><span class="sxs-lookup"><span data-stu-id="66119-108">Each POS terminal reports its sales data by sending messages toohello **DataCollectionQueue**.</span></span> <span data-ttu-id="66119-109">Dessa meddelanden ligger kvar i kön tills de har hämtats av hello lagersystem.</span><span class="sxs-lookup"><span data-stu-id="66119-109">These messages remain in this queue until they are retrieved by hello inventory management system.</span></span> <span data-ttu-id="66119-110">Det här mönstret kallas ofta *asynkrona meddelanden*eftersom hello POS terminal saknar toowait på ett svar från hello inventering management system toocontinue bearbetning.</span><span class="sxs-lookup"><span data-stu-id="66119-110">This pattern is often termed *asynchronous messaging*, because hello POS terminal does not have toowait for a reply from hello inventory management system toocontinue processing.</span></span>

## <a name="why-queuing"></a><span data-ttu-id="66119-111">Varför queuing?</span><span class="sxs-lookup"><span data-stu-id="66119-111">Why queuing?</span></span>
<span data-ttu-id="66119-112">Överväg att hello fördelarna med att använda en kö i det här scenariot i stället för att hello POS terminaler prata direkt (synkront) toohello inventera hanteringssystemet innan vi tittar på hello-kod som är nödvändiga tooset in det här programmet.</span><span class="sxs-lookup"><span data-stu-id="66119-112">Before we look at hello code that is required tooset up this application, consider hello advantages of using a queue in this scenario instead of having hello POS terminals talk directly (synchronously) toohello inventory management system.</span></span>

### <a name="temporal-decoupling"></a><span data-ttu-id="66119-113">Tidsbestämd Frikoppling</span><span class="sxs-lookup"><span data-stu-id="66119-113">Temporal decoupling</span></span>
<span data-ttu-id="66119-114">Med hello mönstret för asynkrona meddelanden, producenter och konsumenter inte har toobe online på hello samtidigt.</span><span class="sxs-lookup"><span data-stu-id="66119-114">With hello asynchronous messaging pattern, producers and consumers do not have toobe online at hello same time.</span></span> <span data-ttu-id="66119-115">hello meddelandeinfrastrukturen lagrar på ett tillförlitligt sätt meddelanden tills hello konsumerande parten är redo tooreceive dem.</span><span class="sxs-lookup"><span data-stu-id="66119-115">hello messaging infrastructure reliably stores messages until hello consuming party is ready tooreceive them.</span></span> <span data-ttu-id="66119-116">Det innebär att hello komponenter i hello distribuerade program kan frikopplas, antingen frivilligt; till exempel för underhåll, eller på grund av tooa komponentkrasch, utan att påverka hello hela systemet.</span><span class="sxs-lookup"><span data-stu-id="66119-116">This means hello components of hello distributed application can be disconnected, either voluntarily; for example, for maintenance, or due tooa component crash, without affecting hello whole system.</span></span> <span data-ttu-id="66119-117">Dessutom hello förbrukning av programmet kan inte ha toobe online vid vissa tidpunkter på dagen hello.</span><span class="sxs-lookup"><span data-stu-id="66119-117">Furthermore, hello consuming application may only have toobe online during certain times of hello day.</span></span> <span data-ttu-id="66119-118">Till exempel i detta scenario retail hello lagersystem kan inte ha toocome online efter hello slut hello arbetsdag.</span><span class="sxs-lookup"><span data-stu-id="66119-118">For example, in this retail scenario, hello inventory management system may only have toocome online after hello end of hello business day.</span></span>

### <a name="load-leveling"></a><span data-ttu-id="66119-119">Belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="66119-119">Load leveling</span></span>
<span data-ttu-id="66119-120">I många program varierar systembelastningen över tiden, bör hello bearbetningstid som krävs för varje arbetsenhet vanligtvis är konstant.</span><span class="sxs-lookup"><span data-stu-id="66119-120">In many applications system load varies over time, whereas hello processing time required for each unit of work is typically constant.</span></span> <span data-ttu-id="66119-121">Medlingen mellan meddelandet producenter och konsumenter med en kö innebär som hello användningsprogram (hello worker) har bara toobe etableras tooservice medelvärdet läsa in i stället för en belastning.</span><span class="sxs-lookup"><span data-stu-id="66119-121">Intermediating message producers and consumers with a queue means that hello consuming application (hello worker) only has toobe provisioned tooservice an average load rather than a peak load.</span></span> <span data-ttu-id="66119-122">hello kön hello djup växer och kontrakt som hello inkommande belastningen varierar.</span><span class="sxs-lookup"><span data-stu-id="66119-122">hello depth of hello queue will grow and contract as hello incoming load varies.</span></span> <span data-ttu-id="66119-123">Detta sparar direkt pengar med beaktande toohello mängd infrastruktur krävs tooservice hello programinläsning.</span><span class="sxs-lookup"><span data-stu-id="66119-123">This directly saves money with regard toohello amount of infrastructure required tooservice hello application load.</span></span>

![Service Bus-köer bild 2](./media/service-bus-create-queues/IC657162.gif)

### <a name="load-balancing"></a><span data-ttu-id="66119-125">Belastningsutjämning</span><span class="sxs-lookup"><span data-stu-id="66119-125">Load balancing</span></span>
<span data-ttu-id="66119-126">Som hello belastningen ökar kan fler arbetsprocesser kan tillagda tooread från hello worker kö.</span><span class="sxs-lookup"><span data-stu-id="66119-126">As hello load increases, more worker processes can be added tooread from hello worker queue.</span></span> <span data-ttu-id="66119-127">Varje meddelande bearbetas av bara en av hello arbetsprocesser.</span><span class="sxs-lookup"><span data-stu-id="66119-127">Each message is processed by only one of hello worker processes.</span></span> <span data-ttu-id="66119-128">Dessutom kan den här pull-baserade belastningsutjämning, för optimal användning av hello worker datorer även om hello worker datorer skiljer sig med beaktande tooprocessing power som de hämtar meddelanden med sina egna högsta hastighet.</span><span class="sxs-lookup"><span data-stu-id="66119-128">Furthermore, this pull-based load balancing allows for optimum usage of hello worker computers even if hello worker computers differ with regard tooprocessing power, as they will pull messages at their own maximum rate.</span></span> <span data-ttu-id="66119-129">Det här mönstret kallas ofta hello konkurrerande konsument-mönster.</span><span class="sxs-lookup"><span data-stu-id="66119-129">This pattern is often termed hello competing consumer pattern.</span></span>

![Service Bus-köer bild 3](./media/service-bus-create-queues/IC657163.gif)

### <a name="loose-coupling"></a><span data-ttu-id="66119-131">Lösa kopplingar</span><span class="sxs-lookup"><span data-stu-id="66119-131">Loose coupling</span></span>
<span data-ttu-id="66119-132">Med hjälp av message queuing toointermediate mellan meddelandeproducenter och konsumenter innehåller en inbyggd lösa kopplingar mellan hello komponenter.</span><span class="sxs-lookup"><span data-stu-id="66119-132">Using message queuing toointermediate between message producers and consumers provides an intrinsic loose coupling between hello components.</span></span> <span data-ttu-id="66119-133">Eftersom producenter och konsumenter inte är medvetna om varandra, kan en konsument uppgraderas utan någon inverkan på hello producenten.</span><span class="sxs-lookup"><span data-stu-id="66119-133">Because producers and consumers are not aware of each other, a consumer can be upgraded without having any effect on hello producer.</span></span> <span data-ttu-id="66119-134">Dessutom kan hello messaging topologi utvecklas utan att påverka hello befintliga slutpunkter.</span><span class="sxs-lookup"><span data-stu-id="66119-134">Furthermore, hello messaging topology can evolve without affecting hello existing endpoints.</span></span> <span data-ttu-id="66119-135">Kommer vi att diskutera detta mer när vi pratar om Publicera/prenumerera.</span><span class="sxs-lookup"><span data-stu-id="66119-135">We’ll discuss this more when we talk about publish/subscribe.</span></span>

## <a name="show-me-hello-code"></a><span data-ttu-id="66119-136">Visa hello kod</span><span class="sxs-lookup"><span data-stu-id="66119-136">Show me hello code</span></span>
<span data-ttu-id="66119-137">Hej följande avsnitt visar hur toouse Service Bus toobuild det här programmet.</span><span class="sxs-lookup"><span data-stu-id="66119-137">hello following section shows how toouse Service Bus toobuild this application.</span></span>

### <a name="sign-up-for-an-azure-account"></a><span data-ttu-id="66119-138">Registrera dig för ett Azure-konto</span><span class="sxs-lookup"><span data-stu-id="66119-138">Sign up for an Azure account</span></span>
<span data-ttu-id="66119-139">Du behöver ett Azure-konto i ordning toostart arbeta med Service Bus.</span><span class="sxs-lookup"><span data-stu-id="66119-139">You’ll need an Azure account in order toostart working with Service Bus.</span></span> <span data-ttu-id="66119-140">Om du inte redan har en, du kan registrera dig för ett kostnadsfritt konto [här](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span><span class="sxs-lookup"><span data-stu-id="66119-140">If you do not already have one, you can sign up for a free account [here](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span></span>

### <a name="create-a-namespace"></a><span data-ttu-id="66119-141">Skapa ett namnområde</span><span class="sxs-lookup"><span data-stu-id="66119-141">Create a namespace</span></span>
<span data-ttu-id="66119-142">När du har en prenumeration kan du [skapa ett namnområde för tjänsten](service-bus-create-namespace-portal.md).</span><span class="sxs-lookup"><span data-stu-id="66119-142">Once you have a subscription, you can [create a service namespace](service-bus-create-namespace-portal.md).</span></span> <span data-ttu-id="66119-143">Varje namnområde som fungerar som en omfattningsbehållare för en uppsättning Service Bus-entiteter.</span><span class="sxs-lookup"><span data-stu-id="66119-143">Each namespace acts as a scoping container for a set of Service Bus entities.</span></span> <span data-ttu-id="66119-144">Ge din nya namnområdet ett unikt namn för alla Service Bus-konton.</span><span class="sxs-lookup"><span data-stu-id="66119-144">Give your new namespace a unique name across all Service Bus accounts.</span></span> 

### <a name="install-hello-nuget-package"></a><span data-ttu-id="66119-145">Installera hello NuGet-paketet</span><span class="sxs-lookup"><span data-stu-id="66119-145">Install hello NuGet package</span></span>
<span data-ttu-id="66119-146">toouse hello Service Bus-namnrymd, ett program måste referera till hello Service Bus-sammansättningen, särskilt Microsoft.ServiceBus.dll.</span><span class="sxs-lookup"><span data-stu-id="66119-146">toouse hello Service Bus namespace, an application must reference hello Service Bus assembly, specifically Microsoft.ServiceBus.dll.</span></span> <span data-ttu-id="66119-147">Du hittar den här sammansättningen som en del av hello Microsoft Azure SDK och hello hämtningen är tillgänglig på hello [hämtningssidan för Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="66119-147">You can find this assembly as part of hello Microsoft Azure SDK, and hello download is available at hello [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="66119-148">Dock hello [Service Bus NuGet-paketet](https://www.nuget.org/packages/WindowsAzure.ServiceBus) är hello enklaste sättet tooget hello Service Bus-API och tooconfigure ditt program med alla hello Service Bus-beroenden.</span><span class="sxs-lookup"><span data-stu-id="66119-148">However, hello [Service Bus NuGet package](https://www.nuget.org/packages/WindowsAzure.ServiceBus) is hello easiest way tooget hello Service Bus API and tooconfigure your application with all of hello Service Bus dependencies.</span></span>

### <a name="create-hello-queue"></a><span data-ttu-id="66119-149">Skapa hello kö</span><span class="sxs-lookup"><span data-stu-id="66119-149">Create hello queue</span></span>
<span data-ttu-id="66119-150">Hanteringsåtgärder för Service Bus meddelandeentiteter (köer och publicera/prenumerera avsnitt) utförs via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) klass.</span><span class="sxs-lookup"><span data-stu-id="66119-150">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class.</span></span> <span data-ttu-id="66119-151">Service Bus använder en [delade signatur åtkomst (SAS)](service-bus-sas.md) baserat säkerhetsmodell.</span><span class="sxs-lookup"><span data-stu-id="66119-151">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="66119-152">Hej [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) klassen representerar en leverantör av säkerhetstoken med inbyggda fabriksmetoder som returnerar vissa välkända tokenleverantörer.</span><span class="sxs-lookup"><span data-stu-id="66119-152">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="66119-153">Vi använder en [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) metoden toohold hello SAS-autentiseringsuppgifter.</span><span class="sxs-lookup"><span data-stu-id="66119-153">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method toohold hello SAS credentials.</span></span> <span data-ttu-id="66119-154">Hej [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instans sedan konstruerade med hello basadressen för hello Service Bus-namnrymd och hello tokenleverantör.</span><span class="sxs-lookup"><span data-stu-id="66119-154">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is then constructed with hello base address of hello Service Bus namespace and hello token provider.</span></span>

<span data-ttu-id="66119-155">Hej [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) klassen innehåller metoder toocreate, räkna upp och ta bort meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="66119-155">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="66119-156">Hej koden som visas här visas hur hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) -instansen är skapas och används toocreate hello **DataCollectionQueue** kön.</span><span class="sxs-lookup"><span data-stu-id="66119-156">hello code that is shown here shows how hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is created and used toocreate hello **DataCollectionQueue** queue.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", 
                "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = 
    TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = 
    new NamespaceManager(uri, tokenProvider);
namespaceManager.CreateQueue("DataCollectionQueue");
```

<span data-ttu-id="66119-157">Observera att det finns överlagringar av hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) metoden som gör att egenskaper för hello kön toobe justerade.</span><span class="sxs-lookup"><span data-stu-id="66119-157">Note that there are overloads of hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) method that enable properties of hello queue toobe tuned.</span></span> <span data-ttu-id="66119-158">Du kan till exempel ange hello time to live (TTL) Standardvärdet för meddelanden som skickas toohello kön.</span><span class="sxs-lookup"><span data-stu-id="66119-158">For example, you can set hello default time-to-live (TTL) value for messages sent toohello queue.</span></span>

### <a name="send-messages-toohello-queue"></a><span data-ttu-id="66119-159">Skicka meddelanden toohello kön</span><span class="sxs-lookup"><span data-stu-id="66119-159">Send messages toohello queue</span></span>
<span data-ttu-id="66119-160">För körning åtgärder på Service Bus-enheter. till exempel skicka och ta emot meddelanden, ett program måste först skapa en [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) objekt.</span><span class="sxs-lookup"><span data-stu-id="66119-160">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) object.</span></span> <span data-ttu-id="66119-161">Liknande toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class, hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instans skapas från hello basadress av hello tjänstens namnområde och hello tokenleverantör.</span><span class="sxs-lookup"><span data-stu-id="66119-161">Similar toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class, hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance is created from hello base address of hello service namespace and hello token provider.</span></span>

```csharp
 BrokeredMessage bm = new BrokeredMessage(salesData);
 bm.Label = "SalesReport";
 bm.Properties["StoreName"] = "Redmond";
 bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="66119-162">Meddelanden som skickas till och tas emot från Service Bus-köer är instanser av hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) klass.</span><span class="sxs-lookup"><span data-stu-id="66119-162">Messages sent to, and received from Service Bus queues are instances of hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="66119-163">Den här klassen består av en uppsättning standardegenskaper (t.ex [etikett](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) och [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), en ordlista som används toohold programegenskaper och en brödtext med godtyckliga programdata.</span><span class="sxs-lookup"><span data-stu-id="66119-163">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used toohold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="66119-164">Ett program kan konfigurera hello brödtext genom att passera i någon typ av serialiserbara objekt (hello följande exempel skickas i en **SalesData** objekt som representerar hello försäljningsdata från hello POS terminal), som använder hello [ DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello-objekt.</span><span class="sxs-lookup"><span data-stu-id="66119-164">An application can set hello body by passing in any serializable object (hello following example passes in a **SalesData** object that represents hello sales data from hello POS terminal), which will use hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello object.</span></span> <span data-ttu-id="66119-165">Du kan också en [dataströmmen](https://msdn.microsoft.com/library/system.io.stream.aspx) objekt kan anges.</span><span class="sxs-lookup"><span data-stu-id="66119-165">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

<span data-ttu-id="66119-166">Hej toosend meddelanden av enklaste sättet-tooa som ges kö, i vårt fall hello **DataCollectionQueue**, är toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate en [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) objekt direkt från hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instans.</span><span class="sxs-lookup"><span data-stu-id="66119-166">hello easiest way toosend messages tooa given queue, in our case hello **DataCollectionQueue**, is toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance.</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionQueue");
sender.Send(bm);
```

### <a name="receiving-messages-from-hello-queue"></a><span data-ttu-id="66119-167">Ta emot meddelanden från kön hello</span><span class="sxs-lookup"><span data-stu-id="66119-167">Receiving messages from hello queue</span></span>
<span data-ttu-id="66119-168">tooreceive meddelanden från hello kön, som du kan använda en [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objekt som du skapar direkt från hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) med [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="66119-168">tooreceive messages from hello queue, you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="66119-169">Meddelandet mottagare kan arbeta i två olika lägen: **ReceiveAndDelete** och **PeekLock**.</span><span class="sxs-lookup"><span data-stu-id="66119-169">Message receivers can work in two different modes: **ReceiveAndDelete** and **PeekLock**.</span></span> <span data-ttu-id="66119-170">Hej [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) anges när hello meddelandet mottagaren har skapats som en parameter toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) anropa.</span><span class="sxs-lookup"><span data-stu-id="66119-170">hello [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) is set when hello message receiver is created, as a parameter toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) call.</span></span>

<span data-ttu-id="66119-171">När du använder hello **ReceiveAndDelete** läge hello får är en engångsåtgärd, det vill säga när Service Bus tar emot hello begäran, den markerar hello meddelandet som Förbrukat och returnerar den toohello program.</span><span class="sxs-lookup"><span data-stu-id="66119-171">When using hello **ReceiveAndDelete** mode, hello receive is a single-shot operation; that is, when Service Bus receives hello request, it marks hello message as being consumed and returns it toohello application.</span></span> <span data-ttu-id="66119-172">**ReceiveAndDelete** läge är hello enklaste modellen och fungerar bäst för scenarier där hello program kan tolerera icke-bearbetning av ett meddelande om ett fel toooccur.</span><span class="sxs-lookup"><span data-stu-id="66119-172">**ReceiveAndDelete** mode is hello simplest model and works best for scenarios in which hello application can tolerate not processing a message if a failure were toooccur.</span></span> <span data-ttu-id="66119-173">toounderstand, Föreställ i vilka hello konsumenten problem hello mottagning av begäran och sedan kraschar innan bearbetningen.</span><span class="sxs-lookup"><span data-stu-id="66119-173">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="66119-174">Eftersom Service Bus markerad hello meddelandet som Förbrukat, när hello programmet startas om och börjar förbruka meddelanden igen, att ha missat hello meddelandet som förbrukades innan kraschen hello.</span><span class="sxs-lookup"><span data-stu-id="66119-174">Since Service Bus marked hello message as being consumed, when hello application restarts and starts consuming messages again, it will have missed hello message that was consumed before hello crash.</span></span>

<span data-ttu-id="66119-175">I **PeekLock** läge hello får blir en åtgärd i två steg, vilket gör det möjligt toosupport program som inte tolererar att ett meddelande saknas.</span><span class="sxs-lookup"><span data-stu-id="66119-175">In **PeekLock** mode, hello receive becomes a two-stage operation, which makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="66119-176">När Service Bus tar emot hello begäran hittar hello nästa meddelande toobe förbrukas, låser det tooprevent andra användare tar emot det och returnerar sedan toohello program.</span><span class="sxs-lookup"><span data-stu-id="66119-176">When Service Bus receives hello request, it finds hello next message toobe consumed, locks it tooprevent other consumers receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="66119-177">När hello programmet har avslutat bearbetningen hello-meddelande (eller lagrar det på ett tillförlitligt sätt för framtida bearbetning), Slutför hello andra steget i hello får processen genom att anropa [Slutför](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) på emot hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="66119-177">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) on hello received message.</span></span> <span data-ttu-id="66119-178">När Service Bus ser hello [Slutför](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) anrop, markeras hello-meddelande som används.</span><span class="sxs-lookup"><span data-stu-id="66119-178">When Service Bus sees hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) call, it marks hello message as being consumed.</span></span>

<span data-ttu-id="66119-179">Två resultat är möjliga.</span><span class="sxs-lookup"><span data-stu-id="66119-179">Two other outcomes are possible.</span></span> <span data-ttu-id="66119-180">Först om programmet hello inte tooprocess Hej meddelande av någon anledning, kan det anropa [Avbryt](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) för hello tog emot meddelande (i stället för [Slutför](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span><span class="sxs-lookup"><span data-stu-id="66119-180">First, if hello application is unable tooprocess hello message for some reason, it can call [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) on hello received message (instead of [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span></span> <span data-ttu-id="66119-181">Detta gör att Service Bus toounlock hello-meddelande och göra den tillgänglig toobe tas emot igen, antingen genom att hello samma konsumenten eller av en annan Slutför konsument.</span><span class="sxs-lookup"><span data-stu-id="66119-181">This causes Service Bus toounlock hello message and make it available toobe received again, either by hello same consumer or by another completing consumer.</span></span> <span data-ttu-id="66119-182">Andra: det finns en tidsgräns som är associerade med hello Lås och om hello programmet inte kan bearbeta hello-meddelande innan hello tidsgränsen för låsning går ut (till exempel om hello programmet kraschar), kommer Service Bus att låsa upp hello meddelandet och gör den tillgänglig toobe tas emot igen (i praktiken utför en [Avbryt](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) åtgärden som standard).</span><span class="sxs-lookup"><span data-stu-id="66119-182">Second, there is a time-out associated with hello lock and if hello application cannot process hello message before hello lock time-out expires (for example, if hello application crashes), then Service Bus will unlock hello message and make it available toobe received again (essentially performing an [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operation by default).</span></span>

<span data-ttu-id="66119-183">Observera att om hello programmet kraschar efter att den bearbetar hello-meddelande, men före hello [Slutför](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) begäran gjordes blir hello-meddelande levereras på nytt toohello program när den startas om.</span><span class="sxs-lookup"><span data-stu-id="66119-183">Note that if hello application crashes after it processes hello message but before hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) request was issued, hello message will be redelivered toohello application when it restarts.</span></span> <span data-ttu-id="66119-184">Detta kallas ofta * minst en gång * bearbetning.</span><span class="sxs-lookup"><span data-stu-id="66119-184">This is often termed *At Least Once * processing.</span></span> <span data-ttu-id="66119-185">Detta innebär att varje meddelande bearbetas minst en gång men i vissa situationer hello samma meddelande levereras.</span><span class="sxs-lookup"><span data-stu-id="66119-185">This means that each message will be processed at least once but in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="66119-186">Om hello scenariot inte tolererar duplicerad bearbetning, krävs ytterligare logik i hello programmet toodetect dubbletter.</span><span class="sxs-lookup"><span data-stu-id="66119-186">If hello scenario cannot tolerate duplicate processing, then additional logic is required in hello application toodetect duplicates.</span></span> <span data-ttu-id="66119-187">Detta kan uppnås baserat på hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) -egenskapen för hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="66119-187">This can be achieved based on hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) property of hello message.</span></span> <span data-ttu-id="66119-188">hello värdet på egenskapen förblir konstant under alla leveransförsök.</span><span class="sxs-lookup"><span data-stu-id="66119-188">hello value of this property remains constant across delivery attempts.</span></span> <span data-ttu-id="66119-189">Detta kallas *exakt en gång* bearbetning.</span><span class="sxs-lookup"><span data-stu-id="66119-189">This is termed *Exactly Once* processing.</span></span>

<span data-ttu-id="66119-190">hello koden som visas här tar emot och bearbetar ett meddelande med hello **PeekLock** läge, som är hello standard om inget [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) värde anges explicit.</span><span class="sxs-lookup"><span data-stu-id="66119-190">hello code that is shown here receives and processes a message using hello **PeekLock** mode, which is hello default if no [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) value is explicitly provided.</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionQueue");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

### <a name="use-hello-queue-client"></a><span data-ttu-id="66119-191">Använda hello kö-klient</span><span class="sxs-lookup"><span data-stu-id="66119-191">Use hello queue client</span></span>
<span data-ttu-id="66119-192">Hej exempel tidigare i det här avsnittet skapas [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) och [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objekt direkt från hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend och ta emot meddelanden från hello kö respektive.</span><span class="sxs-lookup"><span data-stu-id="66119-192">hello examples earlier in this section created [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) and [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objects directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend and receive messages from hello queue, respectively.</span></span> <span data-ttu-id="66119-193">En annan metod är toouse en [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) objekt, som stöder både skicka och ta emot åtgärder i tillägg toomore avancerade funktioner, till exempel sessioner.</span><span class="sxs-lookup"><span data-stu-id="66119-193">An alternative approach is toouse a [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) object, which supports both send and receive operations in addition toomore advanced features, such as sessions.</span></span>

```csharp
QueueClient queueClient = factory.CreateQueueClient("DataCollectionQueue");
queueClient.Send(bm);

BrokeredMessage message = queueClient.Receive();

try
{
    ProcessMessage(message);
    message.Complete();
}
catch (Exception e)
{
    message.Abandon();
} 
```

## <a name="next-steps"></a><span data-ttu-id="66119-194">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="66119-194">Next steps</span></span>
<span data-ttu-id="66119-195">Nu när du har lärt dig grunderna hello köer finns [skapa program som använder Service Bus-ämnen och prenumerationer](service-bus-create-topics-subscriptions.md) toocontinue diskussionen med hello Publicera/prenumerera funktionerna i Service Bus-ämnen och prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="66119-195">Now that you've learned hello basics of queues, see [Create applications that use Service Bus topics and subscriptions](service-bus-create-topics-subscriptions.md) toocontinue this discussion using hello publish/subscribe capabilities of Service Bus topics and subscriptions.</span></span>

