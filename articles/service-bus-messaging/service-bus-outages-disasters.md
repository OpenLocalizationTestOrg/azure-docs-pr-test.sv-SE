---
title: aaaInsulating Azure Service Bus program mot avbrott och katastrofer | Microsoft Docs
description: "Här beskrivs tekniker som du kan använda tooprotect program mot ett potentiella avbrott i Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: 349b4968456c9f15375753d83495246f5a3ddfdb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="c5dbf-103">Metodtips för program mot Service Bus-avbrott och katastrofer isolering</span><span class="sxs-lookup"><span data-stu-id="c5dbf-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="c5dbf-104">Verksamhetskritiska program måste köras kontinuerligt, även i hello förekomst av oplanerade avbrott eller katastrofer.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-104">Mission-critical applications must operate continuously, even in hello presence of unplanned outages or disasters.</span></span> <span data-ttu-id="c5dbf-105">Det här avsnittet beskrivs metoder du kan använda tooprotect Service Bus program mot en potentiella avbrott eller katastrof.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-105">This topic describes techniques you can use tooprotect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="c5dbf-106">Ett avbrott har definierats som hello temporär otillgänglighet Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-106">An outage is defined as hello temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="c5dbf-107">hello avbrott kan påverka vissa komponenter av Service Bus, till exempel ett meddelandearkiv eller även hello hela datacentret.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-107">hello outage can affect some components of Service Bus, such as a messaging store, or even hello entire datacenter.</span></span> <span data-ttu-id="c5dbf-108">När hello problemet har åtgärdats, aktiveras Service Bus igen.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-108">After hello problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="c5dbf-109">Normalt orsakar avbrott inte förlorade meddelanden eller andra data.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="c5dbf-110">Ett exempel på ett komponentfel är hello otillgänglighet en viss meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-110">An example of a component failure is hello unavailability of a particular messaging store.</span></span> <span data-ttu-id="c5dbf-111">Ett exempel på ett datacenter hela avbrott är strömavbrott hello datacenter eller en felaktig datacenter nätverksväxel.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-111">An example of a datacenter-wide outage is a power failure of hello datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="c5dbf-112">Ett avbrott kan från några få minuter tooa sista några dagar.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-112">An outage can last from a few minutes tooa few days.</span></span>

<span data-ttu-id="c5dbf-113">En katastrof definieras som hello permanent förlorade en Service Bus-skalningsenhet eller datacenter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-113">A disaster is defined as hello permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="c5dbf-114">hello datacenter kan eller kan inte bli tillgänglig igen.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-114">hello datacenter may or may not become available again.</span></span> <span data-ttu-id="c5dbf-115">Vanligtvis förlorar en katastrof åtkomsten till vissa eller alla meddelanden eller andra data.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="c5dbf-116">Exempel på katastrofer är brand, överbelasta eller jordbävning.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="c5dbf-117">Aktuella arkitektur</span><span class="sxs-lookup"><span data-stu-id="c5dbf-117">Current architecture</span></span>
<span data-ttu-id="c5dbf-118">Service Bus använder flera meddelanden lagrar toostore meddelanden som skickas tooqueues eller avsnitt.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-118">Service Bus uses multiple messaging stores toostore messages that are sent tooqueues or topics.</span></span> <span data-ttu-id="c5dbf-119">En icke-partitionerat kö eller ett ämne tilldelas tooone messaging store.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-119">A non-partitioned queue or topic is assigned tooone messaging store.</span></span> <span data-ttu-id="c5dbf-120">Om den här meddelandearkiv är tillgänglig, misslyckas alla åtgärder på den kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="c5dbf-121">Alla Service Bus meddelandeentiteter (köer, ämnen, reläer) finns i ett namnområde för tjänsten som är kopplad till ett datacenter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="c5dbf-122">Service Bus Aktivera inte automatisk geo-replikering av data och inte heller det tillåter en namnområde toospan flera datacenter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace toospan multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="c5dbf-123">Skydd mot avbrott för ACS</span><span class="sxs-lookup"><span data-stu-id="c5dbf-123">Protecting against ACS outages</span></span>
<span data-ttu-id="c5dbf-124">Om du använder autentiseringsuppgifter för ACS och ACS är tillgänglig, kan klienter inte längre hämta token.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="c5dbf-125">Klienter som har en token för närvarande hello ACS kraschar kan fortsätta toouse Service Bus tills hello-token upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-125">Clients that have a token at hello time ACS goes down can continue toouse Service Bus until hello tokens expire.</span></span> <span data-ttu-id="c5dbf-126">livslängd för token hello standard är tre timmar.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-126">hello default token lifetime is 3 hours.</span></span>

<span data-ttu-id="c5dbf-127">tooprotect mot ACS-avbrott, Använd delade signatur åtkomst (SAS)-token.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-127">tooprotect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="c5dbf-128">I det här fallet autentiserar klienten hello direkt med Service Bus genom att registrera en egen minted token med en hemlig nyckel.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-128">In this case, hello client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="c5dbf-129">Anrop tooACS inte längre behövs.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-129">Calls tooACS are no longer required.</span></span> <span data-ttu-id="c5dbf-130">Mer information om SAS-token finns [Service Bus autentisering][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="c5dbf-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="c5dbf-131">Skydda köer och ämnen mot messaging store-fel</span><span class="sxs-lookup"><span data-stu-id="c5dbf-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="c5dbf-132">En icke-partitionerat kö eller ett ämne tilldelas tooone messaging store.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-132">A non-partitioned queue or topic is assigned tooone messaging store.</span></span> <span data-ttu-id="c5dbf-133">Om den här meddelandearkiv är tillgänglig, misslyckas alla åtgärder på den kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="c5dbf-134">En partitionerad kö på hello andra sidan, består av flera fragment.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-134">A partitioned queue, on hello other hand, consists of multiple fragments.</span></span> <span data-ttu-id="c5dbf-135">Varje fragment lagras i en annan meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="c5dbf-136">När ett meddelande skickas tooa partitionerade kö eller ett ämne, tilldelar Service Bus hello-meddelande tooone av hello-fragment.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-136">When a message is sent tooa partitioned queue or topic, Service Bus assigns hello message tooone of hello fragments.</span></span> <span data-ttu-id="c5dbf-137">Om hello motsvarande meddelandearkiv är tillgänglig, skriver Service Bus hello meddelandet tooa olika fragment, om möjligt.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-137">If hello corresponding messaging store is unavailable, Service Bus writes hello message tooa different fragment, if possible.</span></span> <span data-ttu-id="c5dbf-138">Mer information om partitionerade enheter finns [partitionerade meddelandeentiteter][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="c5dbf-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="c5dbf-139">Skydd mot datacenteravbrott eller katastrofer</span><span class="sxs-lookup"><span data-stu-id="c5dbf-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="c5dbf-140">tooallow för växling mellan två datacenter, kan du skapa ett namnområde för Service Bus-tjänsten i varje datacenter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-140">tooallow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="c5dbf-141">Till exempel hello namnområde för Service Bus-tjänsten **contosoPrimary.servicebus.windows.net** kan finnas i hello USA Nord/centrala region och **contosoSecondary.servicebus.windows.net**kan finnas i hello oss söder/centrala region.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-141">For example, hello Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in hello United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in hello US South/Central region.</span></span> <span data-ttu-id="c5dbf-142">Om en Service Bus-meddelanden entiteten måste vara tillgänglig i hello förekomsten av ett avbrott i datacenter, kan du skapa den entiteten i båda namnområden.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-142">If a Service Bus messaging entity must remain accessible in hello presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="c5dbf-143">Mer information finns i ”fel i Service Bus i ett Azure-datacenter” i avsnittet hello [asynkrona meddelanden mönster och hög tillgänglighet][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="c5dbf-143">For more information, see hello "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="c5dbf-144">Skyddar relay slutpunkter mot datacenteravbrott eller katastrofer</span><span class="sxs-lookup"><span data-stu-id="c5dbf-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="c5dbf-145">GEO-replikering relay slutpunkter kan en tjänst som Exponerar en relay endpoint toobe kan nås i hello förekomst av Service Bus avbrott.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint toobe reachable in hello presence of Service Bus outages.</span></span> <span data-ttu-id="c5dbf-146">tooachieve geo-replikering, hello service måste skapa två relay-slutpunkter i olika namnområden.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-146">tooachieve geo-replication, hello service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="c5dbf-147">hello namnområden måste finnas i olika datacenter och hello två slutpunkter måste ha olika namn.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-147">hello namespaces must reside in different datacenters and hello two endpoints must have different names.</span></span> <span data-ttu-id="c5dbf-148">Till exempel en primär slutpunkten kan nås **contosoPrimary.servicebus.windows.net/myPrimaryService**, medan motparten sekundära kan nås **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="c5dbf-149">hello tjänsten lyssnar på båda slutpunkter och en klient kan anropa hello-tjänsten via antingen slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-149">hello service then listens on both endpoints, and a client can invoke hello service via either endpoint.</span></span> <span data-ttu-id="c5dbf-150">Ett klientprogram slumpmässigt tar en hello reläer som hello primära slutpunkt och skickar dess begäran toohello aktiv slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-150">A client application randomly picks one of hello relays as hello primary endpoint, and sends its request toohello active endpoint.</span></span> <span data-ttu-id="c5dbf-151">Om hello åtgärden misslyckas med felkoden betyder misslyckande att hello relay slutpunkt inte är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-151">If hello operation fails with an error code, this failure indicates that hello relay endpoint is not available.</span></span> <span data-ttu-id="c5dbf-152">hello-programmet öppnas en kanal toohello säkerhetskopierad slutpunkt och kör hello-begäran.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-152">hello application opens a channel toohello backup endpoint and reissues hello request.</span></span> <span data-ttu-id="c5dbf-153">Då hello active och hello säkerhetskopiering slutpunkter växla roll: hello klientprogrammet anser hello gamla aktiv slutpunkt toobe hello nya säkerhetskopierad slutpunkt och hello gamla säkerhetskopierad slutpunkt toobe hello nya aktiv slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-153">At that point hello active and hello backup endpoints switch roles: hello client application considers hello old active endpoint toobe hello new backup endpoint, and hello old backup endpoint toobe hello new active endpoint.</span></span> <span data-ttu-id="c5dbf-154">Om både skicka operations misslyckas hello roller i hello två entiteter förblir oförändrade och returneras ett fel.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-154">If both send operations fail, hello roles of hello two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="c5dbf-155">Hej [Geo-replikering med Service Bus vidarebefordrade meddelanden] [ Geo-replication with Service Bus relayed Messages] exemplet visar hur tooreplicate vidarebefordrar.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-155">hello [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how tooreplicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="c5dbf-156">Skydda köer och ämnen mot datacenteravbrott eller katastrofer</span><span class="sxs-lookup"><span data-stu-id="c5dbf-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="c5dbf-157">tooachieve återhämtning mot datacenteravbrott när med hjälp av asynkron meddelandetjänst, Service Bus stöder två metoder: *active* och *passiva* replikering.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-157">tooachieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="c5dbf-158">För varje metod om en viss kö eller ett ämne måste vara tillgänglig i hello förekomsten av ett avbrott för datacenter, kan du skapa den i både namnområden.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-158">For each approach, if a given queue or topic must remain accessible in hello presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="c5dbf-159">Båda entiteter kan ha hello samma namn.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-159">Both entities can have hello same name.</span></span> <span data-ttu-id="c5dbf-160">Till exempel en primär kö kan nås **contosoPrimary.servicebus.windows.net/myQueue**, medan motparten sekundära kan nås **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="c5dbf-161">Om hello program inte kräver permanent avsändaren att mottagaren kommunikation kan hello program implementera varaktiga klientsidan kön tooprevent förlust och tooshield hello avsändarens från Service Bus tillfälligt fel.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-161">If hello application does not require permanent sender-to-receiver communication, hello application can implement a durable client-side queue tooprevent message loss and tooshield hello sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="c5dbf-162">Aktiv replikering</span><span class="sxs-lookup"><span data-stu-id="c5dbf-162">Active replication</span></span>
<span data-ttu-id="c5dbf-163">Aktiv replikering använder entiteter i båda namnområdena för varje åtgärd.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="c5dbf-164">Alla klienter som skickar ett meddelande skickas två kopior av hello samma meddelande.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-164">Any client that sends a message sends two copies of hello same message.</span></span> <span data-ttu-id="c5dbf-165">hello första kopian skickas toohello primär entitet (till exempel **contosoPrimary.servicebus.windows.net/sales**), och hello kopia av hello-meddelande skickas toohello sekundär enhet (till exempel  **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="c5dbf-165">hello first copy is sent toohello primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and hello second copy of hello message is sent toohello secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="c5dbf-166">En klient tar emot meddelanden från både köer.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-166">A client receives messages from both queues.</span></span> <span data-ttu-id="c5dbf-167">hello mottagaren processer hello första kopian av ett meddelande och hello kopia ignoreras.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-167">hello receiver processes hello first copy of a message, and hello second copy is suppressed.</span></span> <span data-ttu-id="c5dbf-168">toosuppress dubblerade meddelanden, hello avsändaren tagga varje meddelande med en unik identifierare.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-168">toosuppress duplicate messages, hello sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="c5dbf-169">Båda kopiorna av hello-meddelande måste taggas med hello samma identifierare.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-169">Both copies of hello message must be tagged with hello same identifier.</span></span> <span data-ttu-id="c5dbf-170">Du kan använda hello [BrokeredMessage.MessageId] [ BrokeredMessage.MessageId] eller [BrokeredMessage.Label] [ BrokeredMessage.Label] egenskaper eller en anpassad egenskap tootag hello meddelande.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-170">You can use hello [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property tootag hello message.</span></span> <span data-ttu-id="c5dbf-171">hello mottagare måste upprätthålla en lista med meddelanden som redan har fått.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-171">hello receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="c5dbf-172">Hej [Geo-replikering med asynkrona meddelanden i Service Bus] [ Geo-replication with Service Bus Brokered Messages] exemplet visar aktiv replikering av meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-172">hello [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="c5dbf-173">hello aktiv replikering metoden fördubblar hello antal åtgärder, därför kan den här metoden leda toohigher kostnaden.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-173">hello active replication approach doubles hello number of operations, therefore this approach can lead toohigher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="c5dbf-174">Passiva replikering</span><span class="sxs-lookup"><span data-stu-id="c5dbf-174">Passive replication</span></span>
<span data-ttu-id="c5dbf-175">I hello felfri fallet använder passiva replikering endast en av hello två meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-175">In hello fault-free case, passive replication uses only one of hello two messaging entities.</span></span> <span data-ttu-id="c5dbf-176">En klient skickar hello meddelandet toohello active entitet.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-176">A client sends hello message toohello active entity.</span></span> <span data-ttu-id="c5dbf-177">Om hello hello active entiteten misslyckas med en felkod som visar hello datacenter som värdar hello active entitet kan vara otillgänglig, skickar hello klienten en kopia av hello meddelandet toohello säkerhetskopiering entitet.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-177">If hello operation on hello active entity fails with an error code that indicates hello datacenter that hosts hello active entity might be unavailable, hello client sends a copy of hello message toohello backup entity.</span></span> <span data-ttu-id="c5dbf-178">Då hello active och hello säkerhetskopieringsenheter växla roll: hello skickar klienten anser hello gamla active entiteten toobe hello ny säkerhetskopiering entitet och hello gamla säkerhetskopiering entiteten är hello ny aktiva entitet.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-178">At that point hello active and hello backup entities switch roles: hello sending client considers hello old active entity toobe hello new backup entity, and hello old backup entity is hello new active entity.</span></span> <span data-ttu-id="c5dbf-179">Om både skicka operations misslyckas hello roller i hello två entiteter förblir oförändrade och returneras ett fel.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-179">If both send operations fail, hello roles of hello two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="c5dbf-180">En klient tar emot meddelanden från både köer.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-180">A client receives messages from both queues.</span></span> <span data-ttu-id="c5dbf-181">Eftersom det finns en risk att hello mottagaren tar emot två kopior av samma meddelande, hello hello mottagare måste förhindra att dubbla meddelanden.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-181">Because there is a chance that hello receiver receives two copies of hello same message, hello receiver must suppress duplicate messages.</span></span> <span data-ttu-id="c5dbf-182">Du kan förhindra dubbletter i hello samma sätt som för aktiv replikering.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-182">You can suppress duplicates in hello same way as described for active replication.</span></span>

<span data-ttu-id="c5dbf-183">I allmänhet replikeras passiva mer kostnadseffektiv än aktiv replikering eftersom endast en åtgärd utförs i de flesta fall.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="c5dbf-184">Svarstid, genomflöde och kostnaden är identiska toohello icke-replikerade scenario.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-184">Latency, throughput, and monetary cost are identical toohello non-replicated scenario.</span></span>

<span data-ttu-id="c5dbf-185">När du använder passiva replikering, i hello kan följande scenarier meddelanden tappas bort eller fått två gånger:</span><span class="sxs-lookup"><span data-stu-id="c5dbf-185">When using passive replication, in hello following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="c5dbf-186">**Meddelandet fördröjning eller förlust**: Anta att hello avsändaren har skickat en m1 toohello primära meddelandekö och sedan hello kön blir otillgänglig innan hello mottagaren tar emot m1.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-186">**Message delay or loss**: Assume that hello sender successfully sent a message m1 toohello primary queue, and then hello queue becomes unavailable before hello receiver receives m1.</span></span> <span data-ttu-id="c5dbf-187">hello avsändare skickar en efterföljande m2 toohello sekundära meddelandekö.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-187">hello sender sends a subsequent message m2 toohello secondary queue.</span></span> <span data-ttu-id="c5dbf-188">Om hello primära kön är inte tillgänglig för tillfället, får hello mottagaren m1 när hello kön har blivit tillgänglig igen.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-188">If hello primary queue is temporarily unavailable, hello receiver receives m1 after hello queue becomes available again.</span></span> <span data-ttu-id="c5dbf-189">Vid en katastrof får hello mottagaren m1.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-189">In case of a disaster, hello receiver may never receive m1.</span></span>
* <span data-ttu-id="c5dbf-190">**Duplicera mottagning**: förutsätter att hello avsändare skickar en m toohello primära meddelandekö.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-190">**Duplicate reception**: Assume that hello sender sends a message m toohello primary queue.</span></span> <span data-ttu-id="c5dbf-191">Service Bus har bearbetar m men misslyckas toosend ett svar.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-191">Service Bus successfully processes m but fails toosend a response.</span></span> <span data-ttu-id="c5dbf-192">När hello skicka arbetstiderna ut, skickar hello avsändare en identisk kopia av m toohello sekundär kö.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-192">After hello send operation times out, hello sender sends an identical copy of m toohello secondary queue.</span></span> <span data-ttu-id="c5dbf-193">Om hello mottagaren kan tooreceive hello första kopian av m innan hello primära kön blir otillgänglig, hello mottagaren tar emot båda kopiorna av m på cirka hello samtidigt.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-193">If hello receiver is able tooreceive hello first copy of m before hello primary queue becomes unavailable, hello receiver receives both copies of m at approximately hello same time.</span></span> <span data-ttu-id="c5dbf-194">Om hello mottagaren inte kan tooreceive hello första kopian av m innan hello primära kön blir otillgänglig, hello mottagare får först endast hello kopia av m, men tar emot en andra kopia av m när hello primära kön blir tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-194">If hello receiver is not able tooreceive hello first copy of m before hello primary queue becomes unavailable, hello receiver initially receives only hello second copy of m, but then receives a second copy of m when hello primary queue becomes available.</span></span>

<span data-ttu-id="c5dbf-195">Hej [Geo-replikering med Service Bus asynkrona meddelanden] [ Geo-replication with Service Bus Brokered Messages] exemplet visar passiva replikering av meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="c5dbf-195">hello [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c5dbf-196">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="c5dbf-196">Next steps</span></span>
<span data-ttu-id="c5dbf-197">toolearn mer om katastrofåterställning, finns i följande artiklar:</span><span class="sxs-lookup"><span data-stu-id="c5dbf-197">toolearn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="c5dbf-198">[Företagskontinuitet för Azure SQL-databas][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="c5dbf-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="c5dbf-199">[Utforma flexibel program för Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="c5dbf-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
