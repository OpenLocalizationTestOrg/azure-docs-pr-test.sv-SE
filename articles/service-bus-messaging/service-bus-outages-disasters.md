---
title: Isolering av Azure Service Bus program mot avbrott och katastrofer | Microsoft Docs
description: "Här beskrivs tekniker som du kan använda för att skydda mot en potentiella avbrott i Service Bus-program."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: bc84dbe5c26a834b2cff5f71ba5f541e94ba0b38
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="bb459-103">Metodtips för program mot Service Bus-avbrott och katastrofer isolering</span><span class="sxs-lookup"><span data-stu-id="bb459-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="bb459-104">Verksamhetskritiska program måste kontinuerligt, fungerar även med oplanerade avbrott eller katastrofer.</span><span class="sxs-lookup"><span data-stu-id="bb459-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="bb459-105">Det här avsnittet beskrivs metoder du kan använda för att skydda Service Bus program mot en potentiella avbrott eller katastrof.</span><span class="sxs-lookup"><span data-stu-id="bb459-105">This topic describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="bb459-106">Ett avbrott har definierats som temporär otillgänglighet Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bb459-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="bb459-107">Avbrottet kan påverka vissa komponenter av Service Bus, till exempel ett meddelandearkiv eller även hela datacentret.</span><span class="sxs-lookup"><span data-stu-id="bb459-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="bb459-108">När problemet har korrigerats, aktiveras Service Bus igen.</span><span class="sxs-lookup"><span data-stu-id="bb459-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="bb459-109">Normalt orsakar avbrott inte förlorade meddelanden eller andra data.</span><span class="sxs-lookup"><span data-stu-id="bb459-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="bb459-110">Ett exempel på ett komponentfel är att en viss meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bb459-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="bb459-111">Ett exempel på ett datacenter hela avbrott är strömavbrott i datacentret, eller en felaktig datacenter nätverksväxel.</span><span class="sxs-lookup"><span data-stu-id="bb459-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="bb459-112">Ett avbrott kan sista från några minuter till några dagar.</span><span class="sxs-lookup"><span data-stu-id="bb459-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="bb459-113">En katastrof definieras som en Service Bus-skalningsenhet eller datacenter permanent förlorade.</span><span class="sxs-lookup"><span data-stu-id="bb459-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="bb459-114">Datacenter kan eller kan inte bli tillgänglig igen.</span><span class="sxs-lookup"><span data-stu-id="bb459-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="bb459-115">Vanligtvis förlorar en katastrof åtkomsten till vissa eller alla meddelanden eller andra data.</span><span class="sxs-lookup"><span data-stu-id="bb459-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="bb459-116">Exempel på katastrofer är brand, överbelasta eller jordbävning.</span><span class="sxs-lookup"><span data-stu-id="bb459-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="bb459-117">Aktuella arkitektur</span><span class="sxs-lookup"><span data-stu-id="bb459-117">Current architecture</span></span>
<span data-ttu-id="bb459-118">Service Bus använder flera meddelandearkiv för att lagra meddelanden som skickas till köer och ämnen.</span><span class="sxs-lookup"><span data-stu-id="bb459-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="bb459-119">En icke-partitionerat kö eller ett ämne tilldelas till ett meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bb459-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="bb459-120">Om den här meddelandearkiv är tillgänglig, misslyckas alla åtgärder på den kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="bb459-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="bb459-121">Alla Service Bus meddelandeentiteter (köer, ämnen, reläer) finns i ett namnområde för tjänsten som är kopplad till ett datacenter.</span><span class="sxs-lookup"><span data-stu-id="bb459-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="bb459-122">Service Bus Aktivera inte automatisk geo-replikering av data eller tillåter att ett namnområde ska sträcka sig över flera datacenter.</span><span class="sxs-lookup"><span data-stu-id="bb459-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace to span multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="bb459-123">Skydd mot avbrott för ACS</span><span class="sxs-lookup"><span data-stu-id="bb459-123">Protecting against ACS outages</span></span>
<span data-ttu-id="bb459-124">Om du använder autentiseringsuppgifter för ACS och ACS är tillgänglig, kan klienter inte längre hämta token.</span><span class="sxs-lookup"><span data-stu-id="bb459-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="bb459-125">Klienter som har en token när ACS kraschar kan fortsätta att använda Service Bus tills token upphör att gälla.</span><span class="sxs-lookup"><span data-stu-id="bb459-125">Clients that have a token at the time ACS goes down can continue to use Service Bus until the tokens expire.</span></span> <span data-ttu-id="bb459-126">Livslängd för token standard är tre timmar.</span><span class="sxs-lookup"><span data-stu-id="bb459-126">The default token lifetime is 3 hours.</span></span>

<span data-ttu-id="bb459-127">Använd delade signatur åtkomst (SAS)-token för att skydda mot ACS avbrott.</span><span class="sxs-lookup"><span data-stu-id="bb459-127">To protect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="bb459-128">I det här fallet autentiserar klienten direkt med Service Bus genom att registrera en egen minted token med en hemlig nyckel.</span><span class="sxs-lookup"><span data-stu-id="bb459-128">In this case, the client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="bb459-129">Anrop till ACS inte längre behövs.</span><span class="sxs-lookup"><span data-stu-id="bb459-129">Calls to ACS are no longer required.</span></span> <span data-ttu-id="bb459-130">Mer information om SAS-token finns [Service Bus autentisering][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="bb459-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="bb459-131">Skydda köer och ämnen mot messaging store-fel</span><span class="sxs-lookup"><span data-stu-id="bb459-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="bb459-132">En icke-partitionerat kö eller ett ämne tilldelas till ett meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bb459-132">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="bb459-133">Om den här meddelandearkiv är tillgänglig, misslyckas alla åtgärder på den kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="bb459-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="bb459-134">En partitionerad kö å andra sidan består av flera fragment.</span><span class="sxs-lookup"><span data-stu-id="bb459-134">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="bb459-135">Varje fragment lagras i en annan meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bb459-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="bb459-136">När ett meddelande skickas till en partitionerad kö eller ett ämne, tilldelar Service Bus meddelandet till en av fragment.</span><span class="sxs-lookup"><span data-stu-id="bb459-136">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="bb459-137">Om motsvarande meddelandearkiv är tillgänglig, skriver Service Bus meddelandet till en annan fragment om möjligt.</span><span class="sxs-lookup"><span data-stu-id="bb459-137">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="bb459-138">Mer information om partitionerade enheter finns [partitionerade meddelandeentiteter][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="bb459-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="bb459-139">Skydd mot datacenteravbrott eller katastrofer</span><span class="sxs-lookup"><span data-stu-id="bb459-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="bb459-140">Om du vill tillåta växling mellan två datacenter, kan du skapa ett namnområde för Service Bus-tjänsten i varje datacenter.</span><span class="sxs-lookup"><span data-stu-id="bb459-140">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="bb459-141">Till exempel namnområde för Service Bus-tjänsten **contosoPrimary.servicebus.windows.net** kanske finns i USA Central/Nord-region och **contosoSecondary.servicebus.windows.net** kan finnas i oss söder/centrala region.</span><span class="sxs-lookup"><span data-stu-id="bb459-141">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="bb459-142">Om en Service Bus-meddelanden entiteten måste vara tillgänglig med en datacenter-avbrott, kan du skapa den entiteten i båda namnområden.</span><span class="sxs-lookup"><span data-stu-id="bb459-142">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="bb459-143">Mer information finns i avsnittet ”fel i Service Bus i ett Azure-datacenter” i [asynkrona meddelanden mönster och hög tillgänglighet][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="bb459-143">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="bb459-144">Skyddar relay slutpunkter mot datacenteravbrott eller katastrofer</span><span class="sxs-lookup"><span data-stu-id="bb459-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="bb459-145">GEO-replikering relay slutpunkter kan en tjänst som Exponerar en relay-slutpunkt för att kunna nås med Service Bus avbrott.</span><span class="sxs-lookup"><span data-stu-id="bb459-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="bb459-146">För att uppnå geo-replikering måste tjänsten skapar två relay-slutpunkter i olika namnområden.</span><span class="sxs-lookup"><span data-stu-id="bb459-146">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="bb459-147">Namnområden måste finnas i olika datacenter och de två slutpunkterna måste ha olika namn.</span><span class="sxs-lookup"><span data-stu-id="bb459-147">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="bb459-148">Till exempel en primär slutpunkten kan nås **contosoPrimary.servicebus.windows.net/myPrimaryService**, medan motparten sekundära kan nås **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="bb459-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="bb459-149">Tjänsten lyssnar på båda slutpunkter och en klient kan anropa tjänsten via antingen slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="bb459-149">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="bb459-150">Ett klientprogram slumpmässigt hämtar en av reläer som primär slutpunkt och skickar en begäran till den aktiva slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="bb459-150">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="bb459-151">Om åtgärden misslyckas med en felkod, anger det här felet relay-slutpunkten inte är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="bb459-151">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="bb459-152">Programmet öppnar en kanal till säkerhetskopierad slutpunkt och kör begäran.</span><span class="sxs-lookup"><span data-stu-id="bb459-152">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="bb459-153">Då aktivt och säkerhetskopiering slutpunkter växla roll: klientprogrammet anser gamla aktiv slutpunkt är den nya säkerhetskopierad slutpunkten och gamla säkerhetskopiering slutpunkten ska vara den nya aktiva slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="bb459-153">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="bb459-154">Om både skicka operations misslyckas rollerna i två entiteter förblir oförändrade och returneras ett fel.</span><span class="sxs-lookup"><span data-stu-id="bb459-154">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="bb459-155">Den [Geo-replikering med Service Bus vidarebefordrade meddelanden] [ Geo-replication with Service Bus relayed Messages] exemplet visar hur du replikerar reläer.</span><span class="sxs-lookup"><span data-stu-id="bb459-155">The [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how to replicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="bb459-156">Skydda köer och ämnen mot datacenteravbrott eller katastrofer</span><span class="sxs-lookup"><span data-stu-id="bb459-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="bb459-157">Om du vill uppnå återhämtning mot datacenteravbrott när du använder asynkrona meddelandetjänster, Service Bus stöder två metoder: *active* och *passiva* replikering.</span><span class="sxs-lookup"><span data-stu-id="bb459-157">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="bb459-158">För varje metod om en viss kö eller ett ämne måste vara tillgänglig med en datacenter-avbrott, kan du skapa den i både namnområden.</span><span class="sxs-lookup"><span data-stu-id="bb459-158">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="bb459-159">Båda entiteter kan ha samma namn.</span><span class="sxs-lookup"><span data-stu-id="bb459-159">Both entities can have the same name.</span></span> <span data-ttu-id="bb459-160">Till exempel en primär kö kan nås **contosoPrimary.servicebus.windows.net/myQueue**, medan motparten sekundära kan nås **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="bb459-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="bb459-161">Om programmet inte kräver permanent avsändaren att mottagaren kommunikation kan programmet implementera en beständig klientsidan kö för att förhindra förlust av meddelandet och att skydda avsändaren från Service Bus tillfälligt fel.</span><span class="sxs-lookup"><span data-stu-id="bb459-161">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="bb459-162">Aktiv replikering</span><span class="sxs-lookup"><span data-stu-id="bb459-162">Active replication</span></span>
<span data-ttu-id="bb459-163">Aktiv replikering använder entiteter i båda namnområdena för varje åtgärd.</span><span class="sxs-lookup"><span data-stu-id="bb459-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="bb459-164">Alla klienter som skickar ett meddelande skickas två kopior av samma meddelande.</span><span class="sxs-lookup"><span data-stu-id="bb459-164">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="bb459-165">Den första kopian skickas till den primära enheten (till exempel **contosoPrimary.servicebus.windows.net/sales**), och den andra kopian av meddelandet skickas till den sekundära enheten (till exempel **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="bb459-165">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="bb459-166">En klient tar emot meddelanden från både köer.</span><span class="sxs-lookup"><span data-stu-id="bb459-166">A client receives messages from both queues.</span></span> <span data-ttu-id="bb459-167">Mottagaren bearbetar den första kopian av ett meddelande och den andra kopian ignoreras.</span><span class="sxs-lookup"><span data-stu-id="bb459-167">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="bb459-168">Om du inte dubblerade meddelanden, tagga avsändaren varje meddelande med en unik identifierare.</span><span class="sxs-lookup"><span data-stu-id="bb459-168">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="bb459-169">Båda kopiorna av meddelandet måste vara taggade med samma ID.</span><span class="sxs-lookup"><span data-stu-id="bb459-169">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="bb459-170">Du kan använda den [BrokeredMessage.MessageId] [ BrokeredMessage.MessageId] eller [BrokeredMessage.Label] [ BrokeredMessage.Label] egenskaper eller en anpassad egenskap att tagga meddelandet.</span><span class="sxs-lookup"><span data-stu-id="bb459-170">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="bb459-171">Mottagaren måste upprätthålla en lista med meddelanden som redan har fått.</span><span class="sxs-lookup"><span data-stu-id="bb459-171">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="bb459-172">Den [Geo-replikering med asynkrona meddelanden i Service Bus] [ Geo-replication with Service Bus Brokered Messages] exemplet visar aktiv replikering av meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="bb459-172">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="bb459-173">Metoden som aktiv replikering fördubblar antalet åtgärder, därför den här metoden kan leda till högre kostnad.</span><span class="sxs-lookup"><span data-stu-id="bb459-173">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="bb459-174">Passiva replikering</span><span class="sxs-lookup"><span data-stu-id="bb459-174">Passive replication</span></span>
<span data-ttu-id="bb459-175">I fallen som felfri använder passiva replikering endast en av de två meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="bb459-175">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="bb459-176">En klient skickar meddelandet till enheten som är aktiva.</span><span class="sxs-lookup"><span data-stu-id="bb459-176">A client sends the message to the active entity.</span></span> <span data-ttu-id="bb459-177">Om åtgärden på den aktiva entiteten misslyckas och en felkod som anger datacentret som är värd för den aktiva enheten inte kanske är tillgänglig, skickar klienten en kopia av meddelandet till enheten som säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="bb459-177">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="bb459-178">Då aktivt och säkerhetskopieringsenheter växla roll: skicka klienten anser att gamla active entiteten ny säkerhetskopiering entitet och gamla säkerhetskopiering entiteten är den nya active entiteten.</span><span class="sxs-lookup"><span data-stu-id="bb459-178">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="bb459-179">Om både skicka operations misslyckas rollerna i två entiteter förblir oförändrade och returneras ett fel.</span><span class="sxs-lookup"><span data-stu-id="bb459-179">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="bb459-180">En klient tar emot meddelanden från både köer.</span><span class="sxs-lookup"><span data-stu-id="bb459-180">A client receives messages from both queues.</span></span> <span data-ttu-id="bb459-181">Eftersom det finns en risk att mottagaren får två kopior av samma meddelande, mottagaren inte dubbla meddelanden.</span><span class="sxs-lookup"><span data-stu-id="bb459-181">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="bb459-182">Du kan förhindra dubbletter på samma sätt som beskrivs för aktiv replikering.</span><span class="sxs-lookup"><span data-stu-id="bb459-182">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="bb459-183">I allmänhet replikeras passiva mer kostnadseffektiv än aktiv replikering eftersom endast en åtgärd utförs i de flesta fall.</span><span class="sxs-lookup"><span data-stu-id="bb459-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="bb459-184">Svarstid, genomflöde och kostnaden är identiska med det icke-replikerade scenariot.</span><span class="sxs-lookup"><span data-stu-id="bb459-184">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="bb459-185">När du använder passiva replikering, i följande scenarier kan meddelanden tappas bort eller fått två gånger:</span><span class="sxs-lookup"><span data-stu-id="bb459-185">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="bb459-186">**Meddelandet fördröjning eller förlust**: Anta att avsändaren har skickat ett meddelande m1 till primära kön och sedan kön blir otillgänglig innan mottagaren tar emot m1.</span><span class="sxs-lookup"><span data-stu-id="bb459-186">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="bb459-187">Avsändaren skickar ett meddelande m2 till sekundär kö.</span><span class="sxs-lookup"><span data-stu-id="bb459-187">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="bb459-188">Om den primära kön är inte tillgänglig för tillfället får mottagaren m1 när kön har blivit tillgänglig igen.</span><span class="sxs-lookup"><span data-stu-id="bb459-188">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="bb459-189">Vid en katastrof får mottagaren m1.</span><span class="sxs-lookup"><span data-stu-id="bb459-189">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="bb459-190">**Duplicera mottagning**: förutsätter att avsändaren skickar ett meddelande m till primära kön.</span><span class="sxs-lookup"><span data-stu-id="bb459-190">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="bb459-191">Service Bus bearbetar m men misslyckas med att skicka ett svar.</span><span class="sxs-lookup"><span data-stu-id="bb459-191">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="bb459-192">När send-åtgärden på grund av timeout, skickar avsändaren en identisk kopia av m till sekundär kö.</span><span class="sxs-lookup"><span data-stu-id="bb459-192">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="bb459-193">Om mottagaren kan ta emot den första kopian av m innan primära kön blir otillgänglig, får mottagaren båda kopiorna av m vid ungefär samma tillfälle.</span><span class="sxs-lookup"><span data-stu-id="bb459-193">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="bb459-194">Om mottagaren inte kan ta emot den första kopian av m innan primära kön blir otillgänglig, mottagaren tar emot först den andra kopian av m, men tar emot en andra kopia av m när den primära kön blir tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="bb459-194">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="bb459-195">Den [Geo-replikering med Service Bus asynkrona meddelanden] [ Geo-replication with Service Bus Brokered Messages] exemplet visar passiva replikering av meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="bb459-195">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb459-196">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="bb459-196">Next steps</span></span>
<span data-ttu-id="bb459-197">Mer information om återställning finns i följande artiklar:</span><span class="sxs-lookup"><span data-stu-id="bb459-197">To learn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="bb459-198">[Företagskontinuitet för Azure SQL-databas][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="bb459-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="bb459-199">[Utforma flexibel program för Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="bb459-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
