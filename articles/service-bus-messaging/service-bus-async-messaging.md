---
title: Asynkrona Service Bus-meddelanden | Microsoft Docs
description: Beskrivning av Azure Service Bus asynkrona meddelanden.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 95d6f295ba145a55fe4ed3fc7c6f627c9d419a3c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="e9a79-103">Asynkrona meddelandemönster och hög tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="e9a79-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="e9a79-104">Asynkrona meddelanden kan implementeras i en mängd olika sätt.</span><span class="sxs-lookup"><span data-stu-id="e9a79-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="e9a79-105">Köer, ämnen och prenumerationer stöder Azure Service Bus asynchronism via en store och vidarebefordra mekanism.</span><span class="sxs-lookup"><span data-stu-id="e9a79-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="e9a79-106">Under normal drift av (synkron), skicka meddelanden till köer och ämnen och ta emot meddelanden från köer och -prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="e9a79-106">In normal (synchronous) operation, you send messages to queues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="e9a79-107">Program som du skriver är beroende av dessa enheter alltid är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="e9a79-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="e9a79-108">När entiteten hälsotillståndet ändras på grund av ett antal olika omständigheter, behöver du ett sätt att ge en minskad kapacitet entitet som kan uppfylla de flesta behov.</span><span class="sxs-lookup"><span data-stu-id="e9a79-108">When the entity health changes, due to a variety of circumstances, you need a way to provide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="e9a79-109">Program använder vanligtvis asynkrona meddelandemönster för att aktivera ett antal kommunikationsscenarier.</span><span class="sxs-lookup"><span data-stu-id="e9a79-109">Applications typically use asynchronous messaging patterns to enable a number of communication scenarios.</span></span> <span data-ttu-id="e9a79-110">Du kan skapa program som klienter kan skicka meddelanden till tjänster, även när tjänsten inte körs.</span><span class="sxs-lookup"><span data-stu-id="e9a79-110">You can build applications in which clients can send messages to services, even when the service is not running.</span></span> <span data-ttu-id="e9a79-111">För program nivå belastning i kommunikation, en kö kan hjälpa dig att du ska få belastningen genom att tillhandahålla en plats till bufferten kommunikationen.</span><span class="sxs-lookup"><span data-stu-id="e9a79-111">For applications that experience bursts of communications, a queue can help level the load by providing a place to buffer communications.</span></span> <span data-ttu-id="e9a79-112">Slutligen kan du få en tydlig och effektiv belastningsutjämnare distribuerar meddelanden över flera datorer.</span><span class="sxs-lookup"><span data-stu-id="e9a79-112">Finally, you can get a simple but effective load balancer to distribute messages across multiple machines.</span></span>

<span data-ttu-id="e9a79-113">Överväg att ett antal olika sätt som dessa enheter kan visas inte tillgängligt för en beständig meddelandesystem för att upprätthålla tillgänglighet av någon av dessa enheter.</span><span class="sxs-lookup"><span data-stu-id="e9a79-113">In order to maintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="e9a79-114">Generellt sett finns vi entiteten vara tillgänglig för program som vi skriva i olika sätt:</span><span class="sxs-lookup"><span data-stu-id="e9a79-114">Generally speaking, we see the entity become unavailable to applications we write in the following different ways:</span></span>

* <span data-ttu-id="e9a79-115">Det går inte att skicka meddelanden.</span><span class="sxs-lookup"><span data-stu-id="e9a79-115">Unable to send messages.</span></span>
* <span data-ttu-id="e9a79-116">Det går inte att ta emot meddelanden.</span><span class="sxs-lookup"><span data-stu-id="e9a79-116">Unable to receive messages.</span></span>
* <span data-ttu-id="e9a79-117">Det går inte att hantera enheter (skapa, hämta, uppdatera eller ta bort enheter).</span><span class="sxs-lookup"><span data-stu-id="e9a79-117">Unable to manage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="e9a79-118">Det går inte att kontakta tjänsten.</span><span class="sxs-lookup"><span data-stu-id="e9a79-118">Unable to contact the service.</span></span>

<span data-ttu-id="e9a79-119">För var och en av dessa fel finns olika feltillstånd som gör att ett program ska kunna utföra arbete på vissa nivå för minskade kapaciteten.</span><span class="sxs-lookup"><span data-stu-id="e9a79-119">For each of these failures, different failure modes exist that enable an application to continue to perform work at some level of reduced capability.</span></span> <span data-ttu-id="e9a79-120">Ett system som kan skicka meddelanden, men inte tagit emot dem fortfarande kan ta emot order från kunder men kan inte bearbeta dessa order.</span><span class="sxs-lookup"><span data-stu-id="e9a79-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="e9a79-121">Det här avsnittet beskrivs problem som kan uppstå och hur dessa problem begränsas.</span><span class="sxs-lookup"><span data-stu-id="e9a79-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="e9a79-122">Service Bus har införs ett antal åtgärder som du måste välja i och det här avsnittet beskrivs även reglerna för användning av dessa Anmäl åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses the rules governing the use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="e9a79-123">Tillförlitlighet i Service Bus</span><span class="sxs-lookup"><span data-stu-id="e9a79-123">Reliability in Service Bus</span></span>
<span data-ttu-id="e9a79-124">Det finns flera sätt att hantera problem med meddelandet och entiteten och det finns riktlinjer för rätt användning av dessa åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-124">There are several ways to handle message and entity issues, and there are guidelines governing the appropriate use of those mitigations.</span></span> <span data-ttu-id="e9a79-125">För att förstå riktlinjerna, måste du först förstå vad kan misslyckas i Service Bus.</span><span class="sxs-lookup"><span data-stu-id="e9a79-125">To understand the guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="e9a79-126">Alla dessa problem brukar vara tillfällig på grund av utformningen av Azure-system.</span><span class="sxs-lookup"><span data-stu-id="e9a79-126">Due to the design of Azure systems, all of these issues tend to be short-lived.</span></span> <span data-ttu-id="e9a79-127">På en hög nivå visas de olika orsakerna till inte finns på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="e9a79-127">At a high level, the different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="e9a79-128">Begränsning från ett externt system som Service Bus är beroende av.</span><span class="sxs-lookup"><span data-stu-id="e9a79-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="e9a79-129">Begränsning inträffar på samverkan med resurser för lagring och beräkning.</span><span class="sxs-lookup"><span data-stu-id="e9a79-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="e9a79-130">Problemet för ett system som Service Bus beroende.</span><span class="sxs-lookup"><span data-stu-id="e9a79-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="e9a79-131">En viss del av lagring kan exempelvis stöter på problem.</span><span class="sxs-lookup"><span data-stu-id="e9a79-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="e9a79-132">Fel i Service Bus på enskild undersystemet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="e9a79-133">I så fall kan en beräkningsnod få till ett inkonsekvent tillstånd och måste startas om, vilket gör alla entiteter som den används för att belastningsutjämna till andra noder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves to load balance to other nodes.</span></span> <span data-ttu-id="e9a79-134">I sin tur kan orsaka en kort period av långsam meddelandebehandling.</span><span class="sxs-lookup"><span data-stu-id="e9a79-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="e9a79-135">Fel i Service Bus i ett Azure-datacenter.</span><span class="sxs-lookup"><span data-stu-id="e9a79-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="e9a79-136">Detta är ett ”oåterkalleligt fel” som då systemet kan inte nås för många minuter eller några timmar.</span><span class="sxs-lookup"><span data-stu-id="e9a79-136">This is a "catastrophic failure" during which the system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="e9a79-137">Termen **lagring** kan omfatta både Azure-lagring och SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="e9a79-137">The term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="e9a79-138">Service Bus innehåller ett antal åtgärder för dessa problem.</span><span class="sxs-lookup"><span data-stu-id="e9a79-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="e9a79-139">I följande avsnitt beskrivs varje problem och deras respektive ändringar.</span><span class="sxs-lookup"><span data-stu-id="e9a79-139">The following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="e9a79-140">Begränsning</span><span class="sxs-lookup"><span data-stu-id="e9a79-140">Throttling</span></span>
<span data-ttu-id="e9a79-141">Med Service Bus begränsning gör det möjligt samverkande meddelandet hastighet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="e9a79-142">Varje enskild nod för Service Bus innehåller många entiteter.</span><span class="sxs-lookup"><span data-stu-id="e9a79-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="e9a79-143">Var och en av dessa enheter ansluter krav på systemet vad gäller CPU, minne, lagring och andra facets.</span><span class="sxs-lookup"><span data-stu-id="e9a79-143">Each of those entities makes demands on the system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="e9a79-144">När någon av dessa aspekter identifierar användning som överskrider definierade tröskelvärden, Service Bus kan neka en viss begäran.</span><span class="sxs-lookup"><span data-stu-id="e9a79-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="e9a79-145">Anroparen tar emot en [ServerBusyException] [ ServerBusyException] och försöker efter 10 sekunder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-145">The caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="e9a79-146">Som en minskning koden läsa felet och stoppa alla försök av meddelandet för minst 10 sekunder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-146">As a mitigation, the code must read the error and halt any retries of the message for at least 10 seconds.</span></span> <span data-ttu-id="e9a79-147">Eftersom felet kan inträffa mellan delar av kunden programmet förväntas att varje oberoende körs logik för omprövning.</span><span class="sxs-lookup"><span data-stu-id="e9a79-147">Since the error can happen across pieces of the customer application, it is expected that each piece independently executes the retry logic.</span></span> <span data-ttu-id="e9a79-148">Koden kan minska sannolikheten för begränsas genom att aktivera partitionering på en kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="e9a79-148">The code can reduce the probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="e9a79-149">Problem för ett Azure beroende</span><span class="sxs-lookup"><span data-stu-id="e9a79-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="e9a79-150">Andra komponenter i Azure kan ibland ha problem med tjänsten.</span><span class="sxs-lookup"><span data-stu-id="e9a79-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="e9a79-151">Till exempel när ett system som använder Service Bus uppgraderas uppleva systemet tillfälligt minskade funktioner.</span><span class="sxs-lookup"><span data-stu-id="e9a79-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="e9a79-152">Undvik dessa typer av problem med Service Bus regelbundet undersöker och implementerar åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-152">To work around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="e9a79-153">Sidoeffekter av dessa åtgärder visas.</span><span class="sxs-lookup"><span data-stu-id="e9a79-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="e9a79-154">Om du vill hantera tillfälliga problem med lagring, implementerar exempelvis Service Bus ett system som kan skicka meddelandeåtgärder till arbetar konsekvent.</span><span class="sxs-lookup"><span data-stu-id="e9a79-154">For example, to handle transient issues with storage, Service Bus implements a system that allows message send operations to work consistently.</span></span> <span data-ttu-id="e9a79-155">På grund av minskning, kan ett meddelande skickat ta upp till 15 minuter att visas i den eller de berörda prenumeration och klar för en receive-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="e9a79-155">Due to the nature of the mitigation, a sent message can take up to 15 minutes to appear in the affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="e9a79-156">De flesta enheter får generellt sett inte det här problemet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="e9a79-157">Dock krävs antal entiteter i Service Bus i Azure får den här säkerhetsfunktionen ibland för en liten del av Service Bus-kunder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-157">However, given the number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="e9a79-158">Service Bus-fel på en enda undersystemet</span><span class="sxs-lookup"><span data-stu-id="e9a79-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="e9a79-159">Med valfritt program kan omständigheter orsaka en intern komponenten i Service Bus blir inkonsekventa.</span><span class="sxs-lookup"><span data-stu-id="e9a79-159">With any application, circumstances can cause an internal component of Service Bus to become inconsistent.</span></span> <span data-ttu-id="e9a79-160">När Service Bus identifierar detta, samlar in data från program som gör det enklare att diagnostisera vad hände.</span><span class="sxs-lookup"><span data-stu-id="e9a79-160">When Service Bus detects this, it collects data from the application to aid in diagnosing what happened.</span></span> <span data-ttu-id="e9a79-161">När data samlas in, startas programmet i ett försök att återgå till ett konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="e9a79-161">Once the data is collected, the application is restarted in an attempt to return it to a consistent state.</span></span> <span data-ttu-id="e9a79-162">Den här processen sker ganska snabbt och resulterar i en entitet som inte är tillgänglig för upp till några minuter, även om de vanliga stopptider är mycket kortare.</span><span class="sxs-lookup"><span data-stu-id="e9a79-162">This process happens fairly quickly, and results in an entity appearing to be unavailable for up to a few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="e9a79-163">I dessa fall klientprogrammet genererar en [System.TimeoutException] [ System.TimeoutException] eller [MessagingException] [ MessagingException] undantag.</span><span class="sxs-lookup"><span data-stu-id="e9a79-163">In these cases, the client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="e9a79-164">Service Bus innehåller en lösning på problemet i form av automatiserade klienten logik.</span><span class="sxs-lookup"><span data-stu-id="e9a79-164">Service Bus contains a mitigation for this issue in the form of automated client retry logic.</span></span> <span data-ttu-id="e9a79-165">När försök perioden är slut och meddelandet levereras inte kan du utforska med andra funktioner, till exempel [länkas namnområden][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="e9a79-165">Once the retry period is exhausted and the message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="e9a79-166">Parad namnområden ha andra upplysningar som beskrivs i artikeln.</span><span class="sxs-lookup"><span data-stu-id="e9a79-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="e9a79-167">Fel i Service Bus i ett Azure-datacenter</span><span class="sxs-lookup"><span data-stu-id="e9a79-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="e9a79-168">För ett fel i ett Azure-datacenter trolig orsak är en misslyckad uppgradering distribution av Service Bus eller ett beroende system.</span><span class="sxs-lookup"><span data-stu-id="e9a79-168">The most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="e9a79-169">Eftersom plattformen har mognadslagrats har sannolikheten för den här typen av fel minskat.</span><span class="sxs-lookup"><span data-stu-id="e9a79-169">As the platform has matured, the likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="e9a79-170">Ett fel i datacenter kan också inträffa skäl som inkluderar följande:</span><span class="sxs-lookup"><span data-stu-id="e9a79-170">A datacenter failure can also happen for reasons that include the following:</span></span>

* <span data-ttu-id="e9a79-171">Elektriskt avbrott (strömförsörjning och genererar power försvinner).</span><span class="sxs-lookup"><span data-stu-id="e9a79-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="e9a79-172">Anslutningen (internet bryta mellan klienter och Azure).</span><span class="sxs-lookup"><span data-stu-id="e9a79-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="e9a79-173">I båda fallen kan orsakade en fysisk eller syntetiska katastrof problemet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-173">In both cases, a natural or man-made disaster caused the issue.</span></span> <span data-ttu-id="e9a79-174">Att komma runt detta och kontrollera att du kan fortfarande skicka meddelanden, kan du använda [länkas namnområden] [ paired namespaces] meddelanden ska skickas till en annan plats medan den primära platsen görs felfri igen.</span><span class="sxs-lookup"><span data-stu-id="e9a79-174">To work around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] to enable messages to be sent to a second location while the primary location is made healthy again.</span></span> <span data-ttu-id="e9a79-175">Mer information finns i [bästa praxis för isolering program mot Service Bus-avbrott och katastrofer][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="e9a79-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="e9a79-176">Kopplade namnområden</span><span class="sxs-lookup"><span data-stu-id="e9a79-176">Paired namespaces</span></span>
<span data-ttu-id="e9a79-177">Den [länkas namnområden] [ paired namespaces] funktionen stöder scenarier där en Service Bus-entitet eller distribution inom ett datacenter blir otillgänglig.</span><span class="sxs-lookup"><span data-stu-id="e9a79-177">The [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="e9a79-178">När den här händelsen inträffar sällan, måste distribuerade system fortfarande vara beredd att hantera värsta fall.</span><span class="sxs-lookup"><span data-stu-id="e9a79-178">While this event occurs infrequently, distributed systems still must be prepared to handle worst case scenarios.</span></span> <span data-ttu-id="e9a79-179">Den här händelsen inträffar normalt eftersom vissa element som Service Bus beroende har uppstått ett kortsiktiga problem.</span><span class="sxs-lookup"><span data-stu-id="e9a79-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="e9a79-180">Om du vill behålla tillgänglighet under ett avbrott, kan Service Bus användare använda två separata namnområden, helst i olika datacenter, som värd för sin meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="e9a79-180">To maintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, to host their messaging entities.</span></span> <span data-ttu-id="e9a79-181">Resten av det här avsnittet använder följande termer:</span><span class="sxs-lookup"><span data-stu-id="e9a79-181">The remainder of this section uses the following terminology:</span></span>

* <span data-ttu-id="e9a79-182">Primär namnområde: namnområdet som ditt program samverkar för skicka och ta emot åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e9a79-182">Primary namespace: The namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="e9a79-183">Sekundär namnområde: det namnområde som fungerar som en säkerhetskopia till primära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-183">Secondary namespace: The namespace that acts as a backup to the primary namespace.</span></span> <span data-ttu-id="e9a79-184">Programlogik interagerar inte med det här namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="e9a79-185">Intervall för redundans: hur lång tid att acceptera normal fel innan programmet växlar från namnområdet primär till sekundär namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-185">Failover interval: The amount of time to accept normal failures before the application switches from the primary namespace to the secondary namespace.</span></span>

<span data-ttu-id="e9a79-186">Länkas namnområden stöd *skicka tillgänglighet*.</span><span class="sxs-lookup"><span data-stu-id="e9a79-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="e9a79-187">Skicka tillgänglighet bevarar möjligheten att skicka meddelanden.</span><span class="sxs-lookup"><span data-stu-id="e9a79-187">Send availability preserves the ability to send messages.</span></span> <span data-ttu-id="e9a79-188">Om du vill använda Skicka tillgänglighet måste ditt program uppfylla följande krav:</span><span class="sxs-lookup"><span data-stu-id="e9a79-188">To use send availability, your application must meet the following requirements:</span></span>

1. <span data-ttu-id="e9a79-189">Meddelanden tas bara emot från det primära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-189">Messages are only received from the primary namespace.</span></span>
2. <span data-ttu-id="e9a79-190">Skicka meddelanden till en viss kö eller avsnittet kan tas emot i rätt ordning.</span><span class="sxs-lookup"><span data-stu-id="e9a79-190">Messages sent to a given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="e9a79-191">Meddelanden i en session kan tas emot i rätt ordning.</span><span class="sxs-lookup"><span data-stu-id="e9a79-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="e9a79-192">Det här är ett avbrott från normala funktionerna för sessioner.</span><span class="sxs-lookup"><span data-stu-id="e9a79-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="e9a79-193">Det innebär att programmet använder sessioner till logiskt gruppera meddelanden.</span><span class="sxs-lookup"><span data-stu-id="e9a79-193">This means that your application uses sessions to logically group messages.</span></span>
4. <span data-ttu-id="e9a79-194">Sessionstillstånd bevaras endast på primära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-194">Session state is only maintained on the primary namespace.</span></span>
5. <span data-ttu-id="e9a79-195">Primär kön kan anslutas och börja ta emot meddelanden innan sekundär kö levererar alla meddelanden i kön primära.</span><span class="sxs-lookup"><span data-stu-id="e9a79-195">The primary queue can come online and start accepting messages before the secondary queue delivers all messages into the primary queue.</span></span>

<span data-ttu-id="e9a79-196">I följande avsnitt beskrivs de API: er, hur de API: er implementeras och visar exempelkoden som använder funktionen.</span><span class="sxs-lookup"><span data-stu-id="e9a79-196">The following sections discuss the APIs, how the APIs are implemented, and shows sample code that uses the feature.</span></span> <span data-ttu-id="e9a79-197">Observera att fakturering effekter som är associerade med den här funktionen.</span><span class="sxs-lookup"><span data-stu-id="e9a79-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="the-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="e9a79-198">MessagingFactory.PairNamespaceAsync API</span><span class="sxs-lookup"><span data-stu-id="e9a79-198">The MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="e9a79-199">Funktionen parad namnområden innehåller den [PairNamespaceAsync] [ PairNamespaceAsync] -metoden i den [Microsoft.ServiceBus.Messaging.MessagingFactory] [ Microsoft.ServiceBus.Messaging.MessagingFactory] klass:</span><span class="sxs-lookup"><span data-stu-id="e9a79-199">The paired namespaces feature includes the [PairNamespaceAsync][PairNamespaceAsync] method on the [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="e9a79-200">När uppgiften har slutförts länkning av namnområdet är också fullständig och redo att vidta åtgärder för alla [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], eller [TopicClient] [ TopicClient] skapats med den [MessagingFactory] [ MessagingFactory] instans.</span><span class="sxs-lookup"><span data-stu-id="e9a79-200">When the task completes, the namespace pairing is also complete and ready to act upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with the [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="e9a79-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] [ Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] är basklass för de olika typerna av länkar som är tillgängliga med en [MessagingFactory] [ MessagingFactory] objekt.</span><span class="sxs-lookup"><span data-stu-id="e9a79-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is the base class for the different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="e9a79-202">För närvarande den enda härledda klassen är ett med namnet [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], som implementerar skicka tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-202">Currently, the only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements the send availability requirements.</span></span> <span data-ttu-id="e9a79-203">[SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] har en uppsättning konstruktorer som bygger på varandra.</span><span class="sxs-lookup"><span data-stu-id="e9a79-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="e9a79-204">Granskar konstruktorn med de flesta parametrar kan förstå du beteendet för andra konstruktorer.</span><span class="sxs-lookup"><span data-stu-id="e9a79-204">Looking at the constructor with the most parameters, you can understand the behavior of the other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="e9a79-205">Dessa parametrar har följande:</span><span class="sxs-lookup"><span data-stu-id="e9a79-205">These parameters have the following meanings:</span></span>

* <span data-ttu-id="e9a79-206">*secondaryNamespaceManager*: en initierad [NamespaceManager] [ NamespaceManager] instanser för sekundära namnområdet som den [PairNamespaceAsync] [ PairNamespaceAsync] metod kan använda för att konfigurera sekundära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for the secondary namespace that the [PairNamespaceAsync][PairNamespaceAsync] method can use to set up the secondary namespace.</span></span> <span data-ttu-id="e9a79-207">Namespace manager för att hämta listan över köer i namnområdet och se till att de nödvändiga eftersläpning köerna finns.</span><span class="sxs-lookup"><span data-stu-id="e9a79-207">The namespace manager is used to obtain the list of queues in the namespace and to make sure that the required backlog queues exist.</span></span> <span data-ttu-id="e9a79-208">Om de köerna som inte finns, skapas de.</span><span class="sxs-lookup"><span data-stu-id="e9a79-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="e9a79-209">[NamespaceManager] [ NamespaceManager] kräver möjlighet att skapa en token med den **hantera** anspråk.</span><span class="sxs-lookup"><span data-stu-id="e9a79-209">[NamespaceManager][NamespaceManager] requires the ability to create a token with the **Manage** claim.</span></span>
* <span data-ttu-id="e9a79-210">*messagingFactory*: den [MessagingFactory] [ MessagingFactory] instanser för sekundära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-210">*messagingFactory*: The [MessagingFactory][MessagingFactory] instance for the secondary namespace.</span></span> <span data-ttu-id="e9a79-211">Den [MessagingFactory] [ MessagingFactory] objektet används för att skicka och, om den [EnableSyphon] [ EnableSyphon] egenskap är inställd på **SANT**, ta emot meddelanden från eftersläpning köer.</span><span class="sxs-lookup"><span data-stu-id="e9a79-211">The [MessagingFactory][MessagingFactory] object is used to send and, if the [EnableSyphon][EnableSyphon] property is set to **true**, receive messages from the backlog queues.</span></span>
* <span data-ttu-id="e9a79-212">*backlogQueueCount*: antalet eftersläpning köer om du vill skapa.</span><span class="sxs-lookup"><span data-stu-id="e9a79-212">*backlogQueueCount*: The number of backlog queues to create.</span></span> <span data-ttu-id="e9a79-213">Det här värdet måste vara minst 1.</span><span class="sxs-lookup"><span data-stu-id="e9a79-213">This value must be at least 1.</span></span> <span data-ttu-id="e9a79-214">När du skickar meddelanden till eftersläpningen, väljs något av dessa köer slumpmässigt.</span><span class="sxs-lookup"><span data-stu-id="e9a79-214">When sending messages to the backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="e9a79-215">Om du anger värdet till 1 kan endast en kö skulle användas.</span><span class="sxs-lookup"><span data-stu-id="e9a79-215">If you set the value to 1, then only one queue can ever be used.</span></span> <span data-ttu-id="e9a79-216">När detta sker och en eftersläpning kön genererar fel, klienten har inte möjlighet att prova en annan eftersläpning kö och misslyckas med att skicka meddelandet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-216">When this happens and the one backlog queue generates errors, the client is not able to try a different backlog queue and may fail to send your message.</span></span> <span data-ttu-id="e9a79-217">Vi rekommenderar att om det här värdet till vissa större värde och standard värdet till 10.</span><span class="sxs-lookup"><span data-stu-id="e9a79-217">We recommend setting this value to some larger value and default the value to 10.</span></span> <span data-ttu-id="e9a79-218">Du kan ändra det till ett högre eller lägre värde beroende på hur mycket data som programmet skickar per dag.</span><span class="sxs-lookup"><span data-stu-id="e9a79-218">You can change this to a higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="e9a79-219">Varje eftersläpning kö kan innehålla upp till 5 GB meddelanden.</span><span class="sxs-lookup"><span data-stu-id="e9a79-219">Each backlog queue can hold up to 5 GB of messages.</span></span>
* <span data-ttu-id="e9a79-220">*failoverInterval*: tidsperiod under vilken du kan acceptera fel på det primära namnområdet innan du byter en enda entitet till det sekundära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-220">*failoverInterval*: The amount of time during which you will accept failures on the primary namespace before switching any single entity over to the secondary namespace.</span></span> <span data-ttu-id="e9a79-221">Redundans inträffar för en entitet av entiteten.</span><span class="sxs-lookup"><span data-stu-id="e9a79-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="e9a79-222">Entiteter i en enda namnrymd live ofta på olika noder i Service Bus.</span><span class="sxs-lookup"><span data-stu-id="e9a79-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="e9a79-223">Ett fel i en entitet innebär inte ett fel i en annan.</span><span class="sxs-lookup"><span data-stu-id="e9a79-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="e9a79-224">Du kan ange ett värde [System.TimeSpan.Zero] [ System.TimeSpan.Zero] ska gå över till sekundärt omedelbart efter din första, icke-tillfälligt fel.</span><span class="sxs-lookup"><span data-stu-id="e9a79-224">You can set this value to [System.TimeSpan.Zero][System.TimeSpan.Zero] to failover to the secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="e9a79-225">Fel som utlöser timern redundans finns några [MessagingException] [ MessagingException] där den [IsTransient] [ IsTransient] egenskapen är false, eller en [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="e9a79-225">Failures that trigger the failover timer are any [MessagingException][MessagingException] in which the [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="e9a79-226">Andra undantag som [UnauthorizedAccessException] [ UnauthorizedAccessException] inte orsakar växling vid fel, eftersom de anger att klienten är felaktigt konfigurerad.</span><span class="sxs-lookup"><span data-stu-id="e9a79-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that the client is configured incorrectly.</span></span> <span data-ttu-id="e9a79-227">En [ServerBusyException] [ ServerBusyException] inte orsak redundans eftersom rätt mönstret är att vänta 10 sekunder sedan skickar meddelandet igen.</span><span class="sxs-lookup"><span data-stu-id="e9a79-227">A [ServerBusyException][ServerBusyException] does not cause failover because the correct pattern is to wait 10 seconds, then send the message again.</span></span>
* <span data-ttu-id="e9a79-228">*enableSyphon*: Anger att den här viss länkning bör också syphon meddelanden från namnområdet sekundära tillbaka till det primära namnområdet.</span><span class="sxs-lookup"><span data-stu-id="e9a79-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from the secondary namespace back to the primary namespace.</span></span> <span data-ttu-id="e9a79-229">I allmänhet program som skickar meddelanden ska du ange **FALSKT**; program som tar emot meddelanden ska du ange **SANT**.</span><span class="sxs-lookup"><span data-stu-id="e9a79-229">In general, applications that send messages should set this value to **false**; applications that receive messages should set this value to **true**.</span></span> <span data-ttu-id="e9a79-230">Anledningen är att ofta, det finns färre meddelandet mottagare än avsändare.</span><span class="sxs-lookup"><span data-stu-id="e9a79-230">The reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="e9a79-231">Beroende på antalet mottagare, kan du ha ett enda program-instans hanterar syphon uppgifter.</span><span class="sxs-lookup"><span data-stu-id="e9a79-231">Depending on the number of receivers, you can choose to have a single application instance handle the syphon duties.</span></span> <span data-ttu-id="e9a79-232">Många mottagare har fakturering konsekvenser för varje eftersläpning kö.</span><span class="sxs-lookup"><span data-stu-id="e9a79-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="e9a79-233">Om du vill använda koden, skapar du en primär [MessagingFactory] [ MessagingFactory] instans, en sekundär [MessagingFactory] [ MessagingFactory] instans, en sekundär [NamespaceManager] [ NamespaceManager] instans, och en [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] instans.</span><span class="sxs-lookup"><span data-stu-id="e9a79-233">To use the code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="e9a79-234">Anropet kan vara så enkelt som följande:</span><span class="sxs-lookup"><span data-stu-id="e9a79-234">The call can be as simple as the following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="e9a79-235">När uppgiften som returneras av den [PairNamespaceAsync] [ PairNamespaceAsync] metoden har slutförts, allt har installerats och redo att användas.</span><span class="sxs-lookup"><span data-stu-id="e9a79-235">When the task returned by the [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready to use.</span></span> <span data-ttu-id="e9a79-236">Innan aktiviteten returneras kan kanske du inte har slutförts alla bakgrundsjobbet krävs för att kopplingen ska fungera rätt.</span><span class="sxs-lookup"><span data-stu-id="e9a79-236">Before the task is returned, you may not have completed all of the background work necessary for the pairing to work right.</span></span> <span data-ttu-id="e9a79-237">Du bör därför inte börja skicka meddelanden tills uppgiften returnerar.</span><span class="sxs-lookup"><span data-stu-id="e9a79-237">As a result, you should not start sending messages until the task returns.</span></span> <span data-ttu-id="e9a79-238">Eventuella fel, till exempel felaktiga autentiseringsuppgifter eller inte gick att skapa köer eftersläpning utlöstes dessa undantag när uppgiften har slutförts.</span><span class="sxs-lookup"><span data-stu-id="e9a79-238">If any failures occurred, such as bad credentials, or failure to create the backlog queues, those exceptions will be thrown once the task completes.</span></span> <span data-ttu-id="e9a79-239">När uppgiften returnerar, kontrollera att köerna hittades eller skapas genom att undersöka den [BacklogQueueCount] [ BacklogQueueCount] -egenskapen i din [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] instans.</span><span class="sxs-lookup"><span data-stu-id="e9a79-239">Once the task returns, verify that the queues were found or created by examining the [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="e9a79-240">För den föregående kod, som åtgärden visas på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="e9a79-240">For the preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="e9a79-241">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="e9a79-241">Next steps</span></span>
<span data-ttu-id="e9a79-242">Nu när du har lärt dig grunderna om asynkrona meddelanden i Service Bus kan du läsa mer information om [länkas namnområden][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="e9a79-242">Now that you've learned the basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md
