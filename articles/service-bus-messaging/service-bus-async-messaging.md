---
title: aaaService bussen asynkrona meddelanden | Microsoft Docs
description: Beskrivning av Azure Service Bus asynkrona meddelanden.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 5ab6ddf052155a9dd975b413cfaf393119c1999d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="c8732-103">Asynkrona meddelandemönster och hög tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="c8732-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="c8732-104">Asynkrona meddelanden kan implementeras i en mängd olika sätt.</span><span class="sxs-lookup"><span data-stu-id="c8732-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="c8732-105">Köer, ämnen och prenumerationer stöder Azure Service Bus asynchronism via en store och vidarebefordra mekanism.</span><span class="sxs-lookup"><span data-stu-id="c8732-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="c8732-106">Under normal drift av (synkron), skicka meddelanden tooqueues och ämnen och ta emot meddelanden från köer och -prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="c8732-106">In normal (synchronous) operation, you send messages tooqueues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="c8732-107">Program som du skriver är beroende av dessa enheter alltid är tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="c8732-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="c8732-108">När hello entitetshälsa ändras på grund av tooa olika förhållanden, behöver du ett sätt tooprovide en minskad kapacitet entitet som kan uppfylla de flesta behov.</span><span class="sxs-lookup"><span data-stu-id="c8732-108">When hello entity health changes, due tooa variety of circumstances, you need a way tooprovide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="c8732-109">Program använder vanligtvis asynkrona meddelanden mönster tooenable ett antal kommunikationsscenarier.</span><span class="sxs-lookup"><span data-stu-id="c8732-109">Applications typically use asynchronous messaging patterns tooenable a number of communication scenarios.</span></span> <span data-ttu-id="c8732-110">Du kan skapa program som klienter kan skicka meddelanden tooservices, även om hello-tjänsten inte körs.</span><span class="sxs-lookup"><span data-stu-id="c8732-110">You can build applications in which clients can send messages tooservices, even when hello service is not running.</span></span> <span data-ttu-id="c8732-111">En kö kan hjälpa nivån hello läsa in genom att tillhandahålla en plats toobuffer kommunikation för program som får belastning av kommunikation.</span><span class="sxs-lookup"><span data-stu-id="c8732-111">For applications that experience bursts of communications, a queue can help level hello load by providing a place toobuffer communications.</span></span> <span data-ttu-id="c8732-112">Slutligen kan du få en tydlig och effektiv belastning belastningsutjämnaren toodistribute meddelanden på flera datorer.</span><span class="sxs-lookup"><span data-stu-id="c8732-112">Finally, you can get a simple but effective load balancer toodistribute messages across multiple machines.</span></span>

<span data-ttu-id="c8732-113">Överväg ett antal olika sätt som dessa enheter kan visas inte tillgängligt för en beständig meddelandesystem i ordning toomaintain tillgänglighet av någon av dessa enheter.</span><span class="sxs-lookup"><span data-stu-id="c8732-113">In order toomaintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="c8732-114">Generellt sett finns vi hello entitet blir otillgänglig tooapplications vi skriva i hello efter olika sätt:</span><span class="sxs-lookup"><span data-stu-id="c8732-114">Generally speaking, we see hello entity become unavailable tooapplications we write in hello following different ways:</span></span>

* <span data-ttu-id="c8732-115">Det går inte toosend meddelanden.</span><span class="sxs-lookup"><span data-stu-id="c8732-115">Unable toosend messages.</span></span>
* <span data-ttu-id="c8732-116">Det går inte tooreceive meddelanden.</span><span class="sxs-lookup"><span data-stu-id="c8732-116">Unable tooreceive messages.</span></span>
* <span data-ttu-id="c8732-117">Det går inte toomanage entiteter (skapa, hämta, uppdatera eller ta bort enheter).</span><span class="sxs-lookup"><span data-stu-id="c8732-117">Unable toomanage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="c8732-118">Det går inte toocontact hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="c8732-118">Unable toocontact hello service.</span></span>

<span data-ttu-id="c8732-119">För var och en av dessa fel finns olika feltillstånd som gör att ett program toocontinue tooperform arbete på vissa nivå för minskade kapaciteten.</span><span class="sxs-lookup"><span data-stu-id="c8732-119">For each of these failures, different failure modes exist that enable an application toocontinue tooperform work at some level of reduced capability.</span></span> <span data-ttu-id="c8732-120">Ett system som kan skicka meddelanden, men inte tagit emot dem fortfarande kan ta emot order från kunder men kan inte bearbeta dessa order.</span><span class="sxs-lookup"><span data-stu-id="c8732-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="c8732-121">Det här avsnittet beskrivs problem som kan uppstå och hur dessa problem begränsas.</span><span class="sxs-lookup"><span data-stu-id="c8732-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="c8732-122">Service Bus har införs ett antal åtgärder som du måste välja i och det här avsnittet beskriver också hello reglerna för hello användning av dessa Anmäl åtgärder.</span><span class="sxs-lookup"><span data-stu-id="c8732-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses hello rules governing hello use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="c8732-123">Tillförlitlighet i Service Bus</span><span class="sxs-lookup"><span data-stu-id="c8732-123">Reliability in Service Bus</span></span>
<span data-ttu-id="c8732-124">Det finns flera sätt toohandle meddelandet och entiteten problem och det finns riktlinjer för hello rätt användning av dessa åtgärder.</span><span class="sxs-lookup"><span data-stu-id="c8732-124">There are several ways toohandle message and entity issues, and there are guidelines governing hello appropriate use of those mitigations.</span></span> <span data-ttu-id="c8732-125">toounderstand hello riktlinjer måste du först förstå vad kan misslyckas i Service Bus.</span><span class="sxs-lookup"><span data-stu-id="c8732-125">toounderstand hello guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="c8732-126">På grund av toohello utformning av Azure system till dessa problem brukar toobe tillfällig.</span><span class="sxs-lookup"><span data-stu-id="c8732-126">Due toohello design of Azure systems, all of these issues tend toobe short-lived.</span></span> <span data-ttu-id="c8732-127">På en hög nivå visas hello olika orsaker till att på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="c8732-127">At a high level, hello different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="c8732-128">Begränsning från ett externt system som Service Bus är beroende av.</span><span class="sxs-lookup"><span data-stu-id="c8732-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="c8732-129">Begränsning inträffar på samverkan med resurser för lagring och beräkning.</span><span class="sxs-lookup"><span data-stu-id="c8732-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="c8732-130">Problemet för ett system som Service Bus beroende.</span><span class="sxs-lookup"><span data-stu-id="c8732-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="c8732-131">En viss del av lagring kan exempelvis stöter på problem.</span><span class="sxs-lookup"><span data-stu-id="c8732-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="c8732-132">Fel i Service Bus på enskild undersystemet.</span><span class="sxs-lookup"><span data-stu-id="c8732-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="c8732-133">I så fall kan en beräkningsnod kan få till ett inkonsekvent tillstånd och måste startas om, gör att alla enheter fungerar tooload saldo tooother noder.</span><span class="sxs-lookup"><span data-stu-id="c8732-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves tooload balance tooother nodes.</span></span> <span data-ttu-id="c8732-134">I sin tur kan orsaka en kort period av långsam meddelandebehandling.</span><span class="sxs-lookup"><span data-stu-id="c8732-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="c8732-135">Fel i Service Bus i ett Azure-datacenter.</span><span class="sxs-lookup"><span data-stu-id="c8732-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="c8732-136">Detta är ett ”oåterkalleligt fel” som då hello system kan inte nås för många minuter eller några timmar.</span><span class="sxs-lookup"><span data-stu-id="c8732-136">This is a "catastrophic failure" during which hello system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="c8732-137">hello termen **lagring** kan omfatta både Azure-lagring och SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="c8732-137">hello term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="c8732-138">Service Bus innehåller ett antal åtgärder för dessa problem.</span><span class="sxs-lookup"><span data-stu-id="c8732-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="c8732-139">hello följande avsnitt beskrivs varje problem och deras respektive ändringar.</span><span class="sxs-lookup"><span data-stu-id="c8732-139">hello following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="c8732-140">Begränsning</span><span class="sxs-lookup"><span data-stu-id="c8732-140">Throttling</span></span>
<span data-ttu-id="c8732-141">Med Service Bus begränsning gör det möjligt samverkande meddelandet hastighet.</span><span class="sxs-lookup"><span data-stu-id="c8732-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="c8732-142">Varje enskild nod för Service Bus innehåller många entiteter.</span><span class="sxs-lookup"><span data-stu-id="c8732-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="c8732-143">Var och en av dessa enheter ansluter krav på hello system vad gäller CPU, minne, lagring och andra facets.</span><span class="sxs-lookup"><span data-stu-id="c8732-143">Each of those entities makes demands on hello system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="c8732-144">När någon av dessa aspekter identifierar användning som överskrider definierade tröskelvärden, Service Bus kan neka en viss begäran.</span><span class="sxs-lookup"><span data-stu-id="c8732-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="c8732-145">hello anroparen tar emot en [ServerBusyException] [ ServerBusyException] och försöker efter 10 sekunder.</span><span class="sxs-lookup"><span data-stu-id="c8732-145">hello caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="c8732-146">Som en minskning hello kod läsfel hello och stoppa alla försök av hello-meddelande för minst 10 sekunder.</span><span class="sxs-lookup"><span data-stu-id="c8732-146">As a mitigation, hello code must read hello error and halt any retries of hello message for at least 10 seconds.</span></span> <span data-ttu-id="c8732-147">Eftersom hello fel kan inträffa mellan delar av hello kunden program förväntas att varje oberoende körs hello logik.</span><span class="sxs-lookup"><span data-stu-id="c8732-147">Since hello error can happen across pieces of hello customer application, it is expected that each piece independently executes hello retry logic.</span></span> <span data-ttu-id="c8732-148">hello kod kan minska hello sannolikheten för begränsas genom att aktivera partitionering på en kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="c8732-148">hello code can reduce hello probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="c8732-149">Problem för ett Azure beroende</span><span class="sxs-lookup"><span data-stu-id="c8732-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="c8732-150">Andra komponenter i Azure kan ibland ha problem med tjänsten.</span><span class="sxs-lookup"><span data-stu-id="c8732-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="c8732-151">Till exempel när ett system som använder Service Bus uppgraderas uppleva systemet tillfälligt minskade funktioner.</span><span class="sxs-lookup"><span data-stu-id="c8732-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="c8732-152">toowork runt dessa typer av problem, Service Bus regelbundet undersöker och implementerar åtgärder.</span><span class="sxs-lookup"><span data-stu-id="c8732-152">toowork around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="c8732-153">Sidoeffekter av dessa åtgärder visas.</span><span class="sxs-lookup"><span data-stu-id="c8732-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="c8732-154">Till exempel toohandle övergående problem med storage, Service Bus implementerar ett system som gör att meddelandet skicka operations toowork konsekvent.</span><span class="sxs-lookup"><span data-stu-id="c8732-154">For example, toohandle transient issues with storage, Service Bus implements a system that allows message send operations toowork consistently.</span></span> <span data-ttu-id="c8732-155">På grund av toohello uppbyggnad hello minskning, ett meddelande skickat tar upp too15 minuter tooappear i hello påverkas kö eller prenumeration och klar för en receive-åtgärd.</span><span class="sxs-lookup"><span data-stu-id="c8732-155">Due toohello nature of hello mitigation, a sent message can take up too15 minutes tooappear in hello affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="c8732-156">De flesta enheter får generellt sett inte det här problemet.</span><span class="sxs-lookup"><span data-stu-id="c8732-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="c8732-157">Dock krävs hello antal entiteter i Service Bus i Azure får den här säkerhetsfunktionen ibland för en liten del av Service Bus-kunder.</span><span class="sxs-lookup"><span data-stu-id="c8732-157">However, given hello number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="c8732-158">Service Bus-fel på en enda undersystemet</span><span class="sxs-lookup"><span data-stu-id="c8732-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="c8732-159">Omständigheter kan orsaka en intern komponent i Service Bus toobecome inkonsekvent med alla program.</span><span class="sxs-lookup"><span data-stu-id="c8732-159">With any application, circumstances can cause an internal component of Service Bus toobecome inconsistent.</span></span> <span data-ttu-id="c8732-160">När Service Bus identifierar detta, samlar in data från hello programmet tooaid diagnostisera vad hände.</span><span class="sxs-lookup"><span data-stu-id="c8732-160">When Service Bus detects this, it collects data from hello application tooaid in diagnosing what happened.</span></span> <span data-ttu-id="c8732-161">När hello data samlas hello programmet har startats om i ett försök tooreturn den tooa konsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="c8732-161">Once hello data is collected, hello application is restarted in an attempt tooreturn it tooa consistent state.</span></span> <span data-ttu-id="c8732-162">Den här processen sker ganska snabbt och resulterar i en entitet visas toobe är inte tillgänglig för dig tooa några minuter om vanliga stopptider är mycket kortare.</span><span class="sxs-lookup"><span data-stu-id="c8732-162">This process happens fairly quickly, and results in an entity appearing toobe unavailable for up tooa few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="c8732-163">I dessa fall hello klientprogrammet genererar en [System.TimeoutException] [ System.TimeoutException] eller [MessagingException] [ MessagingException] undantag.</span><span class="sxs-lookup"><span data-stu-id="c8732-163">In these cases, hello client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="c8732-164">Service Bus innehåller en lösning på problemet i hello form av automatiserade klienten logik.</span><span class="sxs-lookup"><span data-stu-id="c8732-164">Service Bus contains a mitigation for this issue in hello form of automated client retry logic.</span></span> <span data-ttu-id="c8732-165">När hello försök perioden är slut och hello-meddelande levereras inte kan du utforska med andra funktioner, till exempel [länkas namnområden][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="c8732-165">Once hello retry period is exhausted and hello message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="c8732-166">Parad namnområden ha andra upplysningar som beskrivs i artikeln.</span><span class="sxs-lookup"><span data-stu-id="c8732-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="c8732-167">Fel i Service Bus i ett Azure-datacenter</span><span class="sxs-lookup"><span data-stu-id="c8732-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="c8732-168">hello trolig orsak till ett fel i ett Azure-datacenter är en misslyckad uppgradering distribution av Service Bus eller ett beroende system.</span><span class="sxs-lookup"><span data-stu-id="c8732-168">hello most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="c8732-169">Eftersom hello-plattformen har mognadslagrats har hello sannolikheten för den här typen av fel minskat.</span><span class="sxs-lookup"><span data-stu-id="c8732-169">As hello platform has matured, hello likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="c8732-170">Ett datacenter-fel kan också inträffa skäl som innehåller hello följande:</span><span class="sxs-lookup"><span data-stu-id="c8732-170">A datacenter failure can also happen for reasons that include hello following:</span></span>

* <span data-ttu-id="c8732-171">Elektriskt avbrott (strömförsörjning och genererar power försvinner).</span><span class="sxs-lookup"><span data-stu-id="c8732-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="c8732-172">Anslutningen (internet bryta mellan klienter och Azure).</span><span class="sxs-lookup"><span data-stu-id="c8732-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="c8732-173">I båda fallen orsakade en fysisk eller syntetiska katastrof hello problemet.</span><span class="sxs-lookup"><span data-stu-id="c8732-173">In both cases, a natural or man-made disaster caused hello issue.</span></span> <span data-ttu-id="c8732-174">toowork runt problemet och se till att du kan fortfarande skicka meddelanden, kan du använda [länkas namnområden] [ paired namespaces] tooenable meddelanden skickas toobe tooa andra plats medan hello primär plats görs felfri igen.</span><span class="sxs-lookup"><span data-stu-id="c8732-174">toowork around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] tooenable messages toobe sent tooa second location while hello primary location is made healthy again.</span></span> <span data-ttu-id="c8732-175">Mer information finns i [bästa praxis för isolering program mot Service Bus-avbrott och katastrofer][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="c8732-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="c8732-176">Kopplade namnområden</span><span class="sxs-lookup"><span data-stu-id="c8732-176">Paired namespaces</span></span>
<span data-ttu-id="c8732-177">Hej [länkas namnområden] [ paired namespaces] funktionen stöder scenarier där en Service Bus-entitet eller distribution inom ett datacenter blir otillgänglig.</span><span class="sxs-lookup"><span data-stu-id="c8732-177">hello [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="c8732-178">När den här händelsen inträffar sällan, måste distribuerade system fortfarande förberedas toohandle värsta fall.</span><span class="sxs-lookup"><span data-stu-id="c8732-178">While this event occurs infrequently, distributed systems still must be prepared toohandle worst case scenarios.</span></span> <span data-ttu-id="c8732-179">Den här händelsen inträffar normalt eftersom vissa element som Service Bus beroende har uppstått ett kortsiktiga problem.</span><span class="sxs-lookup"><span data-stu-id="c8732-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="c8732-180">toomaintain tillgänglighet under ett avbrott, Service Bus-användare kan använda två separata namnområden, helst i olika datacenter, toohost sina meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="c8732-180">toomaintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, toohost their messaging entities.</span></span> <span data-ttu-id="c8732-181">hello resten av det här avsnittet använder hello följande terminologi:</span><span class="sxs-lookup"><span data-stu-id="c8732-181">hello remainder of this section uses hello following terminology:</span></span>

* <span data-ttu-id="c8732-182">Primär namnområde: hello namnområde som interagerar ditt program för skicka och ta emot åtgärder.</span><span class="sxs-lookup"><span data-stu-id="c8732-182">Primary namespace: hello namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="c8732-183">Sekundär namnområde: hello namnområde som fungerar som en primär säkerhetskopiering toohello-namnrymd.</span><span class="sxs-lookup"><span data-stu-id="c8732-183">Secondary namespace: hello namespace that acts as a backup toohello primary namespace.</span></span> <span data-ttu-id="c8732-184">Programlogik interagerar inte med det här namnområdet.</span><span class="sxs-lookup"><span data-stu-id="c8732-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="c8732-185">Intervall för redundans: hello mängden tid tooaccept normal fel innan programmet hello växlar från hello primära namnområde toohello sekundära namnområde.</span><span class="sxs-lookup"><span data-stu-id="c8732-185">Failover interval: hello amount of time tooaccept normal failures before hello application switches from hello primary namespace toohello secondary namespace.</span></span>

<span data-ttu-id="c8732-186">Länkas namnområden stöd *skicka tillgänglighet*.</span><span class="sxs-lookup"><span data-stu-id="c8732-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="c8732-187">Skicka tillgänglighet bevarar hälsningsmeddelande möjlighet toosend.</span><span class="sxs-lookup"><span data-stu-id="c8732-187">Send availability preserves hello ability toosend messages.</span></span> <span data-ttu-id="c8732-188">toouse skicka tillgänglighet ditt program måste uppfylla hello följande krav:</span><span class="sxs-lookup"><span data-stu-id="c8732-188">toouse send availability, your application must meet hello following requirements:</span></span>

1. <span data-ttu-id="c8732-189">Meddelanden tas bara emot från hello primära namnområde.</span><span class="sxs-lookup"><span data-stu-id="c8732-189">Messages are only received from hello primary namespace.</span></span>
2. <span data-ttu-id="c8732-190">Meddelanden som skickas tooa angivna kö eller ett ämne kan tas emot i rätt ordning.</span><span class="sxs-lookup"><span data-stu-id="c8732-190">Messages sent tooa given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="c8732-191">Meddelanden i en session kan tas emot i rätt ordning.</span><span class="sxs-lookup"><span data-stu-id="c8732-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="c8732-192">Det här är ett avbrott från normala funktionerna för sessioner.</span><span class="sxs-lookup"><span data-stu-id="c8732-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="c8732-193">Det innebär att programmet använder sessioner toologically gruppera meddelanden.</span><span class="sxs-lookup"><span data-stu-id="c8732-193">This means that your application uses sessions toologically group messages.</span></span>
4. <span data-ttu-id="c8732-194">Sessionstillstånd bevaras endast på primära hello-namnområdet.</span><span class="sxs-lookup"><span data-stu-id="c8732-194">Session state is only maintained on hello primary namespace.</span></span>
5. <span data-ttu-id="c8732-195">hello primära kön kan anslutas och börja ta emot meddelanden innan hello sekundär kö levererar alla meddelanden i kö för hello primära.</span><span class="sxs-lookup"><span data-stu-id="c8732-195">hello primary queue can come online and start accepting messages before hello secondary queue delivers all messages into hello primary queue.</span></span>

<span data-ttu-id="c8732-196">hello följande avsnitt beskrivs hello API: er, hur hello API: er implementeras och visar exempelkod där hello-funktionen.</span><span class="sxs-lookup"><span data-stu-id="c8732-196">hello following sections discuss hello APIs, how hello APIs are implemented, and shows sample code that uses hello feature.</span></span> <span data-ttu-id="c8732-197">Observera att fakturering effekter som är associerade med den här funktionen.</span><span class="sxs-lookup"><span data-stu-id="c8732-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="hello-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="c8732-198">Hej MessagingFactory.PairNamespaceAsync API</span><span class="sxs-lookup"><span data-stu-id="c8732-198">hello MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="c8732-199">hello parad namnområden funktionen innehåller hello [PairNamespaceAsync] [ PairNamespaceAsync] metod på hello [Microsoft.ServiceBus.Messaging.MessagingFactory] [ Microsoft.ServiceBus.Messaging.MessagingFactory] klass:</span><span class="sxs-lookup"><span data-stu-id="c8732-199">hello paired namespaces feature includes hello [PairNamespaceAsync][PairNamespaceAsync] method on hello [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="c8732-200">När hello uppgiften har slutförts länkning av hello namnområdet är också fullständigt och klart tooact på för alla [MessageReceiver][MessageReceiver], [QueueClient] [ QueueClient], eller [TopicClient] [ TopicClient] skapats med hello [MessagingFactory] [ MessagingFactory] instans.</span><span class="sxs-lookup"><span data-stu-id="c8732-200">When hello task completes, hello namespace pairing is also complete and ready tooact upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with hello [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="c8732-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] [ Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] är hello basklass för hello olika typer av länkar som är tillgängliga med en [MessagingFactory] [ MessagingFactory] objekt.</span><span class="sxs-lookup"><span data-stu-id="c8732-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is hello base class for hello different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="c8732-202">För närvarande hello härledda klass är endast ett med namnet [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], som implementerar hello skicka tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="c8732-202">Currently, hello only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements hello send availability requirements.</span></span> <span data-ttu-id="c8732-203">[SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] har en uppsättning konstruktorer som bygger på varandra.</span><span class="sxs-lookup"><span data-stu-id="c8732-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="c8732-204">Tittar på hello konstruktor med hello de flesta parametrar, förstår du hello funktionssätt hello andra konstruktorer.</span><span class="sxs-lookup"><span data-stu-id="c8732-204">Looking at hello constructor with hello most parameters, you can understand hello behavior of hello other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="c8732-205">Dessa parametrar har hello följande innebörd:</span><span class="sxs-lookup"><span data-stu-id="c8732-205">These parameters have hello following meanings:</span></span>

* <span data-ttu-id="c8732-206">*secondaryNamespaceManager*: en initierad [NamespaceManager] [ NamespaceManager] instansen för hello sekundära namnområde som hello [PairNamespaceAsync] [ PairNamespaceAsync] metod kan använda tooset in hello sekundära namnområde.</span><span class="sxs-lookup"><span data-stu-id="c8732-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for hello secondary namespace that hello [PairNamespaceAsync][PairNamespaceAsync] method can use tooset up hello secondary namespace.</span></span> <span data-ttu-id="c8732-207">hello namespace manager är används tooobtain hello lista över köer i hello namnområde och toomake till att hello krävs eftersläpning köer finns.</span><span class="sxs-lookup"><span data-stu-id="c8732-207">hello namespace manager is used tooobtain hello list of queues in hello namespace and toomake sure that hello required backlog queues exist.</span></span> <span data-ttu-id="c8732-208">Om de köerna som inte finns, skapas de.</span><span class="sxs-lookup"><span data-stu-id="c8732-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="c8732-209">[NamespaceManager] [ NamespaceManager] kräver hello möjlighet toocreate en token med hello **hantera** anspråk.</span><span class="sxs-lookup"><span data-stu-id="c8732-209">[NamespaceManager][NamespaceManager] requires hello ability toocreate a token with hello **Manage** claim.</span></span>
* <span data-ttu-id="c8732-210">*messagingFactory*: hello [MessagingFactory] [ MessagingFactory] instanser för sekundära hello-namnområdet.</span><span class="sxs-lookup"><span data-stu-id="c8732-210">*messagingFactory*: hello [MessagingFactory][MessagingFactory] instance for hello secondary namespace.</span></span> <span data-ttu-id="c8732-211">Hej [MessagingFactory] [ MessagingFactory] objektet är används toosend och, om hello [EnableSyphon] [ EnableSyphon] egenskapen för**SANT** , ta emot meddelanden från hello eftersläpning köer.</span><span class="sxs-lookup"><span data-stu-id="c8732-211">hello [MessagingFactory][MessagingFactory] object is used toosend and, if hello [EnableSyphon][EnableSyphon] property is set too**true**, receive messages from hello backlog queues.</span></span>
* <span data-ttu-id="c8732-212">*backlogQueueCount*: hello antalet eftersläpning köer toocreate.</span><span class="sxs-lookup"><span data-stu-id="c8732-212">*backlogQueueCount*: hello number of backlog queues toocreate.</span></span> <span data-ttu-id="c8732-213">Det här värdet måste vara minst 1.</span><span class="sxs-lookup"><span data-stu-id="c8732-213">This value must be at least 1.</span></span> <span data-ttu-id="c8732-214">När du skickar meddelanden toohello eftersläpning kan väljs något av dessa köer slumpmässigt.</span><span class="sxs-lookup"><span data-stu-id="c8732-214">When sending messages toohello backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="c8732-215">Om du ställer in hello värdet too1 kan endast en kö skulle användas.</span><span class="sxs-lookup"><span data-stu-id="c8732-215">If you set hello value too1, then only one queue can ever be used.</span></span> <span data-ttu-id="c8732-216">När detta sker och hello en eftersläpning kön genererar fel, hello-klienten inte kan tootry en annan eftersläpning kö och misslyckas toosend meddelandet.</span><span class="sxs-lookup"><span data-stu-id="c8732-216">When this happens and hello one backlog queue generates errors, hello client is not able tootry a different backlog queue and may fail toosend your message.</span></span> <span data-ttu-id="c8732-217">Vi rekommenderar att ställa in det här värdet toosome större värde och standard hello värdet too10.</span><span class="sxs-lookup"><span data-stu-id="c8732-217">We recommend setting this value toosome larger value and default hello value too10.</span></span> <span data-ttu-id="c8732-218">Du kan ändra den här tooa som är högre eller lägre värde beroende på hur mycket data som programmet skickar per dag.</span><span class="sxs-lookup"><span data-stu-id="c8732-218">You can change this tooa higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="c8732-219">Varje eftersläpning kö kan innehålla upp too5 GB meddelanden.</span><span class="sxs-lookup"><span data-stu-id="c8732-219">Each backlog queue can hold up too5 GB of messages.</span></span>
* <span data-ttu-id="c8732-220">*failoverInterval*: hello tidsperiod under vilken du kan acceptera fel på hello primära namnområde innan du byter en enda entitet över toohello sekundära namnområde.</span><span class="sxs-lookup"><span data-stu-id="c8732-220">*failoverInterval*: hello amount of time during which you will accept failures on hello primary namespace before switching any single entity over toohello secondary namespace.</span></span> <span data-ttu-id="c8732-221">Redundans inträffar för en entitet av entiteten.</span><span class="sxs-lookup"><span data-stu-id="c8732-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="c8732-222">Entiteter i en enda namnrymd live ofta på olika noder i Service Bus.</span><span class="sxs-lookup"><span data-stu-id="c8732-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="c8732-223">Ett fel i en entitet innebär inte ett fel i en annan.</span><span class="sxs-lookup"><span data-stu-id="c8732-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="c8732-224">Du kan ange ett värde för[System.TimeSpan.Zero] [ System.TimeSpan.Zero] toofailover toohello sekundära omedelbart efter din första, icke-tillfälligt fel.</span><span class="sxs-lookup"><span data-stu-id="c8732-224">You can set this value too[System.TimeSpan.Zero][System.TimeSpan.Zero] toofailover toohello secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="c8732-225">Fel som utlöser hello redundans timer finns några [MessagingException] [ MessagingException] i vilka hello [IsTransient] [ IsTransient] egenskapen är false, eller en [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="c8732-225">Failures that trigger hello failover timer are any [MessagingException][MessagingException] in which hello [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="c8732-226">Andra undantag som [UnauthorizedAccessException] [ UnauthorizedAccessException] inte orsakar växling vid fel, eftersom de visar hello klienten är felaktigt konfigurerad.</span><span class="sxs-lookup"><span data-stu-id="c8732-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that hello client is configured incorrectly.</span></span> <span data-ttu-id="c8732-227">En [ServerBusyException] [ ServerBusyException] inte orsak redundans eftersom hello rätt mönstret är toowait 10 sekunder sedan skickar hello-meddelande igen.</span><span class="sxs-lookup"><span data-stu-id="c8732-227">A [ServerBusyException][ServerBusyException] does not cause failover because hello correct pattern is toowait 10 seconds, then send hello message again.</span></span>
* <span data-ttu-id="c8732-228">*enableSyphon*: Anger att den här viss länkning bör också syphon meddelanden från hello sekundära namnområde tillbaka toohello primära namnområde.</span><span class="sxs-lookup"><span data-stu-id="c8732-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from hello secondary namespace back toohello primary namespace.</span></span> <span data-ttu-id="c8732-229">I allmänhet program som skickar meddelanden ska ange ett värde för**FALSKT**; program som tar emot meddelanden måste ange ett värde för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="c8732-229">In general, applications that send messages should set this value too**false**; applications that receive messages should set this value too**true**.</span></span> <span data-ttu-id="c8732-230">hello anledningen är att ofta, det finns färre meddelandet mottagare än avsändare.</span><span class="sxs-lookup"><span data-stu-id="c8732-230">hello reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="c8732-231">Du kan välja ett enda program instans referensen hello syphon uppgifter toohave beroende på hello antal mottagare.</span><span class="sxs-lookup"><span data-stu-id="c8732-231">Depending on hello number of receivers, you can choose toohave a single application instance handle hello syphon duties.</span></span> <span data-ttu-id="c8732-232">Många mottagare har fakturering konsekvenser för varje eftersläpning kö.</span><span class="sxs-lookup"><span data-stu-id="c8732-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="c8732-233">toouse Hej koden, skapa en primär [MessagingFactory] [ MessagingFactory] instans, en sekundär [MessagingFactory] [ MessagingFactory] instans, en sekundär [NamespaceManager] [ NamespaceManager] instans, och en [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] instans.</span><span class="sxs-lookup"><span data-stu-id="c8732-233">toouse hello code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="c8732-234">hello-anropet kan vara så enkelt som hello följande:</span><span class="sxs-lookup"><span data-stu-id="c8732-234">hello call can be as simple as hello following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="c8732-235">När hello uppgiften som returneras av hello [PairNamespaceAsync] [ PairNamespaceAsync] metoden har slutförts, allt är korrekt och toouse är klara.</span><span class="sxs-lookup"><span data-stu-id="c8732-235">When hello task returned by hello [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready toouse.</span></span> <span data-ttu-id="c8732-236">Innan hello uppgiften returneras kan kanske du inte har slutförts alla hello bakgrundsjobbet krävs för hello länkning toowork höger.</span><span class="sxs-lookup"><span data-stu-id="c8732-236">Before hello task is returned, you may not have completed all of hello background work necessary for hello pairing toowork right.</span></span> <span data-ttu-id="c8732-237">Du bör därför inte börja skicka meddelanden tills hello uppgiften returnerar.</span><span class="sxs-lookup"><span data-stu-id="c8732-237">As a result, you should not start sending messages until hello task returns.</span></span> <span data-ttu-id="c8732-238">Eventuella fel, till exempel felaktiga autentiseringsuppgifter eller fel toocreate hello eftersläpning köer utlöstes dessa undantag när hello uppgiften har slutförts.</span><span class="sxs-lookup"><span data-stu-id="c8732-238">If any failures occurred, such as bad credentials, or failure toocreate hello backlog queues, those exceptions will be thrown once hello task completes.</span></span> <span data-ttu-id="c8732-239">När hello uppgiften returnerar, kontrollera att hello köer hittades eller skapas genom att undersöka hello [BacklogQueueCount] [ BacklogQueueCount] -egenskapen i din [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] instans.</span><span class="sxs-lookup"><span data-stu-id="c8732-239">Once hello task returns, verify that hello queues were found or created by examining hello [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="c8732-240">För hello föregående kod som åtgärden visas på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="c8732-240">For hello preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="c8732-241">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="c8732-241">Next steps</span></span>
<span data-ttu-id="c8732-242">Nu när du har lärt dig hello grunderna för asynkrona meddelanden i Service Bus kan du läsa mer information om [länkas namnområden][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="c8732-242">Now that you've learned hello basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md
