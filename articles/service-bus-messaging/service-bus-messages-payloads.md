---
title: Azure Service Bus-meddelanden, nyttolaster och serialisering | Microsoft Docs
description: "Översikt över Service Bus meddelande-nyttolaster"
services: service-bus-messaging
documentationcenter: 
author: clemensv
manager: timlt
editor: 
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/28/2017
ms.author: sethm
ms.openlocfilehash: 7c18cc4a0e6a8dbf3a47c146707666c5538ff7c3
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/11/2017
---
# <a name="messages-payloads-and-serialization"></a>Meddelanden och nyttolaster serialisering

Microsoft Azure Service Bus hanterar meddelanden. Meddelanden utföra en nyttolast samt metadata i form av nyckel / värde-par egenskaper, som beskriver nyttolasten och ger instruktioner för hantering till Service Bus och program. Ibland kan att enbart metadata är tillräcklig för att utföra den information som avsändaren vill meddela mottagare och nyttolasten fortfarande är tom.

Objektmodell för de officiella Service Bus-klienterna för .NET och Java avspeglar abstract Service Bus meddelandestruktur som är mappad till och från Service Bus stöder överföring protokoll.
 
En Service Bus-meddelande består av en binär nyttolast-avsnitt som Service Bus hanterar aldrig i någon form på tjänstsidan- och två uppsättningar med egenskaper. Den *broker egenskaper* är fördefinierade i systemet. Dessa fördefinierade egenskaper styr antingen meddelandenivå funktioner i Service broker eller mappa till vanliga och standardiserad metadata-objekt. Den *användaregenskaper* är en samling med nyckel-värdepar som kan definieras och ange av programmet.
 
Fördefinierade broker egenskaper visas i följande tabell. Namn som används med alla officiella klientens API: er och även i den [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Properties_) JSON-objekt av mappningen för HTTP-protokollet.
 
De motsvarande namn som används på protokollnivå AMQP listas inom parentes. 

| Egenskapsnamn                         | Beskrivning                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (innehållstyp)           | Du kan också beskriver nyttolasten för meddelandet med en beskrivning som har följande format för RFC2045 avsnitt 5, till exempel `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (Korrelations-id)       | Tillåter att ett program att ange en kontext för meddelandet för korrelation, till exempel avspeglar den **MessageId** av ett meddelande som ska besvaras.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.azure.servicebus.message.deadlettersource)                      | Endast in i meddelanden som har gått förlorade lettered och därefter automatiskt-vidarebefordras från kön för obeställbara till en annan entitet. Anger meddelandet som var dead lettered enhet. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Antal leveranser som har gjorts för det här meddelandet. Antalet ökar stegvis när ett meddelande Lås upphör att gälla eller meddelandet överges explicit av mottagaren. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Den här egenskapen visar för meddelanden som har vidarebefordras automatiskt sekvensnummer som först tilldelades meddelandet till dess ursprungliga punkt för överföring. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | UTC snabbmeddelanden då meddelandet har godkänts och lagras i entiteten. Det här värdet kan användas som en auktoritär och neutral ankomst tid indikator när mottagaren inte vill lita på avsändarens klockan. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolut-förfallotiden) | Den UTC-instant meddelandet är markerat för borttagning och inte längre tillgängliga för hämtning från enheten på grund av förfallodatum. Utgången styrs av den **TimeToLive** egenskap och den här egenskapen har beräknats från EnqueuedTimeUtc + TimeToLive. Den här egenskapen är skrivskyddad.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | För köer och ämnen som har den [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress?view=azureservicebus-4.1.1#Microsoft_ServiceBus_Messaging_QueueDescription_EnableExpress) flaggan, den här egenskapen kan anges för att indikera att meddelandet måste sparas innan det bekräftas. Detta är normalt beteende för alla icke-express entiteter.                                                                                                                                                                                                         |
| [Etiketten](/dotnet/api/microsoft.azure.servicebus.message.label) (ämne)                       | Den här egenskapen gör att programmet kan anger syftet med meddelandet till mottagaren på ett standardiserat sätt liknar en ämnesraden för e-post.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | För meddelanden som hämtas under ett lås (titt Lås får-läge inte löses före) den här egenskapen visar UTC snabbmeddelanden till vilket meddelandet hålls låst i kön eller prenumeration. När låset upphör att gälla den [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) ökas och meddelandet igen är tillgängliga för hämtning. Den här egenskapen är skrivskyddad.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Lås-token är en referens till lås som används av Service broker i *titt Lås* mottagningsläge. Token kan användas för att fästa låset permanent via den [avstängning](message-deferral.md) API och att vidta meddelandet utanför reguljära leverans tillstånd flödet. Den här egenskapen är skrivskyddad.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (meddelande-id)                | Meddelande-ID är ett programdefinierade värde som identifierar meddelandet och dess nyttolast. Identifieraren är en sträng och kan återspegla ett GUID eller en identifierare som härletts från programkontexten. Om aktiverad kan den [dubblettidentifiering](duplicate-detection.md) funktionen identifierar och tar bort sekund och ytterligare överföringar av meddelanden med samma **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | För [partitionerade enheter](service-bus-partitioning.md), om det här värdet kan tilldela relaterade meddelanden till samma interna partition, så att skicka sekvens ordning registreras på rätt sätt. Partitionen väljs som hash-funktion via det här värdet och kan inte väljas direkt. För session-kompatibla enheter på **SessionId** egenskapen åsidosätter det här värdet.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (svar till)                    | Det här valfria och programdefinierade värdet är ett standardiserat sätt att uttrycka en reply-sökväg till mottagaren av meddelandet. När en avsändare förväntar ett svar, ställer in värdet till absolut eller relativ sökväg för en kö eller den förväntar sig svar skickas till ämnet.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (reply-till-grupp-id)  | Gör att det här värdet i **ReplyTo** information och anger vilken **SessionId** ska anges för svar när den skickas till enheten som svar.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | För meddelanden som är bara tillgängliga för hämtning efter en fördröjning, definierar den här egenskapen UTC snabbmeddelanden då meddelandet blir logiskt köas sekvenserade och blir tillgängliga för hämtning.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Sekvensnumret är ett unikt 64-bitars heltal som tilldelats ett meddelande som accepteras och lagras av broker och funktioner som dess true identifierare. De översta 16 bitarna avspeglar partitions-ID för partitionerade enheter. Sekvensnummer ökar monotont och är utan mellanrum. De rulla över till 0 när 48-64-bitars-intervallet är slut. Den här egenskapen är skrivskyddad.                                                                |
| [Sessions-ID](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (grupp-id)                  | Session-kompatibla enheter anger värdet programdefinierade session anknytningen för meddelandet. Meddelanden med samma sessionsidentifieraren regleras sammanfattning låsning och aktivera exakt i ordning bearbetning och demultiplexing. För enheter som inte stöder session ignoreras det här värdet.                                                                                                                                     |
| [Storlek](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Visar lagrade storleken på meddelandet i loggen broker som ett antal byte som den räknar mot lagringskvoten. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                                                       |
| [Tillstånd](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Visar tillståndet för meddelandet i loggen. Den här egenskapen gäller endast under meddelande surfning (”titt”), för att avgöra om ett meddelande som ”aktiv” och tillgänglig för hämtning av när den når upp i kön, oavsett om den är uppskjutna eller väntar på att schemaläggas. Den här egenskapen är skrivskyddad.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Det här värdet är den relativa efter vilken meddelandet går ut, starta från ögonblicket meddelandet har godkänts och lagras av Service broker, som anges i **EnqueueTimeUtc**. När inte anges explicit, ändrar du värdet är den **DefaultTimeToLive** för respektive kö eller avsnittet. En meddelandenivå **TimeToLive** värdet får inte vara längre än entitetens **DefaultTimeToLive** justeras tyst inställning och om det inte. |
| [Att](/dotnet/api/microsoft.azure.servicebus.message.to) (till)                               | Den här egenskapen är reserverad för framtida användning i routnings-scenarier och ignoreras för närvarande av broker sig själv. Program kan använda det här värdet i regeln-driven automatisk vidarebefordring chaining scenarier för att ange rätt logiska målet för meddelandet.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Om ett meddelande skickas via en överföring kö i omfånget för en transaktion, väljer det här värdet överföring kön partitionen.                                                                                                                                                                                                                                                                                                                 |

Abstrakt meddelandet modellen aktiverar ett meddelande som ska publiceras till en kö via HTTP (faktiskt alltid HTTPS) och kan hämtas via AMQP. I båda fallen verkar meddelandet normala i samband med respektive protokollet. De asynkrona egenskaperna översätts efter behov och egenskaper för användare som är mappade till den lämpligaste platsen på respektive protokollet meddelandet modellen. HTTP, användaregenskaper mappas direkt till och från HTTP-huvuden; i AMQP de mappas till och från den **egenskaper för program** kartan.

## <a name="message-routing-and-correlation"></a>Meddelanderoutning och korrelation

En delmängd av de asynkrona egenskaperna som beskrivs tidigare, mer specifikt [till](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [ CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid), och [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), används för att program skicka meddelanden till specifika mål. Överväg att några mönster för att illustrera detta:

- **Enkel request/reply-**: en utgivare skickar ett meddelande i en kö och förväntar sig ett svar från konsumenten för meddelandet. För att ta emot svaret äger utgivaren en kö som det förväntas svar som ska levereras. Adressen till kön uttrycks i det utgående meddelandet **ReplyTo** egenskapen. När klienten svarar den kopierar den **MessageId** av hanterade meddelandet till den **CorrelationId** egenskapen svarsmeddelandet och att leverera meddelandet till målet anges av **ReplyTo** egenskapen. Ett meddelande kan ge flera svar, beroende på Programkontext och.
- **Request/reply-multicast-**: som en variant av det tidigare mönstret utgivare skickar meddelandet till ett ämne och flera prenumeranter blir berättigad att konsumera meddelandet. Var och en av prenumeranter kan svara på det sätt som beskrivs ovan. Det här mönstret används i identifiering eller närvarande scenarier och svaranden vanligtvis identifierar sig själv med en egenskap eller i nyttolasten. Om **ReplyTo** pekar på ett ämne, en sådan uppsättning identifiering svar kan distribueras till en målgrupp.
- **Multiplexering**: den här sessionen-funktionen kan multiplexering av dataströmmar relaterade meddelanden via en enskild kö eller en prenumeration så att varje session (eller grupp) Users identifieras genom att matcha **SessionId**värden, dirigeras till en viss mottagare när mottagaren innehåller under lock-sessionen. Läs mer om information om sessioner [här](message-sessions.md).
- **Multiplex request/reply-**: den här sessionen-funktionen kan multiplex svar, vilket gör att flera utgivare att dela en svarskön. Genom att ange **ReplyToSessionId**, utgivaren kan instruera consumer(s) att kopiera värdet till den **SessionId** egenskapen svarsmeddelandet. Publishing kö eller avsnittet innehåller inte vara medveten om sessionen. När meddelandet skickas utgivaren kan särskilt vänta en session med den angivna **SessionId** att Materialisera kön villkorligt accepterar en session mottagare. 

Routning inuti en Service Bus-namnrymd kan genomföras med hjälp av automatisk vidarebefordring länkning och avsnittet prenumerationsregler. Routning över namnområden kan realiseras [med hjälp av Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Som anges i listan ovan i **till** egenskapen är reserverad för framtida användning och så småningom kan tolkas av Service broker med ett särskilt aktiverat funktionen. Program som du vill implementera routning bör göra så baserat på användaregenskaper och inte ta stöd mot den **till** egenskap, men nu inte gör kompatibilitetsproblem.

## <a name="payload-serialization"></a>Nyttolasten serialisering

När överföringen eller lagras i Service Bus, nyttolasten är alltid ett täckande, binära block. Den [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) egenskapen gör det möjligt för program att beskriva nyttolast med föreslagna formatet för de värden som en MIME-innehållstypen beskrivning enligt IETF RFC2045, till exempel `application/json;charset=utf-8`.

Till skillnad från varianter av Java eller Standard för .NET, .NET Framework-version av Service Bus-API kan du skapa **BrokeredMessage** instanser genom att skicka godtyckliga .NET-objekt till konstruktören. 

När du använder det äldra SBMP-protokollet kan serialiseras sedan objekten standard binärserialiseraren eller med en serialiserare som har angetts externt. När du använder AMQP-protokollet, serialisera objektet till en AMQP-objekt. Mottagaren kan hämta dessa objekt med den [GetBody<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) metod, tillhandahåller den förväntade typen; med AMQP, objekten serialiseras till en AMQP diagram över **ArrayList** och **IDictionary < sträng, objekt >** objekt och kan avkodas av alla AMQP klienter. 

När den här Magiskt tal för dolda serialisering är praktiskt bör program ta explicit kontroll över objekt serialisering göra deras objektdiagram till dataströmmar innan inkludera dem i ett meddelande och göra tvärtom på mottagarsidan. Detta ger samverkande resultat. Det bör även noteras att AMQP har en kraftfull binär kodning modell, den är kopplad till meddelanden ekosystemet AMQP och HTTP-klienter har problem med att avkoda sådana nyttolaster. 

Vi rekommenderar Allmänt JSON och Apache Avro som nyttolast format för strukturerade data.

Standard .NET och Java API varianter Godkänn endast byte-matriser, vilket innebär att programmet måste hantera objektet serialisering kontrollen. 

## <a name="next-steps"></a>Nästa steg

Om du vill lära dig mer om Service Bus-meddelanden, finns i följande avsnitt:

* [Service Bus-grunder](service-bus-fundamentals-hybrid-solutions.md)
* [Service Bus-köer, ämnen och prenumerationer](service-bus-queues-topics-subscriptions.md)
* [Komma igång med Service Bus-köer](service-bus-dotnet-get-started-with-queues.md)
* [Använd Service Bus ämnen och prenumerationer](service-bus-dotnet-how-to-use-topics-subscriptions.md)