---
title: "Bästa praxis för att förbättra prestanda med hjälp av Azure Service Bus | Microsoft Docs"
description: "Beskriver hur du använder Service Bus för att optimera prestanda vid utbyte av asynkrona meddelanden."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: e6a0e480f7748f12f5e566cf4059b5b2c4242c09
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="bf199-103">Metodtips för bättre prestanda med hjälp av Service Bus-meddelanden</span><span class="sxs-lookup"><span data-stu-id="bf199-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="bf199-104">Den här artikeln beskriver hur du använder [Azure Service Bus-meddelanden](https://azure.microsoft.com/services/service-bus/) att optimera prestanda vid utbyte av asynkrona meddelanden.</span><span class="sxs-lookup"><span data-stu-id="bf199-104">This article describes how to use [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) to optimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="bf199-105">Den första delen av det här avsnittet beskrivs de olika metoder som erbjuds för att öka prestanda.</span><span class="sxs-lookup"><span data-stu-id="bf199-105">The first part of this topic describes the different mechanisms that are offered to help increase performance.</span></span> <span data-ttu-id="bf199-106">Den andra delen innehåller råd om hur du använder Service Bus på ett sätt som kan ge bästa möjliga prestanda i ett visst scenario.</span><span class="sxs-lookup"><span data-stu-id="bf199-106">The second part provides guidance on how to use Service Bus in a way that can offer the best performance in a given scenario.</span></span>

<span data-ttu-id="bf199-107">I det här avsnittet avser termen ”klient” entiteter som har åtkomst till Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bf199-107">Throughout this topic, the term "client" refers to any entity that accesses Service Bus.</span></span> <span data-ttu-id="bf199-108">En klient kan ta rollen för en avsändare eller en mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-108">A client can take the role of a sender or a receiver.</span></span> <span data-ttu-id="bf199-109">Termen ”avsändare” används för en Service Bus kö eller ett ämne-klient som skickar meddelanden till en Service Bus-kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="bf199-109">The term "sender" is used for a Service Bus queue or topic client that sends messages to a Service Bus queue or topic.</span></span> <span data-ttu-id="bf199-110">Termen ”mottagaren” refererar till en Service Bus kö eller prenumeration klient som tar emot meddelanden från en Service Bus-kö eller prenumeration.</span><span class="sxs-lookup"><span data-stu-id="bf199-110">The term "receiver" refers to a Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="bf199-111">Dessa avsnitt beskrivs några begrepp som Service Bus använder för att förbättra prestanda.</span><span class="sxs-lookup"><span data-stu-id="bf199-111">These sections introduce several concepts that Service Bus uses to help boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="bf199-112">Protokoll</span><span class="sxs-lookup"><span data-stu-id="bf199-112">Protocols</span></span>
<span data-ttu-id="bf199-113">Service Bus gör att klienter kan skicka och ta emot meddelanden via ett av tre protokoll:</span><span class="sxs-lookup"><span data-stu-id="bf199-113">Service Bus enables clients to send and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="bf199-114">Avancerade Message Queuing-protokollet (AMQP)</span><span class="sxs-lookup"><span data-stu-id="bf199-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="bf199-115">Service Bus-meddelanden Protocol (SBMP)</span><span class="sxs-lookup"><span data-stu-id="bf199-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="bf199-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="bf199-116">HTTP</span></span>

<span data-ttu-id="bf199-117">AMQP och SBMP är effektivare, eftersom de upprätthålla anslutningen till Service Bus så länge meddelandefabrik finns.</span><span class="sxs-lookup"><span data-stu-id="bf199-117">AMQP and SBMP are more efficient, because they maintain the connection to Service Bus as long as the messaging factory exists.</span></span> <span data-ttu-id="bf199-118">Den implementerar batchbearbetning och förhämtar.</span><span class="sxs-lookup"><span data-stu-id="bf199-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="bf199-119">Om du inte uttryckligen anges förutsätter allt innehåll i det här avsnittet att använda AMQP eller SBMP.</span><span class="sxs-lookup"><span data-stu-id="bf199-119">Unless explicitly mentioned, all content in this topic assumes the use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="bf199-120">Återanvända fabriker och klienter</span><span class="sxs-lookup"><span data-stu-id="bf199-120">Reusing factories and clients</span></span>
<span data-ttu-id="bf199-121">Service Bus klienten objekt, till exempel [QueueClient] [ QueueClient] eller [MessageSender][MessageSender], skapas via en [ MessagingFactory] [ MessagingFactory] -objektet, vilket ger också intern hantering av anslutningar.</span><span class="sxs-lookup"><span data-stu-id="bf199-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="bf199-122">Du bör inte stänga meddelanden fabriker eller kön, ämnet och prenumerationen klienter när du skickar ett meddelande och sedan återskapa dem när du skickar nästa meddelande.</span><span class="sxs-lookup"><span data-stu-id="bf199-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send the next message.</span></span> <span data-ttu-id="bf199-123">Stänga en meddelandefabrik tar bort anslutningen till Service Bus-tjänst och en ny anslutning upprättas när återskapa fabriken.</span><span class="sxs-lookup"><span data-stu-id="bf199-123">Closing a messaging factory deletes the connection to the Service Bus service, and a new connection is established when recreating the factory.</span></span> <span data-ttu-id="bf199-124">Upprätta en anslutning är en kostsam åtgärd som du kan undvika genom att återanvända samma fabrik och klientobjekt för flera åtgärder.</span><span class="sxs-lookup"><span data-stu-id="bf199-124">Establishing a connection is an expensive operation that you can avoid by re-using the same factory and client objects for multiple operations.</span></span> <span data-ttu-id="bf199-125">Du kan använda på ett säkert sätt den [QueueClient] [ QueueClient] objekt för att skicka meddelanden från samtidiga asynkrona åtgärder och flera trådar.</span><span class="sxs-lookup"><span data-stu-id="bf199-125">You can safely use the [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="bf199-126">Samtidiga åtgärder</span><span class="sxs-lookup"><span data-stu-id="bf199-126">Concurrent operations</span></span>
<span data-ttu-id="bf199-127">Utföra en åtgärd (skicka, ta emot, ta bort, etc.) tar en stund.</span><span class="sxs-lookup"><span data-stu-id="bf199-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="bf199-128">Den här gången innefattar bearbetning av åtgärden av tjänsten Service Bus förutom svarstid för begäran och svar.</span><span class="sxs-lookup"><span data-stu-id="bf199-128">This time includes the processing of the operation by the Service Bus service in addition to the latency of the request and the reply.</span></span> <span data-ttu-id="bf199-129">Om du vill öka antalet åtgärder per tid måste operations köras samtidigt.</span><span class="sxs-lookup"><span data-stu-id="bf199-129">To increase the number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="bf199-130">Du kan göra detta på flera olika sätt:</span><span class="sxs-lookup"><span data-stu-id="bf199-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="bf199-131">**Asynkrona åtgärder**: klienten schemalägger åtgärder genom att utföra asynkrona åtgärder.</span><span class="sxs-lookup"><span data-stu-id="bf199-131">**Asynchronous operations**: the client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="bf199-132">Nästa förfrågan har startat innan den förra begäranden har slutförts.</span><span class="sxs-lookup"><span data-stu-id="bf199-132">The next request is started before the previous request is completed.</span></span> <span data-ttu-id="bf199-133">Följande är ett exempel på en asynkron sändningsåtgärd:</span><span class="sxs-lookup"><span data-stu-id="bf199-133">The following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="bf199-134">Detta är ett exempel på en asynkron mottagning igen:</span><span class="sxs-lookup"><span data-stu-id="bf199-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="bf199-135">**Flera fabriker**: alla klienter (avsändare förutom mottagare) som skapats av samma fabrik dela en TCP-anslutning.</span><span class="sxs-lookup"><span data-stu-id="bf199-135">**Multiple factories**: all clients (senders in addition to receivers) that are created by the same factory share one TCP connection.</span></span> <span data-ttu-id="bf199-136">Den maximala genomströmningen begränsas av antal åtgärder som kan gå igenom den här TCP-anslutningen.</span><span class="sxs-lookup"><span data-stu-id="bf199-136">The maximum message throughput is limited by the number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="bf199-137">Dataflödet som kan hämtas med en enda fabrik varierar kraftigt med TCP fram och åter gånger och meddelandestorlek.</span><span class="sxs-lookup"><span data-stu-id="bf199-137">The throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="bf199-138">Om du vill använda högre hastigheter, bör du använda flera meddelanden fabriker.</span><span class="sxs-lookup"><span data-stu-id="bf199-138">To obtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="bf199-139">Mottagningsläge</span><span class="sxs-lookup"><span data-stu-id="bf199-139">Receive mode</span></span>
<span data-ttu-id="bf199-140">När du skapar en kö eller prenumeration klient kan du ange en receive-läge: *titt Lås* eller *ta emot och ta bort*.</span><span class="sxs-lookup"><span data-stu-id="bf199-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="bf199-141">Standard mottagningsläge är [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="bf199-141">The default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="bf199-142">När det här läget kan skickar klienten en begäran om att ta emot ett meddelande från Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bf199-142">When operating in this mode, the client sends a request to receive a message from Service Bus.</span></span> <span data-ttu-id="bf199-143">När klienten har tagit emot meddelandet, skickar en begäran om att slutföra meddelandet.</span><span class="sxs-lookup"><span data-stu-id="bf199-143">After the client has received the message, it sends a request to complete the message.</span></span>

<span data-ttu-id="bf199-144">När du ställer in receive-läge [ReceiveAndDelete][ReceiveAndDelete], båda stegen kombineras i en enskild begäran.</span><span class="sxs-lookup"><span data-stu-id="bf199-144">When setting the receive mode to [ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="bf199-145">Detta minskar det totala antalet åtgärder och kan förbättra den övergripande genomströmningen.</span><span class="sxs-lookup"><span data-stu-id="bf199-145">This reduces the overall number of operations, and can improve the overall message throughput.</span></span> <span data-ttu-id="bf199-146">Den här prestandafördelar kommer dess risk att förlora meddelanden.</span><span class="sxs-lookup"><span data-stu-id="bf199-146">This performance gain comes at the risk of losing messages.</span></span>

<span data-ttu-id="bf199-147">Service Bus stöder inte transaktioner för ta emot och delete-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="bf199-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="bf199-148">Dessutom titt Lås semantik krävs för alla scenarier där klienten vill skjuta upp eller [förlorade](service-bus-dead-letter-queues.md) ett meddelande.</span><span class="sxs-lookup"><span data-stu-id="bf199-148">In addition, peek-lock semantics are required for any scenarios in which the client wants to defer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="bf199-149">Klientsidans batchbearbetning</span><span class="sxs-lookup"><span data-stu-id="bf199-149">Client-side batching</span></span>
<span data-ttu-id="bf199-150">Klientsidans batchbearbetning gör en kö eller ett ämne klienten att fördröja skickas ett meddelande för en viss tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="bf199-150">Client-side batching enables a queue or topic client to delay the sending of a message for a certain period of time.</span></span> <span data-ttu-id="bf199-151">Om klienten skickar ytterligare meddelanden under den här tiden, skickar den meddelanden i en enskild batch.</span><span class="sxs-lookup"><span data-stu-id="bf199-151">If the client sends additional messages during this time period, it transmits the messages in a single batch.</span></span> <span data-ttu-id="bf199-152">Klientsidans batchbearbetning gör att en kö eller prenumeration klient till batchen flera **Slutför** begäranden till en enskild begäran.</span><span class="sxs-lookup"><span data-stu-id="bf199-152">Client-side batching also causes a queue or subscription client to batch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="bf199-153">Batchbearbetning är endast tillgängligt för asynkron **skicka** och **Slutför** åtgärder.</span><span class="sxs-lookup"><span data-stu-id="bf199-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="bf199-154">Synkrona åtgärder skickas direkt till tjänsten Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bf199-154">Synchronous operations are immediately sent to the Service Bus service.</span></span> <span data-ttu-id="bf199-155">Batchbearbetning inte ske för titt eller ta emot operations eller batchbearbetning sker över klienter.</span><span class="sxs-lookup"><span data-stu-id="bf199-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="bf199-156">Som standard använder en klient en batch-intervallet för 20ms.</span><span class="sxs-lookup"><span data-stu-id="bf199-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="bf199-157">Du kan ändra batch-intervall genom att ange den [BatchFlushInterval] [ BatchFlushInterval] egenskapen innan du skapar meddelandefabrik.</span><span class="sxs-lookup"><span data-stu-id="bf199-157">You can change the batch interval by setting the [BatchFlushInterval][BatchFlushInterval] property before creating the messaging factory.</span></span> <span data-ttu-id="bf199-158">Den här inställningen påverkar alla klienter som har skapats med den här fabriken.</span><span class="sxs-lookup"><span data-stu-id="bf199-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="bf199-159">Om du vill inaktivera batchbearbetning, ange den [BatchFlushInterval] [ BatchFlushInterval] egenskapen **TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="bf199-159">To disable batching, set the [BatchFlushInterval][BatchFlushInterval] property to **TimeSpan.Zero**.</span></span> <span data-ttu-id="bf199-160">Exempel:</span><span class="sxs-lookup"><span data-stu-id="bf199-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="bf199-161">Batchbearbetning påverkar inte antalet fakturerbar asynkrona åtgärder och är bara tillgängligt för Service Bus-klientprotokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-161">Batching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="bf199-162">HTTP-protokollet har inte stöd för batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="bf199-162">The HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="bf199-163">Batchbearbetning store-åtkomst</span><span class="sxs-lookup"><span data-stu-id="bf199-163">Batching store access</span></span>
<span data-ttu-id="bf199-164">Om du vill öka genomflödet av kön, ämnet och prenumerationen batchar Service Bus flera meddelanden vid skrivning till interna arkivet.</span><span class="sxs-lookup"><span data-stu-id="bf199-164">To increase the throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes to its internal store.</span></span> <span data-ttu-id="bf199-165">Om aktiverad på en kö eller ett ämne, kommer det att batchar att skriva meddelanden till arkivet.</span><span class="sxs-lookup"><span data-stu-id="bf199-165">If enabled on a queue or topic, writing messages into the store will be batched.</span></span> <span data-ttu-id="bf199-166">Om aktiverat på en kö eller en prenumeration, kommer det att batchar att ta bort meddelanden från store.</span><span class="sxs-lookup"><span data-stu-id="bf199-166">If enabled on a queue or subscription, deleting messages from the store will be batched.</span></span> <span data-ttu-id="bf199-167">Om gruppbaserad store-åtkomst är aktiverat för en entitet, fördröjningar Service Bus store skrivning om entiteten med upp till 20 MS.</span><span class="sxs-lookup"><span data-stu-id="bf199-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up to 20ms.</span></span> <span data-ttu-id="bf199-168">Ytterligare store-åtgärder som inträffar under det här intervallet har lagts till i gruppen.</span><span class="sxs-lookup"><span data-stu-id="bf199-168">Additional store operations that occur during this interval are added to the batch.</span></span> <span data-ttu-id="bf199-169">Batchar store åtkomst endast påverkar **skicka** och **Slutför** verksamhet, ta emot påverkas inte.</span><span class="sxs-lookup"><span data-stu-id="bf199-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="bf199-170">Batch store-åtkomst är en egenskap för en entitet.</span><span class="sxs-lookup"><span data-stu-id="bf199-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="bf199-171">Batchbearbetning sker över alla enheter som möjliggör gruppbaserad store-åtkomst.</span><span class="sxs-lookup"><span data-stu-id="bf199-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="bf199-172">När du skapar en ny kö, ämne eller en prenumeration kan är batch store-åtkomst aktiverat som standard.</span><span class="sxs-lookup"><span data-stu-id="bf199-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="bf199-173">Om du vill inaktivera batch store-åtkomst, ange den [EnableBatchedOperations] [ EnableBatchedOperations] egenskapen **FALSKT** innan du skapar entiteten.</span><span class="sxs-lookup"><span data-stu-id="bf199-173">To disable batched store access, set the [EnableBatchedOperations][EnableBatchedOperations] property to **false** before creating the entity.</span></span> <span data-ttu-id="bf199-174">Exempel:</span><span class="sxs-lookup"><span data-stu-id="bf199-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="bf199-175">Batch store-åtkomst påverkar inte antalet fakturerbar asynkrona åtgärder och är en egenskap för en kö, ämne eller prenumeration.</span><span class="sxs-lookup"><span data-stu-id="bf199-175">Batched store access does not affect the number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="bf199-176">Det är oberoende av receive-läge och protokoll som används mellan klienten och tjänsten Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bf199-176">It is independent of the receive mode and the protocol that is used between a client and the Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="bf199-177">Förhämtar</span><span class="sxs-lookup"><span data-stu-id="bf199-177">Prefetching</span></span>
<span data-ttu-id="bf199-178">Förhämtar gör att kön eller prenumeration klienten att läsa in ytterligare meddelanden från tjänsten när en receive-åtgärd utförs.</span><span class="sxs-lookup"><span data-stu-id="bf199-178">Prefetching enables the queue or subscription client to load additional messages from the service when it performs a receive operation.</span></span> <span data-ttu-id="bf199-179">Klienten lagrar dessa meddelanden i ett lokalt cacheminne.</span><span class="sxs-lookup"><span data-stu-id="bf199-179">The client stores these messages in a local cache.</span></span> <span data-ttu-id="bf199-180">Storleken på cacheminnet bestäms av den [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] eller [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] egenskaper.</span><span class="sxs-lookup"><span data-stu-id="bf199-180">The size of the cache is determined by the [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="bf199-181">Varje klient som möjliggör förhämtar upprätthåller sin egen cache.</span><span class="sxs-lookup"><span data-stu-id="bf199-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="bf199-182">En cache delas inte mellan klienter.</span><span class="sxs-lookup"><span data-stu-id="bf199-182">A cache is not shared across clients.</span></span> <span data-ttu-id="bf199-183">Om klienten startar en receive-åtgärd och dess cachen är tom, skickar tjänsten en grupp med meddelanden.</span><span class="sxs-lookup"><span data-stu-id="bf199-183">If the client initiates a receive operation and its cache is empty, the service transmits a batch of messages.</span></span> <span data-ttu-id="bf199-184">Storlek på batch är lika med storleken på cacheminnet eller 256 KB, beroende på vilket som är mindre.</span><span class="sxs-lookup"><span data-stu-id="bf199-184">The size of the batch equals the size of the cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="bf199-185">Om klienten startar en receive-åtgärd och cachen innehåller ett meddelande, tas meddelandet från cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="bf199-185">If the client initiates a receive operation and the cache contains a message, the message is taken from the cache.</span></span>

<span data-ttu-id="bf199-186">När ett meddelande är prefetched låser tjänsten prefetched meddelandet.</span><span class="sxs-lookup"><span data-stu-id="bf199-186">When a message is prefetched, the service locks the prefetched message.</span></span> <span data-ttu-id="bf199-187">På så sätt kan inte prefetched meddelandet tas emot av en annan mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-187">By doing this, the prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="bf199-188">Om mottagaren inte kan slutföra meddelandet innan låset upphör att gälla, blir meddelandet tillgänglig för andra mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-188">If the receiver cannot complete the message before the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="bf199-189">Prefetched kopia av meddelandet finns kvar i cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="bf199-189">The prefetched copy of the message remains in the cache.</span></span> <span data-ttu-id="bf199-190">Mottagaren som förbrukar utgångna cachelagrad kopia får ett undantag när den försöker slutföra meddelandet.</span><span class="sxs-lookup"><span data-stu-id="bf199-190">The receiver that consumes the expired cached copy will receive an exception when it tries to complete that message.</span></span> <span data-ttu-id="bf199-191">Som standard upphör meddelandet låset efter 60 sekunder.</span><span class="sxs-lookup"><span data-stu-id="bf199-191">By default, the message lock expires after 60 seconds.</span></span> <span data-ttu-id="bf199-192">Det här värdet kan utökas till 5 minuter.</span><span class="sxs-lookup"><span data-stu-id="bf199-192">This value can be extended to 5 minutes.</span></span> <span data-ttu-id="bf199-193">För att förhindra användningen av inaktuella meddelanden ska cachestorleken alltid vara mindre än antalet meddelanden som kan användas av en klient i lås-timeout-intervall.</span><span class="sxs-lookup"><span data-stu-id="bf199-193">To prevent the consumption of expired messages, the cache size should always be smaller than the number of messages that can be consumed by a client within the lock time-out interval.</span></span>

<span data-ttu-id="bf199-194">När du använder standard Låsets upphörande 60 sekunder, en bra värde för [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] är 20 gånger högsta bearbetning av alla mottagare av fabriken.</span><span class="sxs-lookup"><span data-stu-id="bf199-194">When using the default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times the maximum processing rates of all receivers of the factory.</span></span> <span data-ttu-id="bf199-195">Till exempel en fabrik skapar 3 mottagare, och varje mottagare kan bearbeta upp till 10 meddelanden per sekund.</span><span class="sxs-lookup"><span data-stu-id="bf199-195">For example, a factory creates 3 receivers, and each receiver can process up to 10 messages per second.</span></span> <span data-ttu-id="bf199-196">Antalet prefetch får inte överstiga 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="bf199-196">The prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="bf199-197">Som standard [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] anges till 0, vilket innebär att inga fler meddelanden hämtas från tjänsten.</span><span class="sxs-lookup"><span data-stu-id="bf199-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set to 0, which means that no additional messages are fetched from the service.</span></span>

<span data-ttu-id="bf199-198">Förhämtar meddelanden ökar det totala genomflödet för en kö eller en prenumeration, eftersom det totala antalet meddelandeåtgärder eller sändningar.</span><span class="sxs-lookup"><span data-stu-id="bf199-198">Prefetching messages increases the overall throughput for a queue or subscription because it reduces the overall number of message operations, or round trips.</span></span> <span data-ttu-id="bf199-199">Hämtar det första meddelandet, men tar längre tid (på grund av ökade meddelandelagringsstorlek).</span><span class="sxs-lookup"><span data-stu-id="bf199-199">Fetching the first message, however, will take longer (due to the increased message size).</span></span> <span data-ttu-id="bf199-200">Ta emot prefetched meddelanden är snabbare eftersom dessa meddelanden redan har laddats ned av klienten.</span><span class="sxs-lookup"><span data-stu-id="bf199-200">Receiving prefetched messages will be faster because these messages have already been downloaded by the client.</span></span>

<span data-ttu-id="bf199-201">Egenskapen time to live (TTL) för ett meddelande som kontrolleras av servern när servern skickar meddelandet till klienten.</span><span class="sxs-lookup"><span data-stu-id="bf199-201">The time-to-live (TTL) property of a message is checked by the server at the time the server sends the message to the client.</span></span> <span data-ttu-id="bf199-202">Klienten kontrollerar inte TTL meddelandeegenskapen när meddelandet tas emot.</span><span class="sxs-lookup"><span data-stu-id="bf199-202">The client does not check the message’s TTL property when the message is received.</span></span> <span data-ttu-id="bf199-203">I stället kan meddelandet tas emot även om meddelandets TTL har passerat medan meddelandet cachelagrades av klienten.</span><span class="sxs-lookup"><span data-stu-id="bf199-203">Instead, the message can be received even if the message’s TTL has passed while the message was cached by the client.</span></span>

<span data-ttu-id="bf199-204">Förhämtar påverkar inte antalet fakturerbar asynkrona åtgärder och är bara tillgängligt för Service Bus-klientprotokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-204">Prefetching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="bf199-205">HTTP-protokollet stöder inte förhämtar.</span><span class="sxs-lookup"><span data-stu-id="bf199-205">The HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="bf199-206">Förhämtar är tillgänglig för både synkrona och asynkrona får åtgärder.</span><span class="sxs-lookup"><span data-stu-id="bf199-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="bf199-207">Express köer och ämnen</span><span class="sxs-lookup"><span data-stu-id="bf199-207">Express queues and topics</span></span>

<span data-ttu-id="bf199-208">Expressenheter aktivera högt genomflöde och svarstid för minskade scenarier och stöds endast i standardnivån för meddelanden.</span><span class="sxs-lookup"><span data-stu-id="bf199-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in the Standard messaging tier.</span></span> <span data-ttu-id="bf199-209">Entiteter som skapats i [Premium-namnområden](service-bus-premium-messaging.md) inte stöder alternativet express.</span><span class="sxs-lookup"><span data-stu-id="bf199-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support the express option.</span></span> <span data-ttu-id="bf199-210">Med snabb entiteter, om ett meddelande skickas till en kö eller ett ämne, lagras meddelandet omedelbart inte i meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bf199-210">With express entities, if a message is sent to a queue or topic, the message is not immediately stored in the messaging store.</span></span> <span data-ttu-id="bf199-211">I stället cachelagras i minnet.</span><span class="sxs-lookup"><span data-stu-id="bf199-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="bf199-212">Om ett meddelande som finns kvar i kön i mer än ett par sekunder, skrivs den automatiskt till stabil lagring, vilket skyddar mot dataförlust på grund av ett avbrott.</span><span class="sxs-lookup"><span data-stu-id="bf199-212">If a message remains in the queue for more than a few seconds, it is automatically written to stable storage, thus protecting it against loss due to an outage.</span></span> <span data-ttu-id="bf199-213">Skrivning av meddelandet till en minnescache ökar dataflödet och minskar latens eftersom det finns ingen åtkomst till stabil lagring vid den tidpunkt som meddelandet har skickats.</span><span class="sxs-lookup"><span data-stu-id="bf199-213">Writing the message into a memory cache increases throughput and reduces latency because there is no access to stable storage at the time the message is sent.</span></span> <span data-ttu-id="bf199-214">Meddelanden som används inom några sekunder skrivs inte till meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bf199-214">Messages that are consumed within a few seconds are not written to the messaging store.</span></span> <span data-ttu-id="bf199-215">I följande exempel skapas en uttrycklig avsnittet.</span><span class="sxs-lookup"><span data-stu-id="bf199-215">The following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="bf199-216">Om ett meddelande som innehåller viktig information som inte får vara förlorade skickas till en snabb entitet avsändaren kan tvinga Service Bus att direkt spara meddelandet till stabil lagring genom att ange den [ForcePersistence] [ ForcePersistence] egenskapen **SANT**.</span><span class="sxs-lookup"><span data-stu-id="bf199-216">If a message containing critical information that must not be lost is sent to an express entity, the sender can force Service Bus to immediately persist the message to stable storage by setting the [ForcePersistence][ForcePersistence] property to **true**.</span></span>

> [!NOTE]
> <span data-ttu-id="bf199-217">Expressenheter stöder inte transaktioner.</span><span class="sxs-lookup"><span data-stu-id="bf199-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="bf199-218">Användning av partitionerade köer och ämnen</span><span class="sxs-lookup"><span data-stu-id="bf199-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="bf199-219">Internt, Service Bus använder samma nod och messaging lagra bearbetas och lagras alla meddelanden för en meddelandeentitet (kö eller ett ämne).</span><span class="sxs-lookup"><span data-stu-id="bf199-219">Internally, Service Bus uses the same node and messaging store to process and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="bf199-220">En partitionerad kö eller ett ämne, å andra sidan distribueras över flera noder och meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="bf199-220">A partitioned queue or topic, on the other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="bf199-221">Partitionerade köer och ämnen inte bara att ge en bättre genomströmning än vanliga köer och ämnen, de också uppvisar en högre tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="bf199-222">Så här skapar du en partitionerad entitet i [EnablePartitioning] [ EnablePartitioning] egenskapen **SANT**som visas i följande exempel.</span><span class="sxs-lookup"><span data-stu-id="bf199-222">To create a partitioned entity, set the [EnablePartitioning][EnablePartitioning] property to **true**, as shown in the following example.</span></span> <span data-ttu-id="bf199-223">Mer information om partitionerade enheter finns [partitionerade meddelandeentiteter][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="bf199-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="bf199-224">Användning av flera köer</span><span class="sxs-lookup"><span data-stu-id="bf199-224">Use of multiple queues</span></span>

<span data-ttu-id="bf199-225">Om det går inte att använda en partitionerad kö eller ett ämne eller den förväntade belastningen kan inte hanteras av en enskild partitionerade kö eller ett ämne, måste du använda flera meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="bf199-225">If it is not possible to use a partitioned queue or topic, or the expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="bf199-226">När du använder flera enheter, skapa en dedikerad klient för varje entitet i stället för att använda samma klient för alla entiteter.</span><span class="sxs-lookup"><span data-stu-id="bf199-226">When using multiple entities, create a dedicated client for each entity, instead of using the same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="bf199-227">Utveckling och testning funktioner</span><span class="sxs-lookup"><span data-stu-id="bf199-227">Development and testing features</span></span>

<span data-ttu-id="bf199-228">Service Bus har en funktion som används för utveckling som **ska aldrig användas i produktion konfigurationer**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="bf199-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="bf199-229">När nya regler eller filter har lagts till i avsnittet, kan du använda [TopicDescription.EnableFilteringMessagesBeforePublishing][] och kontrollera att nya filteruttrycket fungerar som förväntat.</span><span class="sxs-lookup"><span data-stu-id="bf199-229">When new rules or filters are added to the topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] to verify that the new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="bf199-230">Scenarier</span><span class="sxs-lookup"><span data-stu-id="bf199-230">Scenarios</span></span>
<span data-ttu-id="bf199-231">I följande avsnitt beskrivs vanliga meddelandehantering och beskriver de föredragna inställningarna för Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bf199-231">The following sections describe typical messaging scenarios and outline the preferred Service Bus settings.</span></span> <span data-ttu-id="bf199-232">Hastigheter klassificeras så liten (mindre än 1 meddelande per sekund), Måttlig (1-meddelande per sekund eller större men mindre än 100 meddelanden per sekund) och hög (100 meddelanden/andra eller senare).</span><span class="sxs-lookup"><span data-stu-id="bf199-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="bf199-233">Antalet klienter som är klassificerade som liten (5 eller färre), Måttlig (mer än 5 men mindre än eller lika med 20), och stora (mer än 20).</span><span class="sxs-lookup"><span data-stu-id="bf199-233">The number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal to 20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="bf199-234">Hög genomströmning kön</span><span class="sxs-lookup"><span data-stu-id="bf199-234">High-throughput queue</span></span>
<span data-ttu-id="bf199-235">Mål: Maximera genomströmningen i en enskild kö.</span><span class="sxs-lookup"><span data-stu-id="bf199-235">Goal: Maximize the throughput of a single queue.</span></span> <span data-ttu-id="bf199-236">Antalet avsändare och mottagare är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-236">The number of senders and receivers is small.</span></span>

* <span data-ttu-id="bf199-237">Använda en partitionerad kö för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="bf199-238">Använda flera meddelandefabriker för att skapa avsändare för att öka den övergripande överföringshastighet i kön.</span><span class="sxs-lookup"><span data-stu-id="bf199-238">To increase the overall send rate into the queue, use multiple message factories to create senders.</span></span> <span data-ttu-id="bf199-239">Använd asynkrona åtgärder eller flera trådar för varje avsändare.</span><span class="sxs-lookup"><span data-stu-id="bf199-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="bf199-240">Använda flera meddelandefabriker för att skapa mottagare för att öka den övergripande receive-hastigheten från kön.</span><span class="sxs-lookup"><span data-stu-id="bf199-240">To increase the overall receive rate from the queue, use multiple message factories to create receivers.</span></span>
* <span data-ttu-id="bf199-241">Använd asynkrona åtgärder för att dra nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="bf199-241">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bf199-242">Ange batching intervall till 50ms att minska antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-242">Set the batching interval to 50ms to reduce the number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="bf199-243">Om du använder flera avsändare, öka batching intervallet ska 100ms.</span><span class="sxs-lookup"><span data-stu-id="bf199-243">If multiple senders are used, increase the batching interval to 100ms.</span></span>
* <span data-ttu-id="bf199-244">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="bf199-244">Leave batched store access enabled.</span></span> <span data-ttu-id="bf199-245">Detta ökar den övergripande hastighet som meddelanden kan skrivas i kön.</span><span class="sxs-lookup"><span data-stu-id="bf199-245">This increases the overall rate at which messages can be written into the queue.</span></span>
* <span data-ttu-id="bf199-246">Ange antalet prefetch till 20 gånger de högsta hastighetsprestanda av alla mottagare av ett fabriken.</span><span class="sxs-lookup"><span data-stu-id="bf199-246">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="bf199-247">Detta minskar antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-247">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="bf199-248">Flera hög genomströmning köer</span><span class="sxs-lookup"><span data-stu-id="bf199-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="bf199-249">Mål: Maximera totala genomflödet i flera köer.</span><span class="sxs-lookup"><span data-stu-id="bf199-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="bf199-250">Dataflöde för en enskild kö är måttlig eller hög.</span><span class="sxs-lookup"><span data-stu-id="bf199-250">The throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="bf199-251">Hämta maximalt dataflöde i flera köer med de inställningar som anges för att maximera genomströmningen i en enskild kö.</span><span class="sxs-lookup"><span data-stu-id="bf199-251">To obtain maximum throughput across multiple queues, use the settings outlined to maximize the throughput of a single queue.</span></span> <span data-ttu-id="bf199-252">Dessutom kan använda olika fabriker för att skapa klienter som skicka eller ta emot från olika köer.</span><span class="sxs-lookup"><span data-stu-id="bf199-252">In addition, use different factories to create clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="bf199-253">Låg latens kön</span><span class="sxs-lookup"><span data-stu-id="bf199-253">Low latency queue</span></span>
<span data-ttu-id="bf199-254">Mål: Minimera svarstiden för slutpunkt till slutpunkt för en kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="bf199-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="bf199-255">Antalet avsändare och mottagare är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-255">The number of senders and receivers is small.</span></span> <span data-ttu-id="bf199-256">Dataflöde för kön är liten eller Måttlig.</span><span class="sxs-lookup"><span data-stu-id="bf199-256">The throughput of the queue is small or moderate.</span></span>

* <span data-ttu-id="bf199-257">Använda en partitionerad kö för förbättrad tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="bf199-258">Inaktivera klientens batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="bf199-258">Disable client-side batching.</span></span> <span data-ttu-id="bf199-259">Skickar klienten omedelbart ett meddelande.</span><span class="sxs-lookup"><span data-stu-id="bf199-259">The client immediately sends a message.</span></span>
* <span data-ttu-id="bf199-260">Inaktivera batch store-åtkomst.</span><span class="sxs-lookup"><span data-stu-id="bf199-260">Disable batched store access.</span></span> <span data-ttu-id="bf199-261">Tjänsten skriver omedelbart meddelandet till arkivet.</span><span class="sxs-lookup"><span data-stu-id="bf199-261">The service immediately writes the message to the store.</span></span>
* <span data-ttu-id="bf199-262">Om du använder en enskild klient kan du ange antalet prefetch till 20 gånger behandlingstakt för mottagaren.</span><span class="sxs-lookup"><span data-stu-id="bf199-262">If using a single client, set the prefetch count to 20 times the processing rate of the receiver.</span></span> <span data-ttu-id="bf199-263">Om flera meddelanden anländer till kön samtidigt, överför Service Bus-klientprotokollet dem på samma gång.</span><span class="sxs-lookup"><span data-stu-id="bf199-263">If multiple messages arrive at the queue at the same time, the Service Bus client protocol transmits them all at the same time.</span></span> <span data-ttu-id="bf199-264">När klienten får nästa meddelande, finns meddelandet redan i den lokala cachen.</span><span class="sxs-lookup"><span data-stu-id="bf199-264">When the client receives the next message, that message is already in the local cache.</span></span> <span data-ttu-id="bf199-265">Cachen bör vara små.</span><span class="sxs-lookup"><span data-stu-id="bf199-265">The cache should be small.</span></span>
* <span data-ttu-id="bf199-266">Om du använder flera klienter, anger du antalet prefetch till 0.</span><span class="sxs-lookup"><span data-stu-id="bf199-266">If using multiple clients, set the prefetch count to 0.</span></span> <span data-ttu-id="bf199-267">Genom att göra får andra klienten det andra meddelandet när den första klienten fortfarande bearbetar det första meddelandet.</span><span class="sxs-lookup"><span data-stu-id="bf199-267">By doing this, the second client can receive the second message while the first client is still processing the first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="bf199-268">Kö med ett stort antal avsändare</span><span class="sxs-lookup"><span data-stu-id="bf199-268">Queue with a large number of senders</span></span>
<span data-ttu-id="bf199-269">Mål: Maximera genomströmningen i en kö eller ett ämne med ett stort antal avsändare.</span><span class="sxs-lookup"><span data-stu-id="bf199-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="bf199-270">Varje avsändare skickar meddelanden med en måttlig hastighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="bf199-271">Antalet mottagare är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-271">The number of receivers is small.</span></span>

<span data-ttu-id="bf199-272">Service Bus kan upp till 1 000 samtidiga anslutningar till en meddelandeentitet (eller 5000 använder AMQP).</span><span class="sxs-lookup"><span data-stu-id="bf199-272">Service Bus enables up to 1000 concurrent connections to a messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="bf199-273">Den här gränsen tillämpas på namnområdesnivån och köer-avsnitt-prenumerationer är begränsad av antalet samtidiga anslutningar per namnområde.</span><span class="sxs-lookup"><span data-stu-id="bf199-273">This limit is enforced at the namespace level, and queues/topics/subscriptions are capped by the limit of concurrent connections per namespace.</span></span> <span data-ttu-id="bf199-274">För köer delas antalet mellan avsändare och mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="bf199-275">Om alla 1000 anslutningar krävs för avsändare, bör du ersätta kön med ett ämne och en enda prenumeration.</span><span class="sxs-lookup"><span data-stu-id="bf199-275">If all 1000 connections are required for senders, you should replace the queue with a topic and a single subscription.</span></span> <span data-ttu-id="bf199-276">Ett ämne accepterar upp till 1 000 samtidiga anslutningar från avsändare, medan prenumerationen accepterar en ytterligare 1000 samtidiga anslutningar från mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-276">A topic accepts up to 1000 concurrent connections from senders, whereas the subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="bf199-277">Om högst 1 000 samtidiga avsändare krävs ska avsändare skicka meddelanden i Service Bus-protokollet via HTTP.</span><span class="sxs-lookup"><span data-stu-id="bf199-277">If more than 1000 concurrent senders are required, the senders should send messages to the Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="bf199-278">För att maximera genomströmningen, gör du följande:</span><span class="sxs-lookup"><span data-stu-id="bf199-278">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bf199-279">Använda en partitionerad kö för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="bf199-280">Om varje avsändare finns i en annan process, kan du använda en enda fabrik processer.</span><span class="sxs-lookup"><span data-stu-id="bf199-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="bf199-281">Använd asynkrona åtgärder för att dra nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="bf199-281">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bf199-282">Använd standard-batchbearbetning intervall på 20 MS för att minska antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-282">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="bf199-283">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="bf199-283">Leave batched store access enabled.</span></span> <span data-ttu-id="bf199-284">Detta ökar den övergripande hastighet som meddelanden kan skrivas till den kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="bf199-284">This increases the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="bf199-285">Ange antalet prefetch till 20 gånger de högsta hastighetsprestanda av alla mottagare av ett fabriken.</span><span class="sxs-lookup"><span data-stu-id="bf199-285">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="bf199-286">Detta minskar antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-286">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="bf199-287">Kö med ett stort antal mottagare</span><span class="sxs-lookup"><span data-stu-id="bf199-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="bf199-288">Mål: Maximera receive frekvensen för en kö eller en prenumeration med ett stort antal mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-288">Goal: Maximize the receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="bf199-289">Varje mottagare tar emot meddelanden med en måttlig hastighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="bf199-290">Antal avsändare är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-290">The number of senders is small.</span></span>

<span data-ttu-id="bf199-291">Service Bus kan upp till 1 000 samtidiga anslutningar till en entitet.</span><span class="sxs-lookup"><span data-stu-id="bf199-291">Service Bus enables up to 1000 concurrent connections to an entity.</span></span> <span data-ttu-id="bf199-292">Om en kö kräver mer än 1000 mottagare, bör du ersätta kön med ett ämne och flera prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="bf199-292">If a queue requires more than 1000 receivers, you should replace the queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="bf199-293">Varje prenumeration kan stöda upp till 1000 samtidiga anslutningar.</span><span class="sxs-lookup"><span data-stu-id="bf199-293">Each subscription can support up to 1000 concurrent connections.</span></span> <span data-ttu-id="bf199-294">Mottagare kan också komma åt kön via HTTP-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-294">Alternatively, receivers can access the queue via the HTTP protocol.</span></span>

<span data-ttu-id="bf199-295">För att maximera genomströmningen, gör du följande:</span><span class="sxs-lookup"><span data-stu-id="bf199-295">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bf199-296">Använda en partitionerad kö för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="bf199-297">Om varje mottagare finns i en annan process, kan du använda en enda fabrik processer.</span><span class="sxs-lookup"><span data-stu-id="bf199-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="bf199-298">Mottagare kan använda synkron eller asynkron åtgärder.</span><span class="sxs-lookup"><span data-stu-id="bf199-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="bf199-299">Ges begränsad receive frekvensen för en enskild mottagare påverkar klientsidan massbearbetning av en fullständig begäran inte mottagaren genomflöde.</span><span class="sxs-lookup"><span data-stu-id="bf199-299">Given the moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="bf199-300">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="bf199-300">Leave batched store access enabled.</span></span> <span data-ttu-id="bf199-301">Detta minskar den allmänna belastningen på enheten.</span><span class="sxs-lookup"><span data-stu-id="bf199-301">This reduces the overall load of the entity.</span></span> <span data-ttu-id="bf199-302">Det minskar också den sammanlagda hastighet som meddelanden kan skrivas till den kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="bf199-302">It also reduces the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="bf199-303">Ange antalet prefetch till ett mindre värde (till exempel PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="bf199-303">Set the prefetch count to a small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="bf199-304">Detta förhindrar att mottagarna inaktivitet medan andra mottagare har stora mängder meddelanden som cachelagras.</span><span class="sxs-lookup"><span data-stu-id="bf199-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="bf199-305">Avsnittet med ett litet antal prenumerationer</span><span class="sxs-lookup"><span data-stu-id="bf199-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="bf199-306">Mål: Maximera genomströmningen i ett ämne med ett litet antal prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="bf199-306">Goal: Maximize the throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="bf199-307">Ett meddelande tas emot av många prenumerationer, vilket innebär att den kombinerade receive-hastigheten över alla prenumerationer är större än frekvensen skicka.</span><span class="sxs-lookup"><span data-stu-id="bf199-307">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is larger than the send rate.</span></span> <span data-ttu-id="bf199-308">Antal avsändare är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-308">The number of senders is small.</span></span> <span data-ttu-id="bf199-309">Antalet mottagare per prenumeration är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-309">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="bf199-310">För att maximera genomströmningen, gör du följande:</span><span class="sxs-lookup"><span data-stu-id="bf199-310">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bf199-311">Använd en partitionerad avsnittet för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="bf199-312">Om du vill öka den övergripande överföringshastighet i avsnittet om att använda flera meddelandefabriker för att skapa avsändare.</span><span class="sxs-lookup"><span data-stu-id="bf199-312">To increase the overall send rate into the topic, use multiple message factories to create senders.</span></span> <span data-ttu-id="bf199-313">Använd asynkrona åtgärder eller flera trådar för varje avsändare.</span><span class="sxs-lookup"><span data-stu-id="bf199-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="bf199-314">För att öka den övergripande receive-hastigheten från en prenumeration kan du använda flera meddelandefabriker för att skapa mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-314">To increase the overall receive rate from a subscription, use multiple message factories to create receivers.</span></span> <span data-ttu-id="bf199-315">Använda asynkrona åtgärder eller flera trådar för varje mottagare.</span><span class="sxs-lookup"><span data-stu-id="bf199-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="bf199-316">Använd asynkrona åtgärder för att dra nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="bf199-316">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bf199-317">Använd standard-batchbearbetning intervall på 20 MS för att minska antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-317">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="bf199-318">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="bf199-318">Leave batched store access enabled.</span></span> <span data-ttu-id="bf199-319">Detta ökar den övergripande hastighet som meddelanden kan skrivas i avsnittet.</span><span class="sxs-lookup"><span data-stu-id="bf199-319">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="bf199-320">Ange antalet prefetch till 20 gånger de högsta hastighetsprestanda av alla mottagare av ett fabriken.</span><span class="sxs-lookup"><span data-stu-id="bf199-320">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="bf199-321">Detta minskar antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-321">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="bf199-322">Avsnittet med ett stort antal prenumerationer</span><span class="sxs-lookup"><span data-stu-id="bf199-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="bf199-323">Mål: Maximera genomströmningen i ett ämne med ett stort antal prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="bf199-323">Goal: Maximize the throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="bf199-324">Ett meddelande tas emot av många prenumerationer, vilket innebär att den kombinerade receive-hastigheten över alla prenumerationer är mycket större än överföringshastighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-324">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is much larger than the send rate.</span></span> <span data-ttu-id="bf199-325">Antal avsändare är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-325">The number of senders is small.</span></span> <span data-ttu-id="bf199-326">Antalet mottagare per prenumeration är liten.</span><span class="sxs-lookup"><span data-stu-id="bf199-326">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="bf199-327">Avsnitt med ett stort antal prenumerationer exponera en låg totala genomflödet vanligtvis om alla meddelanden dirigeras till alla prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="bf199-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed to all subscriptions.</span></span> <span data-ttu-id="bf199-328">Detta beror på att varje meddelande tas emot många gånger, och alla meddelanden som finns i ett ämne och alla prenumerationer lagras i samma Arkiv.</span><span class="sxs-lookup"><span data-stu-id="bf199-328">This is caused by the fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in the same store.</span></span> <span data-ttu-id="bf199-329">Det antas att antalet avsändare och mottagare per prenumeration antal är litet.</span><span class="sxs-lookup"><span data-stu-id="bf199-329">It is assumed that the number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="bf199-330">Service Bus stöder upp till 2 000 prenumerationer per avsnitt.</span><span class="sxs-lookup"><span data-stu-id="bf199-330">Service Bus supports up to 2,000 subscriptions per topic.</span></span>

<span data-ttu-id="bf199-331">För att maximera genomströmningen, gör du följande:</span><span class="sxs-lookup"><span data-stu-id="bf199-331">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bf199-332">Använd en partitionerad avsnittet för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="bf199-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="bf199-333">Använd asynkrona åtgärder för att dra nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="bf199-333">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bf199-334">Använd standard-batchbearbetning intervall på 20 MS för att minska antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-334">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="bf199-335">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="bf199-335">Leave batched store access enabled.</span></span> <span data-ttu-id="bf199-336">Detta ökar den övergripande hastighet som meddelanden kan skrivas i avsnittet.</span><span class="sxs-lookup"><span data-stu-id="bf199-336">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="bf199-337">Ange antalet prefetch till 20 gånger den förväntade receive frekvensen i sekunder.</span><span class="sxs-lookup"><span data-stu-id="bf199-337">Set the prefetch count to 20 times the expected receive rate in seconds.</span></span> <span data-ttu-id="bf199-338">Detta minskar antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="bf199-338">This reduces the number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bf199-339">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="bf199-339">Next steps</span></span>
<span data-ttu-id="bf199-340">Mer information om hur du optimerar prestanda för Service Bus finns [partitionerade meddelandeentiteter][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="bf199-340">To learn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
<span data-ttu-id="bf199-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span><span class="sxs-lookup"><span data-stu-id="bf199-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span></span>
