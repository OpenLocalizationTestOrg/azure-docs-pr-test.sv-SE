---
title: "aaaBest metoder för att förbättra prestanda med hjälp av Azure Service Bus | Microsoft Docs"
description: Beskriver hur toouse Service Bus toooptimize prestanda vid utbyte av asynkrona meddelanden.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: 52764d227757cbb11246675878933f21685817f1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="4cad8-103">Metodtips för bättre prestanda med hjälp av Service Bus-meddelanden</span><span class="sxs-lookup"><span data-stu-id="4cad8-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="4cad8-104">Den här artikeln beskriver hur toouse [Azure Service Bus-meddelanden](https://azure.microsoft.com/services/service-bus/) toooptimize prestanda vid utbyte av asynkrona meddelanden.</span><span class="sxs-lookup"><span data-stu-id="4cad8-104">This article describes how toouse [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) toooptimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="4cad8-105">hello första delen av det här avsnittet beskriver hello olika metoder som erbjuds toohelp ökade prestanda.</span><span class="sxs-lookup"><span data-stu-id="4cad8-105">hello first part of this topic describes hello different mechanisms that are offered toohelp increase performance.</span></span> <span data-ttu-id="4cad8-106">hello andra delen innehåller råd om hur toouse Service Bus på ett sätt som kan erbjuda hello bästa prestanda i ett visst scenario.</span><span class="sxs-lookup"><span data-stu-id="4cad8-106">hello second part provides guidance on how toouse Service Bus in a way that can offer hello best performance in a given scenario.</span></span>

<span data-ttu-id="4cad8-107">I det här avsnittet refererar hello termen ”klient” tooany entitet som har åtkomst till Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4cad8-107">Throughout this topic, hello term "client" refers tooany entity that accesses Service Bus.</span></span> <span data-ttu-id="4cad8-108">En klient kan ta hello roll för en avsändare eller en mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-108">A client can take hello role of a sender or a receiver.</span></span> <span data-ttu-id="4cad8-109">hello termen ”avsändare” används för en Service Bus kö eller ett ämne-klient som skickar meddelanden tooa Service Bus-kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-109">hello term "sender" is used for a Service Bus queue or topic client that sends messages tooa Service Bus queue or topic.</span></span> <span data-ttu-id="4cad8-110">hello termen ”mottagaren” refererar tooa Service Bus kö eller prenumeration klient som tar emot meddelanden från en Service Bus-kö eller prenumeration.</span><span class="sxs-lookup"><span data-stu-id="4cad8-110">hello term "receiver" refers tooa Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="4cad8-111">Dessa avsnitt introducerar några koncept som Service Bus använder toohelp ökar prestanda.</span><span class="sxs-lookup"><span data-stu-id="4cad8-111">These sections introduce several concepts that Service Bus uses toohelp boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="4cad8-112">Protokoll</span><span class="sxs-lookup"><span data-stu-id="4cad8-112">Protocols</span></span>
<span data-ttu-id="4cad8-113">Service Bus gör att klienter toosend och ta emot meddelanden via ett av tre protokoll:</span><span class="sxs-lookup"><span data-stu-id="4cad8-113">Service Bus enables clients toosend and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="4cad8-114">Avancerade Message Queuing-protokollet (AMQP)</span><span class="sxs-lookup"><span data-stu-id="4cad8-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="4cad8-115">Service Bus-meddelanden Protocol (SBMP)</span><span class="sxs-lookup"><span data-stu-id="4cad8-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="4cad8-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="4cad8-116">HTTP</span></span>

<span data-ttu-id="4cad8-117">AMQP och SBMP är effektivare, eftersom de bevarar hello anslutning tooService Bus länge hello meddelandefabrik finns.</span><span class="sxs-lookup"><span data-stu-id="4cad8-117">AMQP and SBMP are more efficient, because they maintain hello connection tooService Bus as long as hello messaging factory exists.</span></span> <span data-ttu-id="4cad8-118">Den implementerar batchbearbetning och förhämtar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="4cad8-119">Om du inte uttryckligen anges förutsätter allt innehåll i det här avsnittet hello användning av AMQP eller SBMP.</span><span class="sxs-lookup"><span data-stu-id="4cad8-119">Unless explicitly mentioned, all content in this topic assumes hello use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="4cad8-120">Återanvända fabriker och klienter</span><span class="sxs-lookup"><span data-stu-id="4cad8-120">Reusing factories and clients</span></span>
<span data-ttu-id="4cad8-121">Service Bus klienten objekt, till exempel [QueueClient] [ QueueClient] eller [MessageSender][MessageSender], skapas via en [ MessagingFactory] [ MessagingFactory] -objektet, vilket ger också intern hantering av anslutningar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="4cad8-122">Du bör inte stänga meddelanden fabriker eller kön, ämnet och prenumerationen klienter när du skickar ett meddelande och sedan återskapa dem när du skickar nästa hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send hello next message.</span></span> <span data-ttu-id="4cad8-123">Stänga en meddelandefabrik tar bort hello anslutning toohello Service Bus-tjänst och en ny anslutning upprättas när återskapa hello fabriken.</span><span class="sxs-lookup"><span data-stu-id="4cad8-123">Closing a messaging factory deletes hello connection toohello Service Bus service, and a new connection is established when recreating hello factory.</span></span> <span data-ttu-id="4cad8-124">Upprätta en anslutning är en kostsam åtgärd som att du slipper med nytt hello samma fabriken och klienten objekt flera åtgärder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-124">Establishing a connection is an expensive operation that you can avoid by re-using hello same factory and client objects for multiple operations.</span></span> <span data-ttu-id="4cad8-125">Du kan på ett säkert sätt använder hello [QueueClient] [ QueueClient] objekt för att skicka meddelanden från samtidiga asynkrona åtgärder och flera trådar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-125">You can safely use hello [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="4cad8-126">Samtidiga åtgärder</span><span class="sxs-lookup"><span data-stu-id="4cad8-126">Concurrent operations</span></span>
<span data-ttu-id="4cad8-127">Utföra en åtgärd (skicka, ta emot, ta bort, etc.) tar en stund.</span><span class="sxs-lookup"><span data-stu-id="4cad8-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="4cad8-128">Nu innehåller hello bearbetningen av hello åtgärden av hello Service Bus-tjänst i tillägg toohello svarstiden för hello och hello svarsmeddelanden.</span><span class="sxs-lookup"><span data-stu-id="4cad8-128">This time includes hello processing of hello operation by hello Service Bus service in addition toohello latency of hello request and hello reply.</span></span> <span data-ttu-id="4cad8-129">tooincrease hello antalet åtgärder per tid, åtgärder måste köras samtidigt.</span><span class="sxs-lookup"><span data-stu-id="4cad8-129">tooincrease hello number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="4cad8-130">Du kan göra detta på flera olika sätt:</span><span class="sxs-lookup"><span data-stu-id="4cad8-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="4cad8-131">**Asynkrona åtgärder**: hello klienten schemalägger åtgärder genom att utföra asynkrona åtgärder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-131">**Asynchronous operations**: hello client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="4cad8-132">hello nästa begäran har startats innan hello förra begäran har slutförts.</span><span class="sxs-lookup"><span data-stu-id="4cad8-132">hello next request is started before hello previous request is completed.</span></span> <span data-ttu-id="4cad8-133">hello följande är ett exempel på en asynkron sändningsåtgärd:</span><span class="sxs-lookup"><span data-stu-id="4cad8-133">hello following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="4cad8-134">Detta är ett exempel på en asynkron mottagning igen:</span><span class="sxs-lookup"><span data-stu-id="4cad8-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="4cad8-135">**Flera fabriker**: alla klienter (avsändare i tillägget tooreceivers) som skapas av hello samma factory dela en TCP-anslutning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-135">**Multiple factories**: all clients (senders in addition tooreceivers) that are created by hello same factory share one TCP connection.</span></span> <span data-ttu-id="4cad8-136">hello maximala genomströmningen begränsas av hello antal åtgärder som kan gå igenom den här TCP-anslutningen.</span><span class="sxs-lookup"><span data-stu-id="4cad8-136">hello maximum message throughput is limited by hello number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="4cad8-137">hello dataflödet som kan hämtas med en enda fabrik varierar kraftigt med TCP fram och åter gånger och meddelandestorlek.</span><span class="sxs-lookup"><span data-stu-id="4cad8-137">hello throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="4cad8-138">tooobtain högre hastigheter, bör du använda flera meddelanden fabriker.</span><span class="sxs-lookup"><span data-stu-id="4cad8-138">tooobtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="4cad8-139">Mottagningsläge</span><span class="sxs-lookup"><span data-stu-id="4cad8-139">Receive mode</span></span>
<span data-ttu-id="4cad8-140">När du skapar en kö eller prenumeration klient kan du ange en receive-läge: *titt Lås* eller *ta emot och ta bort*.</span><span class="sxs-lookup"><span data-stu-id="4cad8-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="4cad8-141">hello standard mottagningsläge är [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="4cad8-141">hello default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="4cad8-142">När det här läget kan hello klient skickar en begäran tooreceive ett meddelande från Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4cad8-142">When operating in this mode, hello client sends a request tooreceive a message from Service Bus.</span></span> <span data-ttu-id="4cad8-143">När hello-klienten har tagit emot hello-meddelande, skickar en begäran toocomplete hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-143">After hello client has received hello message, it sends a request toocomplete hello message.</span></span>

<span data-ttu-id="4cad8-144">När inställningen hello mottagningsläge för[ReceiveAndDelete][ReceiveAndDelete], båda stegen kombineras i en enskild begäran.</span><span class="sxs-lookup"><span data-stu-id="4cad8-144">When setting hello receive mode too[ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="4cad8-145">Detta minskar hello övergripande antal åtgärder och kan förbättra hello totala genomströmningen.</span><span class="sxs-lookup"><span data-stu-id="4cad8-145">This reduces hello overall number of operations, and can improve hello overall message throughput.</span></span> <span data-ttu-id="4cad8-146">Den här prestandafördelar levereras hello risken för att förlora meddelanden.</span><span class="sxs-lookup"><span data-stu-id="4cad8-146">This performance gain comes at hello risk of losing messages.</span></span>

<span data-ttu-id="4cad8-147">Service Bus stöder inte transaktioner för ta emot och delete-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="4cad8-148">Dessutom titt Lås semantik krävs för alla scenarier i vilka hello klient vill toodefer eller [förlorade](service-bus-dead-letter-queues.md) ett meddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-148">In addition, peek-lock semantics are required for any scenarios in which hello client wants toodefer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="4cad8-149">Klientsidans batchbearbetning</span><span class="sxs-lookup"><span data-stu-id="4cad8-149">Client-side batching</span></span>
<span data-ttu-id="4cad8-150">Klientsidans batchbearbetning kan en kö eller avsnittet klienten toodelay hello skickas ett meddelande för en viss tidsperiod.</span><span class="sxs-lookup"><span data-stu-id="4cad8-150">Client-side batching enables a queue or topic client toodelay hello sending of a message for a certain period of time.</span></span> <span data-ttu-id="4cad8-151">Om hello klienten skickar ytterligare meddelanden under den här tiden, överför hälsningsmeddelande i en enskild batch.</span><span class="sxs-lookup"><span data-stu-id="4cad8-151">If hello client sends additional messages during this time period, it transmits hello messages in a single batch.</span></span> <span data-ttu-id="4cad8-152">Klientsidans batchbearbetning gör att en kö eller prenumeration klienten toobatch flera **Slutför** begäranden till en enskild begäran.</span><span class="sxs-lookup"><span data-stu-id="4cad8-152">Client-side batching also causes a queue or subscription client toobatch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="4cad8-153">Batchbearbetning är endast tillgängligt för asynkron **skicka** och **Slutför** åtgärder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="4cad8-154">Synkrona åtgärder skickas omedelbart toohello Service Bus-tjänst.</span><span class="sxs-lookup"><span data-stu-id="4cad8-154">Synchronous operations are immediately sent toohello Service Bus service.</span></span> <span data-ttu-id="4cad8-155">Batchbearbetning inte ske för titt eller ta emot operations eller batchbearbetning sker över klienter.</span><span class="sxs-lookup"><span data-stu-id="4cad8-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="4cad8-156">Som standard använder en klient en batch-intervallet för 20ms.</span><span class="sxs-lookup"><span data-stu-id="4cad8-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="4cad8-157">Du kan ändra hello batch intervall genom att ange hello [BatchFlushInterval] [ BatchFlushInterval] egenskapen innan du skapar hello meddelandefabrik.</span><span class="sxs-lookup"><span data-stu-id="4cad8-157">You can change hello batch interval by setting hello [BatchFlushInterval][BatchFlushInterval] property before creating hello messaging factory.</span></span> <span data-ttu-id="4cad8-158">Den här inställningen påverkar alla klienter som har skapats med den här fabriken.</span><span class="sxs-lookup"><span data-stu-id="4cad8-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="4cad8-159">toodisable batchbearbetning, ange hello [BatchFlushInterval] [ BatchFlushInterval] egenskapen för**TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="4cad8-159">toodisable batching, set hello [BatchFlushInterval][BatchFlushInterval] property too**TimeSpan.Zero**.</span></span> <span data-ttu-id="4cad8-160">Exempel:</span><span class="sxs-lookup"><span data-stu-id="4cad8-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="4cad8-161">Batchbearbetning påverkar inte hello antal fakturerbar asynkrona åtgärder och är bara tillgängligt för hello klientprotokoll för Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4cad8-161">Batching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="4cad8-162">hello HTTP-protokollet har inte stöd för batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-162">hello HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="4cad8-163">Batchbearbetning store-åtkomst</span><span class="sxs-lookup"><span data-stu-id="4cad8-163">Batching store access</span></span>
<span data-ttu-id="4cad8-164">tooincrease hello genomflödet i kön, ämnet och prenumerationen, Service Bus batchar flera meddelanden vid skrivning tooits interna store.</span><span class="sxs-lookup"><span data-stu-id="4cad8-164">tooincrease hello throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes tooits internal store.</span></span> <span data-ttu-id="4cad8-165">Om aktiverad på en kö eller ett ämne, kommer det att batchar att skriva meddelanden till hello-arkivet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-165">If enabled on a queue or topic, writing messages into hello store will be batched.</span></span> <span data-ttu-id="4cad8-166">Om aktiverad på en kö eller en prenumeration, kommer det att batchar att ta bort meddelanden från hello store.</span><span class="sxs-lookup"><span data-stu-id="4cad8-166">If enabled on a queue or subscription, deleting messages from hello store will be batched.</span></span> <span data-ttu-id="4cad8-167">Om gruppbaserad store-åtkomst är aktiverat för en entitet, fördröjningar Service Bus store skrivning om enheten genom att konfigurera too20ms.</span><span class="sxs-lookup"><span data-stu-id="4cad8-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up too20ms.</span></span> <span data-ttu-id="4cad8-168">Ytterligare store-åtgärder som inträffar under det här intervallet läggs toohello batch.</span><span class="sxs-lookup"><span data-stu-id="4cad8-168">Additional store operations that occur during this interval are added toohello batch.</span></span> <span data-ttu-id="4cad8-169">Batchar store åtkomst endast påverkar **skicka** och **Slutför** verksamhet, ta emot påverkas inte.</span><span class="sxs-lookup"><span data-stu-id="4cad8-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="4cad8-170">Batch store-åtkomst är en egenskap för en entitet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="4cad8-171">Batchbearbetning sker över alla enheter som möjliggör gruppbaserad store-åtkomst.</span><span class="sxs-lookup"><span data-stu-id="4cad8-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="4cad8-172">När du skapar en ny kö, ämne eller en prenumeration kan är batch store-åtkomst aktiverat som standard.</span><span class="sxs-lookup"><span data-stu-id="4cad8-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="4cad8-173">toodisable batchar store-åtkomst, ange hello [EnableBatchedOperations] [ EnableBatchedOperations] egenskapen för**FALSKT** innan du skapar hello entitet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-173">toodisable batched store access, set hello [EnableBatchedOperations][EnableBatchedOperations] property too**false** before creating hello entity.</span></span> <span data-ttu-id="4cad8-174">Exempel:</span><span class="sxs-lookup"><span data-stu-id="4cad8-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="4cad8-175">Batch store-åtkomst påverkar inte hello antal fakturerbar asynkrona åtgärder och är en egenskap för kön, ämnet och prenumerationen.</span><span class="sxs-lookup"><span data-stu-id="4cad8-175">Batched store access does not affect hello number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="4cad8-176">Det är oberoende av hello får läge och hello protokoll som används mellan en klient och hello Service Bus-tjänst.</span><span class="sxs-lookup"><span data-stu-id="4cad8-176">It is independent of hello receive mode and hello protocol that is used between a client and hello Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="4cad8-177">Förhämtar</span><span class="sxs-lookup"><span data-stu-id="4cad8-177">Prefetching</span></span>
<span data-ttu-id="4cad8-178">Förhämtar kan hello kö eller prenumeration klienten tooload ytterligare meddelanden från hello-tjänsten när en receive-åtgärd utförs.</span><span class="sxs-lookup"><span data-stu-id="4cad8-178">Prefetching enables hello queue or subscription client tooload additional messages from hello service when it performs a receive operation.</span></span> <span data-ttu-id="4cad8-179">hello klienten lagrar dessa meddelanden i ett lokalt cacheminne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-179">hello client stores these messages in a local cache.</span></span> <span data-ttu-id="4cad8-180">hello hello cachens storlek bestäms av hello [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] eller [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] Egenskaper.</span><span class="sxs-lookup"><span data-stu-id="4cad8-180">hello size of hello cache is determined by hello [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="4cad8-181">Varje klient som möjliggör förhämtar upprätthåller sin egen cache.</span><span class="sxs-lookup"><span data-stu-id="4cad8-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="4cad8-182">En cache delas inte mellan klienter.</span><span class="sxs-lookup"><span data-stu-id="4cad8-182">A cache is not shared across clients.</span></span> <span data-ttu-id="4cad8-183">Om hello klienten startar en receive-åtgärd och dess cachen är tom, överför hello-tjänsten en grupp med meddelanden.</span><span class="sxs-lookup"><span data-stu-id="4cad8-183">If hello client initiates a receive operation and its cache is empty, hello service transmits a batch of messages.</span></span> <span data-ttu-id="4cad8-184">hello storleken på hello batch är lika med hello storleken på cacheminnet hello eller 256 KB, beroende på vilket som är mindre.</span><span class="sxs-lookup"><span data-stu-id="4cad8-184">hello size of hello batch equals hello size of hello cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="4cad8-185">Om hello klienten startar en receive-åtgärd och hello cachen innehåller ett meddelande tas hello-meddelande från hello cache.</span><span class="sxs-lookup"><span data-stu-id="4cad8-185">If hello client initiates a receive operation and hello cache contains a message, hello message is taken from hello cache.</span></span>

<span data-ttu-id="4cad8-186">När ett meddelande är prefetched service Lås hello prefetched hälsningsmeddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-186">When a message is prefetched, hello service locks hello prefetched message.</span></span> <span data-ttu-id="4cad8-187">På så sätt kan inte prefetched hello-meddelande tas emot av en annan mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-187">By doing this, hello prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="4cad8-188">Om hello mottagaren inte kan slutföra hello-meddelande innan hello Lås upphör att gälla, blir tillgängliga tooother mottagare hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-188">If hello receiver cannot complete hello message before hello lock expires, hello message becomes available tooother receivers.</span></span> <span data-ttu-id="4cad8-189">Hej prefetched kopia av hello-meddelande är kvar i hello cache.</span><span class="sxs-lookup"><span data-stu-id="4cad8-189">hello prefetched copy of hello message remains in hello cache.</span></span> <span data-ttu-id="4cad8-190">hello mottagare som förbrukar hello upphört att gälla cachelagrad kopia får ett undantag när den försöker toocomplete meddelandet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-190">hello receiver that consumes hello expired cached copy will receive an exception when it tries toocomplete that message.</span></span> <span data-ttu-id="4cad8-191">Som standard hello meddelandet Lås upphör att gälla efter 60 sekunder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-191">By default, hello message lock expires after 60 seconds.</span></span> <span data-ttu-id="4cad8-192">Det här värdet kan vara utökade too5 minuter.</span><span class="sxs-lookup"><span data-stu-id="4cad8-192">This value can be extended too5 minutes.</span></span> <span data-ttu-id="4cad8-193">tooprevent hello förbrukning av meddelanden som har upphört att gälla, hello cachestorleken bör alltid att vara mindre än hello antal meddelanden som kan användas av en klient i hello lock timeout-intervall.</span><span class="sxs-lookup"><span data-stu-id="4cad8-193">tooprevent hello consumption of expired messages, hello cache size should always be smaller than hello number of messages that can be consumed by a client within hello lock time-out interval.</span></span>

<span data-ttu-id="4cad8-194">När du använder hello standard Låsets upphörande 60 sekunder, en bra värde för [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] är 20 gånger hello maximala bearbetning av alla mottagare av hello fabriken.</span><span class="sxs-lookup"><span data-stu-id="4cad8-194">When using hello default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times hello maximum processing rates of all receivers of hello factory.</span></span> <span data-ttu-id="4cad8-195">Till exempel en fabrik skapar 3 mottagare, och varje mottagare kan bearbeta upp too10 meddelanden per sekund.</span><span class="sxs-lookup"><span data-stu-id="4cad8-195">For example, a factory creates 3 receivers, and each receiver can process up too10 messages per second.</span></span> <span data-ttu-id="4cad8-196">hello prefetch antal får inte överstiga 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="4cad8-196">hello prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="4cad8-197">Som standard [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] är uppsättningen too0, vilket innebär att inga fler meddelanden hämtas från hello-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set too0, which means that no additional messages are fetched from hello service.</span></span>

<span data-ttu-id="4cad8-198">Förhämtar meddelanden ökar hello totala genomflödet för en kö eller en prenumeration eftersom det reducerar hello övergripande antal meddelandeåtgärder eller sändningar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-198">Prefetching messages increases hello overall throughput for a queue or subscription because it reduces hello overall number of message operations, or round trips.</span></span> <span data-ttu-id="4cad8-199">Hämtar första hello-meddelande, men tar längre tid (på grund av ökade toohello meddelandestorlek).</span><span class="sxs-lookup"><span data-stu-id="4cad8-199">Fetching hello first message, however, will take longer (due toohello increased message size).</span></span> <span data-ttu-id="4cad8-200">Ta emot prefetched meddelanden är snabbare eftersom dessa meddelanden redan har hämtats av hello-klienten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-200">Receiving prefetched messages will be faster because these messages have already been downloaded by hello client.</span></span>

<span data-ttu-id="4cad8-201">hello time to live (TTL)-egenskapen för ett meddelande kontrolleras av hello-servern för närvarande hello hello servern skickar hello message toohello klient.</span><span class="sxs-lookup"><span data-stu-id="4cad8-201">hello time-to-live (TTL) property of a message is checked by hello server at hello time hello server sends hello message toohello client.</span></span> <span data-ttu-id="4cad8-202">hello klienten kontrollerar inte hello-meddelande-TTL egenskapen när hello-meddelande tas emot.</span><span class="sxs-lookup"><span data-stu-id="4cad8-202">hello client does not check hello message’s TTL property when hello message is received.</span></span> <span data-ttu-id="4cad8-203">Hello-meddelande kan i stället tas emot även om hello-meddelande-TTL har passerat medan hello-meddelande cachelagrades av hello-klienten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-203">Instead, hello message can be received even if hello message’s TTL has passed while hello message was cached by hello client.</span></span>

<span data-ttu-id="4cad8-204">Förhämtar påverkar inte hello antal fakturerbar asynkrona åtgärder och är bara tillgängligt för hello klientprotokoll för Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4cad8-204">Prefetching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="4cad8-205">hello HTTP-protokollet stöder inte förhämtar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-205">hello HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="4cad8-206">Förhämtar är tillgänglig för både synkrona och asynkrona får åtgärder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="4cad8-207">Express köer och ämnen</span><span class="sxs-lookup"><span data-stu-id="4cad8-207">Express queues and topics</span></span>

<span data-ttu-id="4cad8-208">Expressenheter aktivera högt genomflöde och svarstid för minskade scenarier och stöds endast i hello meddelanden standardnivån.</span><span class="sxs-lookup"><span data-stu-id="4cad8-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in hello Standard messaging tier.</span></span> <span data-ttu-id="4cad8-209">Entiteter som skapats i [Premium-namnområden](service-bus-premium-messaging.md) inte stöder hello express alternativ.</span><span class="sxs-lookup"><span data-stu-id="4cad8-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support hello express option.</span></span> <span data-ttu-id="4cad8-210">Med expressenheter, om ett meddelande skickas tooa kö eller ett ämne, lagras hello-meddelande omedelbart inte i hello meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="4cad8-210">With express entities, if a message is sent tooa queue or topic, hello message is not immediately stored in hello messaging store.</span></span> <span data-ttu-id="4cad8-211">I stället cachelagras i minnet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="4cad8-212">Om ett meddelande finns kvar i hello kön i mer än ett par sekunder, skrivs automatiskt toostable lagring, vilket skyddar mot dataförlust på grund av tooan avbrott.</span><span class="sxs-lookup"><span data-stu-id="4cad8-212">If a message remains in hello queue for more than a few seconds, it is automatically written toostable storage, thus protecting it against loss due tooan outage.</span></span> <span data-ttu-id="4cad8-213">Skriva hello-meddelande till en minnescache ökar dataflödet och minskar latens eftersom det inte finns några åtkomst toostable skickas lagringsutrymme på hello tid hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-213">Writing hello message into a memory cache increases throughput and reduces latency because there is no access toostable storage at hello time hello message is sent.</span></span> <span data-ttu-id="4cad8-214">Meddelanden som används inom några sekunder skrivs inte toohello messaging store.</span><span class="sxs-lookup"><span data-stu-id="4cad8-214">Messages that are consumed within a few seconds are not written toohello messaging store.</span></span> <span data-ttu-id="4cad8-215">hello följande exempel skapar en uttrycklig avsnittet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-215">hello following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="4cad8-216">Om ett meddelande som innehåller viktig information som inte får vara förlorade skickas tooan express entiteten, hello avsändaren kan tvinga Service Bus tooimmediately upprätthålla hello meddelandet toostable lagring genom att ange hello [ForcePersistence] [ ForcePersistence] egenskapen för**SANT**.</span><span class="sxs-lookup"><span data-stu-id="4cad8-216">If a message containing critical information that must not be lost is sent tooan express entity, hello sender can force Service Bus tooimmediately persist hello message toostable storage by setting hello [ForcePersistence][ForcePersistence] property too**true**.</span></span>

> [!NOTE]
> <span data-ttu-id="4cad8-217">Expressenheter stöder inte transaktioner.</span><span class="sxs-lookup"><span data-stu-id="4cad8-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="4cad8-218">Användning av partitionerade köer och ämnen</span><span class="sxs-lookup"><span data-stu-id="4cad8-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="4cad8-219">Internt, Service Bus använder hello samma nod och meddelanden store tooprocess och lagra alla meddelanden för en meddelandeentitet (kö eller ett ämne).</span><span class="sxs-lookup"><span data-stu-id="4cad8-219">Internally, Service Bus uses hello same node and messaging store tooprocess and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="4cad8-220">En partitionerad kö eller ett ämne, på hello däremot distribueras över flera noder och meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="4cad8-220">A partitioned queue or topic, on hello other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="4cad8-221">Partitionerade köer och ämnen inte bara att ge en bättre genomströmning än vanliga köer och ämnen, de också uppvisar en högre tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="4cad8-222">toocreate en partitionerad entitet set hello [EnablePartitioning] [ EnablePartitioning] egenskapen för**SANT**som visas i följande exempel hello.</span><span class="sxs-lookup"><span data-stu-id="4cad8-222">toocreate a partitioned entity, set hello [EnablePartitioning][EnablePartitioning] property too**true**, as shown in hello following example.</span></span> <span data-ttu-id="4cad8-223">Mer information om partitionerade enheter finns [partitionerade meddelandeentiteter][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="4cad8-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="4cad8-224">Användning av flera köer</span><span class="sxs-lookup"><span data-stu-id="4cad8-224">Use of multiple queues</span></span>

<span data-ttu-id="4cad8-225">Om det inte är möjligt toouse en partitionerad kö eller avsnittet eller hello förväntad belastning inte kan hanteras av en enskild partitionerade kö eller ett ämne, måste du använda flera meddelandeentiteter.</span><span class="sxs-lookup"><span data-stu-id="4cad8-225">If it is not possible toouse a partitioned queue or topic, or hello expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="4cad8-226">När du använder flera enheter, skapa en dedikerad klient för varje entitet, istället för att använda hello samma klienten för alla entiteter.</span><span class="sxs-lookup"><span data-stu-id="4cad8-226">When using multiple entities, create a dedicated client for each entity, instead of using hello same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="4cad8-227">Utveckling och testning funktioner</span><span class="sxs-lookup"><span data-stu-id="4cad8-227">Development and testing features</span></span>

<span data-ttu-id="4cad8-228">Service Bus har en funktion som används för utveckling som **ska aldrig användas i produktion konfigurationer**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="4cad8-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="4cad8-229">När nya regler eller filter läggs toohello avsnittet, kan du använda [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify som hello nya filteruttrycket fungerar som förväntat.</span><span class="sxs-lookup"><span data-stu-id="4cad8-229">When new rules or filters are added toohello topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify that hello new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="4cad8-230">Scenarier</span><span class="sxs-lookup"><span data-stu-id="4cad8-230">Scenarios</span></span>
<span data-ttu-id="4cad8-231">hello följande avsnitt beskrivs vanliga meddelandehantering och beskriver hello önskad Service Bus-inställningar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-231">hello following sections describe typical messaging scenarios and outline hello preferred Service Bus settings.</span></span> <span data-ttu-id="4cad8-232">Hastigheter klassificeras så liten (mindre än 1 meddelande per sekund), Måttlig (1-meddelande per sekund eller större men mindre än 100 meddelanden per sekund) och hög (100 meddelanden/andra eller senare).</span><span class="sxs-lookup"><span data-stu-id="4cad8-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="4cad8-233">hello antalet klienter som är klassificerade som liten (5 eller färre), Måttlig (mer än 5 mindre än eller lika med too20), och stora (mer än 20).</span><span class="sxs-lookup"><span data-stu-id="4cad8-233">hello number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal too20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="4cad8-234">Hög genomströmning kön</span><span class="sxs-lookup"><span data-stu-id="4cad8-234">High-throughput queue</span></span>
<span data-ttu-id="4cad8-235">Mål: Maximera hello genomströmningen i en enskild kö.</span><span class="sxs-lookup"><span data-stu-id="4cad8-235">Goal: Maximize hello throughput of a single queue.</span></span> <span data-ttu-id="4cad8-236">hello antal avsändare och mottagare är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-236">hello number of senders and receivers is small.</span></span>

* <span data-ttu-id="4cad8-237">Använda en partitionerad kö för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="4cad8-238">tooincrease hello övergripande överföringskö i hello kö kan använda flera fabriker toocreate avsändare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-238">tooincrease hello overall send rate into hello queue, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="4cad8-239">Använd asynkrona åtgärder eller flera trådar för varje avsändare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="4cad8-240">tooincrease hello övergripande mottagningshastighet från hello kön kan använda flera meddelandet fabriker toocreate mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-240">tooincrease hello overall receive rate from hello queue, use multiple message factories toocreate receivers.</span></span>
* <span data-ttu-id="4cad8-241">Använd asynkrona åtgärder tootake nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-241">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="4cad8-242">Ange hello batchbearbetning intervall too50ms tooreduce hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-242">Set hello batching interval too50ms tooreduce hello number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="4cad8-243">Om du använder flera avsändare, öka hello batchbearbetning too100ms intervall.</span><span class="sxs-lookup"><span data-stu-id="4cad8-243">If multiple senders are used, increase hello batching interval too100ms.</span></span>
* <span data-ttu-id="4cad8-244">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="4cad8-244">Leave batched store access enabled.</span></span> <span data-ttu-id="4cad8-245">Detta ökar hello övergripande hastighet som meddelanden kan skrivas i hello kö.</span><span class="sxs-lookup"><span data-stu-id="4cad8-245">This increases hello overall rate at which messages can be written into hello queue.</span></span>
* <span data-ttu-id="4cad8-246">Ange hello prefetch antal too20 tider hello maximala hastighetsprestanda av alla mottagare av ett fabriken.</span><span class="sxs-lookup"><span data-stu-id="4cad8-246">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="4cad8-247">Detta minskar hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-247">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="4cad8-248">Flera hög genomströmning köer</span><span class="sxs-lookup"><span data-stu-id="4cad8-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="4cad8-249">Mål: Maximera totala genomflödet i flera köer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="4cad8-250">hello genomströmningen i en enskild kö är måttlig eller hög.</span><span class="sxs-lookup"><span data-stu-id="4cad8-250">hello throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="4cad8-251">tooobtain maximalt dataflöde i flera köer, Använd hello inställningar beskrivs toomaximize hello genomströmningen i en enskild kö.</span><span class="sxs-lookup"><span data-stu-id="4cad8-251">tooobtain maximum throughput across multiple queues, use hello settings outlined toomaximize hello throughput of a single queue.</span></span> <span data-ttu-id="4cad8-252">Dessutom kan använda olika fabriker toocreate klienter som skicka eller ta emot från olika köer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-252">In addition, use different factories toocreate clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="4cad8-253">Låg latens kön</span><span class="sxs-lookup"><span data-stu-id="4cad8-253">Low latency queue</span></span>
<span data-ttu-id="4cad8-254">Mål: Minimera svarstiden för slutpunkt till slutpunkt för en kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="4cad8-255">hello antal avsändare och mottagare är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-255">hello number of senders and receivers is small.</span></span> <span data-ttu-id="4cad8-256">hello genomflödet i hello kön är liten eller Måttlig.</span><span class="sxs-lookup"><span data-stu-id="4cad8-256">hello throughput of hello queue is small or moderate.</span></span>

* <span data-ttu-id="4cad8-257">Använda en partitionerad kö för förbättrad tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="4cad8-258">Inaktivera klientens batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-258">Disable client-side batching.</span></span> <span data-ttu-id="4cad8-259">hello klient skickar ett meddelande direkt.</span><span class="sxs-lookup"><span data-stu-id="4cad8-259">hello client immediately sends a message.</span></span>
* <span data-ttu-id="4cad8-260">Inaktivera batch store-åtkomst.</span><span class="sxs-lookup"><span data-stu-id="4cad8-260">Disable batched store access.</span></span> <span data-ttu-id="4cad8-261">hello service skriver omedelbart hello toohello meddelandearkiv.</span><span class="sxs-lookup"><span data-stu-id="4cad8-261">hello service immediately writes hello message toohello store.</span></span>
* <span data-ttu-id="4cad8-262">Om du använder en enskild klient ange hello prefetch antal too20 gånger hello behandlingstakten för hello mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-262">If using a single client, set hello prefetch count too20 times hello processing rate of hello receiver.</span></span> <span data-ttu-id="4cad8-263">Om flera meddelanden anländer till hello kö på hello samma tid, hello Service Bus klientprotokoll överför dem på hello samtidigt.</span><span class="sxs-lookup"><span data-stu-id="4cad8-263">If multiple messages arrive at hello queue at hello same time, hello Service Bus client protocol transmits them all at hello same time.</span></span> <span data-ttu-id="4cad8-264">När hello klienten tar emot nästa hello-meddelande, finns meddelandet redan i hello lokalt cacheminne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-264">When hello client receives hello next message, that message is already in hello local cache.</span></span> <span data-ttu-id="4cad8-265">hello cache ska vara små.</span><span class="sxs-lookup"><span data-stu-id="4cad8-265">hello cache should be small.</span></span>
* <span data-ttu-id="4cad8-266">Om du använder flera klienter, ange hello prefetch antal too0.</span><span class="sxs-lookup"><span data-stu-id="4cad8-266">If using multiple clients, set hello prefetch count too0.</span></span> <span data-ttu-id="4cad8-267">Genom att göra får andra hello-klient andra hello-meddelande medan hello första klienten fortfarande bearbetar första hello-meddelande.</span><span class="sxs-lookup"><span data-stu-id="4cad8-267">By doing this, hello second client can receive hello second message while hello first client is still processing hello first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="4cad8-268">Kö med ett stort antal avsändare</span><span class="sxs-lookup"><span data-stu-id="4cad8-268">Queue with a large number of senders</span></span>
<span data-ttu-id="4cad8-269">Mål: Maximera genomströmningen i en kö eller ett ämne med ett stort antal avsändare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="4cad8-270">Varje avsändare skickar meddelanden med en måttlig hastighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="4cad8-271">hello antal mottagare är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-271">hello number of receivers is small.</span></span>

<span data-ttu-id="4cad8-272">Service Bus kan in too1000 samtidiga anslutningar tooa messaging entitet (eller 5000 använder AMQP).</span><span class="sxs-lookup"><span data-stu-id="4cad8-272">Service Bus enables up too1000 concurrent connections tooa messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="4cad8-273">Den här gränsen tillämpas på hello namnområde nivå och köer-avsnitt-prenumerationer är begränsad av hello antalet samtidiga anslutningar per namnområde.</span><span class="sxs-lookup"><span data-stu-id="4cad8-273">This limit is enforced at hello namespace level, and queues/topics/subscriptions are capped by hello limit of concurrent connections per namespace.</span></span> <span data-ttu-id="4cad8-274">För köer delas antalet mellan avsändare och mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="4cad8-275">Om alla 1000 anslutningar krävs för avsändare, bör du ersätta hello kö med ett ämne och en enda prenumeration.</span><span class="sxs-lookup"><span data-stu-id="4cad8-275">If all 1000 connections are required for senders, you should replace hello queue with a topic and a single subscription.</span></span> <span data-ttu-id="4cad8-276">Ett ämne accepterar too1000 samtidiga anslutningar från avsändare, medan hello prenumerationen accepterar en ytterligare 1000 samtidiga anslutningar från mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-276">A topic accepts up too1000 concurrent connections from senders, whereas hello subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="4cad8-277">Om fler än 1000 samtidiga avsändare krävs skicka hello avsändare meddelanden toohello Service Bus-protokollet via HTTP.</span><span class="sxs-lookup"><span data-stu-id="4cad8-277">If more than 1000 concurrent senders are required, hello senders should send messages toohello Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="4cad8-278">toomaximize genomströmning hello följande:</span><span class="sxs-lookup"><span data-stu-id="4cad8-278">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="4cad8-279">Använda en partitionerad kö för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="4cad8-280">Om varje avsändare finns i en annan process, kan du använda en enda fabrik processer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="4cad8-281">Använd asynkrona åtgärder tootake nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-281">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="4cad8-282">Använd hello standard batchbearbetning intervall 20ms tooreduce hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-282">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="4cad8-283">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="4cad8-283">Leave batched store access enabled.</span></span> <span data-ttu-id="4cad8-284">Detta ökar hello övergripande hastighet med vilken meddelanden kan skrivas till hello kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-284">This increases hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="4cad8-285">Ange hello prefetch antal too20 tider hello maximala hastighetsprestanda av alla mottagare av ett fabriken.</span><span class="sxs-lookup"><span data-stu-id="4cad8-285">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="4cad8-286">Detta minskar hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-286">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="4cad8-287">Kö med ett stort antal mottagare</span><span class="sxs-lookup"><span data-stu-id="4cad8-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="4cad8-288">Mål: Maximera hello mottagningshastighet för en kö eller en prenumeration med ett stort antal mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-288">Goal: Maximize hello receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="4cad8-289">Varje mottagare tar emot meddelanden med en måttlig hastighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="4cad8-290">hello antal avsändare är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-290">hello number of senders is small.</span></span>

<span data-ttu-id="4cad8-291">Service Bus gör dig too1000 samtidiga anslutningar tooan entitet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-291">Service Bus enables up too1000 concurrent connections tooan entity.</span></span> <span data-ttu-id="4cad8-292">Om en kö kräver mer än 1000 mottagare, bör du ersätta hello kö med ett ämne och flera prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-292">If a queue requires more than 1000 receivers, you should replace hello queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="4cad8-293">Varje prenumeration stöder too1000 samtidiga anslutningar.</span><span class="sxs-lookup"><span data-stu-id="4cad8-293">Each subscription can support up too1000 concurrent connections.</span></span> <span data-ttu-id="4cad8-294">Mottagare kan också komma åt hello kön via hello HTTP-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-294">Alternatively, receivers can access hello queue via hello HTTP protocol.</span></span>

<span data-ttu-id="4cad8-295">toomaximize genomströmning hello följande:</span><span class="sxs-lookup"><span data-stu-id="4cad8-295">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="4cad8-296">Använda en partitionerad kö för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="4cad8-297">Om varje mottagare finns i en annan process, kan du använda en enda fabrik processer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="4cad8-298">Mottagare kan använda synkron eller asynkron åtgärder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="4cad8-299">Angivna hello måttlig mottagningshastighet för en enskild mottagare, klientsidan massbearbetning av en fullständig begäran påverkar inte mottagaren genomflöde.</span><span class="sxs-lookup"><span data-stu-id="4cad8-299">Given hello moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="4cad8-300">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="4cad8-300">Leave batched store access enabled.</span></span> <span data-ttu-id="4cad8-301">Detta minskar hello allmänna belastningen på hello entitet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-301">This reduces hello overall load of hello entity.</span></span> <span data-ttu-id="4cad8-302">Det minskar också hello övergripande hastighet med vilken meddelanden kan skrivas till hello kö eller ett ämne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-302">It also reduces hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="4cad8-303">Ange hello prefetch antal tooa lågt värde (till exempel PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="4cad8-303">Set hello prefetch count tooa small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="4cad8-304">Detta förhindrar att mottagarna inaktivitet medan andra mottagare har stora mängder meddelanden som cachelagras.</span><span class="sxs-lookup"><span data-stu-id="4cad8-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="4cad8-305">Avsnittet med ett litet antal prenumerationer</span><span class="sxs-lookup"><span data-stu-id="4cad8-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="4cad8-306">Mål: Maximera hello genomflödet i ett ämne med ett litet antal prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-306">Goal: Maximize hello throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="4cad8-307">Ett meddelande tas emot av många prenumerationer, vilket innebär att hello kombineras får frekvens över alla prenumerationer som är större än hello överföringshastighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-307">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is larger than hello send rate.</span></span> <span data-ttu-id="4cad8-308">hello antal avsändare är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-308">hello number of senders is small.</span></span> <span data-ttu-id="4cad8-309">hello antal mottagare per prenumeration är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-309">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="4cad8-310">toomaximize genomströmning hello följande:</span><span class="sxs-lookup"><span data-stu-id="4cad8-310">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="4cad8-311">Använd en partitionerad avsnittet för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="4cad8-312">tooincrease hello övergripande överföringskö till hello ämne kan använda flera fabriker toocreate avsändare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-312">tooincrease hello overall send rate into hello topic, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="4cad8-313">Använd asynkrona åtgärder eller flera trådar för varje avsändare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="4cad8-314">tooincrease hello övergripande mottagningshastighet från en prenumeration kan använda flera meddelandet fabriker toocreate mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-314">tooincrease hello overall receive rate from a subscription, use multiple message factories toocreate receivers.</span></span> <span data-ttu-id="4cad8-315">Använda asynkrona åtgärder eller flera trådar för varje mottagare.</span><span class="sxs-lookup"><span data-stu-id="4cad8-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="4cad8-316">Använd asynkrona åtgärder tootake nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-316">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="4cad8-317">Använd hello standard batchbearbetning intervall 20ms tooreduce hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-317">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="4cad8-318">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="4cad8-318">Leave batched store access enabled.</span></span> <span data-ttu-id="4cad8-319">Detta ökar hello övergripande hastighet som meddelanden kan skrivas till hello ämne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-319">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="4cad8-320">Ange hello prefetch antal too20 tider hello maximala hastighetsprestanda av alla mottagare av ett fabriken.</span><span class="sxs-lookup"><span data-stu-id="4cad8-320">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="4cad8-321">Detta minskar hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-321">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="4cad8-322">Avsnittet med ett stort antal prenumerationer</span><span class="sxs-lookup"><span data-stu-id="4cad8-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="4cad8-323">Mål: Maximera hello genomflödet i ett ämne med ett stort antal prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-323">Goal: Maximize hello throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="4cad8-324">Ett meddelande tas emot av många prenumerationer, vilket innebär att hello kombineras får frekvens över alla prenumerationer är mycket större än hello överföringshastighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-324">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is much larger than hello send rate.</span></span> <span data-ttu-id="4cad8-325">hello antal avsändare är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-325">hello number of senders is small.</span></span> <span data-ttu-id="4cad8-326">hello antal mottagare per prenumeration är liten.</span><span class="sxs-lookup"><span data-stu-id="4cad8-326">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="4cad8-327">Avsnitt med ett stort antal prenumerationer exponera en låg totala genomflödet vanligtvis om alla meddelanden dirigeras tooall prenumerationer.</span><span class="sxs-lookup"><span data-stu-id="4cad8-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed tooall subscriptions.</span></span> <span data-ttu-id="4cad8-328">Detta beror på hello faktum att varje meddelande tas emot många gånger, och alla meddelanden som finns i ett ämne och alla dess prenumerationer lagras i hello lagra samma.</span><span class="sxs-lookup"><span data-stu-id="4cad8-328">This is caused by hello fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in hello same store.</span></span> <span data-ttu-id="4cad8-329">Det förutsätts att hello antalet avsändare och mottagare per prenumeration antal är litet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-329">It is assumed that hello number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="4cad8-330">Service Bus stöder upp too2 000 prenumerationer per avsnitt.</span><span class="sxs-lookup"><span data-stu-id="4cad8-330">Service Bus supports up too2,000 subscriptions per topic.</span></span>

<span data-ttu-id="4cad8-331">toomaximize genomströmning hello följande:</span><span class="sxs-lookup"><span data-stu-id="4cad8-331">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="4cad8-332">Använd en partitionerad avsnittet för bättre prestanda och tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="4cad8-333">Använd asynkrona åtgärder tootake nytta av klientsidan batchbearbetning.</span><span class="sxs-lookup"><span data-stu-id="4cad8-333">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="4cad8-334">Använd hello standard batchbearbetning intervall 20ms tooreduce hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-334">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="4cad8-335">Lämna gruppbaserad store-åtkomst aktiverat.</span><span class="sxs-lookup"><span data-stu-id="4cad8-335">Leave batched store access enabled.</span></span> <span data-ttu-id="4cad8-336">Detta ökar hello övergripande hastighet som meddelanden kan skrivas till hello ämne.</span><span class="sxs-lookup"><span data-stu-id="4cad8-336">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="4cad8-337">Ange hello prefetch antal too20 tider hello förväntas ta emot frekvens i sekunder.</span><span class="sxs-lookup"><span data-stu-id="4cad8-337">Set hello prefetch count too20 times hello expected receive rate in seconds.</span></span> <span data-ttu-id="4cad8-338">Detta minskar hello antalet överföringar för Service Bus-klient-protokollet.</span><span class="sxs-lookup"><span data-stu-id="4cad8-338">This reduces hello number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4cad8-339">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="4cad8-339">Next steps</span></span>
<span data-ttu-id="4cad8-340">toolearn mer information om hur du optimerar prestanda för Service Bus finns [partitionerade meddelandeentiteter][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="4cad8-340">toolearn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing
