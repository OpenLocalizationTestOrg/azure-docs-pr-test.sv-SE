---
title: "Min första PowerShell Workflow-runbook i Azure Automation | Microsoft Docs"
description: "Självstudiekurs som steg för steg beskriver hur du skapar, testar och publicerar en enkel text-runbook med hjälp av PowerShell Workflow."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
keywords: "powershell-arbetsflöde, powershell-arbetsflödesexempel, arbetsflöde powershell"
ms.assetid: 0002d7f7-e2b5-46e3-b5eb-4596b84fd526
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/26/2017
ms.author: magoedte;bwren
ms.openlocfilehash: 739f7c0fe0cca03d80fa8b4bdadbf93b5da72a73
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/11/2017
---
# <a name="my-first-powershell-workflow-runbook"></a><span data-ttu-id="8c63b-104">Min första PowerShell Workflow-runbook</span><span class="sxs-lookup"><span data-stu-id="8c63b-104">My first PowerShell Workflow runbook</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="8c63b-105">Grafisk</span><span class="sxs-lookup"><span data-stu-id="8c63b-105">Graphical</span></span>](automation-first-runbook-graphical.md)
> * [<span data-ttu-id="8c63b-106">PowerShell</span><span class="sxs-lookup"><span data-stu-id="8c63b-106">PowerShell</span></span>](automation-first-runbook-textual-powershell.md)
> * [<span data-ttu-id="8c63b-107">PowerShell-arbetsflöde</span><span class="sxs-lookup"><span data-stu-id="8c63b-107">PowerShell Workflow</span></span>](automation-first-runbook-textual.md)
> 
> 

<span data-ttu-id="8c63b-108">Den här självstudien beskriver steg för steg hur du skapar en [PowerShell Workflow-runbook](automation-runbook-types.md#powershell-workflow-runbooks) i Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="8c63b-108">This tutorial walks you through the creation of a [PowerShell Workflow runbook](automation-runbook-types.md#powershell-workflow-runbooks) in Azure Automation.</span></span> <span data-ttu-id="8c63b-109">Vi börjar med en enkel runbook som vi testar och publicerar medan vi förklarar hur du spårar statusen för runbook-jobbet.</span><span class="sxs-lookup"><span data-stu-id="8c63b-109">We start with a simple runbook that we test and publish while explaining how to track the status of the runbook job.</span></span> <span data-ttu-id="8c63b-110">Sedan ändrar vi vår runbook så att den hanterar Azure-resurser, i vårt exempel ska den starta en virtuell dator i Azure.</span><span class="sxs-lookup"><span data-stu-id="8c63b-110">Then we modify the runbook to actually manage Azure resources, in this case starting an Azure virtual machine.</span></span> <span data-ttu-id="8c63b-111">Slutligen ska vi göra runbooken mer robust genom att lägga till runbook-parametrar.</span><span class="sxs-lookup"><span data-stu-id="8c63b-111">Lastly we make the runbook more robust by adding runbook parameters.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8c63b-112">Krav</span><span class="sxs-lookup"><span data-stu-id="8c63b-112">Prerequisites</span></span>
<span data-ttu-id="8c63b-113">För att kunna genomföra den här kursen behöver du följande:</span><span class="sxs-lookup"><span data-stu-id="8c63b-113">To complete this tutorial, you will need the following:</span></span>

* <span data-ttu-id="8c63b-114">En Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="8c63b-114">Azure subscription.</span></span> <span data-ttu-id="8c63b-115">Om du inte redan har ett konto kan du [aktivera dina MSDN-prenumerantförmåner](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) eller <a href="/pricing/free-account/" target="_blank">[registrera dig för ett kostnadsfritt konto](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="8c63b-115">If you don't have one yet, you can [activate your MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) or <a href="/pricing/free-account/" target="_blank">[sign up for a free account](https://azure.microsoft.com/free/).</span></span>
* <span data-ttu-id="8c63b-116">Ett [Automation-konto för Azure](automation-sec-configure-azure-runas-account.md) som runbooken ska ligga under och som ska användas för autentisering mot Azure-resurser.</span><span class="sxs-lookup"><span data-stu-id="8c63b-116">[Automation account](automation-sec-configure-azure-runas-account.md) to hold the runbook and authenticate to Azure resources.</span></span>  <span data-ttu-id="8c63b-117">Det här kontot måste ha behörighet att starta och stoppa den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="8c63b-117">This account must have permission to start and stop the virtual machine.</span></span>
* <span data-ttu-id="8c63b-118">En virtuell dator i Azure.</span><span class="sxs-lookup"><span data-stu-id="8c63b-118">An Azure virtual machine.</span></span> <span data-ttu-id="8c63b-119">Eftersom vi ska stoppa och starta den här datorn bör det inte vara en virtuell dator som finns i produktionsmiljön.</span><span class="sxs-lookup"><span data-stu-id="8c63b-119">We stop and start this machine so it should not be a production VM.</span></span>

## <a name="step-1---create-new-runbook"></a><span data-ttu-id="8c63b-120">Steg 1 – Skapa en ny runbook</span><span class="sxs-lookup"><span data-stu-id="8c63b-120">Step 1 - Create new runbook</span></span>
<span data-ttu-id="8c63b-121">Vi börjar genom att skapa en enkel runbook som visar texten *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="8c63b-121">We'll start by creating a simple runbook that outputs the text *Hello World*.</span></span>

1. <span data-ttu-id="8c63b-122">Öppna ditt Automation-konto på Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="8c63b-122">In the Azure portal, open your Automation account.</span></span>  
   <span data-ttu-id="8c63b-123">Automation-kontosidan innehåller en snabb översikt över resurserna i det här kontot.</span><span class="sxs-lookup"><span data-stu-id="8c63b-123">The Automation account page gives you a quick view of the resources in this account.</span></span> <span data-ttu-id="8c63b-124">Du bör redan ha vissa tillgångar.</span><span class="sxs-lookup"><span data-stu-id="8c63b-124">You should already have some assets.</span></span> <span data-ttu-id="8c63b-125">De flesta av dessa är de moduler som ingår automatiskt i ett nytt Automation-konto.</span><span class="sxs-lookup"><span data-stu-id="8c63b-125">Most of those are the modules that are automatically included in a new Automation account.</span></span> <span data-ttu-id="8c63b-126">Du behöver även autentiseringstillgången som nämns i [kravavsnittet](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="8c63b-126">You should also have the Credential asset that's mentioned in the [prerequisites](#prerequisites).</span></span>
2. <span data-ttu-id="8c63b-127">Öppna listan med runbooks genom att klicka på panelen **Runbooks**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-127">Click on the **Runbooks** tile to open the list of runbooks.</span></span><br><br> <span data-ttu-id="8c63b-128">![Runbook-kontroll](media/automation-first-runbook-textual/runbooks-control-tiles.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-128">![Runbooks control](media/automation-first-runbook-textual/runbooks-control-tiles.png)</span></span>
3. <span data-ttu-id="8c63b-129">Skapa en ny runbook genom att klicka på knappen **Lägg till en runbook** och sedan på **Skapa en ny runbook**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-129">Create a new runbook by clicking on the **Add a runbook** button and then **Create a new runbook**.</span></span>
4. <span data-ttu-id="8c63b-130">Ge runbooken namnet *MyFirstRunbook-Workflow*.</span><span class="sxs-lookup"><span data-stu-id="8c63b-130">Give the runbook the name *MyFirstRunbook-Workflow*.</span></span>
5. <span data-ttu-id="8c63b-131">Eftersom vi ska skapa en [PowerShell Workflow-runbook](automation-runbook-types.md#powershell-workflow-runbooks) väljer du **Powershell-arbetsflöde** för **Typ av runbook**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-131">In this case, we're going to create a [PowerShell Workflow runbook](automation-runbook-types.md#powershell-workflow-runbooks) so select **Powershell Workflow** for **Runbook type**.</span></span><br><br> <span data-ttu-id="8c63b-132">![Ny runbook](media/automation-first-runbook-textual/new-runbook-properties.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-132">![New runbook](media/automation-first-runbook-textual/new-runbook-properties.png)</span></span>
6. <span data-ttu-id="8c63b-133">Klicka på **Skapa** för att skapa runbooken och öppna textredigeraren.</span><span class="sxs-lookup"><span data-stu-id="8c63b-133">Click **Create** to create the runbook and open the textual editor.</span></span>

## <a name="step-2---add-code-to-the-runbook"></a><span data-ttu-id="8c63b-134">Steg 2 – Lägga till kod i runbooken</span><span class="sxs-lookup"><span data-stu-id="8c63b-134">Step 2 - Add code to the runbook</span></span>
<span data-ttu-id="8c63b-135">Du kan antingen skriva kod direkt i runbooken eller välja cmdlets, runbooks och resurser från bibliotekskontrollen och lägga till dem i runbooken med eventuella relaterade parametrar.</span><span class="sxs-lookup"><span data-stu-id="8c63b-135">You can either type code directly into the runbook, or you can select cmdlets, runbooks, and assets from the Library control and have them added to the runbook with any related parameters.</span></span> <span data-ttu-id="8c63b-136">I den här genomgången ska vi skriva koden direkt i runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-136">For this walkthrough, we'll type directly into the runbook.</span></span>

1. <span data-ttu-id="8c63b-137">Vår runbook är tom så när som på det obligatoriska *workflow*-nyckelordet, namnet på runbooken och klammerparenteserna som ska omge hela arbetsflödet.</span><span class="sxs-lookup"><span data-stu-id="8c63b-137">Our runbook is currently empty with only the required *workflow* keyword, the name of our runbook, and the braces that will encase the entire workflow.</span></span>

   ```
   Workflow MyFirstRunbook-Workflow
   {
   }
   ```
2. <span data-ttu-id="8c63b-138">Skriv *Write-Output "Hello World."*</span><span class="sxs-lookup"><span data-stu-id="8c63b-138">Type *Write-Output "Hello World."*</span></span> <span data-ttu-id="8c63b-139">mellan klammerparenteserna.</span><span class="sxs-lookup"><span data-stu-id="8c63b-139">between the braces.</span></span>

   ```
   Workflow MyFirstRunbook-Workflow
   {
   Write-Output "Hello World"
   }
   ```
3. <span data-ttu-id="8c63b-140">Spara runbooken genom att klicka på **Spara**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-140">Save the runbook by clicking **Save**.</span></span><br><br> <span data-ttu-id="8c63b-141">![Spara runbook](media/automation-first-runbook-textual/automation-runbook-edit-controls-save.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-141">![Save runbook](media/automation-first-runbook-textual/automation-runbook-edit-controls-save.png)</span></span>

## <a name="step-3---test-the-runbook"></a><span data-ttu-id="8c63b-142">Steg 3 – Testa runbooken</span><span class="sxs-lookup"><span data-stu-id="8c63b-142">Step 3 - Test the runbook</span></span>
<span data-ttu-id="8c63b-143">Innan vi publicerar runbooken så att den blir tillgänglig i produktionsmiljön vill vi testa den och kontrollera att den fungerar som den ska.</span><span class="sxs-lookup"><span data-stu-id="8c63b-143">Before we publish the runbook to make it available in production, we want to test it to make sure that it works properly.</span></span> <span data-ttu-id="8c63b-144">När du testar en runbook kör du dess **utkastversion** och visar dess utdata interaktivt.</span><span class="sxs-lookup"><span data-stu-id="8c63b-144">When you test a runbook, you run its **Draft** version and view its output interactively.</span></span>

1. <span data-ttu-id="8c63b-145">Öppna testfönstret genom att klicka på **Testfönster**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-145">Click **Test pane** to open the Test pane.</span></span><br><br> <span data-ttu-id="8c63b-146">![Testfönster](media/automation-first-runbook-textual/automation-runbook-edit-controls-test.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-146">![Test pane](media/automation-first-runbook-textual/automation-runbook-edit-controls-test.png)</span></span>
2. <span data-ttu-id="8c63b-147">Starta testet genom att klicka på **Starta**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-147">Click **Start** to start the test.</span></span> <span data-ttu-id="8c63b-148">Detta bör vara det enda aktiverade alternativet.</span><span class="sxs-lookup"><span data-stu-id="8c63b-148">This should be the only enabled option.</span></span>
3. <span data-ttu-id="8c63b-149">Ett [runbook-jobb](automation-runbook-execution.md) skapas och dess status visas.</span><span class="sxs-lookup"><span data-stu-id="8c63b-149">A [runbook job](automation-runbook-execution.md) is created and its status displayed.</span></span>  
   <span data-ttu-id="8c63b-150">Jobbets första status är *I kö* vilket betyder att det väntar på att en Runbook Worker i molnet ska bli tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="8c63b-150">The job status will start as *Queued* indicating that it is waiting for a runbook worker in the cloud to come available.</span></span> <span data-ttu-id="8c63b-151">Därefter ändras statusen till *Startar* när en Runbook Worker gör anspråk på jobbet, och sedan till *Körs* när runbook-jobbet börjar köras.</span><span class="sxs-lookup"><span data-stu-id="8c63b-151">It will then move to *Starting* when a worker claims the job, and then *Running* when the runbook actually starts running.</span></span>  
4. <span data-ttu-id="8c63b-152">När runbook-jobbet är klart visas dess utdata.</span><span class="sxs-lookup"><span data-stu-id="8c63b-152">When the runbook job completes, its output is displayed.</span></span> <span data-ttu-id="8c63b-153">I detta fall bör du se *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="8c63b-153">In our case, we should see *Hello World*.</span></span><br><br> <span data-ttu-id="8c63b-154">![Hello World](media/automation-first-runbook-textual/test-output-hello-world.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-154">![Hello World](media/automation-first-runbook-textual/test-output-hello-world.png)</span></span>
5. <span data-ttu-id="8c63b-155">Gå tillbaka till arbetsytan genom att stänga testfönstret.</span><span class="sxs-lookup"><span data-stu-id="8c63b-155">Close the Test pane to return to the canvas.</span></span>

## <a name="step-4---publish-and-start-the-runbook"></a><span data-ttu-id="8c63b-156">Steg 4 – Publicera och starta runbooken</span><span class="sxs-lookup"><span data-stu-id="8c63b-156">Step 4 - Publish and start the runbook</span></span>
<span data-ttu-id="8c63b-157">Den runbook som vi precis har skapat är fortfarande i utkastläge.</span><span class="sxs-lookup"><span data-stu-id="8c63b-157">The runbook that we just created is still in Draft mode.</span></span> <span data-ttu-id="8c63b-158">Vi måste publicera den innan vi kan köra den i produktion.</span><span class="sxs-lookup"><span data-stu-id="8c63b-158">We need to publish it before we can run it in production.</span></span> <span data-ttu-id="8c63b-159">När du publicerar en runbook skriver du över den befintliga publicerade versionen med utkastversionen.</span><span class="sxs-lookup"><span data-stu-id="8c63b-159">When you publish a runbook, you overwrite the existing Published version with the Draft version.</span></span> <span data-ttu-id="8c63b-160">I vårt fall har vi ingen publicerad version än eftersom vi precis har skapat runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-160">In our case, we don't have a Published version yet because we just created the runbook.</span></span>

1. <span data-ttu-id="8c63b-161">Klicka på **Publicera** för att publicera runbooken och sedan på **Ja** när du uppmanas att göra det.</span><span class="sxs-lookup"><span data-stu-id="8c63b-161">Click **Publish** to publish the runbook and then **Yes** when prompted.</span></span><br><br> <span data-ttu-id="8c63b-162">![Publicera](media/automation-first-runbook-textual/automation-runbook-edit-controls-publish.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-162">![Publish](media/automation-first-runbook-textual/automation-runbook-edit-controls-publish.png)</span></span>
2. <span data-ttu-id="8c63b-163">Om du rullar åt vänster för att visa runbooken i fönstret **Runbooks** visas den nu med **redigeringsstatusen** **Publicerad**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-163">If you scroll left to view the runbook in the **Runbooks** pane now, it will show an **Authoring Status** of **Published**.</span></span>
3. <span data-ttu-id="8c63b-164">Bläddra tillbaka åt höger för att visa fönstret för **MyFirstRunbook-Workflow**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-164">Scroll back to the right to view the pane for **MyFirstRunbook-Workflow**.</span></span>  
   <span data-ttu-id="8c63b-165">Vi kan använda alternativen längs överkanten för att starta runbooken, schemalägga den så att den startar senare eller skapa en [webhook](automation-webhooks.md) så att den kan startas via ett HTTP-anrop.</span><span class="sxs-lookup"><span data-stu-id="8c63b-165">The options across the top allow us to start the runbook, schedule it to start at some time in the future, or create a [webhook](automation-webhooks.md) so it can be started through an HTTP call.</span></span>
4. <span data-ttu-id="8c63b-166">Eftersom vi bara vill starta runbooken klickar du på **Starta** och sedan på **Ja** när du uppmanas att göra det.</span><span class="sxs-lookup"><span data-stu-id="8c63b-166">We just want to start the runbook so click **Start** and then **Yes** when prompted.</span></span><br><br> <span data-ttu-id="8c63b-167">![Starta runbook](media/automation-first-runbook-textual/automation-runbook-controls-start.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-167">![Start runbook](media/automation-first-runbook-textual/automation-runbook-controls-start.png)</span></span>
5. <span data-ttu-id="8c63b-168">Ett jobbfönster öppnas för runbook-jobbet som vi precis skapade.</span><span class="sxs-lookup"><span data-stu-id="8c63b-168">A job pane is opened for the runbook job that we just created.</span></span> <span data-ttu-id="8c63b-169">Vi kan stänga det här fönstret, men ska i stället lämna det öppna så att vi kan titta på jobbets status.</span><span class="sxs-lookup"><span data-stu-id="8c63b-169">We can close this pane, but in this case we'll leave it open so we can watch the job's progress.</span></span>
6. <span data-ttu-id="8c63b-170">Jobbets status visas i **Jobbsammanfattning** och överensstämmer med de statusar som vi såg när vi testade runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-170">The job status is shown in **Job Summary** and matches the statuses that we saw when we tested the runbook.</span></span><br><br> <span data-ttu-id="8c63b-171">![Jobbsammanfattning](media/automation-first-runbook-textual/job-pane-status-blade-jobsummary.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-171">![Job Summary](media/automation-first-runbook-textual/job-pane-status-blade-jobsummary.png)</span></span>
7. <span data-ttu-id="8c63b-172">När runbookens status visas som *Slutförd* klickar du på **Utdata**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-172">Once the runbook status shows *Completed*, click **Output**.</span></span> <span data-ttu-id="8c63b-173">Fönstret Utdata öppnas och *Hello World* visas.</span><span class="sxs-lookup"><span data-stu-id="8c63b-173">The Output pane is opened, and we can see our *Hello World*.</span></span><br><br> <span data-ttu-id="8c63b-174">![Jobbsammanfattning](media/automation-first-runbook-textual/job-pane-status-blade-outputtile.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-174">![Job Summary](media/automation-first-runbook-textual/job-pane-status-blade-outputtile.png)</span></span>  
8. <span data-ttu-id="8c63b-175">Stäng utdatafönstret.</span><span class="sxs-lookup"><span data-stu-id="8c63b-175">Close the Output pane.</span></span>
9. <span data-ttu-id="8c63b-176">Klicka på **Alla loggar** för att öppna fönstret Strömmar för runbook-jobbet.</span><span class="sxs-lookup"><span data-stu-id="8c63b-176">Click **All Logs** to open the Streams pane for the runbook job.</span></span> <span data-ttu-id="8c63b-177">Vi bör endast se *Hello World* i utdataströmmen, men även andra dataströmmar kan visas för ett runbook-jobb, till exempel Utförlig och Fel, om runbooken skriver till dem.</span><span class="sxs-lookup"><span data-stu-id="8c63b-177">We should only see *Hello World* in the output stream, but this can show other streams for a runbook job such as Verbose and Error if the runbook writes to them.</span></span><br><br> <span data-ttu-id="8c63b-178">![Jobbsammanfattning](media/automation-first-runbook-textual/job-pane-status-blade-alllogstile.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-178">![Job Summary](media/automation-first-runbook-textual/job-pane-status-blade-alllogstile.png)</span></span>
10. <span data-ttu-id="8c63b-179">Stäng fönstret Strömmar och fönstret Jobb för att återgå till fönstret MyFirstRunbook.</span><span class="sxs-lookup"><span data-stu-id="8c63b-179">Close the Streams pane and the Job pane to return to the MyFirstRunbook pane.</span></span>
11. <span data-ttu-id="8c63b-180">Öppna fönstret Jobb för runbooken genom att klicka på **Jobb**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-180">Click **Jobs** to open the Jobs pane for this runbook.</span></span> <span data-ttu-id="8c63b-181">Här visas alla jobb som skapats av den här runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-181">This lists all of the jobs created by this runbook.</span></span> <span data-ttu-id="8c63b-182">Vi bör endast se ett jobb i listan eftersom vi bara körde jobbet en gång.</span><span class="sxs-lookup"><span data-stu-id="8c63b-182">We should only see one job listed since we only ran the job once.</span></span><br><br> <span data-ttu-id="8c63b-183">![Jobb](media/automation-first-runbook-textual/runbook-control-job-tile.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-183">![Jobs](media/automation-first-runbook-textual/runbook-control-job-tile.png)</span></span>
12. <span data-ttu-id="8c63b-184">Du kan klicka på det här jobbet för att öppna samma jobbfönster som vi visade när vi startade runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-184">You can click on this job to open the same Job pane that we viewed when we started the runbook.</span></span> <span data-ttu-id="8c63b-185">På så sätt kan du gå tillbaka i tiden och visa information om alla jobb som har skapats för en specifik runbook.</span><span class="sxs-lookup"><span data-stu-id="8c63b-185">This allows you to go back in time and view the details of any job that was created for a particular runbook.</span></span>

## <a name="step-5---add-authentication-to-manage-azure-resources"></a><span data-ttu-id="8c63b-186">Steg 5 – Lägga till autentisering för att hantera Azure-resurser</span><span class="sxs-lookup"><span data-stu-id="8c63b-186">Step 5 - Add authentication to manage Azure resources</span></span>
<span data-ttu-id="8c63b-187">Vi har testat och publicerat vår runbook, men hittills gör den egentligen inget användbart.</span><span class="sxs-lookup"><span data-stu-id="8c63b-187">We've tested and published our runbook, but so far it doesn't do anything useful.</span></span> <span data-ttu-id="8c63b-188">Vi vill att den ska hantera Azure-resurser.</span><span class="sxs-lookup"><span data-stu-id="8c63b-188">We want to have it manage Azure resources.</span></span> <span data-ttu-id="8c63b-189">Dock kan den inte göra det såvida vi inte konfigurerar den att autentisera med hjälp av autentiseringsuppgifterna som avses i [kravavsnittet](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="8c63b-189">It won't be able to do that though unless we have it authenticate using the credentials that are referred to in the [prerequisites](#prerequisites).</span></span> <span data-ttu-id="8c63b-190">Vi gör det med cmdleten **Add-AzureAccount**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-190">We do that with the **Add-AzureRMAccount** cmdlet.</span></span>

1. <span data-ttu-id="8c63b-191">Öppna textredigeraren genom att klicka på **Redigera** i fönstret MyFirstRunbook-Workflow.</span><span class="sxs-lookup"><span data-stu-id="8c63b-191">Open the textual editor by clicking **Edit** on the MyFirstRunbook-Workflow pane.</span></span><br><br> <span data-ttu-id="8c63b-192">![Redigera runbook](media/automation-first-runbook-textual/automation-runbook-controls-edit.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-192">![Edit runbook](media/automation-first-runbook-textual/automation-runbook-controls-edit.png)</span></span>
2. <span data-ttu-id="8c63b-193">Eftersom vi inte behöver raden **Write-Output** längre kan du ta bort den.</span><span class="sxs-lookup"><span data-stu-id="8c63b-193">We don't need the **Write-Output** line anymore, so go ahead and delete it.</span></span>
3. <span data-ttu-id="8c63b-194">Placera markören på en tom rad mellan klammerparenteserna.</span><span class="sxs-lookup"><span data-stu-id="8c63b-194">Position the cursor on a blank line between the braces.</span></span>
4. <span data-ttu-id="8c63b-195">Skriv eller kopiera och klistra in följande kod som hanterar autentiseringen med ditt ”Kör som”-konto för Automation:</span><span class="sxs-lookup"><span data-stu-id="8c63b-195">Type or copy and paste the following code that will handle the authentication with your Automation Run As account:</span></span>

   ```
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   ```
5. <span data-ttu-id="8c63b-196">Klicka på **Testfönster** så att vi kan testa runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-196">Click **Test pane** so that we can test the runbook.</span></span>
6. <span data-ttu-id="8c63b-197">Starta testet genom att klicka på **Starta**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-197">Click **Start** to start the test.</span></span> <span data-ttu-id="8c63b-198">När testet är klart visas utdata som liknar de nedan, med grundläggande information från ditt konto.</span><span class="sxs-lookup"><span data-stu-id="8c63b-198">Once it completes, you should receive output similar to the following, displaying basic information from your account.</span></span> <span data-ttu-id="8c63b-199">Detta bekräftar att autentiseringsuppgifterna är giltiga.</span><span class="sxs-lookup"><span data-stu-id="8c63b-199">This confirms that the credential is valid.</span></span><br><br> <span data-ttu-id="8c63b-200">![Autentisera](media/automation-first-runbook-textual/runbook-auth-output.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-200">![Authenticate](media/automation-first-runbook-textual/runbook-auth-output.png)</span></span>

## <a name="step-6---add-code-to-start-a-virtual-machine"></a><span data-ttu-id="8c63b-201">Steg 6 – Lägga till kod för att starta en virtuell dator</span><span class="sxs-lookup"><span data-stu-id="8c63b-201">Step 6 - Add code to start a virtual machine</span></span>
<span data-ttu-id="8c63b-202">Nu när våra runbook autentiseras med vår Azure-prenumeration kan vi hantera resurser.</span><span class="sxs-lookup"><span data-stu-id="8c63b-202">Now that our runbook is authenticating to our Azure subscription, we can manage resources.</span></span> <span data-ttu-id="8c63b-203">Vi ska lägga till ett kommando för att starta en virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="8c63b-203">We add a command to start a virtual machine.</span></span> <span data-ttu-id="8c63b-204">Du kan välja en virtuell dator i din Azure-prenumeration. Här kommer vi att hårdkoda namnet i runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-204">You can pick any virtual machine in your Azure subscription, and for now we will be hardcoding that name in the runbook.</span></span>

1. <span data-ttu-id="8c63b-205">Efter *Add-AzureRmAccount* skriver du *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'* och anger namnet och resursgruppsnamnet för den virtuella dator som ska starta.</span><span class="sxs-lookup"><span data-stu-id="8c63b-205">After *Add-AzureRmAccount*, type *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'* providing the name and Resource Group name of the virtual machine to start.</span></span>  

   ```
   workflow MyFirstRunbook-Workflow
   {
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'ResourceGroupName'
   }
   ```
2. <span data-ttu-id="8c63b-206">Spara runbooken och klicka sedan på **Testfönster** så att vi kan testa den.</span><span class="sxs-lookup"><span data-stu-id="8c63b-206">Save the runbook and then click **Test pane** so that we can test it.</span></span>
3. <span data-ttu-id="8c63b-207">Starta testet genom att klicka på **Starta**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-207">Click **Start** to start the test.</span></span> <span data-ttu-id="8c63b-208">När testet är klart kontrollerar du att den virtuella datorn har startat.</span><span class="sxs-lookup"><span data-stu-id="8c63b-208">Once it completes, check that the virtual machine was started.</span></span>

## <a name="step-7---add-an-input-parameter-to-the-runbook"></a><span data-ttu-id="8c63b-209">Steg 7 – Lägga till en indataparameter i runbooken</span><span class="sxs-lookup"><span data-stu-id="8c63b-209">Step 7 - Add an input parameter to the runbook</span></span>
<span data-ttu-id="8c63b-210">Vår runbook startar för närvarande den virtuella datorn som vi hårdkodade i runbooken, men den skulle vara mer användbar om vi kunde ange den virtuella datorn när runbooken startar.</span><span class="sxs-lookup"><span data-stu-id="8c63b-210">Our runbook currently starts the virtual machine that we hardcoded in the runbook, but it would be more useful if we could specify the virtual machine when the runbook is started.</span></span> <span data-ttu-id="8c63b-211">Nu ska vi lägga till indataparametrar för runbooken för att implementera den funktionen.</span><span class="sxs-lookup"><span data-stu-id="8c63b-211">We will now add input parameters to the runbook to provide that functionality.</span></span>

1. <span data-ttu-id="8c63b-212">Lägg till parametrar för *VMName* och *ResourceGroupName* i runbooken och använd dessa variabler med cmdleten **Start-AzureRmVM** som i exemplet nedan.</span><span class="sxs-lookup"><span data-stu-id="8c63b-212">Add parameters for *VMName* and *ResourceGroupName* to the runbook and use these variables with the **Start-AzureRmVM** cmdlet as in the example below.</span></span>

   ```
   workflow MyFirstRunbook-Workflow
   {
    Param(
     [string]$VMName,
     [string]$ResourceGroupName
    )  
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name $VMName -ResourceGroupName $ResourceGroupName
   }
   ```
2. <span data-ttu-id="8c63b-213">Spara runbooken och öppna Testfönster.</span><span class="sxs-lookup"><span data-stu-id="8c63b-213">Save the runbook and open the Test pane.</span></span> <span data-ttu-id="8c63b-214">Observera att du nu kan ange värden för de två indatavariablerna som ska användas i testet.</span><span class="sxs-lookup"><span data-stu-id="8c63b-214">Note that you can now provide values for the two input variables that will be used in the test.</span></span>
3. <span data-ttu-id="8c63b-215">Stäng Testfönster.</span><span class="sxs-lookup"><span data-stu-id="8c63b-215">Close the Test pane.</span></span>
4. <span data-ttu-id="8c63b-216">Klicka på **Publicera** för att publicera den nya versionen av runbooken.</span><span class="sxs-lookup"><span data-stu-id="8c63b-216">Click **Publish** to publish the new version of the runbook.</span></span>
5. <span data-ttu-id="8c63b-217">Stoppa den virtuella dator som du startade i föregående steg.</span><span class="sxs-lookup"><span data-stu-id="8c63b-217">Stop the virtual machine that you started in the previous step.</span></span>
6. <span data-ttu-id="8c63b-218">Starta runbooken genom att klicka på **Starta**.</span><span class="sxs-lookup"><span data-stu-id="8c63b-218">Click **Start** to start the runbook.</span></span> <span data-ttu-id="8c63b-219">Skriv **VMName** och **ResourceGroupName** för den virtuella datorn som du ska starta.</span><span class="sxs-lookup"><span data-stu-id="8c63b-219">Type in the **VMName** and **ResourceGroupName** for the virtual machine that you're going to start.</span></span><br><br> <span data-ttu-id="8c63b-220">![Starta runbook](media/automation-first-runbook-textual/automation-pass-params.png)</span><span class="sxs-lookup"><span data-stu-id="8c63b-220">![Start Runbook](media/automation-first-runbook-textual/automation-pass-params.png)</span></span><br>  
7. <span data-ttu-id="8c63b-221">När runbooken har slutförts kontrollerar du att den virtuella datorn har startat.</span><span class="sxs-lookup"><span data-stu-id="8c63b-221">When the runbook completes, check that the virtual machine was started.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="8c63b-222">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="8c63b-222">Next steps</span></span>
* <span data-ttu-id="8c63b-223">Information om hur du kommer igång med grafiska runbooks finns i [Min första grafisk runbook](automation-first-runbook-graphical.md)</span><span class="sxs-lookup"><span data-stu-id="8c63b-223">To get started with Graphical runbooks, see [My first graphical runbook](automation-first-runbook-graphical.md)</span></span>
* <span data-ttu-id="8c63b-224">Se hur du kommer igång med PowerShell-runbooks i [Min första PowerShell-runbook](automation-first-runbook-textual-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="8c63b-224">To get started with PowerShell runbooks, see [My first PowerShell runbook](automation-first-runbook-textual-powershell.md)</span></span>
* <span data-ttu-id="8c63b-225">Mer information om typer av runbooks, och om deras fördelar och begränsningar, finns i [Typer av Azure Automation-runbooks](automation-runbook-types.md)</span><span class="sxs-lookup"><span data-stu-id="8c63b-225">To learn more about runbook types, their advantages and limitations, see [Azure Automation runbook types](automation-runbook-types.md)</span></span>
* <span data-ttu-id="8c63b-226">Mer information om PowerShell-skriptstöd finns i [Inbyggt PowerShell-skriptstöd i Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span><span class="sxs-lookup"><span data-stu-id="8c63b-226">For more information on PowerShell script support feature, see [Native PowerShell script support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span></span>
