---
title: "aaaCalling en Azure Automation-Runbook från en Log Analytics avisering | Microsoft Docs"
description: "Den här artikeln innehåller en översikt över hur tooinvoke en Automation-runbook från en avisering om Microsoft OMS Log Analytics."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="88f97-103">Anropa en Azure Automation-runbook från en OMS Log Analytics-avisering</span><span class="sxs-lookup"><span data-stu-id="88f97-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="88f97-104">När en avisering har konfigurerats i logganalys toocreate misslyckas en avisering om resultat som matchar vissa villkor, till exempel en långvarig topp i antal processorbelastning eller ett visst program processen kritiska toohello funktionerna i ett affärsprogram-post och skriver en motsvarande händelse hello i händelseloggen i Windows, kan den här aviseringen automatiskt köra en Automation-runbook i ett försök tooauto-reparera hello problemet.</span><span class="sxs-lookup"><span data-stu-id="88f97-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="88f97-105">Det finns två alternativ toocall en runbook när du konfigurerar hello avisering.</span><span class="sxs-lookup"><span data-stu-id="88f97-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="88f97-106">Mer specifikt:</span><span class="sxs-lookup"><span data-stu-id="88f97-106">Specifically,</span></span>

1. <span data-ttu-id="88f97-107">med en webhook.</span><span class="sxs-lookup"><span data-stu-id="88f97-107">Using a Webhook.</span></span>
   * <span data-ttu-id="88f97-108">Detta är hello enda tillgängliga alternativet om din OMS-arbetsyta inte är länkade tooan Automation-konto.</span><span class="sxs-lookup"><span data-stu-id="88f97-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="88f97-109">Det här alternativet är fortfarande tillgänglig om du redan har en Automation konto länkade tooan OMS-arbetsyta.</span><span class="sxs-lookup"><span data-stu-id="88f97-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="88f97-110">Välj en runbook direkt.</span><span class="sxs-lookup"><span data-stu-id="88f97-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="88f97-111">Det här alternativet är tillgängligt endast när hello OMS-arbetsyta är länkade tooan Automation-konto.</span><span class="sxs-lookup"><span data-stu-id="88f97-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="88f97-112">Anropa en runbook med en webhook</span><span class="sxs-lookup"><span data-stu-id="88f97-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="88f97-113">En webhook kan du toostart en viss runbook i Azure Automation via en HTTP-begäran.</span><span class="sxs-lookup"><span data-stu-id="88f97-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="88f97-114">Innan du konfigurerar hello [logganalys avisering](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook med hjälp av en webhook som en åtgärd måste toofirst skapa en webhook för hello-runbook som anropas med den här metoden.</span><span class="sxs-lookup"><span data-stu-id="88f97-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="88f97-115">Granska och följ hello stegen i hello [skapa en webhook](automation-webhooks.md#creating-a-webhook) artikel och komma ihåg toorecord hello Webhooksadressen så att du kan referera till det när du konfigurerar hello varningsregel.</span><span class="sxs-lookup"><span data-stu-id="88f97-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="88f97-116">Anropa en runbook direkt</span><span class="sxs-lookup"><span data-stu-id="88f97-116">Calling a runbook directly</span></span>

<span data-ttu-id="88f97-117">Om du har hello Automation & kontroll erbjudande installeras och konfigureras i OMS-arbetsyta när du konfigurerar hello Runbook åtgärder alternativet för hello aviseringen, kan du visa alla runbooks från hello **Välj en runbook** listrutan välja hello viss runbook du vill toorun i svaret toohello avisering.</span><span class="sxs-lookup"><span data-stu-id="88f97-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="88f97-118">hello markerad runbook kan köras i en arbetsyta i hello Azure-molnet eller på en hybrid runbook worker.</span><span class="sxs-lookup"><span data-stu-id="88f97-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="88f97-119">När hello avisering har skapats med alternativet för hello runbook, skapas en webhook för hello runbook.</span><span class="sxs-lookup"><span data-stu-id="88f97-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="88f97-120">Du kan se hello webhook om du går toohello Automation-konto och navigera toohello webhook-bladet för hello markerad runbook.</span><span class="sxs-lookup"><span data-stu-id="88f97-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="88f97-121">Om du tar bort hello avisering hello webhook tas inte bort men hello användaren kan ta bort hello webhook manuellt.</span><span class="sxs-lookup"><span data-stu-id="88f97-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="88f97-122">Det är inte ett problem om hello webhook inte tas bort, det är bara ett överblivna objekt som behöver slutligen toobe bort i ordning toomaintain en ordnad Automation-konto.</span><span class="sxs-lookup"><span data-stu-id="88f97-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="88f97-123">Egenskaper för en runbook (för båda alternativen)</span><span class="sxs-lookup"><span data-stu-id="88f97-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="88f97-124">Båda metoderna för att anropa hello runbook från hello logganalys avisering har olika beteenden egenskaper som behöver förstå innan du konfigurerar din Varningsregler toobe.</span><span class="sxs-lookup"><span data-stu-id="88f97-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="88f97-125">Du måste ha en runbook-indataparameter med namnet **WebhookData** som är **objekttypen**.</span><span class="sxs-lookup"><span data-stu-id="88f97-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="88f97-126">Det kan vara obligatoriskt eller valfritt.</span><span class="sxs-lookup"><span data-stu-id="88f97-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="88f97-127">hello avisering skickar hello sökresultat toohello runbook med hjälp av denna indataparameter.</span><span class="sxs-lookup"><span data-stu-id="88f97-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="88f97-128">Du måste ha koden tooconvert hello WebhookData tooa PowerShell-objektet.</span><span class="sxs-lookup"><span data-stu-id="88f97-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="88f97-129">*$SearchResults* kommer att vara en matris med objekt; varje objekt innehåller hello fält med värden från en sökresultat</span><span class="sxs-lookup"><span data-stu-id="88f97-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="88f97-130">WebhookData inkonsekvenser mellan hello webhook och runbook</span><span class="sxs-lookup"><span data-stu-id="88f97-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="88f97-131">När du konfigurerar en varning toocall en Webhook måste ange en Webhooksadressen som du har skapat för en runbook och klicka på hello **Test Webhook** knappen.</span><span class="sxs-lookup"><span data-stu-id="88f97-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="88f97-132">hello resulterande WebhookData skickas toohello runbook inte innehåller någon *. SearchResult* eller *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="88f97-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="88f97-133">Om du sparar den här aviseringen när hello avisering utlöser och anropar hello webhooken WebhookData skickas toohello runbook hello innehåller *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="88f97-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="88f97-134">Om du skapar en avisering och konfigurera den toocall en runbook (som även skapar en webhook), när hello avisering utlösare skickar den WebhookData toohello runbook som innehåller *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="88f97-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="88f97-135">Därför i hello kodexempel ovan, behöver du tooget *. SearchResult* om hello avisering anropar en webhook och behöver tooget *. SearchResults* om hello avisering direkt anropar en runbook.</span><span class="sxs-lookup"><span data-stu-id="88f97-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="88f97-136">Exempelgenomgång</span><span class="sxs-lookup"><span data-stu-id="88f97-136">Example walkthrough</span></span>

<span data-ttu-id="88f97-137">Visar vi hur det fungerar med hjälp av hello följande exempel grafisk runbook, som startar en Windows-tjänst.</span><span class="sxs-lookup"><span data-stu-id="88f97-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Starta Windows-tjänsten grafisk Runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="88f97-139">Hej runbook har en indataparameter av typen **objekt** som kallas **WebhookData** samt hello webhook data som skickas från hello aviseringen som innehåller *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="88f97-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="88f97-140">![Indataparametrar för Runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="88f97-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="88f97-141">I det här exemplet i logganalys vi skapat två anpassade fält, *SvcDisplayName_CF* och *SvcState_CF*, tooextract hello tjänstens namn och hello visningsläget för hello service (d.v.s. igång eller stoppad) skrivs toohello systemhändelseloggen från hello-händelsen.</span><span class="sxs-lookup"><span data-stu-id="88f97-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="88f97-142">Vi sedan skapa en aviseringsregel med hello följande sökfråga: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` så att vi kan identifiera när hello Utskriftshanteraren har stoppats på hello Windows-system.</span><span class="sxs-lookup"><span data-stu-id="88f97-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="88f97-143">Det kan vara någon tjänst av intresse, men det här exemplet vi refererar till en befintlig hello-tjänster som ingår i hello Windows-Operativsystemet.</span><span class="sxs-lookup"><span data-stu-id="88f97-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="88f97-144">hello Aviseringsåtgärd är konfigurerade tooexecute våra runbook i detta exempel används och körs på hello Hybrid Runbook Worker som är aktiverade på hello målsystem.</span><span class="sxs-lookup"><span data-stu-id="88f97-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="88f97-145">Hej runbook-aktivitet som koden **hämta tjänstnamn från LA** hello JSON-formaterad sträng konverteras till en objekttyp och filtrera hello objektet *SvcDisplayName_CF* tooextract hello visningsnamn hello Windows-tjänst och skicka detta till hello nästa aktivitet som kontrollerar hello-tjänsten har stoppats innan du försöker toorestart den.</span><span class="sxs-lookup"><span data-stu-id="88f97-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="88f97-146">*SvcDisplayName_CF* är en [anpassat fält](../log-analytics/log-analytics-custom-fields.md) skapas i logganalys toodemonstrate det här exemplet.</span><span class="sxs-lookup"><span data-stu-id="88f97-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="88f97-147">När hello-tjänsten stoppar hello varningsregeln i logganalys identifierar en matchning och utlösa hello runbook och skicka hello aviseringskontext toohello runbook.</span><span class="sxs-lookup"><span data-stu-id="88f97-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="88f97-148">Hej runbook ska vidta åtgärder tooverify hello har stoppats och om så försök toorestart hello service och verifiera den startade korrekt och utdata hello resultatet.</span><span class="sxs-lookup"><span data-stu-id="88f97-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="88f97-149">Du kan också om du inte har din Automation konto länkade tooyour OMS-arbetsyta du skulle konfigurera hello varningsregeln med en webhook åtgärd tootrigger hello runbook och konfigurera hello runbook tooconvert hello JSON-formaterad sträng och filter på *. SearchResult* följande hello riktlinjer som tidigare nämnts.</span><span class="sxs-lookup"><span data-stu-id="88f97-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="88f97-150">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="88f97-150">Next steps</span></span>

* <span data-ttu-id="88f97-151">Mer om aviseringar i logganalys toolearn och hur toocreate, se [aviseringar i logganalys](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="88f97-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="88f97-152">hur tootrigger runbooks med en webhook Se toounderstand [Azure Automation webhooks](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="88f97-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
