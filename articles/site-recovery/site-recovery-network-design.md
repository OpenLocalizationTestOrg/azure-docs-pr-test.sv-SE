---
title: "Designa din nätverksinfrastruktur för katastrofåterställning | Microsoft Docs"
description: "Den här artikeln beskrivs nätverksdesign för Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: jwhit
editor: 
ms.assetid: ce787731-d930-4f00-a309-e2fbc2e1f53b
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/20/2017
ms.author: pratshar
ms.openlocfilehash: 90ffd3dd1cf5068359afa1b60892cdee43ec0658
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/03/2017
---
# <a name="designing-your-network-for-disaster-recovery"></a><span data-ttu-id="8208d-103">Utforma nätverket för katastrofåterställning</span><span class="sxs-lookup"><span data-stu-id="8208d-103">Designing your network for disaster recovery</span></span>

<span data-ttu-id="8208d-104">Den här artikeln omdirigeras till IT-tekniker som ansvarar för att bygga, implementera, och stöd för affärskontinuitet och disaster recovery (BCDR)-infrastruktur och som vill utnyttja Microsoft Azure Site Systemåterställning (ASR) för att stödja och förbättra deras BCDR-tjänster.</span><span class="sxs-lookup"><span data-stu-id="8208d-104">This article is directed to IT professionals who are responsible for architecting, implementing, and supporting business continuity and disaster recovery (BCDR) infrastructure, and who want to leverage Microsoft Azure Site Recovery (ASR) to support and enhance their BCDR services.</span></span> <span data-ttu-id="8208d-105">Den här artikeln beskrivs praktiska överväganden i strukturera nätverk på återställningsplatsen för katastrofåterställning, är det Azure eller en annan lokal plats.</span><span class="sxs-lookup"><span data-stu-id="8208d-105">This article discusses practical considerations in structuring network at disaster recovery site, be it Azure or another on-premises site.</span></span> 

## <a name="overview"></a><span data-ttu-id="8208d-106">Översikt</span><span class="sxs-lookup"><span data-stu-id="8208d-106">Overview</span></span>
<span data-ttu-id="8208d-107">[Azure Site Recovery (ASR)](https://azure.microsoft.com/services/site-recovery/) är en Microsoft Azure-tjänst som samordnar skydd och återställning av din virtualiserade program för affärsändamål kontinuitet disaster recovery (BCDR).</span><span class="sxs-lookup"><span data-stu-id="8208d-107">[Azure Site Recovery (ASR)](https://azure.microsoft.com/services/site-recovery/) is a Microsoft Azure service that orchestrates the protection and recovery of your virtualized applications for business continuity disaster recovery (BCDR) purposes.</span></span> <span data-ttu-id="8208d-108">Det här dokumentet är avsett att hjälpa läsaren genom processen med att skapa nätverk fokusera på att bygga om IP-adressintervall och undernät på webbplatsen disaster recovery vid replikering av virtuella datorer (VM) med Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="8208d-108">This document is intended to guide the reader through the process of designing the networks, focusing on architecting IP ranges and subnets on the disaster recovery site, when replicating virtual machines (VMs) using Site Recovery.</span></span>

<span data-ttu-id="8208d-109">Dessutom visar den här artikeln hur Site Recovery kan utforma och implementera en multisite virtuella datacenter för att stödja BCDR tjänster när test och katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="8208d-109">Furthermore, this article demonstrates how Site Recovery enables architecting and implementing a multisite virtual datacenter to support BCDR services at time of test or disaster.</span></span>

<span data-ttu-id="8208d-110">I en värld där alla förväntar sig 24/7 anslutning, är det mer viktig än någonsin kan klara din infrastruktur och dina program och körs.</span><span class="sxs-lookup"><span data-stu-id="8208d-110">In a world where everyone expects 24/7 connectivity, it is more important than ever to keep your infrastructure and applications up and running.</span></span> <span data-ttu-id="8208d-111">Syftet med Business Continuity and Disaster Recovery BCDR-är att återställa misslyckade komponenter så att organisationen kan snabbt återuppta normal drift.</span><span class="sxs-lookup"><span data-stu-id="8208d-111">The purpose of Business Continuity and Disaster Recovery (BCDR) is to restore failed components so the organization can quickly resume normal operations.</span></span> <span data-ttu-id="8208d-112">Utveckla strategi för katastrofåterställning hantera osannolikt, förödande händelser är väldigt svårt.</span><span class="sxs-lookup"><span data-stu-id="8208d-112">Developing disaster recovery strategies to deal with unlikely, devastating events is very challenging.</span></span> <span data-ttu-id="8208d-113">Detta beror på inbyggd svårigheten att förutsäga framtida, särskilt när det gäller osannolika händelser och höga kostnader för att tillhandahålla lämpliga åtgärder för skydd mot omfattande catastrophes.</span><span class="sxs-lookup"><span data-stu-id="8208d-113">This is due to the inherent difficulty of predicting the future, particularly as it relates to improbable events, and the high cost to provide adequate measures of protection against far-reaching catastrophes.</span></span>

<span data-ttu-id="8208d-114">Avgörande för BCDR planering, återställning tid mål för Återställningstid och återställning punkt mål (RPO) måste definieras som en del av en plan för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="8208d-114">Crucial for BCDR planning, Recovery Time Objective (RTO) and Recovery Point Objective (RPO) must be defined as part of a disaster recovery plan.</span></span> <span data-ttu-id="8208d-115">När en katastrof inträffar kundens datacenter med hjälp av Azure Site Recovery kunder kan snabbt (låga RTO) Anslut de replikerade virtuella datorer som finns i den sekundära Datacenter eller i Microsoft Azure med minimal dataförlust (låg RPO).</span><span class="sxs-lookup"><span data-stu-id="8208d-115">When a disaster strikes the customer’s data center, using Azure Site Recovery, customers can quickly (low RTO) bring online their replicated virtual machines located in either the secondary data center or Microsoft Azure with minimum data loss (low RPO).</span></span>

<span data-ttu-id="8208d-116">Redundans möjliggörs med ASR som från början kopierar avsedda virtuella datorer från primära Datacenter till ett sekundärt Datacenter eller till Azure (beroende på scenario) och regelbundet uppdaterar replikerna.</span><span class="sxs-lookup"><span data-stu-id="8208d-116">Failover is made possible by ASR which initially copies designated virtual machines from the primary data center to the secondary data center or to Azure (depending on the scenario), and then periodically refreshes the replicas.</span></span> <span data-ttu-id="8208d-117">Under infrastrukturplanering, bör nätverksdesign betraktas som potentiell flaskhals som kan förhindra att du från möte företag RTO och Återställningspunktmål mål.</span><span class="sxs-lookup"><span data-stu-id="8208d-117">During infrastructure planning, network design should be considered as potential bottleneck that can prevent you from meeting company RTO and RPO objectives.</span></span>  

<span data-ttu-id="8208d-118">När administratörer planerar att distribuera en lösning för katastrofåterställning, är en av de viktiga frågorna i minne hur den virtuella datorn skulle kunna nås när redundansväxlingen är klar.</span><span class="sxs-lookup"><span data-stu-id="8208d-118">When administrators are planning to deploy a disaster recovery solution, one of the key questions in their minds is how the virtual machine would be reachable after the failover is completed.</span></span> <span data-ttu-id="8208d-119">ASR kan administratören välja nätverket som en virtuell dator skulle anslutas till efter redundansväxlingen.</span><span class="sxs-lookup"><span data-stu-id="8208d-119">ASR allows the administrator to choose the network to which a virtual machine would be connected to after failover.</span></span> <span data-ttu-id="8208d-120">Om den primära platsen är Azure eller också är en lokal plats som hanteras av en VMM-server och sedan detta uppnås med hjälp av nätverksmappning.</span><span class="sxs-lookup"><span data-stu-id="8208d-120">If the primary site is Azure or it is an on-premises site managed by a VMM server then this is achieved by using Network Mapping.</span></span> <span data-ttu-id="8208d-121">Lär dig mer om [nätverksmappning i Azure till Azure DR](site-recovery-network-mapping-azure-to-azure.md) och [nätverksmappning från VMM](site-recovery-network-mapping.md)</span><span class="sxs-lookup"><span data-stu-id="8208d-121">Learn more about [Network Mapping in Azure to Azure DR](site-recovery-network-mapping-azure-to-azure.md) and [Network Mapping from VMM](site-recovery-network-mapping.md)</span></span>


<span data-ttu-id="8208d-122">När du utformar nätverket för återställningsplatsen har administratören två alternativ:</span><span class="sxs-lookup"><span data-stu-id="8208d-122">While designing the network for the recovery site, the administrator has two choices:</span></span>

* <span data-ttu-id="8208d-123">Använd en annan IP-adressintervall för nätverk på återställningsplatsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-123">Use a different IP address range for the network at recovery site.</span></span> <span data-ttu-id="8208d-124">I det här fallet den virtuella datorn efter redundans får en ny IP-adress och administratören måste göra en DNS-uppdatering.</span><span class="sxs-lookup"><span data-stu-id="8208d-124">In this scenario the virtual machine after failover will get a new IP address and the administrator would have to do a DNS update.</span></span> 
* <span data-ttu-id="8208d-125">Använd samma IP-adressintervall för nätverk på återställningsplatsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-125">Use same IP address range for the network at the recovery site.</span></span> <span data-ttu-id="8208d-126">I vissa fall administratörer som vill behålla IP-adresser som de har på den primära platsen även efter växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-126">In certain scenarios administrators prefer to retain the IP addresses that they have on the primary site even after the failover.</span></span> <span data-ttu-id="8208d-127">I ett vanligt scenario måste en administratör uppdatera vägar för att ange en ny plats för IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="8208d-127">In a normal scenario an administrator would have to update the routes to indicate the new location of the IP addresses.</span></span> <span data-ttu-id="8208d-128">Men i scenario där ett sträckta undernät distribueras mellan den primära servern och recovery platser behålla IP-adresser för virtuella datorer blir ett bra alternativ.</span><span class="sxs-lookup"><span data-stu-id="8208d-128">But in the scenario where a stretched subnet is deployed between the primary and the recovery sites, retaining the IP addresses for the virtual machines becomes an attractive option.</span></span> <span data-ttu-id="8208d-129">Det går inte att sträcka ut ett undernät från ett lokalt nätverk till ett Azure-nätverk eller mellan två Azure-nätverk.</span><span class="sxs-lookup"><span data-stu-id="8208d-129">Stretching a subnet from an on-premises network to an Azure network or between two Azure networks is not possible.</span></span>  

<span data-ttu-id="8208d-130">När administratörer planerar att distribuera en lösning för katastrofåterställning, är en av de viktiga frågorna i sig hur program som kan nås när redundansväxlingen är klar.</span><span class="sxs-lookup"><span data-stu-id="8208d-130">When administrators are planning to deploy a disaster recovery solution, one of the key questions in their mind is how the applications will be reachable after the failover is completed.</span></span> <span data-ttu-id="8208d-131">Moderna program är nästan alltid beroende nätverk till viss mån så fysiskt flytta en tjänst från en plats till en annan representerar en nätverk utmaning.</span><span class="sxs-lookup"><span data-stu-id="8208d-131">Modern applications are almost always dependent on networking to some degree, so physically moving a service from one site to another represents a networking challenge.</span></span> <span data-ttu-id="8208d-132">Det finns två huvudsakliga sätt som det här problemet behandlas i lösningar för katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="8208d-132">There are two main ways that this problem is dealt with in disaster recovery solutions.</span></span> <span data-ttu-id="8208d-133">Det första tillvägagångssättet är att hantera den fasta IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="8208d-133">The first approach is to maintain fixed IP addresses.</span></span> <span data-ttu-id="8208d-134">Trots de tjänster som flyttar och värdservrar som på olika fysiska platser, ta program IP-adresskonfiguration med dem till den nya platsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-134">Despite the services moving and the hosting servers being in different physical locations, applications take the IP address configuration with them to the new location.</span></span> <span data-ttu-id="8208d-135">Det andra sättet är helt ändra IP-adress under övergången till den återställda platsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-135">The second approach involves completely changing the IP address during the transition into the recovered site.</span></span> <span data-ttu-id="8208d-136">Varje metod har flera varianter av implementering som sammanfattas nedan.</span><span class="sxs-lookup"><span data-stu-id="8208d-136">Each approach has several implementation variations which are summarized below.</span></span>

<span data-ttu-id="8208d-137">När du utformar nätverket för återställningsplatsen har administratören två alternativ:</span><span class="sxs-lookup"><span data-stu-id="8208d-137">While designing the network for the recovery site, the administrator has two choices:</span></span>

## <a name="option-1-retain-ip-addresses"></a><span data-ttu-id="8208d-138">Alternativ 1: Behåll IP-adresser</span><span class="sxs-lookup"><span data-stu-id="8208d-138">Option 1: Retain IP addresses</span></span>
<span data-ttu-id="8208d-139">Med fasta IP-adresser verkar vara det enklaste sättet att implementera ur disaster recovery process, men den har ett antal möjliga utmaningar som i praktiken gör det minst populär metod.</span><span class="sxs-lookup"><span data-stu-id="8208d-139">From a disaster recovery process perspective, using fixed IP addresses appears to be the easiest method to implement, but it has a number of potential challenges which in practice make it the least popular approach.</span></span> <span data-ttu-id="8208d-140">Azure Site Recovery tillhandahåller möjligheten att behålla IP-adresser i alla scenarier.</span><span class="sxs-lookup"><span data-stu-id="8208d-140">Azure Site Recovery provides the capability to retain the IP addresses in all scenarios.</span></span> <span data-ttu-id="8208d-141">Innan en beslutar att behålla IP lämpliga bör du tänka på begränsningarna inför på funktioner för redundans.</span><span class="sxs-lookup"><span data-stu-id="8208d-141">Before one decides to retain IP, appropriate thought should be given to the constraints it imposes on the failover capabilities.</span></span> <span data-ttu-id="8208d-142">Låt oss titta på de faktorer som kan hjälpa dig att fatta ett beslut att behålla IP-adresser, eller inte.</span><span class="sxs-lookup"><span data-stu-id="8208d-142">Let us look at the factors that can help you to make a decision to retain IP addresses, or not.</span></span> <span data-ttu-id="8208d-143">Detta kan ske på två sätt med hjälp av utsträckta undernät eller genom att göra en fullständig undernät växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-143">This can be achieved in two ways, by using a stretched subnet or by doing a full subnet failover.</span></span>

### <a name="stretched-subnet"></a><span data-ttu-id="8208d-144">Ambitiöst undernät</span><span class="sxs-lookup"><span data-stu-id="8208d-144">Stretched subnet</span></span>
<span data-ttu-id="8208d-145">Här görs undernätet tillgängliga samtidigt i både primär och DR-platser.</span><span class="sxs-lookup"><span data-stu-id="8208d-145">Here the subnet is made available simultaneously in both primary and DR locations.</span></span> <span data-ttu-id="8208d-146">Detta innebär i enkla villkor kan du flytta en server och dess konfiguration för IP (nivå 3) till den andra platsen och nätverket ska vidarebefordra trafiken till den nya platsen automatiskt.</span><span class="sxs-lookup"><span data-stu-id="8208d-146">In simple terms this means you can move a server and its IP (Layer 3) configuration to the second site and the network will route the traffic to the new location automatically.</span></span> <span data-ttu-id="8208d-147">Detta är enkelt att hantera ur server men den har ett antal utmaningar:</span><span class="sxs-lookup"><span data-stu-id="8208d-147">This is trivial to deal with from a server perspective but it has a number of challenges:</span></span>

* <span data-ttu-id="8208d-148">Det kräver nätverksutrustning som kan hantera ett ambitiöst VLAN ur Lager2 (data-länk lager), men det har blivit mindre problem som den är allmänt tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="8208d-148">From a Layer 2 (data link layer) perspective, it will require networking equipment that can manage a stretched VLAN, but this has become less of a problem as it is now widely available.</span></span> <span data-ttu-id="8208d-149">Andra och svårare problemet är att genom att dra ut VLAN potentiella feldomänen utökas till båda platserna i stort sett blir en enskild felpunkt.</span><span class="sxs-lookup"><span data-stu-id="8208d-149">The second and more difficult problem is that by stretching the VLAN the potential fault domain is extended to both sites, essentially becoming a single point of failure.</span></span> <span data-ttu-id="8208d-150">Även om detta är ett ovanligt inträffat att broadcast storm startats men det gick inte att isolerade.</span><span class="sxs-lookup"><span data-stu-id="8208d-150">While this is an unlikely occurrence, it has happened that a broadcast storm started but could not be isolated.</span></span> <span data-ttu-id="8208d-151">Vi har hittat blandat åsikter om problemet senaste och har sett många lyckade implementeringar samt ”vi kommer aldrig att implementera den här tekniken här”.</span><span class="sxs-lookup"><span data-stu-id="8208d-151">We have found mixed opinions about this last issue and have seen many successful implementations as well as “we will never implement this technology here”.</span></span>
* <span data-ttu-id="8208d-152">Det går inte att sträckta undernät om du använder Microsoft Azure som DR-plats.</span><span class="sxs-lookup"><span data-stu-id="8208d-152">Stretched subnet is not possible if you are using Microsoft Azure as the DR site.</span></span>

### <a name="subnet-failover"></a><span data-ttu-id="8208d-153">Undernät växling vid fel</span><span class="sxs-lookup"><span data-stu-id="8208d-153">Subnet failover</span></span>
<span data-ttu-id="8208d-154">Det är möjligt att implementera undernät redundansen för att få fördelarna med sträckta undernät lösningen ovan utan att sträcka ut undernätet på flera platser.</span><span class="sxs-lookup"><span data-stu-id="8208d-154">It is possible to implement subnet failover to obtain the benefits of the stretched subnet solution described above without stretching the subnet across multiple sites.</span></span> <span data-ttu-id="8208d-155">Här skulle några angivet undernät finnas på plats 1 eller 2 för platsen, men aldrig på båda platser samtidigt.</span><span class="sxs-lookup"><span data-stu-id="8208d-155">Here any given subnet would be present at Site 1 or Site 2, but never at both sites simultaneously.</span></span> <span data-ttu-id="8208d-156">För att upprätthålla IP-adressutrymme vid en växling vid fel är det möjligt att ordna programmässigt router-infrastruktur att flytta undernäten från en plats till en annan.</span><span class="sxs-lookup"><span data-stu-id="8208d-156">In order to maintain the IP address space in the event of a failover, it is possible to programmatically arrange for the router infrastructure to move the subnets from one site to another.</span></span> <span data-ttu-id="8208d-157">Skyddade virtuella datorer i ett failover-scenario undernäten flyttas med den associerade.</span><span class="sxs-lookup"><span data-stu-id="8208d-157">In a failover scenario the subnets would move with the associated protected VMs.</span></span> <span data-ttu-id="8208d-158">Den huvudsakliga Nackdelen med denna metod är om du behöver flytta hela undernät, vilket kan vara OK men kan det påverka redundans granularitet överväganden.</span><span class="sxs-lookup"><span data-stu-id="8208d-158">The main drawback to this approach is in the event of a failure you have to move the whole subnet, which may be OK but it may affect the failover granularity considerations.</span></span>

<span data-ttu-id="8208d-159">Låt oss nu undersöka hur ett fiktivt företag med namnet Contoso kan replikera dess virtuella datorer till en återställningsplats när misslyckas över hela undernätet.</span><span class="sxs-lookup"><span data-stu-id="8208d-159">Let’s examine how a fictional enterprise named Contoso is able to replicate its VMs to a recovery location while failing over the entire subnet.</span></span> <span data-ttu-id="8208d-160">Först beskrivs hur Contoso kan hantera sina undernät medan replikera virtuella datorer mellan två lokala platser och sedan diskuteras hur undernät redundans fungerar när [Azure används som webbplatsen disaster recovery](#failover-to-azure).</span><span class="sxs-lookup"><span data-stu-id="8208d-160">We will first look at how Contoso is able to manage their subnets while replicating VMs between two on-premises locations, and then we will discuss how subnet failover works when [Azure is used as the disaster recovery site](#failover-to-azure).</span></span>

#### <a name="failover-from-on-premises-to-azure"></a><span data-ttu-id="8208d-161">Växling från lokal till Azure</span><span class="sxs-lookup"><span data-stu-id="8208d-161">Failover from on-premises to Azure</span></span> 
<span data-ttu-id="8208d-162">Azure Site Recovery (ASR) kan Azure som ska användas som en återställningsplats för katastrofåterställning för dina virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="8208d-162">Azure Site Recovery (ASR) allows Azure to be used as a disaster recovery site for your virtual machines.</span></span>  

<span data-ttu-id="8208d-163">Låt oss nu undersöka ett scenario där fiktiva företaget Woodgrove Bank har lokal infrastruktur som är värd för sina verksamhetsspecifika program och de är värd för sin mobila program på Azure.</span><span class="sxs-lookup"><span data-stu-id="8208d-163">Let’s examine a scenario where a fictional company named Woodgrove Bank has on-premises infrastructure hosting their line of business applications, and they are hosting their mobile applications on Azure.</span></span> <span data-ttu-id="8208d-164">Anslutningen mellan Woodgrove Bank virtuella datorer i Azure och lokala servrar som en plats-till-plats (S2S) virtuella privata nätverk (VPN) eller ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="8208d-164">Connectivity between Woodgrove Bank VMs in Azure and on-premises servers is provided by a site-to-site (S2S) Virtual Private Network (VPN) or ExpressRoute.</span></span> <span data-ttu-id="8208d-165">S2S VPN kan Woodgrove Bank virtuellt nätverk i Azure för att ses som ett tillägg för Woodgrove Bank lokalt nätverk.</span><span class="sxs-lookup"><span data-stu-id="8208d-165">S2S VPN allows Woodgrove Bank’s virtual network in Azure to be seen as an extension of Woodgrove Bank’s on-premises network.</span></span> <span data-ttu-id="8208d-166">Den här kommunikationen aktiveras av S2S VPN mellan Woodgrove Bank kant och virtuella Azure-nätverket.</span><span class="sxs-lookup"><span data-stu-id="8208d-166">This communication is enabled by S2S VPN between Woodgrove Bank edge and Azure virtual network.</span></span> <span data-ttu-id="8208d-167">Nu vill Woodgrove använda ASR för att replikera dess arbetsbelastningar som körs primära Azure-region till en annan Azure-region.</span><span class="sxs-lookup"><span data-stu-id="8208d-167">Now Woodgrove wants to use ASR to replicate its workloads running primary Azure region to another Azure region.</span></span> <span data-ttu-id="8208d-168">Det här alternativet uppfyller behoven hos Woodgrove som vill ha ett ekonomiska DR-alternativ och kan lagra data i offentliga molnmiljöer.</span><span class="sxs-lookup"><span data-stu-id="8208d-168">This option meets the needs of Woodgrove, which wants an economical DR option and is able to store data in public cloud environments.</span></span> <span data-ttu-id="8208d-169">Woodgrove har att hantera program och konfigurationer som är beroende av hårdkodade IP-adresser, så de har ett krav att behålla IP-adresser för sina program efter ett misslyckande till en annan region i Azure.</span><span class="sxs-lookup"><span data-stu-id="8208d-169">Woodgrove has to deal with applications and configurations which depend on hard-coded IP addresses, hence they have a requirement to retain IP addresses for their applications after failing over to another region in Azure.</span></span>

<span data-ttu-id="8208d-170">Woodgrove beslutat att tilldela IP-adresser från IP-adressintervall (172.16.1.0/24, 172.16.2.0/24) till dess resurser som körs i Azure.</span><span class="sxs-lookup"><span data-stu-id="8208d-170">Woodgrove has decided to assign IP addresses from IP address range (172.16.1.0/24, 172.16.2.0/24) to its resources running in Azure.</span></span>

<span data-ttu-id="8208d-171">Ett Azure Virtual Network måste skapas för Woodgrove för att kunna replikera en virtuell dator till Azure samtidigt som IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="8208d-171">For Woodgrove to be able to replicate its virtual machines to Azure while retaining the IP addresses, an Azure Virtual Network needs to be created.</span></span> <span data-ttu-id="8208d-172">Det bör vara ett tillägg till det lokala nätverket så att program kan växling från den lokala platsen till Azure sömlöst.</span><span class="sxs-lookup"><span data-stu-id="8208d-172">It should be an extension of the on-premises network so that applications can failover from the on-premises site to Azure seamlessly.</span></span> <span data-ttu-id="8208d-173">Azure kan du lägga till plats-till-plats samt punkt-till-plats VPN-anslutning i virtuella nätverk som skapats i Azure.</span><span class="sxs-lookup"><span data-stu-id="8208d-173">Azure allows you to add site-to-site as well as point-to-site VPN connectivity to the virtual networks created in Azure.</span></span> <span data-ttu-id="8208d-174">När du konfigurerar din plats-till-plats-anslutning, kan Azure-nätverk du dirigera trafik till den lokala platsen (Azure anropar den lokala nätverk) bara om IP-adressintervallet skiljer sig från det lokala IP-adressintervallet eftersom Azure inte stöder sträcka ut undernät.</span><span class="sxs-lookup"><span data-stu-id="8208d-174">When setting up your site-to-site connection, Azure network allows you to route traffic to the on-premises location (Azure calls it local-network) only if the IP address range is different from the on-premises IP address range, because Azure doesn’t support stretching subnets.</span></span>  <span data-ttu-id="8208d-175">Det innebär att om du har ett undernät 192.168.1.0/24 lokala, det går inte att lägga till 192.168.1.0/24 ett lokalt nätverk i Azure-nätverk.</span><span class="sxs-lookup"><span data-stu-id="8208d-175">This means that if you have a subnet 192.168.1.0/24 on-premises, you can’t add a local-network 192.168.1.0/24 in the Azure network.</span></span> <span data-ttu-id="8208d-176">Detta är förväntat eftersom Azure inte vet att det inte finns några aktiva virtuella datorer i undernät och undernätet skapas endast för Katastrofåterställning.</span><span class="sxs-lookup"><span data-stu-id="8208d-176">This is expected because Azure doesn’t know that there are no active VMs in the subnet and that the subnet is being created only for DR purposes.</span></span> <span data-ttu-id="8208d-177">För att kunna dirigera nätverkstrafik utanför ett Azure-nätverk inte vara i konflikt undernät i nätverket och det lokala nätverket korrekt.</span><span class="sxs-lookup"><span data-stu-id="8208d-177">To be able to correctly route network traffic out of an Azure network the subnets in the network and the local-network must not conflict.</span></span>

![Innan du undernät redundans](./media/site-recovery-network-design/network-design7.png)

<span data-ttu-id="8208d-179">Innan du redundans</span><span class="sxs-lookup"><span data-stu-id="8208d-179">Before failover</span></span>

<span data-ttu-id="8208d-180">För att uppfylla affärskrav Woodgrove, behöver vi implementera följande arbetsflöden:</span><span class="sxs-lookup"><span data-stu-id="8208d-180">To help Woodgrove fulfill their business requirements, we need to implement the following workflows:</span></span>

* <span data-ttu-id="8208d-181">Skapa ytterligare ett nätverk, låt oss anropa Recovery nätverk, där de virtuella datorerna misslyckades över skulle skapas.</span><span class="sxs-lookup"><span data-stu-id="8208d-181">Create an additional network, let us call it Recovery Network, where the failed-over virtual machines would be created.</span></span>
* <span data-ttu-id="8208d-182">För att säkerställa att IP-Adressen för en virtuell dator finns kvar efter en växling vid fel, gå till fliken Konfigurera under VM egenskaper ange samma IP-Adressen som den virtuella datorn har en lokal och klicka sedan på Spara.</span><span class="sxs-lookup"><span data-stu-id="8208d-182">To ensure that the IP for a VM is retained after a failover, go to the Configure tab under VM properties, specify the same IP that the VM has on-premises, and then click Save.</span></span> <span data-ttu-id="8208d-183">När den virtuella datorn har redundansväxlats tilldelar Azure Site Recovery den angivna IP-Adressen till den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="8208d-183">When the VM is failed over, Azure Site Recovery will assign the provided IP to the virtual machine.</span></span>

![Egenskaper för nätverk](./media/site-recovery-network-design/network-design8.png)

<span data-ttu-id="8208d-185">När växling vid fel utlöses och virtuella datorer skapas i nätverkets återställning med önskad IP-anslutning till det här nätverket kan upprättas med hjälp av en [Vnet Vnet-anslutningen till](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="8208d-185">Once the failover is triggered and the virtual machines are created in the Recovery Network with the desired IP, connectivity to this network can be established using a [Vnet to Vnet Connection](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span> <span data-ttu-id="8208d-186">Om det krävs för den här åtgärden kan skriptas.</span><span class="sxs-lookup"><span data-stu-id="8208d-186">If required this action can be scripted.</span></span>  <span data-ttu-id="8208d-187">Enligt beskrivningen i föregående avsnitt om undernätet redundans även vid redundans till Azure skulle vägar behöva ändras på lämpligt sätt för att återspegla den 192.168.1.0/24 har nu flyttats till Azure.</span><span class="sxs-lookup"><span data-stu-id="8208d-187">As we discussed in the previous section about subnet failover, even in the case of failover to Azure, routes would have to be appropriately modified to reflect that 192.168.1.0/24 has now moved to Azure.</span></span>

![Efter undernät redundans](./media/site-recovery-network-design/network-design9.png)

<span data-ttu-id="8208d-189">Efter växling vid fel</span><span class="sxs-lookup"><span data-stu-id="8208d-189">After failover</span></span>

<span data-ttu-id="8208d-190">Om du inte har ett Azure nätverk som visas i bilden ovan.</span><span class="sxs-lookup"><span data-stu-id="8208d-190">If you don't have a 'Azure Network' as shown in the picture above.</span></span> <span data-ttu-id="8208d-191">Du kan skapa en plats-till-plats-vpn-anslutning mellan 'Primära platsen' och 'Recovery nätverket' efter växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-191">You can create a site to site vpn connection between your 'Primary Site' and 'Recovery Network' after the failover.</span></span>  


#### <a name="failover-to-a-secondary-on-premises-site"></a><span data-ttu-id="8208d-192">Växling till en sekundär lokal plats</span><span class="sxs-lookup"><span data-stu-id="8208d-192">Failover to a secondary on-premises site</span></span>
<span data-ttu-id="8208d-193">Låt oss se ett scenario där vi vill behålla IP-Adressen för var och en av de virtuella datorerna och failover fullständig undernätet tillsammans.</span><span class="sxs-lookup"><span data-stu-id="8208d-193">Let us look at a scenario where we want retain the IP of each of the VMs and fail-over the complete subnet together.</span></span> <span data-ttu-id="8208d-194">Den primära platsen har program som körs i undernätet 192.168.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="8208d-194">The primary site has applications running in subnet 192.168.1.0/24.</span></span> <span data-ttu-id="8208d-195">När redundansväxlingen sker alla virtuella datorer som ingår i det här undernätet kommer att flyttas över till återställningsplatsen och behålla sina IP-adresser.</span><span class="sxs-lookup"><span data-stu-id="8208d-195">When the failover happens, all the virtual machines that are part of this subnet will be failed over to the recovery site and retain their IP addresses.</span></span> <span data-ttu-id="8208d-196">Vägar måste ändras på lämpligt sätt om du vill visa alla virtuella datorer som hör till 192.168.1.0/24 undernät har nu flyttats till återställningsplatsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-196">Routes will have to be appropriately modified to reflect the fact that all the virtual machines belonging to subnet 192.168.1.0/24 have now moved to the recovery site.</span></span>

<span data-ttu-id="8208d-197">I följande illustration behöver vägar mellan primära platsen och återställningsplatsen, tredje plats och primär plats och tredje plats och återställningsplatsen ändras på lämpligt sätt.</span><span class="sxs-lookup"><span data-stu-id="8208d-197">In the following illustration the routes between primary site and recovery site, third site and primary site, and third site and recovery site will have to be appropriately modified.</span></span>

<span data-ttu-id="8208d-198">Följande bilder visar undernät innan växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-198">The following pictures shows the subnets before the failover.</span></span> <span data-ttu-id="8208d-199">Undernät 192.168.0.1/24 är aktiv på den primära platsen före växlingen vid fel och aktiveras av återställningsplatsen efter växling vid fel</span><span class="sxs-lookup"><span data-stu-id="8208d-199">Subnet 192.168.0.1/24 is active on the Primary Site before the failover and becomes active of the Recovery Site after the failover</span></span>

![Innan du redundans](./media/site-recovery-network-design/network-design2.png)

<span data-ttu-id="8208d-201">Innan du redundans</span><span class="sxs-lookup"><span data-stu-id="8208d-201">Before failover</span></span>

<span data-ttu-id="8208d-202">Bilden nedan visar nätverk och undernät efter växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-202">The picture below shows networks and subnets after failover.</span></span>

![Efter växling vid fel](./media/site-recovery-network-design/network-design3.png)

<span data-ttu-id="8208d-204">Efter växling vid fel</span><span class="sxs-lookup"><span data-stu-id="8208d-204">After failover</span></span>

<span data-ttu-id="8208d-205">På den sekundära platsen är lokalt och du använder en VMM-server för att hantera den sedan när du aktiverar skyddet för en specifik virtuell dator allokeras ASR nätverksresurser enligt följande arbetsflöde:</span><span class="sxs-lookup"><span data-stu-id="8208d-205">In your secondary site is on-premises and you are using a VMM server to manage it then when enabling protection for a specific virtual machine, ASR will allocate networking resources according to the following workflow:</span></span>

* <span data-ttu-id="8208d-206">ASR tilldelar en IP-adress för varje nätverksgränssnitt på den virtuella datorn från den statiska IP-adresspool som definierats i relevanta nätverket för varje System Center VMM-instans.</span><span class="sxs-lookup"><span data-stu-id="8208d-206">ASR allocates an IP address for each network interface on the virtual machine from the static IP address pool defined on the relevant network for each System Center VMM instance.</span></span>
* <span data-ttu-id="8208d-207">Om administratören definierar samma IP-adresspool för nätverket på återställningsplatsen med IP-adresspool för nätverk på den primära platsen, när tilldelning av IP-adress till den virtuella replikdatorn ASR skulle tilldela samma IP adress som den den primära virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="8208d-207">If the administrator defines the same IP address pool for the network on the recovery site as that of the IP address pool of the network on the primary site, while allocating the IP address to the replica virtual machine ASR would allocate the same IP address as that of the primary virtual machine.</span></span>  <span data-ttu-id="8208d-208">IP-Adressen är reserverad i VMM men har angetts inte som redundans IP på Hyper-v-värden.</span><span class="sxs-lookup"><span data-stu-id="8208d-208">The IP is reserved in VMM but not set as failover IP on the Hyper-v host.</span></span> <span data-ttu-id="8208d-209">Failover IP på en Hyper-v-värden anges innan växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-209">Failover IP on a Hyper-v host is set just before the failover.</span></span>


<span data-ttu-id="8208d-210">Om samma IP-Adressen inte är tillgänglig, skulle ASR allokera vissa andra tillgänglig IP-adress från den angivna IP-adresspoolen.</span><span class="sxs-lookup"><span data-stu-id="8208d-210">If the same IP is not available, ASR would allocate some other available IP address from the defined IP address pool.</span></span>

<span data-ttu-id="8208d-211">När den virtuella datorn har aktiverats för skydd som du kan använda följande exempelskript för att verifiera IP-adress som har allokerats till den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="8208d-211">After the VM is enabled for protection you can use following sample script to verify the IP that has been allocated to the virtual machine.</span></span> <span data-ttu-id="8208d-212">Samma IP-Adressen skulle ange Failover IP och tilldelas den virtuella datorn vid tidpunkten för växling vid fel:</span><span class="sxs-lookup"><span data-stu-id="8208d-212">The same IP would be set as Failover IP and assigned to the VM at the time of failover:</span></span>

        $vm = Get-SCVirtualMachine -Name <VM_NAME>
        $na = $vm[0].VirtualNetworkAdapters>
        $ip = Get-SCIPAddress -GrantToObjectID $na[0].id
        $ip.address  

> [!NOTE]
> <span data-ttu-id="8208d-213">I scenariot där virtuella datorer använda DHCP, är hantering av IP-adresser helt utanför kontroll av ASR.</span><span class="sxs-lookup"><span data-stu-id="8208d-213">In the scenario where virtual machines use DHCP, the management of IP addresses is completely outside the control of ASR.</span></span> <span data-ttu-id="8208d-214">En administratör måste se till att du kan hantera DHCP-servern hanterar IP-adresser på återställningsplatsen från samma intervall som den primära platsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-214">An administrator has to ensure that the DHCP server serving the IP addresses on the recovery site can serve from the same range as that of the primary site.</span></span>
>
>



## <a name="option-2-changing-ip-addresses"></a><span data-ttu-id="8208d-215">Alternativ 2: Ändra IP-adresser</span><span class="sxs-lookup"><span data-stu-id="8208d-215">Option 2: Changing IP addresses</span></span>
<span data-ttu-id="8208d-216">Den här metoden verkar vara den vanligaste baserat på vad vi sett.</span><span class="sxs-lookup"><span data-stu-id="8208d-216">This approach seems to be the most prevalent based on what we have seen.</span></span> <span data-ttu-id="8208d-217">Det tar formuläret för att ändra IP-adressen för varje virtuell dator som ingår i växling vid fel.</span><span class="sxs-lookup"><span data-stu-id="8208d-217">It takes the form of changing the IP address of every VM that is involved in the failover.</span></span> <span data-ttu-id="8208d-218">En nackdel med den här metoden kräver inkommande nätverket ' Läs ' att programmet som skedde vid IPx är nu vid IPy.</span><span class="sxs-lookup"><span data-stu-id="8208d-218">A drawback of this approach requires the incoming network to ‘learn’ that the application that was at IPx is now at IPy.</span></span> <span data-ttu-id="8208d-219">Även om IPx och IPy är logiska namn, DNS-poster har vanligtvis ändras eller rensade i hela nätverket, och cachelagrade poster i nätverket tabeller behöver uppdateras eller rensade, därför ett driftstopp kan ses beroende på hur DNS-infrastrukturen har installationsprogrammet.</span><span class="sxs-lookup"><span data-stu-id="8208d-219">Even if IPx and IPy are logical names, DNS entries typically have to be changed or flushed throughout the network, and cached entries in network tables have to be updated or flushed, therefore a downtime could be seen depending upon how the DNS infrastructure has been setup.</span></span> <span data-ttu-id="8208d-220">De här problemen kan begränsas med hjälp av låg TTL-värden för intranätsprogram och använder [Azure Traffic Manager med ASR](http://azure.microsoft.com/blog/2015/03/03/reduce-rto-by-using-azure-traffic-manager-with-azure-site-recovery/) för internet-baserade program</span><span class="sxs-lookup"><span data-stu-id="8208d-220">These issues can be mitigated by using low TTL values in the case of intranet applications and using [Azure Traffic Manger with ASR](http://azure.microsoft.com/blog/2015/03/03/reduce-rto-by-using-azure-traffic-manager-with-azure-site-recovery/) for internet based applications</span></span>

### <a name="changing-the-ip-addresses---illustration"></a><span data-ttu-id="8208d-221">Ändra IP-adresser - bild</span><span class="sxs-lookup"><span data-stu-id="8208d-221">Changing the IP addresses - Illustration</span></span>
<span data-ttu-id="8208d-222">Låt oss se ett scenario där du planerar att använda olika IP-adresser mellan den primära servern och återställningsplatser.</span><span class="sxs-lookup"><span data-stu-id="8208d-222">Let us look at the scenario where you are planning to use different IPs across the primary and the recovery sites.</span></span> <span data-ttu-id="8208d-223">I följande exempel vi också ha en tredje plats från där programmen finns på primära eller återställning är webbplatsen tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="8208d-223">In the following example we also have a third site from where the applications hosted on primary or recovery site can be accessed.</span></span>

![Olika IP - före redundans](./media/site-recovery-network-design/network-design10.png)


<span data-ttu-id="8208d-225">I bilden ovan är vissa program som finns i undernät 192.168.1.0/24 undernät på den primära platsen och de har konfigurerats för att komma på återställningsplatsen i undernätet 172.16.1.0/24 efter en redundansväxling.</span><span class="sxs-lookup"><span data-stu-id="8208d-225">In the picture above there are some applications hosted in subnet 192.168.1.0/24 subnet on the primary site, and they have been configured to come up on the recovery site in subnet 172.16.1.0/24 after a failover.</span></span> <span data-ttu-id="8208d-226">VPN-anslutningar/nätverksvägar har konfigurerats på rätt sätt så att alla tre platser som har åtkomst till varandra.</span><span class="sxs-lookup"><span data-stu-id="8208d-226">VPN connections/network routes have been configured appropriately so that all three sites can access each other.</span></span>

<span data-ttu-id="8208d-227">De kommer att återställas i recovery undernät för som på bilden nedan visas efter ett eller flera program inte körs.</span><span class="sxs-lookup"><span data-stu-id="8208d-227">As the picture below shows, after failing over one or more applications, they will be restored in the recovery subnet.</span></span> <span data-ttu-id="8208d-228">I det här fallet är vi inte begränsade till redundans på hela subnätet på samma gång.</span><span class="sxs-lookup"><span data-stu-id="8208d-228">In this case we are not constrained to failover the entire subnet at the same time.</span></span> <span data-ttu-id="8208d-229">Inga ändringar krävs för att konfigurera om VPN- eller nätverksvägar.</span><span class="sxs-lookup"><span data-stu-id="8208d-229">No changes are required to reconfigure VPN or network routes.</span></span> <span data-ttu-id="8208d-230">En växling vid fel och DNS-uppdateringar ska kontrollera att program fortfarande är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="8208d-230">A failover and some DNS updates will make sure that applications remain accessible.</span></span> <span data-ttu-id="8208d-231">Om DNS-servern är konfigurerad för att tillåta dynamiska uppdateringar kan sedan de virtuella datorerna registrera sig själva med hjälp av den nya IP när de startar efter en redundansväxling.</span><span class="sxs-lookup"><span data-stu-id="8208d-231">If the DNS is configured to allow dynamic updates then the virtual machines would register themselves using the new IP once they start after a failover.</span></span>

![Olika IP - efter växling vid fel](./media/site-recovery-network-design/network-design11.png)


<span data-ttu-id="8208d-233">Efter över misslyckas kanske den virtuella replikdatorn en IP-adress som inte är samma som IP-adressen för den primära virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="8208d-233">After failing-over the replica virtual machine might have an IP address that isn’t the same as the IP address of the primary virtual machine.</span></span> <span data-ttu-id="8208d-234">Virtuella datorer kommer att uppdatera DNS-servern som de använder när de startar.</span><span class="sxs-lookup"><span data-stu-id="8208d-234">Virtual machines will update the DNS server that they are using after they start.</span></span> <span data-ttu-id="8208d-235">DNS-poster har vanligtvis ändras eller rensade i hela nätverket och cachelagrade poster i nätverket tabeller behöver uppdateras eller rensade, så det inte är ovanligt att drabbas av driftstopp medan de här ändringarna äga rum.</span><span class="sxs-lookup"><span data-stu-id="8208d-235">DNS entries typically have to be changed or flushed throughout the network, and cached entries in network tables have to be updated or flushed, so it is not uncommon to be faced with downtime while these state changes take place.</span></span> <span data-ttu-id="8208d-236">Det här problemet kan begränsas med:</span><span class="sxs-lookup"><span data-stu-id="8208d-236">This issue can be mitigated by:</span></span>

* <span data-ttu-id="8208d-237">Med hjälp av låg TTL-värden för intranätsprogram.</span><span class="sxs-lookup"><span data-stu-id="8208d-237">Using low TTL values for intranet applications.</span></span>
* <span data-ttu-id="8208d-238">Med ASR Azure Traffic Manager för internet-baserade program.</span><span class="sxs-lookup"><span data-stu-id="8208d-238">Using Azure Traffic Manger with ASR  for internet based applications.</span></span>
* <span data-ttu-id="8208d-239">Uppdatera DNS-servern för att säkerställa en rimlig uppdatering (skriptet inte är nödvändigt om dynamisk DNS-registrering har konfigurerats) med följande skript i din återställningsplan</span><span class="sxs-lookup"><span data-stu-id="8208d-239">Using the following script within your recovery plan to update the DNS Server to ensure a timely update (The script is not required if the Dynamic DNS registration is configured)</span></span>

        param(
        string]$Zone,
        [string]$name,
        [string]$IP
        )
        $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
        $newrecord = $record.clone()
        $newrecord.RecordData[0].IPv4Address  =  $IP
        Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord

### <a name="changing-the-ip-addresses--dr-to-azure"></a><span data-ttu-id="8208d-240">Ändra IP-adresser – DR till Azure</span><span class="sxs-lookup"><span data-stu-id="8208d-240">Changing the IP addresses – DR to Azure</span></span>
<span data-ttu-id="8208d-241">Den [nätverk Infrastrukturinställningar för Microsoft Azure som en plats för Disaster Recovery](http://azure.microsoft.com/blog/2014/09/04/networking-infrastructure-setup-for-microsoft-azure-as-a-disaster-recovery-site/) blogginlägget beskriver hur du installationen krävs Azure nätverksinfrastrukturen när behåller IP-adresser är inte ett krav.</span><span class="sxs-lookup"><span data-stu-id="8208d-241">The [Networking Infrastructure Setup for Microsoft Azure as a Disaster Recovery Site](http://azure.microsoft.com/blog/2014/09/04/networking-infrastructure-setup-for-microsoft-azure-as-a-disaster-recovery-site/) blog post explains how to setup the required Azure networking infrastructure when retaining IP addresses isn’t a requirement.</span></span> <span data-ttu-id="8208d-242">Den börjar med som beskriver programmet och titta på hur du ställer in nätverk lokalt och på Azure och sedan sluta med hur du gör ett redundanstest och en planerad redundans.</span><span class="sxs-lookup"><span data-stu-id="8208d-242">It starts with describing the application and then look at how to setup networking on-premises and on Azure and then concluding with how to do a test failover and a planned failover.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8208d-243">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="8208d-243">Next steps</span></span>
<span data-ttu-id="8208d-244">[Läs](site-recovery-vmm-to-vmm.md#prepare-for-network-mapping) hur Site Recovery mappar käll- och nätverk när en VMM-server används för att hantera den primära platsen.</span><span class="sxs-lookup"><span data-stu-id="8208d-244">[Learn](site-recovery-vmm-to-vmm.md#prepare-for-network-mapping) how Site Recovery maps source and target networks when a VMM server is being used to manage the primary site.</span></span>
