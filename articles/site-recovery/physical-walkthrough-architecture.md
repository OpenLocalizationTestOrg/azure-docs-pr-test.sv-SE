---
title: "aaaReview hello arkitektur för fysisk server replication tooAzure med hjälp av Azure Site Recovery | Microsoft Docs"
description: "Den här artikeln innehåller en översikt över komponenter och arkitektur som används vid replikering av lokala fysiska servrar tooAzure med hello Azure Site Recovery-tjänsten"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 4f334c181fa6f0821adf978ebe9dbd7d36a3c753
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="step-1-review-hello-architecture-for-physical-server-replication-tooazure"></a><span data-ttu-id="e4d79-103">Steg 1: Granska hello arkitektur för fysisk server replication tooAzure</span><span class="sxs-lookup"><span data-stu-id="e4d79-103">Step 1: Review hello architecture for physical server replication tooAzure</span></span>

<span data-ttu-id="e4d79-104">Den här artikeln beskriver hello komponenter och processer som används när du replikera lokala Windows-/ Linux fysiska servrar tooAzure med hello [Azure Site Recovery](site-recovery-overview.md) service.</span><span class="sxs-lookup"><span data-stu-id="e4d79-104">This article describes hello components and processes used when you replicate on-premises Windows/Linux physical servers tooAzure, using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="e4d79-105">Skicka kommentarer längst ned hello i den här artikeln eller ställa frågor i hello [Azure Recovery Services-forumet](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="e4d79-105">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="e4d79-106">Arkitekturkomponenter</span><span class="sxs-lookup"><span data-stu-id="e4d79-106">Architectural components</span></span>

<span data-ttu-id="e4d79-107">hello tabell sammanfattas hello-komponenter som du behöver.</span><span class="sxs-lookup"><span data-stu-id="e4d79-107">hello table summarizes hello components you need.</span></span>

<span data-ttu-id="e4d79-108">**Komponent**</span><span class="sxs-lookup"><span data-stu-id="e4d79-108">**Component**</span></span> | <span data-ttu-id="e4d79-109">**Krav**</span><span class="sxs-lookup"><span data-stu-id="e4d79-109">**Requirement**</span></span> | <span data-ttu-id="e4d79-110">**Detaljer**</span><span class="sxs-lookup"><span data-stu-id="e4d79-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="e4d79-111">**Azure**</span><span class="sxs-lookup"><span data-stu-id="e4d79-111">**Azure**</span></span> | <span data-ttu-id="e4d79-112">Du behöver ett Azure-konto, ett Azure storage-konto och ett Azure-nätverk.</span><span class="sxs-lookup"><span data-stu-id="e4d79-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="e4d79-113">Replikerade data lagras i hello storage-konto och virtuella Azure-datorer skapas med hello replikerade data vid en redundansväxling.</span><span class="sxs-lookup"><span data-stu-id="e4d79-113">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover occurs.</span></span> <span data-ttu-id="e4d79-114">Virtuella Azure-datorer ansluta toohello virtuella Azure-nätverket när de skapas.</span><span class="sxs-lookup"><span data-stu-id="e4d79-114">Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="e4d79-115">**Konfigurationsserver**</span><span class="sxs-lookup"><span data-stu-id="e4d79-115">**Configuration server**</span></span> | <span data-ttu-id="e4d79-116">En enda lokal hanteringsserver (fysisk server eller VMware VM) som kör alla hello lokala Site Recovery-komponenter.</span><span class="sxs-lookup"><span data-stu-id="e4d79-116">A single on-premises management server (physical server or VMware VM) that runs all hello on-premises Site Recovery components.</span></span> <span data-ttu-id="e4d79-117">Dessa inkluderar en konfigurationsservern, processervern, huvudmålservern.</span><span class="sxs-lookup"><span data-stu-id="e4d79-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="e4d79-118">Hej konfigurationsserverkomponent samordnar kommunikationen mellan lokala och Azure och hanterar datareplikering.</span><span class="sxs-lookup"><span data-stu-id="e4d79-118">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="e4d79-119">**Processervern**</span><span class="sxs-lookup"><span data-stu-id="e4d79-119">**Process server**</span></span>  | <span data-ttu-id="e4d79-120">Installeras som standard på hello konfigurationsservern.</span><span class="sxs-lookup"><span data-stu-id="e4d79-120">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="e4d79-121">Fungerar som en replikeringsgateway.</span><span class="sxs-lookup"><span data-stu-id="e4d79-121">Acts as a replication gateway.</span></span> <span data-ttu-id="e4d79-122">Tar emot replikeringsdata, optimerar dem med cachelagring, komprimering och kryptering och skickar det tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="e4d79-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="e4d79-123">Hej processervern hanterar också push-installation av hello Mobility service tooprotected datorer.</span><span class="sxs-lookup"><span data-stu-id="e4d79-123">hello process server also handles push installation of hello Mobility service tooprotected machines.</span></span><br/><br/> <span data-ttu-id="e4d79-124">Du kan lägga till ytterligare separata dedikerade servrar, toohandle öka mängder replikeringstrafik.</span><span class="sxs-lookup"><span data-stu-id="e4d79-124">You can add additional separate dedicated process servers, toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="e4d79-125">**Huvudmålservern**</span><span class="sxs-lookup"><span data-stu-id="e4d79-125">**Master target server**</span></span> | <span data-ttu-id="e4d79-126">Installeras som standard på hello lokalt konfigurationsservern.</span><span class="sxs-lookup"><span data-stu-id="e4d79-126">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="e4d79-127">Hanterar replikeringsdata vid återställning efter fel från Azure.</span><span class="sxs-lookup"><span data-stu-id="e4d79-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="e4d79-128">Om trafikvolymer för återställning efter fel är stora, kan du distribuera en separat huvudmålserver för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="e4d79-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="e4d79-129">**Replikerade servrar**</span><span class="sxs-lookup"><span data-stu-id="e4d79-129">**Replicated servers**</span></span> | <span data-ttu-id="e4d79-130">Hej mobilitetstjänsten installeras på varje Windows-/ Linux-server du vill tooreplicate.</span><span class="sxs-lookup"><span data-stu-id="e4d79-130">hello Mobility service component is installed on each Windows/Linux server you want tooreplicate.</span></span> <span data-ttu-id="e4d79-131">Den kan installeras manuellt på varje dator eller med en push-installation från hello processervern.</span><span class="sxs-lookup"><span data-stu-id="e4d79-131">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>
<span data-ttu-id="e4d79-132">**Återställning efter fel**</span><span class="sxs-lookup"><span data-stu-id="e4d79-132">**Failback**</span></span> | <span data-ttu-id="e4d79-133">Infrastruktur krävs för återställning av en VMware.</span><span class="sxs-lookup"><span data-stu-id="e4d79-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="e4d79-134">Du kan inte växla tillbaka tooa fysisk server.</span><span class="sxs-lookup"><span data-stu-id="e4d79-134">You can't fail back tooa physical server.</span></span>


<span data-ttu-id="e4d79-135">**Bild 1: Fysiska tooAzure komponenter**</span><span class="sxs-lookup"><span data-stu-id="e4d79-135">**Figure 1: Physical tooAzure components**</span></span>

![Komponenter](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="e4d79-137">Replikeringsprocessen</span><span class="sxs-lookup"><span data-stu-id="e4d79-137">Replication process</span></span>

1. <span data-ttu-id="e4d79-138">Du kan konfigurera hello-distribution, inklusive lokalt och Azure-komponenter.</span><span class="sxs-lookup"><span data-stu-id="e4d79-138">You set up hello deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="e4d79-139">I hello Recovery Services-valvet anger du hello replikeringskälla och mål, ställa in hello konfigurationsservern och skapa en replikeringsprincip, distribuera hello mobilitetstjänsten, aktivera replikering och köra ett redundanstest.</span><span class="sxs-lookup"><span data-stu-id="e4d79-139">In hello Recovery Services vault, you specify hello replication source and target, set up hello configuration server, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="e4d79-140">Replikera datorer enligt hello replikeringsprinciper och en inledande kopia av hello data är replikerade tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="e4d79-140">Machines replicate in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="e4d79-141">Replikering av delta ändringar tooAzure börjar när replikeringen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="e4d79-141">After initial replication finishes, replication of delta changes tooAzure begins.</span></span> <span data-ttu-id="e4d79-142">Spårade ändringar för en dator lagras i en .hrl-fil.</span><span class="sxs-lookup"><span data-stu-id="e4d79-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="e4d79-143">Replikera datorer kommunicerar med hello konfigurationsservern på port 443 för HTTPS inkommande för replikeringshantering av.</span><span class="sxs-lookup"><span data-stu-id="e4d79-143">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="e4d79-144">Replikera datorer skickar replikering data toohello processervern på port HTTPS 9443 inkommande (kan ändras).</span><span class="sxs-lookup"><span data-stu-id="e4d79-144">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="e4d79-145">hello konfigurationsservern samordnar replikeringshantering med Azure via port 443 för HTTPS utgående.</span><span class="sxs-lookup"><span data-stu-id="e4d79-145">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="e4d79-146">hello processervern tar emot data från källdatorer, optimerar och krypteras det och skickar det tooAzure lagring via port 443 utgående.</span><span class="sxs-lookup"><span data-stu-id="e4d79-146">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="e4d79-147">Om du aktiverar konsekvens för flera kommunicerar datorer i hello replikeringsgrupp med varandra via port 20004.</span><span class="sxs-lookup"><span data-stu-id="e4d79-147">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="e4d79-148">Multi-VM används om du grupperar flera datorer i replikeringsgrupper som delar kraschkonsekventa och app-konsekventa återställningspunkter när de växlar över vid fel.</span><span class="sxs-lookup"><span data-stu-id="e4d79-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="e4d79-149">Detta är användbart om datorerna kör hello samma arbetsbelastning och måste toobe konsekvent.</span><span class="sxs-lookup"><span data-stu-id="e4d79-149">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="e4d79-150">Trafiken är replikerade tooAzure lagring offentliga slutpunkter över hello internet.</span><span class="sxs-lookup"><span data-stu-id="e4d79-150">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="e4d79-151">Du kan även använda Azure ExpressRoute [offentlig peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span><span class="sxs-lookup"><span data-stu-id="e4d79-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="e4d79-152">Replikera trafik via ett plats-till-plats-VPN från en lokal plats tooAzure stöds inte.</span><span class="sxs-lookup"><span data-stu-id="e4d79-152">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="e4d79-153">**Bild 2: Fysiska tooAzure replikering**</span><span class="sxs-lookup"><span data-stu-id="e4d79-153">**Figure 2: Physical tooAzure replication**</span></span>

![Optimerad](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="e4d79-155">Processen för redundans och återställning efter fel</span><span class="sxs-lookup"><span data-stu-id="e4d79-155">Failover and failback process</span></span>

<span data-ttu-id="e4d79-156">När du har kontrollerat att redundanstestet fungerar som förväntat kan du köra oplanerade växlingar tooAzure som krävs.</span><span class="sxs-lookup"><span data-stu-id="e4d79-156">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="e4d79-157">När du kör en växling vid fel, skapas virtuella Azure-datorer från replikerade data.</span><span class="sxs-lookup"><span data-stu-id="e4d79-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="e4d79-158">Sedan, när din primära lokal plats är tillgänglig igen, kan du växla tillbaka.</span><span class="sxs-lookup"><span data-stu-id="e4d79-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="e4d79-159">Tänk på följande:</span><span class="sxs-lookup"><span data-stu-id="e4d79-159">Note that:</span></span>

- <span data-ttu-id="e4d79-160">Planerad redundans stöds inte.</span><span class="sxs-lookup"><span data-stu-id="e4d79-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="e4d79-161">Du kan växla över en enskild dator eller skapa [återställningsplaner](site-recovery-create-recovery-plans.md), toofail över flera datorer tillsammans.</span><span class="sxs-lookup"><span data-stu-id="e4d79-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple machines together.</span></span>
- <span data-ttu-id="e4d79-162">Du genomför en växling vid fel toostart använder hello arbetsbelastning från hello repliken Azure VM.</span><span class="sxs-lookup"><span data-stu-id="e4d79-162">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
- <span data-ttu-id="e4d79-163">När hello primära platsen är tillgänglig igen kan du replikera hello datorn från hello sekundära toohello primära platsen.</span><span class="sxs-lookup"><span data-stu-id="e4d79-163">When hello primary site is available again, you replicate hello machine from hello secondary toohello primary site.</span></span> <span data-ttu-id="e4d79-164">Kör sedan en oplanerad redundans från hello sekundär plats.</span><span class="sxs-lookup"><span data-stu-id="e4d79-164">Then, run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="e4d79-165">När du genomför den här redundansen data kommer att tillbaka lokalt och du behöver tooenable replikering tooAzure igen.</span><span class="sxs-lookup"><span data-stu-id="e4d79-165">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span>

<span data-ttu-id="e4d79-166">Återställning av komponenter är:</span><span class="sxs-lookup"><span data-stu-id="e4d79-166">Failback components include:</span></span>

- <span data-ttu-id="e4d79-167">**Tillfällig processerver i Azure**: du behöver tooset in en Azure VM tooact som en processerver, toohandle replikering från Azure.</span><span class="sxs-lookup"><span data-stu-id="e4d79-167">**Temporary process server in Azure**: You need tooset up an Azure VM tooact as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="e4d79-168">Du kan ta bort den här virtuella datorn när återställningen är klar.</span><span class="sxs-lookup"><span data-stu-id="e4d79-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="e4d79-169">**VPN-anslutning**: du behöver en VPN-anslutning (eller Azure ExpressRoute) från hello Azure toohello lokal nätverksplats.</span><span class="sxs-lookup"><span data-stu-id="e4d79-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="e4d79-170">**Separat lokal huvudmålserver**: hello lokala huvudmålservern (installeras som standard på hello konfigurationsservern) hanterar återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="e4d79-170">**Separate on-premises master target server**: hello on-premises master target server (installed by default on hello configuration server) handles failback.</span></span> <span data-ttu-id="e4d79-171">Om du växlar tillbaka stora volymer trafik bör du ställa in en separat lokal huvudmålserver för detta ändamål.</span><span class="sxs-lookup"><span data-stu-id="e4d79-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="e4d79-172">**Princip för återställning efter fel**: du behöver en princip för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="e4d79-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="e4d79-173">Denna skapas automatiskt när du skapade din replikeringsprincip.</span><span class="sxs-lookup"><span data-stu-id="e4d79-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="e4d79-174">**VMware-infrastrukturen**: du måste växla tillbaka tooan lokal VMware VM.</span><span class="sxs-lookup"><span data-stu-id="e4d79-174">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="e4d79-175">Det innebär du behöver en lokal VMware-infrastruktur, även om du replikerar lokala fysiska servrar tooAzure.</span><span class="sxs-lookup"><span data-stu-id="e4d79-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="e4d79-176">**Bild 3: Fysisk server återställning efter fel**</span><span class="sxs-lookup"><span data-stu-id="e4d79-176">**Figure 3: Physical server failback**</span></span>

![Återställning efter fel](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="e4d79-178">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="e4d79-178">Next steps</span></span>

<span data-ttu-id="e4d79-179">Gå för[steg 2: Verifiera förutsättningar och begränsningar](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="e4d79-179">Go too[Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>
