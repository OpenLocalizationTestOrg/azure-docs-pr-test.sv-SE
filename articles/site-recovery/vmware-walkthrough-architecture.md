---
title: "aaaReview hello arkitektur för VMware replikering tooAzure | Microsoft Docs"
description: "Den här artikeln innehåller en översikt över komponenter och arkitektur som används för att replikera lokala virtuella VMware-datorer tooAzure med hello Azure Site Recovery-tjänsten"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27.017
ms.author: raynew
ms.openlocfilehash: 7acb1d8e83a846dca79e175fd1af9324f2c31e65
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="step-1-review-hello-architecture-for-vmware-replication-tooazure"></a><span data-ttu-id="b1602-103">Steg 1: Granska hello arkitektur för tooAzure för VMware-replikering</span><span class="sxs-lookup"><span data-stu-id="b1602-103">Step 1: Review hello architecture for VMware replication tooAzure</span></span>

<span data-ttu-id="b1602-104">Den här artikeln beskriver hello komponenter och processer som används när replikera lokala VMware virtuella datorer tooAzure med hello [Azure Site Recovery](site-recovery-overview.md) service.</span><span class="sxs-lookup"><span data-stu-id="b1602-104">This article describes hello components and processes used when replicating on-premises VMware virtual machines tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="b1602-105">Skicka kommentarer längst ned hello i den här artikeln eller ställa frågor i hello [Azure Recovery Services-forumet](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="b1602-105">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="b1602-106">Arkitekturkomponenter</span><span class="sxs-lookup"><span data-stu-id="b1602-106">Architectural components</span></span>

<span data-ttu-id="b1602-107">hello tabell sammanfattas hello-komponenter som du behöver.</span><span class="sxs-lookup"><span data-stu-id="b1602-107">hello table summarizes hello components you need.</span></span>

<span data-ttu-id="b1602-108">**Komponent**</span><span class="sxs-lookup"><span data-stu-id="b1602-108">**Component**</span></span> | <span data-ttu-id="b1602-109">**Krav**</span><span class="sxs-lookup"><span data-stu-id="b1602-109">**Requirement**</span></span> | <span data-ttu-id="b1602-110">**Detaljer**</span><span class="sxs-lookup"><span data-stu-id="b1602-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="b1602-111">**Azure**</span><span class="sxs-lookup"><span data-stu-id="b1602-111">**Azure**</span></span> | <span data-ttu-id="b1602-112">Du behöver en Azure-prenumeration, ett Azure storage-konto och ett Azure-nätverk.</span><span class="sxs-lookup"><span data-stu-id="b1602-112">You need an Azure subscription, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="b1602-113">Replikerade data lagras i hello storage-konto.</span><span class="sxs-lookup"><span data-stu-id="b1602-113">Replicated data is stored in hello storage account.</span></span> <span data-ttu-id="b1602-114">Virtuella Azure-datorer skapas med hello replikerade data när det uppstår redundans från din lokala plats.</span><span class="sxs-lookup"><span data-stu-id="b1602-114">Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="b1602-115">hello Azure virtuella datorer ansluta toohello virtuella Azure-nätverket när de skapas.</span><span class="sxs-lookup"><span data-stu-id="b1602-115">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="b1602-116">**Konfigurationsserver**</span><span class="sxs-lookup"><span data-stu-id="b1602-116">**Configuration server**</span></span> | <span data-ttu-id="b1602-117">En enda lokal hanteringsserver (VMware VM) som kör alla hello lokala Site Recovery-komponenter för distribution av hello.</span><span class="sxs-lookup"><span data-stu-id="b1602-117">A single on-premises management server (VMware VM) that runs all hello on-premises Site Recovery components for hello deployment.</span></span> <span data-ttu-id="b1602-118">Dessa inkluderar en konfigurationsservern, processervern, huvudmålservern.</span><span class="sxs-lookup"><span data-stu-id="b1602-118">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="b1602-119">Hej konfigurationsserverkomponent samordnar kommunikationen mellan lokala och Azure och hanterar datareplikering.</span><span class="sxs-lookup"><span data-stu-id="b1602-119">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="b1602-120">**Processerver**:</span><span class="sxs-lookup"><span data-stu-id="b1602-120">**Process server**:</span></span>  | <span data-ttu-id="b1602-121">Installeras som standard på hello konfigurationsservern.</span><span class="sxs-lookup"><span data-stu-id="b1602-121">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="b1602-122">Fungerar som en replikeringsgateway.</span><span class="sxs-lookup"><span data-stu-id="b1602-122">Acts as a replication gateway.</span></span> <span data-ttu-id="b1602-123">Tar emot replikeringsdata, optimerar dem med cachelagring, komprimering och kryptering och skickar det tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="b1602-123">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="b1602-124">Hej processervern också hanterar push-installation av hello Mobility service tooprotected datorer och utför automatisk identifiering av virtuella VMware-datorer.</span><span class="sxs-lookup"><span data-stu-id="b1602-124">hello process server also handles push installation of hello Mobility service tooprotected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="b1602-125">Eftersom distributionen växer kan du lägga till ytterligare separata dedikerade processer servrar toohandle öka mängder replikeringstrafik.</span><span class="sxs-lookup"><span data-stu-id="b1602-125">As your deployment grows you can add additional separate dedicated process servers toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="b1602-126">**Huvudmålservern**</span><span class="sxs-lookup"><span data-stu-id="b1602-126">**Master target server**</span></span> | <span data-ttu-id="b1602-127">Installeras som standard på hello lokalt konfigurationsservern.</span><span class="sxs-lookup"><span data-stu-id="b1602-127">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="b1602-128">Hanterar replikeringsdata vid återställning efter fel från Azure.</span><span class="sxs-lookup"><span data-stu-id="b1602-128">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="b1602-129">Om trafikvolymer för återställning efter fel är stora, kan du distribuera en separat huvudmålserver för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="b1602-129">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="b1602-130">**VMware-servrar**</span><span class="sxs-lookup"><span data-stu-id="b1602-130">**VMware servers**</span></span> | <span data-ttu-id="b1602-131">Virtuella VMware-datorer finns på vSphere ESXi servrar och vi rekommenderar en vCenter server toomanage hello-värdar.</span><span class="sxs-lookup"><span data-stu-id="b1602-131">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server toomanage hello hosts.</span></span> | <span data-ttu-id="b1602-132">Du lägger till VMware-servrar tooyour Recovery Services-valvet.</span><span class="sxs-lookup"><span data-stu-id="b1602-132">You add VMware servers tooyour Recovery Services vault.</span></span>
<span data-ttu-id="b1602-133">**Replikerade datorer**</span><span class="sxs-lookup"><span data-stu-id="b1602-133">**Replicated machines**</span></span> | <span data-ttu-id="b1602-134">Hej mobilitetstjänsten installeras på varje VMware VM du replikera.</span><span class="sxs-lookup"><span data-stu-id="b1602-134">hello Mobility service will be installed on each VMware VM you replicate.</span></span> <span data-ttu-id="b1602-135">Den kan installeras manuellt på varje dator eller med en push-installation från hello processervern.</span><span class="sxs-lookup"><span data-stu-id="b1602-135">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>

<span data-ttu-id="b1602-136">**Bild 1: VMware tooAzure komponenter**</span><span class="sxs-lookup"><span data-stu-id="b1602-136">**Figure 1: VMware tooAzure components**</span></span>

![Komponenter](./media/vmware-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="b1602-138">Replikeringsprocessen</span><span class="sxs-lookup"><span data-stu-id="b1602-138">Replication process</span></span>

1. <span data-ttu-id="b1602-139">Du kan konfigurera hello-distribution, inklusive lokalt och Azure-komponenter.</span><span class="sxs-lookup"><span data-stu-id="b1602-139">You set up hello deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="b1602-140">I hello Recovery Services-valvet anger du hello replikeringskälla och mål, ställa in hello konfigurationsservern och skapa en replikeringsprincip, distribuera hello mobilitetstjänsten, aktivera replikering och köra ett redundanstest.</span><span class="sxs-lookup"><span data-stu-id="b1602-140">In hello Recovery Services vault, you specify hello replication source and target, set up hello configuration server, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2. <span data-ttu-id="b1602-141">Replikera datorer enligt hello replikeringsprinciper och en inledande kopia av hello data är replikerade tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="b1602-141">Machines replicate in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
3. <span data-ttu-id="b1602-142">Replikering av delta ändringar tooAzure börjar när replikeringen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="b1602-142">After initial replication finishes, replication of delta changes tooAzure begins.</span></span> <span data-ttu-id="b1602-143">Spårade ändringar för en dator lagras i en .hrl-fil.</span><span class="sxs-lookup"><span data-stu-id="b1602-143">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="b1602-144">Replikera datorer kommunicerar med hello konfigurationsservern på port 443 för HTTPS inkommande för replikeringshantering av.</span><span class="sxs-lookup"><span data-stu-id="b1602-144">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="b1602-145">Replikera datorer skickar replikering data toohello processervern på port HTTPS 9443 inkommande (kan ändras).</span><span class="sxs-lookup"><span data-stu-id="b1602-145">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="b1602-146">hello konfigurationsservern samordnar replikeringshantering med Azure via port 443 för HTTPS utgående.</span><span class="sxs-lookup"><span data-stu-id="b1602-146">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="b1602-147">hello processervern tar emot data från källdatorer, optimerar och krypteras det och skickar det tooAzure lagring via port 443 utgående.</span><span class="sxs-lookup"><span data-stu-id="b1602-147">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="b1602-148">Om du aktiverar konsekvens för flera kommunicerar datorer i hello replikeringsgrupp med varandra via port 20004.</span><span class="sxs-lookup"><span data-stu-id="b1602-148">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="b1602-149">Multi-VM används om du grupperar flera datorer i replikeringsgrupper som delar kraschkonsekventa och app-konsekventa återställningspunkter när de växlar över vid fel.</span><span class="sxs-lookup"><span data-stu-id="b1602-149">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="b1602-150">Detta är användbart om datorerna kör hello samma arbetsbelastning och måste toobe konsekvent.</span><span class="sxs-lookup"><span data-stu-id="b1602-150">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
4. <span data-ttu-id="b1602-151">Trafiken är replikerade tooAzure lagring offentliga slutpunkter över hello internet.</span><span class="sxs-lookup"><span data-stu-id="b1602-151">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="b1602-152">Du kan även använda Azure ExpressRoute [offentlig peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span><span class="sxs-lookup"><span data-stu-id="b1602-152">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="b1602-153">Replikera trafik via ett plats-till-plats-VPN från en lokal plats tooAzure stöds inte.</span><span class="sxs-lookup"><span data-stu-id="b1602-153">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>


<span data-ttu-id="b1602-154">**Bild 2: VMware tooAzure-replikering**</span><span class="sxs-lookup"><span data-stu-id="b1602-154">**Figure 2: VMware tooAzure replication**</span></span>

![Optimerad](./media/vmware-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="b1602-156">Processen för redundans och återställning efter fel</span><span class="sxs-lookup"><span data-stu-id="b1602-156">Failover and failback process</span></span>

1. <span data-ttu-id="b1602-157">När du har kontrollerat att redundanstestet fungerar som förväntat kan du köra oplanerade växlingar tooAzure som krävs.</span><span class="sxs-lookup"><span data-stu-id="b1602-157">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="b1602-158">Planerad redundans stöds inte.</span><span class="sxs-lookup"><span data-stu-id="b1602-158">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="b1602-159">Du kan växla över en enskild dator eller skapa [återställningsplaner](site-recovery-create-recovery-plans.md), toofail över flera virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="b1602-159">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple VMs.</span></span>
3. <span data-ttu-id="b1602-160">När du kör en redundans skapas virtuella replikdatorer i Azure.</span><span class="sxs-lookup"><span data-stu-id="b1602-160">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="b1602-161">Du genomför en växling vid fel toostart använder hello arbetsbelastning från hello repliken Azure VM.</span><span class="sxs-lookup"><span data-stu-id="b1602-161">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
4. <span data-ttu-id="b1602-162">När din primära lokala plats är tillgänglig igen, kan du återställa dit.</span><span class="sxs-lookup"><span data-stu-id="b1602-162">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="b1602-163">Du ställer in en infrastruktur för återställning efter fel, starta replikering hello datorn från hello sekundär plats toohello primära och köra oplanerad växling från hello sekundär plats.</span><span class="sxs-lookup"><span data-stu-id="b1602-163">You set up a failback infrastructure, start replicating hello machine from hello secondary site toohello primary, and run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="b1602-164">När du genomför den här redundansen data kommer att tillbaka lokalt och du behöver tooenable replikering tooAzure igen.</span><span class="sxs-lookup"><span data-stu-id="b1602-164">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span> [<span data-ttu-id="b1602-165">Läs mer</span><span class="sxs-lookup"><span data-stu-id="b1602-165">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="b1602-166">Det finns några återställningskrav:</span><span class="sxs-lookup"><span data-stu-id="b1602-166">There are a few failback requirements:</span></span>


- <span data-ttu-id="b1602-167">**Tillfällig processerver i Azure**: Om du vill ha toofail tillbaka från Azure efter växling vid fel måste tooset upp en Azure VM som konfigurerats som en processerver toohandle replikering från Azure.</span><span class="sxs-lookup"><span data-stu-id="b1602-167">**Temporary process server in Azure**: If you want toofail back from Azure after failover you'll need tooset up an Azure VM configured as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="b1602-168">Du kan ta bort den här virtuella datorn när återställningen är klar.</span><span class="sxs-lookup"><span data-stu-id="b1602-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="b1602-169">**VPN-anslutning**: för återställning efter fel behöver du en VPN-anslutning (eller Azure ExpressRoute) Konfigurera från hello Azure toohello lokal nätverksplats.</span><span class="sxs-lookup"><span data-stu-id="b1602-169">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="b1602-170">**Separat lokal huvudmålserver**: hello lokala huvudmålservern hanterar återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="b1602-170">**Separate on-premises master target server**: hello on-premises master target server handles failback.</span></span> <span data-ttu-id="b1602-171">Hej huvudmålservern installeras som standard på hello hanteringsservern, men om du växlar tillbaka större volymer trafik bör du ställa in en separat lokal huvudmålserver för detta ändamål.</span><span class="sxs-lookup"><span data-stu-id="b1602-171">hello master target server is installed by default on hello management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="b1602-172">**Princip för återställning efter fel**: tooreplicate tillbaka tooyour lokal plats måste du en princip för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="b1602-172">**Failback policy**: tooreplicate back tooyour on-premises site, you need a failback policy.</span></span> <span data-ttu-id="b1602-173">Denna skapas automatiskt när du skapade din replikeringsprincip.</span><span class="sxs-lookup"><span data-stu-id="b1602-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="b1602-174">**VMware-infrastrukturen**: du måste växla tillbaka tooan lokal VMware VM.</span><span class="sxs-lookup"><span data-stu-id="b1602-174">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="b1602-175">Det innebär du behöver en lokal VMware-infrastruktur, även om du replikerar lokala fysiska servrar tooAzure.</span><span class="sxs-lookup"><span data-stu-id="b1602-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="b1602-176">**Bild 3: VMware/fysisk återställning efter fel**</span><span class="sxs-lookup"><span data-stu-id="b1602-176">**Figure 3: VMware/physical failback**</span></span>

![Återställning efter fel](./media/vmware-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="b1602-178">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="b1602-178">Next steps</span></span>

<span data-ttu-id="b1602-179">Gå för[steg 2: Verifiera förutsättningar och begränsningar](vmware-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="b1602-179">Go too[Step 2: Verify prerequisites and limitations](vmware-walkthrough-prerequisites.md)</span></span>
