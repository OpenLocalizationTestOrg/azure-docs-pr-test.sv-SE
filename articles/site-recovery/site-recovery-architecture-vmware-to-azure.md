---
title: aaaHow hanterar VMware replikering tooAzure arbete i Azure Site Recovery? | Microsoft Docs
description: "Den här artikeln innehåller en översikt över komponenter och arkitektur som används när replikera lokala virtuella VMware-datorer och fysiska servrar tooAzure med hello Azure Site Recovery-tjänsten"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/29/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-architecture
ms.openlocfilehash: f0fb834f8b251640f97e4d0163b2b9e54de691e1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-vmware-replication-tooazure-work-in-site-recovery"></a><span data-ttu-id="1c1c0-104">Hur fungerar VMware replikering tooAzure i Site Recovery?</span><span class="sxs-lookup"><span data-stu-id="1c1c0-104">How does VMware replication tooAzure work in Site Recovery?</span></span>

<span data-ttu-id="1c1c0-105">Den här artikeln beskriver hello komponenter och processer som är inblandade vid replikering av lokala VMware virtuella datorer och Windows-/ Linux fysiska servrar, tooAzure med hello [Azure Site Recovery](site-recovery-overview.md) service.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-105">This article describes hello components and processes involved when replicating on-premises VMware virtual machines, and Windows/Linux physical servers, tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="1c1c0-106">När du replikerar fysiska, lokala servrar tooAzure hello replikering använder även samma komponenter och processer som VMware VM replikering med dessa skillnader:</span><span class="sxs-lookup"><span data-stu-id="1c1c0-106">When you replicate physical on-premises servers tooAzure, replication uses also hello same components and processes as VMware VM replication, with these differences:</span></span>

- <span data-ttu-id="1c1c0-107">Du kan använda en fysisk server för hello konfigurationsservern och i stället för en VMware VM.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-107">You can use a physical server for hello configuration server, instead of a VMware VM.</span></span>
- <span data-ttu-id="1c1c0-108">Du behöver en lokal VMware-infrastruktur för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-108">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="1c1c0-109">Du kan inte växla tillbaka tooa fysisk dator.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-109">You can't fail back tooa physical machine.</span></span>

<span data-ttu-id="1c1c0-110">Skicka kommentarer längst ned hello i den här artikeln eller ställa frågor i hello [Azure Recovery Services-forumet](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="1c1c0-110">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="1c1c0-111">Arkitekturkomponenter</span><span class="sxs-lookup"><span data-stu-id="1c1c0-111">Architectural components</span></span>

<span data-ttu-id="1c1c0-112">Det finns ett antal komponenter ingår vid replikering av virtuella VMware-datorer och fysiska servrar tooAzure.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-112">There are a number of components involved when replicating VMware VMs and physical servers tooAzure.</span></span>

<span data-ttu-id="1c1c0-113">**Komponent**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-113">**Component**</span></span> | <span data-ttu-id="1c1c0-114">**Plats**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-114">**Location**</span></span> | <span data-ttu-id="1c1c0-115">**Detaljer**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-115">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="1c1c0-116">**Azure**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-116">**Azure**</span></span> | <span data-ttu-id="1c1c0-117">I Azure behöver du ett Azure-konto, ett Azure-lagringskonto och ett Azure-nätverk.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-117">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="1c1c0-118">Replikerade data lagras i hello storage-konto och virtuella Azure-datorer skapas med hello replikerade data när det uppstår redundans från din lokala plats.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-118">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="1c1c0-119">hello Azure virtuella datorer ansluta toohello virtuella Azure-nätverket när de skapas.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-119">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="1c1c0-120">**Konfigurationsserver**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-120">**Configuration server**</span></span> | <span data-ttu-id="1c1c0-121">En enda lokal hanteringsserver (VMWare VM) som kör alla hello lokala komponenter som behövs för hello-distribution, inklusive hello konfigurationsservern, processervern och huvudmålservern</span><span class="sxs-lookup"><span data-stu-id="1c1c0-121">A single on-premises management server (VMWare VM) that runs all hello on-premises components that are needed for hello deployment, including hello configuration server, process server, master target server</span></span> | <span data-ttu-id="1c1c0-122">Hej konfigurationsserverkomponent samordnar kommunikationen mellan lokala och Azure och hanterar datareplikering.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-122">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="1c1c0-123">**Processerver**:</span><span class="sxs-lookup"><span data-stu-id="1c1c0-123">**Process server**:</span></span>  | <span data-ttu-id="1c1c0-124">Installeras som standard på hello konfigurationsservern.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-124">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="1c1c0-125">Fungerar som en replikeringsgateway.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-125">Acts as a replication gateway.</span></span> <span data-ttu-id="1c1c0-126">Tar emot replikeringsdata, optimerar dem med cachelagring, komprimering och kryptering och skickar det tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-126">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="1c1c0-127">Hej processervern också hanterar push-installation av hello Mobility service tooprotected datorer och utför automatisk identifiering av virtuella VMware-datorer.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-127">hello process server also handles push installation of hello Mobility service tooprotected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="1c1c0-128">Eftersom distributionen växer kan du lägga till ytterligare separata dedikerade processer servrar toohandle öka mängder replikeringstrafik.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-128">As your deployment grows you can add additional separate dedicated process servers toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="1c1c0-129">**Huvudmålservern**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-129">**Master target server**</span></span> | <span data-ttu-id="1c1c0-130">Installeras som standard på hello lokalt konfigurationsservern.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-130">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="1c1c0-131">Hanterar replikeringsdata vid återställning efter fel från Azure.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-131">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="1c1c0-132">Om trafikvolymer för återställning efter fel är stora, kan du distribuera en separat huvudmålserver för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-132">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="1c1c0-133">**VMware-servrar**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-133">**VMware servers**</span></span> | <span data-ttu-id="1c1c0-134">Virtuella VMware-datorer finns på vSphere ESXi servrar och vi rekommenderar en vCenter server toomanage hello-värdar.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-134">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server toomanage hello hosts.</span></span> | <span data-ttu-id="1c1c0-135">Du lägger till VMware-servrar tooyour Recovery Services-valvet.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-135">You add VMware servers tooyour Recovery Services vault.</span></span>
<span data-ttu-id="1c1c0-136">**Replikerade datorer**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-136">**Replicated machines**</span></span> | <span data-ttu-id="1c1c0-137">Hej mobilitetstjänsten installeras på varje VMware VM som du vill tooreplicate.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-137">hello Mobility service will be installed on each VMware VM you want tooreplicate.</span></span> <span data-ttu-id="1c1c0-138">Den kan installeras manuellt på varje dator eller med en push-installation från hello processervern.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-138">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>

<span data-ttu-id="1c1c0-139">Lär dig mer om kraven för distribution av hello och krav för var och en av komponenterna i hello [supportmatrisen](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="1c1c0-139">Learn about hello deployment prerequisites and requirements for each of these components in hello [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="1c1c0-140">**Bild 1: VMware tooAzure komponenter**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-140">**Figure 1: VMware tooAzure components**</span></span>

![Komponenter](./media/site-recovery-components/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="1c1c0-142">Replikeringsprocessen</span><span class="sxs-lookup"><span data-stu-id="1c1c0-142">Replication process</span></span>

1. <span data-ttu-id="1c1c0-143">Du kan konfigurera hello-distribution, inklusive Azure komponenter och Recovery Services-valvet.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-143">You set up hello deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="1c1c0-144">I hello valvet anger du hello replikeringskälla och mål, ställa in hello konfigurationsservern och lägga till VMware-servrar, skapa en replikeringsprincip, distribuera hello mobilitetstjänsten, aktivera replikering och köra ett redundanstest.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-144">In hello vault you specify hello replication source and target, set up hello configuration server, add VMware servers, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="1c1c0-145">Datorer starta replikeringen i enlighet med hello replikeringsprinciper och en inledande kopia av hello data är replikerade tooAzure lagring.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-145">Machines start replicating in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="1c1c0-146">Replikering av delta ändringar tooAzure börjar när hello replikeringen har slutförts.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-146">Replication of delta changes tooAzure begins after hello initial replication finishes.</span></span> <span data-ttu-id="1c1c0-147">Spårade ändringar för en dator lagras i en .hrl-fil.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-147">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="1c1c0-148">Replikera datorer kommunicerar med hello konfigurationsservern på port 443 för HTTPS inkommande för replikeringshantering av.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-148">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="1c1c0-149">Replikera datorer skickar replikering data toohello processervern på port HTTPS 9443 inkommande (kan konfigureras).</span><span class="sxs-lookup"><span data-stu-id="1c1c0-149">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="1c1c0-150">hello konfigurationsservern samordnar replikeringshantering med Azure via port 443 för HTTPS utgående.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-150">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="1c1c0-151">hello processervern tar emot data från källdatorer, optimerar och krypteras det och skickar det tooAzure lagring via port 443 utgående.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-151">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="1c1c0-152">Om du aktiverar konsekvens för flera kommunicerar datorer i hello replikeringsgrupp med varandra via port 20004.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-152">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="1c1c0-153">Multi-VM används om du grupperar flera datorer i replikeringsgrupper som delar kraschkonsekventa och app-konsekventa återställningspunkter när de växlar över vid fel.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-153">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="1c1c0-154">Detta är användbart om datorerna kör hello samma arbetsbelastning och måste toobe konsekvent.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-154">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="1c1c0-155">Trafiken är replikerade tooAzure lagring offentliga slutpunkter över hello internet.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-155">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="1c1c0-156">Du kan även använda Azure ExpressRoute [offentlig peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span><span class="sxs-lookup"><span data-stu-id="1c1c0-156">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="1c1c0-157">Replikera trafik via ett plats-till-plats-VPN från en lokal plats tooAzure stöds inte.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-157">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="1c1c0-158">**Bild 2: VMware tooAzure-replikering**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-158">**Figure 2: VMware tooAzure replication**</span></span>

![Optimerad](./media/site-recovery-components/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="1c1c0-160">Processen för redundans och återställning efter fel</span><span class="sxs-lookup"><span data-stu-id="1c1c0-160">Failover and failback process</span></span>

1. <span data-ttu-id="1c1c0-161">När du har kontrollerat att redundanstestet fungerar som förväntat kan du köra oplanerade växlingar tooAzure som krävs.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-161">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="1c1c0-162">Planerad redundans stöds inte.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-162">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="1c1c0-163">Du kan växla över en enskild dator eller skapa [återställningsplaner](site-recovery-create-recovery-plans.md), toofail över flera virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-163">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple VMs.</span></span>
3. <span data-ttu-id="1c1c0-164">När du kör en redundans skapas virtuella replikdatorer i Azure.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-164">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="1c1c0-165">Du genomför en växling vid fel toostart använder hello arbetsbelastning från hello repliken Azure VM.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-165">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
4. <span data-ttu-id="1c1c0-166">När din primära lokala plats är tillgänglig igen, kan du återställa dit.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-166">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="1c1c0-167">Du ställer in en infrastruktur för återställning efter fel, starta replikering hello datorn från hello sekundär plats toohello primära och köra oplanerad växling från hello sekundär plats.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-167">You set up a failback infrastructure, start replicating hello machine from hello secondary site toohello primary, and run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="1c1c0-168">När du genomför den här redundansen data kommer att tillbaka lokalt och du behöver tooenable replikering tooAzure igen.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-168">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span> [<span data-ttu-id="1c1c0-169">Läs mer</span><span class="sxs-lookup"><span data-stu-id="1c1c0-169">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="1c1c0-170">Det finns några återställningskrav:</span><span class="sxs-lookup"><span data-stu-id="1c1c0-170">There are a few failback requirements:</span></span>


- <span data-ttu-id="1c1c0-171">**Tillfällig processerver i Azure**: Om du vill ha toofail tillbaka från Azure efter växling vid fel måste tooset upp en Azure VM som konfigurerats som en processerver toohandle replikering från Azure.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-171">**Temporary process server in Azure**: If you want toofail back from Azure after failover you'll need tooset up an Azure VM configured as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="1c1c0-172">Du kan ta bort den här virtuella datorn när återställningen är klar.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-172">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="1c1c0-173">**VPN-anslutning**: för återställning efter fel behöver du en VPN-anslutning (eller Azure ExpressRoute) Konfigurera från hello Azure toohello lokal nätverksplats.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-173">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="1c1c0-174">**Separat lokal huvudmålserver**: hello lokala huvudmålservern hanterar återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-174">**Separate on-premises master target server**: hello on-premises master target server handles failback.</span></span> <span data-ttu-id="1c1c0-175">Hej huvudmålservern installeras som standard på hello hanteringsservern, men om du växlar tillbaka större volymer trafik bör du ställa in en separat lokal huvudmålserver för detta ändamål.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-175">hello master target server is installed by default on hello management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="1c1c0-176">**Princip för återställning efter fel**: tooreplicate tillbaka tooyour lokal plats måste du en princip för återställning efter fel.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-176">**Failback policy**: tooreplicate back tooyour on-premises site, you need a failback policy.</span></span> <span data-ttu-id="1c1c0-177">Denna skapas automatiskt när du skapade din replikeringsprincip.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-177">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="1c1c0-178">**VMware-infrastrukturen**: du måste växla tillbaka tooan lokal VMware VM.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-178">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="1c1c0-179">Det innebär du behöver en lokal VMware-infrastruktur, även om du replikerar lokala fysiska servrar tooAzure.</span><span class="sxs-lookup"><span data-stu-id="1c1c0-179">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="1c1c0-180">**Bild 3: VMware/fysisk återställning efter fel**</span><span class="sxs-lookup"><span data-stu-id="1c1c0-180">**Figure 3: VMware/physical failback**</span></span>

![Återställning efter fel](./media/site-recovery-components/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="1c1c0-182">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="1c1c0-182">Next steps</span></span>

<span data-ttu-id="1c1c0-183">Granska hello [supportmatrisen](site-recovery-support-matrix-to-azure.md)</span><span class="sxs-lookup"><span data-stu-id="1c1c0-183">Review hello [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
