# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="a8835-101">Säkerhetskopiera Azure ohanterade Virtuella diskar med inkrementell ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="a8835-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="a8835-102">Översikt</span><span class="sxs-lookup"><span data-stu-id="a8835-102">Overview</span></span>
<span data-ttu-id="a8835-103">Azure Storage ger hello tootake ögonblicksbilder av blobbar.</span><span class="sxs-lookup"><span data-stu-id="a8835-103">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="a8835-104">Ögonblicksbilder avbilda hello blob tillstånd vid den punkten i tid.</span><span class="sxs-lookup"><span data-stu-id="a8835-104">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="a8835-105">I den här artikeln beskriver vi ett scenario där du kan underhålla säkerhetskopior av virtuella diskar med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="a8835-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="a8835-106">Du kan använda den här metoden när du väljer att inte toouse Azure Backup och Recovery-tjänsten och vill toocreate en anpassad strategi för säkerhetskopiering för virtuella diskar.</span><span class="sxs-lookup"><span data-stu-id="a8835-106">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="a8835-107">Azure virtuella diskar lagras som sidblobbar i Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="a8835-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="a8835-108">Eftersom vi som en strategi för säkerhetskopiering för virtuella diskar i den här artikeln beskriver refererar vi toosnapshots hello gäller sidblobar.</span><span class="sxs-lookup"><span data-stu-id="a8835-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="a8835-109">toolearn mer om ögonblicksbilder finns för[skapa en ögonblicksbild av en Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="a8835-109">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="a8835-110">Vad är en ögonblicksbild?</span><span class="sxs-lookup"><span data-stu-id="a8835-110">What is a snapshot?</span></span>
<span data-ttu-id="a8835-111">En blob-ögonblicksbild är en skrivskyddad version av en blob som hämtas vid en viss tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="a8835-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="a8835-112">När en ögonblicksbild har skapats, kan den läsa, kopieras, eller ta bort, men inte har ändrats.</span><span class="sxs-lookup"><span data-stu-id="a8835-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="a8835-113">Ögonblicksbilder ger ett sätt tooback upp en blob som det visas vid en tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="a8835-113">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="a8835-114">Tills REST version 2015-04-05 hade hello möjlighet toocopy fullständiga ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="a8835-114">Until REST version 2015-04-05, you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="a8835-115">Med hello REST version 2015-07-08 och senare, du kan också kopiera inkrementell ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="a8835-115">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="a8835-116">Fullständig ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="a8835-116">Full snapshot copy</span></span>
<span data-ttu-id="a8835-117">Ögonblicksbilder kan vara kopieras tooanother storage-konto som en blob tookeep säkerhetskopior av grundläggande hello-blob.</span><span class="sxs-lookup"><span data-stu-id="a8835-117">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="a8835-118">Du kan också kopiera en ögonblicksbild över grundläggande blob, vilket är så återställer hello blob tooan tidigare version.</span><span class="sxs-lookup"><span data-stu-id="a8835-118">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="a8835-119">När en ögonblicksbild har kopierats från en storage-konto tooanother upptar hello samma utrymme som hello bassida blob.</span><span class="sxs-lookup"><span data-stu-id="a8835-119">When a snapshot is copied from one storage account tooanother, it occupies hello same space as hello base page blob.</span></span> <span data-ttu-id="a8835-120">Därför kopiera hela ögonblicksbilder från en storage-konto tooanother går långsamt och tar upp mycket utrymme i hello mål-lagringskontot.</span><span class="sxs-lookup"><span data-stu-id="a8835-120">Therefore, copying whole snapshots from one storage account tooanother is slow and consumes much space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="a8835-121">Om du kopierar hello grundläggande blob tooanother mål, kopieras inte hello ögonblicksbilder av hello blob tillsammans med den.</span><span class="sxs-lookup"><span data-stu-id="a8835-121">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="a8835-122">Om du skriver över en grundläggande blob med en kopia ögonblicksbilder kopplade till grundläggande hello-blob påverkas inte och ändras inte under hello grundläggande blobbnamnet.</span><span class="sxs-lookup"><span data-stu-id="a8835-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under hello base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="a8835-123">Säkerhetskopiera diskar med hjälp av ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="a8835-123">Back up disks using snapshots</span></span>
<span data-ttu-id="a8835-124">Som en strategi för säkerhetskopiering för virtuella diskar, kan du ta regelbundna ögonblicksbilder av hello disk- eller blob och kopiera dem tooanother lagringskonto med hjälp av verktyg som [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) åtgärden eller [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="a8835-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="a8835-125">Du kan kopiera en ögonblicksbild tooa mål sidblob med ett annat namn.</span><span class="sxs-lookup"><span data-stu-id="a8835-125">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="a8835-126">hello resulterande mål sidblob är en skrivbar sidblob och inte en ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="a8835-126">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="a8835-127">Senare i den här artikeln beskrivs stegen tootake säkerhetskopior av virtuella diskar med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="a8835-127">Later in this article, we describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="a8835-128">Återställa diskar med hjälp av ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="a8835-128">Restore disks using snapshots</span></span>
<span data-ttu-id="a8835-129">När det är tid toorestore disk-tooa stabil version som tidigare har hämtats i ett av hello ögonblicksbilder av säkerhetskopior kan du kopiera en ögonblicksbild över hello bassida blob.</span><span class="sxs-lookup"><span data-stu-id="a8835-129">When it is time toorestore your disk tooa stable version that was previously captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="a8835-130">Efter hello ögonblicksbild är upphöjt toohello bassida blob, hello ögonblicksbild fortfarande, men dess källa skrivs över med en kopia som kan vara både läses och skrivs.</span><span class="sxs-lookup"><span data-stu-id="a8835-130">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="a8835-131">Nedan beskrivs stegen toorestore en tidigare version av disken från dess ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="a8835-131">Later in this article we describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="a8835-132">Implementera kopia för fullständig ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="a8835-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="a8835-133">Du kan implementera en fullständig ögonblicksbild kopia hello följande</span><span class="sxs-lookup"><span data-stu-id="a8835-133">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="a8835-134">Ta först en ögonblicksbild av hello grundläggande blob med hello [ögonblicksbild Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) igen.</span><span class="sxs-lookup"><span data-stu-id="a8835-134">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="a8835-135">Sedan kopiera hello ögonblicksbild tooa mål lagring kontot med [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="a8835-135">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="a8835-136">Upprepa den här processen toomaintain säkerhetskopior av din grundläggande blob.</span><span class="sxs-lookup"><span data-stu-id="a8835-136">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="a8835-137">Inkrementell ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="a8835-137">Incremental snapshot copy</span></span>
<span data-ttu-id="a8835-138">hello ny funktion i hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API ger en mycket bättre sätt tooback in hello ögonblicksbilder av din sidblobbar eller diskar.</span><span class="sxs-lookup"><span data-stu-id="a8835-138">hello new feature in hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="a8835-139">hello API returnerar hello lista över ändringar mellan grundläggande hello-blob och hello ögonblicksbilder, vilket minskar hello mängden lagringsutrymme som används för säkerhetskopiering hello-konto.</span><span class="sxs-lookup"><span data-stu-id="a8835-139">hello API returns hello list of changes between hello base blob and hello snapshots, which reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="a8835-140">hello API stöder sidblobar på Premium-lagring samt standardlagring.</span><span class="sxs-lookup"><span data-stu-id="a8835-140">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="a8835-141">Med detta API kan skapa du snabbare och effektivare säkerhetskopieringslösningar för virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="a8835-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="a8835-142">Detta API är tillgängliga med hello REST-version 2015-07-08 och högre.</span><span class="sxs-lookup"><span data-stu-id="a8835-142">This API will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="a8835-143">Inkrementell ögonblicksbild kopia kan du toocopy från en storage-konto tooanother hello skillnaden mellan</span><span class="sxs-lookup"><span data-stu-id="a8835-143">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="a8835-144">Grundläggande blob och dess ögonblicksbild eller</span><span class="sxs-lookup"><span data-stu-id="a8835-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="a8835-145">Två ögonblicksbilder av grundläggande hello-blob</span><span class="sxs-lookup"><span data-stu-id="a8835-145">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="a8835-146">Om hello följande villkor är uppfyllda,</span><span class="sxs-lookup"><span data-stu-id="a8835-146">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="a8835-147">hello-blob har skapats på Jan 1 2016 eller senare.</span><span class="sxs-lookup"><span data-stu-id="a8835-147">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="a8835-148">hello blob som inte skrivas över med [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) eller [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) mellan två ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="a8835-148">hello blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="a8835-149">**Obs**: den här funktionen är tillgänglig för Premium- och Standard Sidblobbar för Azure.</span><span class="sxs-lookup"><span data-stu-id="a8835-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="a8835-150">När du har en anpassad strategi för säkerhetskopiering med hjälp av ögonblicksbilder, kopiera hello ögonblicksbilder från en storage-konto tooanother kan ta lång tid och kan förbruka mycket lagringsutrymme.</span><span class="sxs-lookup"><span data-stu-id="a8835-150">When you have a custom backup strategy using snapshots, copying hello snapshots from one storage account tooanother can be slow and can consume much storage space.</span></span> <span data-ttu-id="a8835-151">Du kan skriva hello skillnaden mellan på varandra följande ögonblicksbilder tooa säkerhetskopiering sidblob istället för att kopiera hello hela ögonblicksbild tooa backup storage-konto.</span><span class="sxs-lookup"><span data-stu-id="a8835-151">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="a8835-152">Det här sättet hello tid toocopy hello utrymme toostore säkerhetskopiering och betydligt.</span><span class="sxs-lookup"><span data-stu-id="a8835-152">This way, hello time toocopy and hello space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="a8835-153">Implementera inkrementell ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="a8835-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="a8835-154">Du kan implementera inkrementell ögonblicksbild kopiera hello följande</span><span class="sxs-lookup"><span data-stu-id="a8835-154">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="a8835-155">Ta en ögonblicksbild av hello grundläggande blob med [ögonblicksbild Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="a8835-155">Take a snapshot of hello base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="a8835-156">Kopiera hello ögonblicksbild toohello mål säkerhetskopieringslagring kontot med [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="a8835-156">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="a8835-157">Detta är hello säkerhetskopiering sidblob.</span><span class="sxs-lookup"><span data-stu-id="a8835-157">This is hello backup page blob.</span></span> <span data-ttu-id="a8835-158">Ta en ögonblicksbild av hello säkerhetskopiering sidblob och lagra den i säkerhetskopieringen hello-konto.</span><span class="sxs-lookup"><span data-stu-id="a8835-158">Take a snapshot of hello backup page blob and store it in hello backup account.</span></span>
* <span data-ttu-id="a8835-159">Ta en annan ögonblicksbild av hello grundläggande blob med hjälp av ögonblicksbilder Blob.</span><span class="sxs-lookup"><span data-stu-id="a8835-159">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="a8835-160">Hämta hello skillnaden mellan hello första och andra ögonblicksbilder av hello grundläggande blob med [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="a8835-160">Get hello difference between hello first and second snapshots of hello base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="a8835-161">Använd hello nya parametern **prevsnapshot**, toospecify hello hello ögonblicksbild som du vill tooget hello skillnaden med DateTime-värdet.</span><span class="sxs-lookup"><span data-stu-id="a8835-161">Use hello new parameter **prevsnapshot**, toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="a8835-162">Om den här parametern finns innehåller hello REST-svaret bara hello-sidor som har ändrats mellan target ögonblicksbild och tidigare ögonblicksbild, inklusive Rensa sidor.</span><span class="sxs-lookup"><span data-stu-id="a8835-162">When this parameter is present, hello REST response includes only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="a8835-163">Använd [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply dessa ändringar toohello säkerhetskopiering sidblob.</span><span class="sxs-lookup"><span data-stu-id="a8835-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="a8835-164">Slutligen kan ta en ögonblicksbild av hello säkerhetskopiering sidblob och lagra den i hello backup storage-konto.</span><span class="sxs-lookup"><span data-stu-id="a8835-164">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="a8835-165">I nästa avsnitt om hello, kommer beskrivs i detalj hur du kan upprätthålla säkerhetskopior av diskar med hjälp av inkrementell ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="a8835-165">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="a8835-166">Scenario</span><span class="sxs-lookup"><span data-stu-id="a8835-166">Scenario</span></span>
<span data-ttu-id="a8835-167">I det här avsnittet beskriver vi ett scenario som omfattar en anpassad strategi för säkerhetskopiering för virtuella diskar med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="a8835-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="a8835-168">Beakta en Azure VM DS-serien med premium-lagring P30 disk ansluten.</span><span class="sxs-lookup"><span data-stu-id="a8835-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="a8835-169">Hej P30 disk med namnet *mypremiumdisk* lagras i ett premiumlagringskonto som kallas *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-169">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="a8835-170">Ett standardlagringskonto kallas *mybackupstdaccount* används för att lagra hello säkerhetskopiering av *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="a8835-170">A standard storage account called *mybackupstdaccount* is used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="a8835-171">Vi vill gärna tookeep en ögonblicksbild av *mypremiumdisk* var 12: e timme.</span><span class="sxs-lookup"><span data-stu-id="a8835-171">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="a8835-172">toolearn om att skapa storage-konto och diskar, referera för[om Azure storage-konton](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="a8835-172">toolearn about creating storage account and disks, refer too[About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="a8835-173">toolearn om hur du säkerhetskopierar virtuella Azure-datorer finns för[planera Azure VM-säkerhetskopieringar](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="a8835-173">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="a8835-174">Steg toomaintain säkerhetskopieringar av en disk med hjälp av inkrementell ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="a8835-174">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="a8835-175">hello följande steg beskriver hur tootake ögonblicksbilder av *mypremiumdisk* och underhålla hello säkerhetskopieringar i *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-175">hello following steps describe how tootake snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="a8835-176">hello säkerhetskopiering är en standard sidblob kallas *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="a8835-176">hello backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="a8835-177">hello säkerhetskopiering sidblob alltid visar hello samma tillstånd som hello senaste ögonblicksbild av *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="a8835-177">hello backup page blob always reflects hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="a8835-178">Skapa hello säkerhetskopiering sidblob för hårddisken premium-lagring genom att ta en ögonblicksbild av *mypremiumdisk* kallas *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="a8835-178">Create hello backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="a8835-179">Kopiera den här ögonblicksbilden toomybackupstdaccount som en sidblobb kallas *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="a8835-179">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="a8835-180">Ta en ögonblicksbild av *mybackupstdpageblob* kallas *mybackupstdpageblob_ss1*med hjälp av [ögonblicksbild Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) och lagra den i *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="a8835-181">Under hello säkerhetskopieringsintervallet, skapar du en annan ögonblicksbild av *mypremiumdisk*, säg *mypremiumdisk_ss2*, och lagra den i *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-181">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="a8835-182">Hämta hello inkrementella ändringar mellan hello två ögonblicksbilder *mypremiumdisk_ss2* och *mypremiumdisk_ss1*med hjälp av [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) på  *mypremiumdisk_ss2* med hello **prevsnapshot** parameterinställning toohello tidsstämpel *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="a8835-182">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with hello **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="a8835-183">Skriva dessa inkrementella ändringar toohello säkerhetskopiering sidblob *mybackupstdpageblob* i *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-183">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="a8835-184">Om det finns borttagna intervall i hello inkrementella ändringar, måste de tas bort från hello säkerhetskopiering sidblob.</span><span class="sxs-lookup"><span data-stu-id="a8835-184">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="a8835-185">Använd [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite inkrementella ändringar toohello säkerhetskopiering sidblob.</span><span class="sxs-lookup"><span data-stu-id="a8835-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="a8835-186">Ta en ögonblicksbild av hello säkerhetskopiering sidblob *mybackupstdpageblob*, kallat *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="a8835-186">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="a8835-187">Ta bort hello tidigare ögonblicksbild *mypremiumdisk_ss1* från premium storage-konto.</span><span class="sxs-lookup"><span data-stu-id="a8835-187">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="a8835-188">Upprepa steg 4 – 6 var säkerhetskopieringsintervallet.</span><span class="sxs-lookup"><span data-stu-id="a8835-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="a8835-189">På så sätt kan du hantera säkerhetskopior av *mypremiumdisk* i ett standardlagringskonto.</span><span class="sxs-lookup"><span data-stu-id="a8835-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Säkerhetskopiera disk med hjälp av inkrementell ögonblicksbilder](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="a8835-191">Steg toorestore en disk från ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="a8835-191">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="a8835-192">Hej följande steg, som beskriver hur toorestore hello premium disk *mypremiumdisk* tooan tidigare ögonblicksbild från hello säkerhetskopiering lagringskonto *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-192">hello following steps, describe how toorestore hello premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="a8835-193">Identifiera hello tidpunkt som du vill toorestore hello premium disk till.</span><span class="sxs-lookup"><span data-stu-id="a8835-193">Identify hello point in time that you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="a8835-194">Anta att den har ögonblicksbilder *mybackupstdpageblob_ss2*, som lagras i hello backup storage-konto *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="a8835-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="a8835-195">Befordra hello ögonblicksbild i mybackupstdaccount, *mybackupstdpageblob_ss2* som hello nya säkerhetskopiering bassida blob *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="a8835-195">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="a8835-196">Ta en ögonblicksbild av den här återställda säkerhetskopiering sidblob, kallas *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="a8835-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="a8835-197">Kopiera hello återställts sidblob *mybackupstdpageblobrestored* från *mybackupstdaccount* för*mypremiumaccount* som hello nya premium disk  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="a8835-197">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="a8835-198">Ta en ögonblicksbild av *mypremiumdiskrestored*, kallat *mypremiumdiskrestored_ss1* för att göra framtida inkrementella säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="a8835-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="a8835-199">Peka hello DS-serien VM toohello återställts disk *mypremiumdiskrestored* och frånkoppling hello gamla *mypremiumdisk* från hello VM.</span><span class="sxs-lookup"><span data-stu-id="a8835-199">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="a8835-200">Börja hello säkerhetskopiering process som beskrivs i föregående avsnitt för hello återställts disken *mypremiumdiskrestored*, med hjälp av hello *mybackupstdpageblobrestored* som hello säkerhetskopiering sidblobb.</span><span class="sxs-lookup"><span data-stu-id="a8835-200">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![Återställa disk från ögonblicksbilder](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="a8835-202">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="a8835-202">Next Steps</span></span>
<span data-ttu-id="a8835-203">Använd hello följande länkar toolearn mer om att skapa ögonblicksbilder av en blob och planera din infrastruktur för säkerhetskopiering av VM.</span><span class="sxs-lookup"><span data-stu-id="a8835-203">Use hello following links toolearn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="a8835-204">Skapa en ögonblicksbild av en Blob</span><span class="sxs-lookup"><span data-stu-id="a8835-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="a8835-205">Planera infrastrukturen för säkerhetskopiering VM</span><span class="sxs-lookup"><span data-stu-id="a8835-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

