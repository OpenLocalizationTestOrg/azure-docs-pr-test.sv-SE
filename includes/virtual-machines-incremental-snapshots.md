# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="4d328-101">Säkerhetskopiera Azure ohanterade Virtuella diskar med inkrementell ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="4d328-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="4d328-102">Översikt</span><span class="sxs-lookup"><span data-stu-id="4d328-102">Overview</span></span>
<span data-ttu-id="4d328-103">Azure Storage ger möjlighet att ta ögonblicksbilder av blobbar.</span><span class="sxs-lookup"><span data-stu-id="4d328-103">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="4d328-104">Ögonblicksbilder avbilda tillståndet blob då i tid.</span><span class="sxs-lookup"><span data-stu-id="4d328-104">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="4d328-105">I den här artikeln beskriver vi ett scenario där du kan underhålla säkerhetskopior av virtuella diskar med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="4d328-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="4d328-106">Du kan använda den här metoden när du inte vill använda Azure Backup och Recovery-tjänsten och vill skapa en anpassad strategi för säkerhetskopiering för virtuella diskar.</span><span class="sxs-lookup"><span data-stu-id="4d328-106">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="4d328-107">Azure virtuella diskar lagras som sidblobbar i Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4d328-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="4d328-108">Eftersom vi som en strategi för säkerhetskopiering för virtuella diskar i den här artikeln beskriver refererar vi till ögonblicksbilder i samband med sidblobar.</span><span class="sxs-lookup"><span data-stu-id="4d328-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer to snapshots in the context of page blobs.</span></span> <span data-ttu-id="4d328-109">Mer information om ögonblicksbilder avser [skapa en ögonblicksbild av en Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="4d328-109">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="4d328-110">Vad är en ögonblicksbild?</span><span class="sxs-lookup"><span data-stu-id="4d328-110">What is a snapshot?</span></span>
<span data-ttu-id="4d328-111">En blob-ögonblicksbild är en skrivskyddad version av en blob som hämtas vid en viss tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="4d328-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="4d328-112">När en ögonblicksbild har skapats, kan den läsa, kopieras, eller ta bort, men inte har ändrats.</span><span class="sxs-lookup"><span data-stu-id="4d328-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="4d328-113">Ögonblicksbilder är ett sätt att säkerhetskopiera en blob som det visas vid en tidpunkt.</span><span class="sxs-lookup"><span data-stu-id="4d328-113">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="4d328-114">Fram vila version 2015-04-05, var du tvungen att kunna kopiera fullständig ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="4d328-114">Until REST version 2015-04-05, you had the ability to copy full snapshots.</span></span> <span data-ttu-id="4d328-115">Med övriga version 2015-07-08 och senare, du kan också kopiera inkrementell ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="4d328-115">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="4d328-116">Fullständig ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="4d328-116">Full snapshot copy</span></span>
<span data-ttu-id="4d328-117">Ögonblicksbilder kan kopieras till ett annat lagringskonto som en blob att säkerhetskopior av grundläggande blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-117">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="4d328-118">Du kan också kopiera en ögonblicksbild över grundläggande blob, vilket är så återställer blob till en tidigare version.</span><span class="sxs-lookup"><span data-stu-id="4d328-118">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="4d328-119">När en ögonblicksbild kopieras från ett lagringskonto till en annan, upptar samma utrymme som bassida-blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-119">When a snapshot is copied from one storage account to another, it occupies the same space as the base page blob.</span></span> <span data-ttu-id="4d328-120">Därför kopiera hela ögonblicksbilder från ett lagringskonto till en annan går långsamt och tar upp mycket utrymme i mål-lagringskontot.</span><span class="sxs-lookup"><span data-stu-id="4d328-120">Therefore, copying whole snapshots from one storage account to another is slow and consumes much space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="4d328-121">Om du kopierar grundläggande blob till ett annat mål, kopieras inte ögonblicksbilder av blob tillsammans med den.</span><span class="sxs-lookup"><span data-stu-id="4d328-121">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="4d328-122">Om du skriver över en grundläggande blob med en kopia ögonblicksbilder kopplade till grundläggande blob påverkas inte och intakta under grundläggande blobbnamnet.</span><span class="sxs-lookup"><span data-stu-id="4d328-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under the base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="4d328-123">Säkerhetskopiera diskar med hjälp av ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="4d328-123">Back up disks using snapshots</span></span>
<span data-ttu-id="4d328-124">Som en strategi för säkerhetskopiering för virtuella diskar, kan du ta regelbundna ögonblicksbilder av disk- eller blob och kopiera dem till en annan storage-konto med hjälp av verktyg som [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) åtgärden eller [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="4d328-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="4d328-125">Du kan kopiera en ögonblicksbild till en mål-sidblob med ett annat namn.</span><span class="sxs-lookup"><span data-stu-id="4d328-125">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="4d328-126">Den resulterande sidblob mål är en skrivbar sidblob och inte en ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="4d328-126">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="4d328-127">Senare i den här artikeln beskrivs stegen för att ta säkerhetskopior av virtuella diskar med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="4d328-127">Later in this article, we describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="4d328-128">Återställa diskar med hjälp av ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="4d328-128">Restore disks using snapshots</span></span>
<span data-ttu-id="4d328-129">När det är dags att återställa disken till en stabil version som tidigare har hämtats i ett av ögonblicksbilderna av säkerhetskopior kan du kopiera en ögonblicksbild över bassida-blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-129">When it is time to restore your disk to a stable version that was previously captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="4d328-130">När ögonblicksbilden befordras till bassidan blob ögonblicksbild förblir, men dess källa skrivs över med en kopia som kan vara både läses och skrivs.</span><span class="sxs-lookup"><span data-stu-id="4d328-130">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="4d328-131">Nedan beskrivs stegen för att återställa en tidigare version av disken från dess ögonblicksbild.</span><span class="sxs-lookup"><span data-stu-id="4d328-131">Later in this article we describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="4d328-132">Implementera kopia för fullständig ögonblicksbild</span><span class="sxs-lookup"><span data-stu-id="4d328-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="4d328-133">Du kan implementera en fullständig ögonblicksbild kopia genom att göra följande:</span><span class="sxs-lookup"><span data-stu-id="4d328-133">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="4d328-134">Ta först en ögonblicksbild av den grundläggande blob med hjälp av den [ögonblicksbild Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) igen.</span><span class="sxs-lookup"><span data-stu-id="4d328-134">First, take a snapshot of the base blob using the [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="4d328-135">Kopiera sedan ögonblicksbilden till ett mål lagring kontot med [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="4d328-135">Then, copy the snapshot to a target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="4d328-136">Upprepa processen för att underhålla säkerhetskopior av din grundläggande blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-136">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="4d328-137">Inkrementell ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="4d328-137">Incremental snapshot copy</span></span>
<span data-ttu-id="4d328-138">Den nya funktionen i den [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API ger en mycket bättre sätt att säkerhetskopiera ögonblicksbilder av din sidblobbar eller diskar.</span><span class="sxs-lookup"><span data-stu-id="4d328-138">The new feature in the [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="4d328-139">API: et returnerar en lista över ändringar mellan grundläggande blob och ögonblicksbilder, vilket minskar mängden lagringsutrymme som används för kontot säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="4d328-139">The API returns the list of changes between the base blob and the snapshots, which reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="4d328-140">API: et stöder sidblobar på Premium-lagring samt standardlagring.</span><span class="sxs-lookup"><span data-stu-id="4d328-140">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="4d328-141">Med detta API kan skapa du snabbare och effektivare säkerhetskopieringslösningar för virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="4d328-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="4d328-142">Detta API är tillgängliga med REST-version 2015-07-08 och högre.</span><span class="sxs-lookup"><span data-stu-id="4d328-142">This API will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="4d328-143">Inkrementell ögonblicksbild kopia kan du kopiera från ett lagringskonto till en annan skillnaden mellan</span><span class="sxs-lookup"><span data-stu-id="4d328-143">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="4d328-144">Grundläggande blob och dess ögonblicksbild eller</span><span class="sxs-lookup"><span data-stu-id="4d328-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="4d328-145">Två ögonblicksbilder av grundläggande blobben</span><span class="sxs-lookup"><span data-stu-id="4d328-145">Any two snapshots of the base blob</span></span>

<span data-ttu-id="4d328-146">Om följande villkor är uppfyllda,</span><span class="sxs-lookup"><span data-stu-id="4d328-146">Provided the following conditions are met,</span></span>

* <span data-ttu-id="4d328-147">Blobben har skapats på Jan 1 2016 eller senare.</span><span class="sxs-lookup"><span data-stu-id="4d328-147">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="4d328-148">Blob som inte skrivas över med [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) eller [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) mellan två ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="4d328-148">The blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="4d328-149">**Obs**: den här funktionen är tillgänglig för Premium- och Standard Sidblobbar för Azure.</span><span class="sxs-lookup"><span data-stu-id="4d328-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="4d328-150">När du har en anpassad strategi för säkerhetskopiering med hjälp av ögonblicksbilder, kopiera ögonblicksbilderna från ett lagringskonto till en annan kan ta lång tid och kan förbruka mycket lagringsutrymme.</span><span class="sxs-lookup"><span data-stu-id="4d328-150">When you have a custom backup strategy using snapshots, copying the snapshots from one storage account to another can be slow and can consume much storage space.</span></span> <span data-ttu-id="4d328-151">Du kan skriva skillnaden mellan på varandra följande ögonblicksbilder av en säkerhetskopiering sidblob istället för att kopiera hela ögonblicksbilden till en backup storage-konto.</span><span class="sxs-lookup"><span data-stu-id="4d328-151">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="4d328-152">Det här sättet betydligt tid att kopiera och utrymme för lagring av säkerhetskopior.</span><span class="sxs-lookup"><span data-stu-id="4d328-152">This way, the time to copy and the space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="4d328-153">Implementera inkrementell ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="4d328-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="4d328-154">Du kan implementera inkrementell ögonblicksbild kopia genom att göra följande:</span><span class="sxs-lookup"><span data-stu-id="4d328-154">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="4d328-155">Ta en ögonblicksbild av den grundläggande blob med hjälp av [ögonblicksbild Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="4d328-155">Take a snapshot of the base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="4d328-156">Kopiera ögonblicksbilden till målet säkerhetskopieringslagring kontot med [kopiera Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="4d328-156">Copy the snapshot to the target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="4d328-157">Detta är säkerhetskopiering sidblob.</span><span class="sxs-lookup"><span data-stu-id="4d328-157">This is the backup page blob.</span></span> <span data-ttu-id="4d328-158">Ta en ögonblicksbild av säkerhetskopian sidblob och lagra den i kontot för säkerhetskopiering.</span><span class="sxs-lookup"><span data-stu-id="4d328-158">Take a snapshot of the backup page blob and store it in the backup account.</span></span>
* <span data-ttu-id="4d328-159">Ta en annan ögonblicksbild av grundläggande blob med hjälp av ögonblicksbilder Blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-159">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="4d328-160">Hämta skillnaden mellan de första och andra ögonblicksbilderna av grundläggande blob med [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="4d328-160">Get the difference between the first and second snapshots of the base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="4d328-161">Använd den nya parametern **prevsnapshot**, för att ange den ögonblicksbild som du vill hämta skillnaden med DateTime-värdet.</span><span class="sxs-lookup"><span data-stu-id="4d328-161">Use the new parameter **prevsnapshot**, to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="4d328-162">Om den här parametern finns innehåller REST-svaret bara de sidor som har ändrats mellan target ögonblicksbild och tidigare ögonblicksbild, inklusive Rensa sidor.</span><span class="sxs-lookup"><span data-stu-id="4d328-162">When this parameter is present, the REST response includes only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="4d328-163">Använd [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) att tillämpa ändringarna på säkerhetskopian av sidan-blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="4d328-164">Slutligen kan ta en ögonblicksbild av säkerhetskopian sidblob och lagra den i backup storage-konto.</span><span class="sxs-lookup"><span data-stu-id="4d328-164">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="4d328-165">I nästa avsnitt, kommer beskrivs i detalj hur du kan upprätthålla säkerhetskopior av diskar med hjälp av inkrementell ögonblicksbild kopia</span><span class="sxs-lookup"><span data-stu-id="4d328-165">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="4d328-166">Scenario</span><span class="sxs-lookup"><span data-stu-id="4d328-166">Scenario</span></span>
<span data-ttu-id="4d328-167">I det här avsnittet beskriver vi ett scenario som omfattar en anpassad strategi för säkerhetskopiering för virtuella diskar med hjälp av ögonblicksbilder.</span><span class="sxs-lookup"><span data-stu-id="4d328-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="4d328-168">Beakta en Azure VM DS-serien med premium-lagring P30 disk ansluten.</span><span class="sxs-lookup"><span data-stu-id="4d328-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="4d328-169">P30 disken kallas *mypremiumdisk* lagras i ett premiumlagringskonto som kallas *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-169">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="4d328-170">Ett standardlagringskonto kallas *mybackupstdaccount* används för att lagra säkerhetskopian av *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="4d328-170">A standard storage account called *mybackupstdaccount* is used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="4d328-171">Vi vill behålla en ögonblicksbild av *mypremiumdisk* var 12: e timme.</span><span class="sxs-lookup"><span data-stu-id="4d328-171">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="4d328-172">Mer information om att skapa storage-konto och diskar, referera till [om Azure storage-konton](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="4d328-172">To learn about creating storage account and disks, refer to [About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="4d328-173">Mer information om säkerhetskopiering av virtuella Azure-datorer, referera till [planera Azure VM-säkerhetskopieringar](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="4d328-173">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="4d328-174">Steg för att underhålla säkerhetskopieringar av en disk med hjälp av inkrementell ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="4d328-174">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="4d328-175">Följande steg beskriver hur du ta ögonblicksbilder av *mypremiumdisk* och underhålla säkerhetskopieringar i *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-175">The following steps describe how to take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="4d328-176">Säkerhetskopian är en standard sidblob kallas *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="4d328-176">The backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="4d328-177">Säkerhetskopiering sidblob visar alltid samma tillstånd som den senaste ögonblicksbilden av *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="4d328-177">The backup page blob always reflects the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="4d328-178">Skapa säkerhetskopiering sidblob för hårddisken premium-lagring genom att ta en ögonblicksbild av *mypremiumdisk* kallas *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="4d328-178">Create the backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="4d328-179">Kopiera den här ögonblicksbilden till mybackupstdaccount som en sidblobb kallas *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="4d328-179">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="4d328-180">Ta en ögonblicksbild av *mybackupstdpageblob* kallas *mybackupstdpageblob_ss1*med hjälp av [ögonblicksbild Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) och lagra den i *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="4d328-181">Skapa en annan ögonblicksbild av under säkerhetskopieringen, *mypremiumdisk*, säg *mypremiumdisk_ss2*, och lagra den i *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-181">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="4d328-182">Hämta inkrementella ändringar mellan två ögonblicksbilder *mypremiumdisk_ss2* och *mypremiumdisk_ss1*med hjälp av [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) på *mypremiumdisk_ ss2* med den **prevsnapshot** parameterinställning tidsstämpeln för *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="4d328-182">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with the **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="4d328-183">Skriva dessa inkrementella ändringar till säkerhetskopiering sidblob *mybackupstdpageblob* i *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-183">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="4d328-184">Om det finns borttagna intervall i inkrementella ändras, måste tas bort från säkerhetskopian av sidan-blob.</span><span class="sxs-lookup"><span data-stu-id="4d328-184">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="4d328-185">Använd [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) skriva inkrementella ändringar till säkerhetskopiering sidblob.</span><span class="sxs-lookup"><span data-stu-id="4d328-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="4d328-186">Ta en ögonblicksbild av säkerhetskopian sidblob *mybackupstdpageblob*, kallat *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="4d328-186">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="4d328-187">Ta bort den tidigare ögonblicksbilden av *mypremiumdisk_ss1* från premium storage-konto.</span><span class="sxs-lookup"><span data-stu-id="4d328-187">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="4d328-188">Upprepa steg 4 – 6 var säkerhetskopieringsintervallet.</span><span class="sxs-lookup"><span data-stu-id="4d328-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="4d328-189">På så sätt kan du hantera säkerhetskopior av *mypremiumdisk* i ett standardlagringskonto.</span><span class="sxs-lookup"><span data-stu-id="4d328-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Säkerhetskopiera disk med hjälp av inkrementell ögonblicksbilder](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="4d328-191">Steg för att återställa en disk från ögonblicksbilder</span><span class="sxs-lookup"><span data-stu-id="4d328-191">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="4d328-192">Följande steg beskriver hur du återställer premium-disk *mypremiumdisk* till en tidigare ögonblicksbild från kontot för säkerhetskopieringslagring *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-192">The following steps, describe how to restore the premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="4d328-193">Identifiera punkten i tid som du vill återställa premium disken.</span><span class="sxs-lookup"><span data-stu-id="4d328-193">Identify the point in time that you wish to restore the premium disk to.</span></span> <span data-ttu-id="4d328-194">Anta att den har ögonblicksbilder *mybackupstdpageblob_ss2*, som lagras på kontot för säkerhetskopieringslagring *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="4d328-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="4d328-195">Befordra ögonblicksbilden i mybackupstdaccount, *mybackupstdpageblob_ss2* som ny säkerhetskopiering bassida blob *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="4d328-195">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="4d328-196">Ta en ögonblicksbild av den här återställda säkerhetskopiering sidblob, kallas *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="4d328-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="4d328-197">Kopiera den återställda sidblob *mybackupstdpageblobrestored* från *mybackupstdaccount* till *mypremiumaccount* som den nya disken premium  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="4d328-197">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="4d328-198">Ta en ögonblicksbild av *mypremiumdiskrestored*, kallat *mypremiumdiskrestored_ss1* för att göra framtida inkrementella säkerhetskopieringar.</span><span class="sxs-lookup"><span data-stu-id="4d328-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="4d328-199">DS-serien VM peka återställda disken *mypremiumdiskrestored* och koppla från gammalt *mypremiumdisk* från den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="4d328-199">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="4d328-200">Starta Säkerhetskopiering processen som beskrivs i föregående avsnitt för den återställda disken *mypremiumdiskrestored*med hjälp av den *mybackupstdpageblobrestored* som säkerhetskopiering sidblobb.</span><span class="sxs-lookup"><span data-stu-id="4d328-200">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Återställa disk från ögonblicksbilder](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="4d328-202">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="4d328-202">Next Steps</span></span>
<span data-ttu-id="4d328-203">Använd följande länkar om du vill lära dig mer om att skapa ögonblicksbilder av en blob och planera din infrastruktur för säkerhetskopiering av VM.</span><span class="sxs-lookup"><span data-stu-id="4d328-203">Use the following links to learn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="4d328-204">Skapa en ögonblicksbild av en Blob</span><span class="sxs-lookup"><span data-stu-id="4d328-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="4d328-205">Planera infrastrukturen för säkerhetskopiering VM</span><span class="sxs-lookup"><span data-stu-id="4d328-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

