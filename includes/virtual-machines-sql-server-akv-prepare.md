## <a name="prepare-for-akv-integration"></a><span data-ttu-id="7cae1-101">Förbereda för AKV-integreringen</span><span class="sxs-lookup"><span data-stu-id="7cae1-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="7cae1-102">Om du vill använda Azure Key Vault-integrering för att konfigurera SQL Server-VM, finns det flera förutsättningar:</span><span class="sxs-lookup"><span data-stu-id="7cae1-102">To use Azure Key Vault Integration to configure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="7cae1-103">Installera Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="7cae1-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="7cae1-104">Skapa en Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7cae1-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="7cae1-105">Skapa ett nyckelvalv</span><span class="sxs-lookup"><span data-stu-id="7cae1-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="7cae1-106">I följande avsnitt beskrivs dessa krav och den information du behöver samla in för att senare Kör PowerShell-cmdlets.</span><span class="sxs-lookup"><span data-stu-id="7cae1-106">The following sections describe these prerequisites and the information you need to collect to later run the PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="7cae1-107">Installera Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="7cae1-107">Install Azure PowerShell</span></span>
<span data-ttu-id="7cae1-108">Kontrollera att du har installerat den senaste Azure PowerShell SDK.</span><span class="sxs-lookup"><span data-stu-id="7cae1-108">Make sure you have installed the latest Azure PowerShell SDK.</span></span> <span data-ttu-id="7cae1-109">Mer information finns i [Installera och konfigurera Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="7cae1-109">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="7cae1-110">Skapa en Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7cae1-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="7cae1-111">Måste du ha en [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="7cae1-111">First, you need to have an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="7cae1-112">Bland många fördelar kan du ge behörighet till nyckelvalvet för vissa användare och program.</span><span class="sxs-lookup"><span data-stu-id="7cae1-112">Among many benefits, this allows you to grant permission to your key vault for certain users and applications.</span></span>

<span data-ttu-id="7cae1-113">Registrera ett program med AAD.</span><span class="sxs-lookup"><span data-stu-id="7cae1-113">Next, register an application with AAD.</span></span> <span data-ttu-id="7cae1-114">Detta ger ett huvudnamn för tjänsten-konto som har åtkomst till nyckelvalvet som behöver den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="7cae1-114">This will give you a Service Principal account that has access to your key vault which your VM will need.</span></span> <span data-ttu-id="7cae1-115">Azure Key Vault-artikeln hittar de här stegen i den [registrera ett program med Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) avsnitt eller du kan se steg med skärmdumpar i den **hämta en identitet för programavsnittet**  av [i det här blogginlägget](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="7cae1-115">In the Azure Key Vault article, you can find these steps in the [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see the steps with screen shots in the **Get an identity for the application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="7cae1-116">Observera att du behöver samla in följande information under registreringen som behövs för senare när du aktiverar Azure Key Vault-integrering på din SQL-VM innan du utför de här stegen.</span><span class="sxs-lookup"><span data-stu-id="7cae1-116">Before completing these steps, note that you need to collect the following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="7cae1-117">När programmet har lagts till, finns det **klient-ID** på den **konfigurera** fliken.</span><span class="sxs-lookup"><span data-stu-id="7cae1-117">After the application is added, find the **CLIENT ID**  on the **CONFIGURE** tab.</span></span> 
    <span data-ttu-id="7cae1-118">![Azure Active Directory klient-ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="7cae1-118">![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="7cae1-119">Klient-ID tilldelas senare till den **$spName** (Service Principal name)-parametern i PowerShell-skript för att aktivera Azure Key Vault-integrering.</span><span class="sxs-lookup"><span data-stu-id="7cae1-119">The client ID is assigned later to the **$spName** (Service Principal name) parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="7cae1-120">Dessutom under de här stegen när du skapar din nyckel kopiera hemligheten för din nyckel som visas i följande skärmbild.</span><span class="sxs-lookup"><span data-stu-id="7cae1-120">Also, during these steps when you create your key, copy the secret for your key as is shown in the following screenshot.</span></span> <span data-ttu-id="7cae1-121">Den här nyckeln hemlig tilldelas senare till den **$spSecret** (Service Principal hemliga) parameter i PowerShell-skript.</span><span class="sxs-lookup"><span data-stu-id="7cae1-121">This key secret is assigned later to the **$spSecret** (Service Principal secret) parameter in the PowerShell script.</span></span>  
    <span data-ttu-id="7cae1-122">![Azure Active Directory hemlighet](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="7cae1-122">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="7cae1-123">Du måste auktorisera den här nya klient-ID har följande åtkomstbehörighet: **kryptera**, **dekryptera**, **wrapKey**, **unwrapKey**, **logga**, och **Kontrollera**.</span><span class="sxs-lookup"><span data-stu-id="7cae1-123">You must authorize this new client ID to have the following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="7cae1-124">Detta görs med den [Set AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7cae1-124">This is done with the [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="7cae1-125">Mer information finns i [tillåta program att använda nyckel eller hemlighet](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="7cae1-125">For more information see [Authorize the application to use the key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="7cae1-126">Skapa ett nyckelvalv</span><span class="sxs-lookup"><span data-stu-id="7cae1-126">Create a key vault</span></span>
<span data-ttu-id="7cae1-127">För att kunna använda Azure Key Vault för lagring av nycklar som ska användas för kryptering i den virtuella datorn behöver åtkomst till en nyckelvalvet.</span><span class="sxs-lookup"><span data-stu-id="7cae1-127">In order to use Azure Key Vault to store the keys you will use for encryption in your VM, you need access to a key vault.</span></span> <span data-ttu-id="7cae1-128">Om du redan inte har lagt upp ditt nyckelvalv kan skapa en genom att följa stegen i den [komma igång med Azure Key Vault](../articles/key-vault/key-vault-get-started.md) avsnittet.</span><span class="sxs-lookup"><span data-stu-id="7cae1-128">If you have not already set up your key vault, create one by following the steps in the [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="7cae1-129">Observera att det finns vissa information som du behöver för att samla in under den här uppsättningen som krävs senare när du aktiverar Azure Key Vault-integrering på din SQL-VM innan du utför de här stegen.</span><span class="sxs-lookup"><span data-stu-id="7cae1-129">Before completing these steps, note that there is some information you need to collect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="7cae1-130">När du kommer att skapa ett nyckelvalv steg, notera den returnerade **vaultUri** -egenskap som är key vault-URL.</span><span class="sxs-lookup"><span data-stu-id="7cae1-130">When you get to the Create a key vault step, note the returned **vaultUri** property, which is the key vault URL.</span></span> <span data-ttu-id="7cae1-131">I exemplet i det steg som visas nedan, namnet på nyckelvalv är ContosoKeyVault, skulle key vault-URL därför https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="7cae1-131">In the example provided in that step, shown below, the key vault name is ContosoKeyVault, therefore the key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="7cae1-132">Key vault-URL är tilldelad senare till den **$akvURL** parameter i PowerShell-skript för att aktivera Azure Key Vault-integrering.</span><span class="sxs-lookup"><span data-stu-id="7cae1-132">The key vault URL is assigned later to the **$akvURL** parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span>

