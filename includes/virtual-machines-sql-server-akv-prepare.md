## <a name="prepare-for-akv-integration"></a><span data-ttu-id="cb032-101">Förbereda för AKV-integreringen</span><span class="sxs-lookup"><span data-stu-id="cb032-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="cb032-102">toouse Azure Key Vault-integrering tooconfigure SQL Server-VM finns flera förutsättningar:</span><span class="sxs-lookup"><span data-stu-id="cb032-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="cb032-103">Installera Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="cb032-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="cb032-104">Skapa en Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="cb032-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="cb032-105">Skapa ett nyckelvalv</span><span class="sxs-lookup"><span data-stu-id="cb032-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="cb032-106">hello följande avsnitt beskrivs dessa krav och hello information du behöver toocollect toolater kör hello PowerShell-cmdlets.</span><span class="sxs-lookup"><span data-stu-id="cb032-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="cb032-107">Installera Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="cb032-107">Install Azure PowerShell</span></span>
<span data-ttu-id="cb032-108">Kontrollera att du har installerat hello senaste Azure PowerShell SDK.</span><span class="sxs-lookup"><span data-stu-id="cb032-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="cb032-109">Mer information finns i [hur tooinstall och konfigurera Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="cb032-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="cb032-110">Skapa en Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="cb032-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="cb032-111">Du måste först toohave en [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="cb032-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="cb032-112">Bland många fördelar kan du toogrant behörighet tooyour nyckelvalv för vissa användare och program.</span><span class="sxs-lookup"><span data-stu-id="cb032-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="cb032-113">Registrera ett program med AAD.</span><span class="sxs-lookup"><span data-stu-id="cb032-113">Next, register an application with AAD.</span></span> <span data-ttu-id="cb032-114">Detta ger ett huvudnamn för tjänsten-konto som har åtkomst tooyour nyckelvalv som behöver den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="cb032-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="cb032-115">I hello Azure Key Vault artikeln du hittar de här stegen i hello [registrera ett program med Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) avsnitt eller du kan se hello steg med skärmbilder i hello **hämta en identitet för hello program avsnittet** av [i det här blogginlägget](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="cb032-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="cb032-116">Innan du slutför Observera stegen, att du måste toocollect hello följande information under registreringen som behövs för senare när du aktiverar Azure Key Vault-integrering på din SQL-VM.</span><span class="sxs-lookup"><span data-stu-id="cb032-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="cb032-117">När programmet hello läggs hitta hello **klient-ID** på hello **konfigurera** fliken.   ![Azure Active Directory klient-ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="cb032-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="cb032-118">hello klient-ID tilldelas senare toohello **$spName** (Service Principal name)-parametern i hello PowerShell-skriptet tooenable Azure Key Vault-integrering.</span><span class="sxs-lookup"><span data-stu-id="cb032-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="cb032-119">Dessutom under de här stegen när du skapar din nyckel kopiera hello hemligheten för din nyckel som visas i följande skärmbild hello.</span><span class="sxs-lookup"><span data-stu-id="cb032-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="cb032-120">Den här nyckeln hemlig tilldelas senare toohello **$spSecret** (Service Principal hemliga) parameter i hello PowerShell-skript.</span><span class="sxs-lookup"><span data-stu-id="cb032-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="cb032-121">![Azure Active Directory hemlighet](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="cb032-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="cb032-122">Du måste auktorisera den här nya klient-ID toohave hello följande behörigheter: **kryptera**, **dekryptera**, **wrapKey**, **unwrapKey**, **logga**, och **Kontrollera**.</span><span class="sxs-lookup"><span data-stu-id="cb032-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="cb032-123">Detta görs med hello [Set AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="cb032-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="cb032-124">Mer information finns i [auktorisera hello programmet toouse hello nyckel eller hemlighet](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="cb032-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="cb032-125">Skapa ett nyckelvalv</span><span class="sxs-lookup"><span data-stu-id="cb032-125">Create a key vault</span></span>
<span data-ttu-id="cb032-126">I ordning toouse Azure Key Vault toostore hello nycklar används för kryptering i den virtuella datorn, behöver du åtkomst tooa nyckelvalvet.</span><span class="sxs-lookup"><span data-stu-id="cb032-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="cb032-127">Om du inte redan har installerat nyckelvalvet, skapa en genom att följa stegen hello i hello [komma igång med Azure Key Vault](../articles/key-vault/key-vault-get-started.md) avsnittet.</span><span class="sxs-lookup"><span data-stu-id="cb032-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="cb032-128">Observera att det finns vissa information du behöver toocollect under den här uppsättningen som krävs senare när du aktiverar Azure Key Vault-integrering på din SQL-VM innan du utför de här stegen.</span><span class="sxs-lookup"><span data-stu-id="cb032-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="cb032-129">När du får toohello skapa ett nyckelvalv steg Obs hello returnerade **vaultUri** -egenskap som är hello key vault-URL.</span><span class="sxs-lookup"><span data-stu-id="cb032-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="cb032-130">I hello exemplet i det steg som visas nedan, hello nyckelvalv namn är ContosoKeyVault, därför hello key vault-URL att https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="cb032-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="cb032-131">hello key vault-URL är tilldelad senare toohello **$akvURL** parameter i hello PowerShell-skriptet tooenable Azure Key Vault-integrering.</span><span class="sxs-lookup"><span data-stu-id="cb032-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>

