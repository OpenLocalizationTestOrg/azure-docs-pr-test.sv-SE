# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="2334e-101">Skydda Docker-behållare i Azure Container Service</span><span class="sxs-lookup"><span data-stu-id="2334e-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="2334e-102">Den här artikeln innehåller överväganden och rekommendationer som hjälper dig att skydda Docker-behållare som distribueras i Azure Container Service.</span><span class="sxs-lookup"><span data-stu-id="2334e-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="2334e-103">Många av dessa överväganden gäller vanligtvis tooDocker behållare som distribueras i Azure eller andra miljöer.</span><span class="sxs-lookup"><span data-stu-id="2334e-103">Many of these considerations apply generally tooDocker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="2334e-104">Avbildningssäkerhet</span><span class="sxs-lookup"><span data-stu-id="2334e-104">Image security</span></span>

<span data-ttu-id="2334e-105">Behållare skapas från avbildningar som lagras i en eller flera databaser.</span><span class="sxs-lookup"><span data-stu-id="2334e-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="2334e-106">Dessa databaser kan höra toopublic eller privata behållare register.</span><span class="sxs-lookup"><span data-stu-id="2334e-106">These repositories can belong toopublic or private container registries.</span></span> <span data-ttu-id="2334e-107">Ett exempel på ett offentligt register är [Docker Hub](https://hub.docker.com/).</span><span class="sxs-lookup"><span data-stu-id="2334e-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="2334e-108">Ett exempel på ett privat register är hello [Docker betrodda registret](https://docs.docker.com/datacenter/dtr/2.0/), som kan installeras lokalt eller i ett virtuellt privat moln.</span><span class="sxs-lookup"><span data-stu-id="2334e-108">An example of a private registry is hello [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="2334e-109">Det finns också molnbaserade tjänster för privata registerbehållare, t.ex. [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span><span class="sxs-lookup"><span data-stu-id="2334e-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="2334e-110">Offentliga och privata avbildningar</span><span class="sxs-lookup"><span data-stu-id="2334e-110">Public and private images</span></span>
<span data-ttu-id="2334e-111">Normalt, som med andra offentligt publicerade programvarupaket, är säkerheten i en offentligt tillgänglig behållaravbildning inte garanterad.</span><span class="sxs-lookup"><span data-stu-id="2334e-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="2334e-112">Behållaravbildningar består av flera programvarulager och varje programvarulager kan medföra säkerhetsrisker.</span><span class="sxs-lookup"><span data-stu-id="2334e-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="2334e-113">Det är viktiga toounderstand hello ursprung hello behållaren image, inklusive hello ägare till hello bild (toodetermine om det är en pålitlig källa eller inte), hello programlager består av och hello programvaruversioner.</span><span class="sxs-lookup"><span data-stu-id="2334e-113">It is key toounderstand hello origin of hello container image, including hello owner of hello image (toodetermine if it is a reliable source or not), hello software layers it consists of, and hello software versions.</span></span> 

<span data-ttu-id="2334e-114">Till exempel om du går toohello officiella [nginx databasen](https://hub.docker.com/_/nginx/) i Docker hubb och navigera toohello **taggar** fliken färgkodade säkerhetsproblem i varje bild visas.</span><span class="sxs-lookup"><span data-stu-id="2334e-114">For example, if you go toohello official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate toohello **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="2334e-115">Varje färg visar hello sårbarhet ett Programsteg till hello bild.</span><span class="sxs-lookup"><span data-stu-id="2334e-115">Each color depicts hello vulnerability of a software layer of hello image.</span></span> <span data-ttu-id="2334e-116">Mer information om hur du granskar säkerhetsrisker i Docker Hub finns i [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/) (Så här fungerar officiella databaser i Docker Hub).</span><span class="sxs-lookup"><span data-stu-id="2334e-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Nginx-avbildningar i Docker Hub](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="2334e-118">Företag djupt hand om säkerhet och tooprotect sig från säkerhet attacker bör lagra och hämta bilder från ett privat register, till exempel Azure Container registret eller Docker betrodda registret.</span><span class="sxs-lookup"><span data-stu-id="2334e-118">Enterprises care deeply about security, and tooprotect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="2334e-119">I tillägg tooproviding ett hanterade privata register, stöd för Azure-behållare registret [service principal-baserad autentisering](../articles/container-registry/container-registry-authentication.md) via Azure Active Directory för grundläggande autentisering, inklusive rollbaserad åtkomst för skrivskyddad, Skriv- och ägare.</span><span class="sxs-lookup"><span data-stu-id="2334e-119">In addition tooproviding a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="2334e-120">Säkerhetsgenomsökning för avbildningar</span><span class="sxs-lookup"><span data-stu-id="2334e-120">Image security scanning</span></span>

<span data-ttu-id="2334e-121">Även om du använder ett privat register är en bra idé toouse avbildning genomsökning lösningar för ytterligare säkerhet verifiering.</span><span class="sxs-lookup"><span data-stu-id="2334e-121">Even when using a private registry, it is a good idea toouse image scanning solutions for additional security validation.</span></span> <span data-ttu-id="2334e-122">Varje programvara lager i en behållare bild är potentiellt känsliga toovulnerabilities oberoende av andra lager i hello behållaren bild.</span><span class="sxs-lookup"><span data-stu-id="2334e-122">Each software layer in a container image is potentially prone toovulnerabilities independent of other layers in hello container image.</span></span> <span data-ttu-id="2334e-123">Eftersom allt företag börja distribuera sina produktionsarbetsbelastningar baserat på behållaren tekniker, blir skanningen viktigt tooensure förebyggande av säkerhetshot mot deras organisationer.</span><span class="sxs-lookup"><span data-stu-id="2334e-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important tooensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="2334e-124">Övervakning och genomsökning av lösningar som [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) och [turkos säkerhet](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), bland annat kan använda tooscan behållare bilder i ett privat register och identifiera potentiella säkerhetsrisker.</span><span class="sxs-lookup"><span data-stu-id="2334e-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used tooscan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="2334e-125">Det är viktigt att ange toounderstand hello djup att genomsöka de hello olika lösningarna.</span><span class="sxs-lookup"><span data-stu-id="2334e-125">It is important toounderstand hello depth of scanning that hello different solutions provide.</span></span> <span data-ttu-id="2334e-126">Till exempel kanske vissa lösningar bara verifierar avbildningslager mot kända säkerhetsrisker.</span><span class="sxs-lookup"><span data-stu-id="2334e-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="2334e-127">Dessa lösningar kanske inte kan tooverify avbildningen layer programvara inbyggda via vissa package manager-program.</span><span class="sxs-lookup"><span data-stu-id="2334e-127">These solutions might not be able tooverify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="2334e-128">Andra lösningar har djupare genomsökningsintegration och kan hitta sårbarheter i all paketerad programvara.</span><span class="sxs-lookup"><span data-stu-id="2334e-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="2334e-129">Regler för och granskning av distributioner i produktionsmiljön</span><span class="sxs-lookup"><span data-stu-id="2334e-129">Production deployment rules and audit</span></span>
<span data-ttu-id="2334e-130">När ett program har distribuerats i produktion, är det grundläggande tooset några regler tooensure som bilder används i produktionsmiljöer är säker och innehåller ingen säkerhetsproblem.</span><span class="sxs-lookup"><span data-stu-id="2334e-130">Once an application is deployed in production, it is essential tooset a few rules tooensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="2334e-131">Som regel ska bilder med säkerhetsrisker, även mindre inte tillåtas toorun i en produktionsmiljö.</span><span class="sxs-lookup"><span data-stu-id="2334e-131">As a rule, images with vulnerabilities, even minor, should not be allowed toorun in a production environment.</span></span> <span data-ttu-id="2334e-132">Dessutom bör alla bilder som har distribuerats i produktionsmiljön helst sparas i ett privat registret tillgänglig tooa Välj få.</span><span class="sxs-lookup"><span data-stu-id="2334e-132">In addition, all images deployed in production should ideally be saved in a private registry accessible tooa select few.</span></span> <span data-ttu-id="2334e-133">Det är också viktigt tookeep hello antalet produktion bilder små tooensure att de kan hanteras effektivt.</span><span class="sxs-lookup"><span data-stu-id="2334e-133">It is also important tookeep hello number of production images small tooensure that they can be managed effectively.</span></span>

* <span data-ttu-id="2334e-134">Eftersom det hårda toopinpoint hello ursprung programvara från en avbildning av offentligt tillgängliga behållare, är det en bra idé toobuild bilder från källan tooensure kunskap om hello ursprung hello lager.</span><span class="sxs-lookup"><span data-stu-id="2334e-134">Since it is hard toopinpoint hello origin of software from a publicly available container image, it is a good practice toobuild images from source tooensure knowledge of hello origin of hello layer.</span></span> <span data-ttu-id="2334e-135">När en säkerhetsrisk hämtar i en egen inbyggd behållaren bild kan kunder hitta en snabbare sökvägen tooa lösning.</span><span class="sxs-lookup"><span data-stu-id="2334e-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path tooa resolution.</span></span> <span data-ttu-id="2334e-136">Med en offentlig avbildning kunder behöver toofind hello roten av en offentlig avbildningen toofix den eller skaffa en annan säker bild från hello utgivare.</span><span class="sxs-lookup"><span data-stu-id="2334e-136">With a public image, customers would need toofind hello root of a public image toofix it or obtain another secure image from hello publisher.</span></span>

* <span data-ttu-id="2334e-137">En noggrant skannad bild som distribuerats i produktionsmiljön garanteras inte toobe in toodate under hello programmet hello livstid.</span><span class="sxs-lookup"><span data-stu-id="2334e-137">A thoroughly scanned image deployed in production is not guaranteed toobe up toodate for hello lifetime of hello application.</span></span> <span data-ttu-id="2334e-138">Säkerhetsproblem kan rapporteras för lager i hello avbildning som inte tidigare känd eller införts efter hello Produktionsdistribution.</span><span class="sxs-lookup"><span data-stu-id="2334e-138">Security vulnerabilities might be reported for layers of hello image that were not previously known or were introduced after hello production deployment.</span></span> <span data-ttu-id="2334e-139">Regelbunden granskning av avbildningar som distribuerats i produktionsmiljön är nödvändiga tooidentify bilder som har upphört att gälla eller har inte uppdaterats om en stund.</span><span class="sxs-lookup"><span data-stu-id="2334e-139">Periodic auditing of images deployed in production is necessary tooidentify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="2334e-140">En kan använda blå-grön distribution metoder och löpande uppgradering mekanismer tooupdate behållare bilder utan driftavbrott.</span><span class="sxs-lookup"><span data-stu-id="2334e-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms tooupdate container images without downtime.</span></span> <span data-ttu-id="2334e-141">Skanningen kan göras med verktyg som beskrivs i föregående avsnitt hello.</span><span class="sxs-lookup"><span data-stu-id="2334e-141">Image scanning can be done with tools described in hello preceding section.</span></span> 

* <span data-ttu-id="2334e-142">En kontinuerlig integration (KO) pipeline toobuild bilder och integrerad säkerhet genomsökning hjälper underhålla säker privata register med bilder för säkra behållare.</span><span class="sxs-lookup"><span data-stu-id="2334e-142">A continuous integration (CI) pipeline toobuild images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="2334e-143">hello säkerställer säkerhetsproblem genomsökning inbyggd hello CI lösning att bilder som klarar alla tester i hello push toohello privata registret från vilken produktion arbetsbelastningar har distribuerats.</span><span class="sxs-lookup"><span data-stu-id="2334e-143">hello vulnerability scanning built into hello CI solution ensures that images that pass all hello tests are pushed toohello private registry from which production workloads are deployed.</span></span> <span data-ttu-id="2334e-144">Ett CI pipeline-fel säkerställer att sårbara bilder inte pushas till hello privata register används för arbetsbelastningen Produktionsdistribution.</span><span class="sxs-lookup"><span data-stu-id="2334e-144">A CI pipeline failure ensures that vulnerable images are not pushed into hello private registry used for production workload deployments.</span></span> <span data-ttu-id="2334e-145">Dessutom körs säkerhetsgenomsökningar av avbildningarna automatiskt om det finns ett stort antal avbildningar.</span><span class="sxs-lookup"><span data-stu-id="2334e-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="2334e-146">Att manuellt söka efter säkerhetsrisker i avbildningar kan vara en enormt tidskrävande och felbenägen uppgift.</span><span class="sxs-lookup"><span data-stu-id="2334e-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="2334e-147">Behållarisolering på värdnivå</span><span class="sxs-lookup"><span data-stu-id="2334e-147">Host-level container isolation</span></span>
<span data-ttu-id="2334e-148">När en kund distribuerar behållarprogram på Azure-resurser distribueras de på en prenumerationsnivå i resursgrupper och är inte konfigurerade för flera klientorganisationer.</span><span class="sxs-lookup"><span data-stu-id="2334e-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="2334e-149">Det innebär att om en kund delar en prenumeration med andra, det finns inga gränser som kan byggas mellan två distributioner i hello samma prenumeration.</span><span class="sxs-lookup"><span data-stu-id="2334e-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in hello same subscription.</span></span> <span data-ttu-id="2334e-150">Det betyder i sin tur att det inte går att garantera säkerhet på behållarnivå.</span><span class="sxs-lookup"><span data-stu-id="2334e-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="2334e-151">Det är också viktig toounderstand som behållare delar hello kernel och hello resurser av hello-värden (som i Azure Container Service är en Azure-dator i ett kluster).</span><span class="sxs-lookup"><span data-stu-id="2334e-151">It is also critical toounderstand that containers share hello kernel and hello resources of hello host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="2334e-152">Av den anledningen måste behållare som körs i en produktionsmiljö köras i icke-privilegierat användarläge.</span><span class="sxs-lookup"><span data-stu-id="2334e-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="2334e-153">Kör en behållare med rotprivilegier kan äventyra hello hela miljön.</span><span class="sxs-lookup"><span data-stu-id="2334e-153">Running a container with root privileges can compromise hello entire environment.</span></span> <span data-ttu-id="2334e-154">Med rotnivå åtkomst i en behållare, kan en hackare komma åt toohello fullständiga rotprivilegier på hello värden.</span><span class="sxs-lookup"><span data-stu-id="2334e-154">With root-level access in a container, a hacker can gain access toohello full root privileges on hello host.</span></span> <span data-ttu-id="2334e-155">Det är dessutom viktigt toorun behållare med skrivskyddad filsystem.</span><span class="sxs-lookup"><span data-stu-id="2334e-155">In addition, it is important toorun containers with read-only file systems.</span></span> <span data-ttu-id="2334e-156">Detta förhindrar att någon som har åtkomst toohello komprometteras behållaren toowrite skadliga skript toohello filsystemet och komma åt tooother filer.</span><span class="sxs-lookup"><span data-stu-id="2334e-156">This prevents someone who has access toohello compromised container toowrite malicious scripts toohello file system and gain access tooother files.</span></span> <span data-ttu-id="2334e-157">På samma sätt är det viktigt toolimit hello resurserna (till exempel minne, CPU och nätverkets bandbredd) tooa behållare.</span><span class="sxs-lookup"><span data-stu-id="2334e-157">Similarly, it is important toolimit hello resources (such as memory, CPU, and network bandwidth) allocated tooa container.</span></span> <span data-ttu-id="2334e-158">Detta förhindrar att hackare att ta upp resurser och olaglig verksamhet, till exempel kreditkort bedrägeri eller bitcoin utvinningsmodellen som kan förhindra att andra behållare körs på hello-värd eller kluster.</span><span class="sxs-lookup"><span data-stu-id="2334e-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on hello host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="2334e-159">Orkestreringsöverväganden</span><span class="sxs-lookup"><span data-stu-id="2334e-159">Orchestrator considerations</span></span>

<span data-ttu-id="2334e-160">Varje orkestrering som är tillgänglig i Azure Container Service har sina egna säkerhetsöverväganden.</span><span class="sxs-lookup"><span data-stu-id="2334e-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="2334e-161">Exempelvis bör du begränsa direkt SSH åtkomst tooorchestrator noder i Container Service.</span><span class="sxs-lookup"><span data-stu-id="2334e-161">For example, you should limit direct SSH access tooorchestrator nodes in Container Service.</span></span> <span data-ttu-id="2334e-162">I stället bör du använda Användargränssnittet och kommandoradsverktyg för varje orchestrator (exempelvis `kubectl` för Kubernetes) toomanage hello behållaren miljö utan att öppna hello värdar.</span><span class="sxs-lookup"><span data-stu-id="2334e-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) toomanage hello container environment without accessing hello hosts.</span></span> <span data-ttu-id="2334e-163">Mer information finns i [gör en anslutning till tooa Kubernetes, DC/OS eller Docker Swarm-kluster](../articles/container-service/kubernetes/container-service-connect.md).</span><span class="sxs-lookup"><span data-stu-id="2334e-163">For more information, see [Make a remote connection tooa Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="2334e-164">Ytterligare säkerhet för orchestrator-specifik information finns i hello följande resurser:</span><span class="sxs-lookup"><span data-stu-id="2334e-164">For additional orchestrator-specific security information, see hello following resources:</span></span>

* <span data-ttu-id="2334e-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html) (Säkerhetsrekommendationer för Kubernetes-distributioner)</span><span class="sxs-lookup"><span data-stu-id="2334e-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="2334e-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/) (Skydda ditt kluster)</span><span class="sxs-lookup"><span data-stu-id="2334e-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="2334e-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security) (Säkerhet i Docker)</span><span class="sxs-lookup"><span data-stu-id="2334e-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="2334e-168">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="2334e-168">Next steps</span></span>

* <span data-ttu-id="2334e-169">Mer information om Docker-arkitektur och en behållare säkerhet finns i [introduktion tooContainer säkerhet](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span><span class="sxs-lookup"><span data-stu-id="2334e-169">For more about Docker architecture and container security, see [Introduction tooContainer Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="2334e-170">Information om säkerhet i Azure-plattformen finns hello [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span><span class="sxs-lookup"><span data-stu-id="2334e-170">For information about Azure platform security, see hello [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>
